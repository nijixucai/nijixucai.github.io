<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Macå®‰è£…swarm-bee</title>
      <link href="2021/04/01/blockchain/eth/%E5%AE%89%E8%A3%85swarm/"/>
      <url>2021/04/01/blockchain/eth/%E5%AE%89%E8%A3%85swarm/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…swarm-clef">å®‰è£…swarm-clef</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">brew tap ethersphere/tap</span></span><br><span class="line">HOMEBREW_CORE_GIT_REMOTE set: using https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git for Homebrew/brew Git remote.</span><br><span class="line">Updating Homebrew...</span><br><span class="line">remote: Counting objects: 8637, done.</span><br><span class="line">remote: Compressing objects: 100% (3519/3519), done.</span><br><span class="line">remote: Total 8637 (delta 5893), reused 7146 (delta 5115)</span><br><span class="line">Receiving objects: 100% (8637/8637), 2.98 MiB | 530.00 KiB/s, done.</span><br><span class="line">Resolving deltas: 100% (5893/5893), done.</span><br><span class="line">From https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core</span><br><span class="line">   4c4ccfe0f3..7fa7e5ada3  master     -&gt; origin/master</span><br><span class="line">==&gt; Auto-updated Homebrew!</span><br><span class="line">Updated 1 tap (homebrew/core).</span><br><span class="line">==&gt; New Formulae</span><br><span class="line">as-tree                  gopass-jsonapi           klee                     moto                     pyqt-3d                  qt-libiodbc              qt-unixodbc              virtualenv</span><br><span class="line">clusterctl               haskell-language-server  leaf-proxy               numactl                  pyqt-builder             qt-mariadb               rosa-cli                 wllvm</span><br><span class="line">djl-serving              iconsur                  libunwind                obfs4proxy               pyqt-networkauth         qt-mysql                 threemux                 xray</span><br><span class="line">enzyme                   influxdb@1               linux-pam                orgalorg                 python-tabulate          qt-percona-server        timg                     zlib-ng</span><br><span class="line">glibc                    kertish-dfs              lttng-ust                pandoc-plot              python-tk@3.9            qt-postgresql            tz</span><br><span class="line">==&gt; Updated Formulae</span><br><span class="line">Updated 810 formulae.</span><br><span class="line">==&gt; Renamed Formulae</span><br><span class="line">kde-extra-cmake-modules -&gt; extra-cmake-modules     kde-kdoctools -&gt; kdoctools                         kde-threadweaver -&gt; threadweaver                   pyqt5 -&gt; pyqt@5</span><br><span class="line">kde-karchive -&gt; karchive                           kde-ki18n -&gt; ki18n                                 minizip2 -&gt; minizip-ng</span><br><span class="line"></span><br><span class="line">==&gt; Tapping ethersphere/tap</span><br><span class="line">Cloning into &#x27;/usr/local/Homebrew/Library/Taps/ethersphere/homebrew-tap&#x27;...</span><br><span class="line">remote: Enumerating objects: 54, done.</span><br><span class="line">remote: Counting objects: 100% (54/54), done.</span><br><span class="line">remote: Compressing objects: 100% (53/53), done.</span><br><span class="line">remote: Total 54 (delta 25), reused 3 (delta 0), pack-reused 0</span><br><span class="line">Unpacking objects: 100% (54/54), done.</span><br><span class="line">Tapped 2 formulae (79 files, 55.2KB).</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…swarm-clef-v2">å®‰è£…swarm-clef</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> brew install swarm-clef</span></span><br><span class="line">==&gt; Installing swarm-clef from ethersphere/tap</span><br><span class="line">==&gt; Downloading https://github.com/ethersphere/bee-clef/releases/download/v0.4.9/bee-clef-darwin-amd64.tar.gz</span><br><span class="line">==&gt; Downloading from https://github-releases.githubusercontent.com/315272652/3b94a200-76ca-11eb-8e99-bff3c754fc38?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20210329%2Fus-eas</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################################################### 100.0%</span></span></span><br><span class="line">==&gt; openssl rand -out /usr/local/var/lib/swarm-clef/password -base64 32</span><br><span class="line">==&gt; /usr/local/Cellar/swarm-clef/0.4.9/bin/swarm-clef-init &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">==&gt; Caveats</span><br><span class="line">Logs: /usr/local/var/log/swarm-clef/swarm-clef.log</span><br><span class="line"></span><br><span class="line">To have launchd start ethersphere/tap/swarm-clef now and restart at login:</span><br><span class="line">  brew services start ethersphere/tap/swarm-clef</span><br><span class="line">==&gt; Summary</span><br><span class="line">ğŸº  /usr/local/Cellar/swarm-clef/0.4.9: 9 files, 31.3MB, built in 10 seconds</span><br><span class="line">==&gt; `brew cleanup` has not been run in 30 days, running now...</span><br><span class="line">Removing: /Users/apple/Library/Caches/Homebrew/git--man--2.30.1.tar.xz... (470.8KB)</span><br><span class="line">Removing: /Users/apple/Library/Caches/Homebrew/git--html--2.30.1.tar.xz... (1.3MB)</span><br><span class="line">Removing: /Users/apple/Library/Caches/Homebrew/git--2.30.1.tar.xz... (6MB)</span><br><span class="line">Removing: /Users/apple/Library/Caches/Homebrew/git--2.30.1.big_sur.bottle.tar.gz... (14.8MB)</span><br><span class="line">Removing: /Users/apple/Library/Caches/Homebrew/glib--2.66.7.big_sur.bottle.tar.gz... (6.2MB)</span><br><span class="line">Removing: /Users/apple/Library/Caches/Homebrew/go--1.16.big_sur.bottle.tar.gz... (154.2MB)</span><br><span class="line">Removing: /Users/apple/Library/Caches/Homebrew/jasper--2.0.26.big_sur.bottle.tar.gz... (310.4KB)</span><br><span class="line">Removing: /Users/apple/Library/Caches/Homebrew/node--15.11.0.big_sur.bottle.tar.gz... (15.5MB)</span><br><span class="line">Removing: /Users/apple/Library/Caches/Homebrew/openssl@1.1--1.1.1j.tar.gz... (9.4MB)</span><br><span class="line">Removing: /Users/apple/Library/Caches/Homebrew/openssl@1.1--1.1.1j.big_sur.bottle.tar.gz... (5.4MB)</span><br><span class="line">Removing: /Users/apple/Library/Caches/Homebrew/python@3.9--setuptools--53.0.0.tar.gz... (2.0MB)</span><br><span class="line">Removing: /Users/apple/Library/Caches/Homebrew/solidity--0.8.2.big_sur.bottle.tar.gz... (7.3MB)</span><br><span class="line">Removing: /Users/apple/Library/Caches/Homebrew/sqlite--3.34.0.big_sur.bottle.tar.gz... (2.0MB)</span><br><span class="line">Removing: /Users/apple/Library/Caches/Homebrew/sphinx-doc--3.5.1.tar.gz... (5.6MB)</span><br><span class="line">Removing: /Users/apple/Library/Caches/Homebrew/protobuf--3.14.0.tar.gz... (7.2MB)</span><br><span class="line">Removing: /Users/apple/Library/Caches/Homebrew/protobuf--patch--5433b6247127f9ca622b15c9f669efbaac830fa717ed6220081bc1fc3c735f91.patch... (1KB)</span><br><span class="line">Removing: /Users/apple/Library/Caches/Homebrew/sphinx-doc--urllib3--1.26.3.tar.gz... (285.7KB)</span><br><span class="line">Removing: /Users/apple/Library/Caches/Homebrew/cmake--3.19.6.tar.gz... (8.8MB)</span><br><span class="line">Removing: /Users/apple/Library/Caches/Homebrew/sphinx-doc--Pygments--2.8.0.tar.gz... (3.8MB)</span><br><span class="line">Removing: /Users/apple/Library/Logs/Homebrew/node@10... (64B)</span><br><span class="line">Removing: /Users/apple/Library/Logs/Homebrew/node... (64B)</span><br><span class="line">Pruned 2 symbolic links and 9 directories from /usr/local</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨">å¯åŠ¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> brew services start swarm-clef</span></span><br><span class="line">==&gt; Tapping homebrew/services</span><br><span class="line">Cloning into &#x27;/usr/local/Homebrew/Library/Taps/homebrew/homebrew-services&#x27;...</span><br><span class="line">remote: Enumerating objects: 20, done.</span><br><span class="line">remote: Counting objects: 100% (20/20), done.</span><br><span class="line">remote: Compressing objects: 100% (12/12), done.</span><br><span class="line">remote: Total 1141 (delta 8), reused 10 (delta 8), pack-reused 1121</span><br><span class="line">Receiving objects: 100% (1141/1141), 331.41 KiB | 397.00 KiB/s, done.</span><br><span class="line">Resolving deltas: 100% (485/485), done.</span><br><span class="line">Tapped 1 command (40 files, 420.5KB).</span><br><span class="line">==&gt; Successfully started `swarm-clef` (label: homebrew.mxcl.swarm-clef)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å®‰è£…swarm-bee">å®‰è£…swarm-bee</h2><h3 id="å®‰è£…">å®‰è£…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> brew install swarm-bee</span></span><br><span class="line">HOMEBREW_CORE_GIT_REMOTE set: using https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git for Homebrew/brew Git remote.</span><br><span class="line">Updating Homebrew...</span><br><span class="line">==&gt; Installing swarm-bee from ethersphere/tap</span><br><span class="line">==&gt; Downloading https://github.com/ethersphere/bee/releases/download/v0.5.3/bee-darwin-amd64.tar.gz</span><br><span class="line">==&gt; Downloading from https://github-releases.githubusercontent.com/234530887/4ac71c80-8bb0-11eb-8943-fe7e40bc83d8?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20210329%2Fus-eas</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">####################################################################### 100.0%</span></span></span><br><span class="line">==&gt; openssl rand -out /usr/local/var/lib/swarm-bee/password -base64 32</span><br><span class="line">==&gt; /usr/local/Cellar/swarm-bee/0.5.3/bin/bee init --config /usr/local/etc/swarm-bee/bee.yaml &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">==&gt; Caveats</span><br><span class="line">Logs:   /usr/local/var/log/swarm-bee/bee.log</span><br><span class="line">Config: /usr/local/etc/swarm-bee/bee.yaml</span><br><span class="line"></span><br><span class="line">Bee has SWAP enabled and by default is using slock.it goerli ethereum endpoint.</span><br><span class="line">It is recommended to use external signer with bee.</span><br><span class="line">Check documentation for more info:</span><br><span class="line">- SWAP https://docs.ethswarm.org/docs/installation/manual#swap-bandwidth-incentives</span><br><span class="line">- External signer https://docs.ethswarm.org/docs/installation/bee-clef</span><br><span class="line"></span><br><span class="line">After you finish configuration run &#x27;bee-get-addr&#x27;.</span><br><span class="line"></span><br><span class="line">To have launchd start ethersphere/tap/swarm-bee now and restart at login:</span><br><span class="line">  brew services start ethersphere/tap/swarm-bee</span><br><span class="line">==&gt; Summary</span><br><span class="line">ğŸº  /usr/local/Cellar/swarm-bee/0.5.3: 7 files, 32.5MB, built in 5 seconds</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨-v2">å¯åŠ¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew services start swarm-bee</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æ—¥å¿—éªŒè¯å¯åŠ¨æƒ…å†µ">æŸ¥çœ‹æ—¥å¿—éªŒè¯å¯åŠ¨æƒ…å†µ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> tail -f /usr/local/var/log/swarm-bee/bee.log</span><br><span class="line">time=&quot;2021-03-29T11:53:15+08:00&quot; level=info msg=&quot;using ethereum address fb6fe8500a4101196cc80e02f7137a20720fed20&quot;</span><br><span class="line">time=&quot;2021-03-29T11:53:15+08:00&quot; level=info msg=&quot;debug api address: 127.0.0.1:1635&quot;</span><br><span class="line">time=&quot;2021-03-29T11:53:20+08:00&quot; level=info msg=&quot;using default factory address for chain id 5: f0277caffea72734853b834afc9892461ea18474&quot;</span><br><span class="line">time=&quot;2021-03-29T11:53:21+08:00&quot; level=info msg=&quot;no chequebook found, deploying new one.&quot;</span><br><span class="line">time=&quot;2021-03-29T11:53:23+08:00&quot; level=warning msg=&quot;cannot continue until there is sufficient ETH (for Gas) and at least 10 BZZ available on fb6fe8500a4101196cc80e02f7137a20720fed20&quot;</span><br><span class="line">time=&quot;2021-03-29T11:53:23+08:00&quot; level=warning msg=&quot;get your Goerli ETH and Goerli BZZ now via the bzzaar at https://bzz.ethswarm.org/?transaction=buy&amp;amount=10&amp;slippage=30&amp;receiver=0xfb6fe8500a4101196cc80e02f7137a20720fed20&quot;</span><br><span class="line">time=&quot;2021-03-29T11:53:43+08:00&quot; level=warning msg=&quot;cannot continue until there is sufficient ETH (for Gas) and at least 10 BZZ available on fb6fe8500a4101196cc80e02f7137a20720fed20&quot;</span><br><span class="line">time=&quot;2021-03-29T11:53:43+08:00&quot; level=warning msg=&quot;get your Goerli ETH and Goerli BZZ now via the bzzaar at https://bzz.ethswarm.org/?transaction=buy&amp;amount=10&amp;slippage=30&amp;receiver=0xfb6fe8500a4101196cc80e02f7137a20720fed20&quot;</span><br><span class="line">time=&quot;2021-03-29T11:54:05+08:00&quot; level=warning msg=&quot;cannot continue until there is sufficient ETH (for Gas) and at least 10 BZZ available on fb6fe8500a4101196cc80e02f7137a20720fed20&quot;</span><br><span class="line">time=&quot;2021-03-29T11:54:05+08:00&quot; level=warning msg=&quot;get your Goerli ETH and Goerli BZZ now via the bzzaar at https://bzz.ethswarm.org/?transaction=buy&amp;amount=10&amp;slippage=30&amp;receiver=0xfb6fe8500a4101196cc80e02f7137a20720fed20&quot;</span><br><span class="line">time=&quot;2021-03-29T11:54:26+08:00&quot; level=warning msg=&quot;cannot continue until there is sufficient ETH (for Gas) and at least 10 BZZ available on fb6fe8500a4101196cc80e02f7137a20720fed20&quot;</span><br><span class="line">time=&quot;2021-03-29T11:54:26+08:00&quot; level=warning msg=&quot;get your Goerli ETH and Goerli BZZ now via the bzzaar at https://bzz.ethswarm.org/?transaction=buy&amp;amount=10&amp;slippage=30&amp;receiver=0xfb6fe8500a4101196cc80e02f7137a20720fed20&quot;</span><br></pre></td></tr></table></figure><h2 id="é—®é¢˜å¤„ç†">é—®é¢˜å¤„ç†</h2><h3 id="æ²¡æœ‰è¶³å¤Ÿçš„BZZ">æ²¡æœ‰è¶³å¤Ÿçš„BZZ</h3><p>åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œéœ€è¦æŠµæŠ¼10ä¸ªBZZï¼Œæ‰€ä»¥éœ€è¦å…ˆå»å…‘æ¢BZZã€‚æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msg=&quot;cannot continue until there is sufficient ETH (for Gas) and at least 10 BZZ available on fb6fe8500a4101196cc80e02f7137a20720fed20&quot;</span><br></pre></td></tr></table></figure><h4 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h4><p>æŸ¥çœ‹æ—¥å¿—<code>get your Goerli ETH and Goerli BZZ now via the bzzaar at https://bzz.ethswarm.org/?transaction=buy&amp;amount=10&amp;slippage=30&amp;receiver=0xfb6fe8500a4101196cc80e02f7137a20720fed20</code>å»æ—¥å¿—é‡Œé¢çš„åœ°å€å»å…‘æ¢BZZå³å¯ã€‚</p><p><em>é’±åŒ…éœ€è¦è¿æ¥Goerliæµ‹è¯•ç½‘ç»œ</em></p><h3 id="è¿æ¥ä¸ä¸Š">è¿æ¥ä¸ä¸Š</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">time=&quot;2021-04-01T16:39:38+08:00&quot; level=warning msg=&quot;peer not reachable when attempting to connect&quot;</span><br><span class="line">time=&quot;2021-04-01T16:39:38+08:00&quot; level=info msg=&quot;attempting to connect to peer 4cf39bf945bd6e9b0c30bc2c71d1fbd37ea62a6914153198013f6a307ac42c5e&quot;</span><br><span class="line">time=&quot;2021-04-01T16:39:38+08:00&quot; level=debug msg=&quot;could not connect to peer 4cf39bf945bd6e9b0c30bc2c71d1fbd37ea62a6914153198013f6a307ac42c5e: breaker closed&quot;</span><br><span class="line">time=&quot;2021-04-01T16:39:38+08:00&quot; level=debug msg=&quot;peer not reachable from kademlia [Underlay: /ip4/185.141.62.127/tcp/1634/p2p/16Uiu2HAm9tLfWdu6UGxcqEsEssZDAug4LL3xDoTtL8C1KgWDoHSv, Overlay 4cf39bf945bd6e9b0c30bc2c71d1fbd37ea62a6914153198013f6a307ac42c5e, Signature 2fd8b012352e6d8bbb987a49c62060d4ec9c900335e9abe02c685ab3c4ec92f721dbeea4ad81943933dc50bd37d773677d27d5ae1ca9d89cd61de15477fbe72f1c]: breaker closed&quot;</span><br></pre></td></tr></table></figure><h4 id="è§£å†³æ–¹æ¡ˆ-é‡å¯ï¼›æš‚æ—¶ä¸çŸ¥é“ä¸ºä»€ä¹ˆ">è§£å†³æ–¹æ¡ˆ-é‡å¯ï¼›æš‚æ—¶ä¸çŸ¥é“ä¸ºä»€ä¹ˆ</h4><h2 id="å¸¸ç”¨å‘½ä»¤è®°å½•">å¸¸ç”¨å‘½ä»¤è®°å½•</h2><h3 id="å¯åŠ¨å’Œåœæ­¢">å¯åŠ¨å’Œåœæ­¢</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨</span></span><br><span class="line">brew services start swarm-bee</span><br><span class="line"><span class="meta">#</span><span class="bash"> åœæ­¢</span></span><br><span class="line">brew services stop swarm-bee</span><br><span class="line"><span class="meta">#</span><span class="bash"> é‡å¯</span></span><br><span class="line">brew services restart swarm-bee</span><br></pre></td></tr></table></figure><h3 id="ä¸Beeäº¤äº’ï¼šçŠ¶æ€æ£€æŸ¥">ä¸Beeäº¤äº’ï¼šçŠ¶æ€æ£€æŸ¥</h3><h4 id="ä¸»é¡µ">ä¸»é¡µ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:1633</span><br></pre></td></tr></table></figure><h4 id="æ£€æŸ¥è¿è¡Œæ˜¯å¦æ­£å¸¸">æ£€æŸ¥è¿è¡Œæ˜¯å¦æ­£å¸¸</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s http://localhost:1635/health</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹å½“å‰beeèŠ‚ç‚¹çš„åœ°å€">æŸ¥çœ‹å½“å‰beeèŠ‚ç‚¹çš„åœ°å€</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bee-get-addr</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s localhost:1635/addresses | jq .ethereum</span><br></pre></td></tr></table></figure><h3 id="ä¸Beeäº¤äº’ï¼šæ”¯ç¥¨ä¿¡æ¯">ä¸Beeäº¤äº’ï¼šæ”¯ç¥¨ä¿¡æ¯</h3><h4 id="æŸ¥è¯¢å½“å‰beeèŠ‚ç‚¹çš„ä½™é¢">æŸ¥è¯¢å½“å‰beeèŠ‚ç‚¹çš„ä½™é¢</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:1635/chequebook/balance | jq</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹æ¯ä¸ªèŠ‚ç‚¹ï¼ˆå½“å‰beeèŠ‚ç‚¹è¿æ¥çš„ï¼‰çš„ä½™é¢">æŸ¥çœ‹æ¯ä¸ªèŠ‚ç‚¹ï¼ˆå½“å‰beeèŠ‚ç‚¹è¿æ¥çš„ï¼‰çš„ä½™é¢</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:1635/balances | jq</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹ç»“ç®—ä¿¡æ¯">æŸ¥çœ‹ç»“ç®—ä¿¡æ¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:1635/settlements | jq</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹æ”¯ç¥¨ä¿¡æ¯">æŸ¥çœ‹æ”¯ç¥¨ä¿¡æ¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:1635/chequebook/cheque | jq</span><br></pre></td></tr></table></figure><h4 id="æ”¯ç¥¨å…‘æ¢-åœ°å€æ˜¯ä¸Šä¸€ä¸ªå‘½ä»¤ä¸­æ˜¾ç¤ºçš„åœ°å€">æ”¯ç¥¨å…‘æ¢(åœ°å€æ˜¯ä¸Šä¸€ä¸ªå‘½ä»¤ä¸­æ˜¾ç¤ºçš„åœ°å€)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST http://localhost:1635/chequebook/cashout/d7881307e793e389642ea733451db368c4c9b9e23f188cca659c8674d183a56b</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹æ”¯ç¥¨çš„å…‘æ¢çŠ¶æ€">æŸ¥çœ‹æ”¯ç¥¨çš„å…‘æ¢çŠ¶æ€</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:1635/chequebook/cashout/d7881307e793e389642ea733451db368c4c9b9e23f188cca659c8674d183a56b | jq</span><br></pre></td></tr></table></figure><h4 id="gBZZæç°">gBZZæç°</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST http://localhost:1635/chequebook/withdraw\?amount\=1000 | jq</span><br></pre></td></tr></table></figure><h3 id="ç®¡ç†æ”¯ç¥¨">ç®¡ç†æ”¯ç¥¨</h3><h4 id="ä¸‹è½½å®˜æ–¹çš„è„šæœ¬">ä¸‹è½½å®˜æ–¹çš„è„šæœ¬</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O cashout.sh https://gist.githubusercontent.com/ralph-pichler/3b5ccd7a5c5cd0500e6428752b37e975/raw/7ba05095e0836735f4a648aefe52c584e18e065f/cashout.sh</span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ å¯æ‰§è¡Œæƒé™">æ·»åŠ å¯æ‰§è¡Œæƒé™</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x cashout.sh</span><br></pre></td></tr></table></figure><h4 id="åˆ—å‡ºæ‰€æœ‰çš„æ²¡æœ‰å…‘æ¢çš„æ”¯ç¥¨ä¿¡æ¯">åˆ—å‡ºæ‰€æœ‰çš„æ²¡æœ‰å…‘æ¢çš„æ”¯ç¥¨ä¿¡æ¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./cashout.sh</span><br><span class="line">5fc100feec04e097fcf1469962a20577f3e76f07b193ae5b28156e8c72779865 246000000000</span><br></pre></td></tr></table></figure><h4 id="å½“è¶…è¿‡5BZZæ—¶å…‘æ¢æ‰€æœ‰æ”¯ç¥¨ï¼š">å½“è¶…è¿‡5BZZæ—¶å…‘æ¢æ‰€æœ‰æ”¯ç¥¨ï¼š</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./cashout.sh cashout-all 5</span><br></pre></td></tr></table></figure><h3 id="æ–‡ä»¶è·¯å¾„">æ–‡ä»¶è·¯å¾„</h3><h4 id="æ—¥å¿—æ–‡ä»¶ï¼š">æ—¥å¿—æ–‡ä»¶ï¼š</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f /usr/local/var/log/swarm-bee/bee.log</span><br></pre></td></tr></table></figure><h4 id="é…ç½®æ–‡ä»¶ï¼š">é…ç½®æ–‡ä»¶ï¼š</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/local/etc/swarm-bee/bee.yaml</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> ethereum </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> ethereum </tag>
            
            <tag> swarm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubantuå®‰è£…swarm-bee</title>
      <link href="2021/04/01/blockchain/eth/ubantu%E5%AE%89%E8%A3%85swarm-bee/"/>
      <url>2021/04/01/blockchain/eth/ubantu%E5%AE%89%E8%A3%85swarm-bee/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…swarm-clef">å®‰è£…swarm-clef</h2><h3 id="å®‰è£…">å®‰è£…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/ethersphere/bee-clef/releases/download/v0.4.9/bee-clef_0.4.9_amd64.deb</span><br><span class="line">sudo dpkg -i bee-clef_0.4.9_amd64.deb</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹çŠ¶æ€">æŸ¥çœ‹çŠ¶æ€</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status bee-clef</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æ—¥å¿—">æŸ¥çœ‹æ—¥å¿—</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl -f -u bee-clef.service</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…swarm-bee">å®‰è£…swarm-bee</h2><h3 id="å®‰è£…-v2">å®‰è£…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/ethersphere/bee/releases/download/v0.5.3/bee_0.5.3_amd64.deb</span><br><span class="line">sudo dpkg -i bee_0.5.3_amd64.deb</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹çŠ¶æ€-v2">æŸ¥çœ‹çŠ¶æ€</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status bee</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æ—¥å¿—-v2">æŸ¥çœ‹æ—¥å¿—</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl --lines=100 --follow --unit bee</span><br></pre></td></tr></table></figure><h2 id="é—®é¢˜å¤„ç†">é—®é¢˜å¤„ç†</h2><h3 id="var-lib-bee-statestoreç›®å½•æ²¡æœ‰æƒé™">/var/lib/bee/statestoreç›®å½•æ²¡æœ‰æƒé™</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Apr 01 08:54:29 localhost systemd[1]: Started Bee - Ethereum Swarm node.</span><br><span class="line">Apr 01 08:54:29 localhost bee[2291]: Welcome to the Swarm.... Bzzz Bzzzz Bzzzz</span><br><span class="line">Apr 01 08:54:29 localhost bee[2291]:                 \     /</span><br><span class="line">Apr 01 08:54:29 localhost bee[2291]:             \    o ^ o    /</span><br><span class="line">Apr 01 08:54:29 localhost bee[2291]:               \ (     ) /</span><br><span class="line">Apr 01 08:54:29 localhost bee[2291]:    ____________(%%%%%%%)____________</span><br><span class="line">Apr 01 08:54:29 localhost bee[2291]:   (     /   /  )%%%%%%%(  \   \     )</span><br><span class="line">Apr 01 08:54:29 localhost bee[2291]:   (___/___/__/           \__\___\___)</span><br><span class="line">Apr 01 08:54:29 localhost bee[2291]:      (     /  /(%%%%%%%)\  \     )</span><br><span class="line">Apr 01 08:54:29 localhost bee[2291]:       (__/___/ (%%%%%%%) \___\__)</span><br><span class="line">Apr 01 08:54:29 localhost bee[2291]:               /(       )\</span><br><span class="line">Apr 01 08:54:29 localhost bee[2291]:             /   (%%%%%)   \</span><br><span class="line">Apr 01 08:54:29 localhost bee[2291]:                  (%%%)</span><br><span class="line">Apr 01 08:54:29 localhost bee[2291]:                    !</span><br><span class="line">Apr 01 08:54:29 localhost bee[2291]: time=&quot;2021-04-01T08:54:29Z&quot; level=info msg=&quot;version: 0.5.3-acbd0e2&quot;</span><br><span class="line">Apr 01 08:54:29 localhost bee[2291]: time=&quot;2021-04-01T08:54:29Z&quot; level=info msg=&quot;using swarm network address through clef: 25b2df172cc52d4805503dddcae1be83794e68982c9379dab5f318747ebd566f&quot;</span><br><span class="line">Apr 01 08:54:29 localhost bee[2291]: time=&quot;2021-04-01T08:54:29Z&quot; level=info msg=&quot;swarm public key 0384432c177666fe00f73142a5361b005bff3ebcc68fafe452730a15382ee79e15&quot;</span><br><span class="line">Apr 01 08:54:30 localhost bee[2291]: time=&quot;2021-04-01T08:54:30Z&quot; level=info msg=&quot;pss public key 0281af1ad7e6c9f2062ec25fe2bf889fe38eedb45389b7385298556ae1e5321795&quot;</span><br><span class="line">Apr 01 08:54:30 localhost bee[2291]: time=&quot;2021-04-01T08:54:30Z&quot; level=info msg=&quot;using ethereum address 9f2a5a94269f87af2d5219a0f7554f6d0744e2bb&quot;</span><br><span class="line">Apr 01 08:54:30 localhost bee[2291]: Error: open /var/lib/bee/statestore/LOCK: permission denied</span><br><span class="line">Apr 01 08:54:30 localhost systemd[1]: bee.service: Main process exited, code=exited, status=1/FAILURE</span><br><span class="line">Apr 01 08:54:30 localhost systemd[1]: bee.service: Failed with result &#x27;exit-code&#x27;.</span><br><span class="line">Apr 01 08:54:35 localhost systemd[1]: bee.service: Scheduled restart job, restart counter is at 5.</span><br><span class="line">Apr 01 08:54:35 localhost systemd[1]: Stopped Bee - Ethereum Swarm node.</span><br></pre></td></tr></table></figure><h3 id="æ²¡æœ‰è¶³å¤Ÿçš„ETH">æ²¡æœ‰è¶³å¤Ÿçš„ETH</h3><p>åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶æŠ¥é”™è¯´æ²¡æœ‰è¶³å¤Ÿçš„ETHä½œä¸ºgasè´¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cannot continue until there is sufficient ETH (for Gas) available on 9f2a5a94269f87af2d5219a0f7554f6d0744e2bb</span><br></pre></td></tr></table></figure><h4 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h4><p>æŸ¥çœ‹æ—¥å¿—<code>get your Goerli ETH and Goerli BZZ now via the bzzaar at https://bzz.ethswarm.org/?transaction=buy&amp;amount=10&amp;slippage=30&amp;receiver=0xfb6fe8500a4101196cc80e02f7137a20720fed20</code></p><p>åœ¨<a href="https://goerli-faucet.slock.it/">Goerliæµ‹è¯•ç½‘ç»œ</a>è·å–ä»¥å¤ªå¸</p><h2 id="å¸¸ç”¨å‘½ä»¤è®°å½•">å¸¸ç”¨å‘½ä»¤è®°å½•</h2><h3 id="å¯åŠ¨å’Œåœæ­¢">å¯åŠ¨å’Œåœæ­¢</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åœæ­¢</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é‡å¯</span></span><br><span class="line">sudo systemctl restart bee</span><br></pre></td></tr></table></figure><h3 id="ä¸Beeäº¤äº’ï¼šçŠ¶æ€æ£€æŸ¥">ä¸Beeäº¤äº’ï¼šçŠ¶æ€æ£€æŸ¥</h3><h4 id="ä¸»é¡µ">ä¸»é¡µ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:1633</span><br></pre></td></tr></table></figure><h4 id="æ£€æŸ¥è¿è¡Œæ˜¯å¦æ­£å¸¸">æ£€æŸ¥è¿è¡Œæ˜¯å¦æ­£å¸¸</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s http://localhost:1635/health</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹å½“å‰beeèŠ‚ç‚¹çš„åœ°å€">æŸ¥çœ‹å½“å‰beeèŠ‚ç‚¹çš„åœ°å€</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bee-get-addr</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s localhost:1635/addresses | jq .ethereum</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹é“¾æ¥äº†å¤šå°‘ä¸ªpeer">æŸ¥çœ‹é“¾æ¥äº†å¤šå°‘ä¸ªpeer</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s http://localhost:1635/peers | jq &#x27;.peers | length&#x27;</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹ç½‘ç»œæ‹“æ‰‘">æŸ¥çœ‹ç½‘ç»œæ‹“æ‰‘</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET http://localhost:1635/topology | jq</span><br></pre></td></tr></table></figure><h3 id="ä¸Beeäº¤äº’ï¼šä¸Šä¼ æ–‡ä»¶">ä¸Beeäº¤äº’ï¼šä¸Šä¼ æ–‡ä»¶</h3><h4 id="ä¸Šä¼ æ–‡ä»¶ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªhashå€¼">ä¸Šä¼ æ–‡ä»¶ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªhashå€¼</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> curl -F file=@bee.jpg http://localhost:1633/files</span></span><br><span class="line">&#123;&quot;reference&quot;:&quot;02a03340405f30c1027b885ee39903fb394ba8909e98029dd6c14371437edafc&quot;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --data-binary @bee.jpg  -H &quot;Content-Type: video/jpg&quot; &quot;http://localhost:1633/files?name=bee.jpg&quot;</span><br></pre></td></tr></table></figure><h4 id="ä¸‹è½½æ–‡ä»¶">ä¸‹è½½æ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -OJ http://localhost:1633/files/042d4fe94b946e2cb51196a8c136b8cc335156525bf1ad7e86356c2402291dd4</span><br><span class="line">https://gateway.ethswarm.org/files/042d4fe94b946e2cb51196a8c136b8cc335156525bf1ad7e86356c2402291dd4</span><br></pre></td></tr></table></figure><h4 id="ç‰¹åˆ«æ³¨æ„ï¼šä¸è¦ä¼ ä¸€äº›é‡è¦æ•°æ®åˆ°swarmé™¤éå·²ç»åŠ å¯†ï¼Œå› ä¸ºä¸Šä¼ ä¸Šå»ä¹‹åçš„æ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯å…¬å¼€çš„ï¼Œåªè¦çŸ¥é“hashå°±èƒ½ä¸‹è½½ã€‚">ç‰¹åˆ«æ³¨æ„ï¼šä¸è¦ä¼ ä¸€äº›é‡è¦æ•°æ®åˆ°swarmé™¤éå·²ç»åŠ å¯†ï¼Œå› ä¸ºä¸Šä¼ ä¸Šå»ä¹‹åçš„æ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯å…¬å¼€çš„ï¼Œåªè¦çŸ¥é“hashå°±èƒ½ä¸‹è½½ã€‚</h4><h3 id="ä¸Beeäº¤äº’ï¼šä¸Šä¼ æ–‡ä»¶å¤¹">ä¸Beeäº¤äº’ï¼šä¸Šä¼ æ–‡ä»¶å¤¹</h3><p>æ¯”å¦‚æœ‰ä¸€ä¸ª<a href="https://github.com/guozhe001/hello-swarm.git">å‰ç«¯vueé¡¹ç›®</a>ï¼Œéœ€è¦ä¸Šä¼ åˆ°swarm</p><ol><li>éœ€è¦æŠŠé¡¹ç›®æ„å»ºä¸€ä¸‹<code>npm run build</code></li><li>æŠŠéœ€è¦ä¸Šä¼ çš„æ–‡ä»¶å¤¹<code>dist</code>æ‰“åŒ…</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl \</span><br><span class="line">    -X POST \</span><br><span class="line">    -H &quot;Content-Type: application/x-tar&quot; \</span><br><span class="line">    -H &quot;Swarm-Index-Document: index.html&quot; \</span><br><span class="line">    --data-binary @hello-swarm.tar http://localhost:1633/dirs</span><br></pre></td></tr></table></figure><h3 id="ä¸Beeäº¤äº’ï¼šæ”¯ç¥¨ä¿¡æ¯">ä¸Beeäº¤äº’ï¼šæ”¯ç¥¨ä¿¡æ¯</h3><h4 id="æŸ¥è¯¢å½“å‰beeèŠ‚ç‚¹çš„ä½™é¢">æŸ¥è¯¢å½“å‰beeèŠ‚ç‚¹çš„ä½™é¢</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:1635/chequebook/balance | jq</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹æ¯ä¸ªèŠ‚ç‚¹ï¼ˆå½“å‰beeèŠ‚ç‚¹è¿æ¥çš„ï¼‰çš„ä½™é¢">æŸ¥çœ‹æ¯ä¸ªèŠ‚ç‚¹ï¼ˆå½“å‰beeèŠ‚ç‚¹è¿æ¥çš„ï¼‰çš„ä½™é¢</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:1635/balances | jq</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹ç»“ç®—ä¿¡æ¯">æŸ¥çœ‹ç»“ç®—ä¿¡æ¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:1635/settlements | jq</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹æ”¯ç¥¨ä¿¡æ¯">æŸ¥çœ‹æ”¯ç¥¨ä¿¡æ¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:1635/chequebook/cheque | jq</span><br></pre></td></tr></table></figure><h4 id="æ”¯ç¥¨å…‘æ¢-åœ°å€æ˜¯ä¸Šä¸€ä¸ªå‘½ä»¤ä¸­æ˜¾ç¤ºçš„åœ°å€">æ”¯ç¥¨å…‘æ¢(åœ°å€æ˜¯ä¸Šä¸€ä¸ªå‘½ä»¤ä¸­æ˜¾ç¤ºçš„åœ°å€)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST http://localhost:1635/chequebook/cashout/d7881307e793e389642ea733451db368c4c9b9e23f188cca659c8674d183a56b</span><br></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹æ”¯ç¥¨çš„å…‘æ¢çŠ¶æ€">æŸ¥çœ‹æ”¯ç¥¨çš„å…‘æ¢çŠ¶æ€</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:1635/chequebook/cashout/d7881307e793e389642ea733451db368c4c9b9e23f188cca659c8674d183a56b | jq</span><br></pre></td></tr></table></figure><h4 id="gBZZæç°">gBZZæç°</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST http://localhost:1635/chequebook/withdraw\?amount\=1000 | jq</span><br></pre></td></tr></table></figure><h3 id="ç®¡ç†æ”¯ç¥¨">ç®¡ç†æ”¯ç¥¨</h3><h4 id="ä¸‹è½½å®˜æ–¹çš„è„šæœ¬">ä¸‹è½½å®˜æ–¹çš„è„šæœ¬</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O cashout.sh https://gist.githubusercontent.com/ralph-pichler/3b5ccd7a5c5cd0500e6428752b37e975/raw/7ba05095e0836735f4a648aefe52c584e18e065f/cashout.sh</span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ å¯æ‰§è¡Œæƒé™">æ·»åŠ å¯æ‰§è¡Œæƒé™</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x cashout.sh</span><br></pre></td></tr></table></figure><h4 id="åˆ—å‡ºæ‰€æœ‰çš„æ²¡æœ‰å…‘æ¢çš„æ”¯ç¥¨ä¿¡æ¯">åˆ—å‡ºæ‰€æœ‰çš„æ²¡æœ‰å…‘æ¢çš„æ”¯ç¥¨ä¿¡æ¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./cashout.sh</span><br></pre></td></tr></table></figure><h4 id="å½“è¶…è¿‡5BZZæ—¶å…‘æ¢æ‰€æœ‰æ”¯ç¥¨ï¼š">å½“è¶…è¿‡5BZZæ—¶å…‘æ¢æ‰€æœ‰æ”¯ç¥¨ï¼š</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./cashout.sh cashout-all 5</span><br></pre></td></tr></table></figure><h3 id="æ–‡ä»¶è·¯å¾„">æ–‡ä»¶è·¯å¾„</h3><h4 id="Bee-clef">Bee-clef<a href="https://docs.ethswarm.org/docs/installation/quick-start#bee-clef">#</a></h4><p>Configuration files are stored in <code>/etc/bee-clef/</code></p><p>Key material and other data is stored in <code>/var/lib/bee-clef/</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll /var/lib/bee-clef/</span><br></pre></td></tr></table></figure><h4 id="Bee">Bee<a href="https://docs.ethswarm.org/docs/installation/quick-start#bee">#</a></h4><p>Configuration files are stored in <code>/etc/bee/</code></p><p>State, chunks and other data is stored in <code>/var/lib/bee/</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/bee/bee.yaml</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> ethereum </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> ethereum </tag>
            
            <tag> swarm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="2021/04/01/blockchain/eth/ubantu%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85go-ethereum%E5%AE%A2%E6%88%B7%E7%AB%AF/"/>
      <url>2021/04/01/blockchain/eth/ubantu%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85go-ethereum%E5%AE%A2%E6%88%B7%E7%AB%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="å¦‚ä½•åœ¨ubantuä¸Šå¯åŠ¨go-ethereumå®¢æˆ·ç«¯">å¦‚ä½•åœ¨ubantuä¸Šå¯åŠ¨go-ethereumå®¢æˆ·ç«¯</h1><h2 id="ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡</h2><ul><li>å®‰è£…git:<code>sudo apt install git</code></li><li>å®‰è£…go:<code>sudo apt install golang-go</code></li></ul><h2 id="go-ethereumï¼ˆGethï¼‰å®¢æˆ·ç«¯ä¸‹è½½å’Œç¼–è¯‘">go-ethereumï¼ˆGethï¼‰å®¢æˆ·ç«¯ä¸‹è½½å’Œç¼–è¯‘</h2><h3 id="cloneæºç ï¼š">cloneæºç ï¼š</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://gitee.com/guozhe001/go-ethereum.git</span><br></pre></td></tr></table></figure><h3 id="ä»æºç æ„å»ºgeth">ä»æºç æ„å»ºgeth</h3><p><em>éœ€è¦ç§‘å­¦ä¸Šç½‘</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd go-ethereum</span><br><span class="line">make geth</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br></pre></td><td class="code"><pre><span class="line">env GO111MODULE=on go run build/ci.go install ./cmd/geth</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; /usr/lib/go-1.13/bin/go build -ldflags -X main.gitCommit=54c0d573d75ab9baa239db3f071d6cb4d1ec6aad -X main.gitDate=20210325 -trimpath -v -o /home/guozhe/code/go-ethereum/build/bin/geth ./cmd/geth</span></span><br><span class="line">go: downloading github.com/holiman/uint256 v1.1.1</span><br><span class="line">go: downloading github.com/peterh/liner v1.1.1-0.20190123174540-a2c9a5303de7</span><br><span class="line">go: downloading golang.org/x/sys v0.0.0-20210124154548-22da62e12c0c</span><br><span class="line">go: downloading github.com/edsrzf/mmap-go v1.0.0</span><br><span class="line">go: downloading github.com/prometheus/tsdb v0.7.1</span><br><span class="line">go: downloading github.com/hashicorp/golang-lru v0.5.5-0.20210104140557-80c98217689d</span><br><span class="line">go: downloading github.com/golang/protobuf v1.4.3</span><br><span class="line">go: downloading github.com/holiman/bloomfilter/v2 v2.0.3</span><br><span class="line">go: downloading github.com/rs/cors v1.7.0</span><br><span class="line">go: downloading github.com/tyler-smith/go-bip39 v1.0.1-0.20181017060643-dbb3b84ba2ef</span><br><span class="line">go: extracting github.com/rs/cors v1.7.0</span><br><span class="line">go: downloading github.com/olekukonko/tablewriter v0.0.2-0.20190409134802-7e037d187b0c</span><br><span class="line">go: extracting github.com/edsrzf/mmap-go v1.0.0</span><br><span class="line">go: extracting github.com/holiman/uint256 v1.1.1</span><br><span class="line">go: downloading github.com/karalabe/usb v0.0.0-20190919080040-51dc0efba356</span><br><span class="line">go: extracting github.com/golang/protobuf v1.4.3</span><br><span class="line">go: downloading github.com/golang/snappy v0.0.3-0.20201103224600-674baa8c7fc3</span><br><span class="line">go: extracting golang.org/x/sys v0.0.0-20210124154548-22da62e12c0c</span><br><span class="line">go: downloading github.com/status-im/keycard-go v0.0.0-20190316090335-8537d3370df4</span><br><span class="line">go: extracting github.com/prometheus/tsdb v0.7.1</span><br><span class="line">go: downloading github.com/deckarep/golang-set v0.0.0-20180603214616-504e848d77ea</span><br><span class="line">go: extracting github.com/peterh/liner v1.1.1-0.20190123174540-a2c9a5303de7</span><br><span class="line">go: downloading github.com/rjeczalik/notify v0.9.1</span><br><span class="line">go: extracting github.com/tyler-smith/go-bip39 v1.0.1-0.20181017060643-dbb3b84ba2ef</span><br><span class="line">go: downloading golang.org/x/text v0.3.3</span><br><span class="line">go: extracting github.com/hashicorp/golang-lru v0.5.5-0.20210104140557-80c98217689d</span><br><span class="line">go: downloading github.com/naoina/go-stringutil v0.1.0</span><br><span class="line">go: downloading google.golang.org/protobuf v1.23.0</span><br><span class="line">go: extracting github.com/holiman/bloomfilter/v2 v2.0.3</span><br><span class="line">go: downloading github.com/dop251/goja v0.0.0-20200721192441-a695b0cdd498</span><br><span class="line">go: extracting github.com/olekukonko/tablewriter v0.0.2-0.20190409134802-7e037d187b0c</span><br><span class="line">go: downloading github.com/syndtr/goleveldb v1.0.1-0.20210305035536-64b5b1c73954</span><br><span class="line">go: extracting github.com/karalabe/usb v0.0.0-20190919080040-51dc0efba356</span><br><span class="line">go: downloading github.com/pkg/errors v0.8.1</span><br><span class="line">go: extracting github.com/golang/snappy v0.0.3-0.20201103224600-674baa8c7fc3</span><br><span class="line">go: downloading github.com/mattn/go-isatty v0.0.5-0.20180830101745-3fb116b82035</span><br><span class="line">go: extracting github.com/status-im/keycard-go v0.0.0-20190316090335-8537d3370df4</span><br><span class="line">go: downloading github.com/shirou/gopsutil v2.20.5+incompatible</span><br><span class="line">go: extracting github.com/deckarep/golang-set v0.0.0-20180603214616-504e848d77ea</span><br><span class="line">go: extracting github.com/rjeczalik/notify v0.9.1</span><br><span class="line">go: downloading github.com/davecgh/go-spew v1.1.1</span><br><span class="line">go: extracting github.com/naoina/go-stringutil v0.1.0</span><br><span class="line">go: downloading github.com/huin/goupnp v1.0.1-0.20210310174557-0ca763054c88</span><br><span class="line">go: extracting google.golang.org/protobuf v1.23.0</span><br><span class="line">go: downloading github.com/fatih/color v1.7.0</span><br><span class="line">go: extracting github.com/syndtr/goleveldb v1.0.1-0.20210305035536-64b5b1c73954</span><br><span class="line">go: downloading github.com/graph-gophers/graphql-go v0.0.0-20201113091052-beb923fada29</span><br><span class="line">go: extracting github.com/dop251/goja v0.0.0-20200721192441-a695b0cdd498</span><br><span class="line">go: downloading github.com/jackpal/go-nat-pmp v1.0.2-0.20160603034137-1fa385a6f458</span><br><span class="line">go: extracting github.com/pkg/errors v0.8.1</span><br><span class="line">go: extracting github.com/davecgh/go-spew v1.1.1</span><br><span class="line">go: downloading github.com/jedisct1/go-minisign v0.0.0-20190909160543-45766022959e</span><br><span class="line">go: extracting github.com/mattn/go-isatty v0.0.5-0.20180830101745-3fb116b82035</span><br><span class="line">go: extracting github.com/huin/goupnp v1.0.1-0.20210310174557-0ca763054c88</span><br><span class="line">go: downloading github.com/google/uuid v1.1.5</span><br><span class="line">go: downloading github.com/go-sourcemap/sourcemap v2.1.2+incompatible</span><br><span class="line">go: extracting github.com/shirou/gopsutil v2.20.5+incompatible</span><br><span class="line">go: downloading github.com/go-stack/stack v1.8.0</span><br><span class="line">go: extracting github.com/fatih/color v1.7.0</span><br><span class="line">go: downloading golang.org/x/net v0.0.0-20200822124328-c89045814202</span><br><span class="line">go: extracting github.com/graph-gophers/graphql-go v0.0.0-20201113091052-beb923fada29</span><br><span class="line">go: extracting github.com/jackpal/go-nat-pmp v1.0.2-0.20160603034137-1fa385a6f458</span><br><span class="line">go: downloading gopkg.in/olebedev/go-duktape.v3 v3.0.0-20200619000410-60c24ae608a6</span><br><span class="line">go: extracting github.com/jedisct1/go-minisign v0.0.0-20190909160543-45766022959e</span><br><span class="line">go: downloading github.com/mattn/go-runewidth v0.0.4</span><br><span class="line">go: extracting github.com/go-sourcemap/sourcemap v2.1.2+incompatible</span><br><span class="line">go: downloading github.com/opentracing/opentracing-go v1.1.0</span><br><span class="line">go: extracting golang.org/x/text v0.3.3</span><br><span class="line">go: extracting github.com/google/uuid v1.1.5</span><br><span class="line">go: downloading github.com/gorilla/websocket v1.4.2</span><br><span class="line">go: downloading github.com/VictoriaMetrics/fastcache v1.5.7</span><br><span class="line">go: downloading github.com/dlclark/regexp2 v1.2.0</span><br><span class="line">go: downloading github.com/influxdata/influxdb v1.8.3</span><br><span class="line">go: extracting github.com/go-stack/stack v1.8.0</span><br><span class="line">go: extracting golang.org/x/net v0.0.0-20200822124328-c89045814202</span><br><span class="line">go: downloading golang.org/x/sync v0.0.0-20200317015054-43a5402ce75a</span><br><span class="line">go: extracting gopkg.in/olebedev/go-duktape.v3 v3.0.0-20200619000410-60c24ae608a6</span><br><span class="line">go: extracting github.com/VictoriaMetrics/fastcache v1.5.7</span><br><span class="line">go: downloading github.com/cespare/xxhash v1.1.0</span><br><span class="line">go: extracting github.com/opentracing/opentracing-go v1.1.0</span><br><span class="line">go: extracting github.com/gorilla/websocket v1.4.2</span><br><span class="line">go: extracting github.com/dlclark/regexp2 v1.2.0</span><br><span class="line">go: extracting github.com/mattn/go-runewidth v0.0.4</span><br><span class="line">go: extracting golang.org/x/sync v0.0.0-20200317015054-43a5402ce75a</span><br><span class="line">go: extracting github.com/cespare/xxhash v1.1.0</span><br><span class="line">go: downloading github.com/cespare/xxhash/v2 v2.1.1</span><br><span class="line">go: extracting github.com/cespare/xxhash/v2 v2.1.1</span><br><span class="line">go: extracting github.com/influxdata/influxdb v1.8.3</span><br><span class="line">go: finding gopkg.in/urfave/cli.v1 v1.20.0</span><br><span class="line">go: finding github.com/peterh/liner v1.1.1-0.20190123174540-a2c9a5303de7</span><br><span class="line">go: finding github.com/dop251/goja v0.0.0-20200721192441-a695b0cdd498</span><br><span class="line">go: finding github.com/VictoriaMetrics/fastcache v1.5.7</span><br><span class="line">go: finding github.com/davecgh/go-spew v1.1.1</span><br><span class="line">go: finding github.com/deckarep/golang-set v0.0.0-20180603214616-504e848d77ea</span><br><span class="line">go: finding github.com/jedisct1/go-minisign v0.0.0-20190909160543-45766022959e</span><br><span class="line">go: finding github.com/go-stack/stack v1.8.0</span><br><span class="line">go: finding github.com/edsrzf/mmap-go v1.0.0</span><br><span class="line">go: finding github.com/fjl/memsize v0.0.0-20190710130421-bcb5799ab5e5</span><br><span class="line">go: finding github.com/shirou/gopsutil v2.20.5+incompatible</span><br><span class="line">go: finding github.com/naoina/toml v0.1.2-0.20170918210437-9fafd6967416</span><br><span class="line">go: finding github.com/mattn/go-colorable v0.1.0</span><br><span class="line">go: finding github.com/mattn/go-isatty v0.0.5-0.20180830101745-3fb116b82035</span><br><span class="line">go: finding github.com/holiman/bloomfilter/v2 v2.0.3</span><br><span class="line">go: finding github.com/fatih/color v1.7.0</span><br><span class="line">go: finding github.com/golang/protobuf v1.4.3</span><br><span class="line">go: finding github.com/golang/snappy v0.0.3-0.20201103224600-674baa8c7fc3</span><br><span class="line">go: finding github.com/cespare/xxhash/v2 v2.1.1</span><br><span class="line">go: finding github.com/syndtr/goleveldb v1.0.1-0.20210305035536-64b5b1c73954</span><br><span class="line">go: finding github.com/olekukonko/tablewriter v0.0.2-0.20190409134802-7e037d187b0c</span><br><span class="line">go: finding github.com/hashicorp/golang-lru v0.5.5-0.20210104140557-80c98217689d</span><br><span class="line">go: finding github.com/naoina/go-stringutil v0.1.0</span><br><span class="line">go: finding github.com/dlclark/regexp2 v1.2.0</span><br><span class="line">go: finding github.com/prometheus/tsdb v0.7.1</span><br><span class="line">go: finding golang.org/x/sys v0.0.0-20210124154548-22da62e12c0c</span><br><span class="line">go: finding github.com/google/uuid v1.1.5</span><br><span class="line">go: finding github.com/karalabe/usb v0.0.0-20190919080040-51dc0efba356</span><br><span class="line">go: finding github.com/rjeczalik/notify v0.9.1</span><br><span class="line">go: finding github.com/mattn/go-runewidth v0.0.4</span><br><span class="line">go: finding github.com/go-sourcemap/sourcemap v2.1.2+incompatible</span><br><span class="line">go: finding github.com/pkg/errors v0.8.1</span><br><span class="line">go: finding golang.org/x/text v0.3.3</span><br><span class="line">go: finding github.com/holiman/uint256 v1.1.1</span><br><span class="line">go: finding github.com/gballet/go-libpcsclite v0.0.0-20190607065134-2772fd86a8ff</span><br><span class="line">go: finding github.com/gorilla/websocket v1.4.2</span><br><span class="line">go: finding github.com/status-im/keycard-go v0.0.0-20190316090335-8537d3370df4</span><br><span class="line">go: finding github.com/rs/cors v1.7.0</span><br><span class="line">go: finding github.com/tyler-smith/go-bip39 v1.0.1-0.20181017060643-dbb3b84ba2ef</span><br><span class="line">go: finding google.golang.org/protobuf v1.23.0</span><br><span class="line">go: finding github.com/huin/goupnp v1.0.1-0.20210310174557-0ca763054c88</span><br><span class="line">go: finding github.com/jackpal/go-nat-pmp v1.0.2-0.20160603034137-1fa385a6f458</span><br><span class="line">go: finding github.com/influxdata/influxdb v1.8.3</span><br><span class="line">go: finding github.com/graph-gophers/graphql-go v0.0.0-20201113091052-beb923fada29</span><br><span class="line">go: finding golang.org/x/time v0.0.0-20190308202827-9d24e82272b4</span><br><span class="line">go: finding gopkg.in/olebedev/go-duktape.v3 v3.0.0-20200619000410-60c24ae608a6</span><br><span class="line">go: finding golang.org/x/net v0.0.0-20200822124328-c89045814202</span><br><span class="line">go: finding golang.org/x/sync v0.0.0-20200317015054-43a5402ce75a</span><br><span class="line">go: finding github.com/opentracing/opentracing-go v1.1.0</span><br><span class="line">unicode</span><br><span class="line">unicode/utf8</span><br><span class="line">vendor/golang.org/x/crypto/cryptobyte/asn1</span><br><span class="line">crypto/internal/subtle</span><br><span class="line">math/bits</span><br><span class="line">golang.org/x/sys/internal/unsafeheader</span><br><span class="line">container/list</span><br><span class="line">internal/nettrace</span><br><span class="line">vendor/golang.org/x/crypto/internal/subtle</span><br><span class="line">encoding</span><br><span class="line">golang.org/x/net/html/atom</span><br><span class="line">crypto/subtle</span><br><span class="line">runtime/internal/sys</span><br><span class="line">golang.org/x/text/encoding/internal/identifier</span><br><span class="line">golang.org/x/text/internal/utf8internal</span><br><span class="line">runtime/cgo</span><br><span class="line">google.golang.org/protobuf/internal/flags</span><br><span class="line">unicode/utf16</span><br><span class="line">runtime/internal/atomic</span><br><span class="line">container/ring</span><br><span class="line">vendor/golang.org/x/crypto/curve25519</span><br><span class="line">internal/race</span><br><span class="line">internal/cpu</span><br><span class="line">google.golang.org/protobuf/internal/fieldnum</span><br><span class="line">sync/atomic</span><br><span class="line">google.golang.org/protobuf/internal/genname</span><br><span class="line">github.com/ethereum/go-ethereum/internal/web3ext</span><br><span class="line">runtime/internal/math</span><br><span class="line">internal/testlog</span><br><span class="line">google.golang.org/protobuf/internal/set</span><br><span class="line">internal/bytealg</span><br><span class="line">math</span><br><span class="line">runtime</span><br><span class="line">internal/reflectlite</span><br><span class="line">sync</span><br><span class="line">google.golang.org/protobuf/internal/pragma</span><br><span class="line">internal/singleflight</span><br><span class="line">math/rand</span><br><span class="line">errors</span><br><span class="line">sort</span><br><span class="line">internal/oserror</span><br><span class="line">io</span><br><span class="line">github.com/ethereum/go-ethereum/common/bitutil</span><br><span class="line">github.com/hashicorp/golang-lru/simplelru</span><br><span class="line">vendor/golang.org/x/net/dns/dnsmessage</span><br><span class="line">strconv</span><br><span class="line">syscall</span><br><span class="line">container/heap</span><br><span class="line">golang.org/x/text/internal/tag</span><br><span class="line">bytes</span><br><span class="line">hash</span><br><span class="line">github.com/ethereum/go-ethereum/ethdb</span><br><span class="line">crypto/internal/randutil</span><br><span class="line">strings</span><br><span class="line">text/tabwriter</span><br><span class="line">github.com/go-sourcemap/sourcemap/internal/base64vlq</span><br><span class="line">crypto/hmac</span><br><span class="line">hash/fnv</span><br><span class="line">hash/crc32</span><br><span class="line">golang.org/x/crypto/pbkdf2</span><br><span class="line">vendor/golang.org/x/crypto/hkdf</span><br><span class="line">golang.org/x/crypto/hkdf</span><br><span class="line">crypto/rc4</span><br><span class="line">github.com/dop251/goja/token</span><br><span class="line">crypto</span><br><span class="line">reflect</span><br><span class="line">golang.org/x/crypto/ripemd160</span><br><span class="line">github.com/syndtr/goleveldb/leveldb/comparer</span><br><span class="line">golang.org/x/text/transform</span><br><span class="line">vendor/golang.org/x/text/transform</span><br><span class="line">bufio</span><br><span class="line">path</span><br><span class="line">github.com/influxdata/influxdb/pkg/escape</span><br><span class="line">encoding/base32</span><br><span class="line">html</span><br><span class="line">regexp/syntax</span><br><span class="line">golang.org/x/text/runes</span><br><span class="line">golang.org/x/text/encoding</span><br><span class="line">golang.org/x/text/encoding/internal</span><br><span class="line">golang.org/x/text/encoding/unicode</span><br><span class="line">golang.org/x/text/encoding/charmap</span><br><span class="line">golang.org/x/text/encoding/japanese</span><br><span class="line">golang.org/x/text/encoding/traditionalchinese</span><br><span class="line">golang.org/x/text/encoding/korean</span><br><span class="line">golang.org/x/text/encoding/simplifiedchinese</span><br><span class="line">github.com/ethereum/go-ethereum/common/fdlimit</span><br><span class="line">internal/syscall/unix</span><br><span class="line">github.com/mattn/go-isatty</span><br><span class="line">time</span><br><span class="line">regexp</span><br><span class="line">context</span><br><span class="line">github.com/naoina/toml/ast</span><br><span class="line">github.com/ethereum/go-ethereum/common/mclock</span><br><span class="line">internal/poll</span><br><span class="line">github.com/ethereum/go-ethereum/common/prque</span><br><span class="line">golang.org/x/sync/errgroup</span><br><span class="line">os</span><br><span class="line">internal/fmtsort</span><br><span class="line">encoding/binary</span><br><span class="line">crypto/md5</span><br><span class="line">github.com/cespare/xxhash/v2</span><br><span class="line">encoding/base64</span><br><span class="line">crypto/sha1</span><br><span class="line">crypto/sha256</span><br><span class="line">golang.org/x/crypto/sha3</span><br><span class="line">crypto/cipher</span><br><span class="line">vendor/golang.org/x/crypto/poly1305</span><br><span class="line">crypto/sha512</span><br><span class="line">crypto/ed25519/internal/edwards25519</span><br><span class="line">github.com/golang/snappy</span><br><span class="line">vendor/golang.org/x/sys/cpu</span><br><span class="line">golang.org/x/sys/unix</span><br><span class="line">fmt</span><br><span class="line">runtime/debug</span><br><span class="line">path/filepath</span><br><span class="line">github.com/mattn/go-runewidth</span><br><span class="line">os/signal</span><br><span class="line">google.golang.org/protobuf/internal/detrand</span><br><span class="line">github.com/mattn/go-colorable</span><br><span class="line">net</span><br><span class="line">encoding/pem</span><br><span class="line">crypto/aes</span><br><span class="line">crypto/des</span><br><span class="line">vendor/golang.org/x/crypto/internal/chacha20</span><br><span class="line">golang.org/x/crypto/scrypt</span><br><span class="line">io/ioutil</span><br><span class="line">os/exec</span><br><span class="line">vendor/golang.org/x/crypto/chacha20poly1305</span><br><span class="line">golang.org/x/sys/cpu</span><br><span class="line">database/sql/driver</span><br><span class="line">encoding/json</span><br><span class="line">encoding/hex</span><br><span class="line">github.com/ethereum/go-ethereum/event</span><br><span class="line">github.com/go-stack/stack</span><br><span class="line">log</span><br><span class="line">net/url</span><br><span class="line">github.com/VictoriaMetrics/fastcache</span><br><span class="line">github.com/syndtr/goleveldb/leveldb/util</span><br><span class="line">math/big</span><br><span class="line">github.com/syndtr/goleveldb/leveldb/storage</span><br><span class="line">encoding/csv</span><br><span class="line">github.com/pkg/errors</span><br><span class="line">compress/flate</span><br><span class="line">github.com/hashicorp/golang-lru</span><br><span class="line">vendor/golang.org/x/net/http2/hpack</span><br><span class="line">encoding/gob</span><br><span class="line">mime</span><br><span class="line">mime/quotedprintable</span><br><span class="line">flag</span><br><span class="line">vendor/golang.org/x/text/unicode/norm</span><br><span class="line">net/http/internal</span><br><span class="line">github.com/peterh/liner</span><br><span class="line">vendor/golang.org/x/text/unicode/bidi</span><br><span class="line">github.com/olekukonko/tablewriter</span><br><span class="line">github.com/ethereum/go-ethereum/crypto/blake2b</span><br><span class="line">encoding/xml</span><br><span class="line">golang.org/x/net/html</span><br><span class="line">golang.org/x/text/internal/language</span><br><span class="line">github.com/syndtr/goleveldb/leveldb/cache</span><br><span class="line">github.com/syndtr/goleveldb/leveldb/filter</span><br><span class="line">github.com/status-im/keycard-go/derivationpath</span><br><span class="line">golang.org/x/text/unicode/norm</span><br><span class="line">google.golang.org/protobuf/internal/errors</span><br><span class="line">go/token</span><br><span class="line">google.golang.org/protobuf/internal/version</span><br><span class="line">github.com/karalabe/usb</span><br><span class="line">google.golang.org/protobuf/encoding/protowire</span><br><span class="line">github.com/davecgh/go-spew/spew</span><br><span class="line">github.com/syndtr/goleveldb/leveldb/errors</span><br><span class="line">github.com/shirou/gopsutil/internal/common</span><br><span class="line">google.golang.org/protobuf/reflect/protoreflect</span><br><span class="line">github.com/tyler-smith/go-bip39/wordlists</span><br><span class="line">github.com/syndtr/goleveldb/leveldb/iterator</span><br><span class="line">github.com/syndtr/goleveldb/leveldb/journal</span><br><span class="line">github.com/syndtr/goleveldb/leveldb/opt</span><br><span class="line">compress/gzip</span><br><span class="line">github.com/fjl/memsize</span><br><span class="line">vendor/golang.org/x/text/secure/bidirule</span><br><span class="line">text/template/parse</span><br><span class="line">runtime/trace</span><br><span class="line">os/user</span><br><span class="line">github.com/ethereum/go-ethereum/console/prompt</span><br><span class="line">golang.org/x/time/rate</span><br><span class="line">runtime/pprof</span><br><span class="line">github.com/ethereum/go-ethereum/eth/tracers/internal/tracers</span><br><span class="line">golang.org/x/text/internal/language/compact</span><br><span class="line">go/scanner</span><br><span class="line">github.com/graph-gophers/graphql-go/errors</span><br><span class="line">github.com/syndtr/goleveldb/leveldb/memdb</span><br><span class="line">github.com/syndtr/goleveldb/leveldb/table</span><br><span class="line">testing</span><br><span class="line">text/scanner</span><br><span class="line">github.com/graph-gophers/graphql-go/log</span><br><span class="line">github.com/opentracing/opentracing-go/log</span><br><span class="line">github.com/rjeczalik/notify</span><br><span class="line">github.com/prometheus/tsdb/fileutil</span><br><span class="line">github.com/edsrzf/mmap-go</span><br><span class="line">go/ast</span><br><span class="line">google.golang.org/protobuf/reflect/protoregistry</span><br><span class="line">golang.org/x/text/language</span><br><span class="line">google.golang.org/protobuf/internal/strs</span><br><span class="line">google.golang.org/protobuf/internal/mapsort</span><br><span class="line">google.golang.org/protobuf/internal/fieldsort</span><br><span class="line">github.com/huin/goupnp/scpd</span><br><span class="line">vendor/golang.org/x/net/idna</span><br><span class="line">google.golang.org/protobuf/runtime/protoiface</span><br><span class="line">google.golang.org/protobuf/internal/descfmt</span><br><span class="line">github.com/deckarep/golang-set</span><br><span class="line">github.com/shirou/gopsutil/cpu</span><br><span class="line">google.golang.org/protobuf/internal/encoding/text</span><br><span class="line">google.golang.org/protobuf/internal/descopts</span><br><span class="line">github.com/graph-gophers/graphql-go/internal/common</span><br><span class="line">github.com/influxdata/influxdb/models</span><br><span class="line">github.com/dlclark/regexp2/syntax</span><br><span class="line">github.com/syndtr/goleveldb/leveldb</span><br><span class="line">github.com/dop251/goja/file</span><br><span class="line">github.com/go-sourcemap/sourcemap</span><br><span class="line">github.com/fatih/color</span><br><span class="line">github.com/ethereum/go-ethereum/internal/jsre/deps</span><br><span class="line">google.golang.org/protobuf/internal/encoding/messageset</span><br><span class="line">github.com/naoina/go-stringutil</span><br><span class="line">github.com/shirou/gopsutil/mem</span><br><span class="line">text/template</span><br><span class="line">github.com/ethereum/go-ethereum/common/hexutil</span><br><span class="line">crypto/elliptic</span><br><span class="line">encoding/asn1</span><br><span class="line">crypto/rand</span><br><span class="line">github.com/ethereum/go-ethereum/common/math</span><br><span class="line">github.com/ethereum/go-ethereum/rlp</span><br><span class="line">crypto/dsa</span><br><span class="line">github.com/holiman/uint256</span><br><span class="line">google.golang.org/protobuf/proto</span><br><span class="line">github.com/graph-gophers/graphql-go/internal/schema</span><br><span class="line">github.com/graph-gophers/graphql-go/internal/query</span><br><span class="line">golang.org/x/text/encoding/htmlindex</span><br><span class="line">github.com/dop251/goja/ast</span><br><span class="line">golang.org/x/text/internal</span><br><span class="line">go/parser</span><br><span class="line">go/printer</span><br><span class="line">google.golang.org/protobuf/internal/encoding/defval</span><br><span class="line">golang.org/x/text/internal/colltab</span><br><span class="line">github.com/holiman/bloomfilter/v2</span><br><span class="line">crypto/ed25519</span><br><span class="line">crypto/rsa</span><br><span class="line">github.com/ethereum/go-ethereum/crypto/bn256/cloudflare</span><br><span class="line">github.com/tyler-smith/go-bip39</span><br><span class="line">golang.org/x/net/html/charset</span><br><span class="line">github.com/graph-gophers/graphql-go/internal/exec/packer</span><br><span class="line">github.com/graph-gophers/graphql-go/introspection</span><br><span class="line">github.com/graph-gophers/graphql-go/internal/validation</span><br><span class="line">github.com/dop251/goja/parser</span><br><span class="line">golang.org/x/text/cases</span><br><span class="line">golang.org/x/crypto/ed25519</span><br><span class="line">crypto/x509/pkix</span><br><span class="line">github.com/ethereum/go-ethereum/common</span><br><span class="line">vendor/golang.org/x/crypto/cryptobyte</span><br><span class="line">github.com/naoina/toml</span><br><span class="line">gopkg.in/urfave/cli.v1</span><br><span class="line">html/template</span><br><span class="line">crypto/ecdsa</span><br><span class="line">github.com/ethereum/go-ethereum/crypto/secp256k1</span><br><span class="line">github.com/jedisct1/go-minisign</span><br><span class="line">github.com/graph-gophers/graphql-go/internal/exec/resolvable</span><br><span class="line">github.com/dlclark/regexp2</span><br><span class="line">golang.org/x/text/collate</span><br><span class="line">go/format</span><br><span class="line">github.com/ethereum/go-ethereum/les/vflux</span><br><span class="line">google.golang.org/protobuf/encoding/prototext</span><br><span class="line">google.golang.org/protobuf/internal/filedesc</span><br><span class="line">github.com/graph-gophers/graphql-go/internal/exec/selected</span><br><span class="line">github.com/ethereum/go-ethereum/ethdb/memorydb</span><br><span class="line">github.com/ethereum/go-ethereum/crypto/bls12381</span><br><span class="line">github.com/ethereum/go-ethereum/crypto/bn256</span><br><span class="line">google.golang.org/protobuf/internal/encoding/tag</span><br><span class="line">google.golang.org/protobuf/internal/impl</span><br><span class="line">log/syslog</span><br><span class="line">vendor/golang.org/x/net/http/httpproxy</span><br><span class="line">github.com/ethereum/go-ethereum/p2p/enr</span><br><span class="line">github.com/jackpal/go-nat-pmp</span><br><span class="line">github.com/ethereum/go-ethereum/p2p/netutil</span><br><span class="line">net/textproto</span><br><span class="line">github.com/gballet/go-libpcsclite</span><br><span class="line">github.com/google/uuid</span><br><span class="line">crypto/x509</span><br><span class="line">gopkg.in/olebedev/go-duktape.v3</span><br><span class="line">github.com/ethereum/go-ethereum/log</span><br><span class="line">vendor/golang.org/x/net/http/httpguts</span><br><span class="line">mime/multipart</span><br><span class="line">github.com/ethereum/go-ethereum/signer/storage</span><br><span class="line">github.com/ethereum/go-ethereum/les/flowcontrol</span><br><span class="line">github.com/ethereum/go-ethereum/metrics</span><br><span class="line">crypto/tls</span><br><span class="line">github.com/ethereum/go-ethereum/ethdb/leveldb</span><br><span class="line">google.golang.org/protobuf/internal/filetype</span><br><span class="line">github.com/dop251/goja</span><br><span class="line">google.golang.org/protobuf/runtime/protoimpl</span><br><span class="line">github.com/golang/protobuf/proto</span><br><span class="line">google.golang.org/protobuf/types/descriptorpb</span><br><span class="line">net/http/httptrace</span><br><span class="line">net/http</span><br><span class="line">github.com/golang/protobuf/protoc-gen-go/descriptor</span><br><span class="line">github.com/ethereum/go-ethereum/accounts/usbwallet/trezor</span><br><span class="line">github.com/fjl/memsize/memsizeui</span><br><span class="line">github.com/ethereum/go-ethereum/metrics/prometheus</span><br><span class="line">github.com/rs/cors</span><br><span class="line">expvar</span><br><span class="line">github.com/influxdata/influxdb/client</span><br><span class="line">net/http/pprof</span><br><span class="line">github.com/huin/goupnp/soap</span><br><span class="line">github.com/huin/goupnp/httpu</span><br><span class="line">github.com/opentracing/opentracing-go</span><br><span class="line">github.com/gorilla/websocket</span><br><span class="line">github.com/opentracing/opentracing-go/ext</span><br><span class="line">github.com/ethereum/go-ethereum/metrics/exp</span><br><span class="line">github.com/graph-gophers/graphql-go/trace</span><br><span class="line">github.com/huin/goupnp/ssdp</span><br><span class="line">github.com/ethereum/go-ethereum/metrics/influxdb</span><br><span class="line">github.com/graph-gophers/graphql-go/internal/exec</span><br><span class="line">github.com/ethereum/go-ethereum/internal/debug</span><br><span class="line">github.com/huin/goupnp</span><br><span class="line">github.com/graph-gophers/graphql-go</span><br><span class="line">github.com/ethereum/go-ethereum/rpc</span><br><span class="line">github.com/huin/goupnp/dcps/internetgateway1</span><br><span class="line">github.com/huin/goupnp/dcps/internetgateway2</span><br><span class="line">github.com/ethereum/go-ethereum/internal/jsre</span><br><span class="line">github.com/ethereum/go-ethereum/p2p/nat</span><br><span class="line">github.com/ethereum/go-ethereum/crypto</span><br><span class="line">github.com/ethereum/go-ethereum/crypto/ecies</span><br><span class="line">github.com/ethereum/go-ethereum/p2p/enode</span><br><span class="line">github.com/ethereum/go-ethereum/params</span><br><span class="line">github.com/ethereum/go-ethereum/accounts/abi</span><br><span class="line">github.com/ethereum/go-ethereum/p2p/rlpx</span><br><span class="line">github.com/ethereum/go-ethereum/internal/flags</span><br><span class="line">github.com/ethereum/go-ethereum/core/types</span><br><span class="line">github.com/ethereum/go-ethereum/p2p/discover/v4wire</span><br><span class="line">github.com/ethereum/go-ethereum/les/utils</span><br><span class="line">github.com/ethereum/go-ethereum/p2p/dnsdisc</span><br><span class="line">github.com/ethereum/go-ethereum/p2p/nodestate</span><br><span class="line">github.com/ethereum/go-ethereum/p2p/discover/v5wire</span><br><span class="line">github.com/ethereum/go-ethereum/les/vflux/client</span><br><span class="line">github.com/ethereum/go-ethereum/les/vflux/server</span><br><span class="line">github.com/ethereum/go-ethereum</span><br><span class="line">github.com/ethereum/go-ethereum/eth/gasprice</span><br><span class="line">github.com/ethereum/go-ethereum/core/forkid</span><br><span class="line">github.com/ethereum/go-ethereum/core/bloombits</span><br><span class="line">github.com/ethereum/go-ethereum/core/rawdb</span><br><span class="line">github.com/ethereum/go-ethereum/core/vm</span><br><span class="line">github.com/ethereum/go-ethereum/p2p/discover</span><br><span class="line">github.com/ethereum/go-ethereum/accounts</span><br><span class="line">github.com/ethereum/go-ethereum/ethclient</span><br><span class="line">github.com/ethereum/go-ethereum/accounts/scwallet</span><br><span class="line">github.com/ethereum/go-ethereum/accounts/keystore</span><br><span class="line">github.com/ethereum/go-ethereum/accounts/usbwallet</span><br><span class="line">github.com/ethereum/go-ethereum/p2p</span><br><span class="line">github.com/ethereum/go-ethereum/console</span><br><span class="line">github.com/ethereum/go-ethereum/trie</span><br><span class="line">github.com/ethereum/go-ethereum/core/state/snapshot</span><br><span class="line">github.com/ethereum/go-ethereum/core/state</span><br><span class="line">github.com/ethereum/go-ethereum/consensus</span><br><span class="line">github.com/ethereum/go-ethereum/consensus/misc</span><br><span class="line">github.com/ethereum/go-ethereum/core/state/pruner</span><br><span class="line">github.com/ethereum/go-ethereum/consensus/clique</span><br><span class="line">github.com/ethereum/go-ethereum/consensus/ethash</span><br><span class="line">github.com/ethereum/go-ethereum/core</span><br><span class="line">github.com/ethereum/go-ethereum/eth/filters</span><br><span class="line">github.com/ethereum/go-ethereum/eth/protocols/eth</span><br><span class="line">github.com/ethereum/go-ethereum/eth/fetcher</span><br><span class="line">github.com/ethereum/go-ethereum/light</span><br><span class="line">github.com/ethereum/go-ethereum/eth/protocols/snap</span><br><span class="line">github.com/ethereum/go-ethereum/eth/downloader</span><br><span class="line">github.com/ethereum/go-ethereum/miner</span><br><span class="line">github.com/ethereum/go-ethereum/internal/ethapi</span><br><span class="line">github.com/ethereum/go-ethereum/signer/core</span><br><span class="line">github.com/ethereum/go-ethereum/accounts/external</span><br><span class="line">github.com/ethereum/go-ethereum/node</span><br><span class="line">github.com/ethereum/go-ethereum/accounts/abi/bind</span><br><span class="line">github.com/ethereum/go-ethereum/contracts/checkpointoracle/contract</span><br><span class="line">github.com/ethereum/go-ethereum/accounts/abi/bind/backends</span><br><span class="line">github.com/ethereum/go-ethereum/contracts/checkpointoracle</span><br><span class="line">github.com/ethereum/go-ethereum/eth/ethconfig</span><br><span class="line">github.com/ethereum/go-ethereum/graphql</span><br><span class="line">github.com/ethereum/go-ethereum/les/checkpointoracle</span><br><span class="line">github.com/ethereum/go-ethereum/eth</span><br><span class="line">github.com/ethereum/go-ethereum/les</span><br><span class="line">github.com/ethereum/go-ethereum/ethstats</span><br><span class="line">github.com/ethereum/go-ethereum/eth/tracers</span><br><span class="line">github.com/ethereum/go-ethereum/cmd/utils</span><br><span class="line">github.com/ethereum/go-ethereum/cmd/geth</span><br><span class="line">Done building.</span><br><span class="line">Run &quot;./build/bin/geth&quot; to launch geth.</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é€šè¿‡æŸ¥çœ‹gethç‰ˆæœ¬æ¥ç¡®è®¤gethæ˜¯å¦å·²ç»å®‰è£…æ­£ç¡®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./build/bin/geth version</span></span><br><span class="line">Geth</span><br><span class="line">Version: 1.10.2-unstable</span><br><span class="line">Git Commit: 54c0d573d75ab9baa239db3f071d6cb4d1ec6aad</span><br><span class="line">Git Commit Date: 20210325</span><br><span class="line">Architecture: amd64</span><br><span class="line">Go Version: go1.13.8</span><br><span class="line">Operating System: linux</span><br><span class="line">GOPATH=</span><br><span class="line">GOROOT=go</span><br></pre></td></tr></table></figure><h2 id="é¦–æ¬¡åŒæ­¥ä»¥å¤ªåŠåŒºå—æ•°æ®">é¦–æ¬¡åŒæ­¥ä»¥å¤ªåŠåŒºå—æ•°æ®</h2><p>æŸ¥çœ‹go-ethereumçš„readmeæ–‡æ¡£ï¼Œé»˜è®¤æ˜¯fastæ–¹å¼åŒæ­¥æ•°æ®ï¼Œç›´æ¥è¿è¡Œ<code>geth console</code>å³å¯ï¼Œå› ä¸ºæ•°æ®æ¯”è¾ƒå¤§æˆ‘å•ç‹¬æŒ‚è½½äº†ä¸€ä¸ªç£ç›˜ï¼Œæ‰€ä»¥åˆ¶å®šäº†æ•°æ®å­˜æ”¾çš„ç›®å½•<code>--datadic /data/ethereum/node</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./build/bin/geth console --datadir /data/ethereum/node/</span></span><br><span class="line">INFO [03-27|16:25:39.409] Starting Geth on Ethereum mainnet... </span><br><span class="line">INFO [03-27|16:25:39.409] Bumping default cache on mainnet         provided=1024 updated=4096</span><br><span class="line">INFO [03-27|16:25:39.411] Maximum peer count                       ETH=50 LES=0 total=50</span><br><span class="line">INFO [03-27|16:25:39.411] Smartcard socket not found, disabling    err=&quot;stat /run/pcscd/pcscd.comm: no such file or directory&quot;</span><br><span class="line">INFO [03-27|16:25:39.412] Set global gas cap                       cap=25000000</span><br><span class="line">INFO [03-27|16:25:39.412] Allocated trie memory caches             clean=614.00MiB dirty=1024.00MiB</span><br><span class="line">INFO [03-27|16:25:39.412] Allocated cache and file handles         database=/data/ethereum/node/geth/chaindata cache=2.00GiB handles=524288</span><br><span class="line">INFO [03-27|16:25:39.504] Opened ancient database                  database=/data/ethereum/node/geth/chaindata/ancient readonly=false</span><br><span class="line">INFO [03-27|16:25:39.504] Writing default main-net genesis block </span><br><span class="line">INFO [03-27|16:25:39.645] Persisted trie from memory database      nodes=12356 size=1.78MiB time=48.710818ms gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B</span><br><span class="line">INFO [03-27|16:25:39.645] Initialised chain configuration          config=&quot;&#123;ChainID: 1 Homestead: 1150000 DAO: 1920000 DAOSupport: true EIP150: 2463000 EIP155: 2675000 EIP158: 2675000 Byzantium: 4370000 Constantinople: 7280000 Petersburg: 7280000 Istanbul: 9069000, Muir Glacier: 9200000, Berlin: 12244000, YOLO v3: &lt;nil&gt;, Engine: ethash&#125;&quot;</span><br><span class="line">INFO [03-27|16:25:39.645] Disk storage enabled for ethash caches   dir=/data/ethereum/node/geth/ethash count=3</span><br><span class="line">INFO [03-27|16:25:39.645] Disk storage enabled for ethash DAGs     dir=/home/guozhe/.ethash            count=2</span><br><span class="line">INFO [03-27|16:25:39.646] Initialising Ethereum protocol           network=1 dbversion=&lt;nil&gt;</span><br><span class="line">WARN [03-27|16:25:39.646] Upgrade blockchain database version      from=&lt;nil&gt; to=8</span><br><span class="line">INFO [03-27|16:25:39.646] Loaded most recent local header          number=0 hash=&quot;d4e567â€¦cb8fa3&quot; td=17179869184 age=51y11mo3w</span><br><span class="line">INFO [03-27|16:25:39.646] Loaded most recent local full block      number=0 hash=&quot;d4e567â€¦cb8fa3&quot; td=17179869184 age=51y11mo3w</span><br><span class="line">INFO [03-27|16:25:39.646] Loaded most recent local fast block      number=0 hash=&quot;d4e567â€¦cb8fa3&quot; td=17179869184 age=51y11mo3w</span><br><span class="line">WARN [03-27|16:25:39.646] Failed to load snapshot, regenerating    err=&quot;missing or corrupted snapshot&quot;</span><br><span class="line">INFO [03-27|16:25:39.646] Rebuilding state snapshot </span><br><span class="line">INFO [03-27|16:25:39.646] Deleted state snapshot leftovers         kind=accounts wiped=0 elapsed=&quot;47.755Âµs&quot;</span><br><span class="line">INFO [03-27|16:25:39.647] Deleted state snapshot leftovers         kind=storage  wiped=0 elapsed=&quot;17.809Âµs&quot;</span><br><span class="line">INFO [03-27|16:25:39.647] Compacting snapshot account area  </span><br><span class="line">INFO [03-27|16:25:39.647] Regenerated local transaction journal    transactions=0 accounts=0</span><br><span class="line">INFO [03-27|16:25:39.650] Wiper running, state snapshotting paused accounts=0 slots=0 storage=0.00B elapsed=&quot;361.935Âµs&quot;</span><br><span class="line">INFO [03-27|16:25:39.676] Allocated fast sync bloom                size=2.00GiB</span><br><span class="line">WARN [03-27|16:25:39.677] Error reading unclean shutdown markers   error=&quot;leveldb: not found&quot;</span><br><span class="line">INFO [03-27|16:25:39.677] Starting peer-to-peer node               instance=Geth/v1.10.2-unstable-54c0d573-20210325/linux-amd64/go1.13.8</span><br><span class="line">INFO [03-27|16:25:39.741] Initialized state bloom                  items=12356 errorrate=0.000 elapsed=64.036ms</span><br><span class="line">INFO [03-27|16:25:39.817] New local node record                    seq=1 id=0d81eb9b177ba542 ip=127.0.0.1 udp=30303 tcp=30303</span><br><span class="line">INFO [03-27|16:25:39.817] Started P2P networking                   self=enode://dbb9a7d3a1ca59a200c1fa920b2cc467c342182b0f818c491028da1c564391f2cb91f0ce88bb7826264e609aa407dd8544224c0dd3d1a3f6bc449fd063dbdde7@127.0.0.1:30303</span><br><span class="line">INFO [03-27|16:25:39.818] IPC endpoint opened                      url=/data/ethereum/node/geth.ipc</span><br><span class="line">WARN [03-27|16:25:39.858] Served eth_coinbase                      reqid=3 t=&quot;12.338Âµs&quot; err=&quot;etherbase must be explicitly specified&quot;</span><br><span class="line">Welcome to the Geth JavaScript console!</span><br><span class="line"></span><br><span class="line">instance: Geth/v1.10.2-unstable-54c0d573-20210325/linux-amd64/go1.13.8</span><br><span class="line">at block: 0 (Thu Jan 01 1970 08:00:00 GMT+0800 (CST))</span><br><span class="line"> datadir: /data/ethereum/node</span><br><span class="line"> modules: admin:1.0 debug:1.0 eth:1.0 ethash:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0</span><br><span class="line"></span><br><span class="line">To exit, press ctrl-d</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> INFO [03-27|16:25:39.924] Compacting snapshot storage area</span>  </span><br><span class="line">INFO [03-27|16:25:39.924] Compacted snapshot area in database      elapsed=277.624ms</span><br><span class="line">INFO [03-27|16:25:39.924] Resuming state snapshot generation       root=&quot;d7f897â€¦0f0544&quot; accounts=0 slots=0 storage=0.00B elapsed=&quot;9.119Âµs&quot;</span><br><span class="line">INFO [03-27|16:25:39.996] Generated state snapshot                 accounts=8893 slots=0 storage=409.64KiB elapsed=71.524ms</span><br><span class="line">INFO [03-27|16:25:46.015] New local node record                    seq=2 id=0d81eb9b177ba542 ip=115.171.250.78 udp=52360 tcp=30303</span><br><span class="line">INFO [03-27|16:25:50.847] Looking for peers                        peercount=0 tried=8 static=0</span><br><span class="line">INFO [03-27|16:25:56.124] Block synchronisation started </span><br><span class="line">INFO [03-27|16:26:01.068] Looking for peers                        peercount=0 tried=4 static=0</span><br><span class="line">WARN [03-27|16:26:05.414] Dropping unsynced node during sync       id=46e8efbdd811cf2e conn=dyndial addr=207.148.3.150:30303 type=Geth/v1.9.25-stable-...</span><br><span class="line">INFO [03-27|16:26:11.068] Looking for peers                        peercount=2 tried=15 static=0</span><br><span class="line">WARN [03-27|16:26:12.135] Dropping unsynced node during sync       id=53455744030e83cc conn=dyndial addr=108.61.176.254:30303 type=Geth/v1.9.25-stable-...</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹-data-ethereum-nodeç›®å½•">æŸ¥çœ‹<code>/data/ethereum/node</code>ç›®å½•</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ll</span></span><br><span class="line">æ€»ç”¨é‡ 1</span><br><span class="line">drwxrwxrwx 1 root root 472 3æœˆ  27 16:28 geth/</span><br><span class="line">srwxrwxrwx 1 root root   1 3æœˆ  27 16:25 geth.ipc=</span><br><span class="line">drwxrwxrwx 1 root root   0 3æœˆ  27 16:25 keystore/</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="è°ƒç”¨gethçš„json-rpcæ¥å£">è°ƒç”¨gethçš„json-rpcæ¥å£</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST -H &quot;Content-Type: application/json&quot; --data &#x27;&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;web3_clientVersion&quot;,&quot;params&quot;:[],&quot;id&quot;:1&#125;&#x27; http://localhost:8545</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="2021/04/01/blockchain/eth/ubantu%E7%B3%BB%E7%BB%9F%E4%B8%8Bnvidia%E6%98%BE%E5%8D%A1%E8%B6%85%E9%A2%91%E8%AE%BE%E7%BD%AE/"/>
      <url>2021/04/01/blockchain/eth/ubantu%E7%B3%BB%E7%BB%9F%E4%B8%8Bnvidia%E6%98%BE%E5%8D%A1%E8%B6%85%E9%A2%91%E8%AE%BE%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<p>ubantuç³»ç»Ÿä¸‹nvidiaæ˜¾å¡è¶…é¢‘è®¾ç½®</p><p>æŸ¥çœ‹æ˜¾å¡ä¿¡æ¯ï¼š<br><code>nvidia-smi</code></p><p>è®¾ç½®ç¬¬ä¸€ä¸ªæ˜¾å¡çš„åŠŸç‡ä¸º125wï¼š<br><code>sudo nvidia-smi -i 0 -pl 125</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="2021/04/01/blockchain/eth/ubantu%E5%A6%82%E4%BD%95%E6%8C%82%E8%BD%BD%E7%A1%AC%E7%9B%98/"/>
      <url>2021/04/01/blockchain/eth/ubantu%E5%A6%82%E4%BD%95%E6%8C%82%E8%BD%BD%E7%A1%AC%E7%9B%98/</url>
      
        <content type="html"><![CDATA[<h1 id="ubantuå¦‚ä½•æŒ‚è½½ç¡¬ç›˜ï¼š">ubantuå¦‚ä½•æŒ‚è½½ç¡¬ç›˜ï¼š</h1><h2 id="æŸ¥çœ‹å·²ç»æŒ‚è½½äº†å“ªäº›">æŸ¥çœ‹å·²ç»æŒ‚è½½äº†å“ªäº›</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> df -l</span></span><br><span class="line">æ–‡ä»¶ç³»ç»Ÿ           1K-å—     å·²ç”¨      å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹</span><br><span class="line">udev            16362980        0  16362980    0% /dev</span><br><span class="line">tmpfs            3285100     2364   3282736    1% /run</span><br><span class="line">/dev/nvme0n1p7 200537360 18016188 172264740   10% /</span><br><span class="line">tmpfs           16425488   408624  16016864    3% /dev/shm</span><br><span class="line">tmpfs               5120        4      5116    1% /run/lock</span><br><span class="line">tmpfs           16425488        0  16425488    0% /sys/fs/cgroup</span><br><span class="line">/dev/loop0         56832    56832         0  100% /snap/core18/1988</span><br><span class="line">/dev/loop1         66432    66432         0  100% /snap/gtk-common-themes/1514</span><br><span class="line">/dev/loop2         33152    33152         0  100% /snap/snapd/11402</span><br><span class="line">/dev/loop3         52352    52352         0  100% /snap/snap-store/518</span><br><span class="line">/dev/loop4         31872    31872         0  100% /snap/snapd/11036</span><br><span class="line">/dev/loop5        224256   224256         0  100% /snap/gnome-3-34-1804/66</span><br><span class="line">/dev/nvme0n1p1     98304    33555     64749   35% /boot/efi</span><br><span class="line">tmpfs            3285096       20   3285076    1% /run/user/125</span><br><span class="line">tmpfs            3285096       92   3285004    1% /run/user/1000</span><br><span class="line">/dev/loop6        101632   101632         0  100% /snap/core/10908</span><br><span class="line">/dev/loop7        435968   435968         0  100% /snap/pycharm-community/233</span><br><span class="line">/dev/loop8        680192   680192         0  100% /snap/intellij-idea-community/289</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹æœ‰å“ªäº›">æŸ¥çœ‹æœ‰å“ªäº›</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo fdisk -l</span></span><br><span class="line">Disk /dev/loop0ï¼š55.48 MiBï¼Œ58159104 å­—èŠ‚ï¼Œ113592 ä¸ªæ‰‡åŒº</span><br><span class="line">å•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚</span><br><span class="line">æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line">I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/loop1ï¼š64.79 MiBï¼Œ67915776 å­—èŠ‚ï¼Œ132648 ä¸ªæ‰‡åŒº</span><br><span class="line">å•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚</span><br><span class="line">æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line">I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/loop2ï¼š32.28 MiBï¼Œ33841152 å­—èŠ‚ï¼Œ66096 ä¸ªæ‰‡åŒº</span><br><span class="line">å•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚</span><br><span class="line">æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line">I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/loop3ï¼š51.4 MiBï¼Œ53522432 å­—èŠ‚ï¼Œ104536 ä¸ªæ‰‡åŒº</span><br><span class="line">å•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚</span><br><span class="line">æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line">I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/loop4ï¼š31.9 MiBï¼Œ32595968 å­—èŠ‚ï¼Œ63664 ä¸ªæ‰‡åŒº</span><br><span class="line">å•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚</span><br><span class="line">æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line">I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/loop5ï¼š218.102 MiBï¼Œ229629952 å­—èŠ‚ï¼Œ448496 ä¸ªæ‰‡åŒº</span><br><span class="line">å•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚</span><br><span class="line">æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line">I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/loop6ï¼š99.22 MiBï¼Œ104030208 å­—èŠ‚ï¼Œ203184 ä¸ªæ‰‡åŒº</span><br><span class="line">å•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚</span><br><span class="line">æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line">I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/loop7ï¼š425.67 MiBï¼Œ446328832 å­—èŠ‚ï¼Œ871736 ä¸ªæ‰‡åŒº</span><br><span class="line">å•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚</span><br><span class="line">æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line">I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/nvme0n1ï¼š931.53 GiBï¼Œ1000204886016 å­—èŠ‚ï¼Œ1953525168 ä¸ªæ‰‡åŒº</span><br><span class="line">Disk model: WDC WDS100T2B0C-00PXH0                  </span><br><span class="line">å•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚</span><br><span class="line">æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line">I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line">ç£ç›˜æ ‡ç­¾ç±»å‹ï¼šgpt</span><br><span class="line">ç£ç›˜æ ‡è¯†ç¬¦ï¼šC12B6754-9D12-4F54-92FA-086CE249C548</span><br><span class="line"></span><br><span class="line">è®¾å¤‡                 èµ·ç‚¹       æœ«å°¾      æ‰‡åŒº   å¤§å° ç±»å‹</span><br><span class="line">/dev/nvme0n1p1       2048     206847    204800   100M EFI ç³»ç»Ÿ</span><br><span class="line">/dev/nvme0n1p2     206848     239615     32768    16M Microsoft ä¿ç•™</span><br><span class="line">/dev/nvme0n1p3     239616  408449302 408209687 194.7G Microsoft åŸºæœ¬æ•°æ®</span><br><span class="line">/dev/nvme0n1p4  408451072  409597951   1146880   560M Windows æ¢å¤ç¯å¢ƒ</span><br><span class="line">/dev/nvme0n1p5  409597952 1134321663 724723712 345.6G Microsoft åŸºæœ¬æ•°æ®</span><br><span class="line">/dev/nvme0n1p6 1134321664 1543921663 409600000 195.3G Microsoft åŸºæœ¬æ•°æ®</span><br><span class="line">/dev/nvme0n1p7 1543921664 1953523711 409602048 195.3G Linux æ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/sdaï¼š7.28 TiBï¼Œ8001563222016 å­—èŠ‚ï¼Œ15628053168 ä¸ªæ‰‡åŒº</span><br><span class="line">Disk model: HGST HUS728T8TAL</span><br><span class="line">å•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚</span><br><span class="line">æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 4096 å­—èŠ‚</span><br><span class="line">I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š4096 å­—èŠ‚ / 4096 å­—èŠ‚</span><br><span class="line">ç£ç›˜æ ‡ç­¾ç±»å‹ï¼šgpt</span><br><span class="line">ç£ç›˜æ ‡è¯†ç¬¦ï¼šF654D976-A27E-49D1-B0FD-5DCB3914D51D</span><br><span class="line"></span><br><span class="line">è®¾å¤‡             èµ·ç‚¹        æœ«å°¾       æ‰‡åŒº  å¤§å° ç±»å‹</span><br><span class="line">/dev/sda1          34       32767      32734   16M Microsoft ä¿ç•™</span><br><span class="line">/dev/sda2       32768  4096032767 4096000000  1.9T Microsoft åŸºæœ¬æ•°æ®</span><br><span class="line">/dev/sda3  4096032768  8192032767 4096000000  1.9T Microsoft åŸºæœ¬æ•°æ®</span><br><span class="line">/dev/sda4  8192032768 15628050431 7436017664  3.5T Microsoft åŸºæœ¬æ•°æ®</span><br><span class="line"></span><br><span class="line">åˆ†åŒº 1 æœªèµ·å§‹äºç‰©ç†æ‰‡åŒºè¾¹ç•Œã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disk /dev/loop8ï¼š664.17 MiBï¼Œ696426496 å­—èŠ‚ï¼Œ1360208 ä¸ªæ‰‡åŒº</span><br><span class="line">å•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚</span><br><span class="line">æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line">I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹æƒ³è¦æŒ‚è½½çš„ç¡¬ç›˜çš„uuid">æŸ¥çœ‹æƒ³è¦æŒ‚è½½çš„ç¡¬ç›˜çš„uuid</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> lsblk -f</span></span><br><span class="line">NAME        FSTYPE   LABEL    UUID                                 FSAVAIL FSUSE% MOUNTPOINT</span><br><span class="line">loop0       squashfs                                                     0   100% /snap/core18/1988</span><br><span class="line">loop1       squashfs                                                     0   100% /snap/gtk-common-themes/1514</span><br><span class="line">loop2       squashfs                                                     0   100% /snap/snapd/11402</span><br><span class="line">loop3       squashfs                                                     0   100% /snap/snap-store/518</span><br><span class="line">loop4       squashfs                                                     0   100% /snap/snapd/11036</span><br><span class="line">loop5       squashfs                                                     0   100% /snap/gnome-3-34-1804/66</span><br><span class="line">loop6       squashfs                                                     0   100% /snap/core/10908</span><br><span class="line">loop7       squashfs                                                     0   100% /snap/pycharm-community/233</span><br><span class="line">loop8       squashfs                                                     0   100% /snap/intellij-idea-community/289</span><br><span class="line">sda                                                                               </span><br><span class="line">â”œâ”€sda1                                                                            </span><br><span class="line">â”œâ”€sda2      ntfs     æ•°æ®     38C09128C090ECFE                                    </span><br><span class="line">â”œâ”€sda3      ntfs     æ–°åŠ å·   2A9E99709E993573                                    </span><br><span class="line">â””â”€sda4      ntfs     æ–°åŠ å·   C25E9EB25E9E9F2B                                    </span><br><span class="line">nvme0n1                                                                           </span><br><span class="line">â”œâ”€nvme0n1p1 vfat              2E15-C03F                              63.2M    34% /boot/efi</span><br><span class="line">â”œâ”€nvme0n1p2                                                                       </span><br><span class="line">â”œâ”€nvme0n1p3 ntfs              A4AA2056AA2026F0                                    </span><br><span class="line">â”œâ”€nvme0n1p4 ntfs              FE347AD2347A8D81                                    </span><br><span class="line">â”œâ”€nvme0n1p5 ntfs     å¨±ä¹     E848526348523114                                    </span><br><span class="line">â”œâ”€nvme0n1p6 ntfs     å­¦ä¹ å·¥ä½œ EA1E592A1E58F155                                    </span><br><span class="line">â””â”€nvme0n1p7 ext4              12354a11-9bf9-4882-a202-3e3e675b3158  164.3G     9% /</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¯”å¦‚æˆ‘æƒ³è¦æŒ‚è½½<code>/dev/sda4</code>çš„uuidä¸º<code>C25E9EB25E9E9F2B</code></p><h2 id="ä¿®æ”¹-etc-fstabè¿›è¡ŒæŒ‚è½½">ä¿®æ”¹<code>/etc/fstab</code>è¿›è¡ŒæŒ‚è½½</h2><p>å‚è€ƒï¼š<a href="https://blog.51cto.com/13570193/2070157">https://blog.51cto.com/13570193/2070157</a></p><p>æ¯”å¦‚æˆ‘çš„æ·»åŠ äº†ä¸€è¡Œï¼š<code>UUID=C25E9EB25E9E9F2B /data ntfs defaults 0 0</code></p><h2 id="é‡å¯">é‡å¯</h2><h2 id="éªŒè¯">éªŒè¯</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> df -h</span></span><br><span class="line">æ–‡ä»¶ç³»ç»Ÿ        å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹</span><br><span class="line">udev             16G     0   16G    0% /dev</span><br><span class="line">tmpfs           3.2G  2.3M  3.2G    1% /run</span><br><span class="line">/dev/nvme0n1p7  192G   18G  165G   10% /</span><br><span class="line">tmpfs            16G     0   16G    0% /dev/shm</span><br><span class="line">tmpfs           5.0M  4.0K  5.0M    1% /run/lock</span><br><span class="line">tmpfs            16G     0   16G    0% /sys/fs/cgroup</span><br><span class="line">/dev/loop0       56M   56M     0  100% /snap/core18/1988</span><br><span class="line">/dev/loop1      100M  100M     0  100% /snap/core/10908</span><br><span class="line">/dev/loop2       33M   33M     0  100% /snap/snapd/11402</span><br><span class="line">/dev/loop4       52M   52M     0  100% /snap/snap-store/518</span><br><span class="line">/dev/loop3      426M  426M     0  100% /snap/pycharm-community/233</span><br><span class="line">/dev/loop5       32M   32M     0  100% /snap/snapd/11036</span><br><span class="line">/dev/loop6       65M   65M     0  100% /snap/gtk-common-themes/1514</span><br><span class="line">/dev/loop7      219M  219M     0  100% /snap/gnome-3-34-1804/66</span><br><span class="line">/dev/loop8      665M  665M     0  100% /snap/intellij-idea-community/289</span><br><span class="line">/dev/nvme0n1p1   96M   33M   64M   35% /boot/efi</span><br><span class="line">/dev/sda4       3.5T  211M  3.5T    1% /data</span><br><span class="line">tmpfs           3.2G   16K  3.2G    1% /run/user/125</span><br><span class="line">tmpfs           3.2G   24K  3.2G    1% /run/user/1000</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>è¯»ä¹¦ç¬”è®°-ã€Šä½ çš„ç¬¬ä¸€æœ¬ä¿é™©æŒ‡å—ã€‹</title>
      <link href="2021/04/01/others/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-%E3%80%8A%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E6%9C%AC%E4%BF%9D%E9%99%A9%E6%8C%87%E5%8D%97%E3%80%8B/"/>
      <url>2021/04/01/others/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-%E3%80%8A%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E6%9C%AC%E4%BF%9D%E9%99%A9%E6%8C%87%E5%8D%97%E3%80%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="1ã€ç ´é™¤è¯¯ä¼šï¼Œæˆ‘ä»¬çœŸçš„äº†è§£ä¿é™©å—">1ã€ç ´é™¤è¯¯ä¼šï¼Œæˆ‘ä»¬çœŸçš„äº†è§£ä¿é™©å—</h1><h2 id="æˆ‘ä»¬å¯¹ä¿é™©çš„è®¤è¯†ï¼šç†èµ”ä¼¼ä¹ç‰¹åˆ«éš¾">æˆ‘ä»¬å¯¹ä¿é™©çš„è®¤è¯†ï¼šç†èµ”ä¼¼ä¹ç‰¹åˆ«éš¾</h2><ul><li>å‘ç”Ÿçš„äº‹æ•…ä¸åœ¨ä¿é™©èŒƒå›´ï¼Œä¸èƒ½èµ”ä»˜</li><li>å®¢æˆ·æœªå¦‚å®å‘ŠçŸ¥è‡ªèº«æƒ…å†µï¼Œä¸èƒ½èµ”ä»˜</li><li>æ¡æ¬¾è¿‡äºä¸¥è‹›ï¼Œä¸èƒ½èµ”ä»˜</li></ul><h2 id="ä»€ä¹ˆæ˜¯æ ¸ä¿å¸ˆä¸å¥åº·å‘ŠçŸ¥">ä»€ä¹ˆæ˜¯æ ¸ä¿å¸ˆä¸å¥åº·å‘ŠçŸ¥</h2><h3 id="å¥åº·å‘ŠçŸ¥">å¥åº·å‘ŠçŸ¥</h3><h4 id="å¥åº·å‘ŠçŸ¥é—®è¯¢">å¥åº·å‘ŠçŸ¥é—®è¯¢</h4><ul><li>å¥åº·é—®è¯¢ï¼šæ˜¯å¦æœ‰ç–¾ç—…æˆ–ä½é™¢è®°å½•ç­‰</li><li>èŒä¸šé—®è¯¢ï¼šæ˜¯å¦ä»äº‹é«˜å±è¡Œä¸š</li><li>ç”Ÿæ´»é—®è¯¢ï¼šæ˜¯å¦å¸çƒŸã€é…—é…’ï¼ˆé…’ç²¾ä¾èµ–ï¼‰ï¼Œæ˜¯å¦æœ‰æé™è¿åŠ¨ç­‰å±é™©æ€§é«˜çš„ä¸šä½™çˆ±å¥½ç­‰</li></ul><h4 id="æ ¸ä¿ç»“è®º">æ ¸ä¿ç»“è®º</h4><ul><li>ç»“è®ºä¸€ï¼šæ ‡å‡†ä½“ã€‚æ­å–œï¼Œä½ å®Œç¾åœ°ç¬¦åˆå¥åº·å‘ŠçŸ¥ä¸­çš„æ‰€æœ‰è¦æ±‚ï¼Œå¯ä»¥ç›´æ¥æŠ•ä¿ï¼Œæ— é¡»åšè¡¥å……å‘ŠçŸ¥</li><li>ç»“è®ºäºŒï¼šæ¬¡æ ‡å‡†ä½“ã€‚å¯èƒ½æœ‰å°‘æ•°å‡ æ¡ä¸ç¬¦åˆå¥åº·å‘ŠçŸ¥ï¼Œä½†è€ƒè™‘åˆ°åŸºæœ¬åœ¨å¯æ¥å—èŒƒå›´å†…ï¼Œä¿é™©å…¬å¸å°±â€œå‹‰ä¸ºå…¶éš¾â€åœ°å…è®¸ä½ æŠ•ä¿äº†<ul><li>æ¥å—é™¤å¤–è´£ä»»ï¼šä¿é™©å…¬å¸è€ƒè™‘åˆ°æŠ•ä¿äººå½“å‰çš„å¥åº·çŠ¶å†µï¼Œå°†ç‰¹å®šç–¾ç—…æ’é™¤åœ¨è´£ä»»èŒƒå›´ä¹‹å¤–</li><li>å¢åŠ ä¿è´¹</li></ul></li><li>ç»“è®ºä¸‰ï¼šå»¶æœŸã€‚ä¿é™©å…¬å¸è€ƒè™‘åˆ°ä½ çš„æŸä¸ªå¥åº·é—®é¢˜ï¼Œæš‚ä¸æ¥å—ä½ çš„æœ¬æ¬¡æŠ•ä¿ç”³è¯·ï¼Œå»ºè®®è¿‡ä¸€æ®µæ—¶é—´å†æ¥è¯•è¯•</li><li>ç»“è®ºå››ï¼šæ‹’ä¿</li></ul><h4 id="åˆ°åº•æ€ä¹ˆå¥åº·å‘ŠçŸ¥ï¼Ÿ">åˆ°åº•æ€ä¹ˆå¥åº·å‘ŠçŸ¥ï¼Ÿ</h4><p>è¯´å®è¯ï¼Œå½“ä¿é™©å…¬å¸æŠŠé‡ç–¾é™©ã€åŒ»ç–—é™©è¿™ç±»ä¿éšœå‹äº§å“æ”¾åˆ°ç½‘ä¸Šé”€å”®çš„æ—¶å€™ï¼Œå…¶å®åªæ˜¯æƒ³å–ç»™æ ‡å‡†ä½“å®¢æˆ·ã€‚</p><p>è‡³äºæ¬¡æ ‡å‡†ä½“å’Œéæ ‡å‡†ä½“å®¢æˆ·ï¼Œå¯¹ä¸èµ·ï¼Œè¿™ç±»äº§å“ä¸æ˜¯ä¸ºä»–ä»¬å‡†å¤‡çš„ã€‚</p><h2 id="ä¹°ä¿é™©ä¸€å®šè¦è¿”æœ¬å—ï¼Ÿ">ä¹°ä¿é™©ä¸€å®šè¦è¿”æœ¬å—ï¼Ÿ</h2><h3 id="å½“ä½ æƒ³è¦è¿”è¿˜çš„æ—¶å€™ï¼Œä½ åˆ°åº•æƒ³è¦ä»€ä¹ˆ">å½“ä½ æƒ³è¦è¿”è¿˜çš„æ—¶å€™ï¼Œä½ åˆ°åº•æƒ³è¦ä»€ä¹ˆ</h3><ul><li>ç¬¬ä¸€ï¼Œæ‹¿å›ä¿è´¹ã€‚å¦‚æœæ²¡æœ‰å‘ç”Ÿä¿é™©äº‹æ•…ï¼Œè¯·æŠŠæˆ‘äº¤çš„ä¿è´¹è¿˜ç»™æˆ‘</li><li>ç¬¬äºŒï¼Œè·å¾—èµ”å¿ã€‚æ—¢ç„¶æˆ‘è´­ä¹°äº†ä¿é™©ï¼Œæ€»å½’æ˜¯å¸Œæœ›èƒ½æ´¾ä¸Šç”¨åœºã€‚</li></ul><h3 id="è¿½æ±‚ä¿è´¹è¿”è¿˜ï¼Œåˆ‡è«å› å°å¤±å¤§">è¿½æ±‚ä¿è´¹è¿”è¿˜ï¼Œåˆ‡è«å› å°å¤±å¤§</h3><ul><li>åæœ¬ä¿é™©ä¸€èˆ¬ä¼šæ¯”ä¸åæœ¬ï¼ˆæ¶ˆè´¹å‹ï¼‰ä¿é™©æ›´è´µ</li><li>åœ¨è¿½æ±‚ä¿è´¹è¿”è¿˜æ—¶ï¼Œæƒ³ä¸€ä¸‹è‡ªå·±è´­ä¹°ä¿é™©çš„åˆå¿ƒï¼šå½“åˆä½ è¯´è¦ä¹°ä¿é™©çš„æ—¶å€™ï¼Œåˆ°åº•æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿä¿è´¹å’Œä¿é¢ï¼Œå“ªä¸ªæ‰æ˜¯ä½ çš„åˆå¿ƒï¼Ÿ</li></ul><h3 id="éè¦æ‹¿åˆ°ä¿è´¹ï¼Œä¸å¦¨è¿™æ ·é€‰æ‹©">éè¦æ‹¿åˆ°ä¿è´¹ï¼Œä¸å¦¨è¿™æ ·é€‰æ‹©</h3><ul><li>æå‰ç»™ä»˜å‹é‡ç–¾é™©ï¼šèº«æ‚£é‡ç–¾æˆ–ä¸å¹¸èº«æ•…ï¼Œå“ªä¸ªæå‰å‘ç”Ÿï¼Œéƒ½å¯ç»™ä»˜èµ”å¿ï¼Œä½†æ˜¯ä»£ä»·ä¾ç„¶æ˜¯æ”¯ä»˜æ›´å¤šä¿è´¹</li><li>ä¿éšœç»ˆèº«åªæ˜¯ä¿é™©äº§å“çš„ä¸€ä¸ªåŠŸèƒ½è®¾ç½®ï¼Œè€Œä¸åº”è¢«è§†ä¸ºä¸€ä¸ªä¼˜ç‚¹ï¼Œå› ä¸ºä½ ä¸ºæ­¤æ”¯ä»˜äº†æ›´å¤šçš„ä¿è´¹</li></ul><h2 id="ä¿é™©å…¬å¸ä¼šä¸ä¼šç ´äº§">ä¿é™©å…¬å¸ä¼šä¸ä¼šç ´äº§</h2><h3 id="ä¿é™©å…¬å¸ä¼šç ´äº§ï¼Œå´ä¸ä¼šå®Œè›‹">ä¿é™©å…¬å¸ä¼šç ´äº§ï¼Œå´ä¸ä¼šå®Œè›‹</h3><ul><li>ä¿é™©å…¬å¸ç ´äº§æ—¶ï¼Œäººå¯¿ä¿é™©åˆåŒåŠè´£ä»»å‡†å¤‡é‡‘ï¼Œå¿…é¡»è½¬è®©ç»™å…¶ä»–ç»è¥æœ‰äººå¯¿ä¿é™©ä¸šåŠ¡çš„ä¿é™©å…¬å¸</li><li>ä¿é™©ä¿éšœåŸºé‡‘ï¼šæ¥æºæ˜¯81å®¶è´¢é™©å…¬å¸å’Œ88å®¶å¯¿é™©å…¬å¸ï¼Œä¿é™©å…¬å¸æ¯å¹´éœ€å‘å…¶ç¼´çº³ä¸€å®šæ•°é¢çš„èµ„é‡‘ï¼Œè¿™ä¹Ÿæ˜¯è¢«å†™è¿›ã€Šä¿é™©æ³•ã€‹çš„å¼ºåˆ¶æ€§è¦æ±‚ã€‚</li></ul><h3 id="æ”¿åºœåœ¨åšçš„ï¼Œæ˜¯æ‹¼å‘½é¢„é˜²ä¿é™©å…¬å¸ç ´äº§">æ”¿åºœåœ¨åšçš„ï¼Œæ˜¯æ‹¼å‘½é¢„é˜²ä¿é™©å…¬å¸ç ´äº§</h3><p>ä¸€å®¶ä¿é™©å…¬å¸ä»è®¡åˆ’æˆç«‹ä¹‹åˆï¼Œå°±ä¸å¾—ä¸æ¥å—ä¸€ç³»åˆ—ç›‘ç®¡ã€‚è¿™äº›ç›‘ç®¡æªæ–½å’Œè§„å®šå°±åƒä¸€é“é“é˜²ç«å¢™ï¼Œç¡®ä¿å…¬å¸åœ¨æ­£ç¡®è½¨é“ä¸Šè¿è½¬ã€‚</p><ul><li>ç¬¬ä¸€é“é˜²ç«å¢™æ˜¯æé«˜çš„å…¬å¸è®¾ç«‹æ ‡å‡†</li><li>ç¬¬äºŒé“é˜²ç«å¢™æ˜¯å…¨é¢ç§‘å­¦çš„å¿ä»˜èƒ½åŠ›ç›‘ç®¡<ul><li>æ‰€è°“å¿ä»˜èƒ½åŠ›ï¼ŒæŒ‡çš„æ˜¯å½“ä¿é™©å…¬å¸é­é‡æç«¯æƒ…å†µæ—¶ï¼Œæ˜¯å¦ä»æœ‰èƒ½åŠ›å±¥è¡Œèµ”ä»˜è´£ä»»ã€‚æ¯ä¸ªå¹´åº¦å’Œå­£åº¦ï¼Œä¿é™©å…¬å¸çš„ç²¾ç®—ã€è´¢åŠ¡ç­‰ä¸“ä¸šäººå£«éƒ½ä¼šç¼–åˆ¶å…¬å¸å¿ä»˜èƒ½åŠ›æŠ¥å‘Šï¼Œæ¶‰åŠä¸€ç³»åˆ—æ•°å­¦æ¨¡å‹å’Œå‹åŠ›æµ‹è¯•</li><li>æ ¹æ®å¿ä»˜èƒ½åŠ›æƒ…å†µï¼Œä¿é™©å…¬å¸ä¼šå¾—åˆ°ä»ä¼˜åˆ°å·®çš„è¯„çº§ï¼ŒåŒ…æ‹¬Aã€Bã€Cã€D4ä¸ªç­‰çº§ã€‚è¯„çº§å¯ä»¥åœ¨ä¿é™©å…¬å¸å®˜ç½‘çš„â€œå…¬å¼€ä¿¡æ¯æŸ¥è¯¢â€æ ç›®æŸ¥åˆ°ï¼Œæˆ‘ä»¬å°†å®ƒè§†ä¸ºåˆ¤æ–­ä¿é™©å…¬å¸æ˜¯å¦â€œé è°±â€çš„ä¸€ä¸ªé‡è¦æ ‡å¿—ã€‚é•¿æœŸæ¥çœ‹ï¼Œåªè¦è¯„çº§ç¨³å®šåœ¨Aå’ŒBçš„å…¬å¸ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æ”¾å¿ƒè´­ä¹°å…¶äº§å“</li></ul></li><li>ç¬¬ä¸‰é“é˜²ç«å¢™æ˜¯é¢‘ç‡é«˜ã€å¼ºåº¦å¤§çš„ç°åœºæ£€æŸ¥<ul><li>ç›‘ç®¡éƒ¨é—¨ä¼šéšæ—¶è¿›é©»ä¿é™©å…¬å¸æ€»å…¬å¸å’Œåˆ†å…¬å¸ï¼Œé€šè¿‡è°ƒå–æ¡£æ¡ˆã€æŸ¥è¯¢ç³»ç»Ÿç­‰æ–¹å¼å®æ–½ç°åœºæ£€æŸ¥</li></ul></li><li>å½“ç„¶ï¼Œä¸Šè¿°çš„é˜²ç«å¢™è™½å¥½ï¼Œå¦‚æœå› ä¸ºè´ªæ±¡è…è´¥è€Œè®©ä¿é™©å…¬å¸è’™æ··è¿‡å…³ï¼Œè¿™æ˜¯æˆ‘ä»¬æ— æ³•æ”¹å˜çš„äº‹æƒ…ï¼Œæš‚æ—¶åªèƒ½æ¥å—</li></ul><h3 id="å¦‚ä½•é€‰æ‹©ä¸€å®¶ä¿é™©å…¬å¸ï¼Ÿ">å¦‚ä½•é€‰æ‹©ä¸€å®¶ä¿é™©å…¬å¸ï¼Ÿ</h3><ul><li>å¯¹æ¯”ä¸åŒä¿é™©å…¬å¸çš„æŠ•è¯‰æƒ…å†µ</li><li>ç›‘ç®¡éƒ¨é—¨æ¯å¹´éƒ½ä¼šå¯¹å„å®¶ä¿é™©å…¬å¸çš„æŠ•è¯‰æƒ…å†µè¿›è¡Œé€šæŠ¥ã€è¯„åˆ†ï¼Œå¹¶å‘å¸ƒåœ¨å®˜ç½‘ä¸Šï¼ˆæ¯”å¦‚ä¿ç›‘ä¼šå®˜ç½‘ï¼‰</li><li>é”€å”®äººå‘˜å£ç¢‘å¦‚ä½•ï¼Œä¿¡æ¯æŠ€æœ¯å®åŠ›å¦‚ä½•ï¼ˆæ¯”å¦‚å®˜ç½‘å’Œæ‰‹æœºè½¯ä»¶çš„ä½¿ç”¨ä½“éªŒï¼‰ï¼Œå®¢æœç”µè¯èƒ½å¦å¿«é€Ÿæ¥é€šï¼Œè¯¸å¦‚æ­¤ç±»</li><li>æœ€é‡è¦çš„æ˜¯ä¿é™©äº§å“çš„æ€§ä»·æ¯”</li></ul><h1 id="2ã€è´­å‰æŒ‡å—ï¼šä¹°ä¿é™©çš„æ­£ç¡®æ–¹æ³•">2ã€è´­å‰æŒ‡å—ï¼šä¹°ä¿é™©çš„æ­£ç¡®æ–¹æ³•</h1><ul><li><p>ä¹°ä¿é™©å’Œåƒéº¦å½“åŠ³æ˜¯ä¸€æ ·çš„ï¼Œä¿é™©äº§å“ä¸€èˆ¬éƒ½æ˜¯å¾ˆå¤šä¿é™©ç»„æˆçš„ã€‚</p></li><li><p>ä¸€ä»½ä¿é™©è®¡åˆ’é€šå¸¸ç”±ä¸€æ¬¾ä¸»é™©å’Œè‹¥å¹²æ¬¾é™„åŠ é™©æ„æˆï¼Œä¸»é™©å°±åƒä¸€ä½å¤§å“¥ï¼Œå¸¦ç€ä¸€å¸®ä½œä¸ºé™„åŠ é™©çš„å°å¼Ÿã€‚</p><ul><li>è¿™ç§å……åˆ†åˆ©ç”¨å’Œå®¢æˆ·æ¥è§¦çš„æœºä¼šæ¨é”€å°½å¯èƒ½å¤šçš„äº§å“ï¼Œæ˜¯ä¸€ç§æ™®éçš„ä¿é™©é”€å”®æ¨¡å¼</li></ul></li><li><p>ä½†æ˜¯æœ‰æ—¶å€™ï¼Œå•ç‚¹æ¯”å¥—é¤æ›´å¥½ï¼Œæ¯•ç«Ÿä¿é™©å…¬å¸å®šçš„äº§å“å¹¶éæ ¹æ®æˆ‘ä»¬çš„éœ€æ±‚å®šï¼Œé™„åŠ é™©å¯èƒ½å¹¶éæˆ‘ä»¬éœ€è¦çš„ã€‚</p></li></ul><h2 id="è´£ä»»çš„å¤šå°‘ã€ä¿é¢çš„é«˜ä½ã€æœŸé™çš„é•¿çŸ­ï¼Œè¿™ä¸‰å¤§å› ç´ ç›´æ¥å†³å®šäº†ä¿é™©äº§å“çš„ä»·æ ¼ã€‚">è´£ä»»çš„å¤šå°‘ã€ä¿é¢çš„é«˜ä½ã€æœŸé™çš„é•¿çŸ­ï¼Œè¿™ä¸‰å¤§å› ç´ ç›´æ¥å†³å®šäº†ä¿é™©äº§å“çš„ä»·æ ¼ã€‚</h2><h3 id="ä¿é¢ï¼šçœŸåˆ°ç”¨æ—¶æ–¹æ¨å°‘">ä¿é¢ï¼šçœŸåˆ°ç”¨æ—¶æ–¹æ¨å°‘</h3><h3 id="æœŸé™ï¼šä»ä¸€å¤©åˆ°ä¸€è¾ˆå­">æœŸé™ï¼šä»ä¸€å¤©åˆ°ä¸€è¾ˆå­</h3><h4 id="çŸ­æœŸäº§å“">çŸ­æœŸäº§å“</h4><ul><li>ä¿é™©æœŸé™ä¸è¶…è¿‡ä¸€å¹´</li><li>ä»¥ä¸€å¹´ä¸ºä¸€æœŸè®¡ï¼Œäº§å“çš„å®šä»·å°±è¦å‚è€ƒå½“ä¸‹è¢«ä¿é™©äººçš„å¹´é¾„æ¥è®¡ç®—äº†ã€‚30å²æ—¶è´­ä¹°ï¼Œä»·æ ¼å¯èƒ½æ˜¯100å…ƒï¼›5å¹´åï¼Œä»·æ ¼å¯èƒ½å°±ä¼šæ¶¨åˆ°400å…ƒã€‚è¿™ç§éšå¹´é¾„å¢åŠ è€Œä¸Šæ¶¨çš„å®šä»·ç­–ç•¥ï¼Œå«ä½œè‡ªç„¶è´¹ç‡ã€‚å®¢æˆ·æ¯å¹´äº¤çš„é’±ï¼Œåªè´Ÿè´£æ‰¿æ‹…å½“å¹´çš„é£é™©ã€‚</li></ul><h4 id="é•¿æœŸäº§å“">é•¿æœŸäº§å“</h4><ul><li>10å¹´ã€20å¹´ç”šè‡³ç»ˆèº«</li><li>å®šä»·æ–¹æ³•éµå¾ªä¸¤ä¸ªåŸåˆ™ï¼šä¸€æ˜¯å‡è¡¡è´¹ç‡åŸåˆ™ï¼ŒäºŒæ˜¯ä¿è¯è´¹ç‡åŸåˆ™</li><li>å‡è¡¡è´¹ç‡ï¼ŒæŒ‡çš„æ˜¯ä¿é™©å…¬å¸å°†è¢«ä¿é™©äººæœªæ¥å¾ˆé•¿ä¸€æ®µæ—¶é—´çš„é£é™©ï¼Œå½’å¹¶åˆ°ä¸€èµ·è¿›è¡Œå®šä»·ï¼Œè€Œä¸åªæ˜¯ä¸€å¹´çš„é£é™©<ul><li>æ¯”å¦‚ï¼Œä¿åˆ°70å²æˆ–ä¿ç»ˆèº«ï¼ŒæŠ•ä¿äººæœªæ¥å‡ åå¹´çš„ç–¾ç—…å‘ç”Ÿç‡æˆ–è€…æ­»äº¡ç‡è¢«ç´¯è®¡åç®—å‡ºä¿è´¹ï¼Œå†æŒ‰ç…§20å¹´æˆ–30å¹´äº¤è´¹çš„æ–¹å¼è¿›è¡Œå‡æ‘Šï¼Œä»·æ ¼å°±ç¡®å®šäº†</li><li>åœ¨è¿™æ ·ä¸€ç§æ¨¡å¼ä¸‹ï¼Œé•¿æœŸäº§å“çš„åœå”®åªæ„å‘³ç€ä¸æ¥å—æ–°å®¢æˆ·çš„è´­ä¹°ï¼Œä½†å¹¶ä¸å½±å“å·²ç»æŠ•ä¿çš„å®¢æˆ·</li></ul></li><li>ä¿è¯è´¹ç‡ï¼šæŒ‡çš„æ˜¯åœ¨ä½ æŠ•ä¿çš„ä¸€ç¬é—´ï¼Œä»·æ ¼ä¾¿å·²ç¡®å®šï¼ŒåæœŸä¸ä¼šå¢åŠ ã€‚å¯¹äºé•¿æœŸé‡ç–¾é™©æ¥è¯´ï¼Œå³ä½¿æŠ•ä¿äººæœªæ¥çš„å‘ç—…ç‡ä¸Šå‡ï¼Œä¿é™©å…¬å¸ä¹Ÿä¸ä¼šæ¶¨ä»·</li></ul><h4 id="é•¿æœŸäº§å“å’ŒçŸ­æœŸäº§å“è´¹ç”¨æ¯”è¾ƒ">é•¿æœŸäº§å“å’ŒçŸ­æœŸäº§å“è´¹ç”¨æ¯”è¾ƒ</h4><ul><li>æ•´ä½“æ¥çœ‹ï¼Œè´­ä¹°çŸ­æœŸé™©è´¹ç”¨è¦æ¯”é•¿æœŸé™©è´¹ç”¨é«˜</li><li>äººåˆ°ä¸­å¹´ï¼Œå°±æœ‰å¯èƒ½æ— æ³•è´­ä¹°çŸ­æœŸé™©</li><li>äººåˆ°è€å¹´ï¼Œåˆ™æ ¹æœ¬ä¸èƒ½è´­ä¹°çŸ­æœŸé™©</li><li>å¯¹äºå·²ç»æœ‰é•¿æœŸé™©åº‡æŠ¤çš„äººæ¥è¯´ï¼Œé¢å¤–è´­ä¹°ä¸€ä»½ä¸€å¹´æœŸäº§å“ï¼Œå¯ä»¥åœ¨ä¸€å®šæ—¶é—´å†…å¢åŠ ä¿é¢</li><li>çŸ­æœŸé™©åœ¨å¹´è½»æ—¶æ¯”è¾ƒä¾¿å®œ</li></ul><h3 id="ä¿é™©äº§å“çš„ä»·æ ¼ç”±è°å†³å®š">ä¿é™©äº§å“çš„ä»·æ ¼ç”±è°å†³å®š</h3><h4 id="æˆ‘ä»¬æœ‰å“ªäº›éœ€æ±‚éœ€è¦ä¿é™©è§£å†³ï¼Ÿ">æˆ‘ä»¬æœ‰å“ªäº›éœ€æ±‚éœ€è¦ä¿é™©è§£å†³ï¼Ÿ</h4><ol><li>å¾—äº†é‡ç–¾ï¼Œæœ‰é’±æ²»ç—…</li><li>å¾—äº†é‡ç–¾ï¼Œå¼¥è¡¥æ²»ç–—æœŸé—´çš„æ”¶å…¥</li><li>ä¸å¹¸èº«æ•…ï¼Œç»™çˆ¸å¦ˆç•™ä¸€ç¬”å…»è€è´¹</li><li>æ„å¤–å—ä¼¤ï¼Œè§£å†³åŒ»ä¿ä¸åŒ…å«çš„è´¹ç”¨</li></ol><h4 id="ä¿é™©è¿™ç§äº§å“ä¸æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå®ƒæ˜¯é™ªä¼´ä½ åº¦è¿‡æ¼«é•¿äººç”Ÿçš„ä¸€ç§é£é™©è§„åˆ’">ä¿é™©è¿™ç§äº§å“ä¸æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå®ƒæ˜¯é™ªä¼´ä½ åº¦è¿‡æ¼«é•¿äººç”Ÿçš„ä¸€ç§é£é™©è§„åˆ’</h4><h2 id="å¦‚ä½•ä¸ä¿é™©ä¸šåŠ¡å‘˜æ‰“äº¤é“">å¦‚ä½•ä¸ä¿é™©ä¸šåŠ¡å‘˜æ‰“äº¤é“</h2><p>ä¿é™©å…¬å¸ä¼šä¸é—ä½™åŠ›åœ°å¢åŠ äº§å“çš„â€œäººæƒ…å‘³â€ï¼Œæ¯”å¦‚å°†ä¿é™©å¡‘é€ æˆçˆ±ä¸è´£ä»»çš„è±¡å¾ï¼Œè®©ä½ æŠŠå¯¹å­å¥³ã€çˆ¶æ¯çš„çˆ±å¯„æ‰˜äºä¿é™©äº§å“ä¹‹ä¸Šï¼Œè®©è´­ä¹°è¡Œä¸ºæ›´åŠ é¡ºç†æˆç« </p><h3 id="ä¿é™©é”€å”®äººå‘˜åˆ°åº•æŒ‡çš„æ˜¯è°">ä¿é™©é”€å”®äººå‘˜åˆ°åº•æŒ‡çš„æ˜¯è°</h3><ul><li>ç¬¬ä¸€ï¼Œä¿é™©ä»£ç†äººã€‚å…¨å›½çº¦800ä¸‡ï¼Œä»–ä»¬ä»£è¡¨å„è‡ªæ‰€åœ¨çš„ä¿é™©å…¬å¸ï¼Œåªé”€å”®æŸä¸€å®¶ä¿é™©å…¬å¸çš„äº§å“ã€‚</li><li>ç¬¬äºŒï¼Œä¿é™©ç»çºªäººã€‚å’Œä»£ç†äººæœ€å¤§çš„ä¸åŒæ˜¯ï¼Œç»çºªäººä»£è¡¨çš„ä¸æ˜¯æŸä¸€å®¶ä¿é™©å…¬å¸ï¼Œè€Œæ˜¯ä¿é™©ä¸­ä»‹å…¬å¸ï¼Œä»–ä»¬å¯ä»¥é”€å”®å¤šå®¶ä¿é™©å…¬å¸äº§å“</li><li>ç¬¬ä¸‰ï¼Œé“¶è¡Œç†è´¢ç»ç†</li><li>ç¬¬å››ï¼Œäº’è”ç½‘ç¬¬ä¸‰æ–¹å¹³å°</li></ul><h3 id="å’Œä¸šåŠ¡å‘˜æ‰“äº¤é“ï¼Œè¦éµå¾ªä¸¤ä¸ªåŸåˆ™">å’Œä¸šåŠ¡å‘˜æ‰“äº¤é“ï¼Œè¦éµå¾ªä¸¤ä¸ªåŸåˆ™</h3><h4 id="æƒ³ä¸€ä¸‹æˆ‘ä»¬æœ‰æ—¶å€™ä¼šä¸ä¼šå› ä¸ºä¸‹é¢çš„æƒ…å†µè€Œä¹°ä¿é™©">æƒ³ä¸€ä¸‹æˆ‘ä»¬æœ‰æ—¶å€™ä¼šä¸ä¼šå› ä¸ºä¸‹é¢çš„æƒ…å†µè€Œä¹°ä¿é™©</h4><ul><li>ç¬¬ä¸€ï¼Œå–ä¿é™©çš„äººæ˜¯äº²æˆšï¼ŒæŠ¹ä¸å¼€é¢å­ï¼Œä¹°å§ã€‚</li><li>ç¬¬äºŒï¼Œé‚»å±…éƒ½ç»™å­©å­ä¹°çš„è¿™ä¸ªï¼Œæˆ‘ä¹Ÿä¹°ä¸€ä¸ªå§</li><li>ç¬¬ä¸‰ï¼Œä»–ç­”åº”æˆ‘æŠŠä½£é‡‘è¿”è¿˜ç»™æˆ‘ï¼Œçœäº†ä¸å°‘é’±ï¼Œä¹°å§ã€‚</li><li>ç¬¬å››ï¼Œå°ä¼™å­å£æ‰å¥½ï¼Œäººä¹Ÿå¸…ï¼Œå–çš„ä¿é™©ä¸ä¼šå·®ã€‚</li><li>ç¬¬äº”ï¼Œå°±ç®—è¢«éª—ä¸€å¹´æ‰æŸå¤±1000å¤šå—é’±ï¼Œä¹°å§</li></ul><p>å¥½é¢å­ã€ä»ä¼—å¿ƒç†ã€è´ªå›¾å°ä¾¿å®œã€å¿½ç•¥äº§å“çš„æœ¬è´¨ï¼Œè¿™ç±»é—®é¢˜ç»å¸¸å‘ç”Ÿï¼Œä¹Ÿé—´æ¥å‚¬ç”Ÿäº†ä¸€æ‰¹ä¸é è°±çš„ä¿é™©ä¸šåŠ¡å‘˜</p><h4 id="ç¬¬ä¸€ä¸ªåŸåˆ™ï¼šäº’ç›¸å°Šé‡ï¼Œå­¦ä¼šæé—®ã€‚">ç¬¬ä¸€ä¸ªåŸåˆ™ï¼šäº’ç›¸å°Šé‡ï¼Œå­¦ä¼šæé—®ã€‚</h4><ul><li>æ¡æ¬¾èƒ½ç»™æˆ‘çœ‹ä¸€ä¸‹å—ï¼Ÿ</li><li>ä¸ºä»€ä¹ˆæˆ‘éœ€è¦è¿™æ¬¾äº§å“ï¼Ÿ</li><li>ä¸ºä»€ä¹ˆè¿™ç±»äº§å“ä½ ä»¬å®¶çš„æœ€å¥½ï¼Ÿ</li><li>èƒ½æ¯”è¾ƒä¸€ä¸‹ä¸åŒäº§å“å—ï¼Ÿ</li><li>ä¸ºä»€ä¹ˆè¦ä¿ç»ˆèº«ï¼Ÿ</li><li>ä¸ºä»€ä¹ˆè¿™ä¸ªé™„åŠ é™©å€¼å¾—è´­ä¹°ï¼Ÿ</li><li>å¦‚æœä½ å‘ç°è¿™ä½ä¿é™©ä¸šåŠ¡å‘˜é¢å¯¹ä½ æå‡ºçš„ä¸€ä¸ªä¸ªé—®é¢˜ï¼Œè¦ä¹ˆç­”ä¸å‡ºæ¥ï¼Œè¦ä¹ˆé€»è¾‘æ··ä¹±ï¼Œè¦ä¹ˆä¸åˆ†é’çº¢çš‚ç™½åœ°æ•Œè§†åŠè´¬æŸå…¶ä»–ä¿é™©å…¬å¸ï¼Œæœ€å¥½ç«‹å³æ›´æ¢ä¸šåŠ¡å‘˜</li></ul><h4 id="ç¬¬äºŒä¸ªåŸåˆ™ï¼šå……åˆ†ä¿¡ä»»ï¼Œè¦æœ‰ä¸»è§">ç¬¬äºŒä¸ªåŸåˆ™ï¼šå……åˆ†ä¿¡ä»»ï¼Œè¦æœ‰ä¸»è§</h4><h3 id="å–ä¿é™©ç®€å•å—">å–ä¿é™©ç®€å•å—</h3><ul><li><p>äº§å“è´µä¸è´µï¼ˆåŒç±»äº§å“çš„å®šä»·å’Œè´¹ç‡å¯¹æ¯”ï¼‰ï¼Ÿ</p></li><li><p>åˆ°åº•æœ‰å“ªäº›ä¿éšœï¼ˆä¿é™©è´£ä»»çš„è§£è¯»ï¼‰ï¼Ÿ</p></li><li><p>é€€ä¿èƒ½æ‹¿åˆ°å¤šå°‘ä¿è´¹ï¼ˆä¿å•ç°é‡‘ä»·å€¼çš„è§£è¯»ï¼‰ï¼Ÿ</p></li><li><p>ä¹°å®Œåå“ªäº›ä¿¡æ¯å¯ä»¥ä¿®æ”¹ï¼ˆå¯¹ä¿å•ä¿å…¨åŠŸèƒ½çš„è®²è§£ï¼‰ï¼Ÿ</p></li><li><p>è¿™ä¸ªäº§å“èƒ½å®ç°å¤šé«˜æ”¶ç›Šï¼ˆå¦‚ä½•è®¡ç®—åˆ†çº¢é™©ã€ä¸‡èƒ½é™©ã€å¹´é‡‘ç­‰äº§å“çš„æŠ•èµ„æ”¶ç›Šï¼‰ï¼Ÿ</p></li><li><p>ç¼´è´¹æœŸé™æ€ä¹ˆé€‰æ‹©ï¼ˆç°é‡‘æµè´´ç°åŸç†ï¼‰ï¼Ÿ</p></li><li><p>ä¿é™©æ¡æ¬¾é‡Œæœ‰æ²¡æœ‰æ‰€è°“çš„å‘ï¼ˆé™¤å¤–è´£ä»»åšé‡ç‚¹è¯´æ˜ï¼‰ï¼Ÿ</p></li><li><p>é‡åˆ°çº çº·çš„æ—¶å€™å¦‚ä½•å¤„ç†ï¼Ÿ</p></li></ul><p>å¦‚æœä»–çœŸçš„åšäº†äº§å“å¯¹æ¯”ï¼Œä½†å¦‚æœä»–æ¨é”€çš„äº§å“ä»·æ ¼æ²¡æœ‰ç«äº‰åŠ›ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿä»–çœŸçš„ç®—æ¸…æ¥šäº†äº§å“æ”¶ç›Šï¼Œä½†å®¢æˆ·è§‰å¾—æ”¶ç›Šç‡ä¸å¦‚æƒ³è±¡çš„é‚£ä¹ˆé«˜ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿä»–çœŸçš„ä¸€æ¡ä¸€æ¡åœ°è§£é‡Šæ¸…æ¥šé™¤å¤–è´£ä»»ï¼Œå®¢æˆ·å´äº§ç”Ÿâ€œä¿é™©å…¬å¸æ¨å¸è´£ä»»â€çš„æƒ…ç»ªåŒ–è¯¯è§£ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿä»–å› ä¸ºå®¢æˆ·çš„å¥åº·é—®é¢˜è€Œæ‹’ç»å…¶æŠ•ä¿ï¼Œä¹‹å‰çš„å·¥ä½œä¸å°±ç™½å¿™æ´»äº†å—ï¼Ÿ<br>è¿™äº›å‡è®¾ä¼¼ä¹æš—ç¤ºäº†ä¿é™©é”€å”®äººå‘˜â€œèƒ½åŠ›è¶Šå¼ºè¶Šå–ä¸å‡ºå»äº§å“â€çš„è§‚ç‚¹ï¼Œä½†æˆ‘æƒ³è¡¨è¾¾çš„ç»ä¸æ˜¯â€œçŸ¥è¯†æ— ç”¨è®ºâ€ï¼Œå®ƒä»¬åªæ˜¯åœ¨ä¸€å®šç¨‹åº¦ä¸Šåæ˜ äº†å½“å‰ä¿é™©é”€å”®é¢†åŸŸå­˜åœ¨çš„å¼Šç—…ã€‚è€Œè¿™äº›æç«¯çš„ä¾‹å­æ°æ°å‡¸æ˜¾äº†â€œä½ â€çš„é‡è¦æ€§ã€‚</p><h3 id="ä½ çš„å…¬å¸ç»™ä½ ä¹°ä¿é™©äº†å—">ä½ çš„å…¬å¸ç»™ä½ ä¹°ä¿é™©äº†å—</h3><h4 id="ä¼ä¸šå›¢ä½“ä¿é™©">ä¼ä¸šå›¢ä½“ä¿é™©</h4><p>å›¢é™©é€šå¸¸ç”±4ä¸ªä¿é™©äº§å“ç»„æˆï¼š</p><ul><li>å®šæœŸå¯¿é™©</li><li>é‡å¤§ç–¾ç—…é™©</li><li>æ„å¤–é™©</li><li>åŒ»ç–—é™©</li></ul><p>å›¢é™©è®¡åˆ’å¯ä»¥æ¶µç›–ä»¥ä¸‹è´£ä»»ï¼š</p><ol><li>ç½¹æ‚£é‡å¤§ç–¾ç—…ï¼šä¿é¢50ä¸‡å…ƒï¼ˆé‡å¤§ç–¾ç—…é™©çš„é‡ç–¾è´£ä»»50ä¸‡å…ƒï¼‰ã€‚</li><li>ç–¾ç—…å¯¼è‡´èº«æ•…ï¼šä¿é¢50ä¸‡å…ƒï¼ˆå®šæœŸå¯¿é™©èº«æ•…è´£ä»»50ä¸‡å…ƒï¼‰ã€‚</li><li>æ„å¤–å¯¼è‡´èº«æ•…ï¼šä¿é¢150ä¸‡å…ƒï¼ˆå®šæœŸå¯¿é™©èº«æ•…è´£ä»»50ä¸‡å…ƒ+æ„å¤–é™©èº«æ•…è´£ä»»100ä¸‡å…ƒï¼‰ã€‚</li><li>é—¨è¯Šè´£ä»»ï¼šä¿é¢2ä¸‡å…ƒï¼ˆåŒ»ç–—é™©åŒ…å«çš„é—¨æ€¥è¯ŠåŒ»ç–—è´£ä»»2ä¸‡å…ƒï¼‰ã€‚</li><li>ä½é™¢è´£ä»»ï¼šä¿é¢30ä¸‡å…ƒï¼ˆåŒ»ç–—é™©åŒ…å«çš„ä½é™¢åŒ»ç–—è´£ä»»30ä¸‡å…ƒï¼‰ã€‚</li></ol><p>å›¢é™©ä»·æ ¼ä¹‹æ‰€ä»¥â€œäº²æ°‘â€ï¼Œä¸»è¦åŸå› å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ä¸€ï¼Œå›¢é™©å¯ä»¥ç®€å•ç±»æ¯”ä¸ºå›¢è´­ï¼Œä¹°çš„äººæ•°å¤šï¼ŒèŠ‚çœäº†ä¸€éƒ¨åˆ†ç®¡ç†æˆæœ¬ï¼Œè‡ªç„¶å°±èƒ½è·å¾—ä¸€å®šçš„ä¼˜æƒ </li><li>ç¬¬äºŒï¼Œå›¢é™©çš„ä¸»è¦é”€å”®å¯¹è±¡æ˜¯ä¼ä¸šäººåŠ›èµ„æºéƒ¨ï¼Œåªè¦è´Ÿè´£äººæ‹æ¿ï¼Œ100ä¸ªå‘˜å·¥å°±ç›´æ¥è´­ä¹°äº†ï¼Œä¸ç”¨ä¸€ä¸ªä¸€ä¸ªåœ°å®£ä¼ ã€ä»‹ç»ï¼Œé—´æ¥é™ä½äº†äº§å“çš„é”€å”®è´¹ç”¨ï¼Œæœ€ç»ˆçš„å®æƒ è½åœ¨äº†æ¯ä¸€ä½å‚ä¿å‘˜å·¥èº«ä¸Š</li><li>ç¬¬ä¸‰ï¼Œä»¥ä¼ä¸šåä¹‰æŠ•ä¿ï¼Œå‚ä¿äººå‘˜çš„å·¥ä½œç¯å¢ƒå’Œæ€§è´¨ç›¸å¯¹ä¸€è‡´ï¼Œå¤–éƒ¨é£é™©å¯æ§ï¼Œä½•å†µä¸å°‘ä¼ä¸šè¿˜æœ‰å…¥èŒä½“æ£€ï¼Œå¯ä»¥å¾ˆå¥½è§£å†³å®¢æˆ·çš„é€†é€‰æ‹©å’Œå¥åº·é—®é¢˜</li></ul><h4 id="å›¢é™©å¸¦æ¥çš„â€œä¿é™©å¹»è§‰â€">å›¢é™©å¸¦æ¥çš„â€œä¿é™©å¹»è§‰â€</h4><p>ä¸€èˆ¬å…¬å¸å›¢é™©çš„ä¿é™©äº§å“çš„ä¿éšœæœŸé™éƒ½æ˜¯ä¸€å¹´ï¼Œå¦‚æœå®Œå…¨ä¾èµ–å…¬å¸ä¿é™©ï¼Œæˆ‘ä»¬ä¸€æ—¦ç¦»èŒå°±ä¼šé¢ä¸´ä¿é™©â€œè£¸å¥”â€çš„æƒ…å†µ<br>æ‰€ä»¥ï¼Œå»ºè®®å¤§å®¶ç”¨å®¢è§‚çš„æ€åº¦çœ‹å¾…å…¬å¸ä¸ºå‘˜å·¥è´­ä¹°çš„å›¢é™©ã€‚å®ƒæ˜¯ä¸€ç§æå¥½çš„å‘˜å·¥ç¦åˆ©ï¼Œå®ƒåº”è¯¥æ˜¯å‘˜å·¥è‡ªèº«å·²è´­ä¿é™©çš„æœ‰åŠ›è¡¥å……ï¼Œå´ä¸èƒ½è¢«å½“ä½œå…¨éƒ¨ã€‚</p><h4 id="äº†è§£å…¬å¸çš„å›¢é™©æ”¿ç­–">äº†è§£å…¬å¸çš„å›¢é™©æ”¿ç­–</h4><ul><li>è¿™ä»½å›¢é™©è®¡åˆ’é‡Œæœ‰æ¶µç›–èº«æ•…è´£ä»»çš„äº§å“å—ï¼Ÿ</li><li>å¦‚æœæœ‰ï¼Œä¿é¢æ˜¯å¤šå°‘ï¼Ÿ</li><li>å¦‚æœå‘˜å·¥è·å¾—æ™‹å‡ï¼Œä¿é¢ä¼šéšä¹‹æé«˜å—ï¼Ÿ</li></ul><h1 id="03-é‡ç‚¹å…³æ³¨ï¼šä¸­äº§å¿…å¤‡çš„â€œå››å¤§ä¿é™©é‡‘åˆšâ€">03 é‡ç‚¹å…³æ³¨ï¼šä¸­äº§å¿…å¤‡çš„â€œå››å¤§ä¿é™©é‡‘åˆšâ€</h1><h2 id="é‡å¤§ç–¾ç—…é™©ï¼šä¸ºäº†ä¸è¢«æ”¹å˜çš„äººç”Ÿ">é‡å¤§ç–¾ç—…é™©ï¼šä¸ºäº†ä¸è¢«æ”¹å˜çš„äººç”Ÿ</h2><p>é‡ç–¾é™©çš„è¯ç”Ÿï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸ºäº†è§£å†³æ”¶å…¥ä¸­æ–­çš„é£é™©ï¼Œç«™åœ¨æ‚£è€…åŠå…¶å®¶äººçš„è§’åº¦ï¼Œä¸ºå·²åœ¨é‡ç—…æ·±æ¸Šçš„å®¶åº­æä¾›é›ªä¸­é€ç‚­èˆ¬çš„ç»æµè¡¥å¿</p><h3 id="é‡ç–¾é™©ç©¶ç«Ÿä¿ä»€ä¹ˆ">é‡ç–¾é™©ç©¶ç«Ÿä¿ä»€ä¹ˆ</h3><h4 id="ä»€ä¹ˆå«â€œé‡å¤§ç–¾ç—…â€ï¼Ÿ">ä»€ä¹ˆå«â€œé‡å¤§ç–¾ç—…â€ï¼Ÿ</h4><p>ä¿ç›‘ä¼šå®‰æ’ä¸­å›½ä¿é™©è¡Œä¸šåä¼šå’Œä¸­å›½åŒ»å¸ˆåä¼šï¼Œåœ¨2007å¹´æ‹¿å‡ºäº†ä¸€ç‰ˆ25ç§é‡ç–¾æ ‡å‡†ï¼Œå›Šæ‹¬æ‰€æœ‰é«˜å‘é‡ç–¾ç±»å‹ï¼ˆå…¶å®ï¼Œåªè¦æ˜¯é‡ç–¾é™©å°±éƒ½åŒ…æ‹¬è¿™25ç§ï¼‰</p><p>ä¿ç›‘ä¼šè®¾å®šçš„è¿™25ç§é‡å¤§ç–¾ç—…ï¼Œå…¶å‘ç”Ÿæ¦‚ç‡è¶…è¿‡95%çš„ç–¾ç—…ç§ç±»ã€‚</p><p>æ‰€ä»¥å¦‚æœä¸€ä¸ªä¿é™©è¯´ä»–åŒ…å«æ›´å¤šçš„é‡ç–¾ï¼Œç„¶åè®©æˆ‘ä»¬å¤šèŠ±é’±ä¹°å®ƒï¼Œå…¶å®æ²¡æœ‰å¤ªå¿…è¦ã€‚</p><h4 id="ä»€ä¹ˆå«â€œç½¹æ‚£â€ï¼Ÿ">ä»€ä¹ˆå«â€œç½¹æ‚£â€ï¼Ÿ</h4><ul><li>ç¬¬ä¸€ï¼Œç—…æƒ…è¾¾åˆ°æŸä¸ªæ ‡å‡†ï¼Œç›¸å½“äºç¡®è¯Šå³èµ”ï¼Œæ¯”å¦‚æ¶æ€§è‚¿ç˜¤</li><li>ç¬¬äºŒï¼ŒæŠ•ä¿äººä¸ºæ²»ç–—æŸç§ç–¾ç—…è€Œæ¥å—äº†æŸç§æ²»ç–—æ–¹æ³•ã€‚æ¯”å¦‚å¿ƒè„ç“£è†œæ‰‹æœ¯</li><li>ç¬¬ä¸‰ï¼ŒæŸç§çŠ¶æ€æŒç»­äº†ä¸€æ®µæ—¶é—´ã€‚æ¯”å¦‚è„‘ä¸­é£åé—ç—‡</li></ul><h3 id="é™¤äº†é‡å¤§ç–¾ç—…ï¼Œé‡ç–¾é™©è¿˜ä¿è¿™äº›">é™¤äº†é‡å¤§ç–¾ç—…ï¼Œé‡ç–¾é™©è¿˜ä¿è¿™äº›</h3><p>å½“é‡ç–¾é™©çš„è´£ä»»åªæœ‰é‡å¤§ç–¾ç—…æ—¶ï¼Œæ¶ˆè´¹è€…ç†æ‰€å½“ç„¶åœ°æå‡ºäº†ä¸€ä¸ªæŒ¯è‹å‘è©çš„é—®é¢˜ï¼šå¦‚æœæˆ‘ä¸€è¾ˆå­æ²¡å¾—é‡ç–¾ï¼Œè¿™ä¿è´¹å²‚ä¸æ˜¯ç™½äº¤äº†ï¼Ÿ</p><p>å¥½ï¼Œä¸ºäº†ä¸è®©ä½ ç™½äº¤ï¼Œä¿é™©å…¬å¸ç´¢æ€§å¢åŠ äº†å¾ˆå¤šå…¶ä»–è´£ä»»ï¼Œ<strong>â€œé¡ºä¾¿â€æå‡äº†ä¿è´¹</strong>ã€‚ä¹°å–åŒæ–¹éƒ½é«˜å…´ï¼Œè¿™ç§å•†ä¸šæ¨¡å¼å ªç§°å®Œç¾ã€‚</p><ul><li>åœ¨æ–°å¢çš„è´£ä»»é‡Œï¼Œç¬¬ä¸€ç±»æ˜¯â€œèº«æ•…è´£ä»»â€ã€‚è¿™ç§åŒ…å«èº«æ•…è´£ä»»çš„é‡ç–¾é™©ï¼ŒåŸºæœ¬ä¸Šéƒ½å¯ä»¥â€œæå‰ç»™ä»˜â€ã€‚<ul><li>è¿™é‡Œçš„æå‰æŒ‡çš„æ˜¯é‡ç–¾ã€èº«æ•…äºŒè€…ä¸­å“ªä¸ªå…ˆå‘ç”Ÿï¼Œå°±ç»™ä»˜å“ªä¸ªã€‚</li><li>æå‰ç»™ä»˜ä¸è¿‡æ˜¯ä¸€ç§äº§å“è®¾è®¡ç½¢äº†ï¼Œåƒä¸‡åˆ«è§‰å¾—å®ƒæ˜¯ä¸€é¡¹ç‹¬ç‰¹çš„ä¼˜åŠ¿ã€‚</li></ul></li><li>ç¬¬äºŒç±»æ–°å¢è´£ä»»æ˜¯è½»ç—‡å’Œä¸­ç—‡è´£ä»»</li><li>ç¬¬ä¸‰ç±»æ–°å¢è´£ä»»æ˜¯é’ˆå¯¹é‡å¤§ç–¾ç—…çš„èŠ±æ ·èµ”ä»˜æ–¹å¼ã€‚æ¯”å¦‚é‡ç–¾å’Œè½»ç—‡å¯ä»¥èµ”ä»˜å¤šæ¬¡ï¼Œåˆæ¯”å¦‚æŒ‘å‡ºæŸå‡ ä¸ªç—…ç§é¢å¤–èµ”ä»˜50%çš„ä¿é¢ï¼Œå†æ¯”å¦‚æŠ•ä¿åå‰10å¹´äº«å—ä¿é¢é¢å¤–å¢åŠ 50%ã€‚</li></ul><p>ä¸Šé¢è¯´çš„è¿™äº›éƒ½æ˜¯åœ¨<strong>å¢åŠ ä¿è´¹çš„åŸºç¡€ä¸Š</strong>å¢åŠ äº†æ›´å¤šçš„è´£ä»»ï¼Œæ‰€ä»¥å½“ä¿é™©å…¬å¸è¯´æˆ‘ä»¬ä¿çš„å¤šçš„æ—¶å€™é™¤éå’Œåˆ«äººä»·æ ¼ä¸€æ ·ï¼Œå¦åˆ™åªæ˜¯åœ¨éª—æˆ‘ä»¬èŠ±æ›´å¤šé’±è€Œå·²ã€‚</p><h3 id="é‡ç–¾é™©çš„ä¿é¢åŠå…¶ä»–">é‡ç–¾é™©çš„ä¿é¢åŠå…¶ä»–</h3><h4 id="å¦‚ä½•ç¡®å®šä¿é¢">å¦‚ä½•ç¡®å®šä¿é¢</h4><ul><li>æ‚£é‡ç–¾åï¼Œæ‚£è€…æ™®éé¢ä¸´çš„æ˜¯3~5å¹´çš„æ²»ç–—åº·å¤æœŸ</li><li>ä¸æ­¤åŒæ—¶ï¼Œé‡ç–¾å¯¼è‡´æ”¶å…¥ä¸­æ–­å°†ä¸ºå®¶åº­å¸¦æ¥æ›´å¤§çš„å‹åŠ›</li><li>å› æ­¤ï¼Œé‡ç–¾é™©çš„<strong>ä¿é¢åº”è‡³å°‘è¦†ç›–æŠ•ä¿äºº3~5å¹´çš„æ”¶å…¥</strong></li><li>å¦‚å¹´æ”¶å…¥20ä¸‡å…ƒçš„ä¿é¢åº”è¯¥åœ¨60ä¸‡ä»¥ä¸Š</li><li>è€Œä¸”åªè¦ç¡®ä¿è¿™æ¬¾é‡ç–¾é™©èƒ½æä¾›60ä¸‡å…ƒçš„é‡ç–¾ä¿é¢ï¼Œæœ‰æ²¡æœ‰èº«æ•…è´£ä»»ã€å¤šæ¬¡èµ”ä»˜ã€æŠ•ä¿äººè±å…ï¼Œéƒ½æ— å…³ç´§è¦</li></ul><h4 id="é‡ç–¾é™©åº”è¯¥ä¿éšœå¤šä¹…å’Œäº¤å¤šå°‘å¹´ä¿è´¹ã€‚">é‡ç–¾é™©åº”è¯¥ä¿éšœå¤šä¹…å’Œäº¤å¤šå°‘å¹´ä¿è´¹ã€‚</h4><p>è®¨è®ºè¿™ä¸ªé—®é¢˜æœ‰ä¸€ä¸ªå‰æï¼šæˆ‘ä»¬é€‰æ‹©çš„æ˜¯é•¿æœŸäº§å“ã€‚</p><p>å¯¹äºé‡ç–¾é™©ã€å®šæœŸå¯¿é™©ï¼Œå¯ä»¥ä¿ç»ˆèº«æˆ–è€…ä¿åˆ°70å²å·¦å³çš„é•¿æœŸäº§å“ï¼Œæ˜¯æˆ‘ä»¬çš„é¦–é€‰â€”â€”ä¸ä»…ä»·æ ¼æ›´åˆ’ç®—ï¼Œä¹Ÿä¸ä¼šå‡ºç°ä¿é™©ä¸­æ–­çš„æƒ…å†µã€‚</p><p>é•¿æœŸé‡ç–¾é™©çš„<strong>ç¼´è´¹æœŸ</strong>å¾€å¾€æœ‰å¤šç§é€‰æ‹©ï¼š</p><ul><li>è¶¸äº¤ï¼ˆä¸€æ¬¡æ€§äº¤å®Œï¼‰</li><li>10å¹´äº¤</li><li>20å¹´äº¤</li><li>å°‘æ•°äº§å“ç”šè‡³è¿˜è®¾è®¡äº†30å¹´äº¤</li></ul><p><strong>ä¿éšœæœŸé™</strong>ï¼š</p><p>ä¿éšœæœŸé™çš„å»¶é•¿ï¼Œä¼šå¸¦æ¥ä¿è´¹çš„å‡é«˜ï¼›æ²¡åŠæ³•ï¼Œä¸€ä¸ªäººå¹´é¾„è¶Šå¤§ï¼Œç½¹æ‚£é‡ç–¾çš„æ¦‚ç‡å°±è¶Šé«˜ã€‚å¦‚æœé¢„ç®—å……è¶³ï¼Œä¿ç»ˆèº«å½“ç„¶æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚</p><p>åœ¨ç¡®ä¿ä¿é¢å……è¶³çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¿é¢æ‹†æˆä¸¤ä¸ªäº§å“æ¥å®ç°ï¼Œä¸€ä¸ªä¿åˆ°é€€ä¼‘ï¼Œå¦ä¸€ä¸ªä¿ç»ˆèº«</p><p>å¦‚ï¼šå¯¹äºéœ€è¦60ä¸‡å…ƒé‡ç–¾é™©ä¿é¢çš„å°ç‹æ¥è¯´ï¼Œå¯ä»¥é€‰æ‹©ä¹°<strong>ä¸€ä»½ä¿ç»ˆèº«çš„30ä¸‡å…ƒä¿é¢</strong>çš„é‡ç–¾é™©ï¼Œå†ä¹°<strong>ä¸€ä»½ä¿åˆ°70å²çš„30ä¸‡å…ƒä¿é¢</strong>çš„é‡ç–¾é™©ã€‚è¿™æ¯”ç›´æ¥è´­ä¹°ä¸€ä»½ä¿ç»ˆèº«çš„60ä¸‡å…ƒä¿é¢çš„é‡ç–¾é™©ï¼ŒèŠ±è´¹æ›´å°‘</p><h2 id="å®šæœŸå¯¿é™©ï¼šè§£å†³äººç”Ÿä¸­æœ€å¤§çš„é£é™©">å®šæœŸå¯¿é™©ï¼šè§£å†³äººç”Ÿä¸­æœ€å¤§çš„é£é™©</h2><h3 id="è°é€‚åˆä¹°å¯¿é™©">è°é€‚åˆä¹°å¯¿é™©</h3><p>å¦‚æœè¯´é‡ç–¾é™©çš„èµŒæ³¨æ˜¯ç—…ï¼Œå¯¿é™©çš„èµŒæ³¨å°±æ˜¯å‘½ã€‚å®šæœŸå¯¿é™©èµŒçš„åˆ™æ˜¯ä¸€æ®µæ—¶é—´çš„å‘½ã€‚æ¯”å¦‚æŠ•ä¿äººäº30å¹´å†…èº«æ•…ï¼Œå—ç›Šäººå³å¯è·å¾—ç†èµ”æ¬¾ã€‚</p><p>ä¸€èˆ¬çš„å®šæœŸå¯¿é™©ï¼Œé™¤äº†ä¿éšœèº«æ•…ï¼Œè¿˜ä¼šæŠŠå…¨æ®‹ä¹Ÿè§†ä½œä¸èº«æ•…ç­‰åŒçš„è´£ä»»ã€‚</p><ul><li>å•èº«çš„äººç†åº”å…³å¿ƒçˆ¶æ¯çš„å…»è€é—®é¢˜</li><li>æ–°å©šçš„äººä¼šå¢åŠ å¯¹å¦ä¸€åŠçš„è€ƒè™‘</li><li>æœ‰äº†å­©å­åï¼Œè´£ä»»æ›´é‡</li></ul><h4 id="æ„å¤–é™©å’Œå¯¿é™©å¯¹æ¯”">æ„å¤–é™©å’Œå¯¿é™©å¯¹æ¯”</h4><p>è¿™é‡Œéœ€è¦é¢å¤–å¼ºè°ƒä¸€ç‚¹ã€‚è°ˆåˆ°èº«æ•…é£é™©ï¼Œå¾ˆå¤šäººä¼šè”æƒ³åˆ°æ„å¤–é™©ï¼Œå› ä¸ºå®ƒä¸æ˜¯ä¹Ÿæœ‰èº«æ•…ä¿éšœå—ï¼Ÿ</p><p>â€œç–¾ç—…â€å’Œâ€œæ„å¤–â€ä¸ºå æ¯”æœ€å¤§çš„ä¸¤ç±»æ­»äº¡åŸå› ï¼Œåˆ†åˆ«ä¸º79.3%å’Œ18.9%ã€‚</p><p>æ‰€ä»¥ï¼Œå•çº¯è´­ä¹°æ„å¤–é™©ï¼Œæ˜¯æ— æ³•è§£å†³èº«æ•…çš„é£é™©çš„ã€‚</p><h3 id="å¦‚ä½•é€‰è´­å®šæœŸå¯¿é™©ï¼Ÿ">å¦‚ä½•é€‰è´­å®šæœŸå¯¿é™©ï¼Ÿ</h3><h4 id="ç¡®å®šä¿é¢æ˜¯å…³é”®æ€§çš„ç¬¬ä¸€æ­¥">ç¡®å®šä¿é¢æ˜¯å…³é”®æ€§çš„ç¬¬ä¸€æ­¥</h4><p>ä¿é¢çš„é«˜ä½ï¼Œå†³å®šäº†æŠ•ä¿äººèº«æ•…åä»–çš„å¦»å­ã€çˆ¶æ¯æˆ–è€…å­©å­èƒ½æ‹¿åˆ°å¤šå°‘è¡¥å¿ã€‚å®šæœŸå¯¿é™©çš„ä¿é¢ï¼Œä¸»è¦å–å†³äºä¸‰ä¸ªå› ç´ ã€‚</p><ul><li>ä¸€æ˜¯ä¸ªäººå’Œå®¶åº­çš„å€ºåŠ¡é¢åº¦ï¼Œæ¯”å¦‚æˆ¿è´·ã€è½¦è´·ç­‰ï¼Œç¡®ä¿ä¸€æ–¹èº«æ•…åï¼Œå€ºåŠ¡ä¸è½¬å«åˆ°å¦ä¸€æ–¹æˆ–çˆ¶æ¯èº«ä¸Š</li><li>äºŒæ˜¯å®¶åº­æˆå‘˜çš„åŸºæœ¬ç”Ÿæ´»æˆæœ¬ã€‚å¦‚æœå®¶åº­æ¯å¹´çš„å¼€é”€ä¸º20ä¸‡å…ƒï¼Œé‚£ä¹ˆèº«æ•…ç†èµ”é‡‘è‡³å°‘åº”ä¸º100ä¸‡å…ƒï¼Œä»¥è´Ÿæ‹…å®¶åº­æœªæ¥5â€”10å¹´çš„åŸºæœ¬ç”Ÿæ´»å¼€é”€ã€‚</li><li>ä¸‰æ˜¯çˆ¶æ¯çš„å…»è€æ”¯å‡ºï¼Œè¿™ç¬”è´¹ç”¨çš„è®¡ç®—é€»è¾‘å’Œä¸Šä¸€ä¸ªç±»ä¼¼ã€‚</li></ul><h4 id="å®šæœŸå¯¿é™©è¿˜è¦è€ƒè™‘çš„é—®é¢˜æ˜¯ä¿éšœæœŸé™">å®šæœŸå¯¿é™©è¿˜è¦è€ƒè™‘çš„é—®é¢˜æ˜¯ä¿éšœæœŸé™</h4><p>åˆ°åº•è¦ä¿åˆ°å¤šå¤§å¹´é¾„å‘¢ï¼Ÿæˆ‘ä¸ªäººå»ºè®®ï¼Œä»¥é€€ä¼‘å¹´é¾„ä¸ºæ ‡å‡†ï¼Œ60å²æˆ–70å²çš†å¯ã€‚</p><p>è‡³äºç¼´è´¹å¹´é™çš„é€‰æ‹©ï¼Œæˆ‘å»ºè®®å°½å¯èƒ½æ‹‰é•¿ï¼Œ20å¹´äº¤æˆ–30å¹´äº¤çš†å¯ã€‚ç¼´è´¹å¹´é™è¶Šé•¿ï¼Œå¹´å‡ä¿è´¹è¶Šä½ï¼Œä»è€Œåšåˆ°ç”¨å°½å¯èƒ½å°‘çš„é’±å»æ’¬åŠ¨å°½å¯èƒ½é«˜çš„ä¿é¢ã€‚</p><h4 id="ä¿é¢ã€ä¿éšœæœŸé™å’Œç¼´è´¹å¹´é™éƒ½ç¡®å®šåï¼Œæˆ‘ä»¬åœ¨é€‰è´­å…·ä½“äº§å“æ—¶ï¼Œè¿˜è¦æ ¼å¤–å…³æ³¨ä¸‰ä¸ªæ–¹é¢ï¼š">ä¿é¢ã€ä¿éšœæœŸé™å’Œç¼´è´¹å¹´é™éƒ½ç¡®å®šåï¼Œæˆ‘ä»¬åœ¨é€‰è´­å…·ä½“äº§å“æ—¶ï¼Œè¿˜è¦æ ¼å¤–å…³æ³¨ä¸‰ä¸ªæ–¹é¢ï¼š</h4><ul><li>ç¬¬ä¸€ï¼Œæ ¸ä¿æ˜¯å¦å®½æ¾ã€‚è¿™æ˜¯æœ€é‡è¦çš„ï¼Œå› ä¸ºå¦‚æœå¥åº·å‘ŠçŸ¥éå¸¸ä¸¥æ ¼ï¼Œæƒ³ä¹°ä¹Ÿä¹°ä¸äº†ï¼Œä½•è°ˆå…¶ä»–ï¼Ÿæ¯”å¦‚ï¼Œæœ‰çš„å®šæœŸå¯¿é™©ä¸æ¥å—ä¹™è‚å°ä¸‰é˜³æ‚£è€…ï¼Œæœ‰çš„ä¸æ¥å—é«˜å±èŒä¸šä»ä¸šè€…ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€å®šè¦å¼„æ¸…æ¥šæŠ•ä¿è¦æ±‚å†ä¹°ï¼Œå°½é‡é¿å…ç†èµ”æ—¶çš„æ½œåœ¨çº çº·ï¼Œæ‰èƒ½çœŸæ­£åšåˆ°å®‰å¿ƒã€‚</li><li>ç¬¬äºŒï¼Œé™¤å¤–è´£ä»»å¤šä¸å¤šã€‚å‰æ–‡åœ¨åˆ†æå¦‚ä½•é˜…è¯»ä¿é™©æ¡æ¬¾çš„æ—¶å€™ï¼Œä¸“é—¨å¼ºè°ƒè¦å…³æ³¨é™¤å¤–è´£ä»»ã€‚æ¯”å¦‚ï¼Œæœ‰çš„å®šæœŸå¯¿é™©æ˜ç¡®æŒ‡å‡ºï¼Œå› ä¸ºæˆ˜äº‰ã€å†›äº‹æš´ä¹±å¯¼è‡´çš„æ­»äº¡ï¼Œå®ƒä»¬æ¦‚ä¸è´Ÿè´£ã€‚é‚£ä¹ˆï¼Œå¯¹äºå»ä¸­ä¸œã€éæ´²ç­‰åœ°åŒºæ—…æ¸¸æˆ–å·¥ä½œçš„ä¸­å›½äººæ¥è¯´ï¼Œè¿™ç§å®šæœŸå¯¿é™©å°±å¾—æ…é‡è€ƒè™‘è´­ä¹°äº†ã€‚</li><li>ç¬¬ä¸‰ï¼Œä»·æ ¼ä½ä¸ä½ã€‚å¦‚æœä¸Šé¢å‡ æ¡æ ‡å‡†æ¯”è¾ƒèµ·æ¥éƒ½å·®ä¸å¤šï¼Œé—®é¢˜å°±å˜ç®€å•äº†ï¼šå“ªä¸ªäº§å“ä¾¿å®œå°±é€‰æ‹©å“ªä¸ªã€‚</li></ul><h2 id="å•†ä¸šåŒ»ç–—é™©ï¼šè®©é«˜é¢åŒ»ç–—å¼€æ”¯ä¸å†å¯æ€•">å•†ä¸šåŒ»ç–—é™©ï¼šè®©é«˜é¢åŒ»ç–—å¼€æ”¯ä¸å†å¯æ€•</h2><h3 id="ç¤¾ä¼šåŒ»ç–—ä¿é™©">ç¤¾ä¼šåŒ»ç–—ä¿é™©</h3><p>åœ¨ç”¨åŒ»ä¿å¡çœ‹ç—…çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éƒ½æ¥è§¦è¿‡ä¸€äº›é™Œç”Ÿçš„åè¯ï¼Œæ¯”å¦‚èµ·ä»˜çº¿ã€è¯å“ç›®å½•ã€è‡ªè´¹è¯ã€æŠ¥é”€é¢åº¦ç­‰ã€‚</p><ul><li>èµ·ä»˜çº¿ï¼šçš„æ„æ€æ˜¯ï¼Œæ¯å¹´åªæœ‰èŠ±åˆ°ä¸€å®šé‡‘é¢ï¼Œæ‰èƒ½å¼€å§‹æŠ¥é”€ï¼Œå¦åˆ™å°±éƒ½æ˜¯è‡ªè´¹</li><li>è¯å“ç›®å½•ï¼šæŒ‡çš„æ˜¯åœ¨åŒ»ä¿ç³»ç»Ÿä¸­ï¼Œå¯¹äºåŒ»ç–—æœºæ„å¼€å…·çš„è¯å“åšäº†ä¸åŒåˆ†ç±»ï¼Œä¸åŒç±»å‹çš„è¯å“æŠ¥é”€é¢åº¦ä¹Ÿä¸ä¸€æ ·ï¼Œæœ‰çš„å¯å…¨éƒ¨æŠ¥é”€ï¼Œæœ‰çš„åˆ™åªå¯æŠ¥é”€ä¸€éƒ¨åˆ†ï¼Œè¿˜æœ‰çš„è¯å…¨éƒ¨è¦è‡ªè´¹è´­ä¹°</li><li>é”€é¢åº¦å¾ˆå¥½ç†è§£ï¼Œå³ä½¿è¯å“ã€æ²»ç–—ç­‰éƒ½åœ¨æŠ¥é”€èŒƒå›´å†…ï¼ŒåŒ»ä¿ä¹Ÿä¸æ˜¯æ— é™åˆ¶çš„æŠ¥é”€ï¼Œæ•´ä½“æ¥çœ‹ï¼Œæ¯å¹´çš„æŠ¥é”€é¢åº¦èŒƒå›´ä¸º20ä¸‡~30ä¸‡å…ƒï¼›å¯¹äºç½¹æ‚£é‡å¤§ç–¾ç—…çš„æ‚£è€…æ¥è¯´ï¼Œè¿™ä¸€é¢åº¦æ ¹æœ¬æ— æ³•æ»¡è¶³ä»–ä»¬é•¿æœŸã€æ˜‚è´µçš„æ²»ç–—éœ€æ±‚ã€‚</li></ul><h3 id="åŒ»ä¿ä¸ç®¡çš„ï¼Œè®©å•†ä¸šåŒ»ç–—ä¿é™©æ¥ç®¡">åŒ»ä¿ä¸ç®¡çš„ï¼Œè®©å•†ä¸šåŒ»ç–—ä¿é™©æ¥ç®¡</h3><p>åŒ»ç–—é™©å…¶å®åªåŒ…æ‹¬ä¸¤ç§äº§å“</p><h4 id="ç¬¬ä¸€ç§æ˜¯åŒ…å«é—¨è¯Šè´£ä»»çš„å•†ä¸šåŒ»ç–—ä¿é™©ï¼Œå¯æš‚ä¸”ç§°ä¹‹ä¸ºé—¨è¯ŠåŒ»ç–—ä¿é™©">ç¬¬ä¸€ç§æ˜¯åŒ…å«é—¨è¯Šè´£ä»»çš„å•†ä¸šåŒ»ç–—ä¿é™©ï¼Œå¯æš‚ä¸”ç§°ä¹‹ä¸ºé—¨è¯ŠåŒ»ç–—ä¿é™©</h4><p>è¿™ç§äº§å“ä¿é¢ä¸é«˜ï¼Œä¸€èˆ¬æ˜¯å‡ åƒå…ƒã€‚æœ‰çš„é—¨è¯ŠåŒ»ç–—ä¿é™©ä¼šè®¾ç½®ä¸€ä¸ªå…èµ”é¢ï¼Œæ¯”å¦‚å•æ¬¡100å…ƒæˆ–è€…ç´¯è®¡500å…ƒã€‚å…èµ”é¢å’Œæ”¿åºœåŒ»ä¿èµ·ä»˜çº¿æ˜¯åŒä¸€ä¸ªæ¦‚å¿µï¼Œéƒ½æ˜¯ä¸ºäº†å‡å°‘ç†èµ”æ”¯å‡ºï¼Œå®é™…ä¸Šä¹Ÿèµ·åˆ°äº†é™ä½ä¿è´¹çš„ä½œç”¨ã€‚</p><h4 id="ç¬¬äºŒç§æ˜¯åŒ…å«ä½é™¢è´£ä»»çš„å•†ä¸šåŒ»ç–—ä¿é™©ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºä½é™¢åŒ»ç–—ä¿é™©ã€‚">ç¬¬äºŒç§æ˜¯åŒ…å«ä½é™¢è´£ä»»çš„å•†ä¸šåŒ»ç–—ä¿é™©ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºä½é™¢åŒ»ç–—ä¿é™©ã€‚</h4><p>è¿™ç±»äº§å“çš„ä¿é¢å°±é«˜å¤šäº†ï¼Œå‡ åä¸‡å…ƒç”šè‡³ä¸Šç™¾ä¸‡å…ƒéƒ½å¾ˆå¸¸è§ã€‚å’Œé—¨è¯ŠåŒ»ç–—ä¿é™©ç›¸æ¯”ï¼Œä½é™¢åŒ»ç–—ä¿é™©æ˜¯ä¸‹æ–‡è¦é‡ç‚¹ä»‹ç»çš„äº§å“ã€‚</p><p>èƒ½è¢«ç§°ä½œé£é™©çš„ï¼Œå¿…ç„¶æ„å‘³ç€è´¢åŠ¡ä¸Šçš„å·¨å¤§å½±å“ã€‚æ‰€ä»¥å’Œå‡ åä¸‡ç”šè‡³ä¸Šç™¾ä¸‡å…ƒçš„åŒ»ç–—æ”¯å‡ºç›¸æ¯”ï¼Œå‡ åƒå…ƒçš„é—¨è¯Šã€ä½é™¢è´¹ç”¨ï¼ŒçœŸçš„ç§°ä¸ä¸Šé£é™©ã€‚</p><h3 id="ä¹°äº†é‡ç–¾é™©ï¼Œè¿˜è¦ä¹°åŒ»ç–—é™©å—">ä¹°äº†é‡ç–¾é™©ï¼Œè¿˜è¦ä¹°åŒ»ç–—é™©å—</h3><h4 id="é‡ç–¾é™©å’Œå•†ä¸šåŒ»ç–—æœ€é‡è¦çš„åŒºåˆ«ï¼Œæ˜¯ä¿é™©å…¬å¸çš„ç†èµ”æ–¹å¼ä¸ä¸€æ ·">é‡ç–¾é™©å’Œå•†ä¸šåŒ»ç–—æœ€é‡è¦çš„åŒºåˆ«ï¼Œæ˜¯ä¿é™©å…¬å¸çš„ç†èµ”æ–¹å¼ä¸ä¸€æ ·</h4><ul><li><p>é‡ç–¾é™©æœ‰ç‚¹å„¿åƒä¸€é”¤å­ä¹°å–ï¼Œåªè¦ç¬¦åˆæ¡æ¬¾è§„å®šï¼Œä¿é™©å…¬å¸å°±ä¼šæŠŠç†èµ”æ¬¾ä¸€æ¬¡æ€§æ‰“ç»™ä½ ï¼Œæ— è®ºæ˜¯å‡ ä¸‡å…ƒè¿˜æ˜¯å‡ åä¸‡å…ƒã€‚</p></li><li><p>å•†ä¸šåŒ»ä¿å°±ä¸ä¸€æ ·äº†ï¼ŒèŠ±å¤šå°‘æ‰èƒ½èµ”å¤šå°‘ï¼Œä¿é¢ä»…ä»£è¡¨å¯æŠ¥é”€é¢åº¦çš„ä¸Šé™ï¼Œè€Œä½ ä¸ä¸€å®šèƒ½èŠ±æ‰è¿™ä¹ˆå¤šé’±</p></li></ul><p>å¦‚æœä¸€ä¸ªäººç½¹æ‚£å½±å“æ­£å¸¸ç”Ÿæ´»çš„é‡å¤§ç–¾ç—…ï¼Œé‚£ä»–ä¸»è¦é¢ä¸´çš„é—®é¢˜æœ‰ä¸¤ä¸ªï¼šä¸€æ˜¯æ²»ç–—è´¹ç”¨å¤ªé«˜ï¼Œæç©ºå®¶åº•ï¼›äºŒæ˜¯æ— æ³•ç»§ç»­å·¥ä½œï¼Œå¤±å»æ”¶å…¥ã€‚å‰è€…å¯ä»¥é å•†ä¸šåŒ»ç–—ä¿é™©è§£å†³ï¼Œåè€…åˆ™åªèƒ½é é‡ç–¾é™©è§£å†³ï¼Œä¸¤ç±»ä¿é™©çš„åŠŸèƒ½ä¸ä¸€æ ·ã€‚</p><h4 id="é‡ç–¾é™©å’Œå•†ä¸šåŒ»ç–—ä¿é™©åœ¨å®šä»·æ–¹é¢çš„åŒºåˆ«">é‡ç–¾é™©å’Œå•†ä¸šåŒ»ç–—ä¿é™©åœ¨å®šä»·æ–¹é¢çš„åŒºåˆ«</h4><p>é•¿æœŸé‡ç–¾é™©æ¯å¹´çš„ä¿è´¹æ˜¯æ’å®šçš„ï¼Œå•†ä¸šåŒ»ç–—ä¿é™©çš„ä¿è´¹åˆ™ä¼šéšç€è¢«ä¿é™©äººå¹´é¾„çš„å¢åŠ è€Œä¸Šè°ƒ</p><h4 id="é‡ç–¾é™©å’Œå•†ä¸šåŒ»ç–—ä¿é™©åœ¨ç»­ä¿æ–¹é¢çš„åŒºåˆ«">é‡ç–¾é™©å’Œå•†ä¸šåŒ»ç–—ä¿é™©åœ¨ç»­ä¿æ–¹é¢çš„åŒºåˆ«</h4><p>ç›®å‰å¸‚åœºä¸Šå¤§å¤šæ•°åŒ»ç–—é™©éƒ½æ˜¯ä¸€å¹´æœŸäº§å“ï¼Œå¦‚æœç¬¬äºŒå¹´ä½ æƒ³ç»§ç»­æŠ•ä¿ï¼Œå¾—å…ˆçœ‹çœ‹ä¿é™©æ¡æ¬¾æ˜¯æ€ä¹ˆè§„å®šçš„ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š</p><ul><li>ç¬¬ä¸€ç§æ˜¯ï¼Œå–ä¸å–ç»™ä½ ï¼Œæˆ‘è¯´äº†ç®—ã€‚æŠ•ä¿äººçš„ç»­ä¿ç”³è¯·é¡»ç»ä¿é™©äººå®¡æ ¸åŒæ„ï¼ŒæŠ•ä¿äººç”³è¯·ç»­ä¿æ—¶ï¼Œä¿é™©äººæœ‰æƒå¯¹è´¹ç‡è¿›è¡Œè°ƒæ•´ã€‚</li><li>ç¬¬äºŒç§è§„å®šæ˜¯ï¼Œåªè¦è¿™ä¸ªäº§å“è¿˜åœ¨é”€å”®ï¼Œä¿é™©å…¬å¸å°±è‚¯å®šä¼šå–ç»™ä½ ã€‚è¿ç»­æŠ•ä¿æ—¶ï¼Œä¿é™©äººä¸ä¼šå› ä¸ºæŸä¸€è¢«ä¿é™©äººçš„å¥åº·çŠ¶å†µå˜åŒ–æˆ–å†å²ç†èµ”æƒ…å†µè€Œå•ç‹¬è°ƒæ•´è¯¥è¢«ä¿é™©äººçš„è¿ç»­æŠ•ä¿è´¹ç‡ã€‚</li></ul><h2 id="æ„å¤–é™©ï¼šä¸å®¹å¿½è§†çš„â€œå°â€ä¿é™©">æ„å¤–é™©ï¼šä¸å®¹å¿½è§†çš„â€œå°â€ä¿é™©</h2><h3 id="æ„å¤–é™©ä¿ä»€ä¹ˆã€ä¸ä¿ä»€ä¹ˆ">æ„å¤–é™©ä¿ä»€ä¹ˆã€ä¸ä¿ä»€ä¹ˆ</h3><p>é­å—å¤–æ¥çš„ã€çªå‘çš„ã€éæœ¬æ„çš„ã€éç–¾ç—…çš„ä½¿èº«ä½“å—åˆ°ä¼¤å®³çš„å®¢è§‚äº‹ä»¶ã€‚è‡ªç„¶æ­»äº¡ã€ç–¾ç—…èº«æ•…ã€çŒæ­»ã€è‡ªæ€åŠè‡ªä¼¤å‡ä¸å±äºæ„å¤–ä¼¤å®³ã€‚</p><p>åœ¨æ¯ä»½æ„å¤–é™©çš„ä¿é™©æ¡æ¬¾é‡Œï¼Œä½ éƒ½èƒ½çœ‹åˆ°è¿™æ ·çš„æè¿°ã€‚è¿™æ®µè¯è¡¨è¾¾äº†ä¸¤å±‚æ„æ€ï¼š</p><ul><li><p>ç¬¬ä¸€ï¼Œå¤–æ¥çš„ã€çªå‘çš„ã€éæœ¬æ„çš„ã€éç–¾ç—…çš„ä½¿èº«ä½“å—åˆ°ä¼¤å®³çš„å®¢è§‚äº‹ä»¶ï¼Œå±äºæ„å¤–ï¼›</p></li><li><p>ç¬¬äºŒï¼Œè‡ªç„¶æ­»äº¡ã€ç–¾ç—…èº«æ•…ã€çŒæ­»ã€è‡ªæ€åŠè‡ªä¼¤ï¼Œä¸å±äºæ„å¤–ã€‚</p></li></ul><p>é™¤äº†çŒæ­»ï¼Œæ„å¤–é™©è¿˜æœ‰ä¸€äº›â€œä¸ä¿â€ï¼š</p><ul><li>æ„å¤–é™©é€šå¸¸ä¸ä¿é«˜å±èŒä¸šä»ä¸šè€…</li><li>é™¤äº†ç‰¹å®šäººç¾¤â€œä¸ä¿â€ï¼Œè¿˜æœ‰æŸç±»åœ°åŒºâ€œä¸ä¿â€ã€‚å…³äºæ„å¤–åŒ»ç–—è´£ä»»ï¼Œä¿é™©æ¡æ¬¾ä¸­å¾€å¾€ä¼šæœ‰ä¸€ä¸ªè¡¥å……æè¿°ï¼šåªæ‰¿æ‹…ä¸­åäººæ°‘å…±å’Œå›½å›½å¢ƒå†…ï¼ˆä¸åŒ…æ‹¬æ¸¯æ¾³å°åœ°åŒºï¼‰åŒ»é™¢äº§ç”Ÿçš„åŒ»ç–—è´¹ç”¨å’Œæ”¯å‡ºã€‚</li><li>æœ€åä¸€ä¸ªâ€œä¸ä¿â€ï¼Œæ˜¯æŸäº›è¡Œä¸ºä¸ä¿ã€‚è¢«ä¿é™©äººä»äº‹æ½œæ°´ã€è·³ä¼ã€æ”€å²©è¿åŠ¨ã€æ¢é™©æ´»åŠ¨ã€æ­¦æœ¯æ¯”èµ›ã€æ‘”è·¤æ¯”èµ›ã€ç‰¹æŠ€è¡¨æ¼”ã€èµ›é©¬ã€èµ›è½¦ç­‰é«˜é£é™©æ´»åŠ¨æœŸé—´å‘ç”Ÿçš„æ„å¤–ï¼Œä¸åœ¨æ„å¤–é™©çš„è´£ä»»èŒƒå›´å†…</li></ul><h3 id="é…ç½®æ„å¤–é™©çš„å‡ æ¡åŸåˆ™">é…ç½®æ„å¤–é™©çš„å‡ æ¡åŸåˆ™</h3><h4 id="åŸåˆ™ä¸€ï¼šå¿…é¡»æ¶µç›–æ„å¤–åŒ»ç–—è´£ä»»ã€‚">åŸåˆ™ä¸€ï¼šå¿…é¡»æ¶µç›–æ„å¤–åŒ»ç–—è´£ä»»ã€‚</h4><p>æ„å¤–å¯¼è‡´çš„ç»“æœæ— éä¸¤ç§ï¼šä¼¤æ®‹å’Œæ­»äº¡ã€‚å› æ­¤ï¼Œæ„å¤–é™©ä¿éšœçš„è´£ä»»æœ‰ä¸‰ä¸ªå¿…é€‰é¡¹ï¼šèº«æ•…ã€ä¼¤æ®‹ã€åŒ»ç–—ã€‚</p><p>æ„å¤–å—ä¼¤åï¼Œæˆ‘ä»¬æœ€å¤§çš„éœ€æ±‚å°±æ˜¯åŒ»ç–—è´¹ç”¨è¡¥å¿ã€‚è€ƒè™‘åˆ°å¾ˆå¤šæ„å¤–äº§ç”Ÿçš„åŒ»ç–—è´¹ç”¨åŒ»ä¿éƒ½æ— æ³•æŠ¥é”€ï¼Œæ„å¤–é™©çš„åŒ»ç–—è´£ä»»å°±æ›´é‡è¦äº†ã€‚</p><p>è‡³äºæ„å¤–åŒ»ç–—çš„ä¿é¢ï¼Œä¸€ä¸¤ä¸‡å°±è¶³å¤Ÿäº†ã€‚å¦‚æœæ˜¯ä¸€ä¸¤ä¸‡å…ƒéƒ½æ²»ä¸å¥½çš„æ„å¤–å—ä¼¤ï¼Œä¸€å®šå·²ç»ä¸¥é‡åˆ°éœ€è¦åšæ‰‹æœ¯æˆ–è€…é•¿æœŸä½é™¢æ²»ç–—äº†ï¼Œè¿™æ—¶ç†èµ”çš„è´£ä»»å°±å¯ä»¥äº¤ç»™ä¸Šæ–‡æåˆ°çš„ä½é™¢åŒ»ç–—ä¿é™©äº†ã€‚</p><p>å¦å¤–ï¼Œä½ å¯èƒ½å¬è¯´è¿‡ä½é™¢æ´¥è´´æˆ–ä½é™¢ä¿é™©é‡‘ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼ŒæŠ•ä¿äººæ¯ä½ä¸€å¤©é™¢ï¼Œä¿é™©å…¬å¸å°±ä¼šæ”¯ä»˜ç»™ä»–å‡ ç™¾å…ƒé’±ï¼Œä¸»è¦æ˜¯ä¸ºäº†å¼¥è¡¥ä½é™¢æœŸé—´çš„æ”¶å…¥æŸå¤±ï¼Œé¢‡ä¸ºè´´å¿ƒï¼Œæœ¬è´¨ä¸Šä¹Ÿå±äºæ„å¤–åŒ»ç–—çš„è´£ä»»èŒƒå›´ã€‚ä½é™¢æ´¥è´´å±äºé”¦ä¸Šæ·»èŠ±å‹ä¿é™©ï¼Œè€Œä¸”è¦èŠ±é’±è´­ä¹°ï¼Œæ‰€ä»¥æœ‰æ²¡æœ‰éƒ½æ— æ‰€è°“ã€‚</p><h4 id="åŸåˆ™äºŒï¼šä¸€èˆ¬æ„å¤–èº«æ•…çš„ä¿é¢åº”è¶³å¤Ÿé«˜ã€‚">åŸåˆ™äºŒï¼šä¸€èˆ¬æ„å¤–èº«æ•…çš„ä¿é¢åº”è¶³å¤Ÿé«˜ã€‚</h4><p>åœ¨è¿™é‡Œæˆ‘è¦æé†’å¤§å®¶æ³¨æ„æŸäº›ä¿é™©å…¬å¸çš„â€œå¥—è·¯â€ã€‚å½“ä½ çœ‹åˆ°ä¸€ä¸ªç±»ä¼¼äºâ€œç™¾ä¸‡èº«ä»·æ„å¤–é™©â€çš„æ‰“æŠ˜äº§å“æ—¶ï¼Œè¯·ä¸€å®šå¼„æ¸…æ¥šå®ƒæ‰€è¯´çš„ç™¾ä¸‡èº«ä»·åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰ä¸ªäº§å“é¡µé¢æ˜¯è¿™ä¹ˆæè¿°è¯¥äº§å“çš„ï¼š</p><ul><li><p>ä¸€èˆ¬æ„å¤–èº«æ•…ï¼š10ä¸‡å…ƒ</p></li><li><p>èˆªç©ºæ„å¤–èº«æ•…ï¼š100ä¸‡å…ƒ</p></li></ul><p>æˆ‘æ›´å–œæ¬¢ä»¥ä¸‹è¿™ç±»ä¿é™©ï¼š</p><ul><li><p>ä¸€èˆ¬æ„å¤–èº«æ•…ï¼š100ä¸‡å…ƒ</p></li><li><p>èˆªç©ºæ„å¤–èº«æ•…ï¼š200ä¸‡å…ƒ</p></li></ul><h4 id="åŸåˆ™ä¸‰ï¼šä¸åŒäººç¾¤çš„æ„å¤–é™©ï¼Œä¾§é‡ç‚¹ä¸ä¸€æ ·ã€‚">åŸåˆ™ä¸‰ï¼šä¸åŒäººç¾¤çš„æ„å¤–é™©ï¼Œä¾§é‡ç‚¹ä¸ä¸€æ ·ã€‚</h4><ul><li><p>å¯¹äºèŒåœºç™½é¢†æ¥è¯´ï¼Œæ„å¤–é™©æ—¢è¦æœ‰è¶³å¤Ÿçš„èº«æ•…è¡¥å¿ï¼ˆç”¨äºå¼¥è¡¥å®¶åº­ç»æµæŸå¤±ï¼‰ï¼Œä¹Ÿè¦ä¿è¯å—ä¼¤åæœ‰é’±æ²»ç–—ï¼›</p></li><li><p>ä½†å¯¹äºå­©å­å’Œè€äººæ¥è¯´ï¼Œèº«æ•…è¡¥å¿å°±æ²¡æœ‰åŒ»ç–—è´¹ç”¨è¡¥å¿é‡è¦ï¼Œæ¯•ç«Ÿä»–ä»¬ä¸æ˜¯å®¶é‡Œçš„é¡¶æ¢æŸ±ã€‚</p></li><li><p>å› æ­¤ï¼Œå­©å­å’Œè€äººçš„æ„å¤–é™©ï¼Œåº”ä¾§é‡äºè€ƒè™‘æå‡æ„å¤–åŒ»ç–—çš„ä¿é¢ï¼Œè€Œæ²¡æœ‰å¿…è¦è¿½æ±‚æ„å¤–èº«æ•…çš„é«˜ä¿é¢ã€‚</p></li></ul><h4 id="åŸåˆ™å››ï¼šä¿éšœæ—¶é—´ä¸€å¹´å°±å¤Ÿäº†ã€‚">åŸåˆ™å››ï¼šä¿éšœæ—¶é—´ä¸€å¹´å°±å¤Ÿäº†ã€‚</h4><p>ä¹‹å‰åœ¨ä»‹ç»ä¸€å¹´æœŸäº§å“ç‰¹å¾çš„æ—¶å€™æˆ‘æè¿‡ï¼Œæ„å¤–é™©å’ŒåŒ»ç–—é™©å¤§å¤šä¼šè®¾è®¡æˆçŸ­æœŸé™©ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå°±å¯ä»¥éšæ—¶æŒ‰ç…§æ„å¤–å‘ç”Ÿç‡å’ŒåŒ»ç–—æˆæœ¬çš„æ³¢åŠ¨è¿›è¡Œä»·æ ¼è°ƒæ•´ã€‚å› æ­¤ï¼Œæ¯å¹´å„å®¶å…¬å¸çš„æ„å¤–é™©å±‚å‡ºä¸ç©·ï¼Œå¯èƒ½å»å¹´ä¹°çš„äº§å“ï¼Œåˆ°äº†æ˜å¹´å°±æ²¡ä»€ä¹ˆç«äº‰åŠ›äº†ï¼Œè¿™æ—¶ç›´æ¥æ¢ä¸€å®¶å…¬å¸è´­ä¹°å°±å¥½ã€‚ç”±äºæ„å¤–é™©çš„å‡ ä¸ªåŸºæœ¬è´£ä»»éƒ½æ²¡æœ‰ç­‰å¾…æœŸè¿™ä¸€è¯´ï¼Œæ‰€ä»¥å¯ä»¥åšåˆ°æ— ç¼è¡”æ¥ã€‚</p><h1 id="04-ä¼˜åŒ–é…ç½®ï¼šç»™ä¿é™©å‡ä¸ªçº§">04ã€€ä¼˜åŒ–é…ç½®ï¼šç»™ä¿é™©å‡ä¸ªçº§</h1><h2 id="åƒæœ‰é’±äººä¸€æ ·çœ‹ç—…">åƒæœ‰é’±äººä¸€æ ·çœ‹ç—…</h2><h3 id="é«˜ç«¯åŒ»ç–—ï¼Œé«˜ç«¯åœ¨å“ªé‡Œï¼Ÿ">é«˜ç«¯åŒ»ç–—ï¼Œé«˜ç«¯åœ¨å“ªé‡Œï¼Ÿ</h3><ul><li>ç¬¬ä¸€ï¼Œä¿é¢æ›´é«˜ã€‚å‡ åä¸‡å…ƒç”šè‡³å‡ ç™¾ä¸‡å…ƒçš„ä¿é¢éƒ½æ˜¯å°èœä¸€ç¢Ÿï¼Œä»å‡ åƒä¸‡å…ƒåˆ°ä¸è®¾é™ï¼Œé«˜ç«¯åŒ»ç–—çš„ä¿é¢å®Œå…¨è¶…ä¹ä½ çš„æƒ³è±¡ã€‚</li><li>ç¬¬äºŒï¼ŒåŒ»é™¢æ›´å¤šã€æ›´é«˜ç«¯ã€‚ä»ä¸‰ç”²åŒ»é™¢çš„ç‰¹éœ€éƒ¨ã€å›½é™…éƒ¨ï¼Œåˆ°ç§ç«‹åŒ»é™¢ã€å›½é™…åŒ»é™¢ï¼Œè€Œä¸”ä¸é™ä¸­å›½åœ°åŒºï¼Œä»äºšå¤ªåœ°åŒºåˆ°å…¨çƒï¼ŒåŸºæœ¬è¦†ç›–æ‰€æœ‰ç±»å‹çš„åŒ»ç–—æœºæ„ã€‚</li><li>ç¬¬ä¸‰ï¼Œä¿éšœæ›´å…¨é¢ã€‚é™¤äº†ä¼ ç»Ÿçš„é—¨è¯Šã€ä½é™¢ä¸¤å¤§å—ä¹‹å¤–ï¼Œé«˜ç«¯åŒ»ç–—é™©è¿˜åŒ…å«åˆ†å¨©ã€ç‰™ç§‘ã€çœ¼ç§‘ã€ä½“æ£€ç­‰è´£ä»»ï¼Œè¦çŸ¥é“ï¼Œè¿™äº›æ²»ç–—é€šå¸¸éƒ½åœ¨å¸¸è§„åŒ»ç–—é™©çš„é™¤å¤–é¡¹ç›®é‡Œï¼Œä¸€èˆ¬åŒ»ç–—é™©éƒ½ä¸ç®¡ã€‚</li><li>ç¬¬å››ï¼Œå¢å€¼æœåŠ¡æ›´å¤šã€‚</li><li>ç¬¬äº”ï¼Œç†èµ”ä½“éªŒæ›´å¥½ã€‚</li></ul><h2 id="ä¿é™©èƒ½ä¸ºæˆ‘çš„å…»è€åšä»€ä¹ˆï¼Ÿ">ä¿é™©èƒ½ä¸ºæˆ‘çš„å…»è€åšä»€ä¹ˆï¼Ÿ</h2><h3 id="è¯¥ä¸è¯¥ä¹°å…»è€ä¿é™©ï¼Ÿ">è¯¥ä¸è¯¥ä¹°å…»è€ä¿é™©ï¼Ÿ</h3><h3 id="å¯ä¸å¯ä»¥æŠŠä¿é™©å½“ä½œæŠ•èµ„æ–¹å¼">å¯ä¸å¯ä»¥æŠŠä¿é™©å½“ä½œæŠ•èµ„æ–¹å¼</h3><p>è¦å›ç­”ä¸Šé¢ä¸¤ä¸ªé—®é¢˜ï¼Œéœ€è¦ä½¿ç”¨excelä¸­çš„IRRå…¬å¼è®¡ç®—å†…éƒ¨æ”¶ç›Šç‡ï¼Œå¦‚æœå†…éƒ¨æ”¶ç›Šç‡èƒ½å¤Ÿè¾¾åˆ°é¢„æœŸå¹¶ä¸”ç°åœ¨æ‰‹å¤´æœ‰é’±å°±å¯ä»¥ä¹°ã€‚</p><p>æ¯”å¦‚å¹´å¤åˆ©6%ä»¥ä¸Šå°±èƒ½è¾¾åˆ°é¢„æœŸï¼Œå¦åˆ™ä¸å¦‚ä¹°å€ºåˆ¸åŸºé‡‘æˆ–è€…æŒ‡æ•°å‹åŸºé‡‘ã€‚</p><h2 id="è¯¥å»é¦™æ¸¯ä¹°ä¿é™©å—ï¼Ÿ">è¯¥å»é¦™æ¸¯ä¹°ä¿é™©å—ï¼Ÿ</h2><p>ç•¥</p><h1 id="05-ä¸ªæ€§åŒ–å®šåˆ¶ï¼šä¿é™©æ–¹æ¡ˆï¼Œä½ è‡ªå·±è¯´äº†ç®—">05 ä¸ªæ€§åŒ–å®šåˆ¶ï¼šä¿é™©æ–¹æ¡ˆï¼Œä½ è‡ªå·±è¯´äº†ç®—</h1><h2 id="å¦‚ä½•ç»™å­©å­ä¹°ä¿é™©">å¦‚ä½•ç»™å­©å­ä¹°ä¿é™©</h2><h3 id="å…ˆåˆ«ç€æ€¥ä¹°å•†ä¸šä¿é™©">å…ˆåˆ«ç€æ€¥ä¹°å•†ä¸šä¿é™©</h3><p>å’Œå¤§äººä¸€æ ·ï¼Œå­©å­ä¹Ÿæ˜¯å¯ä»¥å‚åŠ æ”¿åºœåŒ»ä¿çš„ã€‚åœ¨é…ç½®å•†ä¸šä¿é™©ä¹‹å‰ï¼Œçˆ¶æ¯ä¸€å®šè¦å‚è€ƒå½“åœ°çš„åŒ»ä¿æ”¿ç­–ä¸ºå­©å­åŠç†å°‘å„¿åŒ»ä¿ã€‚</p><p>å°‘å„¿åŒ»ä¿æœ¬è´¨ä¸Šæ˜¯é’ˆå¯¹å„¿ç«¥ç½¹æ‚£é‡å¤§ç–¾ç—…æä¾›çš„é£é™©ä¿éšœã€‚</p><p>æœ‰æ²¡æœ‰åŒ»ä¿ä¹Ÿä¼šå½±å“å­©å­æŠ•ä¿å•†ä¸šä¿é™©çš„ä»·æ ¼ã€‚å°¤å…¶æ˜¯åŒ»ç–—é™©ï¼Œè¢«ä¿é™©äººæœ‰åŒ»ä¿çš„åŒ»ç–—é™©ä»·æ ¼æ›´ä½ã€‚</p><h3 id="å­©å­ä¼šé¢ä¸´å“ªäº›é£é™©">å­©å­ä¼šé¢ä¸´å“ªäº›é£é™©</h3><ul><li>é£é™©ä¸€ï¼šèº«æ‚£å±é‡ç–¾ç—…<ul><li>å­©å­ä¸€æ—¦æ‚£å±é‡ç–¾ç—…ï¼Œé™¤äº†éœ€è¦é•¿æœŸæŠ•å…¥é«˜é¢æ²»ç–—è´¹ç”¨ï¼Œçˆ¶æ¯ä¹Ÿå¯èƒ½ä¸ºäº†ç…§é¡¾å­©å­è€Œè¾æ‰å·¥ä½œã€‚</li><li>å› æ­¤ï¼Œé‡ç–¾é™©å’Œé«˜ä¿é¢ä½é™¢åŒ»ç–—é™©æ˜¯åº”è¯¥é¦–å…ˆä¸ºå­©å­é…ç½®çš„ä¿é™©ã€‚</li><li>é‡ç–¾é™©çš„ä»·å€¼åœ¨äºï¼Œç½¹æ‚£é‡ç–¾åä¸€æ¬¡æ€§è·å¾—å®šé¢èµ”å¿ï¼Œå¯ä½œä¸ºè‡ªè´¹æ²»ç–—è´¹ç”¨å’Œå®¶åº­æ”¶å…¥ä¸­æ–­çš„è¡¥å¿ã€‚</li><li>é«˜é¢ä½é™¢åŒ»ç–—é™©çš„ä»·å€¼åœ¨äºåº”å¯¹é«˜é¢çš„åŒ»ç–—è´¹ç”¨ï¼Œå°¤å…¶æ˜¯è®¸å¤šåŒ»ä¿èŒƒå›´å¤–çš„è‡ªè´¹é¡¹ç›®</li></ul></li><li>é£é™©äºŒï¼šå‘ç”Ÿæ„å¤–å—ä¼¤</li><li>é£é™©ä¸‰ï¼šèº«æ‚£ä¸€èˆ¬ç–¾ç—…</li></ul><h3 id="é…ç½®å„¿ç«¥å•†ä¸šä¿é™©">é…ç½®å„¿ç«¥å•†ä¸šä¿é™©</h3><h4 id="å­©å­ä¸è¯¥ä¹°å“ªäº›ä¿é™©">å­©å­ä¸è¯¥ä¹°å“ªäº›ä¿é™©</h4><ul><li>åŒ…å«èº«æ•…è´£ä»»çš„æ„å¤–é™©ä¸åœ¨æˆ‘ä»¬çš„è®¨è®ºèŒƒå›´å†…</li><li>å®šæœŸå¯¿é™©ã€ç»ˆèº«å¯¿é™©ä¹Ÿæ— éœ€è´­ä¹°</li><li>é™¤æ„ä¹‰ä¸å¤§çš„èº«æ•…è´£ä»»å¤–ï¼Œä¸ºå­©å­è´­ä¹°æ•™è‚²é‡‘ã€å…»è€é‡‘ï¼Œä¼˜å…ˆçº§ä¹Ÿä¸é«˜</li></ul><p><strong>å­©å­çœŸæ­£éœ€è¦çš„å•†ä¸šä¿é™©å…¶å®åªæœ‰ä¸‰æ¬¾ï¼šé‡å¤§ç–¾ç—…é™©ã€æ„å¤–é™©ã€é«˜é¢ä½é™¢åŒ»ç–—é™©ã€‚</strong></p><h4 id="å…³äºå­©å­çš„é‡ç–¾é™©">å…³äºå­©å­çš„é‡ç–¾é™©</h4><p>è¯·è®°ä½ä¸€ä¸ªäº‹å®ï¼šå°‘å„¿ç½¹æ‚£é‡å¤§ç–¾ç—…çš„æ¦‚ç‡éå¸¸ä½ã€‚è¿™ç›´æ¥å†³å®šäº†å„¿ç«¥é‡ç–¾é™©çš„ä»·æ ¼ååˆ†ä¾¿å®œã€‚å› æ­¤ï¼Œä¸ºå­©å­é…ç½®é‡ç–¾é™©ï¼Œä¸€å®šè¦æŠ“ä½ä»·æ ¼ä¼˜åŠ¿ï¼Œå°½å¯èƒ½æé«˜ä¿é¢ï¼Œæ‹‰é•¿æœŸé™ã€‚éƒ½æ˜¯100ä¸‡å…ƒçš„ç»ˆèº«é‡ç–¾é™©ä¿é¢ï¼Œ30å¤šå²ç”·æ€§çš„è´­ä¹°ä»·æ ¼ï¼Œå¯ä»¥è¾¾åˆ°å°å­©å­çš„ä¸¤å€å¤šã€‚</p><p>å­©å­çš„é‡ç–¾é™©åº”è¯¥ä¹°ä¿ç»ˆèº«æˆ–è€…70å²çš„ï¼Œä¸è¦ä¹°ä¿éšœ30å¹´ï¼Œä¸‰åå¹´ä¹‹åå­©å­æ‰ä¸‰ã€å››åå²ï¼Œé‚£æ—¶æ–­ä¿å†æ–°ä¹°ä¿é™©ä¼šæ›´è´µã€‚</p><h4 id="å­©å­æœ€å¥½çš„ä¿é™©æ˜¯çˆ¶æ¯">å­©å­æœ€å¥½çš„ä¿é™©æ˜¯çˆ¶æ¯</h4><p>çˆ¶æ¯è‡ªèº«çš„å¥åº·ä»¥åŠç¨³å®šã€æŒç»­çš„èµšé’±èƒ½åŠ›ï¼Œæ˜¯å­©å­æœ€é‡è¦çš„ä¿é™©ã€‚</p><p><strong>æ€»ç»“ä¸€ä¸‹ä¸ºå­©å­é…ç½®ä¿é™©çš„å‡ ä¸ªå…³é”®ç‚¹ã€‚</strong></p><ol><li><p><strong>ä½œä¸ºçˆ¶æ¯ï¼Œå…ˆæŠŠè‡ªå·±çš„ä¿é™©é…ç½®å¥½ï¼Œå› ä¸ºä½ æ‰æ˜¯å­©å­æœ€å¤§çš„â€œä¿é™©â€ï¼›</strong></p></li><li><p><strong>åœ¨è´­ä¹°ä»»ä½•å•†ä¸šä¿é™©ä¹‹å‰ï¼Œå…ˆä¸ºå­©å­åŠç†å¥½å½“åœ°çš„å°‘å„¿åŒ»ä¿ï¼Œè¿™æ˜¯æ”¿åºœç»™äºˆçš„ç¦åˆ©ï¼Œä¸€å®šè¦å……åˆ†åˆ©ç”¨ï¼›</strong></p></li><li><p><strong>ç»“åˆè‡ªèº«é¢„ç®—ï¼Œé¦–å…ˆé…ç½®é«˜ä¿é¢çš„é‡å¤§ç–¾ç—…é™©å’Œä½é™¢åŒ»ç–—é™©ï¼Œå…¶ä»–çš„ä¿é™©åˆ™é‡åŠ›è´­ä¹°ã€‚</strong></p></li></ol><h2 id="å¦‚ä½•ç»™çˆ¶æ¯ä¹°ä¿é™©">å¦‚ä½•ç»™çˆ¶æ¯ä¹°ä¿é™©</h2><h3 id="ä¸€ä¸ªä¸æ–­å¦¥åé€€è®©çš„è¿‡ç¨‹">ä¸€ä¸ªä¸æ–­å¦¥åé€€è®©çš„è¿‡ç¨‹</h3><p>å…¶å®çˆ¶æ¯é¢ä¸´çš„é£é™©éå¸¸ç®€å•ï¼Œå°±æ˜¯ç–¾ç—…å¼•å‘çš„è´¢åŠ¡é£é™©ã€‚</p><p>è¿™æ ·çœ‹æ¥ï¼Œç»™çˆ¶æ¯é…ç½®ä¿é™©ï¼Œä¸»è¦è€ƒè™‘çš„åº”è¯¥æ˜¯é‡ç–¾é™©ã€åŒ»ç–—é™©å’Œæ„å¤–é™©ã€‚</p><p>å¹´é¾„è¶…è¿‡60å²çš„äººæƒ³è¦æŠ•ä¿é‡ç–¾é™©å’ŒåŒ»ç–—é™©ä¼šæœ‰å¾ˆå¤šé™åˆ¶ï¼š</p><ul><li>ç¬¬ä¸€ï¼Œå¹´é¾„é™åˆ¶ã€‚<ul><li>å‡ ä¹æ‰€æœ‰é‡ç–¾é™©å’ŒåŒ»ç–—é™©çš„æŠ•ä¿å¹´é¾„éƒ½åœ¨0~60å²ã€‚å¯¹é‡ç–¾é™©è€Œè¨€ï¼Œ55å²çš„æŠ•ä¿å¹´é¾„ä¸Šé™æ˜¯æ™®éè§„åˆ™ã€‚</li></ul></li><li>ç¬¬äºŒï¼Œä¿é¢é™åˆ¶ã€‚<ul><li>åŒæ ·ä¸€ä»½ä¿é™©ï¼Œ30å²çš„äººå’Œ50å²çš„äººå¯äº«å—çš„ä¿é¢ä¸Šé™æ˜¯ä¸ä¸€æ ·çš„ã€‚</li><li>ä»¥é‡ç–¾é™©ä¸ºä¾‹ï¼Œå¦‚æœåœ¨ç½‘ä¸Šç›´æ¥æŠ•ä¿ï¼Œ30å²çš„è¢«ä¿é™©äººçš„ä¿é¢ä¸Šé™åŸºæœ¬ä¸º50ä¸‡~60ä¸‡å…ƒï¼Œè€Œ50å²çš„è¢«ä¿é™©äººçš„ä¿é¢ä¸Šé™åªæœ‰10ä¸‡å…ƒã€‚</li></ul></li><li>ç¬¬ä¸‰ï¼Œä¿è´¹å€’æŒ‚ã€‚<ul><li>ä¸€ä½55å²çš„ç”·æ€§è´­ä¹°ä¿é¢ä¸º10ä¸‡å…ƒçš„é‡ç–¾é™©ï¼Œæ¯å¹´éœ€è¦äº¤3500å…ƒå·¦å³ï¼Œäº¤20å¹´ï¼Œæ€»è®¡7ä¸‡å…ƒçš„æ”¯å‡ºå’Œ10ä¸‡å…ƒçš„ä¿é¢ç›¸æ¯”ï¼Œå·®åˆ«ä¸å¤§ã€‚</li></ul></li><li>ç¬¬å››ï¼Œå¥åº·å‘ŠçŸ¥ä¸ç¬¦ã€‚<ul><li>æ‚£æœ‰é«˜è¡€å‹ã€å¿ƒè„ç—…ã€ç³–å°¿ç—…çš„è€å¹´äººï¼Œå¯ä»¥ç›´æ¥å’Œé‡å¤§ç–¾ç—…é™©ã€ä½é™¢åŒ»ç–—é™©è¯´å†è§äº†</li><li>ä¿é™©å…¬å¸ä¹Ÿæ„è¯†åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œäºæ˜¯æƒ³äº†ä¸€ä¸ªåŠæ³•ï¼šåŒæ–¹å„é€€ä¸€æ­¥ã€‚ä¿é™©å…¬å¸æŠŠä¿éšœèŒƒå›´ç¼©å°ï¼Œé™åˆ¶ä¹Ÿéšä¹‹å‡å°‘ã€‚ä½†è¿™ä¸ªä¿éšœèŒƒå›´ä¸èƒ½å¤ªå°ï¼Œå¾—æœ‰å­˜åœ¨çš„æ„ä¹‰ã€‚</li><li>äºæ˜¯ï¼Œé˜²ç™Œç±»ä¿é™©åº”è¿è€Œç”Ÿã€‚é‡ç–¾é™©æ¶µç›–çš„å‡ åç§ç–¾ç—…ï¼Œåªä¿ç•™ç¬¬ä¸€é¡¹ï¼Œå³æ¶æ€§è‚¿ç˜¤ï¼›ä½é™¢åŒ»ç–—é™©æ¶µç›–çš„æ‰€æœ‰ç–¾ç—…çš„ä½é™¢è´£ä»»ï¼Œä¹Ÿåªä¿ç•™ä¸€é¡¹ï¼Œå³ç™Œç—‡ä½é™¢è´£ä»»ã€‚</li><li>è¿™ç§åšæ³•æœ€å¤§çš„å¥½å¤„ï¼Œå°±æ˜¯å¥åº·å‘ŠçŸ¥çš„å†…å®¹å¤§å¹…å‡å°‘ã€‚åªè¦ä¸æ˜¯æ˜“å¼•å‘ç™Œç—‡çš„ç—‡çŠ¶ï¼ˆè‚éƒ¨ç–¾ç—…ã€å™¨å®˜æˆ–ç»„ç»‡çš„ç»“èŠ‚ç­‰ï¼‰ï¼Œä¿é™©å…¬å¸éƒ½ä¸ä»‹æ„ï¼Œé«˜è¡€å‹ã€ç³–å°¿ç—…æ‚£è€…ä¹Ÿå¯ä»¥æŠ•ä¿ã€‚æ¯•ç«Ÿï¼Œé«˜è¡€å‹å¯¼è‡´çš„æ€¥æ€§å¿ƒæ¢—å’Œç³–å°¿ç—…å¯¼è‡´çš„ç»ˆæœ«æœŸè‚¾ç—…æˆ–æˆªè‚¢ï¼Œéƒ½ä¸åœ¨é˜²ç™Œç±»ä¿é™©çš„è´£ä»»èŒƒå›´å†…ã€‚</li></ul></li></ul><h3 id="å…­åˆ†é è§„åˆ’ï¼Œå››åˆ†é å¿ƒæ€">å…­åˆ†é è§„åˆ’ï¼Œå››åˆ†é å¿ƒæ€</h3><p>å“ªæ€•æœ‰é‚£ä¹ˆå¤šçš„é™åˆ¶ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥è´­ä¹°æ„å¤–é™©ã€é˜²ç™Œé™©ã€é˜²ç™ŒåŒ»ç–—é™©å’Œç³–å°¿ç—…ç‰¹å®šç–¾ç—…é‡ç–¾é™©ã€‚</p><h4 id="å¦‚æœä½ æƒ³ç®€æ˜æ‰¼è¦åœ°æŒæ¡ç»™çˆ¶æ¯ä¹°ä¿é™©çš„æŠ€å·§ï¼Œè¯·è®°ä½ä»¥ä¸‹å‡ ç‚¹ã€‚">å¦‚æœä½ æƒ³ç®€æ˜æ‰¼è¦åœ°æŒæ¡ç»™çˆ¶æ¯ä¹°ä¿é™©çš„æŠ€å·§ï¼Œè¯·è®°ä½ä»¥ä¸‹å‡ ç‚¹ã€‚</h4><ul><li><p>ç¬¬ä¸€ï¼Œç¡®ä¿çˆ¶æ¯åŒæ–¹éƒ½æœ‰ç¤¾ä¼šåŒ»ç–—ä¿é™©ã€‚ä¸ç®¡æ˜¯åŸå¸‚çš„å±…æ°‘åŒ»ä¿ï¼Œè¿˜æ˜¯å†œæ‘çš„â€œæ–°å†œåˆâ€ï¼Œæ²¡æœ‰çš„è¯ï¼Œèµ¶ç´§å…ˆæŠŠç¤¾ä¼šåŒ»ä¿åŠå¥½ã€‚</p></li><li><p>ç¬¬äºŒï¼Œé‡åˆ°ç–‘éš¾æ‚ç—‡ï¼Œä¸å°‘äººä¼šé€‰æ‹©å¸¦çˆ¶æ¯æ¥åŒ—ä¸Šå¹¿ç­‰å¤§åŸå¸‚å°±è¯Šã€‚æ‰€ä»¥ï¼Œè¯·æå‰ç ”ç©¶å¥½åŒ»ä¿çš„å¼‚åœ°ç»“ç®—æµç¨‹ï¼Œç¡®ä¿ä¸è®©åŒ»ä¿â€œç™½äº¤â€ï¼Œè¿™ä¸€ç‚¹éå¸¸æœ‰å¿…è¦ã€‚</p></li><li><p>ç¬¬ä¸‰ï¼Œè¯¦ç»†äº†è§£çˆ¸å¦ˆçš„èº«ä½“å¥åº·æƒ…å†µï¼Œå¯¹ç—‡ä¸‹è¯ä¹°ä¿é™©ã€‚</p></li></ul><h2 id="å¦‚ä½•ç»™è‡ªå·±ä¹°ä¿é™©">å¦‚ä½•ç»™è‡ªå·±ä¹°ä¿é™©</h2><h3 id="18å²ä¿é™©æ¸…å•">18å²ä¿é™©æ¸…å•</h3><ul><li>å­¦ç”Ÿå›¢ä½“ä¿é™©ï¼šåŒ…å«æ„å¤–èº«æ•…/ä¼¤æ®‹è´£ä»»ï¼Œæ„å¤–åŒ»ç–—è´£ä»»ï¼Œä½é™¢åŒ»ç–—è´£ä»»ï¼›é¢„ç®—ä¸º200å…ƒã€‚</li><li>æˆ–è‡ªå·±æŠ•ä¿ï¼š<ul><li>æ„å¤–é™©ï¼šåŒ…å«æ„å¤–èº«æ•…/ä¼¤æ®‹è´£ä»»ï¼Œæ„å¤–åŒ»ç–—è´£ä»»ï¼›é¢„ç®—ä¸º200å…ƒï¼ˆä¿é¢ä¸º50ä¸‡å…ƒï¼‰ã€‚</li><li>åŒ»ç–—é™©ï¼šåŒ…å«ç–¾ç—…å¯¼è‡´çš„ä½é™¢åŒ»ç–—è´£ä»»ï¼Œé¢„ç®—ä¸º200å…ƒã€‚</li></ul></li></ul><h4 id="18å²ä¿éšœé€Ÿè§ˆ">18å²ä¿éšœé€Ÿè§ˆ</h4><ul><li><p>èº«æ•…è¡¥å¿ï¼ˆä»…é™æ„å¤–åŸå› ï¼‰ï¼š50ä¸‡å…ƒã€‚</p></li><li><p>æ„å¤–åŒ»ç–—è¡¥å¿ï¼š1ä¸‡å…ƒï¼ˆä¸Šé™ï¼‰ã€‚</p></li><li><p>ä½é™¢åŒ»ç–—è¡¥å¿ï¼š100ä¸‡å…ƒï¼ˆä¸Šé™ï¼‰ã€‚</p></li></ul><h3 id="22å²æ–°å¢ä¿é™©æƒ…å†µ">22å²æ–°å¢ä¿é™©æƒ…å†µ</h3><p>å®šæœŸå¯¿é™©Aï¼šå—ç›Šäººä¸ºçˆ¶æ¯ï¼Œä¿é¢å¤§çº¦ç›¸å½“äºçˆ¶æ¯5å¹´çš„é€€ä¼‘é‡‘ï¼›é¢„ç®—ä¸ºæ¯å¹´500å…ƒï¼ˆä¿é¢50ä¸‡å…ƒï¼Œä¿éšœæœŸ30å¹´ï¼Œç¼´è´¹æœŸ30å¹´ï¼‰ã€‚</p><h4 id="ä¿éšœé€Ÿè§ˆ">ä¿éšœé€Ÿè§ˆ</h4><ul><li><p>èº«æ•…è¡¥å¿ï¼ˆä¸é™æ­»äº¡åŸå› ï¼‰ï¼š50ä¸‡å…ƒã€‚</p></li><li><p>é¢å¤–èº«æ•…è¡¥å¿ï¼ˆä»…é™æ„å¤–åŸå› ï¼‰ï¼š50ä¸‡å…ƒã€‚</p></li><li><p>æ„å¤–åŒ»ç–—è¡¥å¿ï¼š1ä¸‡å…ƒï¼ˆä¸Šé™ï¼‰ã€‚</p></li><li><p>ä½é™¢åŒ»ç–—è¡¥å¿ï¼š100ä¸‡å…ƒï¼ˆä¸Šé™ï¼‰ã€‚</p></li></ul><h3 id="28å²æ–°å¢ä¿é™©æƒ…å†µ"><strong>28å²</strong>æ–°å¢ä¿é™©æƒ…å†µ</h3><ul><li><p>å®šæœŸå¯¿é™©Bï¼šå—ç›Šäººä¸ºæ³•å®šå—ç›Šäººï¼Œä¿é¢çº¦ç­‰äº5å€å¹´è–ªï¼›</p></li><li><p>é¢„ç®—ä¸ºæ¯å¹´1000å…ƒï¼ˆä¿é¢80ä¸‡å…ƒï¼Œä¿åˆ°60å²ï¼Œç¼´è´¹æœŸ30å¹´ï¼‰ã€‚</p></li><li><p>é‡å¤§ç–¾ç—…é™©Aï¼šä¿é¢çº¦ç­‰äºè´­ä¹°æ—¶çš„3å€å¹´è–ªï¼›é¢„ç®—ä¸ºæ¯å¹´5000å…ƒï¼ˆä¿é¢50ä¸‡å…ƒï¼Œä¿åˆ°70å²ï¼Œç¼´è´¹æœŸ30å¹´ï¼‰ã€‚</p></li></ul><h4 id="28å²ä¿éšœé€Ÿè§ˆ">28å²ä¿éšœé€Ÿè§ˆ</h4><ul><li><p>èº«æ•…è¡¥å¿ï¼ˆä¸é™æ­»äº¡åŸå› ï¼‰ï¼š130ä¸‡å…ƒã€‚</p></li><li><p>é¢å¤–èº«æ•…è¡¥å¿ï¼ˆä»…é™æ„å¤–åŸå› ï¼‰ï¼š50ä¸‡å…ƒã€‚</p></li><li><p>æ„å¤–åŒ»ç–—è¡¥å¿ï¼š1ä¸‡å…ƒï¼ˆä¸Šé™ï¼‰ã€‚</p></li><li><p>ä½é™¢åŒ»ç–—è¡¥å¿ï¼š100ä¸‡å…ƒï¼ˆä¸Šé™ï¼‰ã€‚</p></li><li><p>é‡å¤§ç–¾ç—…è¡¥å¿ï¼š50ä¸‡å…ƒã€‚</p></li></ul><h3 id="32å²æ–°å¢ä¿é™©æƒ…å†µ"><strong>32å²</strong>æ–°å¢ä¿é™©æƒ…å†µ</h3><ul><li><p>æ„å¤–é™©ï¼šåŒ…å«æ„å¤–èº«æ•…/ä¼¤æ®‹è´£ä»»ï¼›é¢„ç®—ä¸ºæ¯å¹´400å…ƒï¼ˆä¿é¢100ä¸‡å…ƒï¼‰ã€‚</p></li><li><p>å‡é¢å®šæœŸå¯¿é™©Cï¼šå—ç›Šäººä¸ºæ³•å®šå—ç›Šäººï¼Œä¿é¢ç­‰äºæˆ¿è´·æ€»é¢ï¼›é¢„ç®—ä¸ºæ¯å¹´2000å…ƒï¼ˆä¿é¢150ä¸‡å…ƒï¼Œä¿éšœæœŸ30å¹´ï¼Œç¼´è´¹æœŸ20å¹´ï¼‰ã€‚ï¼ˆæœ‰æˆ¿è´·æ‰ä¹°ï¼‰</p></li><li><p>é‡å¤§ç–¾ç—…é™©Bï¼šæå‡é‡ç–¾ä¿é¢ï¼›é¢„ç®—ä¸ºæ¯å¹´5000å…ƒï¼ˆä¿é¢30ä¸‡å…ƒï¼Œä¿ç»ˆèº«ï¼Œç¼´è´¹æœŸ30å¹´ï¼‰ã€‚</p></li></ul><h4 id="32å²ä¿éšœé€Ÿè§ˆ"><strong>32å²</strong>ä¿éšœé€Ÿè§ˆ</h4><ul><li><p>èº«æ•…è¡¥å¿ï¼ˆä¸é™æ­»äº¡åŸå› ï¼‰ï¼š130ä¸‡å…ƒã€‚</p></li><li><p>é¢å¤–èº«æ•…è¡¥å¿ï¼ˆä»…é™æ„å¤–åŸå› ï¼‰ï¼š150ä¸‡å…ƒã€‚</p></li><li><p>æ„å¤–åŒ»ç–—è¡¥å¿ï¼š1ä¸‡å…ƒï¼ˆä¸Šé™ï¼‰ã€‚</p></li><li><p>ä½é™¢åŒ»ç–—è¡¥å¿ï¼š100ä¸‡å…ƒï¼ˆä¸Šé™ï¼‰ã€‚</p></li><li><p>é‡å¤§ç–¾ç—…è¡¥å¿ï¼š80ä¸‡å…ƒã€‚</p></li></ul><h3 id="34å²"><strong>34å²</strong></h3><ul><li><p>æ„å¤–é™©ï¼šåŒ…å«æ„å¤–èº«æ•…/ä¼¤æ®‹è´£ä»»ï¼Œæ„å¤–åŒ»ç–—è´£ä»»ï¼›é¢„ç®—ä¸ºæ¯å¹´200å…ƒï¼ˆä¿é¢50ä¸‡å…ƒï¼‰ã€‚</p></li><li><p>æ„å¤–é™©ï¼šåŒ…å«æ„å¤–èº«æ•…/ä¼¤æ®‹è´£ä»»ï¼›é¢„ç®—ä¸ºæ¯å¹´400å…ƒï¼ˆä¿é¢100ä¸‡å…ƒï¼‰ã€‚</p></li><li><p>åŒ»ç–—é™©ï¼šåŒ…å«ç–¾ç—…å¯¼è‡´çš„ä½é™¢åŒ»ç–—è´£ä»»ï¼›é¢„ç®—ä¸ºæ¯å¹´200å…ƒã€‚å®šæœŸå¯¿é™©Aï¼šå—ç›Šäººä¸ºçˆ¶æ¯ï¼Œä¿é¢ç›¸å½“äºçˆ¶æ¯5å¹´çš„é€€ä¼‘é‡‘ï¼›é¢„ç®—ä¸ºæ¯å¹´500å…ƒï¼ˆä¿é¢50ä¸‡å…ƒï¼Œä¿éšœæœŸ30å¹´ï¼Œç¼´è´¹æœŸ30å¹´ï¼‰ã€‚</p></li><li><p>å®šæœŸå¯¿é™©Bï¼šå—ç›Šäººä¸ºæ³•å®šå—ç›Šäººï¼Œä¿é¢ç›¸å½“äºè‡ªå·±5å€çš„å¹´è–ªã€‚é¢„ç®—ä¸ºæ¯å¹´1000å…ƒï¼ˆä¿é¢80ä¸‡å…ƒï¼Œä¿åˆ°60å²ï¼Œç¼´è´¹æœŸ30å¹´ï¼‰ã€‚</p></li><li><p>å‡é¢å®šæœŸå¯¿é™©Cï¼šå—ç›Šäººä¸ºæ³•å®šå—ç›Šäººï¼Œä¿é¢ç­‰äºæˆ¿è´·æ€»é¢ï¼›é¢„ç®—ä¸ºæ¯å¹´2000å…ƒï¼ˆä¿é¢150ä¸‡å…ƒï¼Œä¿éšœæœŸ30å¹´ï¼Œç¼´è´¹æœŸ20å¹´ï¼‰ã€‚</p></li><li><p>å®šæœŸå¯¿é™©Dï¼šå—ç›Šäººä¸ºå­å¥³ï¼Œä¿é¢ç›¸å½“äºå­©å­5å¹´çš„ç”Ÿæ´»è´¹ï¼›é¢„ç®—ä¸ºæ¯å¹´4000å…ƒï¼ˆä¿é¢100ä¸‡å…ƒï¼Œä¿åˆ°60å²ï¼Œç¼´è´¹æœŸ20å¹´ï¼‰ã€‚</p></li><li><p>é‡å¤§ç–¾ç—…é™©Aï¼šä¿é¢ç›¸å½“äºè‡ªå·±å½“æ—¶çš„3å€å¹´è–ªï¼›é¢„ç®—ä¸ºæ¯å¹´5000å…ƒï¼ˆä¿é¢50ä¸‡å…ƒï¼Œä¿åˆ°70å²ï¼Œç¼´è´¹æœŸ30å¹´ï¼‰ã€‚é‡å¤§ç–¾ç—…é™©Bï¼šæå‡é‡ç–¾é™©ä¿é¢ï¼›é¢„ç®—ä¸ºæ¯å¹´5000å…ƒï¼ˆä¿é¢30ä¸‡å…ƒï¼Œä¿ç»ˆèº«ï¼Œç¼´è´¹æœŸ30å¹´ï¼‰ã€‚</p></li><li><p>å…»è€ä¿é™©ï¼ˆ60å²é¢†å–ï¼‰ï¼šé¢„ç®—ä¸ºæ¯å¹´60000å…ƒï¼ˆæ¯æœˆ5000å…ƒï¼‰ã€‚</p></li></ul><p>ç»™è‡ªå·±ä¹°ä¿é™©ï¼Œä¸èƒ½ä¸€è¹´è€Œå°±ï¼Œåº”éšç€äººç”Ÿè¿›å…¥ä¸åŒé˜¶æ®µè€Œåˆ†æ­¥å®æ–½ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹è‡ªå·±çš„æƒ…æ„Ÿè¿›è¡Œå†åˆ†é…ï¼Œè¯´åˆ°åº•å°±æ˜¯ï¼Œå›ç­”â€œä¸ºè°ä¹°ä¿é™©â€çš„é—®é¢˜ã€‚æ¯”å¦‚ï¼Œæ¶‰åŠåŒ»ç–—è¡¥å¿çš„ä¿é™©ï¼ˆå¦‚ä½é™¢åŒ»ç–—é™©ã€é‡å¤§ç–¾ç—…é™©ï¼‰ï¼Œæ˜¯ä¸ºäº†è®©è‡ªå·±ä¸è‡³äºè¢«ç–¾ç—…æç©ºè…°åŒ…ï¼›å†æ¯”å¦‚ï¼Œæ¶‰åŠèº«æ•…è¡¥å¿çš„ä¿é™©ï¼ˆå¦‚å®šæœŸå¯¿é™©ã€æ„å¤–é™©ï¼‰ï¼Œæ˜¯ä¸ºäº†è®©å®¶äººèƒ½å¤Ÿç»§ç»­ç»´æŒåŸæ¥çš„ç”Ÿæ´»æ°´å‡†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è¯»ä¹¦ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¯»ä¹¦ç¬”è®° </tag>
            
            <tag> ä¿é™© </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gradleå­¦ä¹ è¸©å‘è®°å½•</title>
      <link href="2021/04/01/others/gradle%E5%AD%A6%E4%B9%A0%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/"/>
      <url>2021/04/01/others/gradle%E5%AD%A6%E4%B9%A0%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="gradleå­¦ä¹ è¸©å‘è®°å½•">gradleå­¦ä¹ è¸©å‘è®°å½•</h1><p>æœ€è¿‘æƒ³å­¦ä¹ ä¸€ä¸‹Java11ï¼Œä½¿ç”¨gradleæ­å»ºäº†ä¸€ä¸ªé¡¹ç›®ï¼Œä½†æ˜¯åœ¨æ‰§è¡Œæ‰“åŒ…å‘½ä»¤<code>./gradlew clean build</code>æ—¶æŠ¥é”™å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Could not target platform: &#x27;Java SE 11&#x27; using tool chain: &#x27;JDK 8 (1.8)&#x27;</span><br></pre></td></tr></table></figure><p>åŸå› æ˜¯å› ä¸ºæˆ‘æœ¬åœ°çš„JAVA_HOMEé…ç½®çš„JDKç‰ˆæœ¬æ˜¯1.8ï¼Œä½†æ˜¯é¡¹ç›®ä¸­æŒ‡å®šçš„ç¼–è¯‘ç‰ˆæœ¬ä¸ºJava11ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sourceCompatibility = JavaVersion.VERSION_11</span><br><span class="line">targetCompatibility = JavaVersion.VERSION_11</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹å¼æ˜¯åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ–°å»ºgradle.propertiesæ–‡ä»¶ï¼Œå¹¶å†™å…¥ä»¥ä¸‹é…ç½®ï¼Œé—®é¢˜è§£å†³</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">org.gradle.java.home</span> = <span class="string">/Library/Java/JavaVirtualMachines/jdk-11.0.9.jdk/Contents/Home</span></span><br></pre></td></tr></table></figure><p>gradleçš„<a href="https://www.jetbrains.com/help/idea/gradle-jvm-selection.html#jdk_existing_project">å®˜æ–¹æ–‡æ¡£</a>è§£é‡Šå¦‚ä¸‹ï¼š</p><h3 id="Resolve-the-Gradle-JVM-version-for-the-existing-project">Resolve the Gradle JVM version for the existing project</h3><ol><li>IntelliJ IDEA checks the <code>gradle.properties</code> file for the appropriate Gradle JVM specified in <code>org.gradle.java.home</code> and uses it for the project.</li><li>Then it checks the <code>JAVA_HOME</code> environment variable.</li><li>Then it checks the closest appropriate JDK version for the existing Gradle version.</li></ol>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
          <category> Gradle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gradle </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Homebrewé…ç½®ä¸ºå›½å†…é•œåƒ</title>
      <link href="2021/04/01/others/Homebrew%E9%85%8D%E7%BD%AE%E4%B8%BA%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F/"/>
      <url>2021/04/01/others/Homebrew%E9%85%8D%E7%BD%AE%E4%B8%BA%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F/</url>
      
        <content type="html"><![CDATA[<p>æœ¬äººçš„Macç”µè„‘æŒ‰ç…§<a href="https://mirrors.tuna.tsinghua.edu.cn/help/homebrew/">æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™</a>çš„è®¾ç½®æ—¶æŠ¥é”™å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git -C &quot;$(brew --repo homebrew/cask)&quot; remote set-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-cask.git</span><br><span class="line">fatal: cannot change to &#x27;/usr/local/Homebrew/Library/Taps/homebrew/homebrew-cask&#x27;: No such file or directory</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ¡ˆæ˜¯å…ˆchangeåˆ°å¯¹åº”çš„ç›®å½•ä¸‹ï¼Œåœ¨æ‰§è¡Œæ›¿æ¢è„šæœ¬ï¼Œæ“ä½œå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd &quot;$(brew --repo)&quot;</span><br><span class="line">git remote set-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.git</span><br><span class="line"></span><br><span class="line">cd $(brew --repo homebrew/core)</span><br><span class="line">git remote set-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git</span><br></pre></td></tr></table></figure><h2 id="å¸è½½homebrew">å¸è½½homebrew</h2><p>æ‰§è¡Œå¸è½½è„šæœ¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/uninstall)&quot;</span><br></pre></td></tr></table></figure><p>å¦‚æœæŠ¥é”™å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl: (7) Failed to connect to raw.githubusercontent.com port 443: Connection refused</span><br></pre></td></tr></table></figure><p>éœ€è¦é…ç½®ä¸€ä¸‹hostï¼›å»å¾€<a href="https://www.ipaddress.com/">https://www.ipaddress.com/</a>ï¼Œè¾“å…¥<a href="https://raw.githubusercontent.com">raw.githubusercontent.com</a>æŸ¥çœ‹ipåœ°å€ï¼Œç„¶åé…ç½®hostä¹‹åé‡è¯•ã€‚</p><h2 id="å®‰è£…bash-completion">å®‰è£…bash_completion</h2><p>å¸è½½homebrewåå‘ç°è‡ªåŠ¨è¡¥å…¨çš„åŠŸèƒ½ä¹Ÿæ²¡æœ‰äº†ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi awk: can&#x27;t open file /usr/local/etc/bash_completion</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•æ˜¯é‡æ–°å®‰è£…homebrewåï¼Œå®‰è£…bash-completionï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install bash-completion</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
          <category> Homebrew </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Homebrew </tag>
            
            <tag> Mac </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå¸¸ç”¨å‘½ä»¤è®°å½•</title>
      <link href="2021/04/01/others/Linux%20Shell%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/"/>
      <url>2021/04/01/others/Linux%20Shell%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h2 id="tar-è§£å‹ï¼Œå‹ç¼©ï¼Œå¸®åŠ©ï¼štar-h">tar(è§£å‹ï¼Œå‹ç¼©ï¼Œå¸®åŠ©ï¼štar -h)</h2><p>è§£å‹ï¼Œ<code>-C</code>æ ‡ç­¾æŒ‡å®šè§£å‹åˆ°å“ªä¸ªç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xf -C ./test</span><br></pre></td></tr></table></figure><p>å‹ç¼©</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -cf &lt;archive-filename&gt; [filenames...]</span><br></pre></td></tr></table></figure><h2 id="shasumï¼ˆhashï¼Œå¸®åŠ©shasum-hï¼‰">shasumï¼ˆhashï¼Œå¸®åŠ©shasum -hï¼‰</h2><p>ç”Ÿæˆhashï¼Œ<code>-a</code>æ ‡ç­¾æŒ‡å®šä½¿ç”¨å“ªä¸ªç®—æ³•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shasum -a 256 README.md</span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹ç»ˆç«¯æ˜¾ç¤ºï¼Œä¸æ˜¾ç¤ºç”¨æˆ·åå’Œç”µè„‘åç§°">ä¿®æ”¹ç»ˆç«¯æ˜¾ç¤ºï¼Œä¸æ˜¾ç¤ºç”¨æˆ·åå’Œç”µè„‘åç§°</h2><p>ä¿®æ”¹<code>/etc/bashrc</code>ï¼šPS1='\w $ â€™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> more /etc/bashrc</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> System-wide .bashrc file <span class="keyword">for</span> interactive bash(1) shells.</span></span><br><span class="line">if [ -z &quot;$PS1&quot; ]; then</span><br><span class="line">   return</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">PS1=<span class="string">&#x27;\h:\W \u\$ &#x27;</span></span></span><br><span class="line">PS1=&#x27;\w \$ &#x27;</span><br><span class="line"><span class="meta">#</span><span class="bash"> Make bash check its window size after a process completes</span></span><br><span class="line">shopt -s checkwinsize</span><br><span class="line"></span><br><span class="line">[ -r &quot;/etc/bashrc_$TERM_PROGRAM&quot; ] &amp;&amp; . &quot;/etc/bashrc_$TERM_PROGRAM&quot;</span><br></pre></td></tr></table></figure><p>å…¶ä»–å‚æ•°ï¼š</p><ul><li>\d ï¼šä»£è¡¨æ—¥æœŸï¼Œæ ¼å¼ä¸ºweekday month dateï¼Œä¾‹å¦‚ï¼šâ€œMon Aug 1â€</li><li>\H ï¼šå®Œæ•´çš„ä¸»æœºåç§°ã€‚ä¾‹å¦‚ï¼šæˆ‘çš„æœºå™¨åç§°ä¸ºï¼šfc4.linuxï¼Œåˆ™è¿™ä¸ªåç§°å°±æ˜¯fc4.linux</li><li>\h ï¼šä»…å–ä¸»æœºçš„ç¬¬ä¸€ä¸ªåå­—ï¼Œå¦‚ä¸Šä¾‹ï¼Œåˆ™ä¸ºfc4ï¼Œ.linuxåˆ™è¢«çœç•¥</li><li>\t ï¼šæ˜¾ç¤ºæ—¶é—´ä¸º24å°æ—¶æ ¼å¼ï¼Œå¦‚ï¼šHHï¼šMMï¼šSS</li><li>\T ï¼šæ˜¾ç¤ºæ—¶é—´ä¸º12å°æ—¶æ ¼å¼\A ï¼šæ˜¾ç¤ºæ—¶é—´ä¸º24å°æ—¶æ ¼å¼ï¼šHHï¼šMM</li><li>\u ï¼šå½“å‰ç”¨æˆ·çš„è´¦å·åç§°\v ï¼šBASHçš„ç‰ˆæœ¬ä¿¡æ¯</li><li>\w ï¼šå®Œæ•´çš„å·¥ä½œç›®å½•åç§°ã€‚å®¶ç›®å½•ä¼šä»¥ ~ä»£æ›¿</li><li>\W ï¼šåˆ©ç”¨basenameå–å¾—å·¥ä½œç›®å½•åç§°ï¼Œæ‰€ä»¥åªä¼šåˆ—å‡ºæœ€åä¸€ä¸ªç›®å½•</li><li># ï¼šä¸‹è¾¾çš„ç¬¬å‡ ä¸ªå‘½ä»¤</li><li>$ ï¼šæç¤ºå­—ç¬¦ï¼Œå¦‚æœæ˜¯rootæ—¶ï¼Œæç¤ºç¬¦ä¸ºï¼š# ï¼Œæ™®é€šç”¨æˆ·åˆ™ä¸ºï¼š$</li></ul><h3 id="crontabï¼ˆå®šæ—¶ä»»åŠ¡-man-crontabï¼‰">crontabï¼ˆå®šæ—¶ä»»åŠ¡,man crontabï¼‰</h3><ul><li>æŸ¥çœ‹ï¼š<code>crontab -l</code></li><li>ç¼–è¾‘ï¼š<code>crontab -e</code></li></ul><p>crontabé…ç½®ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ¯å¤©åç‚¹30åˆ†æ‰§è¡Œhello.sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ† æ—¶ æ—¥ æœˆ æ˜ŸæœŸ <span class="built_in">command</span></span></span><br><span class="line">30 10 * * * ï½/hello.sh</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockerå¸¸ç”¨å‘½ä»¤è®°å½•</title>
      <link href="2021/04/01/others/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/"/>
      <url>2021/04/01/others/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h2 id="dockerå‘½ä»¤">dockerå‘½ä»¤</h2><h3 id="åˆ é™¤æœ¬åœ°æ‰€æœ‰æ²¡æœ‰è¢«ä½¿ç”¨çš„å·ï¼š">åˆ é™¤æœ¬åœ°æ‰€æœ‰æ²¡æœ‰è¢«ä½¿ç”¨çš„å·ï¼š</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume prune</span><br></pre></td></tr></table></figure><p>WARNING! This will remove all local volumes not used by at least one container.</p><h3 id="æŸ¥çœ‹æœ¬åœ°çš„æ‰€æœ‰å·ï¼š">æŸ¥çœ‹æœ¬åœ°çš„æ‰€æœ‰å·ï¼š</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume ls</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤æŸä¸ªvolumeå·">åˆ é™¤æŸä¸ªvolumeå·</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker volume rm docker_orderer.supply.com</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨ï¼ŒåŒ…æ‹¬æ²¡æœ‰è¿è¡Œä¸­çš„">æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨ï¼ŒåŒ…æ‹¬æ²¡æœ‰è¿è¡Œä¸­çš„</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æŸä¸ªå®¹å™¨çš„æ—¥å¿—">æŸ¥çœ‹æŸä¸ªå®¹å™¨çš„æ—¥å¿—</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs ead00b30e8ec</span><br></pre></td></tr></table></figure><h3 id="åœæ­¢å®¹å™¨">åœæ­¢å®¹å™¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop 46bc78ee1f8a e8df5432a918 be15203b7835</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤å®¹å™¨">åˆ é™¤å®¹å™¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm ead00b30e8ec 46bc78ee1f8a e8df5432a918 be15203b7835</span><br></pre></td></tr></table></figure><h3 id="è¿›å…¥dockerå®¹å™¨">è¿›å…¥dockerå®¹å™¨</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it f37c61b09023 /bin/sh</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹å®¹å™¨çš„ç¯å¢ƒå˜é‡">ä¿®æ”¹å®¹å™¨çš„ç¯å¢ƒå˜é‡</h3><p>åœ¨é…ç½®docker-composeæŸä¸ªå®¹å™¨çš„ç¯å¢ƒå˜é‡æ—¶å‡ºç°äº†é”™è¯¯ï¼Œä½†æ˜¯å®¹å™¨å·²ç»è¿è¡Œäº†ï¼Œå¦‚æœé‡æ–°è¿è¡Œåˆ™æ•°æ®ä¼šä¸¢å¤±ã€‚æ‰€ä»¥éœ€è¦ä¿®æ­£æ­¤ç¯å¢ƒå˜é‡</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">peer0.s1.supply.com:</span></span><br><span class="line"></span><br><span class="line"><span class="string">â€‹</span>    <span class="attr">container_name:</span> <span class="string">peer0.s1.supply.com</span></span><br><span class="line"></span><br><span class="line"><span class="string">â€‹</span>    <span class="attr">image:</span> <span class="string">hyperledger/fabric-peer:2.2.0</span></span><br><span class="line"></span><br><span class="line"><span class="string">â€‹</span>    <span class="attr">environment:</span></span><br><span class="line"></span><br><span class="line"><span class="string">â€‹</span>      <span class="string">*#Generic</span> <span class="string">peer</span> <span class="string">variables*</span></span><br><span class="line"></span><br><span class="line"><span class="string">â€‹</span>      <span class="string">\-</span> <span class="string">CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span></span><br><span class="line"></span><br><span class="line"><span class="string">â€‹</span>      <span class="string">*#</span> <span class="string">the</span> <span class="string">following</span> <span class="string">setting</span> <span class="string">starts</span> <span class="string">chaincode</span> <span class="string">containers</span> <span class="string">on</span> <span class="string">the</span> <span class="string">same*</span></span><br><span class="line"></span><br><span class="line"><span class="string">â€‹</span>      <span class="string">*#</span> <span class="string">bridge</span> <span class="string">network</span> <span class="string">as</span> <span class="string">the</span> <span class="string">peers*</span></span><br><span class="line"></span><br><span class="line"><span class="string">â€‹</span>      <span class="string">*#</span> <span class="string">https://docs.docker.com/compose/networking/*</span></span><br><span class="line"></span><br><span class="line"><span class="string">â€‹</span>      <span class="string">\-</span> <span class="string">CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=_test</span></span><br><span class="line"></span><br><span class="line"><span class="string">â€‹</span>      <span class="string">\-</span> <span class="string">FABRIC_LOGGING_SPEC=INFO</span></span><br><span class="line"></span><br><span class="line"><span class="string">â€‹</span>      <span class="string">*#-</span> <span class="string">FABRIC_LOGGING_SPEC=DEBUG*</span></span><br></pre></td></tr></table></figure><p>å¦‚è¦ä¿®æ”¹<code>CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE</code>ä¸º<code>docker_test</code>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1ã€è¿›å…¥å®¹å™¨</span></span><br><span class="line">docker exec -it f37c61b09023 /bin/sh</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2ã€ä¿®æ”¹ç¯å¢ƒå˜é‡</span></span><br><span class="line">echo &quot;export CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=docker_test&quot; &gt;&gt; /etc/profile</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3ã€é‡æ–°å¯åŠ¨å®¹å™¨å³å¯</span></span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹dockerå¯åŠ¨çš„ç½‘ç»œ">æŸ¥çœ‹dockerå¯åŠ¨çš„ç½‘ç»œ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network ls</span><br></pre></td></tr></table></figure><h2 id="docker-composeå‘½ä»¤">docker-composeå‘½ä»¤</h2><h3 id="ä½¿ç”¨docker-composeå¯åŠ¨dockeré•œåƒ">ä½¿ç”¨docker-composeå¯åŠ¨dockeré•œåƒ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> --f æŒ‡å®šæ–‡ä»¶, -dæŒ‡å®šåå°è¿è¡Œ</span></span><br><span class="line">docker-compose --f docker-compose.yml up -d</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨docker-composeå¯åŠ¨æŒ‡å®šçš„åç§°çš„å®¹å™¨">ä½¿ç”¨docker-composeå¯åŠ¨æŒ‡å®šçš„åç§°çš„å®¹å™¨</h3><p>åœ¨ä¸€ä¸ª<code>docker-compose.yaml</code>é…ç½®æ–‡ä»¶ä¸‹å¯èƒ½æœ‰å¤šä¸ª<code>serevice</code>ï¼Œå¯ä»¥æŒ‡å®šåç§°æ¥å¯åŠ¨å…¶ä¸­çš„ä¸€ä¸ªï¼Œå‘½ä»¤å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up ca-tls</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> docker-compose </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gradleå¸¸ç”¨å‘½ä»¤è®°å½•</title>
      <link href="2021/04/01/others/Gradle%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
      <url>2021/04/01/others/Gradle%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h2 id="Gradleå¸¸ç”¨å‘½ä»¤è®°å½•">Gradleå¸¸ç”¨å‘½ä»¤è®°å½•:</h2><h4 id="è¿è¡Œgradle-help-task-someTaskæ¥æ˜¾ç¤ºå¸®åŠ©ï¼Œå¦‚ï¼š">è¿è¡Œ<code>gradle help --task someTask</code>æ¥æ˜¾ç¤ºå¸®åŠ©ï¼Œå¦‚ï¼š</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew help --task test</span><br></pre></td></tr></table></figure><h4 id="clean">clean</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew clean</span><br></pre></td></tr></table></figure><h4 id="build">build</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew build</span><br></pre></td></tr></table></figure><h4 id="test">test</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew test</span><br></pre></td></tr></table></figure><h4 id="æ’é™¤æŒ‡å®šçš„task-exclude-task">æ’é™¤æŒ‡å®šçš„task<code>--exclude-task</code></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew clean build --exclude-task test</span><br></pre></td></tr></table></figure><h4 id="å¤šæ¨¡å—æŒ‡å®šæ¨¡å—è¿è¡Œtask">å¤šæ¨¡å—æŒ‡å®šæ¨¡å—è¿è¡Œtask</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./gradlew :my-subproject:taskName</span><br><span class="line">./gradlew my-subproject:taskName</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•å¤±è´¥ç»§ç»­æ‰§è¡Œ">æµ‹è¯•å¤±è´¥ç»§ç»­æ‰§è¡Œ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew test --continue</span><br></pre></td></tr></table></figure><h4 id="æ£€æŸ¥ï¼Œä¼šæ‰§è¡Œtestå’Œlinting">æ£€æŸ¥ï¼Œä¼šæ‰§è¡Œtestå’Œlinting</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew check</span><br></pre></td></tr></table></figure><h4 id="æ˜¾ç¤ºå½“å‰çš„é¡¹ç›®å±‚æ¬¡">æ˜¾ç¤ºå½“å‰çš„é¡¹ç›®å±‚æ¬¡</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew project</span><br></pre></td></tr></table></figure><h4 id="åˆ—å‡ºæ‰€æœ‰çš„task">åˆ—å‡ºæ‰€æœ‰çš„task</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew tasks</span><br></pre></td></tr></table></figure><h4 id="åˆ—å‡ºé¡¹ç›®æ‰€æœ‰çš„ä¾èµ–ï¼š">åˆ—å‡ºé¡¹ç›®æ‰€æœ‰çš„ä¾èµ–ï¼š</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew dependencies</span><br></pre></td></tr></table></figure><p>å»<a href="https://docs.gradle.org/current/userguide/command_line_interface.html">å®˜ç½‘</a>æŸ¥çœ‹æ›´å¤š</p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
          <category> Gradle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gradle </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Redisè‡ªå¢ç‰¹æ€§åˆ›å»ºå”¯ä¸€idç”Ÿæˆå™¨</title>
      <link href="2021/04/01/language/java/%E4%BD%BF%E7%94%A8redis%E8%87%AA%E5%A2%9E%E7%89%B9%E6%80%A7%E5%88%9B%E5%BB%BA%E5%94%AF%E4%B8%80id%E7%94%9F%E6%88%90%E5%99%A8/"/>
      <url>2021/04/01/language/java/%E4%BD%BF%E7%94%A8redis%E8%87%AA%E5%A2%9E%E7%89%B9%E6%80%A7%E5%88%9B%E5%BB%BA%E5%94%AF%E4%B8%80id%E7%94%9F%E6%88%90%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="éœ€æ±‚è¯´æ˜">éœ€æ±‚è¯´æ˜</h1><h2 id="äº§å“è¦æ±‚å®ç°ä¸€ä¸ªè®¢å•ç¼–å·ï¼Œæ­¤ç¼–å·è§„åˆ™å¦‚ä¸‹">äº§å“è¦æ±‚å®ç°ä¸€ä¸ªè®¢å•ç¼–å·ï¼Œæ­¤ç¼–å·è§„åˆ™å¦‚ä¸‹</h2><h3 id="è®¢å•ç¼–å·è§„åˆ™ï¼š">è®¢å•ç¼–å·è§„åˆ™ï¼š</h3><p>â€œå­—æ¯â€ + â€œæ—¥æœŸâ€ + â€œè‡ªå¢IDâ€</p><h3 id="è®¢å•ç¼–å·ä¸¾ä¾‹">è®¢å•ç¼–å·ä¸¾ä¾‹</h3><p>æ¯”å¦‚ä¸šåŠ¡Aï¼Œåœ¨2020-08-04æ—¥æœ‰ä¸‰ä¸ªè®¢å•ï¼Œé‚£ä¹ˆè®¢å•ç¼–å·å¦‚ä¸‹ï¼š</p><ul><li>A202008040001</li><li>A202008040002</li><li>A202008040003</li></ul><p>æ¯”å¦‚ä¸šåŠ¡Aï¼Œåœ¨2020-08-05æ—¥æœ‰4ä¸ªè®¢å•ï¼Œé‚£ä¹ˆè®¢å•ç¼–å·å¦‚ä¸‹ï¼š</p><ul><li>A202008050001</li><li>A202008050002</li><li>A202008050003</li><li>A202008050003</li></ul><p>é€šè¿‡ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œåé¢çš„â€œè‡ªå¢IDâ€æ¯å¤©éƒ½ä¼šä»1å¼€å§‹å¢åŠ ï¼Œåœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè¦åšåˆ°æ¯å¤©ä»1å¼€å§‹ä¸é‡å¤å¹¶ä¸”è‡ªå¢çš„æ•ˆæœï¼›æƒ³åˆ°çš„ç¬¬ä¸€ä¸ªå®ç°æ–¹æ¡ˆå°±æ˜¯redisçš„Incrå‘½ä»¤ï¼ˆRedis Incr å‘½ä»¤å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢ä¸€ï¼‰ã€‚</p><h1 id="éœ€æ±‚å®ç°">éœ€æ±‚å®ç°</h1><h2 id="é…ç½®redis">é…ç½®redis</h2><h3 id="ä¾èµ–redisç›¸å…³jaråŒ…">ä¾èµ–redisç›¸å…³jaråŒ…</h3><p>å› ä¸ºæ­¤æ¨¡å—ç»§æ‰¿äº†spring-boot-starter-parentï¼Œæ‰€ä»¥ä¸éœ€è¦æŒ‡å®šç‰ˆæœ¬</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ç¼–å†™é…ç½®redisçš„config">ç¼–å†™é…ç½®redisçš„config</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.nicai.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.data.redis.RedisProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisClusterConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.jedis.JedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * redisé›†ç¾¤é…ç½®</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> guozhe</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/08/04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(RedisProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisClusterConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RedisProperties redisProperties;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedisClusterConfig</span><span class="params">(RedisProperties redisProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redisProperties = redisProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Thread-safe factory of Redis connectionsé…ç½®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> factory of Redis</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisConnectionFactory <span class="title">redisConnectionFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RedisClusterConfiguration redisClusterConfiguration = <span class="keyword">new</span> RedisClusterConfiguration(redisProperties.getCluster().getNodes());</span><br><span class="line">        redisClusterConfiguration.setPassword(redisProperties.getPassword());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JedisConnectionFactory(redisClusterConfiguration);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºStringç±»å‹çš„redisæ¨¡æ¿</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> redisConnectionFactory factory of Redis</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> String-focused extension of RedisTemplate</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> StringRedisTemplate <span class="title">stringRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;</span><br><span class="line">        StringRedisTemplate template = <span class="keyword">new</span> StringRedisTemplate(redisConnectionFactory);</span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯é…ç½®èŒƒå‹çš„RedisTemplateï¼Œéœ€è¦è®¾ç½®å€¼çš„åºåˆ—åŒ–è§„åˆ™ä¸ºï¼š<strong>StringRedisSerializer</strong>ï¼ŒåŸå› å¯ä»¥å‚è€ƒæ­¤æ–‡ç« ï¼š<a href="https://blog.csdn.net/tyyh08/article/details/80267261">Spring Bootä¸­ä½¿ç”¨RedisTemplateä¼˜é›…çš„æ“ä½œRedisï¼Œå¹¶ä¸”è§£å†³RedisTemplateæ³›å‹æ³¨å…¥å¤±è´¥çš„é—®é¢˜</a></p><h3 id="æµ‹è¯•redisçš„configä»£ç ">æµ‹è¯•redisçš„configä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.nicai.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yuanfeng.accounting.BaseAdminSpringTest;</span><br><span class="line"><span class="keyword">import</span> com.yuanfeng.accounting.Constants;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.junit.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.ValueOperations;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> guozhe</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/08/04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = AdminApplication.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisClusterConfigTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TEST_KEY = Constants.REDIS_KEY_PREFIX + <span class="string">&quot;test:hello&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TEST_VALUE = <span class="string">&quot;world&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStringRedisTemplateGetAndSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        stringRedisTemplate.opsForValue().set(TEST_KEY, TEST_VALUE);</span><br><span class="line">        String value = stringRedisTemplate.opsForValue().get(TEST_KEY);</span><br><span class="line">        Assert.assertEquals(TEST_VALUE, value);</span><br><span class="line">        stringRedisTemplate.delete(TEST_KEY);</span><br><span class="line">        Assert.assertNull(stringRedisTemplate.opsForValue().get(TEST_KEY));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testIncr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String key = TEST_KEY;</span><br><span class="line">        ValueOperations&lt;String, String&gt; valueOperations = stringRedisTemplate.opsForValue();</span><br><span class="line">        valueOperations.set(key, <span class="string">&quot;1&quot;</span>, <span class="number">24</span>, TimeUnit.HOURS);</span><br><span class="line">        String initValue = valueOperations.get(key);</span><br><span class="line">        log.info(<span class="string">&quot;key=&#123;&#125;, init value=&#123;&#125;&quot;</span>, key, initValue);</span><br><span class="line">        Assert.assertEquals(<span class="string">&quot;1&quot;</span>, initValue);</span><br><span class="line">        Long increment = valueOperations.increment(key);</span><br><span class="line">        log.info(<span class="string">&quot;key=&#123;&#125;, after increment=&#123;&#125;&quot;</span>, key, increment);</span><br><span class="line">        Assert.assertEquals(Long.valueOf(<span class="number">2</span>), increment);</span><br><span class="line">        stringRedisTemplate.delete(key);</span><br><span class="line">        Assert.assertNull(valueOperations.get(key));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŸºäºredisç¼–å†™å”¯ä¸€IDç”ŸæˆæœåŠ¡">åŸºäºredisç¼–å†™å”¯ä¸€IDç”ŸæˆæœåŠ¡</h2><h3 id="æ·»åŠ æŠ½è±¡çš„å”¯ä¸€idç”ŸæˆæœåŠ¡">æ·»åŠ æŠ½è±¡çš„å”¯ä¸€idç”ŸæˆæœåŠ¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.nicai.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.BooleanUtil;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†å¸ƒå¼IDç”ŸæˆæœåŠ¡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> guozhe</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/08/04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractRedisDistributedIDGenerateService</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">AbstractRedisDistributedIDGenerateService</span>.<span class="title">Context</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–keyæ—¶çš„é»˜è®¤å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> DEFAULT_VALUE = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AbstractRedisDistributedIDGenerateService</span><span class="params">(StringRedisTemplate redisTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ä¸‹ä¸€ä¸ªIDï¼Œç›´æ¥ä»redisä¸­è·å–è‡ªå¢åçš„å€¼ï¼›</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ä¸‹ä¸€ä¸ªID, å¦‚æœrediså‡ºç°å¼‚å¸¸åˆ™è¿”å›nullï¼Œè¯·ä½¿ç”¨è€…è‡ªè¡Œå¤„ç†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Optional&lt;Long&gt; <span class="title">nextId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä»redisä¸­è·å–è‡ªå¢id</span></span><br><span class="line">        Long id = incr(getKey());</span><br><span class="line">        <span class="keyword">return</span> Objects.isNull(id) ? Optional.empty() : Optional.of(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ä¸‹ä¸€ä¸ªIDï¼Œæ ¹æ®ä¼ å…¥çš„ä¸Šä¸‹æ–‡å’Œredisä¸­è‡ªå¢åçš„å€¼æœ€ç»ˆç»„è£…æˆä¸‹ä¸€ä¸ªIDï¼›</span></span><br><span class="line"><span class="comment">     * è·å–ä¹‹åä¼šäº¤ç»™å­ç±»æ£€æŸ¥æ­¤IDæ˜¯å¦é‡å¤ï¼Œå¦‚æœé‡å¤ä¼šä»å­ç±»ä¸­è·å–æœ€æ–°çš„IDï¼Œç„¶åæ›´æ–°redisä¸­çš„å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context æ‹¼è£…idæ—¶éœ€è¦çš„ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ä¸‹ä¸€ä¸ªID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">nextId</span><span class="params">(T context)</span> </span>&#123;</span><br><span class="line">        Optional&lt;Long&gt; id = nextId();</span><br><span class="line">        <span class="comment">// å¦‚æœå¯ä»¥ä»redisä¸­è·å–å€¼ï¼Œåˆ™è¯´æ˜redisæœåŠ¡æ­£å¸¸ï¼Œéœ€è¦åˆ¤é‡ï¼›å¦åˆ™ç›´æ¥ä»æ•°æ®åº“ä¸­è·å–ä¸‹ä¸€ä¸ªid</span></span><br><span class="line">        String nextId = id.isPresent() ? ifDuplicatedThenUpdate(context, assemblyNextId(context, id.get())) :</span><br><span class="line">                getNewIdFromDbAndUpdateRedis(context, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (log.isDebugEnabled()) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;context=&#123;&#125;,redisIncrId=&#123;&#125; nextId=&#123;&#125;&quot;</span>, JSON.toJSONString(context), id, nextId);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nextId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ£€æŸ¥è·å–åˆ°çš„IDæ˜¯å¦é‡å¤</span></span><br><span class="line"><span class="comment">     * å¦‚æœé‡å¤åˆ™è¯´æ˜ç”±äºredisçš„ä¸€äº›åŸå› å¯¼è‡´çš„é‡å¤ï¼Œè¿”å›æœ€æ–°çš„redisä¸­åº”è¯¥å­˜åœ¨çš„å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nextId ä¸‹ä¸€ä¸ªID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¦‚æœå½“å‰IDæ²¡æœ‰é‡å¤ï¼Œåˆ™è¿”å›nullï¼Œå¦åˆ™å¦‚æœé‡å¤äº†åˆ™è¿”å›redisä¸­åº”è¯¥æœ‰çš„å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">checkIfDuplicated</span><span class="params">(String nextId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»æ•°æ®åº“è·å–ä¸‹ä¸€ä¸ªid</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> duplicatedId é‡å¤çš„idï¼Œæ­¤å…¥å‚å¯èƒ½ä¸ºnullï¼Œå­ç±»éœ€è¦è‡ªå·±å¤„ç†</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ•°æ®åº“è·å–ä¸‹ä¸€ä¸ªid</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> Long <span class="title">maxIdFromDatabase</span><span class="params">(String duplicatedId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å­ç±»æ ¹æ®rediså½“å‰çš„å€¼è‡ªè¡Œç»„è£…æœ€ç»ˆçš„ID</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context    ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> redisValue rediså½“å‰çš„å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æœ€ç»ˆçš„ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> String <span class="title">assemblyNextId</span><span class="params">(T context, Long redisValue)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–redisè‡ªå¢çš„key</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> redisè‡ªå¢çš„key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> String <span class="title">getKey</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è°ƒç”¨redisçš„è‡ªå¢æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * å¦‚æœkeyä¸å­˜åœ¨åˆ™å…ˆè®¾ç½®keyï¼Œå†è°ƒç”¨è‡ªå¢æ–¹æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key éœ€è¦è‡ªå¢çš„key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è‡ªå¢ä¹‹åçš„å€¼ï¼Œå¦‚æœrediså‡ºç°å¼‚å¸¸åˆ™è¿”å›null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">incr</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        Long increment = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å…ˆæ£€æŸ¥redisä¸­æ˜¯å¦æœ‰key,å¦‚æœæ²¡æœ‰,å…ˆè®¾ç½®keyå¹¶ä¸”è®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">            <span class="keyword">if</span> (BooleanUtil.isFalse(redisTemplate.hasKey(key))) &#123;</span><br><span class="line">                initOrUpdateValue(key, getKeyInitValue());</span><br><span class="line">            &#125;</span><br><span class="line">            increment = redisTemplate.opsForValue().increment(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;è°ƒç”¨redisçš„è‡ªå¢æ–¹æ³•å¼‚å¸¸ï¼Œerror_message=&#123;&#125;&quot;</span>, e.getMessage(), e);</span><br><span class="line">        &#125;</span><br><span class="line">        log.debug(<span class="string">&quot;key = &#123;&#125;, increment=&#123;&#125;&quot;</span>, key, increment);</span><br><span class="line">        <span class="keyword">return</span> increment;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–åˆå§‹åŒ–keyæ—¶çš„valueå€¼ï¼Œé»˜è®¤æ˜¯0ï¼Œè‡ªå¢ä¹‹åidä»1å¼€å§‹ï¼›</span></span><br><span class="line"><span class="comment">     * å¦‚æœå­ç±»æƒ³ä»å…¶ä»–æ•°å­—å¼€å§‹åˆ™è‡ªå·±è¦†ç›–æ­¤æ–¹æ³•å³å¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> åˆå§‹åŒ–keyæ—¶çš„valueå€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">long</span> <span class="title">getKeyInitValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DEFAULT_VALUE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–keyçš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯å°æ—¶ï¼Œç”±å­ç±»è®¾ç½®</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¶…æ—¶æ—¶é—´ï¼Œå•ä½å°æ—¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">long</span> <span class="title">getTimeOutHours</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­æ˜¯å¦é‡å¤ï¼Œå¦‚æœé‡å¤åˆ™ä»åˆ«çš„æ¸ é“ï¼ˆç”±å­ç±»è‡ªå·±å†³å®šä»å“ªä¸ªæ¸ é“ï¼‰æ›´æ–°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context æ‹¼è£…idæ—¶éœ€è¦çš„ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nextId  ä¸‹ä¸€ä¸ªid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å¦‚æœé‡å¤åˆ™è¿”å›æ–°çš„nextIdï¼Œå¦åˆ™è¿”å›å…¥å‚ä¼ å…¥çš„nextId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">ifDuplicatedThenUpdate</span><span class="params">(T context, String nextId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦é‡å¤ï¼Œå¦‚æœé‡å¤åˆ™ä»æ•°æ®åº“ä¸­è·å–ï¼Œå¦åˆ™ç›´æ¥è¿”å›å½“å‰å€¼</span></span><br><span class="line">        <span class="keyword">return</span> checkIfDuplicated(nextId) ? getNewIdFromDbAndUpdateRedis(context, nextId) : nextId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»æ•°æ®åº“è·å–æ–°idå¹¶æ›´æ–°redisä¸­çš„å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context æ‹¼è£…idæ—¶éœ€è¦çš„ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nextId  ä¸‹ä¸€ä¸ªid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ ¹æ®æ•°æ®åº“çš„idè·å¾—çš„æ–°id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getNewIdFromDbAndUpdateRedis</span><span class="params">(T context, String nextId)</span> </span>&#123;</span><br><span class="line">        Long maxIdFromDatabase = maxIdFromDatabase(nextId);</span><br><span class="line">        String newId = assemblyNextId(context, maxIdFromDatabase);</span><br><span class="line">        log.warn(<span class="string">&quot;nextId=&#123;&#125; åœ¨æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨ï¼ŒmaxIdFromDatabase=&#123;&#125; é‡æ–°è·å–æ–°çš„newId=&#123;&#125;&quot;</span>, nextId, maxIdFromDatabase, newId);</span><br><span class="line">        initOrUpdateValue(getKey(), maxIdFromDatabase);</span><br><span class="line">        <span class="keyword">return</span> newId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–æˆ–è€…æ›´æ–°redisä¸­çš„è‡ªå¢çš„å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   redisä¸­çš„key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value éœ€è¦è®¾ç½®çš„å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initOrUpdateValue</span><span class="params">(String key, Long value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForValue().set(key, String.valueOf(value), getTimeOutHours(), TimeUnit.HOURS);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;è®¾ç½®rediså€¼å¼‚å¸¸ï¼Œvalue=&#123;&#125; error_message=&#123;&#125;&quot;</span>, value, e.getMessage(), e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸Šä¸‹æ–‡ï¼›å­ç±»è‡ªå·±å®šä¹‰ä¸Šä¸‹æ–‡ï¼Œç„¶åæ ¹æ®ä¸Šä¸‹æ–‡çš„æ•°æ®æ¥æœ€ç»ˆç»„è£…ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‡­è¯ç¼–å·ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@NoArgsConstructor</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AContext</span> <span class="keyword">implements</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ä¸šåŠ¡ç±»å‹</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> String businessType;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ ä¸€ä¸ªAæœåŠ¡çš„å”¯ä¸€idç”ŸæˆæœåŠ¡å®ç°">æ·»åŠ ä¸€ä¸ªAæœåŠ¡çš„å”¯ä¸€idç”ŸæˆæœåŠ¡å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.nicai.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DatePattern;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.date.DateUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"><span class="keyword">import</span> com.yuanfeng.accounting.Constants;</span><br><span class="line"><span class="keyword">import</span> com.yuanfeng.accounting.dao.ManualVoucherDAO;</span><br><span class="line"><span class="keyword">import</span> com.yuanfeng.accounting.entity.ManualVoucherEntity;</span><br><span class="line"><span class="keyword">import</span> com.yuanfeng.accounting.exception.AccountingException;</span><br><span class="line"><span class="keyword">import</span> com.yuanfeng.accounting.service.AbstractRedisDistributedIDGenerateService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†å¸ƒå¼å”¯ä¸€IDç”Ÿæˆ-Aå®ç°ç±»</span></span><br><span class="line"><span class="comment"> * ç¼–å·è§„åˆ™ï¼šç”¨é€”+æ—¥æœŸ+è‡ªå¢IDï¼Œå¦‚ï¼šA202007310001ï¼›A202007310002ï¼›A202008070001ï¼›</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> guozhe</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/08/04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DistributedIDGenerateServiceAImpl</span> <span class="keyword">extends</span> <span class="title">AbstractRedisDistributedIDGenerateService</span>&lt;<span class="title">AbstractRedisDistributedIDGenerateService</span>.<span class="title">AContext</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸šåŠ¡ç±»å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String BUSINESS_TYPE = <span class="string">&quot;A:&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * IDé•¿åº¦ä¸è¶³4ä½æ—¶åœ¨å‰é¢å¡«å……çš„å­—ç¬¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> FILLED_CHAR = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœ€åçš„è‡ªå¢IDçš„é•¿åº¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INCREMENT_LENGTH = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿‡æœŸå°æ—¶æ•°ï¼Œå³åœ¨24å°æ—¶å€™è¿‡æœŸ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> EXPIRATION_HOURS = <span class="number">24</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DistributedIDGenerateServiceAImpl</span><span class="params">(StringRedisTemplate redisTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(redisTemplate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">checkIfDuplicated</span><span class="params">(String nextId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Long <span class="title">maxIdFromDatabase</span><span class="params">(String duplicatedId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1L</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">assemblyNextId</span><span class="params">(VoucherNumberContext context, Long redisValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.join(Constants.BLANK, context.getBusinessType(), getDatePeriod(),</span><br><span class="line">                StrUtil.fillBefore(String.valueOf(redisValue), FILLED_CHAR, INCREMENT_LENGTH));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> String <span class="title">getKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.join(Constants.REDIS_KEY_DELIMITER, Constants.REDIS_KEY_PREFIX, BUSINESS_TYPE, getDatePeriod());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">long</span> <span class="title">getTimeOutHours</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> EXPIRATION_HOURS;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¿ç¨‹æ± æ— æ³•æ•è·çº¿ç¨‹çš„å¼‚å¸¸è¸©å‘å¤ç›˜</title>
      <link href="2021/04/01/language/java/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%97%A0%E6%B3%95%E6%8D%95%E8%8E%B7%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%BC%82%E5%B8%B8%E8%B8%A9%E5%9D%91%E5%A4%8D%E7%9B%98/"/>
      <url>2021/04/01/language/java/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%97%A0%E6%B3%95%E6%8D%95%E8%8E%B7%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%BC%82%E5%B8%B8%E8%B8%A9%E5%9D%91%E5%A4%8D%E7%9B%98/</url>
      
        <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2><h3 id="éœ€æ±‚ä¿¡æ¯">éœ€æ±‚ä¿¡æ¯</h3><p>æœ€è¿‘åœ¨å·¥ä½œä¸­æœ‰ä¸ªéœ€æ±‚ï¼Œå…ˆåœ¨AæœåŠ¡é¡µé¢å¢åŠ ä¸€æ¡æ•°æ®ï¼Œç„¶åå»BæœåŠ¡æŸ¥è¯¢æ­¤æ•°æ®çš„è¯¦ç»†ä¿¡æ¯</p><h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3><p>ä¸ºäº†ä½¿AæœåŠ¡çš„æ–°å¢æ•°æ®æ¥å£å¿«é€Ÿå“åº”ï¼Œåœ¨æŸ¥è¯¢BæœåŠ¡æ•°æ®è¯¦æƒ…çš„åœ°æ–¹ä½¿ç”¨äº†çº¿ç¨‹æ± å¼‚æ­¥æŸ¥è¯¢ä¸æ›´æ–°ã€‚</p><h3 id="é—®é¢˜ç°è±¡">é—®é¢˜ç°è±¡</h3><p>åœ¨éªŒè¯æ—¶å‘ç°æ•°æ®åº“ä¸­çš„æ•°æ®å­—æ®µä¸å…¨ï¼Œç»åˆ†æç¼ºå°‘çš„éƒ½æ˜¯éœ€è¦ä»BæœåŠ¡æŸ¥è¯¢å¹¶æ›´æ–°çš„å­—æ®µ</p><h3 id="åˆæ­¥å®šä½">åˆæ­¥å®šä½</h3><p>çŒœæµ‹åº”è¯¥æ˜¯æŸ¥è¯¢BæœåŠ¡æ—¶å‡ºäº†ä¸€äº›å¼‚å¸¸ï¼Œè€Œç”±äºä¸è§„èŒƒä½¿ç”¨çº¿ç¨‹æ± å¯¼è‡´å¼‚å¸¸æ²¡æœ‰æŠ›å‡ºï¼Œç›´æ¥æ‰“åˆ°äº†æ§åˆ¶å°ï¼Œæ•…AæœåŠ¡çš„æ—¥å¿—ç³»ç»Ÿå¹¶çœ‹ä¸åˆ°é”™è¯¯æ—¥å¿—ã€‚</p><h2 id="é—®é¢˜è§£å†³">é—®é¢˜è§£å†³</h2><ol><li>æŸ¥è¯¢BæœåŠ¡æ•°æ®è¯¦æƒ…æ—¶æš‚æ—¶å»æ‰ä½¿ç”¨çº¿ç¨‹æ± ï¼Œæ”¹ä¸ºåŒæ­¥è°ƒç”¨</li><li>å¢åŠ å®¹é”™å®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶æŸ¥è¯¢éœ€è¦ä»BæœåŠ¡è·å–ç¼ºå¤±å­—æ®µçš„æ•°æ®è¿›è¡Œæ›´æ–°</li></ol><p>ä¸Šçº¿åè§‚å¯Ÿï¼Œæ–°å¢çš„æ•°æ®ä¸å†æœ‰éƒ¨åˆ†å­—æ®µç¼ºå¤±çš„æƒ…å†µï¼›é—®é¢˜è§£å†³ã€‚</p><h2 id="é—®é¢˜å¤ç›˜">é—®é¢˜å¤ç›˜</h2><h3 id="AæœåŠ¡çº¿ç¨‹æ± çš„ä½¿ç”¨">AæœåŠ¡çº¿ç¨‹æ± çš„ä½¿ç”¨</h3><p>çº¿ç¨‹æ± å®šä¹‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢BæœåŠ¡æ•°æ®è¯¦æƒ…çš„çº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ExecutorService executorService = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">2</span>, <span class="number">2</span>, <span class="number">0L</span>, TimeUnit.MICROSECONDS,</span><br><span class="line">        <span class="keyword">new</span> LinkedBlockingDeque&lt;&gt;(), <span class="keyword">new</span> ThreadFactoryBuilder().setNameFormat(<span class="string">&quot;queryDataDetail-%d&quot;</span>).build());</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹æ± ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String contract)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 0ã€æ£€æŸ¥åˆåŒå¿…é¡»ä¸å­˜åœ¨</span></span><br><span class="line">    checkIfExist(contract);</span><br><span class="line">    <span class="comment">// 1ã€ä¿å­˜åˆåŒæ•°æ®</span></span><br><span class="line">    Entity entity = saveData(contract);</span><br><span class="line">    <span class="comment">// 2ã€ä»BæœåŠ¡æŸ¥è¯¢ç¼ºå¤±ä¿¡æ¯</span></span><br><span class="line">    executorService.execute(() -&gt; queryDataDetail(entity));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¦‚æ­¤ä½¿ç”¨æœ‰ä½•é—®é¢˜">å¦‚æ­¤ä½¿ç”¨æœ‰ä½•é—®é¢˜</h3><p>æˆ‘é‡æ–°å†™äº†ä¸€ä¸ªæµ‹è¯•æ–¹æ³•å¦‚ä¸‹ï¼š</p><p>1ã€å®šä¹‰ä¸€ä¸ªä¼šä¸€ç›´æŠ›å¼‚å¸¸çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¼•å…¥SystemOutRuleï¼Œç›‘å¬ç¨‹åºæ—¥å¿—è¾“å‡º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Rule</span></span><br><span class="line"><span class="keyword">public</span> SystemOutRule systemOutRule = <span class="keyword">new</span> SystemOutRule().enableLog();</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¼•å…¥SystemOutRuleï¼Œç›‘å¬ç¨‹åºæ—¥å¿—è¾“å‡º</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">runWithException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Thread thread = Thread.currentThread();</span><br><span class="line">    log.info(<span class="string">&quot;thread is &#123;&#125;&quot;</span>, thread);</span><br><span class="line">    log.info(<span class="string">&quot;eh=&#123;&#125;&quot;</span>, thread.getUncaughtExceptionHandler());</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NicaiException(<span class="string">&quot;å‡ºé”™å•¦ï¼&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ã€ä½¿ç”¨çº¿ç¨‹æ± è°ƒç”¨ä¸Šé¢çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    ExecutorService executorService = Executors.newCachedThreadPool();</span><br><span class="line">    executorService.execute(<span class="keyword">this</span>::runWithException);</span><br><span class="line">    TimeUnit.MILLISECONDS.sleep(<span class="number">100L</span>);</span><br><span class="line">    <span class="comment">// æ–­è¨€ç¨‹åºæ‰“å°çš„æ—¥å¿—ä¸åŒ…å«â€œå‡ºé”™å•¦ï¼â€</span></span><br><span class="line">    Assert.assertFalse(systemOutRule.getLog().contains(<span class="string">&quot;å‡ºé”™å•¦ï¼&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ã€ä¸Šé¢çš„å•æµ‹æ–­è¨€æ˜¯æˆåŠŸçš„ï¼Œé‚£ä¹ˆå¼‚å¸¸è·‘å“ªé‡Œå»äº†ï¼Ÿä¸Šé¢çš„å•æµ‹åœ¨æ§åˆ¶å°çš„è¾“å‡ºå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master//image-20200807110851677.png" alt="image-20200807110851677"></p><p>4ã€å¯ä»¥çœ‹å‡ºä¸Šé¢çš„å¼‚å¸¸ä¿¡æ¯æ˜¯ç›´æ¥è¾“å‡ºåˆ°äº†æ§åˆ¶å°ï¼Œè€Œä¸æ˜¯ç”±ç¨‹åºè¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œä¸»è¦åŸå› æ˜¯ä¸»ç¨‹åºæ²¡æœ‰æ•è·åˆ°æ­¤å¼‚å¸¸å¯¼è‡´çš„ã€‚ï¼ˆå…·ä½“åŸå› è¿˜æ²¡æœ‰æ·±å…¥ï¼‰</p><h3 id="å¦‚ä½•è§£å†³çº¿ç¨‹æ± çš„å¼‚å¸¸æ•è·é—®é¢˜">å¦‚ä½•è§£å†³çº¿ç¨‹æ± çš„å¼‚å¸¸æ•è·é—®é¢˜</h3><p>ä¸Šé¢çš„æµ‹è¯•å¯ä»¥è¯´æ˜åˆ°ä¸ºä»€ä¹ˆæ—¥å¿—é‡Œé¢æŸ¥ä¸åˆ°é”™è¯¯æ—¥å¿—ï¼Œé‚£ä¹ˆå¦‚ä½•æ•è·çº¿ç¨‹é‡Œçš„å¼‚å¸¸å‘¢ï¼Ÿ</p><h4 id="æ–¹æ³•1-ä½¿ç”¨UncaughtExceptionHandler">æ–¹æ³•1:ä½¿ç”¨UncaughtExceptionHandler</h4><p>1ã€åœ¨åˆ›å»ºçº¿ç¨‹æ± çš„æ—¶å€™ï¼Œè®¾ç½®ä¼ å…¥çš„ThreadFactoryçš„UncaughtExceptionHandlerå±æ€§ï¼Œæ­¤UncaughtExceptionHandlerä¼šå¤„ç†çº¿ç¨‹ä¸­çš„å¼‚å¸¸ï¼›ä¸‹é¢çš„ä¾‹å­æˆ‘ç›´æ¥æ‰“å°äº†å‡ºæ¥å¼‚å¸¸åŸå› å’Œå¼‚å¸¸æ ˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runWithUncaughtExceptionHandler</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    ExecutorService executorService = Executors.newCachedThreadPool(</span><br><span class="line">            <span class="keyword">new</span> ThreadFactoryBuilder()</span><br><span class="line">                    .setUncaughtExceptionHandler((t, e) -&gt; log.info(<span class="string">&quot;UncaughtExceptionHandler caught, error_message=&#123;&#125;&quot;</span>, e.getMessage(), e))</span><br><span class="line">                    .build());</span><br><span class="line">    executorService.execute(<span class="keyword">this</span>::runWithException);</span><br><span class="line">    TimeUnit.MILLISECONDS.sleep(<span class="number">100L</span>);</span><br><span class="line">    Assert.assertTrue(systemOutRule.getLog().contains(<span class="string">&quot;å‡ºé”™å•¦ï¼&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ã€ä¸Šé¢çš„å•æµ‹è¿è¡Œç»“æœå¦‚ä¸‹ï¼šï¼ˆå¯ä»¥å’Œä¸Šé¢çš„è¿è¡Œç»“æœè¿›è¡Œæ¯”å¯¹ï¼‰</p><p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master//image-20200807111728213.png" alt="image-20200807111728213"></p><p>3ã€ä»ä¸Šé¢çš„è¿è¡Œç»“æœå¯ä»¥çœ‹å‡ºå¼‚å¸¸ä¿¡æ¯æ˜¯ç”±ç¨‹åºæ•è·åå†è¾“å‡ºå‡ºæ¥ï¼Œè¿™æ ·å°±ä¸ä¼šå¯¼è‡´æŸ¥ä¸åˆ°å¼‚å¸¸æ—¥å¿—äº†ã€‚</p><h4 id="æ–¹æ³•2-ä½¿ç”¨guavaæ‰©å±•çš„FutureCallback">æ–¹æ³•2:ä½¿ç”¨guavaæ‰©å±•çš„FutureCallback</h4><p>1ã€guavaå¯¹jdkçš„çº¿ç¨‹åšäº†ä¸€äº›æ‰©å±•ï¼Œå…¶ä¸­ä¸€ä¸ªå°±æ˜¯FutureCallbackï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runWithGuavaThreadPool</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    ListeningExecutorService executorService = MoreExecutors.listeningDecorator(Executors.newCachedThreadPool());</span><br><span class="line">    ListenableFuture&lt;String&gt; listenableFuture = executorService.submit(<span class="keyword">this</span>::runWithException);</span><br><span class="line">    Futures.addCallback(listenableFuture, <span class="keyword">new</span> FutureCallback&lt;String&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String result)</span> </span>&#123;</span><br><span class="line">            log.info(<span class="string">&quot;success! result = &#123;&#125;&quot;</span>, result);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Throwable t)</span> </span>&#123;</span><br><span class="line">            log.error(<span class="string">&quot;guava FutureCallback caught, error_message=&#123;&#125;&quot;</span>, t.getMessage(), t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, executorService);</span><br><span class="line">    TimeUnit.MILLISECONDS.sleep(<span class="number">100L</span>);</span><br><span class="line">    Assert.assertTrue(systemOutRule.getLog().contains(<span class="string">&quot;å‡ºé”™å•¦ï¼&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ã€ä¸Šé¢çš„å•æµ‹è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master//image-20200807112535447.png" alt="image-20200807112535447"></p><h2 id="é—®é¢˜æ€»ç»“">é—®é¢˜æ€»ç»“</h2><p>1ã€é€šè¿‡ä¸Šé¢çš„æµ‹è¯•ï¼Œä¼˜åŒ–AæœåŠ¡çš„çº¿ç¨‹æ± å®šä¹‰ï¼Œä½¿ä¹‹åœ¨é‡åˆ°å¼‚å¸¸æ—¶èƒ½å¤Ÿæ­£å¸¸è¢«æ•è·ï¼Œèƒ½è¾“å‡ºï¼Œæ–¹ä¾¿é—®é¢˜å®šä½ï¼›è¡¥å¿å®šæ—¶ä»»åŠ¡ä¹Ÿèƒ½å¯¹ç¬¬ä¸€æ¬¡æŸ¥è¯¢å¼‚å¸¸è¿›è¡Œå®¹é”™ï¼Œä¿è¯æ•°æ®èƒ½å¤ŸåŒæ­¥è¿‡æ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢BæœåŠ¡æ•°æ®è¯¦æƒ…çš„çº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ExecutorService executorService = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">2</span>, <span class="number">2</span>, <span class="number">0L</span>, TimeUnit.MICROSECONDS,</span><br><span class="line">        <span class="keyword">new</span> LinkedBlockingDeque&lt;&gt;(), <span class="keyword">new</span> ThreadFactoryBuilder()</span><br><span class="line">        .setUncaughtExceptionHandler((t, e) -&gt; log.error(<span class="string">&quot;æŸ¥è¯¢æ•°æ®è¯¦æƒ…çš„çº¿ç¨‹æ± å¼‚å¸¸,error_message=&#123;&#125;&quot;</span>, e.getMessage(), e))</span><br><span class="line">        .setNameFormat(<span class="string">&quot;queryDataDetail-%d&quot;</span>).build());</span><br></pre></td></tr></table></figure><p>2ã€å½“ç„¶æ­¤é—®é¢˜æ›´æ·±å±‚çš„é—®é¢˜è¿˜æ²¡æœ‰å®Œå…¨è§£ç­”</p><ul><li>ä¸ºä»€ä¹ˆçº¿ç¨‹é‡Œçš„å¼‚å¸¸ä¸ä¼šè¢«æ•è·ï¼Ÿ</li><li>UncaughtExceptionHandlerçš„è¿è¡ŒåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>Guavaçš„FutureCallbackæ˜¯å¦‚ä½•è¿è¡Œçš„ï¼Ÿ</li></ul><p>3ã€<a href="https://github.com/guozhe001/my-tools/blob/master/my-learn/my-experience/src/test/java/com/nicai/experience/concurrency/ExceptionThreadTest.java">æµ‹è¯•ä»£ç æºç åœ°å€</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> çº¿ç¨‹æ±  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨ä½¿ç”¨Springçš„æ—¶å€™åº”è¯¥ä½¿ç”¨æ„é€ æ–¹æ³•æ³¨å…¥bean</title>
      <link href="2021/04/01/language/java/%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BB%BA%E8%AE%AE%E4%BD%BF%E7%94%A8%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5%E8%80%8C%E4%B8%8D%E6%98%AF@Autoware/"/>
      <url>2021/04/01/language/java/%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BB%BA%E8%AE%AE%E4%BD%BF%E7%94%A8%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5%E8%80%8C%E4%B8%8D%E6%98%AF@Autoware/</url>
      
        <content type="html"><![CDATA[<h1 id="é—®é¢˜">é—®é¢˜</h1><p>å¯¹äºä½¿ç”¨Springæ¡†æ¶çš„javaå¼€å‘äººå‘˜å¯¹ä¸‹é¢çš„ä»£ç åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> HelloService helloService;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¯¹äºä¸Šé¢çš„ä»£ç ï¼ŒSonarä¼šæç¤ºï¼š<code>Remove this annotation and use constructor injection instead.</code></p><p>ç¿»è¯‘æˆä¸­æ–‡å³ï¼šç§»é™¤<code>@Autowired</code>æ³¨è§£ä½¿ç”¨æ„é€ å™¨æ³¨å…¥æ–¹å¼æ›¿ä»£ã€‚</p><p>IntelliJ IDEAä¹Ÿä¼šæç¤º<code>Field injection is not recommended</code></p><p>ç¿»è¯‘æˆä¸­æ–‡å³ï¼šä¸æ¨èä½¿ç”¨å­—æ®µæ³¨å…¥</p><h1 id="é‚£ä¹ˆä»–ä»¬ä¸ºä»€ä¹ˆè¿™ä¹ˆå»ºè®®å‘¢ï¼Ÿ">é‚£ä¹ˆä»–ä»¬ä¸ºä»€ä¹ˆè¿™ä¹ˆå»ºè®®å‘¢ï¼Ÿ</h1><h2 id="é¦–å…ˆæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹Springæœ‰å“ªäº›æ³¨å…¥beançš„æ–¹å¼">é¦–å…ˆæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹Springæœ‰å“ªäº›æ³¨å…¥beançš„æ–¹å¼</h2><ol><li>æ„é€ æ–¹æ³•æ³¨å…¥</li><li>setæ–¹æ³•æ³¨å…¥</li><li>å­—æ®µæ³¨å…¥ï¼Œå³<code>@Autowired</code>æ³¨è§£</li></ol><h2 id="å¦‚ä½•ä½¿ç”¨è¿™äº›æ–¹å¼">å¦‚ä½•ä½¿ç”¨è¿™äº›æ–¹å¼</h2><h3 id="æ„é€ æ–¹æ³•æ³¨å…¥">æ„é€ æ–¹æ³•æ³¨å…¥</h3><p>åœ¨Spring4.3ç‰ˆæœ¬ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»è¦åœ¨æ„é€ æ–¹æ³•ä¸ŠåŠ <code>@Autowired</code>æ³¨è§£ï¼›åœ¨æ–°ç‰ˆæœ¬ä¸­å¦‚æœå½“å‰ç±»åªæœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•<code>@Autowired</code>æ³¨è§£å°±æ˜¯å¯é€‰çš„ã€‚</p><p>åªæœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValidationController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HelloService helloService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ValidationController</span><span class="params">(HelloService helloService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.helloService = helloService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤šä¸ªæ„é€ æ–¹æ³•ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValidationController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> HelloService helloService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ValidationController</span><span class="params">(HelloService helloService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.helloService = helloService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ValidationController</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="setæ–¹æ³•æ³¨å…¥">setæ–¹æ³•æ³¨å…¥</h3><p>è¿™ç§æ–¹å¼Springä¼šæ‰¾åˆ° <code>@Autowired</code> æ³¨è§£å¹¶ä¸”è°ƒç”¨setæ–¹æ³•æ¥æ³¨å…¥æ‰€éœ€çš„ä¾èµ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValidationController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> HelloService helloService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HelloService <span class="title">getHelloService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> helloService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHelloService</span><span class="params">(HelloService helloService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.helloService = helloService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­—æ®µæ³¨å…¥">å­—æ®µæ³¨å…¥</h3><p>é€šè¿‡åŸºäºå­—æ®µçš„æ³¨å…¥ï¼ŒSpringåœ¨ä½¿ç”¨<code>@Autowired</code>æ³¨é‡Šè¿›è¡Œæ³¨é‡Šæ—¶ï¼Œç›´æ¥å°†æ‰€éœ€çš„ä¾èµ–é¡¹åˆ†é…ç»™å­—æ®µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValidationController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HelloService helloService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¿™äº›æ–¹å¼æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹">è¿™äº›æ–¹å¼æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹</h2><p>æ—¢ç„¶è¦<em><strong>ç§»é™¤<code>@Autowired</code>æ³¨è§£ä½¿ç”¨æ„é€ å™¨æ³¨å…¥æ–¹å¼æ›¿ä»£</strong></em>ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸»è¦è®¨ä¸€ä¸‹è¿™äº›æ–¹å¼çš„ä¼˜ç¼ºç‚¹ã€‚</p><h3 id="å­—æ®µæ³¨å…¥æ–¹å¼çš„ä¼˜ç‚¹">å­—æ®µæ³¨å…¥æ–¹å¼çš„ä¼˜ç‚¹</h3><p>ç›¸æ¯”è¾ƒå¦å¤–ä¸¤ç§æ–¹å¼ï¼Œå­—æ®µæ³¨å…¥æ–¹å¼çš„ä»£ç é‡æ›´å°‘ã€æ›´æ•´é½ã€æ›´ç®€æ´</p><h3 id="æ„é€ æ–¹æ³•æ³¨å…¥çš„ä¼˜ç‚¹">æ„é€ æ–¹æ³•æ³¨å…¥çš„ä¼˜ç‚¹</h3><h4 id="å®¹æ˜“å‘ç°ä»£ç çš„åå‘³é“">å®¹æ˜“å‘ç°ä»£ç çš„åå‘³é“</h4><p>setæ–¹æ³•æ³¨å…¥å’Œå­—æ®µæ³¨å…¥ä¼š<em><strong>é—´æ¥</strong></em>è¿å<strong>å•ä¸€èŒè´£åŸåˆ™</strong>ã€‚</p><p>å› ä¸ºåœ¨ä¸€ä¸ªç±»ä¾èµ–å¾ˆå¤šå…¶ä»–ç±»çš„æ—¶å€™ï¼Œå¦‚æœä½¿ç”¨æ„é€ æ–¹æ³•æ³¨å…¥å°±ä¼šå‘ç°æ„é€ æ–¹æ³•çš„å‚æ•°å¤ªå¤šï¼Œè¿™ä¼šè®©å¼€å‘äººå‘˜åæ€è¿™ä¸ªç±»çœŸçš„éœ€è¦è¿™ä¹ˆå¤šä¾èµ–å—ï¼Ÿå½“å‰ç±»æ˜¯ä¸æ˜¯èŒè´£è¿‡å¤šï¼Ÿ</p><p>è€Œä½¿ç”¨å­—æ®µæ³¨å…¥æ—¶ï¼Œå°±ä¼šæŠŠä¸€äº›ä¾‹å¦‚sonarçš„æç¤ºå±è”½æ‰ï¼Œè®©å¼€å‘äººå‘˜è¯¯ä»¥ä¸ºè¿™æ ·åšæ²¡æœ‰é—®é¢˜</p><h4 id="å¯ä»¥åˆ›å»ºä¸å¯å˜ç±»">å¯ä»¥åˆ›å»ºä¸å¯å˜ç±»</h4><p>åœ¨ä½¿ç”¨æ„é€ æ–¹æ³•æ³¨å…¥æ—¶å› ä¸ºæ„é€ æ–¹æ³•æ˜¯åˆ›å»ºä¾èµ–å¯¹è±¡çš„å”¯ä¸€æ–¹å¼ï¼Œè¿™éå¸¸æœ‰åŠ©äºè®©æˆ‘ä»¬åˆ›å»ºä¸å¯å˜çš„å¯¹è±¡ã€‚</p><p>æƒ³è±¡ä¸€ä¸‹åˆ›å»ºä¸€ä¸ªbeanä¹‹åä½ å¯ä»¥é€šè¿‡setæ–¹æ³•éšæ„ä¿®æ”¹æ­¤ç±»çš„ä¾èµ–ï¼Œåœ¨å‡ºç°é—®é¢˜æ—¶æ˜¯å¾ˆéš¾å®šä½çš„ã€‚</p><p><code>@Autowired</code>çš„æºç æœ‰ä¸€æ®µæ³¨é‡Šå¦‚ä¸‹ï¼š<code>Fields are injected right after construction of a bean, before any config methods are invoked. Such a config field does not have to be public.</code><br>å¤§æ„æ˜¯ä½¿ç”¨<code>@Autowired</code>æ³¨è§£æ—¶ï¼Œbeanæ˜¯åœ¨æ„é€ å½“å‰çš„beanä¹‹åï¼Œå¹¶ä¸”åœ¨ä»»ä½•çš„å…¶ä»–æ–¹æ³•è°ƒç”¨ä¹‹å‰æ³¨å…¥ï¼Œå› æ­¤æ— æ³•è®¾ç½®æˆfinalç±»å‹çš„å­—æ®µã€‚</p><h4 id="æ›´æ˜æ˜¾çš„å£°æ˜æ‰€æœ‰çš„ä¾èµ–">æ›´æ˜æ˜¾çš„å£°æ˜æ‰€æœ‰çš„ä¾èµ–</h4><p>ä½¿ç”¨æ„é€ æ–¹æ³•æ³¨å…¥ï¼Œåœ¨ä½¿ç”¨è¿™ä¸ªç±»æ—¶å°±ä¼šæš´éœ²ç»™ä½¿ç”¨è€…è¯´æˆ‘è¦ä¾èµ–æ„é€ æ–¹æ³•ä¸­çš„ç±»ã€‚</p><p>ä½†æ˜¯ä½¿ç”¨å­—æ®µæ³¨å…¥æ—¶ï¼Œä½¿ç”¨è€…å…¶å®å¹¶ä¸çŸ¥é“è¿™ä¸ªç±»ä¾èµ–äº†å“ªäº›ç±»ï¼Œé™¤éæˆ‘åˆ°æ­¤ç±»ä¸­æŸ¥çœ‹è¿™ä¸ªç±»æœ‰å¤šå°‘ä¸ªå­—æ®µæ˜¯æœ‰<code>@Autowired</code>æ³¨è§£ã€‚</p><h4 id="ä¸æ–¹ä¾¿è¿ç§»">ä¸æ–¹ä¾¿è¿ç§»</h4><p>springå®ç°äº†DIï¼ˆæ§åˆ¶åè½¬ï¼‰ï¼Œä½†å¹¶éæ˜¯DIæœ¬èº«ï¼›<br>ä½¿ç”¨æ„é€ æ–¹æ³•æ³¨å…¥æ—¶ï¼Œé™¤äº†åœ¨ç±»ä¸Šé¢æœ‰<code>@Service</code>ã€<code>@Component</code>ç­‰çš„æ³¨è§£ï¼Œæ²¡æœ‰å…¶ä»–çš„Springç›¸å…³çš„æ›´å¤šçš„æ³¨è§£ã€‚</p><p>ä½¿ç”¨å­—æ®µæ³¨å…¥æ—¶ï¼Œé™¤äº†åœ¨ç±»ä¸Šé¢æœ‰<code>@Service</code>ã€<code>@Component</code>ç­‰çš„æ³¨è§£ä¹‹å¤–åˆä½¿ç”¨äº†Springçš„<code>@Autowired</code>æ³¨è§£ï¼Œå¦‚æœæŠŠæ­¤ç±»è¿ç§»åˆ°å…¶ä»–æ²¡æœ‰springçš„ç¯å¢ƒæ—¶æ˜¯å®Œæˆä¸äº†æ³¨å…¥çš„ã€‚</p><h4 id="ä¸æ–¹ä¾¿æµ‹è¯•">ä¸æ–¹ä¾¿æµ‹è¯•</h4><p>åœ¨ä½¿ç”¨æ„é€ æ–¹æ³•æ³¨å…¥æ—¶ï¼Œå•å…ƒæµ‹è¯•æ—¶å¼€å‘äººå‘˜å¯ä»¥ç›´æ¥ä¼ å…¥ä¸€ä¸ªmockçš„ç±»æˆ–è€…å…¶ä»–çš„ä»»ä½•è¢«æµ‹è¯•ç±»ä¾èµ–çš„å­ç±»ï¼›</p><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨setæ–¹å¼æ³¨å…¥ä¸€ä¸ªmockçš„ç±»ï¼Œä½†æ˜¯å¦‚æœä»£ç ä¿®æ”¹äº†æ–°å¢äº†ä¸€ä¸ªä¾èµ–ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾ˆå®¹æ˜“å¿˜æ‰åœ¨æµ‹è¯•ä»£ç ä¸­setæ–°å¢çš„ä¾èµ–ï¼Œç›´åˆ°è¿è¡Œçš„æ—¶å€™æˆ‘ä»¬æ‰ä¼šçœ‹åˆ°å¯èƒ½æœ‰NPEå¼‚å¸¸çˆ†å‡ºï¼›ä½†æ˜¯æ„é€ æ–¹æ³•å°±ä¸å¿…æœ‰è¿™ç§çƒ¦æ¼ï¼Œå› ä¸ºå¦‚æœæ–°å¢äº†ä¸€ä¸ªä¾èµ–ï¼Œæµ‹è¯•æ–¹æ³•ä¼šé©¬ä¸Šç¼–è¯‘ä¸é€šè¿‡ã€‚</p><p>ä½¿ç”¨å­—æ®µæ³¨å…¥ï¼Œå¿…é¡»ä¾èµ–Springå»å¸®åŠ©æ³¨å…¥ä¾èµ–çš„ç±»</p><h1 id="æ€»ç»“">æ€»ç»“</h1><p>é€šè¿‡æ„é€ æ–¹æ³•æ³¨å…¥beanæ˜¯æˆ‘ä»¬æ›´å®¹æ˜“åˆ›å»ºä¸å¯å˜ç±»ï¼Œä»£ç æ›´å¥å£®ã€æ›´å…·æœ‰å¯æµ‹è¯•æ€§ã€æ›´å®¹æ˜“é¿å…NPEã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ›å»ºä¸€ä¸ªæ–°çš„channel</title>
      <link href="2021/04/01/blockchain/fabric/%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83/"/>
      <url>2021/04/01/blockchain/fabric/%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<p>å®˜æ–¹æ–‡æ¡£:<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deployment_guide_overview.html">deployment_guide_overview</a></p><h1 id="Deploying-a-production-network">Deploying a production network</h1><ul><li><p><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deployment_guide_overview.html#dg-step-one-decide-on-your-network-configuration">Step one: Decide on your network configuration</a></p></li><li><p><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deployment_guide_overview.html#dg-step-two-set-up-a-cluster-for-your-resources">Step two: Set up a cluster for your resources</a></p></li><li><p><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deployment_guide_overview.html#dg-step-three-set-up-your-cas">Step three: Set up your CAs</a></p></li><li><p><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deployment_guide_overview.html#dg-step-four-use-the-ca-to-create-identities-and-msps">Step four: Use the CA to create identities and MSPs</a></p></li><li><ul><li><p><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deployment_guide_overview.html#dg-step-five-deploy-nodes">Step five: Deploy peers and ordering nodes</a></p><p><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deployment_guide_overview.html#dg-create-a-peer">Creating a peer</a><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deployment_guide_overview.html#dg-create-an-ordering-node">Creating an ordering node</a></p></li></ul></li></ul><h2 id="Step-one-Decide-on-your-network-configuration">Step one: Decide on your network configuration</h2><ul><li><strong>Certificate Authority configuration</strong>.</li><li><strong>Use Organizational Units or not?</strong></li><li><strong>Database type.</strong> ï¼ˆç›¸åŒçš„channelçš„peerèŠ‚ç‚¹å¿…é¡»ä½¿ç”¨ç›¸åŒçš„æ•°æ®åº“ï¼‰</li><li><strong>Channels and private data.</strong></li><li><strong>Container orchestration.</strong></li><li><strong>Chaincode deployment method</strong>ï¼ˆä½¿ç”¨å†…ç½®çš„éƒ¨ç½²æ–¹å¼è¿˜æ˜¯å¤–éƒ¨çš„éƒ¨ç½²æ–¹å¼ï¼Œå¦‚ä½¿ç”¨k8séƒ¨ç½²ï¼‰</li><li><strong>Using firewalls</strong></li></ul><h2 id="Step-two-Set-up-a-cluster-for-your-resources">Step two: Set up a cluster for your resources</h2><h3 id="Managing-your-infrastructure">Managing your infrastructure</h3><ul><li><p>Using secret objects to securely store important configuration files in your cluster. ï¼ˆä½¿ç”¨ç§˜å¯†å¯¹è±¡å°†é‡è¦çš„é…ç½®æ–‡ä»¶å®‰å…¨åœ°å­˜å‚¨åœ¨ç¾¤é›†ä¸­ã€‚ï¼‰</p></li><li><p>Cluster considerations and node sizing.</p></li><li><p>How you choose to mount your volumes. It is a best practice to mount the volumes relevant to your nodes external to the place where your nodes are deployed. (æ‚¨å¦‚ä½•é€‰æ‹©æŒ‚è½½å·ã€‚æœ€ä½³å®è·µæ˜¯å°†ä¸æ‚¨çš„èŠ‚ç‚¹ç›¸å…³çš„å·æŒ‚è½½åˆ°éƒ¨ç½²èŠ‚ç‚¹çš„å¤–éƒ¨ã€‚)</p></li><li><p>How you will monitor your resources.</p></li></ul><h2 id="Step-three-Set-up-your-CAs">Step three: Set up your CAs</h2><p>The first component that must be deployed in a Fabric network is a CA. This is because the certificates associated with a node (not just for the node itself but also the certificates identifying who can administer the node) must be created before the node itself can be deployed.</p><p>å¿…é¡»åœ¨Fabricç½‘ç»œä¸­éƒ¨ç½²çš„ç¬¬ä¸€ä¸ªç»„ä»¶æ˜¯CAã€‚è¿™æ˜¯å› ä¸ºå¿…é¡»å…ˆåˆ›å»ºä¸èŠ‚ç‚¹å…³è”çš„è¯ä¹¦ï¼ˆä¸ä»…æ˜¯é’ˆå¯¹èŠ‚ç‚¹æœ¬èº«çš„è¯ä¹¦ï¼Œè€Œä¸”è¿˜åŒ…æ‹¬æ ‡è¯†è°å¯ä»¥ç®¡ç†è¯¥èŠ‚ç‚¹çš„è¯ä¹¦ï¼‰ï¼Œç„¶åæ‰èƒ½éƒ¨ç½²èŠ‚ç‚¹æœ¬èº«ã€‚</p><ul><li><p>One CA (or more, if you are using intermediate CAs â€” more on intermediate CAs below) is used to generate (through a process called â€œenrollmentâ€) the certificates of the admin of an organization, the MSP of that organization, and any nodes owned by that organization. This CA will also generate the certificates for any additional users.This CA will also generate the certificates for any additional users. Because of its role in â€œenrollingâ€ identities, this CA is sometimes called the â€œenrollment CAâ€ or the â€œecert CAâ€.</p><p>ä¸€ä¸ªCAç”¨äºç”Ÿæˆè¯¥ç»„ç»‡ç®¡ç†å‘˜ã€è¯¥ç»„ç»‡çš„MSPå’Œè¯¥ç»„ç»‡æ‰€æ‹¥æœ‰çš„ä»»ä½•èŠ‚ç‚¹çš„è¯ä¹¦ã€‚è¯¥CAè¿˜å°†ä¸ºä»»ä½•å…¶ä»–ç”¨æˆ·ç”Ÿæˆè¯ä¹¦ã€‚ç”±äºå…¶åœ¨â€œæ³¨å†Œâ€èº«ä»½ä¸­çš„ä½œç”¨ï¼Œå› æ­¤æœ‰æ—¶å°†è¯¥CAç§°ä¸ºâ€œæ³¨å†ŒCAâ€æˆ–â€œè¯ä¹¦CAâ€ã€‚</p></li><li><p>The other CA generates the certificates used to secure communications on Transport Layer Security (TLS).For this reason, this CA is often referred to as a â€œTLS CAâ€. These TLS certificates are attached to actions as a way of preventing â€œman in the middleâ€ attacks.</p><p>å¦ä¸€ä¸ªCAç”Ÿæˆç”¨äºä¿æŠ¤ä¼ è¾“å±‚å®‰å…¨æ€§ï¼ˆTLSï¼‰ä¸Šçš„é€šä¿¡çš„è¯ä¹¦ã€‚å› æ­¤ï¼Œè¯¥CAé€šå¸¸è¢«ç§°ä¸ºâ€œ TLS CAâ€ã€‚å°†è¿™äº›TLSè¯ä¹¦é™„åŠ åˆ°æ“ä½œä¸­ï¼Œä»¥é˜²æ­¢â€œä¸­é—´äººâ€æ”»å‡»ã€‚</p></li></ul><p>Deploy a Production CA</p><ul><li><a href="https://hyperledger-fabric-ca.readthedocs.io/en/latest/deployguide/ca-deploy-topology.html">Planning for a CA</a></li><li><a href="https://hyperledger-fabric-ca.readthedocs.io/en/latest/deployguide/ca-config.html">Checklist for a production CA server</a></li><li><a href="https://hyperledger-fabric-ca.readthedocs.io/en/latest/deployguide/cadeploy.html">CA deployment steps</a></li></ul><h2 id="Step-four-Use-the-CA-to-create-identities-and-MSPs">Step four: Use the CA to create identities and MSPs</h2><p>For each organization, you will need to, at a minimum:</p><ul><li><p><strong>Register and enroll an admin identity and create an MSP</strong>.</p><p><strong>you must create the org admin identity before creating the local MSP of a node, since the certificate of the node admin must be used when creating the local MSP</strong>.</p></li><li><p><strong>Register and enroll node identities</strong>.</p></li></ul><h2 id="Step-five-Deploy-peers-and-ordering-nodes">Step five: Deploy peers and ordering nodes</h2><p>Before any node can be deployed, its configuration file must be customized. For the peer, this file is called <code>core.yaml</code>, while the configuration file for ordering nodes is called <code>orderer.yaml</code>.</p><p>åœ¨ä»»ä½•çš„èŠ‚ç‚¹å¯ä»¥è¢«éƒ¨ç½²ä¹‹å‰ï¼Œå¿…é¡»å…ˆè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ã€‚</p><ul><li>peerèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ï¼š <code>core.yaml</code></li><li>orderingèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶<code>orderer.yaml</code></li></ul><p>You have three main options for tuning your configuration.</p><ol><li>Edit the YAML file bundled with the binaries.</li><li>Use environment variable overrides when deploying.</li><li>Specify flags on CLI commands.</li></ol><h3 id="Creating-a-peer">Creating a peer</h3><p>Among the parameters in <code>core.yaml</code>, there are:</p><ul><li><strong>Identifiers</strong>: these include not just the paths to the relevant local MSP and Transport Layer Security (TLS) certificates, but also the name (known as the â€œpeer IDâ€) of the peer and the MSP ID of the organization that owns the peer.</li><li><strong>Addresses and paths</strong>: because peers are not entities unto themselves but interact with other peers and components, you must specify a series of addresses in the configuration. These include addresses where the peer itself can be found by other components as well as the addresses where, for example, chaincodes can be found (if you are employing external chaincodes). Similarly, you will need to specify the location of your ledger (as well as your state database type) and the path to your external builders (again, if you intend to employ external chaincodes). These include <strong>Operations and metrics</strong>, which allow you to set up methods for monitoring the health and performance of your peer through the configuration of endpoints.</li><li><strong>Gossip</strong>: components in Fabric networks communicate with each other using the â€œgossipâ€ protocol. Through this protocol, they can be discovered by the discovery service and disseminate blocks and private data to each other. Note that gossip communications are secured using TLS.</li></ul><p>Deploying a production peer</p><ul><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deploypeer/peerplan.html">Planning for a production peer</a></li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deploypeer/peerchecklist.html">Checklist for a production peer</a></li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deploypeer/peerdeploy.html">Deploy the peer</a></li></ul><h3 id="Creating-an-ordering-node">Creating an ordering node</h3><p>Among the parameters in <code>orderer.yaml</code>, there are:</p><ul><li><strong>Identifiers</strong>: these include not just the paths to the relevant local MSP and Transport Layer Security (TLS) certificates, but also the MSP ID of the organization that owns the ordering node.</li><li><strong>Addresses and paths</strong>: because ordering nodes interact with other components, you must specify a series of addresses in the configuration. These include addresses where the ordering node itself can be found by other components as well as <strong>Operations and metrics</strong>, which allow you to set up methods for monitoring the health and performance of your ordering node through the configuration of endpoints.</li></ul><p>Deploying a production ordering node</p><ul><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deployorderer/ordererplan.html">Planning for an ordering service</a></li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deployorderer/ordererchecklist.html">Checklist for a production ordering node</a></li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deployorderer/ordererdeploy.html">Deploy the ordering service</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> channel </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> channel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éšç§˜äº¤æ˜“.md</title>
      <link href="2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E9%9A%90%E7%A7%98%E4%BA%A4%E6%98%93/"/>
      <url>2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E9%9A%90%E7%A7%98%E4%BA%A4%E6%98%93/</url>
      
        <content type="html"><![CDATA[<p>è‡ªå·±å¼€å‘çš„æ™ºèƒ½åˆçº¦åœ¨channelä¸Šçš„æ‰€æœ‰æˆå‘˜éƒ½å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ç¬¦åˆç°å®ä¸–ç•Œä¸­çš„äº¤æ˜“è§„åˆ™ã€‚ç†è®ºä¸Šä¸¤ä¸ªç»„ç»‡ä¹‹é—´çš„äº¤æ˜“æ˜¯ä¸å…è®¸åˆ«äººçœ‹åˆ°çš„ã€‚æ‰€ä»¥è¿™æ¬¡æˆ‘ä½¿ç”¨fabric-samplesæä¾›çš„<code>asset-transfer-secured-agreement</code>æ¥ä½œä¸ºæˆ‘çš„ä¾›åº”é“¾é‡‘èåŒºå—é“¾é¡¹ç›®çš„chaincodeã€‚</p><h2 id="éƒ¨ç½²é“¾ç ">éƒ¨ç½²é“¾ç </h2><h3 id="æ‰“åŒ…">æ‰“åŒ…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode package secured_supply.5.tar.gz --path ./asset-transfer-secured-agreement/chaincode-go --lang golang --label secured_supply_15.0</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…é“¾ç åŒ…-æ¯ä¸ªpeeréƒ½è¦å®‰è£…ï¼š">å®‰è£…é“¾ç åŒ…,æ¯ä¸ªpeeréƒ½è¦å®‰è£…ï¼š</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode install secured_supply.5.tar.gz</span><br></pre></td></tr></table></figure><h3 id="æ‰¹å‡†é“¾ç å®šä¹‰">æ‰¹å‡†é“¾ç å®šä¹‰</h3><h4 id="æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode">æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode queryinstalled</span><br></pre></td></tr></table></figure><p>å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ï¼Œä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦å®šä¹‰æ­¤å˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export CC_PACKAGE_ID=secured_supply_22.0:e815ca2d270dea029bc6992952140b1288a440aba8c430853f72eee7d5de24a7</span><br></pre></td></tr></table></figure><h4 id="æ‰¹å‡†é“¾ç å®šä¹‰ï¼Œæ¯ä¸ªpeeréƒ½è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š">æ‰¹å‡†é“¾ç å®šä¹‰ï¼Œæ¯ä¸ªpeeréƒ½è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode approveformyorg -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name secured_supply --version 23.0 --package-id $CC_PACKAGE_ID --sequence 23 --signature-policy &quot;OR(&#x27;GylCoreOrg1MSP.member&#x27;,&#x27;GylFOrg1MSP.member&#x27;,&#x27;GylSOrg1MSP.member&#x27;,&#x27;GylSOrg2MSP.member&#x27;)&quot; --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><h3 id="å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“">å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“</h3><h4 id="æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š">æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode checkcommitreadiness --channelID alljoinchannel --name secured_supply --version 23.0 --sequence 23 --signature-policy &quot;OR(&#x27;GylCoreOrg1MSP.member&#x27;,&#x27;GylFOrg1MSP.member&#x27;,&#x27;GylSOrg1MSP.member&#x27;,&#x27;GylSOrg2MSP.member&#x27;)&quot; --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json</span><br></pre></td></tr></table></figure><h4 id="åœ¨æ‰€æœ‰ç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š">åœ¨æ‰€æœ‰ç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode commit -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name secured_supply --version 23.0 --sequence 23 --signature-policy &quot;OR(&#x27;GylCoreOrg1MSP.member&#x27;,&#x27;GylFOrg1MSP.member&#x27;,&#x27;GylSOrg1MSP.member&#x27;,&#x27;GylSOrg2MSP.member&#x27;)&quot; --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-querycommitted">peer lifecycle chaincode querycommitted</a> å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode querycommitted --channelID alljoinchannel --name secured_supply --output json</span><br></pre></td></tr></table></figure><h2 id="è°ƒç”¨é“¾ç ">è°ƒç”¨é“¾ç </h2><h3 id="åˆ›å»ºèµ„äº§">åˆ›å»ºèµ„äº§</h3><p><em><strong>èµ„äº§çš„å†…å®¹éœ€è¦æ‰“ä¸ªé—®å·ï¼Œå› ä¸ºè¿™ä¸ªèµ„äº§åœ¨åé¢éœ€è¦è¢«äº¤æ˜“ï¼Œå¦‚æœèµ„äº§çš„å†…å®¹ä¸èƒ½å¤Ÿä¿®æ”¹é‚£ä¹ˆåˆåŒå’Œå‘ç¥¨çš„hashåº”è¯¥ä¸åœ¨èµ„äº§çš„è¯¦ç»†ä¿¡æ¯é‡Œé¢ï¼Œè¿™é‡Œå…ˆæ”¾è¿™é‡Œåé¢å†æ”¹</strong></em></p><p><em><strong>å‘è¡Œè€…èƒ½å¦æ”¾åœ¨å¤–é¢è€Œä¸æ˜¯èµ„äº§é‡Œé¢ï¼Ÿå“ªç§æ–¹å¼æ¯”è¾ƒå¥½å‘¢ï¼Ÿ</strong></em></p><p>åœ¨æ ¸å¿ƒä¼ä¸šçš„èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªèµ„äº§å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export ASSET_PROPERTIES=$(echo -n &quot;&#123;\&quot;objectType\&quot;:\&quot;asset_properties\&quot;,\&quot;assetID\&quot;:\&quot;asset011\&quot;,\&quot;issuer\&quot;:\&quot;GylCoreOrg1MSP\&quot;,\&quot;amount\&quot;:1000,\&quot;createDate\&quot;:\&quot;2020-01-11T06:57:06.963617Z\&quot;,\&quot;endDate\&quot;:\&quot;2021-07-11T06:57:06.963617Z\&quot;,\&quot;salt\&quot;:\&quot;224cba6c547aecc76ab6acfac41d12dfd96e7165\&quot;&#125;&quot; | base64 | tr -d \\n)</span><br></pre></td></tr></table></figure><p>åœ¨æ ¸å¿ƒä¼ä¸šçš„èŠ‚ç‚¹ä¸Šè°ƒç”¨chaincodeï¼Œåˆ›å»ºèµ„äº§ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;CreateAsset&quot;,&quot;Args&quot;:[&quot;asset011&quot;, &quot;A new asset for GylCoreOrg1MSP&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_properties\&quot;:\&quot;$ASSET_PROPERTIES\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>åœ¨ç§æœ‰æ•°æ®é›†ä¸­æŸ¥è¯¢åˆšæ‰åˆ›å»ºçš„èµ„äº§ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset011&quot;]&#125;&#x27;|jq</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;objectType&quot;</span>: <span class="string">&quot;asset_properties&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assetID&quot;</span>: <span class="string">&quot;asset010&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;GylCoreOrg1MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;amount&quot;</span>: <span class="number">1000</span>,</span><br><span class="line">  <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-01-11T06:57:06.963617Z&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-07-11T06:57:06.963617Z&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;salt&quot;</span>: <span class="string">&quot;224cba6c547aecc76ab6acfac41d12dfd96e7165&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢è´¦æœ¬æ¥æŸ¥çœ‹å…¬å…±è®°å½•ï¼Œæ‰€æœ‰åœ¨channelä¸Šçš„æˆå‘˜éƒ½å¯ä»¥æŸ¥è¯¢å¾—åˆ°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset010&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>è¿”å›ç»“æœï¼Œchannelä¸Šçš„æˆå‘˜åªèƒ½çœ‹åˆ°èµ„äº§çš„éƒ¨åˆ†ä¿¡æ¯ï¼Œè¯¦ç»†ä¿¡æ¯æ˜¯æ— æ³•çœ‹åˆ°çš„ã€‚ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;objectType&quot;</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assetID&quot;</span>: <span class="string">&quot;asset010&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ownerOrg&quot;</span>: <span class="string">&quot;GylCoreOrg1MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publicDescription&quot;</span>: <span class="string">&quot;A new asset for GylCoreOrg1MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;enable&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;parentID&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="èµ„äº§æ‹¥æœ‰è€…æ›´æ”¹èµ„äº§çš„å…¬å…±ä¿¡æ¯">èµ„äº§æ‹¥æœ‰è€…æ›´æ”¹èµ„äº§çš„å…¬å…±ä¿¡æ¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset010&quot;,&quot;This asset is for sale&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ–¹æ³•ï¼Œåœ¨æ ¸å¿ƒä¼ä¸šçš„peerèŠ‚ç‚¹è¿”å›æ—¥å¿—å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2021-01-07 16:07:43.589 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200</span><br></pre></td></tr></table></figure><p>å…¶ä»–çš„ç»„ç»‡å¦‚æœæƒ³è¦è°ƒç”¨è¿™ä¸ªé“¾ç çš„æ–¹æ³•æ›´æ”¹ä¿¡æ¯ï¼Œåˆ™ä¼šæŠ¥é”™ï¼Œå› ä¸ºå±äºæ ¸å¿ƒä¼ä¸šçš„èµ„äº§åˆ«äººä¸å¯ä»¥æ›´æ”¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: endorsement failure during invoke. response: status:500 message:&quot;a client from GylFOrg1MSP cannot update the description of a asset owned by GylCoreOrg1MSP&quot;</span><br></pre></td></tr></table></figure><h3 id="èµ„äº§äº¤æ˜“">èµ„äº§äº¤æ˜“</h3><h4 id="å…è®¸å‡ºå”®èµ„äº§">å…è®¸å‡ºå”®èµ„äº§</h4><p>ç°åœ¨æ ¸å¿ƒä¼ä¸šè¦ä¸ä¸€çº§ä¾›åº”å•†äº¤æ˜“æ ¸å¿ƒä¼ä¸šçš„èµ„äº§ã€‚é¦–å…ˆæ ¸å¿ƒä¼ä¸šä¸ä¸€çº§ä¾›åº”å•†è¦åœ¨é“¾ä¸‹å¯¹ä»·æ ¼è¾¾æˆå…±è¯†ï¼Œå¹¶ä¸”æ ¸å¿ƒä¼ä¸šè¦æŠŠèµ„äº§çš„è¯¦æƒ…ä¹Ÿé€šè¿‡é“¾ä¸‹çš„é€šé“å‘é€ç»™ä¸€çº§ä¾›åº”å•†ã€‚ä¹‹åä¹°å–åŒæ–¹å°±å¯ä»¥å¯¹ä»·æ ¼è¾¾æˆå…±è¯†äº†ã€‚</p><h5 id="æ ¸å¿ƒä¼ä¸šå°†èµ„äº§çš„ä»·æ ¼è®¾ç½®ä¸º1000ï¼š">æ ¸å¿ƒä¼ä¸šå°†èµ„äº§çš„ä»·æ ¼è®¾ç½®ä¸º1000ï¼š</h5><p>ä¸‹é¢çš„trade_idæ˜¯åˆåŒçš„hashå€¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ASSET_PRICE=$(echo -n &quot;&#123;\&quot;asset_id\&quot;:\&quot;asset007\&quot;,\&quot;trade_id\&quot;:\&quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14\&quot;,\&quot;price\&quot;:1000&#125;&quot; | base64)</span><br><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToSell&quot;,&quot;Args&quot;:[&quot;asset007&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_price\&quot;:\&quot;$ASSET_PRICE\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢æ ¸å¿ƒä¼ä¸šçš„ç§æœ‰æ•°æ®é›†åˆæ¥è¯»å–åŒæ„çš„é”€å”®ä»·æ ¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetSalesPrice&quot;,&quot;Args&quot;:[&quot;asset007&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><h5 id="ä¸€çº§ä¾›åº”å•†å‡ºä»·1000">ä¸€çº§ä¾›åº”å•†å‡ºä»·1000</h5><p>åœ¨ä¸€çº§ä¾›åº”å•†å‡ºä»·ä¹‹å‰ï¼Œä»–éœ€è¦å…ˆéªŒè¯èµ„äº§çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®ã€‚æ­¤é“¾ç ä¸­è¿”å›trueå³ä¸ºæ­£ç¡®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">export</span> ASSET_PROPERTIES=$(<span class="built_in">echo</span> -n <span class="string">&quot;&#123;\&quot;object_type\&quot;:\&quot;asset_properties\&quot;,\&quot;asset_id\&quot;:\&quot;asset006\&quot;,\&quot;issuer\&quot;:\&quot;GylCoreOrg1MSP\&quot;,\&quot;amount\&quot;:1000,\&quot;createDate\&quot;:\&quot;2020-01-11T06:57:06.963617Z\&quot;,\&quot;endDate\&quot;:\&quot;2021-07-11T06:57:06.963617Z\&quot;,\&quot;salt\&quot;:\&quot;224cba6c547aecc76ab6acfac41d12dfd96e7165\&quot;&#125;&quot;</span> | base64 | tr -d \\n)</span></span><br><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;VerifyAssetProperties&quot;,&quot;Args&quot;:[&quot;asset007&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_properties\&quot;:\&quot;$ASSET_PROPERTIES\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>éªŒè¯é€šè¿‡ä¹‹åï¼Œå°±å¯¹èµ„äº§å‡ºä»·ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ASSET_PRICE=$(echo -n &quot;&#123;\&quot;asset_id\&quot;:\&quot;asset007\&quot;,\&quot;trade_id\&quot;:\&quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14\&quot;,\&quot;price\&quot;:1000&#125;&quot; | base64)</span><br><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToBuy&quot;,&quot;Args&quot;:[&quot;asset007&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_price\&quot;:\&quot;$ASSET_PRICE\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>å¯ä»¥åœ¨ä¸€çº§ä¾›åº”å•†çš„éšç§æ•°æ®é›†ä¸­æŸ¥è¯¢åˆ°å‡ºä»·ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetBidPrice&quot;,&quot;Args&quot;:[&quot;asset007&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœåœ¨å…¶ä»–ç»„ç»‡ä¸ŠæŸ¥è¯¢ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹é”™è¯¯ï¼Œè¯´æ˜å‡ºä»·å–å‡ºè®¾ç½®çš„ä»·æ ¼ä¿¡æ¯æ˜¯éšç§˜çš„ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: endorsement failure during query. response: status:500 message:&quot;asset price does not exist: asset001&quot;</span><br></pre></td></tr></table></figure><h4 id="æ ¸å¿ƒä¼ä¸šæŠŠèµ„äº§è½¬ç§»ç»™ä¸€çº§ä¾›åº”å•†">æ ¸å¿ƒä¼ä¸šæŠŠèµ„äº§è½¬ç§»ç»™ä¸€çº§ä¾›åº”å•†</h4><p>æ ¸å¿ƒä¼ä¸šå’Œä¸€çº§ä¾›åº”å•†å¯¹ç›¸åŒçš„ä»·æ ¼è¾¾æˆå…±è¯†ä¹‹åï¼Œæ ¸å¿ƒä¼ä¸šå°±å¯ä»¥æŠŠèµ„äº§è½¬ç§»ç»™ä¸€çº§ä¾›åº”å•†äº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAsset&quot;,&quot;Args&quot;:[&quot;asset007&quot;,&quot;GylFOrg1MSP&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_properties\&quot;:\&quot;$ASSET_PROPERTIES\&quot;,\&quot;asset_price\&quot;:\&quot;$ASSET_PRICE\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢å…¬å…±æ•°æ®çš„èµ„äº§å½’å±ä»¥éªŒè¯äº¤æ˜“æˆåŠŸï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset001&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><h3 id="äº¤æ˜“éªŒè¯">äº¤æ˜“éªŒè¯</h3><p>é™¤äº†äº¤æ˜“åŒæ–¹å…¶ä»–äººæ— æ³•æŸ¥çœ‹åˆ°èµ„äº§è¯¦æƒ…</p><h5 id="éªŒè¯ä¸€çº§ä¾›åº”å•†å¯ä»¥ä¿®æ”¹è‡ªå·±çš„èµ„äº§çš„å…¬å…±å±æ€§ï¼š">éªŒè¯ä¸€çº§ä¾›åº”å•†å¯ä»¥ä¿®æ”¹è‡ªå·±çš„èµ„äº§çš„å…¬å…±å±æ€§ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset005&quot;,&quot;This asset is not for sale now&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡æ‰€æœ‰å››ä¸ªç»„ç»‡æŸ¥è¯¢èµ„äº§IDä¸ºasset005çš„å…¬å…±ä¿¡æ¯å¦‚ä¸‹ï¼Œè¯´æ˜ä¸€çº§ä¾›åº”å•†å·²ç»è·å¾—äº†ä¿®æ”¹æƒé™å¹¶ä¿®æ”¹äº†è¿™ä¸ªèµ„äº§çš„å…¬å…±ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(base) w:supply-finance apple$ peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset005&quot;]&#125;&#x27;|jq</span><br><span class="line">&#123;</span><br><span class="line">  &quot;objectType&quot;: &quot;asset&quot;,</span><br><span class="line">  &quot;assetID&quot;: &quot;asset005&quot;,</span><br><span class="line">  &quot;ownerOrg&quot;: &quot;GylFOrg1MSP&quot;,</span><br><span class="line">  &quot;publicDescription&quot;: &quot;This asset is not for sale now&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="éªŒè¯æ ¸å¿ƒä¼ä¸šä¸å¯ä»¥å†ä¿®æ”¹è¿™ä¸ªèµ„äº§çš„å…¬å…±ä¿¡æ¯">éªŒè¯æ ¸å¿ƒä¼ä¸šä¸å¯ä»¥å†ä¿®æ”¹è¿™ä¸ªèµ„äº§çš„å…¬å…±ä¿¡æ¯</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset005&quot;,&quot;This asset is not for sale again&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>ç»“æœæŠ¥é”™å¦‚ä¸‹ï¼Œç¬¦åˆé¢„æœŸï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: endorsement failure during invoke. response: status:500 message:&quot;a client from GylCoreOrg1MSP cannot update the description of a asset owned by GylFOrg1MSP&quot;</span><br></pre></td></tr></table></figure><h5 id="éªŒè¯åªæœ‰ä¸€çº§ä¾›åº”å•†æ‰å¯ä»¥æŸ¥è¯¢è¿™ä¸ªèµ„äº§çš„ç§æœ‰ä¿¡æ¯">éªŒè¯åªæœ‰ä¸€çº§ä¾›åº”å•†æ‰å¯ä»¥æŸ¥è¯¢è¿™ä¸ªèµ„äº§çš„ç§æœ‰ä¿¡æ¯</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset005&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼ŒéªŒè¯é€šè¿‡ï¼š</p><p>å†ä¸€çº§ä¾›åº”å•†çš„peerèŠ‚ç‚¹å¯ä»¥æŸ¥è¯¢åˆ°èµ„äº§çš„ç§æœ‰å±æ€§ï¼Œå…¶ä»–ç»„ç»‡çš„peerèŠ‚ç‚¹éƒ½æŠ¥é”™ï¼š<code>Error: endorsement failure during query. response: status:500 message:&quot;asset private details does not exist in client org's collection: asset005&quot;</code></p><h2 id="èµ„äº§æ‹†åˆ†">èµ„äº§æ‹†åˆ†</h2><h3 id="è°ƒç”¨æ‹†åˆ†æ–¹æ³•">è°ƒç”¨æ‹†åˆ†æ–¹æ³•</h3><p>å®Œæˆèµ„äº§çš„æ‹†åˆ†chaincodeçš„æ›´æ–°ä¹‹åï¼Œè°ƒç”¨æ‹†åˆ†çš„æ–¹æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;SplitAsset&quot;,&quot;Args&quot;:[&quot;asset010&quot;, &quot;500&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><h3 id="éªŒè¯æ‹†åˆ†ç»“æœ">éªŒè¯æ‹†åˆ†ç»“æœ</h3><h4 id="ç§æœ‰æ•°æ®éªŒè¯">ç§æœ‰æ•°æ®éªŒè¯</h4><h5 id="ç¬¬ä¸€ä¸ªèµ„äº§ï¼š">ç¬¬ä¸€ä¸ªèµ„äº§ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27;|jq</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;objectType&quot;: &quot;asset_properties&quot;,</span><br><span class="line">  &quot;assetID&quot;: &quot;asset0101&quot;,</span><br><span class="line">  &quot;issuer&quot;: &quot;GylCoreOrg1MSP&quot;,</span><br><span class="line">  &quot;amount&quot;: 500,</span><br><span class="line">  &quot;createDate&quot;: &quot;2020-01-11T06:57:06.963617Z&quot;,</span><br><span class="line">  &quot;endDate&quot;: &quot;2021-07-11T06:57:06.963617Z&quot;,</span><br><span class="line">  &quot;salt&quot;: &quot;224cba6c547aecc76ab6acfac41d12dfd96e7165&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ç¬¬äºŒä¸ªèµ„äº§ï¼š">ç¬¬äºŒä¸ªèµ„äº§ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset0102&quot;]&#125;&#x27;|jq</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;objectType&quot;</span>: <span class="string">&quot;asset_properties&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assetID&quot;</span>: <span class="string">&quot;asset0102&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;GylCoreOrg1MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;amount&quot;</span>: <span class="number">500</span>,</span><br><span class="line">  <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-01-11T06:57:06.963617Z&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-07-11T06:57:06.963617Z&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;salt&quot;</span>: <span class="string">&quot;224cba6c547aecc76ab6acfac41d12dfd96e7165&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="åŸå§‹çš„èµ„äº§ï¼š">åŸå§‹çš„èµ„äº§ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset010&quot;]&#125;&#x27;|jq</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼ŒåŸå§‹èµ„äº§å·²ç»æ²¡æœ‰äº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: endorsement failure during query. response: status:500 message:&quot;asset private details does not exist in client org&#x27;s collection: asset010&quot;</span><br></pre></td></tr></table></figure><h4 id="å…¬å…±æ•°æ®éªŒè¯">å…¬å…±æ•°æ®éªŒè¯</h4><h5 id="ç¬¬ä¸€ä¸ªèµ„äº§ï¼š-v2">ç¬¬ä¸€ä¸ªèµ„äº§ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27;|jq</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼Œchannelä¸Šçš„æ‰€æœ‰çš„ç»„ç»‡éƒ½å¯ä»¥çœ‹åˆ°ç›¸åŒçš„æ•°æ®ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;objectType&quot;</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assetID&quot;</span>: <span class="string">&quot;asset0101&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ownerOrg&quot;</span>: <span class="string">&quot;GylCoreOrg1MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publicDescription&quot;</span>: <span class="string">&quot;A new asset for GylCoreOrg1MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;enable&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;parentID&quot;</span>: <span class="string">&quot;asset010&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ç¬¬äºŒä¸ªèµ„äº§ï¼š-v2">ç¬¬äºŒä¸ªèµ„äº§ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset0102&quot;]&#125;&#x27;|jq</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;objectType&quot;</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assetID&quot;</span>: <span class="string">&quot;asset0102&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ownerOrg&quot;</span>: <span class="string">&quot;GylCoreOrg1MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publicDescription&quot;</span>: <span class="string">&quot;A new asset for GylCoreOrg1MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;enable&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;parentID&quot;</span>: <span class="string">&quot;asset010&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="åŸå§‹çš„èµ„äº§ï¼š-v2">åŸå§‹çš„èµ„äº§ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset010&quot;]&#125;&#x27;|jq</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼Œchaincodeæœ‰é—®é¢˜ï¼Œæ‹†åˆ†èµ„äº§ä¹‹ååŸå§‹èµ„äº§çš„çŠ¶æ€åº”è¯¥æ”¹å˜ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;objectType&quot;</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assetID&quot;</span>: <span class="string">&quot;asset010&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ownerOrg&quot;</span>: <span class="string">&quot;GylCoreOrg1MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publicDescription&quot;</span>: <span class="string">&quot;å·²æ‹†åˆ†&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;delete&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;parentID&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‹†åˆ†åçš„èµ„äº§äº¤æ˜“">æ‹†åˆ†åçš„èµ„äº§äº¤æ˜“</h2><h4 id="æ ¸å¿ƒå…è®¸å‡ºå”®èµ„äº§ï¼Œä»·æ ¼è®¾ç½®ä¸º500ï¼š">æ ¸å¿ƒå…è®¸å‡ºå”®èµ„äº§ï¼Œä»·æ ¼è®¾ç½®ä¸º500ï¼š</h4><p>ä¸‹é¢çš„trade_idæ˜¯åˆåŒçš„hashå€¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ASSET_PRICE=$(echo -n &quot;&#123;\&quot;asset_id\&quot;:\&quot;asset0101\&quot;,\&quot;trade_id\&quot;:\&quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14\&quot;,\&quot;price\&quot;:500&#125;&quot; | base64)</span><br><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToSell&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_price\&quot;:\&quot;$ASSET_PRICE\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢æ ¸å¿ƒä¼ä¸šçš„ç§æœ‰æ•°æ®é›†åˆæ¥è¯»å–åŒæ„çš„é”€å”®ä»·æ ¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetSalesPrice&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><h5 id="ä¸€çº§ä¾›åº”å•†å‡ºä»·500">ä¸€çº§ä¾›åº”å•†å‡ºä»·500</h5><p>åœ¨ä¸€çº§ä¾›åº”å•†å‡ºä»·ä¹‹å‰ï¼Œä»–éœ€è¦å…ˆéªŒè¯èµ„äº§çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®ã€‚æ­¤é“¾ç ä¸­è¿”å›trueå³ä¸ºæ­£ç¡®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ASSET_PROPERTIES=$(echo -n &quot;&#123;\&quot;objectType\&quot;:\&quot;asset_properties\&quot;,\&quot;assetID\&quot;:\&quot;asset0101\&quot;,\&quot;issuer\&quot;:\&quot;GylCoreOrg1MSP\&quot;,\&quot;amount\&quot;:500,\&quot;createDate\&quot;:\&quot;2020-01-11T06:57:06.963617Z\&quot;,\&quot;endDate\&quot;:\&quot;2021-07-11T06:57:06.963617Z\&quot;,\&quot;salt\&quot;:\&quot;224cba6c547aecc76ab6acfac41d12dfd96e7165\&quot;&#125;&quot; | base64 | tr -d \\n)</span><br><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;VerifyAssetProperties&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_properties\&quot;:\&quot;$ASSET_PROPERTIES\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>éªŒè¯é€šè¿‡ä¹‹åï¼Œå°±å¯¹èµ„äº§å‡ºä»·ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ASSET_PRICE=$(echo -n &quot;&#123;\&quot;asset_id\&quot;:\&quot;asset0101\&quot;,\&quot;trade_id\&quot;:\&quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14\&quot;,\&quot;price\&quot;:500&#125;&quot; | base64)</span><br><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToBuy&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_price\&quot;:\&quot;$ASSET_PRICE\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>å¯ä»¥åœ¨ä¸€çº§ä¾›åº”å•†çš„éšç§æ•°æ®é›†ä¸­æŸ¥è¯¢åˆ°å‡ºä»·ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetBidPrice&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœåœ¨å…¶ä»–ç»„ç»‡ä¸ŠæŸ¥è¯¢ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹é”™è¯¯ï¼Œè¯´æ˜å‡ºä»·å–å‡ºè®¾ç½®çš„ä»·æ ¼ä¿¡æ¯æ˜¯éšç§˜çš„ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: endorsement failure during query. response: status:500 message:&quot;asset price does not exist: asset001&quot;</span><br></pre></td></tr></table></figure><h4 id="æ ¸å¿ƒä¼ä¸šæŠŠèµ„äº§è½¬ç§»ç»™ä¸€çº§ä¾›åº”å•†-v2">æ ¸å¿ƒä¼ä¸šæŠŠèµ„äº§è½¬ç§»ç»™ä¸€çº§ä¾›åº”å•†</h4><p>æ ¸å¿ƒä¼ä¸šå’Œä¸€çº§ä¾›åº”å•†å¯¹ç›¸åŒçš„ä»·æ ¼è¾¾æˆå…±è¯†ä¹‹åï¼Œæ ¸å¿ƒä¼ä¸šå°±å¯ä»¥æŠŠèµ„äº§è½¬ç§»ç»™ä¸€çº§ä¾›åº”å•†äº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAsset&quot;,&quot;Args&quot;:[&quot;asset0101&quot;,&quot;GylFOrg1MSP&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_properties\&quot;:\&quot;$ASSET_PROPERTIES\&quot;,\&quot;asset_price\&quot;:\&quot;$ASSET_PRICE\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢å…¬å…±æ•°æ®çš„èµ„äº§å½’å±ä»¥éªŒè¯äº¤æ˜“æˆåŠŸï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27;|jq</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;objectType&quot;</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assetID&quot;</span>: <span class="string">&quot;asset0101&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ownerOrg&quot;</span>: <span class="string">&quot;GylFOrg1MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publicDescription&quot;</span>: <span class="string">&quot;A new asset for GylCoreOrg1MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;enable&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;parentID&quot;</span>: <span class="string">&quot;asset010&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äº¤æ˜“éªŒè¯-v2">äº¤æ˜“éªŒè¯</h3><p>é™¤äº†äº¤æ˜“åŒæ–¹å…¶ä»–äººæ— æ³•æŸ¥çœ‹åˆ°èµ„äº§è¯¦æƒ…</p><h5 id="éªŒè¯ä¸€çº§ä¾›åº”å•†å¯ä»¥ä¿®æ”¹è‡ªå·±çš„èµ„äº§çš„å…¬å…±å±æ€§ï¼š-v2">éªŒè¯ä¸€çº§ä¾›åº”å•†å¯ä»¥ä¿®æ”¹è‡ªå·±çš„èµ„äº§çš„å…¬å…±å±æ€§ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset0101&quot;,&quot;This asset is not for sale now&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹æˆåŠŸä¹‹åé‡æ–°æŸ¥è¯¢èµ„äº§çš„å…¬å…±ä¿¡æ¯ï¼ŒéªŒè¯é€šè¿‡ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;objectType&quot;</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assetID&quot;</span>: <span class="string">&quot;asset0101&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ownerOrg&quot;</span>: <span class="string">&quot;GylFOrg1MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publicDescription&quot;</span>: <span class="string">&quot;This asset is not for sale now&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;enable&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;parentID&quot;</span>: <span class="string">&quot;asset010&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="éªŒè¯æ ¸å¿ƒä¼ä¸šä¸å¯ä»¥å†ä¿®æ”¹è¿™ä¸ªèµ„äº§çš„å…¬å…±ä¿¡æ¯-v2">éªŒè¯æ ¸å¿ƒä¼ä¸šä¸å¯ä»¥å†ä¿®æ”¹è¿™ä¸ªèµ„äº§çš„å…¬å…±ä¿¡æ¯</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset0101&quot;,&quot;This asset is not for sale again&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>ç»“æœæŠ¥é”™å¦‚ä¸‹ï¼Œç¬¦åˆé¢„æœŸï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: endorsement failure during invoke. response: status:500 message:&quot;a client from GylCoreOrg1MSP cannot update the description of a asset owned by GylFOrg1MSP&quot;</span><br></pre></td></tr></table></figure><h5 id="éªŒè¯åªæœ‰ä¸€çº§ä¾›åº”å•†æ‰å¯ä»¥æŸ¥è¯¢è¿™ä¸ªèµ„äº§çš„ç§æœ‰ä¿¡æ¯-v2">éªŒè¯åªæœ‰ä¸€çº§ä¾›åº”å•†æ‰å¯ä»¥æŸ¥è¯¢è¿™ä¸ªèµ„äº§çš„ç§æœ‰ä¿¡æ¯</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼ŒéªŒè¯é€šè¿‡ï¼š</p><p>åœ¨ä¸€çº§ä¾›åº”å•†çš„peerèŠ‚ç‚¹å¯ä»¥æŸ¥è¯¢åˆ°èµ„äº§çš„ç§æœ‰å±æ€§ï¼Œå…¶ä»–ç»„ç»‡çš„peerèŠ‚ç‚¹éƒ½æŠ¥é”™ï¼š<code>Error: endorsement failure during query. response: status:500 message:&quot;asset private details does not exist in client org's collection: asset005&quot;</code></p><h2 id="ä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†äº¤æ˜“">ä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†äº¤æ˜“</h2><p>è°ƒç”¨æ‹†åˆ†çš„æ–¹æ³•ï¼Œå°†èµ„äº§æ‹†åˆ†æˆ200å’Œ300ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;SplitAsset&quot;,&quot;Args&quot;:[&quot;asset0101&quot;, &quot;200&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><h3 id="éªŒè¯æ‹†åˆ†ç»“æœ-v2">éªŒè¯æ‹†åˆ†ç»“æœ</h3><h4 id="ç§æœ‰æ•°æ®éªŒè¯-v2">ç§æœ‰æ•°æ®éªŒè¯</h4><h5 id="ç¬¬ä¸€ä¸ªèµ„äº§ï¼š-v3">ç¬¬ä¸€ä¸ªèµ„äº§ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset01011&quot;]&#125;&#x27;|jq</span><br></pre></td></tr></table></figure><h5 id="ç¬¬äºŒä¸ªèµ„äº§ï¼š-v3">ç¬¬äºŒä¸ªèµ„äº§ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27;|jq</span><br></pre></td></tr></table></figure><h5 id="åŸå§‹çš„èµ„äº§ï¼ŒåŸå§‹èµ„äº§å·²ç»æ²¡æœ‰äº†ï¼š">åŸå§‹çš„èµ„äº§ï¼ŒåŸå§‹èµ„äº§å·²ç»æ²¡æœ‰äº†ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27;|jq</span><br></pre></td></tr></table></figure><h4 id="å…¬å…±æ•°æ®éªŒè¯-v2">å…¬å…±æ•°æ®éªŒè¯</h4><h5 id="ç¬¬ä¸€ä¸ªèµ„äº§ï¼š-v4">ç¬¬ä¸€ä¸ªèµ„äº§ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset01011&quot;]&#125;&#x27;|jq</span><br></pre></td></tr></table></figure><h5 id="ç¬¬äºŒä¸ªèµ„äº§ï¼š-v4">ç¬¬äºŒä¸ªèµ„äº§ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27;|jq</span><br></pre></td></tr></table></figure><h5 id="åŸå§‹çš„èµ„äº§ï¼Œæ‹†åˆ†èµ„äº§ä¹‹ååŸå§‹èµ„äº§çš„çŠ¶æ€åº”è¯¥æ”¹å˜ï¼š">åŸå§‹çš„èµ„äº§ï¼Œæ‹†åˆ†èµ„äº§ä¹‹ååŸå§‹èµ„äº§çš„çŠ¶æ€åº”è¯¥æ”¹å˜ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27;|jq</span><br></pre></td></tr></table></figure><h2 id="æ‹†åˆ†åçš„èµ„äº§äº¤æ˜“-v2">æ‹†åˆ†åçš„èµ„äº§äº¤æ˜“</h2><h4 id="ä¸€çº§ä¾›åº”å•†å…è®¸å‡ºå”®èµ„äº§ï¼Œè®¾ç½®ä»·æ ¼ï¼š">ä¸€çº§ä¾›åº”å•†å…è®¸å‡ºå”®èµ„äº§ï¼Œè®¾ç½®ä»·æ ¼ï¼š</h4><p>ä¸‹é¢çš„trade_idæ˜¯åˆåŒçš„hashå€¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ASSET_PRICE=$(echo -n &quot;&#123;\&quot;asset_id\&quot;:\&quot;asset01012\&quot;,\&quot;trade_id\&quot;:\&quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb\&quot;,\&quot;price\&quot;:300&#125;&quot; | base64)</span><br><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToSell&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_price\&quot;:\&quot;$ASSET_PRICE\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢æ ¸å¿ƒä¼ä¸šçš„ç§æœ‰æ•°æ®é›†åˆæ¥è¯»å–åŒæ„çš„é”€å”®ä»·æ ¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetSalesPrice&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><h5 id="äºŒçº§ä¾›åº”å•†2å‡ºä»·300">äºŒçº§ä¾›åº”å•†2å‡ºä»·300</h5><p>åœ¨äºŒçº§ä¾›åº”å•†2å‡ºä»·ä¹‹å‰ï¼Œä»–éœ€è¦å…ˆéªŒè¯èµ„äº§çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®ã€‚æ­¤é“¾ç ä¸­è¿”å›trueå³ä¸ºæ­£ç¡®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ASSET_PROPERTIES=$(echo -n &quot;&#123;\&quot;objectType\&quot;:\&quot;asset_properties\&quot;,\&quot;assetID\&quot;:\&quot;asset01012\&quot;,\&quot;issuer\&quot;:\&quot;GylCoreOrg1MSP\&quot;,\&quot;amount\&quot;:300,\&quot;createDate\&quot;:\&quot;2020-01-11T06:57:06.963617Z\&quot;,\&quot;endDate\&quot;:\&quot;2021-07-11T06:57:06.963617Z\&quot;,\&quot;salt\&quot;:\&quot;224cba6c547aecc76ab6acfac41d12dfd96e7165\&quot;&#125;&quot; | base64 | tr -d \\n)</span><br><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;VerifyAssetProperties&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_properties\&quot;:\&quot;$ASSET_PROPERTIES\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>éªŒè¯é€šè¿‡ä¹‹åï¼Œå°±å¯¹èµ„äº§å‡ºä»·ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ASSET_PRICE=$(echo -n &quot;&#123;\&quot;asset_id\&quot;:\&quot;asset01012\&quot;,\&quot;trade_id\&quot;:\&quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb\&quot;,\&quot;price\&quot;:300&#125;&quot; | base64)</span><br><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToBuy&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_price\&quot;:\&quot;$ASSET_PRICE\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>å¯ä»¥åœ¨ä¸€çº§ä¾›åº”å•†çš„éšç§æ•°æ®é›†ä¸­æŸ¥è¯¢åˆ°å‡ºä»·ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetBidPrice&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœåœ¨å…¶ä»–ç»„ç»‡ä¸ŠæŸ¥è¯¢ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹é”™è¯¯ï¼Œè¯´æ˜å‡ºä»·å–å‡ºè®¾ç½®çš„ä»·æ ¼ä¿¡æ¯æ˜¯éšç§˜çš„ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: endorsement failure during query. response: status:500 message:&quot;asset price does not exist: asset001&quot;</span><br></pre></td></tr></table></figure><h4 id="ä¸€çº§ä¾›åº”å•†æŠŠèµ„äº§è½¬ç§»ç»™äºŒçº§ä¾›åº”å•†2">ä¸€çº§ä¾›åº”å•†æŠŠèµ„äº§è½¬ç§»ç»™äºŒçº§ä¾›åº”å•†2</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAsset&quot;,&quot;Args&quot;:[&quot;asset01012&quot;,&quot;GylSOrg2MSP&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_properties\&quot;:\&quot;$ASSET_PROPERTIES\&quot;,\&quot;asset_price\&quot;:\&quot;$ASSET_PRICE\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢å…¬å…±æ•°æ®çš„èµ„äº§å½’å±ä»¥éªŒè¯äº¤æ˜“æˆåŠŸï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27;|jq</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;objectType&quot;</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assetID&quot;</span>: <span class="string">&quot;asset01012&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ownerOrg&quot;</span>: <span class="string">&quot;GylSOrg2MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publicDescription&quot;</span>: <span class="string">&quot;This asset is not for sale now&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;enable&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;parentID&quot;</span>: <span class="string">&quot;asset0101&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äº¤æ˜“éªŒè¯-v3">äº¤æ˜“éªŒè¯</h3><p>é™¤äº†äº¤æ˜“åŒæ–¹å…¶ä»–äººæ— æ³•æŸ¥çœ‹åˆ°èµ„äº§è¯¦æƒ…</p><h5 id="éªŒè¯äºŒçº§çº§ä¾›åº”å•†2å¯ä»¥ä¿®æ”¹è‡ªå·±çš„èµ„äº§çš„å…¬å…±å±æ€§ï¼š">éªŒè¯äºŒçº§çº§ä¾›åº”å•†2å¯ä»¥ä¿®æ”¹è‡ªå·±çš„èµ„äº§çš„å…¬å…±å±æ€§ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset01012&quot;,&quot;hello i am GylSOrg2MSP&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹æˆåŠŸä¹‹åé‡æ–°æŸ¥è¯¢èµ„äº§çš„å…¬å…±ä¿¡æ¯ï¼ŒéªŒè¯é€šè¿‡ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;objectType&quot;</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assetID&quot;</span>: <span class="string">&quot;asset01012&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ownerOrg&quot;</span>: <span class="string">&quot;GylSOrg2MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publicDescription&quot;</span>: <span class="string">&quot;hello i am GylSOrg2MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;enable&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;parentID&quot;</span>: <span class="string">&quot;asset0101&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="éªŒè¯åªæœ‰äºŒçº§çº§ä¾›åº”å•†2æ‰å¯ä»¥æŸ¥è¯¢è¿™ä¸ªèµ„äº§çš„ç§æœ‰ä¿¡æ¯">éªŒè¯åªæœ‰äºŒçº§çº§ä¾›åº”å•†2æ‰å¯ä»¥æŸ¥è¯¢è¿™ä¸ªèµ„äº§çš„ç§æœ‰ä¿¡æ¯</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼ŒéªŒè¯é€šè¿‡ï¼š</p><p>åœ¨ä¸€çº§ä¾›åº”å•†çš„peerèŠ‚ç‚¹å¯ä»¥æŸ¥è¯¢åˆ°èµ„äº§çš„ç§æœ‰å±æ€§ï¼Œå…¶ä»–ç»„ç»‡çš„peerèŠ‚ç‚¹éƒ½æŠ¥é”™ï¼š<code>Error: endorsement failure during query. response: status:500 message:&quot;asset private details does not exist in client org's collection: asset005&quot;</code></p><h2 id="chaincodeæ¥å£è®°å½•">chaincodeæ¥å£è®°å½•</h2><h3 id="æŸ¥è¯¢å–å‡ºçš„äº¤æ˜“ä¿¡æ¯">æŸ¥è¯¢å–å‡ºçš„äº¤æ˜“ä¿¡æ¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;QueryAssetSaleAgreements&quot;,&quot;Args&quot;:[]&#125;&#x27;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢èµ„äº§çš„å…¬å…±ä¿¡æ¯">æŸ¥è¯¢èµ„äº§çš„å…¬å…±ä¿¡æ¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27;|jq</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢ç§æœ‰èµ„äº§ä¿¡æ¯">æŸ¥è¯¢ç§æœ‰èµ„äº§ä¿¡æ¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27;|jq</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢ä¸€ä¸ªèµ„äº§å…¬å…±ä¿¡æ¯çš„å†å²æ•°æ®">æŸ¥è¯¢ä¸€ä¸ªèµ„äº§å…¬å…±ä¿¡æ¯çš„å†å²æ•°æ®</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;QueryAssetHistory&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27;|jq</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> ä¾›åº”é“¾é‡‘è </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> peer </tag>
            
            <tag> ä¾›åº”é“¾é‡‘è </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éƒ¨ç½²æ–°çš„æ™ºèƒ½åˆçº¦åˆ°channel</title>
      <link href="2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E9%83%A8%E7%BD%B2%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%88%B0channel/"/>
      <url>2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E9%83%A8%E7%BD%B2%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%88%B0channel/</url>
      
        <content type="html"><![CDATA[<h1 id="éƒ¨ç½²æ–°çš„æ™ºèƒ½åˆçº¦åˆ°channel">éƒ¨ç½²æ–°çš„æ™ºèƒ½åˆçº¦åˆ°channel</h1><h2 id="éƒ¨ç½²V1ç‰ˆæœ¬">éƒ¨ç½²V1ç‰ˆæœ¬</h2><h3 id="æ‰“åŒ…">æ‰“åŒ…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode package supply.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/chaincode-go/ --lang golang --label supply_1.0</span><br></pre></td></tr></table></figure><p>è¿è¡Œå®Œä¸Šé¢çš„å‘½ä»¤ï¼ŒæŸ¥çœ‹å½“å‰ç›®å½•ä¼šå‘ç°å¤šäº†<code>supply.tar.gz</code>åŒ…ï¼Œè¯´æ˜æ‰“åŒ…æˆåŠŸã€‚</p><h3 id="å®‰è£…é“¾ç åŒ…">å®‰è£…é“¾ç åŒ…</h3><p>ä¸€çº§ä¾›åº”å•†å’Œæ ¸å¿ƒä¼ä¸šéƒ½è¦å®‰è£…ï¼š<br>æ ¸å¿ƒä¼ä¸šï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode install supply.tar.gz --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>ä¸€çº§ä¾›åº”å•†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode install supply.tar.gz --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>å®‰è£…æˆåŠŸè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-28 17:12:37.540 CST [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 001 Installed remotely: response:&lt;status:200 payload:&quot;\nKsupply_1.0:7f51b70454bfcc78087a784c84288a67bbad56786e4007c3a7106491a492ad3a\022\nsupply_1.0&quot; &gt;</span><br><span class="line">2020-12-28 17:12:37.542 CST [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 002 Chaincode code package identifier: supply_1.0:7f51b70454bfcc78087a784c84288a67bbad56786e4007c3a7106491a492ad3a</span><br></pre></td></tr></table></figure><h3 id="æ‰¹å‡†é“¾ç å®šä¹‰">æ‰¹å‡†é“¾ç å®šä¹‰</h3><h4 id="æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode">æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode queryinstalled</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Installed chaincodes on peer:</span><br><span class="line">Package ID: basic_1.0:4ec191e793b27e953ff2ede5a8bcc63152cecb1e4c3f301a26e22692c61967ad, Label: basic_1.0</span><br><span class="line">Package ID: supply_1.0:7f51b70454bfcc78087a784c84288a67bbad56786e4007c3a7106491a492ad3a, Label: supply_1.0</span><br></pre></td></tr></table></figure><p>å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export CC_PACKAGE_ID=supply_1.0:7f51b70454bfcc78087a784c84288a67bbad56786e4007c3a7106491a492ad3a</span><br></pre></td></tr></table></figure><h4 id="æ‰¹å‡†é“¾ç å®šä¹‰-v2">æ‰¹å‡†é“¾ç å®šä¹‰</h4><p>æ ¸å¿ƒä¼ä¸šå’Œä¸€çº§ä¾›åº”å•†éƒ½éœ€è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode approveformyorg -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name supply --version 1.0 --package-id $CC_PACKAGE_ID --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2020-12-28 17:14:07.090 CST [chaincodeCmd] ClientWait -&gt; INFO 001 txid [5c192d72135019a4bd6d444231fc95d41b6c7391cbc80a98cb67618f5e7a85c6] committed with status (VALID) at localhost:8053</span><br></pre></td></tr></table></figure><h3 id="å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“">å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“</h3><p>æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode checkcommitreadiness --channelID coreandfirstchannel --name supply --version 1.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;approvals&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;GylCoreOrg1MSP&quot;</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">&quot;GylFOrg1MSP&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸¤ä¸ªç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode commit -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name supply --version 1.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-28 17:14:57.631 CST [chaincodeCmd] ClientWait -&gt; INFO 001 txid [1c5e194c62a24b9fe78d51bd7003fce369f01a0b3051f63ed5e1f9ee4f6cf48b] committed with status (VALID) at localhost:8051</span><br><span class="line">2020-12-28 17:14:57.631 CST [chaincodeCmd] ClientWait -&gt; INFO 002 txid [1c5e194c62a24b9fe78d51bd7003fce369f01a0b3051f63ed5e1f9ee4f6cf48b] committed with status (VALID) at localhost:8053</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-querycommitted">peer lifecycle chaincode querycommitted</a> å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode querycommitted --channelID coreandfirstchannel --name supply --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Committed chaincode definition for chaincode &#x27;supply&#x27; on channel &#x27;coreandfirstchannel&#x27;:</span><br><span class="line">Version: 1.0, Sequence: 1, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [GylCoreOrg1MSP: true, GylFOrg1MSP: true]</span><br></pre></td></tr></table></figure><h3 id="è°ƒç”¨é“¾ç ">è°ƒç”¨é“¾ç </h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C coreandfirstchannel -n supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;IssueVoucher&quot;,&quot;Args&quot;:[&quot;100&quot;, &quot;ä¸€çº§ä¾›åº”å•†&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>æˆåŠŸä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2020-12-25 17:26:22.583 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200</span><br></pre></td></tr></table></figure><p><strong>é”™è¯¯ä¿¡æ¯è®°å½•ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: could not assemble transaction: ProposalResponsePayloads do not match - proposal response: version:1 response:&lt;status:200 &gt; payload:&quot;\n \266\367\033\202\030f\357\010\266zg\350\237\212\313 \342B\2041\316\351&gt;H\037\035\312\274J\021i\220\022\266\002\n\237\002\0227\n\n_lifecycle\022)\n&#x27;\n!namespaces/fields/supply/Sequence\022\002\010\t\022\343\001\n\006supply\022\330\001\n\003\n\0011\032\320\001\n\0011\032\312\001&#123;\&quot;ID\&quot;:\&quot;1\&quot;,\&quot;issuer\&quot;:\&quot;\346\240\270\345\277\203\344\274\201\344\270\232\&quot;,\&quot;owner\&quot;:\&quot;\346\240\270\345\277\203\344\274\201\344\270\232\&quot;,\&quot;amount\&quot;:100,\&quot;createDate\&quot;:\&quot;2020-12-28T09:24:44.871052163Z\&quot;,\&quot;endDate\&quot;:\&quot;2021-06-28T09:24:44.871052228Z\&quot;,\&quot;contractHash\&quot;:\&quot;test\&quot;,\&quot;invoiceHash\&quot;:\&quot;test\&quot;&#125;\032\003\010\310\001\&quot;\r\022\006supply\032\0031.0&quot; endorsement:&lt;endorser:&quot;\n\013GylFOrg1MSP\022\212\006-----BEGIN CERTIFICATE-----\nMIICETCCAbegAwIBAgIRAKxyUt8FsMI4LRaMcjh08ZgwCgYIKoZIzj0EAwIwbTEL\nMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNhbGlmb3JuaWExFjAUBgNVBAcTDVNhbiBG\ncmFuY2lzY28xFjAUBgNVBAoTDWYxLnN1cHBseS5jb20xGTAXBgNVBAMTEGNhLmYx\nLnN1cHBseS5jb20wHhcNMjAxMjI1MDkxNzAwWhcNMzAxMjIzMDkxNzAwWjBYMQsw\nCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMNU2FuIEZy\nYW5jaXNjbzEcMBoGA1UEAxMTcGVlcjAuZjEuc3VwcGx5LmNvbTBZMBMGByqGSM49\nAgEGCCqGSM49AwEHA0IABIChG5EnW6enlGqH2F9EiWYbilBwfA+KgqqxnN56njS5\ngv368PElfoafV6jCrjA+p2OnbTI3gO2/RAwr2WBLB0+jTTBLMA4GA1UdDwEB/wQE\nAwIHgDAMBgNVHRMBAf8EAjAAMCsGA1UdIwQkMCKAIHNOBiXoFslrjdFMBMzU7pNe\nI5pmxxrQGrWTdgfI0cetMAoGCCqGSM49BAMCA0gAMEUCIQDEOKc114LvsauKzrMR\n7k6ipg0HPM1+W8JJt06Jeqd1vwIgBre+xg2g/rS7F5oZaJpECUf7ALV0fy9/Dhw0\nYDB3H+g=\n-----END CERTIFICATE-----\n&quot; signature:&quot;0D\002 9\020\212\014\220\302Ao_\226n`o\005\354B\263\316\346\330\347\010\217\205^X\&quot;\267d\320U\365\002 \t&lt;\024e\324\312X\036\346=\025.I*A\311\223\013\301\276\320\232\366\246tZm\341g\223\235|&quot; &gt;</span><br></pre></td></tr></table></figure><p>åŸå› åº”è¯¥æ˜¯ä»£ç ä¸­ä½¿ç”¨äº†Nowï¼ˆï¼‰æ¥åˆ›å»ºå½“å‰æ—¶é—´ï¼Œä¸¤ä¸ªpeerçš„å½“å‰æ—¶é—´å¯èƒ½ä¼šæœ‰ä¸€ç‚¹è¯¯å·®å¯¼è‡´äº†æ ¡éªŒä¸é€šè¿‡ã€‚</p><p>**è§£å†³æ–¹æ¡ˆï¼š**ä½¿ç”¨<code>ctx.GetStub().GetTxTimestamp()</code>æ¥è·å–æ—¶é—´ï¼Œè¿™æ ·æ‰€æœ‰çš„èŠ‚ç‚¹åˆ›å»ºçš„æ—¶é—´éƒ½æ˜¯ä¸€è‡´çš„ï¼Œè¯¦è§<a href="https://stackoverflow.com/questions/55289283/hyperledger-fabric-error-could-not-assemble-transaction-proposalresponsepaylo/61727958">å‚è€ƒæ–‡æ¡£</a></p><h2 id="æ›´æ–°æ™ºèƒ½åˆçº¦">æ›´æ–°æ™ºèƒ½åˆçº¦</h2><h3 id="æ‰“åŒ…-v2">æ‰“åŒ…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> peer lifecycle chaincode package supply.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/fabric-samples/asset-transfer-basic/chaincode-go/ --lang golang --label supply_1.0</span></span><br></pre></td></tr></table></figure><p>æ‰“åŒ…æœ¬åœ°çš„ä»£ç ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode package supply.5.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/chaincode-go/ --lang golang --label supply_5.0</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…é“¾ç åŒ…-v2">å®‰è£…é“¾ç åŒ…</h3><p>ä¸€çº§ä¾›åº”å•†å’Œæ ¸å¿ƒä¼ä¸šéƒ½è¦å®‰è£…ï¼š<br>æ ¸å¿ƒä¼ä¸šï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode install supply.5.tar.gz --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>ä¸€çº§ä¾›åº”å•†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode install supply.5.tar.gz --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><h3 id="æ‰¹å‡†é“¾ç å®šä¹‰-v3">æ‰¹å‡†é“¾ç å®šä¹‰</h3><h4 id="æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode-v2">æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode queryinstalled</span><br></pre></td></tr></table></figure><p>å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ï¼Œä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦å®šä¹‰æ­¤å˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export CC_PACKAGE_ID=supply_5.0:0006888ea72e1b318238518b719382d440ab72f2d2c45b22e674f4828b7f7f9c</span><br></pre></td></tr></table></figure><h4 id="æ‰¹å‡†é“¾ç å®šä¹‰-v4">æ‰¹å‡†é“¾ç å®šä¹‰</h4><p>æ ¸å¿ƒä¼ä¸šå’Œä¸€çº§ä¾›åº”å•†éƒ½éœ€è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode approveformyorg -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name supply --version 5.0 --package-id $CC_PACKAGE_ID --sequence 5 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2020-12-28 17:58:55.313 CST [chaincodeCmd] ClientWait -&gt; INFO 001 txid [c4974d5c90ae4fb3bd31f179292d9943dd05aac47248f33e365d9f32ccb5ccb6] committed with status (VALID) at localhost:8051</span><br></pre></td></tr></table></figure><h3 id="å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“-v2">å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“</h3><p>æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode checkcommitreadiness --channelID coreandfirstchannel --name supply --version 5.0 --sequence 5 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;approvals&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;GylCoreOrg1MSP&quot;</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">&quot;GylFOrg1MSP&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸¤ä¸ªç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode commit -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name supply --version 5.0 --sequence 5 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-28 17:51:08.452 CST [chaincodeCmd] ClientWait -&gt; INFO 001 txid [87bc060e5ccdf4014cd4cf34bbbeb5d2ea10c4ff8ebb6f444d10580e2de2da50] committed with status (VALID) at localhost:8053</span><br><span class="line">2020-12-28 17:51:08.460 CST [chaincodeCmd] ClientWait -&gt; INFO 002 txid [87bc060e5ccdf4014cd4cf34bbbeb5d2ea10c4ff8ebb6f444d10580e2de2da50] committed with status (VALID) at localhost:8051</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-querycommitted">peer lifecycle chaincode querycommitted</a> å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode querycommitted --channelID coreandfirstchannel --name supply --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹,å¯ä»¥çœ‹åˆ°å·²ç»å‡çº§åˆ°2.0ç‰ˆæœ¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Committed chaincode definition for chaincode &#x27;supply&#x27; on channel &#x27;coreandfirstchannel&#x27;:</span><br><span class="line">Version: 2.0, Sequence: 2, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [GylCoreOrg1MSP: true, GylFOrg1MSP: true]</span><br></pre></td></tr></table></figure><h3 id="è°ƒç”¨é“¾ç -v2">è°ƒç”¨é“¾ç </h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C coreandfirstchannel -n supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;IssueVoucher&quot;,&quot;Args&quot;:[&quot;asset001&quot;, &quot;100&quot;, &quot;ä¸€çº§ä¾›åº”å•†&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2020-12-28 18:37:54.285 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200</span><br></pre></td></tr></table></figure><p><strong>é”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: could not assemble transaction: proposal response was not successful, error code 500, msg Incorrect number of params. Expected 2, received 1 - proposal response: version:1 response:&lt;status:200 &gt; payload:&quot;\n \177\017\350[\344G6\010V\331\332\377\354\216&amp;\035\317&amp;\251[N`\023\036\033\237\237A\005\3670\260\022\266\002\n\237\002\0227\n\n_lifecycle\022)\n&#x27;\n!namespaces/fields/supply/Sequence\022\002\010\016\022\343\001\n\006supply\022\330\001\n\003\n\0011\032\320\001\n\0011\032\312\001&#123;\&quot;ID\&quot;:\&quot;1\&quot;,\&quot;issuer\&quot;:\&quot;\346\240\270\345\277\203\344\274\201\344\270\232\&quot;,\&quot;owner\&quot;:\&quot;\346\240\270\345\277\203\344\274\201\344\270\232\&quot;,\&quot;amount\&quot;:100,\&quot;createDate\&quot;:\&quot;2020-12-28T10:02:30.578872398Z\&quot;,\&quot;endDate\&quot;:\&quot;2021-06-28T10:02:30.578872527Z\&quot;,\&quot;contractHash\&quot;:\&quot;test\&quot;,\&quot;invoiceHash\&quot;:\&quot;test\&quot;&#125;\032\003\010\310\001\&quot;\r\022\006supply\032\0033.0&quot; endorsement:&lt;endorser:&quot;\n\016GylCoreOrg1MSP\022\222\006-----BEGIN CERTIFICATE-----\nMIICFjCCAbygAwIBAgIQU43L5gjtXO+uCpRP2jG2AjAKBggqhkjOPQQDAjBxMQsw\nCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMNU2FuIEZy\nYW5jaXNjbzEYMBYGA1UEChMPY29yZS5zdXBwbHkuY29tMRswGQYDVQQDExJjYS5j\nb3JlLnN1cHBseS5jb20wHhcNMjAxMjI1MDkxNzAwWhcNMzAxMjIzMDkxNzAwWjBa\nMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMNU2Fu\nIEZyYW5jaXNjbzEeMBwGA1UEAxMVcGVlcjAuY29yZS5zdXBwbHkuY29tMFkwEwYH\nKoZIzj0CAQYIKoZIzj0DAQcDQgAErf3R+7XpNQpmTsMO+iM4WS7IrOoafiPbAS7Q\nbuFFR3Qs4riIczgSmjh9rOA6I1q2q0CstLhfWDbqpf+8fXPUlKNNMEswDgYDVR0P\nAQH/BAQDAgeAMAwGA1UdEwEB/wQCMAAwKwYDVR0jBCQwIoAguznqsTisa64dNvOR\nvPwP0KGklWohNpbSe7VgIghx4L8wCgYIKoZIzj0EAwIDSAAwRQIhALIw1VMzezCg\n9LONbO4+V+weY42HQLbShkTP/gCFnGRYAiARyLLSDJIC2wwzSvOHNdm+aDRtbqGC\nNJenP9hmEbYsTw==\n-----END CERTIFICATE-----\n&quot; signature:&quot;0E\002!\000\251\370K6S\020\373\242\321\000\211\312\0001\333\365&gt;\314\324\231\020&gt;u;+\243\303dD\023\221\237\002 z \224\236R\355Z\251\202\363\035\304\365\212\277\235\375?\376\030\371\236\220\354iG6\244\334M\315\331&quot; &gt;</span><br></pre></td></tr></table></figure><p>åŸå› æ˜¯å› ä¸ºä¸‹å›¾ï¼Œåªæœ‰ä¸€ä¸ªç»„ç»‡çš„é“¾ç æ›´æ–°åˆ°äº†æœ€æ–°çš„ç‰ˆæœ¬ã€‚</p><p>![æˆªå±2020-12-28 18.03.06](/Users/apple/Desktop/æˆªå±2020-12-28 18.03.06.png)</p><p>**è§£å†³æ–¹æ¡ˆï¼š**åŸå› æ˜¯å› ä¸ºè®¾ç½®ç¯å¢ƒå˜é‡<code>CC_PACKAGE_ID</code>æ—¶åªè®¾ç½®äº†ä¸€ä¸ªç»„ç»‡çš„peerï¼Œå¯¼è‡´æ—§çš„ç¯å¢ƒå˜é‡è¿˜åœ¨ç”Ÿæ•ˆï¼Œé‡æ–°æ“ä½œä¸€éé—®é¢˜è§£å†³ã€‚</p><h4 id="æŸ¥è¯¢è°ƒç”¨åçš„ç»“æœ">æŸ¥è¯¢è°ƒç”¨åçš„ç»“æœ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -C coreandfirstchannel -n supply -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ ¸å¿ƒä¼ä¸š</span></span><br><span class="line">[&#123;&quot;ID&quot;:&quot;asset001&quot;,&quot;issuer&quot;:&quot;æ ¸å¿ƒä¼ä¸š&quot;,&quot;owner&quot;:&quot;æ ¸å¿ƒä¼ä¸š&quot;,&quot;amount&quot;:100,&quot;createDate&quot;:&quot;2020-12-28T10:37:54.271518Z&quot;,&quot;endDate&quot;:&quot;2021-06-28T10:37:54.271518Z&quot;,&quot;contractHash&quot;:&quot;test&quot;,&quot;invoiceHash&quot;:&quot;test&quot;&#125;]</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸€çº§ä¾›åº”å•†</span></span><br><span class="line">[&#123;&quot;ID&quot;:&quot;asset001&quot;,&quot;issuer&quot;:&quot;æ ¸å¿ƒä¼ä¸š&quot;,&quot;owner&quot;:&quot;æ ¸å¿ƒä¼ä¸š&quot;,&quot;amount&quot;:100,&quot;createDate&quot;:&quot;2020-12-28T10:37:54.271518Z&quot;,&quot;endDate&quot;:&quot;2021-06-28T10:37:54.271518Z&quot;,&quot;contractHash&quot;:&quot;test&quot;,&quot;invoiceHash&quot;:&quot;test&quot;&#125;]</span><br></pre></td></tr></table></figure><h3 id="è°ƒç”¨äº¤æ˜“æ–¹æ³•">è°ƒç”¨äº¤æ˜“æ–¹æ³•</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C coreandfirstchannel -n supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAsset&quot;,&quot;Args&quot;:[&quot;asset001&quot;, &quot;ä¸€çº§ä¾›åº”å•†&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>å†æ¬¡æŸ¥è¯¢ï¼š<code>peer chaincode query -C coreandfirstchannel -n supply -c '&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;'</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ ¸å¿ƒä¼ä¸š</span></span><br><span class="line">[&#123;&quot;ID&quot;:&quot;asset001&quot;,&quot;issuer&quot;:&quot;æ ¸å¿ƒä¼ä¸š&quot;,&quot;owner&quot;:&quot;ä¸€çº§ä¾›åº”å•†&quot;,&quot;amount&quot;:100,&quot;createDate&quot;:&quot;2020-12-28T10:37:54.271518Z&quot;,&quot;endDate&quot;:&quot;2021-06-28T10:37:54.271518Z&quot;,&quot;contractHash&quot;:&quot;test&quot;,&quot;invoiceHash&quot;:&quot;test&quot;&#125;]</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸€çº§ä¾›åº”å•†</span></span><br><span class="line">[&#123;&quot;ID&quot;:&quot;asset001&quot;,&quot;issuer&quot;:&quot;æ ¸å¿ƒä¼ä¸š&quot;,&quot;owner&quot;:&quot;ä¸€çº§ä¾›åº”å•†&quot;,&quot;amount&quot;:100,&quot;createDate&quot;:&quot;2020-12-28T10:37:54.271518Z&quot;,&quot;endDate&quot;:&quot;2021-06-28T10:37:54.271518Z&quot;,&quot;contractHash&quot;:&quot;test&quot;,&quot;invoiceHash&quot;:&quot;test&quot;&#125;]</span><br></pre></td></tr></table></figure><p>äº¤æ˜“ä¹‹åownerå˜æˆäº†ä¸€çº§ä¾›åº”å•†ï¼Œæ²¡æœ‰é—®é¢˜ã€‚</p><h2 id="é—®é¢˜è®°å½•ï¼š">é—®é¢˜è®°å½•ï¼š</h2><p>è™½ç„¶æ™ºèƒ½åˆçº¦çš„ä»£ç ç¼–å†™æ–¹å¼å¦‚ä¸‹ï¼Œä½†æ˜¯ç¬¬äºŒè¡Œçš„<code>TransferAsset</code>å¹¶æ²¡æœ‰æ‰§è¡Œï¼Œå¯èƒ½æ˜¯å› ä¸ºç¬¬ä¸€ä¸ªåˆ›å»ºäº¤æ˜“ï¼ˆCreateAssetï¼‰è¿˜æ²¡æœ‰æˆåŠŸï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªäº¤æ˜“ï¼ˆTransferAssetï¼‰æ²¡æœ‰è¿™ä¸ªèµ„äº§æ‰€ä»¥æ²¡æœ‰æ‰§è¡Œï¼Ÿå¾…ç¡®è®¤</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºèµ„äº§</span></span><br><span class="line">s.CreateAsset(ctx, assetID, amount)</span><br><span class="line">s.TransferAsset(ctx, assetID, owner)</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²v6ç‰ˆæœ¬çš„supply">éƒ¨ç½²v6ç‰ˆæœ¬çš„supply</h2><h3 id="v6ç‰ˆæœ¬æ™ºèƒ½åˆçº¦æºç å¦‚ä¸‹ï¼š">v6ç‰ˆæœ¬æ™ºèƒ½åˆçº¦æºç å¦‚ä¸‹ï¼š</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chaincode</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;encoding/json&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;github.com/golang/protobuf/ptypes&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// SmartContract provides functions for managing an Asset</span></span><br><span class="line"><span class="keyword">type</span> SmartContract <span class="keyword">struct</span> &#123;</span><br><span class="line">contractapi.Contract</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Asset describes basic details of what makes up a simple asset</span></span><br><span class="line"><span class="keyword">type</span> Asset <span class="keyword">struct</span> &#123;</span><br><span class="line">ID           <span class="keyword">string</span>    <span class="string">`json:&quot;ID&quot;`</span></span><br><span class="line">Issuer       <span class="keyword">string</span>    <span class="string">`json:&quot;issuer&quot;`</span></span><br><span class="line">Owner        <span class="keyword">string</span>    <span class="string">`json:&quot;owner&quot;`</span></span><br><span class="line">Amount       <span class="keyword">int64</span>     <span class="string">`json:&quot;amount&quot;`</span></span><br><span class="line">CreateDate   time.Time <span class="string">`json:&quot;createDate&quot;`</span></span><br><span class="line">EndDate      time.Time <span class="string">`json:&quot;endDate&quot;`</span></span><br><span class="line">ContractHash <span class="keyword">string</span>    <span class="string">`json:&quot;contractHash&quot;`</span></span><br><span class="line">InvoiceHash  <span class="keyword">string</span>    <span class="string">`json:&quot;invoiceHash&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IssueVoucher å‘è¡Œå‡­è¯</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">IssueVoucher</span><span class="params">(ctx contractapi.TransactionContextInterface, assetID <span class="keyword">string</span>, amount <span class="keyword">int64</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="comment">// åˆ›å»ºèµ„äº§</span></span><br><span class="line">asset, err := s.createAsset(ctx, assetID, amount, <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>, <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s.PutState(ctx, asset)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// createAsset issues a new asset to the world state with given details.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">createAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>, amount <span class="keyword">int64</span>, issuerName <span class="keyword">string</span>, owner <span class="keyword">string</span>)</span> <span class="params">(*Asset, error)</span></span> &#123;</span><br><span class="line">exists, err := s.AssetExists(ctx, id)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> exists &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;the asset %s already exists&quot;</span>, id)</span><br><span class="line">&#125;</span><br><span class="line">now, err := getNow(ctx)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line">asset := Asset&#123;ID: id, Issuer: issuerName, Amount: amount, Owner: owner, CreateDate: now,</span><br><span class="line">EndDate: now.AddDate(<span class="number">0</span>, <span class="number">6</span>, <span class="number">0</span>), ContractHash: <span class="string">&quot;test&quot;</span>, InvoiceHash: <span class="string">&quot;test&quot;</span>&#125;</span><br><span class="line"><span class="keyword">return</span> &amp;asset, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getNow</span><span class="params">(ctx contractapi.TransactionContextInterface)</span> <span class="params">(time.Time, error)</span></span> &#123;</span><br><span class="line">now, err := ctx.GetStub().GetTxTimestamp()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> time.Now(), err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ptypes.Timestamp(now)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReadAsset returns the asset stored in the world state with given id.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">ReadAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>)</span> <span class="params">(*Asset, error)</span></span> &#123;</span><br><span class="line">assetJSON, err := ctx.GetStub().GetState(id)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;failed to read from world state: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> assetJSON == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;the asset %s does not exist&quot;</span>, id)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> asset Asset</span><br><span class="line">err = json.Unmarshal(assetJSON, &amp;asset)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> &amp;asset, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AssetExists returns true when asset with given ID exists in world state</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">AssetExists</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">bool</span>, error)</span></span> &#123;</span><br><span class="line">assetJSON, err := ctx.GetStub().GetState(id)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, fmt.Errorf(<span class="string">&quot;failed to read from world state: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> assetJSON != <span class="literal">nil</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TransferAsset updates the owner field of asset with given id in world state.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">TransferAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>, newOwner <span class="keyword">string</span>, amount <span class="keyword">int64</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">asset, err := s.ReadAsset(ctx, id)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¦‚æœé‡‘é¢åˆšå¥½ç­‰äºå‡­è¯èµ„äº§çš„é‡‘é¢ï¼Œç›´æ¥æ›´æ–°å‡­è¯èµ„äº§çš„æ‹¥æœ‰è€…</span></span><br><span class="line"><span class="keyword">if</span> asset.Amount == amount &#123;</span><br><span class="line">asset.Owner = newOwner</span><br><span class="line">err = s.PutState(ctx, asset)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> asset.Amount &gt; amount &#123; <span class="comment">// å¦‚æœå‡­è¯èµ„äº§çš„é‡‘é¢å¤§äºè½¬è´¦çš„é‡‘é¢ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„äº§</span></span><br><span class="line"><span class="comment">// åˆ›å»ºæ–°çš„èµ„äº§å¹¶ä¿å­˜</span></span><br><span class="line">newAsset, err := s.createAsset(ctx, asset.ID+<span class="string">&quot;1&quot;</span>, amount, asset.Issuer, newOwner)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">err = s.PutState(ctx, newAsset)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ›´æ–°æ—§èµ„äº§çš„é‡‘é¢</span></span><br><span class="line">asset.Amount = asset.Amount - amount</span><br><span class="line">err = s.PutState(ctx, asset)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> asset.Amount &lt; amount &#123; <span class="comment">// å¦‚æœèµ„äº§çš„é¢åº¦å°äºè¦è½¬è´¦çš„é‡‘é¢ï¼Œåˆ™ç›´æ¥æŠ¥é”™</span></span><br><span class="line">err = fmt.Errorf(<span class="string">&quot;è½¬è´¦é‡‘é¢=%d,ä¸èƒ½è¶…è¿‡èµ„äº§çš„é‡‘é¢=%d&quot;</span>, amount, asset.Amount)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PutState æ›´æ–°èµ„äº§</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">PutState</span><span class="params">(ctx contractapi.TransactionContextInterface, asset *Asset)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">assetJSON, err := json.Marshal(asset)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ctx.GetStub().PutState(asset.ID, assetJSON)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetAllAssets returns all assets found in world state</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">GetAllAssets</span><span class="params">(ctx contractapi.TransactionContextInterface)</span> <span class="params">([]*Asset, error)</span></span> &#123;</span><br><span class="line"><span class="comment">// range query with empty string for startKey and endKey does an</span></span><br><span class="line"><span class="comment">// open-ended query of all assets in the chaincode namespace.</span></span><br><span class="line">resultsIterator, err := ctx.GetStub().GetStateByRange(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> resultsIterator.Close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> assets []*Asset</span><br><span class="line"><span class="keyword">for</span> resultsIterator.HasNext() &#123;</span><br><span class="line">queryResponse, err := resultsIterator.Next()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> asset Asset</span><br><span class="line">err = json.Unmarshal(queryResponse.Value, &amp;asset)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line">assets = <span class="built_in">append</span>(assets, &amp;asset)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> assets, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ‰“åŒ…-v3">æ‰“åŒ…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode package supply.6.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/chaincode-go/ --lang golang --label supply_6.0</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…é“¾ç åŒ…-v3">å®‰è£…é“¾ç åŒ…</h3><p>ä¸€çº§ä¾›åº”å•†å’Œæ ¸å¿ƒä¼ä¸šéƒ½è¦å®‰è£…ï¼š<br>æ ¸å¿ƒä¼ä¸šï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode install supply.6.tar.gz --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>ä¸€çº§ä¾›åº”å•†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode install supply.6.tar.gz --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><h3 id="æ‰¹å‡†é“¾ç å®šä¹‰-v5">æ‰¹å‡†é“¾ç å®šä¹‰</h3><h4 id="æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode-v3">æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode queryinstalled</span><br></pre></td></tr></table></figure><p>å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ï¼Œä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦å®šä¹‰æ­¤å˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export CC_PACKAGE_ID=supply_6.0:18a7379ed3b12a57961a735880a71bea3dd242c741fa0970f779b5a338f848de</span><br></pre></td></tr></table></figure><h4 id="æ‰¹å‡†é“¾ç å®šä¹‰-v6">æ‰¹å‡†é“¾ç å®šä¹‰</h4><p>æ ¸å¿ƒä¼ä¸šå’Œä¸€çº§ä¾›åº”å•†éƒ½éœ€è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode approveformyorg -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name supply --version 6.0 --package-id $CC_PACKAGE_ID --sequence 6 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2020-12-28 17:58:55.313 CST [chaincodeCmd] ClientWait -&gt; INFO 001 txid [c4974d5c90ae4fb3bd31f179292d9943dd05aac47248f33e365d9f32ccb5ccb6] committed with status (VALID) at localhost:8051</span><br></pre></td></tr></table></figure><h3 id="å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“-v3">å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“</h3><p>æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode checkcommitreadiness --channelID coreandfirstchannel --name supply --version 6.0 --sequence 6 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;approvals&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;GylCoreOrg1MSP&quot;</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">&quot;GylFOrg1MSP&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸¤ä¸ªç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode commit -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name supply --version 6.0 --sequence 6 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-28 17:51:08.452 CST [chaincodeCmd] ClientWait -&gt; INFO 001 txid [87bc060e5ccdf4014cd4cf34bbbeb5d2ea10c4ff8ebb6f444d10580e2de2da50] committed with status (VALID) at localhost:8053</span><br><span class="line">2020-12-28 17:51:08.460 CST [chaincodeCmd] ClientWait -&gt; INFO 002 txid [87bc060e5ccdf4014cd4cf34bbbeb5d2ea10c4ff8ebb6f444d10580e2de2da50] committed with status (VALID) at localhost:8051</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-querycommitted">peer lifecycle chaincode querycommitted</a> å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode querycommitted --channelID coreandfirstchannel --name supply --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹,å¯ä»¥çœ‹åˆ°å·²ç»å‡çº§åˆ°2.0ç‰ˆæœ¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Committed chaincode definition for chaincode &#x27;supply&#x27; on channel &#x27;coreandfirstchannel&#x27;:</span><br><span class="line">Version: 2.0, Sequence: 2, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [GylCoreOrg1MSP: true, GylFOrg1MSP: true]</span><br></pre></td></tr></table></figure><h3 id="è°ƒç”¨é“¾ç -v3">è°ƒç”¨é“¾ç </h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C coreandfirstchannel -n supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;IssueVoucher&quot;,&quot;Args&quot;:[&quot;asset002&quot;, &quot;1000&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2020-12-29 10:59:48.513 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200</span><br></pre></td></tr></table></figure><p><strong>é”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: endorsement failure during invoke. response: status:500 message:&quot;the asset asset001 already exists&quot;</span><br></pre></td></tr></table></figure><p>**è§£å†³æ–¹æ¡ˆï¼š**åŸå› æ˜¯ä»¥å†…èµ„äº§IDä¸ºasset001çš„èµ„äº§å·²ç»å­˜åœ¨ï¼Œä¿®æ”¹èµ„äº§IDå‚æ•°å³å¯ã€‚</p><h4 id="æŸ¥è¯¢è°ƒç”¨åçš„ç»“æœ-v2">æŸ¥è¯¢è°ƒç”¨åçš„ç»“æœ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -C coreandfirstchannel -n supply -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset001&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;ä¸€çº§ä¾›åº”å•†&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-28T10:37:54.271518Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-28T10:37:54.271518Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;test&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset002&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">1000</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-29T02:59:48.495257Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-29T02:59:48.495257Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;test&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="è°ƒç”¨äº¤æ˜“æ–¹æ³•-v2">è°ƒç”¨äº¤æ˜“æ–¹æ³•</h3><p>æŠŠå‡­è¯èµ„äº§æ‹†åˆ†ä¸€éƒ¨åˆ†ï¼ˆ200ï¼‰ç»™ä¸€çº§ä¾›åº”å•†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C coreandfirstchannel -n supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAsset&quot;,&quot;Args&quot;:[&quot;asset002&quot;, &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;200&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>å†æ¬¡æŸ¥è¯¢ï¼š<code>peer chaincode query -C coreandfirstchannel -n supply -c '&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;'</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;ID&quot;: &quot;asset001&quot;,</span><br><span class="line">    &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;ä¸€çº§ä¾›åº”å•†&quot;,</span><br><span class="line">    &quot;amount&quot;: 100,</span><br><span class="line">    &quot;createDate&quot;: &quot;2020-12-28T10:37:54.271518Z&quot;,</span><br><span class="line">    &quot;endDate&quot;: &quot;2021-06-28T10:37:54.271518Z&quot;,</span><br><span class="line">    &quot;contractHash&quot;: &quot;test&quot;,</span><br><span class="line">    &quot;invoiceHash&quot;: &quot;test&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;ID&quot;: &quot;asset002&quot;,</span><br><span class="line">    &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;,</span><br><span class="line">    &quot;amount&quot;: 800,</span><br><span class="line">    &quot;createDate&quot;: &quot;2020-12-29T02:59:48.495257Z&quot;,</span><br><span class="line">    &quot;endDate&quot;: &quot;2021-06-29T02:59:48.495257Z&quot;,</span><br><span class="line">    &quot;contractHash&quot;: &quot;test&quot;,</span><br><span class="line">    &quot;invoiceHash&quot;: &quot;test&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;ID&quot;: &quot;asset0021&quot;,</span><br><span class="line">    &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;,</span><br><span class="line">    &quot;owner&quot;: &quot;ä¸€çº§ä¾›åº”å•†&quot;,</span><br><span class="line">    &quot;amount&quot;: 200,</span><br><span class="line">    &quot;createDate&quot;: &quot;2020-12-29T03:02:49.495789Z&quot;,</span><br><span class="line">    &quot;endDate&quot;: &quot;2021-06-29T03:02:49.495789Z&quot;,</span><br><span class="line">    &quot;contractHash&quot;: &quot;test&quot;,</span><br><span class="line">    &quot;invoiceHash&quot;: &quot;test&quot;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>äº¤æ˜“ä¹‹åï¼Œæ ¸å¿ƒä¼ä¸šå‰©ä½™800çš„å‡­è¯ï¼Œä¸€çº§ä¾›åº”å•†è·å¾—ä¸€ä¸ªæ–°çš„å‡­è¯ã€‚éªŒè¯æ— è¯¯ã€‚</p><h2 id="éƒ¨ç½²v7ç‰ˆæœ¬çš„supply">éƒ¨ç½²v7ç‰ˆæœ¬çš„supply</h2><h3 id="v7ç‰ˆæœ¬æ™ºèƒ½åˆçº¦æºç å¦‚ä¸‹ï¼š">v7ç‰ˆæœ¬æ™ºèƒ½åˆçº¦æºç å¦‚ä¸‹ï¼š</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chaincode</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;encoding/json&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;github.com/golang/protobuf/ptypes&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// SmartContract provides functions for managing an Asset</span></span><br><span class="line"><span class="keyword">type</span> SmartContract <span class="keyword">struct</span> &#123;</span><br><span class="line">contractapi.Contract</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Asset describes basic details of what makes up a simple asset</span></span><br><span class="line"><span class="keyword">type</span> Asset <span class="keyword">struct</span> &#123;</span><br><span class="line">ID           <span class="keyword">string</span>    <span class="string">`json:&quot;ID&quot;`</span></span><br><span class="line">Issuer       <span class="keyword">string</span>    <span class="string">`json:&quot;issuer&quot;`</span></span><br><span class="line">Owner        <span class="keyword">string</span>    <span class="string">`json:&quot;owner&quot;`</span></span><br><span class="line">Amount       <span class="keyword">int64</span>     <span class="string">`json:&quot;amount&quot;`</span></span><br><span class="line">CreateDate   time.Time <span class="string">`json:&quot;createDate&quot;`</span></span><br><span class="line">EndDate      time.Time <span class="string">`json:&quot;endDate&quot;`</span></span><br><span class="line">ContractHash <span class="keyword">string</span>    <span class="string">`json:&quot;contractHash&quot;`</span></span><br><span class="line">InvoiceHash  <span class="keyword">string</span>    <span class="string">`json:&quot;invoiceHash&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IssueVoucher å‘è¡Œå‡­è¯</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">IssueVoucher</span><span class="params">(ctx contractapi.TransactionContextInterface, assetID <span class="keyword">string</span>, amount <span class="keyword">int64</span>, owner <span class="keyword">string</span>, contractHash <span class="keyword">string</span>, invoiceHash <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="comment">// åˆ›å»ºèµ„äº§</span></span><br><span class="line"><span class="keyword">return</span> s.CreateAssetAndSave(ctx, assetID, amount, <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>, owner, contractHash, invoiceHash)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CreateAssetAndSave åˆ›å»ºèµ„äº§å¹¶ä¿å­˜</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">CreateAssetAndSave</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>, amount <span class="keyword">int64</span>, issuerName <span class="keyword">string</span>, owner <span class="keyword">string</span>, contractHash <span class="keyword">string</span>, invoiceHash <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">asset, err := s.createAsset(ctx, id, amount, issuerName, owner, contractHash, invoiceHash)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s.PutState(ctx, asset)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// createAsset issues a new asset to the world state with given details.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">createAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>, amount <span class="keyword">int64</span>, issuerName <span class="keyword">string</span>, owner <span class="keyword">string</span>, contractHash <span class="keyword">string</span>, invoiceHash <span class="keyword">string</span>)</span> <span class="params">(*Asset, error)</span></span> &#123;</span><br><span class="line">exists, err := s.AssetExists(ctx, id)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> exists &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;the asset %s already exists&quot;</span>, id)</span><br><span class="line">&#125;</span><br><span class="line">now, err := getNow(ctx)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line">asset := Asset&#123;ID: id, Issuer: issuerName, Amount: amount, Owner: owner, CreateDate: now,</span><br><span class="line">EndDate: now.AddDate(<span class="number">0</span>, <span class="number">6</span>, <span class="number">0</span>), ContractHash: contractHash, InvoiceHash: invoiceHash&#125;</span><br><span class="line"><span class="keyword">return</span> &amp;asset, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å½“å‰æ—¶é—´</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getNow</span><span class="params">(ctx contractapi.TransactionContextInterface)</span> <span class="params">(time.Time, error)</span></span> &#123;</span><br><span class="line">now, err := ctx.GetStub().GetTxTimestamp()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> time.Now(), err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ptypes.Timestamp(now)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReadAsset returns the asset stored in the world state with given id.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">ReadAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>)</span> <span class="params">(*Asset, error)</span></span> &#123;</span><br><span class="line">assetJSON, err := ctx.GetStub().GetState(id)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;failed to read from world state: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> assetJSON == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;the asset %s does not exist&quot;</span>, id)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> asset Asset</span><br><span class="line">err = json.Unmarshal(assetJSON, &amp;asset)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> &amp;asset, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AssetExists returns true when asset with given ID exists in world state</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">AssetExists</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">bool</span>, error)</span></span> &#123;</span><br><span class="line">assetJSON, err := ctx.GetStub().GetState(id)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, fmt.Errorf(<span class="string">&quot;failed to read from world state: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> assetJSON != <span class="literal">nil</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TransferAssetByID æ ¹æ®èµ„äº§IDè½¬è´¦</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">TransferAssetByID</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>, newOwner <span class="keyword">string</span>, amount <span class="keyword">int64</span>, contractHash <span class="keyword">string</span>, invoiceHash <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">asset, err := s.ReadAsset(ctx, id)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s.TransferAsset(ctx, asset, newOwner, amount, contractHash, invoiceHash)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TransferAsset updates the owner field of asset with given id in world state.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">TransferAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, asset *Asset, newOwner <span class="keyword">string</span>, amount <span class="keyword">int64</span>, contractHash <span class="keyword">string</span>, invoiceHash <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="comment">// å¦‚æœé‡‘é¢åˆšå¥½ç­‰äºå‡­è¯èµ„äº§çš„é‡‘é¢ï¼Œç›´æ¥æ›´æ–°å‡­è¯èµ„äº§çš„æ‹¥æœ‰è€…</span></span><br><span class="line"><span class="keyword">if</span> asset.Amount == amount &#123;</span><br><span class="line">asset.Owner = newOwner</span><br><span class="line"><span class="keyword">return</span> s.PutState(ctx, asset)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> asset.Amount &gt; amount &#123; <span class="comment">// å¦‚æœå‡­è¯èµ„äº§çš„é‡‘é¢å¤§äºè½¬è´¦çš„é‡‘é¢ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„äº§</span></span><br><span class="line"><span class="comment">// åˆ›å»ºæ–°çš„èµ„äº§å¹¶ä¿å­˜</span></span><br><span class="line">err := s.CreateAssetAndSave(ctx, asset.ID+<span class="string">&quot;1&quot;</span>, amount, asset.Issuer, newOwner, contractHash, invoiceHash)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ›´æ–°æ—§èµ„äº§çš„é‡‘é¢</span></span><br><span class="line">asset.Amount = asset.Amount - amount</span><br><span class="line"><span class="keyword">return</span> s.PutState(ctx, asset)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> asset.Amount &lt; amount &#123; <span class="comment">// å¦‚æœèµ„äº§çš„é¢åº¦å°äºè¦è½¬è´¦çš„é‡‘é¢ï¼Œåˆ™ç›´æ¥æŠ¥é”™</span></span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;è½¬è´¦é‡‘é¢=%d,ä¸èƒ½è¶…è¿‡èµ„äº§çš„é‡‘é¢=%d&quot;</span>, amount, asset.Amount)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PutState æ›´æ–°èµ„äº§</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">PutState</span><span class="params">(ctx contractapi.TransactionContextInterface, asset *Asset)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">assetJSON, err := json.Marshal(asset)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ctx.GetStub().PutState(asset.ID, assetJSON)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetAllAssets returns all assets found in world state</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">GetAllAssets</span><span class="params">(ctx contractapi.TransactionContextInterface)</span> <span class="params">([]*Asset, error)</span></span> &#123;</span><br><span class="line"><span class="comment">// range query with empty string for startKey and endKey does an</span></span><br><span class="line"><span class="comment">// open-ended query of all assets in the chaincode namespace.</span></span><br><span class="line">resultsIterator, err := ctx.GetStub().GetStateByRange(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> resultsIterator.Close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> assets []*Asset</span><br><span class="line"><span class="keyword">for</span> resultsIterator.HasNext() &#123;</span><br><span class="line">queryResponse, err := resultsIterator.Next()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> asset Asset</span><br><span class="line">err = json.Unmarshal(queryResponse.Value, &amp;asset)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line">assets = <span class="built_in">append</span>(assets, &amp;asset)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> assets, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ‰“åŒ…-v4">æ‰“åŒ…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode package supply.7.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/chaincode-go/ --lang golang --label supply_7.0</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…é“¾ç åŒ…-v4">å®‰è£…é“¾ç åŒ…</h3><p>ä¸€çº§ä¾›åº”å•†å’Œæ ¸å¿ƒä¼ä¸šéƒ½è¦å®‰è£…ï¼š<br>æ ¸å¿ƒä¼ä¸šï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode install supply.7.tar.gz --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>ä¸€çº§ä¾›åº”å•†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode install supply.7.tar.gz --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><h3 id="æ‰¹å‡†é“¾ç å®šä¹‰-v7">æ‰¹å‡†é“¾ç å®šä¹‰</h3><h4 id="æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode-v4">æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode queryinstalled</span><br></pre></td></tr></table></figure><p>å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ï¼Œä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦å®šä¹‰æ­¤å˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export CC_PACKAGE_ID=supply_7.0:770f0c8f4fe3a348314f546594d402ccb3eb5f5779f12e7edee48f6ce474227b</span><br></pre></td></tr></table></figure><h4 id="æ‰¹å‡†é“¾ç å®šä¹‰-v8">æ‰¹å‡†é“¾ç å®šä¹‰</h4><p>æ ¸å¿ƒä¼ä¸šå’Œä¸€çº§ä¾›åº”å•†éƒ½éœ€è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode approveformyorg -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name supply --version 7.0 --package-id $CC_PACKAGE_ID --sequence 7 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><h3 id="å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“-v4">å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“</h3><p>æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode checkcommitreadiness --channelID coreandfirstchannel --name supply --version 7.0 --sequence 7 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json</span><br></pre></td></tr></table></figure><p>åœ¨ä¸¤ä¸ªç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode commit -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name supply --version 7.0 --sequence 7 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-querycommitted">peer lifecycle chaincode querycommitted</a> å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode querycommitted --channelID coreandfirstchannel --name supply --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><h3 id="è°ƒç”¨é“¾ç -v4">è°ƒç”¨é“¾ç </h3><p>è°ƒç”¨é“¾ç ä¹‹å‰å…ˆç”Ÿæˆæµ‹è¯•çš„åˆåŒhashå€¼å’Œå‘ç¥¨hashå€¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shasum -a 256 CORE_AND_F1_CONTRACT.txt &gt; core_and_f1_contract_hash.txt</span><br><span class="line">shasum -a 256 CORE_AND_F1_INVOICE.txt &gt; CORE_AND_F1_INVOICE_hash.txt</span><br></pre></td></tr></table></figure><h4 id="å‘è¡Œå‡­è¯">å‘è¡Œå‡­è¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C coreandfirstchannel -n supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;IssueVoucher&quot;,&quot;Args&quot;:[&quot;asset003&quot;, &quot;1000&quot;, &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;, &quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><h4 id="æŸ¥è¯¢è°ƒç”¨åçš„ç»“æœ-v3">æŸ¥è¯¢è°ƒç”¨åçš„ç»“æœ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -C coreandfirstchannel -n supply -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset001&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;ä¸€çº§ä¾›åº”å•†&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">100</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-28T10:37:54.271518Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-28T10:37:54.271518Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;test&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset002&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-29T02:59:48.495257Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-29T02:59:48.495257Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;test&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset0021&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;ä¸€çº§ä¾›åº”å•†&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-29T03:02:49.495789Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-29T03:02:49.495789Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;test&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset003&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;ä¸€çº§ä¾›åº”å•†&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">1000</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-29T06:20:30.868298Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-29T06:20:30.868298Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>IDä¸ºasset003çš„èµ„äº§å½’å±ä¸ºä¸€çº§ä¾›åº”å•†ï¼Œé‡‘é¢æ— è¯¯ã€‚</p><h2 id="åˆ›å»ºä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†ä¹‹é—´çš„channel">åˆ›å»ºä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†ä¹‹é—´çš„channel</h2><h3 id="åˆ›å»ºé€šé“ï¼š">åˆ›å»ºé€šé“ï¼š</h3><p>è¿è¡Œä¸‹é¢çš„ç¨‹åºæ¥ä¸º<code>firstandsecondchannel</code>é€šé“åˆ›å»ºä¸€ä¸ªâ€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configtxgen -profile FirstAndSecondChannel -outputCreateChannelTx ./channel-artifacts/firstandsecondchannel.tx -channelID firstandsecondchannel</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2020-12-29 14:27:37.416 CST [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2020-12-29 14:27:37.430 CST [common.tools.configtxgen.localconfig] Load -&gt; INFO 002 Loaded configuration: /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/config/configtx.yaml</span><br><span class="line">2020-12-29 14:27:37.430 CST [common.tools.configtxgen] doOutputChannelCreateTx -&gt; INFO 003 Generating new channel configtx</span><br><span class="line">2020-12-29 14:27:37.436 CST [common.tools.configtxgen] doOutputChannelCreateTx -&gt; INFO 004 Writing new channel tx</span><br></pre></td></tr></table></figure><p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä»¥ä¸€çº§ä¾›åº”å•†ç®¡ç†å‘˜èº«ä»½æ“ä½œ<code>peer</code>CLIï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŠŠäº¤æ˜“å‘ç»™orderæœåŠ¡åˆ›å»ºé€šé“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel create -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com -c firstandsecondchannel -f ./channel-artifacts/firstandsecondchannel.tx --outputBlock ./channel-artifacts/firstandsecondchannel.block --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p><strong>é”™è¯¯ä¿¡æ¯è®°å½•ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: got unexpected status: BAD_REQUEST -- error validating channel creation transaction for new channel &#x27;firstandsecondchannel&#x27;, could not successfully apply update to template configuration: error authorizing update: error validating DeltaSet: policy for [Group]  /Channel/Application not satisfied: implicit policy evaluation failed - 0 sub-policies were satisfied, but this policy requires 1 of the &#x27;Admins&#x27; sub-policies to be satisfied</span><br></pre></td></tr></table></figure><p><strong>é”™è¯¯åŸå› å’Œè§£å†³æ–¹æ¡ˆï¼š</strong></p><p>ç”±äºé…ç½®æ–‡ä»¶é‡Œé¢é…ç½®çš„firstandsecondchannelé‡Œé¢åŒ…å«ä¸€çº§ä¾›åº”å•†å’Œä¸¤ä¸ªäºŒçº§ä¾›åº”å•†ï¼Œè€Œä¸Šé¢çš„å‘½ä»¤æ˜¯ä»¥æ ¸å¿ƒä¼ä¸šçš„ç®¡ç†å‘˜èº«ä»½è¿è¡Œçš„ã€‚æ‰€ä»¥æœ‰é—®é¢˜ã€‚åˆ‡æ¢æˆä¸€çº§ä¾›åº”å•†çš„ç¯å¢ƒæ‰§è¡Œå³å¯ã€‚</p><p>æ­£ç¡®æ‰§è¡Œä¹‹åçš„æ—¥å¿—ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">2020-12-29 14:34:06.203 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2020-12-29 14:34:06.231 CST [cli.common] readBlock -&gt; INFO 002 Expect block, but got status: &amp;&#123;NOT_FOUND&#125;</span><br><span class="line">2020-12-29 14:34:06.244 CST [channelCmd] InitCmdFactory -&gt; INFO 003 Endorser and orderer connections initialized</span><br><span class="line">2020-12-29 14:34:06.450 CST [cli.common] readBlock -&gt; INFO 004 Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;</span><br><span class="line">2020-12-29 14:34:06.458 CST [channelCmd] InitCmdFactory -&gt; INFO 005 Endorser and orderer connections initialized</span><br><span class="line">2020-12-29 14:34:06.667 CST [cli.common] readBlock -&gt; INFO 006 Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;</span><br><span class="line">2020-12-29 14:34:06.676 CST [channelCmd] InitCmdFactory -&gt; INFO 007 Endorser and orderer connections initialized</span><br><span class="line">2020-12-29 14:34:06.885 CST [cli.common] readBlock -&gt; INFO 008 Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;</span><br><span class="line">2020-12-29 14:34:06.892 CST [channelCmd] InitCmdFactory -&gt; INFO 009 Endorser and orderer connections initialized</span><br><span class="line">2020-12-29 14:34:07.099 CST [cli.common] readBlock -&gt; INFO 00a Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;</span><br><span class="line">2020-12-29 14:34:07.108 CST [channelCmd] InitCmdFactory -&gt; INFO 00b Endorser and orderer connections initialized</span><br><span class="line">2020-12-29 14:34:07.320 CST [cli.common] readBlock -&gt; INFO 00c Received block: 0</span><br></pre></td></tr></table></figure><h2 id="æŠŠä¸€çº§ä¾›åº”å•†å’ŒäºŒçº§ä¾›åº”å•†çš„peeråŠ å…¥é€šé“">æŠŠä¸€çº§ä¾›åº”å•†å’ŒäºŒçº§ä¾›åº”å•†çš„peeråŠ å…¥é€šé“</h2><h3 id="ä¸€çº§ä¾›åº”å•†çš„peeråŠ å…¥é€šé“">ä¸€çº§ä¾›åº”å•†çš„peeråŠ å…¥é€šé“</h3><p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°†peeråŠ å…¥é€šé“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel join -b ./channel-artifacts/firstandsecondchannel.block</span><br></pre></td></tr></table></figure><p>æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-29 14:35:00.679 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2020-12-29 14:35:00.724 CST [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel</span><br></pre></td></tr></table></figure><h3 id="é€šè¿‡è·å–é€šé“ä¿¡æ¯ç¡®è®¤åŠ å…¥æˆåŠŸ">é€šè¿‡è·å–é€šé“ä¿¡æ¯ç¡®è®¤åŠ å…¥æˆåŠŸ</h3><h4 id="è·å–é€šé“ä¿¡æ¯">è·å–é€šé“ä¿¡æ¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel getinfo -c firstandsecondchannel</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-29 14:35:28.593 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">Blockchain info: &#123;&quot;height&quot;:1,&quot;currentBlockHash&quot;:&quot;270CWtnSyXJmeGCxJx41sX7uTchRZpljYWKJ48dD434=&quot;&#125;</span><br></pre></td></tr></table></figure><h3 id="äºŒçº§ä¾›åº”å•†1åŠ å…¥é€šé“">äºŒçº§ä¾›åº”å•†1åŠ å…¥é€šé“</h3><p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œç„¶åæ‹‰å–é€šé“çš„åˆ›ä¸–çºªåŒºå—(å› ä¸ºæ˜¯æµ‹è¯•æœ¬æ¬¡å¿½ç•¥)ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch 0 ./channel-artifacts/coreandfirstchannel.block -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com -c coreandfirstchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p>åŠ å…¥é€šé“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel join -b ./channel-artifacts/firstandsecondchannel.block</span><br></pre></td></tr></table></figure><p>æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-29 14:47:03.684 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2020-12-29 14:47:03.722 CST [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel</span><br></pre></td></tr></table></figure><p><strong>æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">supply-finance apple$ peer channel join -b ./channel-artifacts/coreandfirstchannel.block</span><br><span class="line">2020-12-29 14:43:56.186 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">Error: proposal failed (err: rpc error: code = Unknown desc = error validating proposal: access denied: channel [] creator org [GylSOrg1M])</span><br></pre></td></tr></table></figure><p>**é”™è¯¯åŸå› ï¼š**ç”±äºç¯å¢ƒå˜é‡è®¾ç½®çš„æœ‰é—®é¢˜ï¼Œ<code>CORE_PEER_LOCALMSPID</code>è®¾ç½®æˆäº†<code>GylSOrg1M</code>ï¼Œåº”è¯¥è®¾ç½®ä¸º<code>GylSOrg1MSP</code></p><h3 id="äºŒçº§ä¾›åº”å•†2åŠ å…¥é€šé“">äºŒçº§ä¾›åº”å•†2åŠ å…¥é€šé“</h3><p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œç„¶åæ‹‰å–é€šé“çš„åˆ›ä¸–çºªåŒºå—(å› ä¸ºæ˜¯æµ‹è¯•æœ¬æ¬¡å¿½ç•¥)ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch 0 ./channel-artifacts/coreandfirstchannel.block -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com -c coreandfirstchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p>åŠ å…¥é€šé“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel join -b ./channel-artifacts/firstandsecondchannel.block</span><br></pre></td></tr></table></figure><p>æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-29 14:52:12.969 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2020-12-29 14:52:13.010 CST [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®é”šèŠ‚ç‚¹">è®¾ç½®é”šèŠ‚ç‚¹</h3><h4 id="ä¸ºGylFOrg1MSPè®¾ç½®é”šèŠ‚ç‚¹">ä¸ºGylFOrg1MSPè®¾ç½®é”šèŠ‚ç‚¹</h4><h5 id="æ‹‰å–æœ€æ–°çš„channelé…ç½®åŒºå—">æ‹‰å–æœ€æ–°çš„channelé…ç½®åŒºå—</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch config channel-artifacts/firstandsecondchannel_config_block.pb -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c firstandsecondchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p>æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2020-12-29 14:55:57.114 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2020-12-29 14:55:57.120 CST [cli.common] readBlock -&gt; INFO 002 Received block: 0</span><br><span class="line">2020-12-29 14:55:57.120 CST [channelCmd] fetch -&gt; INFO 003 Retrieving last config block: 0</span><br><span class="line">2020-12-29 14:55:57.125 CST [cli.common] readBlock -&gt; INFO 004 Received block: 0</span><br></pre></td></tr></table></figure><h5 id="ä¿®æ”¹é€šé“é…ç½®åŒºå—">ä¿®æ”¹é€šé“é…ç½®åŒºå—</h5><p>åˆ‡æ¢åˆ°<code>channel-artifacts</code>ç„¶åæŠŠåŒºå—å†…å®¹è½¬æ¢æˆjsonæ ¼å¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd channel-artifacts</span><br><span class="line">configtxlator proto_decode --input firstandsecondchannel_config_block.pb --type common.Block --output firstandsecondchannel_config_block.json</span><br><span class="line">jq .data.data[0].payload.data.config firstandsecondchannel_config_block.json &gt; firstandsecondchannel_config.json</span><br><span class="line"><span class="meta">#</span><span class="bash"> copyä¸€ä»½</span></span><br><span class="line">cp firstandsecondchannel_config.json firstandsecondchannel_config_copy.json</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>jq</code> å·¥å…·æ¥æ·»åŠ GylFOrg1MSPç»„ç»‡çš„é”šèŠ‚ç‚¹åˆ°é€šé“é…ç½®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jq &#x27;.channel_group.groups.Application.groups.GylFOrg1MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.f1.supply.com&quot;,&quot;port&quot;: 8053&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; firstandsecondchannel_config_copy.json &gt; modified_firstandsecondchannel_config.json</span><br></pre></td></tr></table></figure><p>å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_encode --input firstandsecondchannel_config.json --type common.Config --output firstandsecondchannel_config.pb</span><br><span class="line">configtxlator proto_encode --input modified_firstandsecondchannel_config.json --type common.Config --output modified_firstandsecondchannel_config.pb</span><br><span class="line">configtxlator compute_update --channel_id firstandsecondchannel --original firstandsecondchannel_config.pb --updated modified_firstandsecondchannel_config.pb --output firstandsecondchannel_config_update.pb</span><br></pre></td></tr></table></figure><h5 id="æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼š">æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_decode --input firstandsecondchannel_config_update.pb --type common.ConfigUpdate --output firstandsecondchannel_config_update.json</span><br><span class="line">echo &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;firstandsecondchannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat firstandsecondchannel_config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; firstandsecondchannel_config_update_in_envelope.json</span><br><span class="line">configtxlator proto_encode --input firstandsecondchannel_config_update_in_envelope.json --type common.Envelope --output firstandsecondchannel_config_update_in_envelope.pb</span><br></pre></td></tr></table></figure><h5 id="æäº¤â€œæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“â€">æäº¤â€œæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“â€</h5><p>è¿›åˆ°ä¸Šä¸€çº§ç›®å½•<code>cd ..</code>ï¼Œä¹‹åè¿è¡Œå‘½ä»¤å°†äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡è¿›è¡Œé€šé“é…ç½®çš„æ›´æ–°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ..</span><br><span class="line">peer channel update -f channel-artifacts/firstandsecondchannel_config_update_in_envelope.pb -c firstandsecondchannel -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p>æ‰§è¡ŒæˆåŠŸçš„ç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-29 14:57:48.872 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2020-12-29 14:57:48.894 CST [channelCmd] update -&gt; INFO 002 Successfully submitted channel update</span><br></pre></td></tr></table></figure><h5 id="éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯-peer-channel-getinfo-c-firstandsecondchannel">éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯:<code>peer channel getinfo -c firstandsecondchannel</code></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-29 14:58:15.937 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">Blockchain info: &#123;&quot;height&quot;:2,&quot;currentBlockHash&quot;:&quot;4lhXvhRKDNxBsOIGL0H0A5QDdNkySgv/ehtUkobtW9Y=&quot;,&quot;previousBlockHash&quot;:&quot;270CWtnSyXJmeGCxJx41sX7uTchRZpljYWKJ48dD434=&quot;&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸ºäºŒçº§ä¾›åº”å•†1ï¼ˆGylSOrg1MSPï¼‰è®¾ç½®é”šèŠ‚ç‚¹">ä¸ºäºŒçº§ä¾›åº”å•†1ï¼ˆGylSOrg1MSPï¼‰è®¾ç½®é”šèŠ‚ç‚¹</h4><p>ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œæ‹‰å–æœ€æ–°çš„channelé…ç½®åŒºå—</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch config channel-artifacts/firstandsecondchannel_config_block.pb -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c firstandsecondchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><h5 id="ä¿®æ”¹é€šé“é…ç½®åŒºå—-v2">ä¿®æ”¹é€šé“é…ç½®åŒºå—</h5><p>åˆ‡æ¢åˆ°<code>channel-artifacts</code>ç„¶åæŠŠåŒºå—å†…å®¹è½¬æ¢æˆjsonæ ¼å¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd channel-artifacts</span><br><span class="line">configtxlator proto_decode --input firstandsecondchannel_config_block.pb --type common.Block --output firstandsecondchannel_config_block.json</span><br><span class="line">jq .data.data[0].payload.data.config firstandsecondchannel_config_block.json &gt; firstandsecondchannel_config.json</span><br><span class="line"><span class="meta">#</span><span class="bash"> copyä¸€ä»½</span></span><br><span class="line">cp firstandsecondchannel_config.json firstandsecondchannel_config_copy.json</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>jq</code> å·¥å…·æ¥æ·»åŠ GylCoreOrg1MSPç»„ç»‡çš„é”šèŠ‚ç‚¹åˆ°é€šé“é…ç½®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jq &#x27;.channel_group.groups.Application.groups.GylSOrg1MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.s1.supply.com&quot;,&quot;port&quot;: 8055&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; firstandsecondchannel_config_copy.json &gt; modified_firstandsecondchannel_config.json</span><br></pre></td></tr></table></figure><p>å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_encode --input firstandsecondchannel_config.json --type common.Config --output firstandsecondchannel_config.pb</span><br><span class="line">configtxlator proto_encode --input modified_firstandsecondchannel_config.json --type common.Config --output modified_firstandsecondchannel_config.pb</span><br><span class="line">configtxlator compute_update --channel_id firstandsecondchannel --original firstandsecondchannel_config.pb --updated modified_firstandsecondchannel_config.pb --output firstandsecondchannel_config_update.pb</span><br></pre></td></tr></table></figure><h5 id="æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼š-v2">æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_decode --input firstandsecondchannel_config_update.pb --type common.ConfigUpdate --output firstandsecondchannel_config_update.json</span><br><span class="line">echo &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;firstandsecondchannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat firstandsecondchannel_config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; firstandsecondchannel_config_update_in_envelope.json</span><br><span class="line">configtxlator proto_encode --input firstandsecondchannel_config_update_in_envelope.json --type common.Envelope --output firstandsecondchannel_config_update_in_envelope.pb</span><br></pre></td></tr></table></figure><h5 id="æäº¤â€œæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“â€-v2">æäº¤â€œæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“â€</h5><p>è¿›åˆ°ä¸Šä¸€çº§ç›®å½•<code>cd ..</code>ï¼Œä¹‹åè¿è¡Œå‘½ä»¤å°†äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡è¿›è¡Œé€šé“é…ç½®çš„æ›´æ–°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ..</span><br><span class="line">peer channel update -f channel-artifacts/firstandsecondchannel_config_update_in_envelope.pb -c firstandsecondchannel -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p>æ‰§è¡ŒæˆåŠŸçš„ç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-29 15:01:14.643 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2020-12-29 15:01:14.670 CST [channelCmd] update -&gt; INFO 002 Successfully submitted channel update</span><br></pre></td></tr></table></figure><h5 id="éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯">éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(base) w:supply-finance apple$ peer channel getinfo -c firstandsecondchannel</span><br><span class="line">2020-12-29 15:01:26.952 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">Blockchain info: &#123;&quot;height&quot;:3,&quot;currentBlockHash&quot;:&quot;DPXkm090OpH9ww862WmR4EktxT0NHEM2i3Py0yHAGPE=&quot;,&quot;previousBlockHash&quot;:&quot;4lhXvhRKDNxBsOIGL0H0A5QDdNkySgv/ehtUkobtW9Y=&quot;&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸ºäºŒçº§ä¾›åº”å•†2ï¼ˆGylSOrg2MSPï¼‰è®¾ç½®é”šèŠ‚ç‚¹">ä¸ºäºŒçº§ä¾›åº”å•†2ï¼ˆGylSOrg2MSPï¼‰è®¾ç½®é”šèŠ‚ç‚¹</h4><p>ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œæ‹‰å–æœ€æ–°çš„channelé…ç½®åŒºå—</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch config channel-artifacts/firstandsecondchannel_config_block.pb -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c firstandsecondchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><h5 id="ä¿®æ”¹é€šé“é…ç½®åŒºå—-v3">ä¿®æ”¹é€šé“é…ç½®åŒºå—</h5><p>åˆ‡æ¢åˆ°<code>channel-artifacts</code>ç„¶åæŠŠåŒºå—å†…å®¹è½¬æ¢æˆjsonæ ¼å¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd channel-artifacts</span><br><span class="line">configtxlator proto_decode --input firstandsecondchannel_config_block.pb --type common.Block --output firstandsecondchannel_config_block.json</span><br><span class="line">jq .data.data[0].payload.data.config firstandsecondchannel_config_block.json &gt; firstandsecondchannel_config.json</span><br><span class="line"><span class="meta">#</span><span class="bash"> copyä¸€ä»½</span></span><br><span class="line">cp firstandsecondchannel_config.json firstandsecondchannel_config_copy.json</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>jq</code> å·¥å…·æ¥æ·»åŠ GylCoreOrg1MSPç»„ç»‡çš„é”šèŠ‚ç‚¹åˆ°é€šé“é…ç½®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jq &#x27;.channel_group.groups.Application.groups.GylSOrg2MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.s2.supply.com&quot;,&quot;port&quot;: 8151&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; firstandsecondchannel_config_copy.json &gt; modified_firstandsecondchannel_config.json</span><br></pre></td></tr></table></figure><p>å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_encode --input firstandsecondchannel_config.json --type common.Config --output firstandsecondchannel_config.pb</span><br><span class="line">configtxlator proto_encode --input modified_firstandsecondchannel_config.json --type common.Config --output modified_firstandsecondchannel_config.pb</span><br><span class="line">configtxlator compute_update --channel_id firstandsecondchannel --original firstandsecondchannel_config.pb --updated modified_firstandsecondchannel_config.pb --output firstandsecondchannel_config_update.pb</span><br></pre></td></tr></table></figure><h5 id="æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼š-v3">æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_decode --input firstandsecondchannel_config_update.pb --type common.ConfigUpdate --output firstandsecondchannel_config_update.json</span><br><span class="line">echo &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;firstandsecondchannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat firstandsecondchannel_config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; firstandsecondchannel_config_update_in_envelope.json</span><br><span class="line">configtxlator proto_encode --input firstandsecondchannel_config_update_in_envelope.json --type common.Envelope --output firstandsecondchannel_config_update_in_envelope.pb</span><br></pre></td></tr></table></figure><h5 id="æäº¤â€œæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“â€-v3">æäº¤â€œæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“â€</h5><p>è¿›åˆ°ä¸Šä¸€çº§ç›®å½•<code>cd ..</code>ï¼Œä¹‹åè¿è¡Œå‘½ä»¤å°†äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡è¿›è¡Œé€šé“é…ç½®çš„æ›´æ–°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ..</span><br><span class="line">peer channel update -f channel-artifacts/firstandsecondchannel_config_update_in_envelope.pb -c firstandsecondchannel -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p>æ‰§è¡ŒæˆåŠŸçš„ç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-29 15:03:39.793 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2020-12-29 15:03:39.817 CST [channelCmd] update -&gt; INFO 002 Successfully submitted channel update</span><br></pre></td></tr></table></figure><h5 id="éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯-v2">éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(base) w:supply-finance apple$ peer channel getinfo -c firstandsecondchannel</span><br><span class="line">2020-12-29 15:04:10.414 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">Blockchain info: &#123;&quot;height&quot;:4,&quot;currentBlockHash&quot;:&quot;PWXXje7tci4mk1ggQ9QMVzkvkP3i+N8WslOGDXreIQ0=&quot;,&quot;previousBlockHash&quot;:&quot;DPXkm090OpH9ww862WmR4EktxT0NHEM2i3Py0yHAGPE=&quot;&#125;</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²supply-v7åˆ°äºŒçº§ä¾›åº”å•†çš„peerèŠ‚ç‚¹">éƒ¨ç½²supply-v7åˆ°äºŒçº§ä¾›åº”å•†çš„peerèŠ‚ç‚¹</h2><h3 id="æ‰“åŒ…-v5">æ‰“åŒ…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode package supply.7.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/chaincode-go/ --lang golang --label supply_7.0</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…é“¾ç åŒ…-v5">å®‰è£…é“¾ç åŒ…</h3><p>ä¸¤ä¸ªäºŒçº§ä¾›åº”å•†éƒ½è¦å®‰è£…ï¼š<br>äºŒçº§ä¾›åº”å•†1ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode install supply.7.tar.gz --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>äºŒçº§ä¾›åº”å•†2ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode install supply.7.tar.gz --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><h3 id="æ‰¹å‡†é“¾ç å®šä¹‰-v9">æ‰¹å‡†é“¾ç å®šä¹‰</h3><h4 id="æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode-v5">æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode queryinstalled</span><br></pre></td></tr></table></figure><p>å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ï¼Œä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦å®šä¹‰æ­¤å˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export CC_PACKAGE_ID=supply_7.0:770f0c8f4fe3a348314f546594d402ccb3eb5f5779f12e7edee48f6ce474227b</span><br></pre></td></tr></table></figure><h4 id="æ‰¹å‡†é“¾ç å®šä¹‰-v10">æ‰¹å‡†é“¾ç å®šä¹‰</h4><p>ä¸€çº§ä¾›åº”å•†å’Œä¸¤ä¸ªäºŒçº§ä¾›åº”å•†éƒ½éœ€è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode approveformyorg -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID firstandsecondchannel --name supply --version 7.0 --package-id $CC_PACKAGE_ID --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><h3 id="å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“-v5">å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“</h3><p>æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode checkcommitreadiness --channelID firstandsecondchannel --name supply --version 7.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json</span><br></pre></td></tr></table></figure><p>åœ¨æ‰€æœ‰ç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode commit -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID firstandsecondchannel --name supply --version 7.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-querycommitted">peer lifecycle chaincode querycommitted</a> å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode querycommitted --channelID firstandsecondchannel --name supply --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p><strong>é”™è¯¯ä¿¡æ¯è®°å½•ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(base) w:supply-finance apple$ peer lifecycle chaincode commit -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID firstandsecondchannel --name supply --version 7.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt</span><br><span class="line">Error: proposal failed with status: 500 - channel &#x27;firstandsecondchannel&#x27; not found</span><br></pre></td></tr></table></figure><p>**é”™è¯¯åŸå› ï¼š**ç”±äºæ‰¹å‡†çš„ç»„ç»‡ä¸­åŒ…å«æ ¸å¿ƒä¼ä¸šï¼Œæ ¸å¿ƒä¼ä¸šå¹¶æ²¡æœ‰åŠ å…¥<code>firstandsecondchannel</code>é€šé“ï¼Œæ‰€ä»¥æŠ¥é”™ã€‚</p><h3 id="è°ƒç”¨é“¾ç -v5">è°ƒç”¨é“¾ç </h3><p>è°ƒç”¨é“¾ç ä¹‹å‰å…ˆç”Ÿæˆæµ‹è¯•çš„åˆåŒhashå€¼å’Œå‘ç¥¨hashå€¼å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a  f1_and_s1_contract.txt</span><br><span class="line">792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49  f1_and_s1_invoice.txt</span><br><span class="line">f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb  f1_and_s2_contract.txt</span><br><span class="line">f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468  f1_and_s2_invoice.txt</span><br></pre></td></tr></table></figure><p>è°ƒç”¨è½¬è´¦äº¤æ˜“ï¼šTODO é—®é¢˜æ¥äº†ï¼Œä¸¤ä¸ªchannelä¹‹é—´å¦‚ä½•äº¤æ¢èµ„äº§ï¼Ÿè¿™æ˜¯ä¸ªé—®é¢˜</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -C firstandsecondchannel -n supply --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;IssueVoucher&quot;,&quot;Args&quot;:[&quot;asset003&quot;, &quot;1000&quot;, &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;, &quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -C firstandsecondchannel -n supply -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><h2 id="æ ¸å¿ƒä¼ä¸šã€ä¸€çº§å’ŒäºŒçº§ä¾›åº”å•†åŠ å…¥åŒä¸€ä¸ªchannel">æ ¸å¿ƒä¼ä¸šã€ä¸€çº§å’ŒäºŒçº§ä¾›åº”å•†åŠ å…¥åŒä¸€ä¸ªchannel</h2><p>æŸ¥çœ‹<a href="https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E5%88%9B%E5%BB%BAchannel/">åˆ›å»ºchannel</a></p><h2 id="éƒ¨ç½²supply-v7åˆ°alljoinchannelé€šé“">éƒ¨ç½²supply-v7åˆ°alljoinchannelé€šé“</h2><h3 id="æ‰“åŒ…-v6">æ‰“åŒ…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> peer lifecycle chaincode package supply.7.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/chaincode-go/ --lang golang --label supply_7.0</span></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…é“¾ç åŒ…-v6">å®‰è£…é“¾ç åŒ…</h3><p>æ¯ä¸ªpeeréƒ½è¦å®‰è£…ï¼š<code>peer lifecycle chaincode install supply.7.tar.gz</code></p><h3 id="æ‰¹å‡†é“¾ç å®šä¹‰-v11">æ‰¹å‡†é“¾ç å®šä¹‰</h3><h4 id="æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode-v6">æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode queryinstalled</span><br></pre></td></tr></table></figure><p>å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ï¼Œä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦å®šä¹‰æ­¤å˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export CC_PACKAGE_ID=supply_7.0:770f0c8f4fe3a348314f546594d402ccb3eb5f5779f12e7edee48f6ce474227b</span><br></pre></td></tr></table></figure><h4 id="æ‰¹å‡†é“¾ç å®šä¹‰-v12">æ‰¹å‡†é“¾ç å®šä¹‰</h4><p>æ¯ä¸ªpeeréƒ½è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode approveformyorg -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name supply --version 7.0 --package-id $CC_PACKAGE_ID --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><h3 id="å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“-v6">å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“</h3><p>æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode checkcommitreadiness --channelID alljoinchannel --name supply --version 7.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json</span><br></pre></td></tr></table></figure><p>åœ¨æ‰€æœ‰ç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode commit -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name supply --version 7.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-querycommitted">peer lifecycle chaincode querycommitted</a> å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode querycommitted --channelID alljoinchannel --name supply --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><h3 id="è°ƒç”¨é“¾ç -v6">è°ƒç”¨é“¾ç </h3><p>è°ƒç”¨é“¾ç ä¹‹å‰å…ˆç”Ÿæˆæµ‹è¯•çš„åˆåŒhashå€¼å’Œå‘ç¥¨hashå€¼å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9  CORE_AND_F1_INVOICE.txt</span><br><span class="line">93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14  CORE_AND_F1_CONTRACT.txt</span><br><span class="line">76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a  f1_and_s1_contract.txt</span><br><span class="line">792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49  f1_and_s1_invoice.txt</span><br><span class="line">f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb  f1_and_s2_contract.txt</span><br><span class="line">f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468  f1_and_s2_invoice.txt</span><br></pre></td></tr></table></figure><h4 id="å‘è¡Œå‡­è¯-v2">å‘è¡Œå‡­è¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;IssueVoucher&quot;,&quot;Args&quot;:[&quot;asset003&quot;, &quot;1000&quot;, &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;, &quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><h4 id="æŸ¥è¯¢èµ„äº§">æŸ¥è¯¢èµ„äº§</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -C alljoinchannel -n supply -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset003&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;ä¸€çº§ä¾›åº”å•†&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">1000</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-29T10:07:43.665003Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-29T10:07:43.665003Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="ä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†1äº¤æ˜“">ä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†1äº¤æ˜“</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAssetByID&quot;,&quot;Args&quot;:[&quot;asset003&quot;, &quot;äºŒçº§ä¾›åº”å•†1&quot;, &quot;500&quot;, &quot;76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a&quot;, &quot;792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><h4 id="æŸ¥è¯¢èµ„äº§-v2">æŸ¥è¯¢èµ„äº§</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -C alljoinchannel -n supply -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset003&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;ä¸€çº§ä¾›åº”å•†&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-29T10:07:43.665003Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-29T10:07:43.665003Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset0031&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;äºŒçº§ä¾›åº”å•†1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-29T10:12:37.227293Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-29T10:12:37.227293Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="ä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†2äº¤æ˜“">ä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†2äº¤æ˜“</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAssetByID&quot;,&quot;Args&quot;:[&quot;asset003&quot;, &quot;äºŒçº§ä¾›åº”å•†2&quot;, &quot;300&quot;, &quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb&quot;, &quot;f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p><strong>é”™è¯¯ä¿¡æ¯è®°å½•ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: endorsement failure during invoke. response: status:500 message:&quot;the asset asset0031 already exists&quot;</span><br></pre></td></tr></table></figure><p>åŸå› å¦‚ä¸‹ï¼šå¦‚æœåŒä¸€ä¸ªèµ„äº§IDäº¤æ˜“ä¸¤æ¬¡ï¼Œåˆ™ä¼šå‡ºç°èµ„äº§IDé‡å¤çš„é—®é¢˜ï¼›ä»£ç bugã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">err := s.CreateAssetAndSave(ctx, asset.ID+<span class="string">&quot;1&quot;</span>, amount, asset.Issuer, newOwner, contractHash, invoiceHash)</span><br></pre></td></tr></table></figure><h4 id="ä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†2äº¤æ˜“-v2">ä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†2äº¤æ˜“</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAssetByID&quot;,&quot;Args&quot;:[&quot;asset0031&quot;, &quot;äºŒçº§ä¾›åº”å•†2&quot;, &quot;300&quot;, &quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb&quot;, &quot;f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢èµ„äº§ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset003&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;ä¸€çº§ä¾›åº”å•†&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-29T10:07:43.665003Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-29T10:07:43.665003Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset0031&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;äºŒçº§ä¾›åº”å•†1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-29T10:12:37.227293Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-29T10:12:37.227293Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset00311&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;äºŒçº§ä¾›åº”å•†2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">300</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-29T10:17:26.148125Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-29T10:17:26.148125Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²supply-v8åˆ°alljoinchannelé€šé“">éƒ¨ç½²supply-v8åˆ°alljoinchannelé€šé“</h2><h3 id="æºç ">æºç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chaincode</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;encoding/json&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;github.com/golang/protobuf/ptypes&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// SmartContract provides functions for managing an Asset</span></span><br><span class="line"><span class="keyword">type</span> SmartContract <span class="keyword">struct</span> &#123;</span><br><span class="line">contractapi.Contract</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Asset describes basic details of what makes up a simple asset</span></span><br><span class="line"><span class="keyword">type</span> Asset <span class="keyword">struct</span> &#123;</span><br><span class="line">ID           <span class="keyword">string</span>    <span class="string">`json:&quot;ID&quot;`</span></span><br><span class="line">Issuer       <span class="keyword">string</span>    <span class="string">`json:&quot;issuer&quot;`</span></span><br><span class="line">Owner        <span class="keyword">string</span>    <span class="string">`json:&quot;owner&quot;`</span></span><br><span class="line">Amount       <span class="keyword">int64</span>     <span class="string">`json:&quot;amount&quot;`</span></span><br><span class="line">CreateDate   time.Time <span class="string">`json:&quot;createDate&quot;`</span></span><br><span class="line">EndDate      time.Time <span class="string">`json:&quot;endDate&quot;`</span></span><br><span class="line">ContractHash <span class="keyword">string</span>    <span class="string">`json:&quot;contractHash&quot;`</span></span><br><span class="line">InvoiceHash  <span class="keyword">string</span>    <span class="string">`json:&quot;invoiceHash&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IssueVoucher å‘è¡Œå‡­è¯</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">IssueVoucher</span><span class="params">(ctx contractapi.TransactionContextInterface, assetID <span class="keyword">string</span>, amount <span class="keyword">int64</span>, owner <span class="keyword">string</span>, contractHash <span class="keyword">string</span>, invoiceHash <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="comment">// åˆ›å»ºèµ„äº§</span></span><br><span class="line"><span class="keyword">return</span> s.CreateAssetAndSave(ctx, assetID, amount, <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>, owner, contractHash, invoiceHash)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CreateAssetAndSave åˆ›å»ºèµ„äº§å¹¶ä¿å­˜</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">CreateAssetAndSave</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>, amount <span class="keyword">int64</span>, issuerName <span class="keyword">string</span>, owner <span class="keyword">string</span>, contractHash <span class="keyword">string</span>, invoiceHash <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">asset, err := s.createAsset(ctx, id, amount, issuerName, owner, contractHash, invoiceHash)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s.PutState(ctx, asset)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// createAsset issues a new asset to the world state with given details.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">createAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>, amount <span class="keyword">int64</span>, issuerName <span class="keyword">string</span>, owner <span class="keyword">string</span>, contractHash <span class="keyword">string</span>, invoiceHash <span class="keyword">string</span>)</span> <span class="params">(*Asset, error)</span></span> &#123;</span><br><span class="line">exists, err := s.AssetExists(ctx, id)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> exists &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;the asset %s already exists&quot;</span>, id)</span><br><span class="line">&#125;</span><br><span class="line">now, err := getNow(ctx)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line">asset := Asset&#123;ID: id, Issuer: issuerName, Amount: amount, Owner: owner, CreateDate: now,</span><br><span class="line">EndDate: now.AddDate(<span class="number">0</span>, <span class="number">6</span>, <span class="number">0</span>), ContractHash: contractHash, InvoiceHash: invoiceHash&#125;</span><br><span class="line"><span class="keyword">return</span> &amp;asset, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–å½“å‰æ—¶é—´</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getNow</span><span class="params">(ctx contractapi.TransactionContextInterface)</span> <span class="params">(time.Time, error)</span></span> &#123;</span><br><span class="line">now, err := ctx.GetStub().GetTxTimestamp()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> time.Now(), err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ptypes.Timestamp(now)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReadAsset returns the asset stored in the world state with given id.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">ReadAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>)</span> <span class="params">(*Asset, error)</span></span> &#123;</span><br><span class="line">assetJSON, err := ctx.GetStub().GetState(id)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;failed to read from world state: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> assetJSON == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;the asset %s does not exist&quot;</span>, id)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> asset Asset</span><br><span class="line">err = json.Unmarshal(assetJSON, &amp;asset)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> &amp;asset, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AssetExists returns true when asset with given ID exists in world state</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">AssetExists</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">bool</span>, error)</span></span> &#123;</span><br><span class="line">assetJSON, err := ctx.GetStub().GetState(id)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, fmt.Errorf(<span class="string">&quot;failed to read from world state: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> assetJSON != <span class="literal">nil</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TransferAssetByID æ ¹æ®èµ„äº§IDè½¬è´¦</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">TransferAssetByID</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>, newID <span class="keyword">string</span>, newOwner <span class="keyword">string</span>, amount <span class="keyword">int64</span>, contractHash <span class="keyword">string</span>, invoiceHash <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">asset, err := s.ReadAsset(ctx, id)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s.TransferAsset(ctx, asset, newID, newOwner, amount, contractHash, invoiceHash)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TransferAsset updates the owner field of asset with given id in world state.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">TransferAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, asset *Asset, newID <span class="keyword">string</span>, newOwner <span class="keyword">string</span>, amount <span class="keyword">int64</span>, contractHash <span class="keyword">string</span>, invoiceHash <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="comment">// å¦‚æœé‡‘é¢åˆšå¥½ç­‰äºå‡­è¯èµ„äº§çš„é‡‘é¢ï¼Œç›´æ¥æ›´æ–°å‡­è¯èµ„äº§çš„æ‹¥æœ‰è€…</span></span><br><span class="line"><span class="keyword">if</span> asset.Amount == amount &#123;</span><br><span class="line">asset.Owner = newOwner</span><br><span class="line"><span class="keyword">return</span> s.PutState(ctx, asset)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> asset.Amount &gt; amount &#123; <span class="comment">// å¦‚æœå‡­è¯èµ„äº§çš„é‡‘é¢å¤§äºè½¬è´¦çš„é‡‘é¢ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„äº§</span></span><br><span class="line"><span class="keyword">if</span> newID == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;è½¬è´¦é‡‘é¢å°äºèµ„äº§çš„é‡‘é¢æ—¶ï¼ŒnewIDå¿…é¡»ä¸èƒ½ä¸ºç©º&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆ›å»ºæ–°çš„èµ„äº§å¹¶ä¿å­˜</span></span><br><span class="line">err := s.CreateAssetAndSave(ctx, newID, amount, asset.Issuer, newOwner, contractHash, invoiceHash)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ›´æ–°æ—§èµ„äº§çš„é‡‘é¢</span></span><br><span class="line">asset.Amount = asset.Amount - amount</span><br><span class="line"><span class="keyword">return</span> s.PutState(ctx, asset)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> asset.Amount &lt; amount &#123; <span class="comment">// å¦‚æœèµ„äº§çš„é¢åº¦å°äºè¦è½¬è´¦çš„é‡‘é¢ï¼Œåˆ™ç›´æ¥æŠ¥é”™</span></span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;è½¬è´¦é‡‘é¢=%d,ä¸èƒ½è¶…è¿‡èµ„äº§çš„é‡‘é¢=%d&quot;</span>, amount, asset.Amount)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PutState æ›´æ–°èµ„äº§</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">PutState</span><span class="params">(ctx contractapi.TransactionContextInterface, asset *Asset)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">assetJSON, err := json.Marshal(asset)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ctx.GetStub().PutState(asset.ID, assetJSON)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetAllAssets returns all assets found in world state</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">GetAllAssets</span><span class="params">(ctx contractapi.TransactionContextInterface)</span> <span class="params">([]*Asset, error)</span></span> &#123;</span><br><span class="line"><span class="comment">// range query with empty string for startKey and endKey does an</span></span><br><span class="line"><span class="comment">// open-ended query of all assets in the chaincode namespace.</span></span><br><span class="line">resultsIterator, err := ctx.GetStub().GetStateByRange(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> resultsIterator.Close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> assets []*Asset</span><br><span class="line"><span class="keyword">for</span> resultsIterator.HasNext() &#123;</span><br><span class="line">queryResponse, err := resultsIterator.Next()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> asset Asset</span><br><span class="line">err = json.Unmarshal(queryResponse.Value, &amp;asset)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line">assets = <span class="built_in">append</span>(assets, &amp;asset)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> assets, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ‰“åŒ…-v7">æ‰“åŒ…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode package supply.8.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/chaincode-go/ --lang golang --label supply_8.0</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…é“¾ç åŒ…-v7">å®‰è£…é“¾ç åŒ…</h3><p>æ¯ä¸ªpeeréƒ½è¦å®‰è£…ï¼š<code>peer lifecycle chaincode install supply.8.tar.gz</code></p><h3 id="æ‰¹å‡†é“¾ç å®šä¹‰-v13">æ‰¹å‡†é“¾ç å®šä¹‰</h3><h4 id="æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode-v7">æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode queryinstalled</span><br></pre></td></tr></table></figure><p>å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ï¼Œä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦å®šä¹‰æ­¤å˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export CC_PACKAGE_ID=supply_8.0:797ec1d00145482b746640d0b8bb9bea64cb69dea3e95abb69a1195a19e34511</span><br></pre></td></tr></table></figure><h4 id="æ‰¹å‡†é“¾ç å®šä¹‰-v14">æ‰¹å‡†é“¾ç å®šä¹‰</h4><p>æ¯ä¸ªpeeréƒ½è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode approveformyorg -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name supply --version 8.0 --package-id $CC_PACKAGE_ID --sequence 2 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><h3 id="å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“-v7">å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“</h3><p>æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode checkcommitreadiness --channelID alljoinchannel --name supply --version 8.0 --sequence 2 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json</span><br></pre></td></tr></table></figure><p>åœ¨æ‰€æœ‰ç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode commit -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name supply --version 8.0 --sequence 2 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-querycommitted">peer lifecycle chaincode querycommitted</a> å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode querycommitted --channelID alljoinchannel --name supply --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><h3 id="è°ƒç”¨é“¾ç -v7">è°ƒç”¨é“¾ç </h3><p>è°ƒç”¨é“¾ç ä¹‹å‰å…ˆç”Ÿæˆæµ‹è¯•çš„åˆåŒhashå€¼å’Œå‘ç¥¨hashå€¼å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9  CORE_AND_F1_INVOICE.txt</span><br><span class="line">93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14  CORE_AND_F1_CONTRACT.txt</span><br><span class="line">76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a  f1_and_s1_contract.txt</span><br><span class="line">792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49  f1_and_s1_invoice.txt</span><br><span class="line">f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb  f1_and_s2_contract.txt</span><br><span class="line">f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468  f1_and_s2_invoice.txt</span><br></pre></td></tr></table></figure><h4 id="å‘è¡Œå‡­è¯-v3">å‘è¡Œå‡­è¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;IssueVoucher&quot;,&quot;Args&quot;:[&quot;asset001&quot;, &quot;1000&quot;, &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;, &quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><h4 id="æŸ¥è¯¢èµ„äº§-v3">æŸ¥è¯¢èµ„äº§</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -C alljoinchannel -n supply -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset001&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;ä¸€çº§ä¾›åº”å•†&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">1000</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-30T06:57:06.963617Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-30T06:57:06.963617Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="ä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†1äº¤æ˜“-v2">ä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†1äº¤æ˜“</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAssetByID&quot;,&quot;Args&quot;:[&quot;asset001&quot;, &quot;asset0011&quot;, &quot;äºŒçº§ä¾›åº”å•†1&quot;, &quot;500&quot;, &quot;76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a&quot;, &quot;792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><h4 id="æŸ¥è¯¢èµ„äº§-v4">æŸ¥è¯¢èµ„äº§</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -C alljoinchannel -n supply -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset001&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;ä¸€çº§ä¾›åº”å•†&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-30T06:57:06.963617Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-30T06:57:06.963617Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset0011&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;äºŒçº§ä¾›åº”å•†1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-30T06:57:50.047189Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-30T06:57:50.047189Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="ä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†2äº¤æ˜“-v3">ä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†2äº¤æ˜“</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAssetByID&quot;,&quot;Args&quot;:[&quot;asset001&quot;, &quot;asset0012&quot;, &quot;äºŒçº§ä¾›åº”å•†2&quot;, &quot;300&quot;, &quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb&quot;, &quot;f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢èµ„äº§ï¼Œç»“æœå¦‚ä¸‹<code>peer chaincode query -C alljoinchannel -n supply -c '&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;'</code>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset001&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;ä¸€çº§ä¾›åº”å•†&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-30T06:57:06.963617Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-30T06:57:06.963617Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset0011&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;äºŒçº§ä¾›åº”å•†1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-30T06:57:50.047189Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-30T06:57:50.047189Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset0012&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;äºŒçº§ä¾›åº”å•†2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">300</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-30T06:58:33.143818Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-30T06:58:33.143818Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="è½¬è´¦é‡‘é¢å¤§äºå‡­è¯èµ„äº§çš„é‡‘é¢-æœŸå¾…é”™è¯¯">è½¬è´¦é‡‘é¢å¤§äºå‡­è¯èµ„äº§çš„é‡‘é¢(æœŸå¾…é”™è¯¯)</h3><p>å‡ºç°é”™è¯¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(base) w:supply-finance apple$ peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAssetByID&quot;,&quot;Args&quot;:[&quot;asset001&quot;, &quot;asset0013&quot;, &quot;äºŒçº§ä¾›åº”å•†2&quot;, &quot;300&quot;, &quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb&quot;, &quot;f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468&quot;]&#125;&#x27;</span><br><span class="line">Error: endorsement failure during invoke. response: status:500 message:&quot;\350\275\254\350\264\246\351\207\221\351\242\235=300,\344\270\215\350\203\275\350\266\205\350\277\207\350\265\204\344\272\247\347\232\204\351\207\221\351\242\235=200&quot;</span><br></pre></td></tr></table></figure><p>é”™è¯¯ä¿¡æ¯è§£ç å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/guozhe001/images/raw/master/image-20201230151742496-20201230173424532.png" alt></p><h3 id="è½¬è´¦é‡‘é¢ç­‰äºå‡­è¯èµ„äº§çš„é‡‘é¢ï¼ˆå˜æ›´ownerï¼Œä¸äº§ç”Ÿæ–°çš„å‡­è¯èµ„äº§ï¼‰">è½¬è´¦é‡‘é¢ç­‰äºå‡­è¯èµ„äº§çš„é‡‘é¢ï¼ˆå˜æ›´ownerï¼Œä¸äº§ç”Ÿæ–°çš„å‡­è¯èµ„äº§ï¼‰</h3><p>ä¸€çº§ä¾›åº”å•†æŠŠå‰©ä½™çš„200è½¬ç»™äºŒçº§ä¾›åº”å•†2:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;&#x2F;organizations&#x2F;ordererOrganizations&#x2F;supply.com&#x2F;orderers&#x2F;orderer.supply.com&#x2F;msp&#x2F;tlscacerts&#x2F;tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;&#x2F;organizations&#x2F;peerOrganizations&#x2F;f1.supply.com&#x2F;peers&#x2F;peer0.f1.supply.com&#x2F;tls&#x2F;ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;&#x2F;organizations&#x2F;peerOrganizations&#x2F;s1.supply.com&#x2F;peers&#x2F;peer0.s1.supply.com&#x2F;tls&#x2F;ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;&#x2F;organizations&#x2F;peerOrganizations&#x2F;s2.supply.com&#x2F;peers&#x2F;peer0.s2.supply.com&#x2F;tls&#x2F;ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;&#x2F;organizations&#x2F;peerOrganizations&#x2F;core.supply.com&#x2F;peers&#x2F;peer0.core.supply.com&#x2F;tls&#x2F;ca.crt -c &#39;&#123;&quot;function&quot;:&quot;TransferAssetByID&quot;,&quot;Args&quot;:[&quot;asset001&quot;, &quot;asset0013&quot;, &quot;äºŒçº§ä¾›åº”å•†2&quot;, &quot;200&quot;, &quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb&quot;, &quot;f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468&quot;]&#125;&#39;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢èµ„äº§ï¼Œç»“æœå¦‚ä¸‹<code>peer chaincode query -C alljoinchannel -n supply -c '&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;'</code>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset001&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;äºŒçº§ä¾›åº”å•†2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-30T06:57:06.963617Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-30T06:57:06.963617Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset0011&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;äºŒçº§ä¾›åº”å•†1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-30T06:57:50.047189Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-30T06:57:50.047189Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset0012&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;issuer&quot;</span>: <span class="string">&quot;æ ¸å¿ƒä¼ä¸š&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;äºŒçº§ä¾›åº”å•†2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">300</span>,</span><br><span class="line">    <span class="attr">&quot;createDate&quot;</span>: <span class="string">&quot;2020-12-30T06:58:33.143818Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;endDate&quot;</span>: <span class="string">&quot;2021-06-30T06:58:33.143818Z&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;contractHash&quot;</span>: <span class="string">&quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;invoiceHash&quot;</span>: <span class="string">&quot;f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰äº§ç”Ÿæ–°çš„èµ„äº§ï¼Œè€Œæ˜¯æŠŠåŸæ¥çš„èµ„äº§çš„æ‹¥æœ‰è€…å˜æ›´äº†ã€‚</p><p><em>æ³¨æ„ï¼šè¿™æ ·æœ‰ä¸ªé—®é¢˜ï¼ŒåˆåŒhashå’Œå‘ç¥¨hashä¸åº”è¯¥è¿˜æ˜¯åŸæ¥çš„ã€‚</em></p><h2 id="éƒ¨ç½²supply-v9åˆ°alljoinchannelé€šé“">éƒ¨ç½²supply-v9åˆ°alljoinchannelé€šé“</h2><h3 id="æºç -v2">æºç </h3><p>ä¸v8ç‰ˆæœ¬ç›¸æ¯”ï¼Œå¢åŠ åˆ é™¤èµ„äº§çš„æ–¹æ³•</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DelState åˆ é™¤èµ„äº§</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">DelState</span><span class="params">(ctx contractapi.TransactionContextInterface, assetIds ...<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> _, assetID := <span class="keyword">range</span> assetIds &#123;</span><br><span class="line">exists, err := s.AssetExists(ctx, assetID)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> !exists &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;assetID=%sçš„èµ„äº§ä¸å­˜åœ¨&quot;</span>, assetID)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ctx.GetStub().DelState(assetID)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ‰“åŒ…-v8">æ‰“åŒ…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode package supply.18.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/supply-finance-chaincode/ --lang golang --label secured_supply_22.0</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…é“¾ç åŒ…-v8">å®‰è£…é“¾ç åŒ…</h3><p>æ¯ä¸ªpeeréƒ½è¦å®‰è£…ï¼š<code>peer lifecycle chaincode install supply.18.tar.gz</code></p><h3 id="æ‰¹å‡†é“¾ç å®šä¹‰-v15">æ‰¹å‡†é“¾ç å®šä¹‰</h3><h4 id="æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode-v8">æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode queryinstalled</span><br></pre></td></tr></table></figure><p>å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ï¼Œä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦å®šä¹‰æ­¤å˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export CC_PACKAGE_ID=secured_supply_22.0:e815ca2d270dea029bc6992952140b1288a440aba8c430853f72eee7d5de24a7</span><br></pre></td></tr></table></figure><h4 id="æ‰¹å‡†é“¾ç å®šä¹‰-v16">æ‰¹å‡†é“¾ç å®šä¹‰</h4><p>æ¯ä¸ªpeeréƒ½è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode approveformyorg -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name secured_supply --version 22.0 --package-id $CC_PACKAGE_ID --sequence 22 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><h3 id="å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“-v8">å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“</h3><p>æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode checkcommitreadiness --channelID alljoinchannel --name secured_supply --version 22.0 --sequence 22 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json</span><br></pre></td></tr></table></figure><p>åœ¨æ‰€æœ‰ç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode commit -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name secured_supply --version 22.0 --sequence 22 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-querycommitted">peer lifecycle chaincode querycommitted</a> å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode querycommitted --channelID alljoinchannel --name secured_supply --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><h3 id="è°ƒç”¨é“¾ç -v8">è°ƒç”¨é“¾ç </h3><p>è°ƒç”¨é“¾ç ä¹‹å‰å…ˆç”Ÿæˆæµ‹è¯•çš„åˆåŒhashå€¼å’Œå‘ç¥¨hashå€¼å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9  CORE_AND_F1_INVOICE.txt</span><br><span class="line">93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14  CORE_AND_F1_CONTRACT.txt</span><br><span class="line">76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a  f1_and_s1_contract.txt</span><br><span class="line">792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49  f1_and_s1_invoice.txt</span><br><span class="line">f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb  f1_and_s2_contract.txt</span><br><span class="line">f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468  f1_and_s2_invoice.txt</span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤èµ„äº§">åˆ é™¤èµ„äº§</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;DelState&quot;,&quot;Args&quot;:[&quot;asset001 asset0011 asset0012 asset003 asset0031 asset00311&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p><strong>é”™è¯¯ä¿¡æ¯è®°å½•ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(base) w:supply-finance apple$ peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;DelState&quot;,&quot;Args&quot;:[&quot;asset001 asset0011 asset0012 asset003 asset0031 asset00311&quot;]&#125;&#x27;</span><br><span class="line">Error: endorsement failure during invoke. response: status:500 message:&quot;Error managing parameter param0. Conversion error. Value asset001 asset0011 asset0012 asset003 asset0031 asset00311 was not passed in expected format []string&quot;</span><br></pre></td></tr></table></figure><p>**é”™è¯¯åŸå› ï¼š**å› ä¸ºæ–¹æ³•ä½¿ç”¨çš„æ˜¯å¯å˜é•¿å‚æ•°ï¼Œä½†æ˜¯ä¸çŸ¥é“è¯¥æ€ä¹ˆç»™ä»–ä¼ å‚æ•°</p><h2 id="éƒ¨ç½²supply-v9-1åˆ°alljoinchannelé€šé“">éƒ¨ç½²supply-v9.1åˆ°alljoinchannelé€šé“</h2><h3 id="æºç -v3">æºç </h3><p>ä¸v9ç‰ˆæœ¬ç›¸æ¯”ï¼Œä¿®æ”¹åˆ é™¤èµ„äº§çš„æ–¹æ³•ä¸ºåˆ é™¤å•ä¸ªèµ„äº§</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DelState åˆ é™¤èµ„äº§</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">DelState</span><span class="params">(ctx contractapi.TransactionContextInterface, assetID <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">exists, err := s.AssetExists(ctx, assetID)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> !exists &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;assetID=%sçš„èµ„äº§ä¸å­˜åœ¨&quot;</span>, assetID)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ctx.GetStub().DelState(assetID)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‰“åŒ…-v9">æ‰“åŒ…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode package supply.9.1.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/chaincode-go/ --lang golang --label supply_9.1</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…é“¾ç åŒ…-v9">å®‰è£…é“¾ç åŒ…</h3><p>æ¯ä¸ªpeeréƒ½è¦å®‰è£…ï¼š<code>peer lifecycle chaincode install supply.9.1.tar.gz</code></p><h3 id="æ‰¹å‡†é“¾ç å®šä¹‰-v17">æ‰¹å‡†é“¾ç å®šä¹‰</h3><h4 id="æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode-v9">æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode queryinstalled</span><br></pre></td></tr></table></figure><p>å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ï¼Œä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦å®šä¹‰æ­¤å˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export CC_PACKAGE_ID=supply_9.1:f733e8484c17cb415e38ac1fb14ed646622f2980762906c97d6e7e1c1a90f2c3</span><br></pre></td></tr></table></figure><h4 id="æ‰¹å‡†é“¾ç å®šä¹‰-v18">æ‰¹å‡†é“¾ç å®šä¹‰</h4><p>æ¯ä¸ªpeeréƒ½è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode approveformyorg -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name supply --version 9.1 --package-id $CC_PACKAGE_ID --sequence 4 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><h3 id="å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“-v9">å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“</h3><p>æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode checkcommitreadiness --channelID alljoinchannel --name supply --version 9.1 --sequence 4 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json</span><br></pre></td></tr></table></figure><p>åœ¨æ‰€æœ‰ç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode commit -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name supply --version 9.1 --sequence 4 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-querycommitted">peer lifecycle chaincode querycommitted</a> å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode querycommitted --channelID alljoinchannel --name supply --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><h3 id="è°ƒç”¨é“¾ç -v9">è°ƒç”¨é“¾ç </h3><p>è°ƒç”¨é“¾ç ä¹‹å‰å…ˆç”Ÿæˆæµ‹è¯•çš„åˆåŒhashå€¼å’Œå‘ç¥¨hashå€¼å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9  CORE_AND_F1_INVOICE.txt</span><br><span class="line">93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14  CORE_AND_F1_CONTRACT.txt</span><br><span class="line">76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a  f1_and_s1_contract.txt</span><br><span class="line">792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49  f1_and_s1_invoice.txt</span><br><span class="line">f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb  f1_and_s2_contract.txt</span><br><span class="line">f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468  f1_and_s2_invoice.txt</span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤èµ„äº§-v2">åˆ é™¤èµ„äº§</h4><p>èµ„äº§IDåˆ—è¡¨ï¼šâ€œasset001 asset0011 asset0012 asset003 asset0031 asset00311â€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;DelState&quot;,&quot;Args&quot;:[&quot;asset00311&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤ä¹‹åæŸ¥è¯¢ï¼š">åˆ é™¤ä¹‹åæŸ¥è¯¢ï¼š</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -C alljoinchannel -n supply -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>è¿”å›çš„èµ„äº§åˆ—è¡¨ä¸ºç©ºï¼Œåˆ é™¤æ–¹æ³•éªŒè¯æˆåŠŸã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;Practice_SmartContract:InitLedger&quot;,&quot;Args&quot;:[]&#125;&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;Practice_SmartContract:SomeStubMethod&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;Practice_SmartContract:InitLedger&quot;,&quot;Args&quot;:[]&#125;&#x27;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> ä¾›åº”é“¾é‡‘è </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> peer </tag>
            
            <tag> ä¾›åº”é“¾é‡‘è </tag>
            
            <tag> chaincode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼€å‘æ™ºèƒ½åˆçº¦</title>
      <link href="2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E5%BC%80%E5%8F%91%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/"/>
      <url>2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E5%BC%80%E5%8F%91%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/</url>
      
        <content type="html"><![CDATA[<h1 id="å¼€å‘æ™ºèƒ½åˆçº¦">å¼€å‘æ™ºèƒ½åˆçº¦</h1><p>æœ¬æ¬¡çš„æ™ºèƒ½åˆçº¦ä»<a href="https://github.com/hyperledger/fabric-samples.git">fabric-samples</a>çš„<code>asset-transfer-basic/chaincode-go</code>æ‹·è´ç„¶åè¿›è¡Œäº†ä¿®æ”¹ã€‚</p><p>æ™ºèƒ½åˆçº¦ä»£ç <code>smartcontract.go</code>å¦‚ä¸‹ï¼šæœ¬æ–‡æ¡£æ›´æ–°ä¸åŠæ—¶ï¼Œå¯åˆ°<a href="https://github.com/guozhe001/supply-finance.git">æºç åœ°å€</a>æŸ¥çœ‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line">package chaincode</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">&quot;encoding/json&quot;</span><br><span class="line">&quot;fmt&quot;</span><br><span class="line">&quot;time&quot;</span><br><span class="line"></span><br><span class="line">&quot;github.com/golang/protobuf/ptypes&quot;</span><br><span class="line">&quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// SmartContract provides functions for managing an Asset</span><br><span class="line">type SmartContract struct &#123;</span><br><span class="line">contractapi.Contract</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Asset describes basic details of what makes up a simple asset</span><br><span class="line">type Asset struct &#123;</span><br><span class="line">ID           string    `json:&quot;ID&quot;`</span><br><span class="line">Issuer       string    `json:&quot;issuer&quot;`</span><br><span class="line">Owner        string    `json:&quot;owner&quot;`</span><br><span class="line">Amount       int64     `json:&quot;amount&quot;`</span><br><span class="line">CreateDate   time.Time `json:&quot;createDate&quot;`</span><br><span class="line">EndDate      time.Time `json:&quot;endDate&quot;`</span><br><span class="line">ContractHash string    `json:&quot;contractHash&quot;`</span><br><span class="line">InvoiceHash  string    `json:&quot;invoiceHash&quot;`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// IssueVoucher å‘è¡Œå‡­è¯</span><br><span class="line">func (s *SmartContract) IssueVoucher(ctx contractapi.TransactionContextInterface, assetID string, amount int64, owner string, contractHash string, invoiceHash string) error &#123;</span><br><span class="line">// åˆ›å»ºèµ„äº§</span><br><span class="line">return s.CreateAssetAndSave(ctx, assetID, amount, &quot;æ ¸å¿ƒä¼ä¸š&quot;, owner, contractHash, invoiceHash)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// CreateAssetAndSave åˆ›å»ºèµ„äº§å¹¶ä¿å­˜</span><br><span class="line">func (s *SmartContract) CreateAssetAndSave(ctx contractapi.TransactionContextInterface, id string, amount int64, issuerName string, owner string, contractHash string, invoiceHash string) error &#123;</span><br><span class="line">asset, err := s.createAsset(ctx, id, amount, issuerName, owner, contractHash, invoiceHash)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return err</span><br><span class="line">&#125;</span><br><span class="line">return s.PutState(ctx, asset)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// createAsset issues a new asset to the world state with given details.</span><br><span class="line">func (s *SmartContract) createAsset(ctx contractapi.TransactionContextInterface, id string, amount int64, issuerName string, owner string, contractHash string, invoiceHash string) (*Asset, error) &#123;</span><br><span class="line">exists, err := s.AssetExists(ctx, id)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return nil, err</span><br><span class="line">&#125;</span><br><span class="line">if exists &#123;</span><br><span class="line">return nil, fmt.Errorf(&quot;the asset %s already exists&quot;, id)</span><br><span class="line">&#125;</span><br><span class="line">now, err := getNow(ctx)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return nil, err</span><br><span class="line">&#125;</span><br><span class="line">asset := Asset&#123;ID: id, Issuer: issuerName, Amount: amount, Owner: owner, CreateDate: now,</span><br><span class="line">EndDate: now.AddDate(0, 6, 0), ContractHash: contractHash, InvoiceHash: invoiceHash&#125;</span><br><span class="line">return &amp;asset, nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è·å–å½“å‰æ—¶é—´</span><br><span class="line">func getNow(ctx contractapi.TransactionContextInterface) (time.Time, error) &#123;</span><br><span class="line">now, err := ctx.GetStub().GetTxTimestamp()</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return time.Now(), err</span><br><span class="line">&#125;</span><br><span class="line">return ptypes.Timestamp(now)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ReadAsset returns the asset stored in the world state with given id.</span><br><span class="line">func (s *SmartContract) ReadAsset(ctx contractapi.TransactionContextInterface, id string) (*Asset, error) &#123;</span><br><span class="line">assetJSON, err := ctx.GetStub().GetState(id)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return nil, fmt.Errorf(&quot;failed to read from world state: %v&quot;, err)</span><br><span class="line">&#125;</span><br><span class="line">if assetJSON == nil &#123;</span><br><span class="line">return nil, fmt.Errorf(&quot;the asset %s does not exist&quot;, id)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var asset Asset</span><br><span class="line">err = json.Unmarshal(assetJSON, &amp;asset)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return nil, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">return &amp;asset, nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// AssetExists returns true when asset with given ID exists in world state</span><br><span class="line">func (s *SmartContract) AssetExists(ctx contractapi.TransactionContextInterface, id string) (bool, error) &#123;</span><br><span class="line">assetJSON, err := ctx.GetStub().GetState(id)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return false, fmt.Errorf(&quot;failed to read from world state: %v&quot;, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">return assetJSON != nil, nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// TransferAssetByID æ ¹æ®èµ„äº§IDè½¬è´¦</span><br><span class="line">func (s *SmartContract) TransferAssetByID(ctx contractapi.TransactionContextInterface, id string, newID string, newOwner string, amount int64, contractHash string, invoiceHash string) error &#123;</span><br><span class="line">asset, err := s.ReadAsset(ctx, id)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return err</span><br><span class="line">&#125;</span><br><span class="line">return s.TransferAsset(ctx, asset, newID, newOwner, amount, contractHash, invoiceHash)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// TransferAsset updates the owner field of asset with given id in world state.</span><br><span class="line">func (s *SmartContract) TransferAsset(ctx contractapi.TransactionContextInterface, asset *Asset, newID string, newOwner string, amount int64, contractHash string, invoiceHash string) error &#123;</span><br><span class="line">// å¦‚æœé‡‘é¢åˆšå¥½ç­‰äºå‡­è¯èµ„äº§çš„é‡‘é¢ï¼Œç›´æ¥æ›´æ–°å‡­è¯èµ„äº§çš„æ‹¥æœ‰è€…</span><br><span class="line">if asset.Amount == amount &#123;</span><br><span class="line">asset.Owner = newOwner</span><br><span class="line">return s.PutState(ctx, asset)</span><br><span class="line">&#125; else if asset.Amount &gt; amount &#123; // å¦‚æœå‡­è¯èµ„äº§çš„é‡‘é¢å¤§äºè½¬è´¦çš„é‡‘é¢ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„äº§</span><br><span class="line">if newID == &quot;&quot; &#123;</span><br><span class="line">return fmt.Errorf(&quot;è½¬è´¦é‡‘é¢å°äºèµ„äº§çš„é‡‘é¢æ—¶ï¼ŒnewIDå¿…é¡»ä¸èƒ½ä¸ºç©º&quot;)</span><br><span class="line">&#125;</span><br><span class="line">// åˆ›å»ºæ–°çš„èµ„äº§å¹¶ä¿å­˜</span><br><span class="line">err := s.CreateAssetAndSave(ctx, newID, amount, asset.Issuer, newOwner, contractHash, invoiceHash)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return err</span><br><span class="line">&#125;</span><br><span class="line">// æ›´æ–°æ—§èµ„äº§çš„é‡‘é¢</span><br><span class="line">asset.Amount = asset.Amount - amount</span><br><span class="line">return s.PutState(ctx, asset)</span><br><span class="line">&#125; else if asset.Amount &lt; amount &#123; // å¦‚æœèµ„äº§çš„é¢åº¦å°äºè¦è½¬è´¦çš„é‡‘é¢ï¼Œåˆ™ç›´æ¥æŠ¥é”™</span><br><span class="line">return fmt.Errorf(&quot;è½¬è´¦é‡‘é¢=%d,ä¸èƒ½è¶…è¿‡èµ„äº§çš„é‡‘é¢=%d&quot;, amount, asset.Amount)</span><br><span class="line">&#125;</span><br><span class="line">return nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// PutState æ›´æ–°èµ„äº§</span><br><span class="line">func (s *SmartContract) PutState(ctx contractapi.TransactionContextInterface, asset *Asset) error &#123;</span><br><span class="line">assetJSON, err := json.Marshal(asset)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return err</span><br><span class="line">&#125;</span><br><span class="line">return ctx.GetStub().PutState(asset.ID, assetJSON)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// DelState åˆ é™¤èµ„äº§</span><br><span class="line">func (s *SmartContract) DelState(ctx contractapi.TransactionContextInterface, assetID string) error &#123;</span><br><span class="line">exists, err := s.AssetExists(ctx, assetID)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return nil</span><br><span class="line">&#125;</span><br><span class="line">if !exists &#123;</span><br><span class="line">return fmt.Errorf(&quot;assetID=%sçš„èµ„äº§ä¸å­˜åœ¨&quot;, assetID)</span><br><span class="line">&#125;</span><br><span class="line">return ctx.GetStub().DelState(assetID)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// GetAllAssets returns all assets found in world state</span><br><span class="line">func (s *SmartContract) GetAllAssets(ctx contractapi.TransactionContextInterface) ([]*Asset, error) &#123;</span><br><span class="line">// range query with empty string for startKey and endKey does an</span><br><span class="line">// open-ended query of all assets in the chaincode namespace.</span><br><span class="line">resultsIterator, err := ctx.GetStub().GetStateByRange(&quot;&quot;, &quot;&quot;)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return nil, err</span><br><span class="line">&#125;</span><br><span class="line">defer resultsIterator.Close()</span><br><span class="line"></span><br><span class="line">var assets []*Asset</span><br><span class="line">for resultsIterator.HasNext() &#123;</span><br><span class="line">queryResponse, err := resultsIterator.Next()</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return nil, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var asset Asset</span><br><span class="line">err = json.Unmarshal(queryResponse.Value, &amp;asset)</span><br><span class="line">if err != nil &#123;</span><br><span class="line">return nil, err</span><br><span class="line">&#125;</span><br><span class="line">assets = append(assets, &amp;asset)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">return assets, nil</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> ä¾›åº”é“¾é‡‘è </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> ä¾›åº”é“¾é‡‘è </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¯å¢ƒå˜é‡è®¾ç½®</title>
      <link href="2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/"/>
      <url>2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/</url>
      
        <content type="html"><![CDATA[<p>ä»¥ä¸‹æ‰€æœ‰çš„å‘½ä»¤å‡åœ¨<code>supply-finance</code>ç›®å½•ä¸‹æ‰§è¡Œ</p><h3 id="ç¯å¢ƒå˜é‡è®¾ç½®ï¼š">ç¯å¢ƒå˜é‡è®¾ç½®ï¼š</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$&#123;PWD&#125;/bin:$PATH</span><br><span class="line">export FABRIC_CFG_PATH=$&#123;PWD&#125;/config</span><br><span class="line">configtxgen --help</span><br></pre></td></tr></table></figure><h3 id="æ ¸å¿ƒä¼ä¸šGylCoreOrg1MSP-Adminï¼š">æ ¸å¿ƒä¼ä¸šGylCoreOrg1MSP,Adminï¼š</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export CORE_PEER_TLS_ENABLED=true</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;GylCoreOrg1MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/users/Admin@core.supply.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:8051</span><br></pre></td></tr></table></figure><h3 id="ä¸€çº§ä¾›åº”å•†GylFOrg1MSP-Adminï¼š">ä¸€çº§ä¾›åº”å•†GylFOrg1MSP,Adminï¼š</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export CORE_PEER_TLS_ENABLED=true</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;GylFOrg1MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/users/Admin@f1.supply.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:8053</span><br></pre></td></tr></table></figure><h3 id="äºŒçº§ä¾›åº”å•†1GylSOrg1MSP-Adminï¼š">äºŒçº§ä¾›åº”å•†1GylSOrg1MSP,Adminï¼š</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export CORE_PEER_TLS_ENABLED=true</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;GylSOrg1MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/users/Admin@s1.supply.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:8055</span><br></pre></td></tr></table></figure><h3 id="äºŒçº§ä¾›åº”å•†2GylSOrg2MSP-Adminï¼š">äºŒçº§ä¾›åº”å•†2GylSOrg2MSP,Adminï¼š</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export CORE_PEER_TLS_ENABLED=true</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;GylSOrg2MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/users/Admin@s2.supply.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:8151</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> ä¾›åº”é“¾é‡‘è </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> peer </tag>
            
            <tag> ä¾›åº”é“¾é‡‘è </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ›å»ºç½‘ç»œ</title>
      <link href="2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E5%88%9B%E5%BB%BA%E7%BD%91%E7%BB%9C/"/>
      <url>2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E5%88%9B%E5%BB%BA%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ›å»ºç½‘ç»œ">åˆ›å»ºç½‘ç»œ</h1><p>ä¸€ä¸ªç”Ÿäº§çš„fabricç½‘ç»œåº”è¯¥ç”±å„ä¸ªç»„ç»‡è‡ªå·±ä¿å­˜è‡ªå·±çš„åŠ å¯†ææ–™ï¼Œæµ‹è¯•ç¯å¢ƒä¸ºäº†æ¼”ç¤ºåœ¨æœ¬åœ°ç”Ÿæˆæ‰€æœ‰ç»„ç»‡çš„åŠ å¯†ææ–™ã€‚</p><h2 id="ç”ŸæˆåŠ å¯†ææ–™">ç”ŸæˆåŠ å¯†ææ–™</h2><h3 id="åˆ›å»ºé…ç½®æ–‡ä»¶">åˆ›å»ºé…ç½®æ–‡ä»¶</h3><p>åˆ›å»º<code>supply-finance</code>æ–‡ä»¶å¤¹ï¼Œé…ç½®<code>config/crypto-config.yaml</code>æ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">OrdererOrgs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">Name:</span> <span class="string">Orderer</span></span><br><span class="line">    <span class="attr">Domain:</span> <span class="string">supply.com</span></span><br><span class="line">    <span class="attr">Specs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">Hostname:</span> <span class="string">orderer</span></span><br><span class="line"><span class="attr">PeerOrgs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">Name:</span> <span class="string">gyl_core_org1</span></span><br><span class="line">    <span class="attr">Domain:</span> <span class="string">core.supply.com</span></span><br><span class="line">    <span class="attr">Template:</span></span><br><span class="line">      <span class="attr">Count:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">Users:</span></span><br><span class="line">      <span class="attr">Count:</span> <span class="number">2</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">Name:</span> <span class="string">gyl_f_org1</span></span><br><span class="line">    <span class="attr">Domain:</span> <span class="string">f1.supply.com</span></span><br><span class="line">    <span class="attr">Template:</span></span><br><span class="line">      <span class="attr">Count:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">Users:</span></span><br><span class="line">      <span class="attr">Count:</span> <span class="number">2</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">Name:</span> <span class="string">gyl_s_org1</span></span><br><span class="line">    <span class="attr">Domain:</span> <span class="string">s1.supply.com</span></span><br><span class="line">    <span class="attr">Template:</span></span><br><span class="line">      <span class="attr">Count:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">Users:</span></span><br><span class="line">      <span class="attr">Count:</span> <span class="number">2</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">Name:</span> <span class="string">gyl_s_org2</span></span><br><span class="line">    <span class="attr">Domain:</span> <span class="string">s2.supply.com</span></span><br><span class="line">    <span class="attr">Template:</span></span><br><span class="line">      <span class="attr">Count:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">Users:</span></span><br><span class="line">      <span class="attr">Count:</span> <span class="number">2</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨é…ç½®æ–‡ä»¶ç”ŸæˆåŠ å¯†ææ–™">ä½¿ç”¨é…ç½®æ–‡ä»¶ç”ŸæˆåŠ å¯†ææ–™</h3><p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ç”ŸæˆåŠ å¯†ææ–™ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cryptogen generate --config=config/crypto-config.yaml --output=&quot;./organizations&quot;</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨åŠ å¯†ææ–™ç”Ÿæˆåˆ›ä¸–çºªåŒºå—">ä½¿ç”¨åŠ å¯†ææ–™ç”Ÿæˆåˆ›ä¸–çºªåŒºå—</h4><p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ç”Ÿæˆç³»ç»Ÿåˆ›ä¸–çºªåŒºå—ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configtxgen -profile TestOrgsOrdererGenesis -channelID system-channel -outputBlock ./system-genesis-block/genesis.block</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">esis.block</span><br><span class="line">2020-12-24 15:41:52.702 CST [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2020-12-24 15:41:52.716 CST [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 002 orderer type: etcdraft</span><br><span class="line">2020-12-24 15:41:52.716 CST [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 003 Orderer.EtcdRaft.Options unset, setting to tick_interval:&quot;500ms&quot; election_tick:10 heartbeat_tick:1 max_inflight_blocks:5 snapshot_interval_size:16777216</span><br><span class="line">2020-12-24 15:41:52.716 CST [common.tools.configtxgen.localconfig] Load -&gt; INFO 004 Loaded configuration: /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/config/configtx.yaml</span><br><span class="line">2020-12-24 15:41:52.723 CST [common.tools.configtxgen] doOutputBlock -&gt; INFO 005 Generating genesis block</span><br><span class="line">2020-12-24 15:41:52.723 CST [common.tools.configtxgen] doOutputBlock -&gt; INFO 006 Creating system channel genesis block</span><br><span class="line">2020-12-24 15:41:52.724 CST [common.tools.configtxgen] doOutputBlock -&gt; INFO 007 Writing genesis block</span><br></pre></td></tr></table></figure><p><strong>é‡åˆ°çš„é”™è¯¯ä¿¡æ¯ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2020-12-24 15:39:28.696 CST [common.tools.configtxgen] main -&gt; FATA 005 Error on outputBlock: could not create bootstrapper: could not create channel group: could not create orderer group: cannot marshal metadata for orderer type etcdraft: cannot load client cert for consenter orderer.supply.com:8050: open /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/cryptogen/crypto-config/ordererOrganizations/supply.com/orderers/orderer.supply.com/tls/server.crt: no such file or directory</span><br></pre></td></tr></table></figure><p><strong>é”™è¯¯åŸå› ï¼š</strong><code>$FABRIC_CFG_PATH/configtx.yaml</code>é…ç½®çš„åŠ å¯†æ–‡ä»¶åœ°å€ä¸æ­£ç¡®</p><h2 id="å¯åŠ¨ç½‘ç»œ">å¯åŠ¨ç½‘ç»œ</h2><p>å„ä¸ªç»„ç»‡çš„åŠ å¯†ææ–™ç”Ÿæˆä¹‹åï¼Œåœ¨æœ¬åœ°dockerç¯å¢ƒå¯åŠ¨è¿™äº›ç»„ç»‡çš„peerèŠ‚ç‚¹ã€‚</p><h3 id="é…ç½®docker-compose-ymlæ–‡ä»¶">é…ç½®docker-compose.ymlæ–‡ä»¶</h3><p>åœ¨<code>supply-finance</code>ç›®å½•ä¸‹æ·»åŠ <code>docker/docker-compose.yml</code>æ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Copyright IBM Corp. All Rights Reserved.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># SPDX-License-Identifier: Apache-2.0</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">orderer.supply.com:</span></span><br><span class="line">  <span class="attr">peer0.core.supply.com:</span></span><br><span class="line">  <span class="attr">peer0.f1.supply.com:</span></span><br><span class="line">  <span class="attr">peer0.s1.supply.com:</span></span><br><span class="line">  <span class="attr">peer0.s2.supply.com:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">test:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">orderer.supply.com:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">orderer.supply.com</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hyperledger/fabric-orderer:2.2.0</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_LOGGING_SPEC=INFO</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_LISTENADDRESS=0.0.0.0</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_LISTENPORT=8050</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_GENESISMETHOD=file</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_BOOTSTRAPFILE=/etc/hyperledger/orderer/orderer.genesis.block</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_LOCALMSPID=OrdererMSP</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_LOCALMSPDIR=/etc/hyperledger/fabric/msp</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_LEDGERTYPE=file</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_OPERATIONS_LISTENADDRESS=0.0.0.0:8443</span></span><br><span class="line">      <span class="comment"># enabled TLS</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_TLS_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_TLS_PRIVATEKEY=/etc/hyperledger/fabric/tls/server.key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_TLS_CERTIFICATE=/etc/hyperledger/fabric/tls/server.crt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_TLS_ROOTCAS=[/etc/hyperledger/fabric/tls/ca.crt]</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE=/etc/hyperledger/fabric/tls/server.crt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY=/etc/hyperledger/fabric/tls/server.key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ORDERER_GENERAL_CLUSTER_ROOTCAS=[/etc/hyperledger/fabric/tls/ca.crt]</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/opt/gopath/src/github.com/hyperledger/fabric</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">orderer</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../system-genesis-block/genesis.block:/etc/hyperledger/orderer/orderer.genesis.block</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp:/etc/hyperledger/fabric/msp</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/tls:/etc/hyperledger/fabric/tls</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">orderer.supply.com:/var/hyperledger/production/orderer</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations:/tmp</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8050</span><span class="string">:8050</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">peer0.core.supply.com:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">peer0.core.supply.com</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hyperledger/fabric-peer:2.2.0</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment">#Generic peer variables</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span></span><br><span class="line">      <span class="comment"># the following setting starts chaincode containers on the same</span></span><br><span class="line">      <span class="comment"># bridge network as the peers</span></span><br><span class="line">      <span class="comment"># https://docs.docker.com/compose/networking/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=docker_test</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_LOGGING_SPEC=INFO</span></span><br><span class="line">      <span class="comment">#- FABRIC_LOGGING_SPEC=DEBUG</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_PROFILE_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span></span><br><span class="line">      <span class="comment"># Peer specific variabes</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ID=peer0.core.supply.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ADDRESS=peer0.core.supply.com:8051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_LISTENADDRESS=0.0.0.0:8051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_CHAINCODEADDRESS=peer0.core.supply.com:8052</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0:8052</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_GOSSIP_BOOTSTRAP=peer0.core.supply.com:8051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.core.supply.com:8051</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_LOCALMSPID=GylCoreOrg1MSP</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run/:/host/var/run/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/msp:/etc/hyperledger/fabric/msp</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls:/etc/hyperledger/fabric/tls</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">peer0.core.supply.com:/var/hyperledger/production</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations:/tmp</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/opt/gopath/src/github.com/hyperledger/fabric/peer</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">peer</span> <span class="string">node</span> <span class="string">start</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8051</span><span class="string">:8051</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">peer0.f1.supply.com:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">peer0.f1.supply.com</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hyperledger/fabric-peer:2.2.0</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment">#Generic peer variables</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span></span><br><span class="line">      <span class="comment"># the following setting starts chaincode containers on the same</span></span><br><span class="line">      <span class="comment"># bridge network as the peers</span></span><br><span class="line">      <span class="comment"># https://docs.docker.com/compose/networking/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=docker_test</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_LOGGING_SPEC=INFO</span></span><br><span class="line">      <span class="comment">#- FABRIC_LOGGING_SPEC=DEBUG</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_PROFILE_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span></span><br><span class="line">      <span class="comment"># Peer specific variabes</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ID=peer0.f1.supply.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ADDRESS=peer0.f1.supply.com:8053</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_LISTENADDRESS=0.0.0.0:8053</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_CHAINCODEADDRESS=peer0.f1.supply.com:8054</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0:8054</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_GOSSIP_BOOTSTRAP=peer0.f1.supply.com:8053</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_LOCALMSPID=GylFOrg1MSP</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run/:/host/var/run/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/msp:/etc/hyperledger/fabric/msp</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls:/etc/hyperledger/fabric/tls</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">peer0.f1.supply.com:/var/hyperledger/production</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations:/tmp</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/opt/gopath/src/github.com/hyperledger/fabric/peer</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">peer</span> <span class="string">node</span> <span class="string">start</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8053</span><span class="string">:8053</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">peer0.s1.supply.com:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">peer0.s1.supply.com</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hyperledger/fabric-peer:2.2.0</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment">#Generic peer variables</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span></span><br><span class="line">      <span class="comment"># the following setting starts chaincode containers on the same</span></span><br><span class="line">      <span class="comment"># bridge network as the peers</span></span><br><span class="line">      <span class="comment"># https://docs.docker.com/compose/networking/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=docker_test</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_LOGGING_SPEC=INFO</span></span><br><span class="line">      <span class="comment">#- FABRIC_LOGGING_SPEC=DEBUG</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_PROFILE_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span></span><br><span class="line">      <span class="comment"># Peer specific variabes</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ID=peer0.s1.supply.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ADDRESS=peer0.s1.supply.com:8055</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_LISTENADDRESS=0.0.0.0:8055</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_CHAINCODEADDRESS=peer0.s1.supply.com:8056</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0:8056</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_GOSSIP_BOOTSTRAP=peer0.s1.supply.com:8055</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_LOCALMSPID=GylSOrg1MSP</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run/:/host/var/run/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/msp:/etc/hyperledger/fabric/msp</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls:/etc/hyperledger/fabric/tls</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">peer0.s1.supply.com:/var/hyperledger/production</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations:/tmp</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/opt/gopath/src/github.com/hyperledger/fabric/peer</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">peer</span> <span class="string">node</span> <span class="string">start</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8055</span><span class="string">:8055</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">peer0.s2.supply.com:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">peer0.s2.supply.com</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">hyperledger/fabric-peer:2.2.0</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment">#Generic peer variables</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span></span><br><span class="line">      <span class="comment"># the following setting starts chaincode containers on the same</span></span><br><span class="line">      <span class="comment"># bridge network as the peers</span></span><br><span class="line">      <span class="comment"># https://docs.docker.com/compose/networking/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=docker_test</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FABRIC_LOGGING_SPEC=INFO</span></span><br><span class="line">      <span class="comment">#- FABRIC_LOGGING_SPEC=DEBUG</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_PROFILE_ENABLED=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span></span><br><span class="line">      <span class="comment"># Peer specific variabes</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ID=peer0.s2.supply.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_ADDRESS=peer0.s2.supply.com:8151</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_LISTENADDRESS=0.0.0.0:8151</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_CHAINCODEADDRESS=peer0.s2.supply.com:8152</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0:8152</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.s2.supply.com:8151</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_GOSSIP_BOOTSTRAP=peer0.s2.supply.com:8151</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">CORE_PEER_LOCALMSPID=GylSOrg2MSP</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/run/:/host/var/run/</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/msp:/etc/hyperledger/fabric/msp</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls:/etc/hyperledger/fabric/tls</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">../organizations:/tmp</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">peer0.s2.supply.com:/var/hyperledger/production</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/opt/gopath/src/github.com/hyperledger/fabric/peer</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">peer</span> <span class="string">node</span> <span class="string">start</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8151</span><span class="string">:8151</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">test</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨docker-compose-ymlé…ç½®æ–‡ä»¶å¯åŠ¨å„ç»„ç»‡çš„æœåŠ¡">ä½¿ç”¨docker-compose.ymlé…ç½®æ–‡ä»¶å¯åŠ¨å„ç»„ç»‡çš„æœåŠ¡</h3><p>å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f ./docker/docker-compose.yml up -d</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ä¹‹åä¼šåœ¨dockerå¯åŠ¨ä¸‹é¢è¿™äº›å®¹å™¨ï¼š</p><ul><li><a href="http://orderer.supply.com">orderer.supply.com</a>:æ’åºèŠ‚ç‚¹</li><li><a href="http://peer0.core.supply.com">peer0.core.supply.com</a>:æ ¸å¿ƒä¼ä¸šèŠ‚ç‚¹</li><li><a href="http://peer0.f1.supply.com">peer0.f1.supply.com</a>:ä¸€çº§ä¾›åº”å•†èŠ‚ç‚¹</li><li><a href="http://peer0.s1.supply.com">peer0.s1.supply.com</a>:äºŒçº§ä¾›åº”å•†1èŠ‚ç‚¹</li><li><a href="http://peer0.s2.supply.com">peer0.s2.supply.com</a>:äºŒçº§ä¾›åº”å•†2èŠ‚ç‚¹</li></ul>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> ä¾›åº”é“¾é‡‘è </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> ä¾›åº”é“¾é‡‘è </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ›å»ºchannel</title>
      <link href="2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E5%88%9B%E5%BB%BAchannel/"/>
      <url>2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E5%88%9B%E5%BB%BAchannel/</url>
      
        <content type="html"><![CDATA[<h2 id="2-åˆ›å»ºChannel">2. åˆ›å»ºChannel</h2><p>å‚è€ƒï¼š<a href="https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84channel/">åˆ›å»ºä¸€ä¸ªæ–°çš„channel</a></p><h3 id="åˆ›å»ºé€šé“ï¼š">åˆ›å»ºé€šé“ï¼š</h3><p>è¿è¡Œä¸‹é¢çš„ç¨‹åºæ¥ä¸º<code>coreandfirstchannel</code>é€šé“åˆ›å»ºä¸€ä¸ªâ€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configtxgen -profile CoreAndFirstChannel -outputCreateChannelTx ./channel-artifacts/coreandfirstchannel.tx -channelID coreandfirstchannel</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2020-12-24 14:29:40.728 CST [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2020-12-24 14:29:40.739 CST [common.tools.configtxgen.localconfig] Load -&gt; INFO 002 Loaded configuration: /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/configtx/configtx.yaml</span><br><span class="line">2020-12-24 14:29:40.739 CST [common.tools.configtxgen] doOutputChannelCreateTx -&gt; INFO 003 Generating new channel configtx</span><br><span class="line">2020-12-24 14:29:40.750 CST [common.tools.configtxgen] doOutputChannelCreateTx -&gt; INFO 004 Writing new channel tx</span><br></pre></td></tr></table></figure><p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä»¥æ ¸å¿ƒä¼ä¸š(<a href="http://core.supply.com">core.supply.com</a>)ç®¡ç†å‘˜èº«ä»½æ“ä½œ<code>peer</code>CLI;ç„¶åä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŠŠäº¤æ˜“å‘ç»™orderæœåŠ¡åˆ›å»ºé€šé“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel create -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com -c coreandfirstchannel -f ./channel-artifacts/coreandfirstchannel.tx --outputBlock ./channel-artifacts/coreandfirstchannel.block --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p>æ­£ç¡®æ‰§è¡Œä¹‹åçš„æ—¥å¿—ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">2020-12-24 15:59:28.470 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2020-12-24 15:59:28.490 CST [cli.common] readBlock -&gt; INFO 002 Expect block, but got status: &amp;&#123;NOT_FOUND&#125;</span><br><span class="line">2020-12-24 15:59:28.497 CST [channelCmd] InitCmdFactory -&gt; INFO 003 Endorser and orderer connections initialized</span><br><span class="line">2020-12-24 15:59:28.701 CST [cli.common] readBlock -&gt; INFO 004 Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;</span><br><span class="line">2020-12-24 15:59:28.708 CST [channelCmd] InitCmdFactory -&gt; INFO 005 Endorser and orderer connections initialized</span><br><span class="line">2020-12-24 15:59:28.917 CST [cli.common] readBlock -&gt; INFO 006 Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;</span><br><span class="line">2020-12-24 15:59:28.924 CST [channelCmd] InitCmdFactory -&gt; INFO 007 Endorser and orderer connections initialized</span><br><span class="line">2020-12-24 15:59:29.134 CST [cli.common] readBlock -&gt; INFO 008 Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;</span><br><span class="line">2020-12-24 15:59:29.141 CST [channelCmd] InitCmdFactory -&gt; INFO 009 Endorser and orderer connections initialized</span><br><span class="line">2020-12-24 15:59:29.349 CST [cli.common] readBlock -&gt; INFO 00a Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;</span><br><span class="line">2020-12-24 15:59:29.357 CST [channelCmd] InitCmdFactory -&gt; INFO 00b Endorser and orderer connections initialized</span><br><span class="line">2020-12-24 15:59:29.566 CST [cli.common] readBlock -&gt; INFO 00c Received block: 0</span><br></pre></td></tr></table></figure><p><strong>æŠ¥é”™ä¿¡æ¯è®°å½•ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(base) apple@WHOAMIdeMacBook-Pro:~/code/open-source/blockchain/hyperledger/supply-finance$     peer channel create -o localhost:8051  --ordererTLSHostnameOverride orderer.supply.com -c coreandfirstchannel -f ./channel-artifacts/coreandfirstchannel.tx --outputBlock ./channel-artifacts/coreandfirstchannel.block --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br><span class="line">2020-12-24 15:56:56.602 CST [comm.tls] ClientHandshake -&gt; ERRO 001 Client TLS handshake failed after 5.225381ms with error: x509: certificate is valid for peer0.core.supply.com, peer0, not orderer.supply.com remoteaddress=[::1]:8051</span><br><span class="line">2020-12-24 15:56:57.611 CST [comm.tls] ClientHandshake -&gt; ERRO 002 Client TLS handshake failed after 3.907471ms with error: x509: certificate is valid for peer0.core.supply.com, peer0, not orderer.supply.com remoteaddress=[::1]:8051</span><br><span class="line">2020-12-24 15:56:59.315 CST [comm.tls] ClientHandshake -&gt; ERRO 003 Client TLS handshake failed after 4.52302ms with error: x509: certificate is valid for peer0.core.supply.com, peer0, not orderer.supply.com remoteaddress=[::1]:8051</span><br><span class="line">Error: failed to create deliver client for orderer: orderer client failed to connect to localhost:8051: failed to create new connection: context deadline exceeded</span><br></pre></td></tr></table></figure><p><strong>é”™è¯¯åŸå› ï¼š</strong><code>peer channel create -o localhost:8051 </code>å‘½ä»¤<code>-o</code>åº”è¯¥ä¼ å…¥orderæœåŠ¡çš„åœ°å€å’Œç«¯å£ã€‚</p><h2 id="æŠŠæ ¸å¿ƒä¼ä¸šå’Œä¸€çº§ä¾›åº”å•†çš„peeråŠ å…¥é€šé“">æŠŠæ ¸å¿ƒä¼ä¸šå’Œä¸€çº§ä¾›åº”å•†çš„peeråŠ å…¥é€šé“</h2><h3 id="æ ¸å¿ƒä¼ä¸šçš„peeråŠ å…¥é€šé“">æ ¸å¿ƒä¼ä¸šçš„peeråŠ å…¥é€šé“</h3><p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°†æ ¸å¿ƒä¼ä¸šçš„peeråŠ å…¥é€šé“ï¼ˆç¡®è®¤å·²ç»è®¾ç½®äº†æ ¸å¿ƒä¼ä¸šçš„ç¯å¢ƒå˜é‡ï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel join -b ./channel-artifacts/coreandfirstchannel.block</span><br></pre></td></tr></table></figure><p>æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-24 16:46:40.206 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2020-12-24 16:46:40.235 CST [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel</span><br></pre></td></tr></table></figure><p><strong>æŠ¥é”™ä¿¡æ¯è®°å½•:</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(base) apple@WHOAMIdeMacBook-Pro:~/code/open-source/blockchain/hyperledger/supply-finance$     peer channel join -b ./channel-artifacts/coreandfirstchannel.block</span><br><span class="line">2020-12-24 16:18:23.258 CST [comm.tls] ClientHandshake -&gt; ERRO 001 Client TLS handshake failed after 2.895228ms with error: x509: certificate is valid for peer0.core.supply.com, peer0, not localhost remoteaddress=[::1]:8051</span><br><span class="line">2020-12-24 16:18:24.266 CST [comm.tls] ClientHandshake -&gt; ERRO 002 Client TLS handshake failed after 4.537447ms with error: x509: certificate is valid for peer0.core.supply.com, peer0, not localhost remoteaddress=[::1]:8051</span><br><span class="line">2020-12-24 16:18:25.659 CST [comm.tls] ClientHandshake -&gt; ERRO 003 Client TLS handshake failed after 4.16728ms with error: x509: certificate is valid for peer0.core.supply.com, peer0, not localhost remoteaddress=[::1]:8051</span><br><span class="line">Error: error getting endorser client for channel: endorser client failed to connect to localhost:8051: failed to create new connection: context deadline exceeded</span><br></pre></td></tr></table></figure><p>**é”™è¯¯åŸå› ï¼š**æœªçŸ¥ã€‚</p><p>**è§£å†³æ–¹å¼ï¼š**æŠŠProfilesé‡Œé¢çš„Organizationsä¿¡æ¯ç»Ÿä¸€ä¿®æ”¹ï¼Œä¸ç¯å¢ƒå˜é‡ä¿æŒä¸€è‡´</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Organizations:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="meta">*GylCoreOrg1MSP</span></span><br><span class="line">    <span class="bullet">-</span> <span class="meta">*GylFOrg1MSP</span></span><br><span class="line">    <span class="bullet">-</span> <span class="meta">*GylSOrg1MSP</span></span><br><span class="line">    <span class="bullet">-</span> <span class="meta">*GylSOrg2MSP</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠä¸Šé¢æ­¥éª¤ä¸­ç”Ÿæˆçš„åŠ å¯†ææ–™ä¿¡æ¯ã€åŒºå—ä¿¡æ¯éƒ½åˆ é™¤ï¼Œå®¹å™¨å’Œvolumeå…¨éƒ¨åˆ é™¤ï¼›é‡æ–°æ‰§è¡Œä¸€éã€‚</p><h3 id="é€šè¿‡è·å–é€šé“ä¿¡æ¯ç¡®è®¤åŠ å…¥æˆåŠŸ">é€šè¿‡è·å–é€šé“ä¿¡æ¯ç¡®è®¤åŠ å…¥æˆåŠŸ</h3><h4 id="è·å–é€šé“ä¿¡æ¯">è·å–é€šé“ä¿¡æ¯</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel getinfo -c coreandfirstchannel</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-24 16:53:01.633 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">Blockchain info: &#123;&quot;height&quot;:1,&quot;currentBlockHash&quot;:&quot;kXOOwW8prt0XPvgEGMDrzdt1nNH8T7qlObL9eT8FZ7c=&quot;&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸€çº§ä¾›åº”å•†åŠ å…¥é€šé“">ä¸€çº§ä¾›åº”å•†åŠ å…¥é€šé“</h3><p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œç„¶åæ‹‰å–é€šé“çš„åˆ›ä¸–çºªåŒºå—(å› ä¸ºæ˜¯æµ‹è¯•æœ¬æ¬¡å¿½ç•¥)ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch 0 ./channel-artifacts/coreandfirstchannel.block -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com -c coreandfirstchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p>åŠ å…¥é€šé“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel join -b ./channel-artifacts/coreandfirstchannel.block</span><br></pre></td></tr></table></figure><p>æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-24 17:06:30.499 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2020-12-24 17:06:30.527 CST [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel</span><br></pre></td></tr></table></figure><p><strong>æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(base) apple@WHOAMIdeMacBook-Pro:~/code/open-source/blockchain/hyperledger/supply-finance$     peer channel join -b ./channel-artifacts/coreandfirstchannel.block</span><br><span class="line">2020-12-24 17:01:05.904 CST [main] InitCmd -&gt; ERRO 001 Cannot run peer because cannot init crypto, specified path &quot;/Users/apple/code/open-source/blockchain/hyperledger/supply-finance/organizations/peerOrganizations/f1.supply.com/users/Admin@f1.supply.com/msp/organizations/peerOrganizations/f1.supply.com/users/Admin@f1.supply.com/msp&quot; does not exist or cannot be accessed: stat /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/organizations/peerOrganizations/f1.supply.com/users/Admin@f1.supply.com/msp/organizations/peerOrganizations/f1.supply.com/users/Admin@f1.supply.com/msp: no such file or directory</span><br></pre></td></tr></table></figure><p>**é”™è¯¯åŸå› ï¼š**å› ä¸ºåœ¨è®¾ç½®ç¯å¢ƒå˜é‡æ—¶ä¸æ˜¯åœ¨<code>supply-finance</code>ç›®å½•ä¸‹è®¾ç½®çš„ï¼Œæ‰€ä»¥è®¾ç½®çš„ç¯å¢ƒå˜é‡æœ‰é—®é¢˜ï¼Œé‡æ–°è®¾ç½®ä¸€ä¸‹ã€‚</p><h3 id="è®¾ç½®é”šèŠ‚ç‚¹">è®¾ç½®é”šèŠ‚ç‚¹</h3><h4 id="ä¸ºGylFOrg1MSPè®¾ç½®é”šèŠ‚ç‚¹">ä¸ºGylFOrg1MSPè®¾ç½®é”šèŠ‚ç‚¹</h4><p>å› ä¸ºä¸Šé¢å·²ç»è®¾ç½®äº†ä¸€çº§ä¾›åº”å•†ï¼ˆGylFOrg1MSPï¼‰çš„ç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥å…ˆè®¾ç½®GylFOrg1MSPçš„é”šèŠ‚ç‚¹ï¼š</p><h5 id="æ‹‰å–æœ€æ–°çš„channelé…ç½®åŒºå—">æ‹‰å–æœ€æ–°çš„channelé…ç½®åŒºå—</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch config channel-artifacts/coreandfirstchannel_config_block.pb -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c coreandfirstchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p>æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2020-12-24 17:56:48.435 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2020-12-24 17:56:48.439 CST [cli.common] readBlock -&gt; INFO 002 Received block: 0</span><br><span class="line">2020-12-24 17:56:48.439 CST [channelCmd] fetch -&gt; INFO 003 Retrieving last config block: 0</span><br><span class="line">2020-12-24 17:56:48.442 CST [cli.common] readBlock -&gt; INFO 004 Received block: 0</span><br></pre></td></tr></table></figure><h5 id="ä¿®æ”¹é€šé“é…ç½®åŒºå—">ä¿®æ”¹é€šé“é…ç½®åŒºå—</h5><p>åˆ‡æ¢åˆ°<code>channel-artifacts</code>ç„¶åæŠŠåŒºå—å†…å®¹è½¬æ¢æˆjsonæ ¼å¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd channel-artifacts</span><br><span class="line">configtxlator proto_decode --input coreandfirstchannel_config_block.pb --type common.Block --output coreandfirstchannel_config_block.json</span><br><span class="line">jq .data.data[0].payload.data.config coreandfirstchannel_config_block.json &gt; coreandfirstchannel_config.json</span><br><span class="line"><span class="meta">#</span><span class="bash"> copyä¸€ä»½</span></span><br><span class="line">cp coreandfirstchannel_config.json coreandfirstchannel_config_copy.json</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>jq</code> å·¥å…·æ¥æ·»åŠ GylFOrg1MSPç»„ç»‡çš„é”šèŠ‚ç‚¹åˆ°é€šé“é…ç½®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jq &#x27;.channel_group.groups.Application.groups.GylFOrg1MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.f1.supply.com&quot;,&quot;port&quot;: 8053&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; coreandfirstchannel_config_copy.json &gt; modified_coreandfirstchannel_config.json</span><br></pre></td></tr></table></figure><p>å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_encode --input coreandfirstchannel_config.json --type common.Config --output coreandfirstchannel_config.pb</span><br><span class="line">configtxlator proto_encode --input modified_coreandfirstchannel_config.json --type common.Config --output modified_coreandfirstchannel_config.pb</span><br><span class="line">configtxlator compute_update --channel_id coreandfirstchannel --original coreandfirstchannel_config.pb --updated modified_coreandfirstchannel_config.pb --output coreandfirstchannel_config_update.pb</span><br></pre></td></tr></table></figure><h5 id="æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼š">æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_decode --input coreandfirstchannel_config_update.pb --type common.ConfigUpdate --output coreandfirstchannel_config_update.json</span><br><span class="line">echo &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;coreandfirstchannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat coreandfirstchannel_config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; coreandfirstchannel_config_update_in_envelope.json</span><br><span class="line">configtxlator proto_encode --input coreandfirstchannel_config_update_in_envelope.json --type common.Envelope --output coreandfirstchannel_config_update_in_envelope.pb</span><br></pre></td></tr></table></figure><h5 id="æäº¤â€œæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“â€">æäº¤â€œæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“â€</h5><p>è¿›åˆ°ä¸Šä¸€çº§ç›®å½•<code>cd ..</code>ï¼Œä¹‹åè¿è¡Œå‘½ä»¤å°†äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡è¿›è¡Œé€šé“é…ç½®çš„æ›´æ–°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ..</span><br><span class="line">peer channel update -f channel-artifacts/coreandfirstchannel_config_update_in_envelope.pb -c coreandfirstchannel -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p>æ‰§è¡ŒæˆåŠŸçš„ç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-24 18:13:59.246 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2020-12-24 18:13:59.265 CST [channelCmd] update -&gt; INFO 002 Successfully submitted channel update</span><br></pre></td></tr></table></figure><p><strong>é”™è¯¯ä¿¡æ¯è®°å½•ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-24 18:12:49.469 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">Error: got unexpected status: BAD_REQUEST -- error applying config update to existing channel &#x27;coreandfirstchannel&#x27;: error authorizing update: ConfigUpdate for channel &#x27;channel1&#x27; but envelope for channel &#x27;coreandfirstchannel&#x27;</span><br></pre></td></tr></table></figure><p>**é”™è¯¯åŸå› ï¼š**åœ¨ä¿®æ”¹é…ç½®çš„æ—¶å€™æŒ‡å®šchannelåç§°é”™è¯¯ï¼Œä¿®æ­£é‡æ–°æ‰§è¡Œä¸€éã€‚</p><h5 id="éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯-peer-channel-getinfo-c-coreandfirstchannel">éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯:<code>peer channel getinfo -c coreandfirstchannel</code></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">supply-finance$</span><span class="bash">     peer channel getinfo -c coreandfirstchannel</span></span><br><span class="line">2020-12-24 18:19:31.275 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">Blockchain info: &#123;&quot;height&quot;:2,&quot;currentBlockHash&quot;:&quot;h5CY6RfVNNg8kYWPZ+tZqdMIrGoXeoDSQFd0YfiBhRk=&quot;,&quot;previousBlockHash&quot;:&quot;kXOOwW8prt0XPvgEGMDrzdt1nNH8T7qlObL9eT8FZ7c=&quot;&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸ºæ ¸å¿ƒä¼ä¸šGylCoreOrg1MSPè®¾ç½®é”šèŠ‚ç‚¹">ä¸ºæ ¸å¿ƒä¼ä¸šGylCoreOrg1MSPè®¾ç½®é”šèŠ‚ç‚¹</h4><p>ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œç„¶åæ‹‰å–æœ€æ–°çš„channelé…ç½®åŒºå—</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch config channel-artifacts/coreandfirstchannel_config_block.pb -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c coreandfirstchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><h5 id="ä¿®æ”¹é€šé“é…ç½®åŒºå—-v2">ä¿®æ”¹é€šé“é…ç½®åŒºå—</h5><p>åˆ‡æ¢åˆ°<code>channel-artifacts</code>ç„¶åæŠŠåŒºå—å†…å®¹è½¬æ¢æˆjsonæ ¼å¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd channel-artifacts</span><br><span class="line">configtxlator proto_decode --input coreandfirstchannel_config_block.pb --type common.Block --output coreandfirstchannel_config_block.json</span><br><span class="line">jq .data.data[0].payload.data.config coreandfirstchannel_config_block.json &gt; coreandfirstchannel_config.json</span><br><span class="line"><span class="meta">#</span><span class="bash"> copyä¸€ä»½</span></span><br><span class="line">cp coreandfirstchannel_config.json coreandfirstchannel_config_copy.json</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>jq</code> å·¥å…·æ¥æ·»åŠ GylCoreOrg1MSPç»„ç»‡çš„é”šèŠ‚ç‚¹åˆ°é€šé“é…ç½®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jq &#x27;.channel_group.groups.Application.groups.GylCoreOrg1MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.core.supply.com&quot;,&quot;port&quot;: 8051&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; coreandfirstchannel_config_copy.json &gt; modified_coreandfirstchannel_config.json</span><br></pre></td></tr></table></figure><p>å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_encode --input coreandfirstchannel_config.json --type common.Config --output coreandfirstchannel_config.pb</span><br><span class="line">configtxlator proto_encode --input modified_coreandfirstchannel_config.json --type common.Config --output modified_coreandfirstchannel_config.pb</span><br><span class="line">configtxlator compute_update --channel_id coreandfirstchannel --original coreandfirstchannel_config.pb --updated modified_coreandfirstchannel_config.pb --output coreandfirstchannel_config_update.pb</span><br></pre></td></tr></table></figure><h5 id="æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼š-v2">æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_decode --input coreandfirstchannel_config_update.pb --type common.ConfigUpdate --output coreandfirstchannel_config_update.json</span><br><span class="line">echo &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;coreandfirstchannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat coreandfirstchannel_config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; coreandfirstchannel_config_update_in_envelope.json</span><br><span class="line">configtxlator proto_encode --input coreandfirstchannel_config_update_in_envelope.json --type common.Envelope --output coreandfirstchannel_config_update_in_envelope.pb</span><br></pre></td></tr></table></figure><h5 id="æäº¤â€œæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“â€-v2">æäº¤â€œæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“â€</h5><p>è¿›åˆ°ä¸Šä¸€çº§ç›®å½•<code>cd ..</code>ï¼Œä¹‹åè¿è¡Œå‘½ä»¤å°†äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡è¿›è¡Œé€šé“é…ç½®çš„æ›´æ–°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ..</span><br><span class="line">peer channel update -f channel-artifacts/coreandfirstchannel_config_update_in_envelope.pb -c coreandfirstchannel -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p>æ‰§è¡ŒæˆåŠŸçš„ç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-24 18:13:59.246 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2020-12-24 18:13:59.265 CST [channelCmd] update -&gt; INFO 002 Successfully submitted channel update</span><br></pre></td></tr></table></figure><h5 id="éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯">éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> peer channel getinfo -c coreandfirstchannel</span></span><br><span class="line">2020-12-24 18:24:51.015 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">Blockchain info: &#123;&quot;height&quot;:3,&quot;currentBlockHash&quot;:&quot;e52oT2HAiTxyeh4a30kTx32xLJAKIWa7rm6PVOn8eoA=&quot;,&quot;previousBlockHash&quot;:&quot;h5CY6RfVNNg8kYWPZ+tZqdMIrGoXeoDSQFd0YfiBhRk=&quot;&#125;</span><br></pre></td></tr></table></figure><h2 id="éƒ¨ç½²æµ‹è¯•chaincodeæ¥ç¡®è®¤">éƒ¨ç½²æµ‹è¯•chaincodeæ¥ç¡®è®¤</h2><h3 id="æ‰“åŒ…">æ‰“åŒ…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode package basic.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/fabric-samples/asset-transfer-basic/chaincode-go/ --lang golang --label basic_1.0</span><br></pre></td></tr></table></figure><p>è¿è¡Œå®Œä¸Šé¢çš„å‘½ä»¤ï¼ŒæŸ¥çœ‹å½“å‰ç›®å½•ä¼šå‘ç°å¤šäº†<code>basic.tar.gz</code>åŒ…ï¼Œè¯´æ˜æ‰“åŒ…æˆåŠŸã€‚</p><h3 id="å®‰è£…é“¾ç åŒ…">å®‰è£…é“¾ç åŒ…</h3><p>ä¸€çº§ä¾›åº”å•†å’Œæ ¸å¿ƒä¼ä¸šéƒ½è¦å®‰è£…ï¼š<br>æ ¸å¿ƒä¼ä¸šï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode install basic.tar.gz --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>ä¸€çº§ä¾›åº”å•†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode install basic.tar.gz --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>å®‰è£…æˆåŠŸè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-24 18:51:45.793 CST [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 001 Installed remotely: response:&lt;status:200 payload:&quot;\nJbasic_1.0:4ec191e793b27e953ff2ede5a8bcc63152cecb1e4c3f301a26e22692c61967ad\022\tbasic_1.0&quot; &gt;</span><br><span class="line">2020-12-24 18:51:45.793 CST [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 002 Chaincode code package identifier: basic_1.0:4ec191e793b27e953ff2ede5a8bcc63152cecb1e4c3f301a26e22692c61967ad</span><br></pre></td></tr></table></figure><h3 id="æ‰¹å‡†é“¾ç å®šä¹‰">æ‰¹å‡†é“¾ç å®šä¹‰</h3><h4 id="æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode">æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode queryinstalled</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Installed chaincodes on peer:</span><br><span class="line">Package ID: basic_1.0:4ec191e793b27e953ff2ede5a8bcc63152cecb1e4c3f301a26e22692c61967ad, Label: basic_1.0</span><br></pre></td></tr></table></figure><p>å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export CC_PACKAGE_ID=basic_1.0:4ec191e793b27e953ff2ede5a8bcc63152cecb1e4c3f301a26e22692c61967ad</span><br></pre></td></tr></table></figure><h4 id="æ‰¹å‡†é“¾ç å®šä¹‰-v2">æ‰¹å‡†é“¾ç å®šä¹‰</h4><p>æ ¸å¿ƒä¼ä¸šå’Œä¸€çº§ä¾›åº”å•†éƒ½éœ€è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode approveformyorg -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name basic --version 1.0 --package-id $CC_PACKAGE_ID --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2020-12-24 19:02:47.351 CST [chaincodeCmd] ClientWait -&gt; INFO 001 txid [d7e2224f63a1516ffeeed26ec5c8f69872141f5864b3602a1409679472692840] committed with status (VALID) at localhost:8051</span><br></pre></td></tr></table></figure><h3 id="å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“">å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“</h3><p>æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode checkcommitreadiness --channelID coreandfirstchannel --name basic --version 1.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;approvals&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;GylCoreOrg1MSP&quot;</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">&quot;GylFOrg1MSP&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸¤ä¸ªç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode commit -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name basic --version 1.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-24 19:10:18.071 CST [chaincodeCmd] ClientWait -&gt; INFO 001 txid [5b363e2e419dbb1307726fe44428e23ae1b0e5feaf86cb577383b6e8a68464d6] committed with status (VALID) at localhost:8053</span><br><span class="line">2020-12-24 19:10:18.094 CST [chaincodeCmd] ClientWait -&gt; INFO 002 txid [5b363e2e419dbb1307726fe44428e23ae1b0e5feaf86cb577383b6e8a68464d6] committed with status (VALID) at localhost:8051</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-querycommitted">peer lifecycle chaincode querycommitted</a> å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode querycommitted --channelID coreandfirstchannel --name basic --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Committed chaincode definition for chaincode &#x27;basic&#x27; on channel &#x27;coreandfirstchannel&#x27;:</span><br><span class="line">Version: 1.0, Sequence: 1, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [GylCoreOrg1MSP: true, GylFOrg1MSP: true]</span><br></pre></td></tr></table></figure><h3 id="è°ƒç”¨é“¾ç ">è°ƒç”¨é“¾ç </h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C coreandfirstchannel -n basic --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;InitLedger&quot;,&quot;Args&quot;:[]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>æˆåŠŸä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2020-12-25 17:26:22.583 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200</span><br></pre></td></tr></table></figure><h4 id="æŸ¥è¯¢è°ƒç”¨åçš„ç»“æœ">æŸ¥è¯¢è°ƒç”¨åçš„ç»“æœ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -C coreandfirstchannel -n basic -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>æˆåŠŸç»“æœå¦‚ä¸‹,è¯´æ˜channeléƒ¨ç½²æˆåŠŸï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;&quot;ID&quot;:&quot;asset1&quot;,&quot;color&quot;:&quot;blue&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Tomoko&quot;,&quot;appraisedValue&quot;:300&#125;,&#123;&quot;ID&quot;:&quot;asset2&quot;,&quot;color&quot;:&quot;red&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Brad&quot;,&quot;appraisedValue&quot;:400&#125;,&#123;&quot;ID&quot;:&quot;asset3&quot;,&quot;color&quot;:&quot;green&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Jin Soo&quot;,&quot;appraisedValue&quot;:500&#125;,&#123;&quot;ID&quot;:&quot;asset4&quot;,&quot;color&quot;:&quot;yellow&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Max&quot;,&quot;appraisedValue&quot;:600&#125;,&#123;&quot;ID&quot;:&quot;asset5&quot;,&quot;color&quot;:&quot;black&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Adriana&quot;,&quot;appraisedValue&quot;:700&#125;,&#123;&quot;ID&quot;:&quot;asset6&quot;,&quot;color&quot;:&quot;white&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Michel&quot;,&quot;appraisedValue&quot;:800&#125;]</span><br></pre></td></tr></table></figure><p><strong>é”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: endorsement failure during invoke. response: status:500 message:&quot;error in simulation: failed to execute transaction 207cf99d289ffe9deca6a320aba59cc155fae02d19d51c9cfebc9943ffc7794d: could not launch chaincode basic_1.0:4ec191e793b27e953ff2ede5a8bcc63152cecb1e4c3f301a26e22692c61967ad: error starting container: error starting container: API error (404): network _test not found&quot;</span><br></pre></td></tr></table></figure><p>**é”™è¯¯åŸå› ï¼š**å› ä¸ºchaincodeçš„å®¹å™¨æ²¡æœ‰å¯åŠ¨æˆåŠŸ,ç›´æ¥æŒ‡å®šå®¹å™¨å¯åŠ¨æŠ¥é”™å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/guozhe001/images/raw/master/image-20201224192439225.png" alt="image-20201224192439225"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">/supply-finance$</span><span class="bash">     docker start bc47970e58a5</span></span><br><span class="line">Error response from daemon: network _test not found</span><br><span class="line">Error: failed to start containers: bc47970e58a5</span><br></pre></td></tr></table></figure><p><strong>é—®é¢˜è§£å†³ï¼š</strong></p><p>å› ä¸ºåœ¨<code>docker-compose.yml</code>æ–‡ä»¶ä¸­é…ç½®äº†ä¸‹é¢çš„ç¯å¢ƒå˜é‡ï¼Œåœ¨å¯åŠ¨chaincodeå®¹å™¨æ—¶ä¼šé“¾æ¥åˆ°è¿™ä¸ªç½‘ç»œã€‚</p><p>ä¹‹å‰çš„é…ç½®æ˜¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=$&#123;COMPOSE_PROJECT_NAME&#125;_test</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹åé‡æ–°å¯åŠ¨ï¼Œé—®é¢˜è§£å†³ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE&#x3D;docker_test</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆä¿®æ”¹æˆdocker_testå‘¢ï¼Œå¯ä»¥æŸ¥çœ‹ä½¿ç”¨<code>docker-compose</code>å‘½ä»¤å¯åŠ¨å®¹å™¨æ—¶çš„æ—¥å¿—ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Creating network &quot;docker_test&quot; with the default driver</span><br></pre></td></tr></table></figure><h2 id="æ ¸å¿ƒä¼ä¸šã€ä¸€çº§å’ŒäºŒçº§ä¾›åº”å•†åŠ å…¥åŒä¸€ä¸ªchannel">æ ¸å¿ƒä¼ä¸šã€ä¸€çº§å’ŒäºŒçº§ä¾›åº”å•†åŠ å…¥åŒä¸€ä¸ªchannel</h2><h3 id="åˆ›å»ºé€šé“ï¼š-v2">åˆ›å»ºé€šé“ï¼š</h3><p>è¿è¡Œä¸‹é¢çš„ç¨‹åºæ¥ä¸º<code>alljoinchannel</code>é€šé“åˆ›å»ºä¸€ä¸ªâ€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configtxgen -profile AllPlayChannel -outputCreateChannelTx ./channel-artifacts/alljoinchannel.tx -channelID alljoinchannel</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŠŠäº¤æ˜“å‘ç»™orderæœåŠ¡åˆ›å»ºé€šé“ï¼š</span></span><br><span class="line">peer channel create -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com -c alljoinchannel -f ./channel-artifacts/alljoinchannel.tx --outputBlock ./channel-artifacts/alljoinchannel.block --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br></pre></td></tr></table></figure><h2 id="åŠ å…¥é€šé“">åŠ å…¥é€šé“</h2><p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°†peeråŠ å…¥é€šé“,æ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦æ‰§è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">peer channel join -b ./channel-artifacts/alljoinchannel.block</span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡è·å–é€šé“ä¿¡æ¯ç¡®è®¤åŠ å…¥æˆåŠŸ</span></span><br><span class="line">peer channel getinfo -c alljoinchannel</span><br></pre></td></tr></table></figure><h2 id="ä¸ºå„ä¸ªç»„ç»‡è®¾ç½®é”šèŠ‚ç‚¹">ä¸ºå„ä¸ªç»„ç»‡è®¾ç½®é”šèŠ‚ç‚¹</h2><h3 id="GylCoreOrg1MSP">GylCoreOrg1MSP</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch config channel-artifacts/alljoinchannel_config_block.pb -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c alljoinchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ‡æ¢åˆ°`channel-artifacts`ç„¶åæŠŠåŒºå—å†…å®¹è½¬æ¢æˆjsonæ ¼å¼ï¼š</span></span><br><span class="line">cd channel-artifacts</span><br><span class="line">configtxlator proto_decode --input alljoinchannel_config_block.pb --type common.Block --output alljoinchannel_config_block.json</span><br><span class="line">jq .data.data[0].payload.data.config alljoinchannel_config_block.json &gt; alljoinchannel_config.json</span><br><span class="line">cp alljoinchannel_config.json alljoinchannel_config_copy.json</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨`jq`å·¥å…·æ·»åŠ å„ä¸ªç»„ç»‡çš„é”šèŠ‚ç‚¹é…ç½®</span></span><br><span class="line">jq &#x27;.channel_group.groups.Application.groups.GylCoreOrg1MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.core.supply.com&quot;,&quot;port&quot;: 8051&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; alljoinchannel_config_copy.json &gt; modified_alljoinchannel_config.json</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚</span></span><br><span class="line">configtxlator proto_encode --input alljoinchannel_config.json --type common.Config --output alljoinchannel_config.pb</span><br><span class="line">configtxlator proto_encode --input modified_alljoinchannel_config.json --type common.Config --output modified_alljoinchannel_config.pb</span><br><span class="line">configtxlator compute_update --channel_id alljoinchannel --original alljoinchannel_config.pb --updated modified_alljoinchannel_config.pb --output alljoinchannel_config_update.pb</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼š</span></span><br><span class="line">configtxlator proto_decode --input alljoinchannel_config_update.pb --type common.ConfigUpdate --output alljoinchannel_config_update.json</span><br><span class="line">echo &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;alljoinchannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat alljoinchannel_config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; alljoinchannel_config_update_in_envelope.json</span><br><span class="line">configtxlator proto_encode --input alljoinchannel_config_update_in_envelope.json --type common.Envelope --output alljoinchannel_config_update_in_envelope.pb</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¿›åˆ°ä¸Šä¸€çº§ç›®å½•`<span class="built_in">cd</span> ..`ï¼Œä¹‹åè¿è¡Œå‘½ä»¤å°†äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡è¿›è¡Œé€šé“é…ç½®çš„æ›´æ–°ï¼š</span></span><br><span class="line">cd ..</span><br><span class="line">peer channel update -f channel-artifacts/alljoinchannel_config_update_in_envelope.pb -c alljoinchannel -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br><span class="line"><span class="meta">#</span><span class="bash"> éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯:</span></span><br><span class="line">peer channel getinfo -c alljoinchannel</span><br></pre></td></tr></table></figure><h3 id="GylFOrg1MSP">GylFOrg1MSP</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch config channel-artifacts/alljoinchannel_config_block.pb -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c alljoinchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ‡æ¢åˆ°`channel-artifacts`ç„¶åæŠŠåŒºå—å†…å®¹è½¬æ¢æˆjsonæ ¼å¼ï¼š</span></span><br><span class="line">cd channel-artifacts</span><br><span class="line">configtxlator proto_decode --input alljoinchannel_config_block.pb --type common.Block --output alljoinchannel_config_block.json</span><br><span class="line">jq .data.data[0].payload.data.config alljoinchannel_config_block.json &gt; alljoinchannel_config.json</span><br><span class="line">cp alljoinchannel_config.json alljoinchannel_config_copy.json</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨`jq`å·¥å…·æ·»åŠ å„ä¸ªç»„ç»‡çš„é”šèŠ‚ç‚¹é…ç½®</span></span><br><span class="line">jq &#x27;.channel_group.groups.Application.groups.GylFOrg1MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.f1.supply.com&quot;,&quot;port&quot;: 8053&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; alljoinchannel_config_copy.json &gt; modified_alljoinchannel_config.json</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚</span></span><br><span class="line">configtxlator proto_encode --input alljoinchannel_config.json --type common.Config --output alljoinchannel_config.pb</span><br><span class="line">configtxlator proto_encode --input modified_alljoinchannel_config.json --type common.Config --output modified_alljoinchannel_config.pb</span><br><span class="line">configtxlator compute_update --channel_id alljoinchannel --original alljoinchannel_config.pb --updated modified_alljoinchannel_config.pb --output alljoinchannel_config_update.pb</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼š</span></span><br><span class="line">configtxlator proto_decode --input alljoinchannel_config_update.pb --type common.ConfigUpdate --output alljoinchannel_config_update.json</span><br><span class="line">echo &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;alljoinchannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat alljoinchannel_config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; alljoinchannel_config_update_in_envelope.json</span><br><span class="line">configtxlator proto_encode --input alljoinchannel_config_update_in_envelope.json --type common.Envelope --output alljoinchannel_config_update_in_envelope.pb</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¿›åˆ°ä¸Šä¸€çº§ç›®å½•`<span class="built_in">cd</span> ..`ï¼Œä¹‹åè¿è¡Œå‘½ä»¤å°†äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡è¿›è¡Œé€šé“é…ç½®çš„æ›´æ–°ï¼š</span></span><br><span class="line">cd ..</span><br><span class="line">peer channel update -f channel-artifacts/alljoinchannel_config_update_in_envelope.pb -c alljoinchannel -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br><span class="line"><span class="meta">#</span><span class="bash"> éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯:</span></span><br><span class="line">peer channel getinfo -c alljoinchannel</span><br></pre></td></tr></table></figure><h3 id="GylSOrg1MSP">GylSOrg1MSP</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch config channel-artifacts/alljoinchannel_config_block.pb -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c alljoinchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ‡æ¢åˆ°`channel-artifacts`ç„¶åæŠŠåŒºå—å†…å®¹è½¬æ¢æˆjsonæ ¼å¼ï¼š</span></span><br><span class="line">cd channel-artifacts</span><br><span class="line">configtxlator proto_decode --input alljoinchannel_config_block.pb --type common.Block --output alljoinchannel_config_block.json</span><br><span class="line">jq .data.data[0].payload.data.config alljoinchannel_config_block.json &gt; alljoinchannel_config.json</span><br><span class="line">cp alljoinchannel_config.json alljoinchannel_config_copy.json</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨`jq`å·¥å…·æ·»åŠ å„ä¸ªç»„ç»‡çš„é”šèŠ‚ç‚¹é…ç½®</span></span><br><span class="line">jq &#x27;.channel_group.groups.Application.groups.GylSOrg1MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.s1.supply.com&quot;,&quot;port&quot;: 8055&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; alljoinchannel_config_copy.json &gt; modified_alljoinchannel_config.json</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚</span></span><br><span class="line">configtxlator proto_encode --input alljoinchannel_config.json --type common.Config --output alljoinchannel_config.pb</span><br><span class="line">configtxlator proto_encode --input modified_alljoinchannel_config.json --type common.Config --output modified_alljoinchannel_config.pb</span><br><span class="line">configtxlator compute_update --channel_id alljoinchannel --original alljoinchannel_config.pb --updated modified_alljoinchannel_config.pb --output alljoinchannel_config_update.pb</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼š</span></span><br><span class="line">configtxlator proto_decode --input alljoinchannel_config_update.pb --type common.ConfigUpdate --output alljoinchannel_config_update.json</span><br><span class="line">echo &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;alljoinchannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat alljoinchannel_config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; alljoinchannel_config_update_in_envelope.json</span><br><span class="line">configtxlator proto_encode --input alljoinchannel_config_update_in_envelope.json --type common.Envelope --output alljoinchannel_config_update_in_envelope.pb</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¿›åˆ°ä¸Šä¸€çº§ç›®å½•`<span class="built_in">cd</span> ..`ï¼Œä¹‹åè¿è¡Œå‘½ä»¤å°†äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡è¿›è¡Œé€šé“é…ç½®çš„æ›´æ–°ï¼š</span></span><br><span class="line">cd ..</span><br><span class="line">peer channel update -f channel-artifacts/alljoinchannel_config_update_in_envelope.pb -c alljoinchannel -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br><span class="line"><span class="meta">#</span><span class="bash"> éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯:</span></span><br><span class="line">peer channel getinfo -c alljoinchannel</span><br></pre></td></tr></table></figure><h3 id="GylSOrg1MSP-v2">GylSOrg1MSP</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch config channel-artifacts/alljoinchannel_config_block.pb -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c alljoinchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ‡æ¢åˆ°`channel-artifacts`ç„¶åæŠŠåŒºå—å†…å®¹è½¬æ¢æˆjsonæ ¼å¼ï¼š</span></span><br><span class="line">cd channel-artifacts</span><br><span class="line">configtxlator proto_decode --input alljoinchannel_config_block.pb --type common.Block --output alljoinchannel_config_block.json</span><br><span class="line">jq .data.data[0].payload.data.config alljoinchannel_config_block.json &gt; alljoinchannel_config.json</span><br><span class="line">cp alljoinchannel_config.json alljoinchannel_config_copy.json</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨`jq`å·¥å…·æ·»åŠ å„ä¸ªç»„ç»‡çš„é”šèŠ‚ç‚¹é…ç½®</span></span><br><span class="line">jq &#x27;.channel_group.groups.Application.groups.GylSOrg2MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.s2.supply.com&quot;,&quot;port&quot;: 8151&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; alljoinchannel_config_copy.json &gt; modified_alljoinchannel_config.json</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚</span></span><br><span class="line">configtxlator proto_encode --input alljoinchannel_config.json --type common.Config --output alljoinchannel_config.pb</span><br><span class="line">configtxlator proto_encode --input modified_alljoinchannel_config.json --type common.Config --output modified_alljoinchannel_config.pb</span><br><span class="line">configtxlator compute_update --channel_id alljoinchannel --original alljoinchannel_config.pb --updated modified_alljoinchannel_config.pb --output alljoinchannel_config_update.pb</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼š</span></span><br><span class="line">configtxlator proto_decode --input alljoinchannel_config_update.pb --type common.ConfigUpdate --output alljoinchannel_config_update.json</span><br><span class="line">echo &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;alljoinchannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat alljoinchannel_config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; alljoinchannel_config_update_in_envelope.json</span><br><span class="line">configtxlator proto_encode --input alljoinchannel_config_update_in_envelope.json --type common.Envelope --output alljoinchannel_config_update_in_envelope.pb</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¿›åˆ°ä¸Šä¸€çº§ç›®å½•`<span class="built_in">cd</span> ..`ï¼Œä¹‹åè¿è¡Œå‘½ä»¤å°†äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡è¿›è¡Œé€šé“é…ç½®çš„æ›´æ–°ï¼š</span></span><br><span class="line">cd ..</span><br><span class="line">peer channel update -f channel-artifacts/alljoinchannel_config_update_in_envelope.pb -c alljoinchannel -o localhost:8050  --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem</span><br><span class="line"><span class="meta">#</span><span class="bash"> éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯:</span></span><br><span class="line">peer channel getinfo -c alljoinchannel</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> ä¾›åº”é“¾é‡‘è </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> channel </tag>
            
            <tag> ä¾›åº”é“¾é‡‘è </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>fabricå‘½ä»¤è®°å½•.md</title>
      <link href="2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/fabric%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/"/>
      <url>2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/fabric%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> ä¾›åº”é“¾é‡‘è </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SUMMARY-ä¾›åº”é“¾é‡‘è</title>
      <link href="2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/summary/"/>
      <url>2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/summary/</url>
      
        <content type="html"><![CDATA[<h2 id="é¡¹ç›®èƒŒæ™¯">é¡¹ç›®èƒŒæ™¯</h2><p>ä¸ºäº†å­¦ä¹ Fabricï¼Œæ¨¡æ‹Ÿæ­å»ºä¸€ä¸ªä¾›åº”é“¾é‡‘èçš„åŒºå—é“¾é¡¹ç›®ã€‚</p><p>ä¸ºäº†ç®€å•èµ·è§ï¼Œæ­¤é¡¹ç›®æœ‰ä»¥ä¸‹å››ä¸ªç»„ç»‡ï¼š</p><ul><li>æ ¸å¿ƒä¼ä¸š</li><li>ä¸€çº§ä¾›åº”å•†</li><li>äºŒçº§ä¾›åº”å•†1</li><li>äºŒçº§ä¾›åº”å•†2</li></ul><h2 id="æ“ä½œæ­¥éª¤ï¼š">æ“ä½œæ­¥éª¤ï¼š</h2><ol start="0"><li><a href="https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/">è®¾ç½®ç¯å¢ƒå˜é‡</a></li><li><a href="https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E5%88%9B%E5%BB%BA%E7%BD%91%E7%BB%9C/">åˆ›å»ºç½‘ç»œ</a></li><li><a href="https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E5%88%9B%E5%BB%BAchannel/">åˆ›å»ºchannel</a></li><li><a href="https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E5%BC%80%E5%8F%91%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/">å¼€å‘æ™ºèƒ½åˆçº¦</a></li><li><a href="https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E9%83%A8%E7%BD%B2%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%88%B0channel/">éƒ¨ç½²æ™ºèƒ½åˆçº¦åˆ°channelå¹¶è¿›è¡Œäº¤æ˜“</a></li><li>[äº¤æ˜“ä¸éªŒè¯](file://éƒ¨ç½²æ™ºèƒ½åˆçº¦åˆ°channel.md)ï¼šæŸ¥çœ‹â€œéƒ¨ç½²supply-v8åˆ°alljoinchannelé€šé“â€éƒ¨åˆ†</li><li><a href="https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E9%9A%90%E7%A7%98%E4%BA%A4%E6%98%93/">éšç§˜äº¤æ˜“</a></li><li><a href="https://github.com/guozhe001/supply-finance.git">æºç åœ°å€</a></li></ol><h2 id="æ€»ç»“ï¼š">æ€»ç»“ï¼š</h2><p>æœ¬é¡¹ç›®æˆåŠŸçš„åœ¨æµ‹è¯•ç¯å¢ƒè‡ªå·±éƒ¨ç½²ç½‘ç»œï¼Œè‡ªå·±å†™æ™ºèƒ½åˆçº¦å¹¶è¿›è¡Œè°ƒç”¨ï¼›å®Œæˆäº†å…¥é—¨ç»ƒä¹ ã€‚</p><h2 id="å­˜åœ¨çš„é—®é¢˜ï¼š">å­˜åœ¨çš„é—®é¢˜ï¼š</h2><h3 id="é—®é¢˜1">é—®é¢˜1</h3><p>ç›®å‰æ­¤ç¨‹åºæŠŠæ‰€æœ‰çš„ç»„ç»‡éƒ½åŠ å…¥äº†åŒä¸€ä¸ªæ¸ é“ï¼Œæ‰€ä»¥è´¦æœ¬æ˜¯å¯¹æ‰€æœ‰ç»„ç»‡éƒ½æ˜¯å…¬å¼€çš„ï¼›ç°å®ç”Ÿæ´»ä¸­æ¯ä¸ªä¼ä¸šä¹‹é—´çš„äº¤æ˜“åº”è¯¥éƒ½æ˜¯ç§å¯†çš„ï¼Œä¸èƒ½è¢«å…¶ä»–ä¼ä¸šæ‰€è§ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ1ï¼š">è§£å†³æ–¹æ¡ˆ1ï¼š</h4><p>ä½¿ç”¨é€šé“éš”ç¦»ï¼Œæ¯ä¸¤ä¸ªéœ€è¦äº¤æ˜“çš„ç»„ç»‡ä¹‹é—´éƒ½åˆ›å»ºä¸€ä¸ªé€šé“ã€‚</p><p><strong>å¯è¡Œæ€§ï¼š</strong> <em>åˆæ­¥åˆ¤æ–­æ­¤æ–¹æ³•ä¸å¯è¡Œï¼Œå› ä¸ºä¸åŒé€šé“ä¹‹é—´æ— æ³•äº¤æ˜“èµ„äº§ï¼Ÿå¦‚æœå¯ä»¥äº¤æ˜“éœ€è¦ä»åŸæ¥çš„channelé”€æ¯æ­¤èµ„äº§ï¼Œç„¶ååœ¨æ–°channelåˆ›å»ºä¸€ä¸ªæ–°çš„å¯è¢«ä¿¡ä»»çš„æ–°èµ„äº§</em></p><h4 id="è§£å†³æ–¹æ¡ˆ2ï¼š">è§£å†³æ–¹æ¡ˆ2ï¼š</h4><p>ä½¿ç”¨ç§å¯†èµ„äº§äº¤æ˜“çš„æ–¹å¼è§£å†³,å‚è€ƒæ–‡æ¡£<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/secured_asset_transfer/secured_private_asset_transfer_tutorial.html">Secured asset transfer in Fabric</a></p><p><strong>å¯è¡Œæ€§ï¼š</strong> å¯ä»¥ï¼ŒæŸ¥çœ‹[éšç§˜äº¤æ˜“](file://éšç§˜äº¤æ˜“.md)</p><h3 id="é—®é¢˜2">é—®é¢˜2:</h3><p>åŒä¸€ä¸ªæ™ºèƒ½åˆçº¦å¦‚ä½•é™åˆ¶åªèƒ½ç”±æŒ‡å®šçš„äººè°ƒç”¨ï¼Ÿå¦‚æœ¬ä¾‹ä¸­ï¼Œå‘è¡Œæ–¹æ³•åº”è¯¥åªèƒ½ç”±æ ¸å¿ƒä¼ä¸šè°ƒç”¨ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3><p>åŒä¸€ä¸ªæ™ºèƒ½åˆçº¦å¯ä»¥ç”±éƒ¨ç½²æ™ºèƒ½åˆçº¦çš„æˆå‘˜è°ƒç”¨ï¼Œæ‰€ä»¥æ— æ³•é™åˆ¶ï¼Œé™¤éæ™ºèƒ½åˆçº¦é‡Œé¢å†™æ­»ã€‚</p><p>åœ¨åº”æ”¶è´¦æ¬¾ä¾›åº”é“¾é‡‘èçš„demoä¸­ï¼Œæˆ‘ä»¬å†™çš„æ™ºèƒ½åˆçº¦å¯ä»¥ç”±ä»»ä½•äººå‘è¡Œåº”æ”¶è´¦æ¬¾ï¼Œä½†æ˜¯è¿™åªæ˜¯ç”Ÿæˆäº†ç§æœ‰çš„æ•°æ®ï¼Œåˆ«äººè®¤ä¸è®¤å¯æ˜¯å¦è·Ÿå‘è¡Œåº”æ”¶è´¦æ¬¾çš„ç»„ç»‡äº¤æ˜“æ˜¯é“¾ä¸‹è§£å†³çš„é—®é¢˜ã€‚</p><h3 id="é—®é¢˜3ï¼š">é—®é¢˜3ï¼š</h3><p>ä½¿ç”¨å®‰å…¨çš„æ–¹å¼äº¤æ˜“èµ„äº§ä¹‹åï¼Œé™¤äº†èµ„äº§çš„æ‹¥æœ‰è€…ä¹‹å¤–å…¶ä»–ä»»ä½•äººéƒ½æ— æ³•çŸ¥é“èµ„äº§çš„é‡‘é¢ç­‰ç§æœ‰ä¿¡æ¯ã€‚ä½†æ˜¯ç°å®ä¸­çš„ä¾›åº”é“¾é‡‘èåº”è¯¥æ˜¯å…è®¸å‡­è¯èµ„äº§çš„å‘è¡ŒäººçŸ¥é“èµ„äº§å½’å±æ˜¯è°ã€èµ„äº§çš„é‡‘é¢æ˜¯å¤šå°‘ï¼›åªæœ‰è¿™æ ·å‘è¡Œäººæ‰èƒ½å¤Ÿåœ¨å‡­è¯èµ„äº§åˆ°æœŸæ—¶è¿›è¡Œè¿˜æ¬¾ã€‚</p><h4 id="è§£å†³æ–¹æ¡ˆ-v2">è§£å†³æ–¹æ¡ˆ</h4><p>ä¿®æ”¹æ™ºèƒ½åˆçº¦ï¼Œå¾…å®Œæˆã€‚</p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> ä¾›åº”é“¾é‡‘è </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> ä¾›åº”é“¾é‡‘è </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¼–å†™æ‚¨çš„ç¬¬ä¸€ä¸ªChaincode</title>
      <link href="2021/04/01/blockchain/fabric/%E7%BC%96%E5%86%99%E6%82%A8%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AAChaincode/"/>
      <url>2021/04/01/blockchain/fabric/%E7%BC%96%E5%86%99%E6%82%A8%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AAChaincode/</url>
      
        <content type="html"><![CDATA[<p><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/chaincode4ade.html">å®˜æ–¹æ–‡æ¡£</a></p><h2 id="Asset-Transfer-Chaincodeï¼ˆèµ„äº§äº¤æ˜“æ™ºèƒ½åˆçº¦ï¼‰">Asset Transfer Chaincodeï¼ˆèµ„äº§äº¤æ˜“æ™ºèƒ½åˆçº¦ï¼‰</h2><p>Our application is a basic sample chaincode to initialize a ledger with assets, create, read, update, and delete assets, check to see if an asset exists, and transfer assets from one owner to another.</p><p>æˆ‘ä»¬çš„ç¨‹åºæ˜¯ä¸€ä¸ªåŸºæœ¬ç®€å•çš„é“¾ç ï¼Œåˆ©ç”¨èµ„äº§åˆå§‹åŒ–è´¦æœ¬ï¼Œåˆ›å»ºã€è¯»å–ï¼Œæ›´æ–°ä»¥åŠæ›´æ–°èµ„äº§ï¼Œæ£€æŸ¥ä¸€ä¸ªèµ„äº§æ˜¯å¦å­˜åœ¨å¹¶ä¸”æŠŠèµ„äº§ä»ä¸€ä¸ªæ‰€æœ‰è€…äº¤æ˜“ç»™å¦ä¸€ä¸ªæ‰€æœ‰è€…ã€‚</p><h3 id="Choosing-a-Location-for-the-Codeï¼ˆç»™ä»£ç é€‰ä¸€ä¸ªä½ç½®ï¼‰">Choosing a Location for the Codeï¼ˆç»™ä»£ç é€‰ä¸€ä¸ªä½ç½®ï¼‰</h3><p>If you havenâ€™t been doing programming in Go, you may want to make sure that you have <a href="https://golang.org/">Go</a> installed and your system properly configured. We assume you are using a version that supports modules.</p><p>å¦‚æœä½ è¿˜æ²¡æœ‰ä½¿ç”¨è¿‡Goï¼Œä½ éœ€è¦ç¡®è®¤ä½ çš„ç¯å¢ƒå·²ç»å®‰è£…äº† <a href="https://golang.org/">Go</a>å¹¶é…ç½®å¥½äº†ç¯å¢ƒå˜é‡ã€‚æˆ‘ä»¬å‡è®¾ä½ ä½¿ç”¨çš„æ˜¯æ”¯æŒæ¨¡å—çš„ç‰ˆæœ¬ã€‚</p><p>Now, you will want to create a directory for your chaincode application.</p><p>To keep things simple, letâ€™s use the following command:</p><p>ç°åœ¨ä½ æƒ³è¦ä¸ºä½ çš„é“¾ç ç¨‹åºåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// atcc is shorthand for asset transfer chaincode</span><br><span class="line">mkdir atcc &amp;&amp; cd atcc</span><br></pre></td></tr></table></figure><p>Now, letâ€™s create the module and the source file that weâ€™ll fill in with code:</p><p>ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºæ¨¡å—å’Œæºæ–‡ä»¶ï¼Œå¹¶ç”¨ä»£ç å¡«å……å®ƒä»¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go mod init atcc</span><br><span class="line">touch atcc.go</span><br></pre></td></tr></table></figure><h3 id="Housekeeping-æ•´ç†å·¥ä½œ">Housekeeping(æ•´ç†å·¥ä½œ)</h3><p>First, letâ€™s start with some housekeeping. As with every chaincode, it implements the <a href="https://godoc.org/github.com/hyperledger/fabric-contract-api-go/contractapi">fabric-contract-api interface</a>, so letâ€™s add the Go import statements for the necessary dependencies for our chaincode. Weâ€™ll import the fabric contract api package and define our SmartContract.</p><p>é¦–å…ˆè®©æˆ‘ä»¬åšä¸€äº›æ•´ç†å·¥ä½œã€‚æ‰€æœ‰çš„é“¾ç éƒ½å®ç°äº†<a href="https://godoc.org/github.com/hyperledger/fabric-contract-api-go/contractapi">fabric-contract-api interface</a>ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä¸ºGoç¨‹åºæ·»åŠ å¿…è¦çš„ä¾èµ–ã€‚æˆ‘ä»¬ä¼šå¯¼å…¥fabricåˆåŒAPIåŒ…æ¥å®šä¹‰æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;log&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// SmartContract provides functions for managing an Asset</span></span><br><span class="line">   <span class="keyword">type</span> SmartContract <span class="keyword">struct</span> &#123;</span><br><span class="line">   contractapi.Contract</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>Next, letâ€™s add a struct <code>Asset</code> to represent simple assets on the ledger. Note the JSON annotations, which will be used to marshal the asset to JSON which is stored on the ledger.</p><p>ä¸‹ä¸€æ­¥è®©æˆ‘ä»¬å¢åŠ ä¸€ä¸ª<code>Asset</code> ç±»æ¥è¡¨ç¤ºè´¦æœ¬ä¸Šçš„ç®€å•çš„èµ„äº§ã€‚è¯·æ³¨æ„JSONæ³¨é‡Šï¼Œè¯¥æ³¨é‡Šå°†ç”¨äºå°†èµ„äº§ç¼–ç»„ä¸ºå­˜å‚¨åœ¨åˆ†ç±»å¸ä¸­çš„JSONã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Asset describes basic details of what makes up a simple asset</span></span><br><span class="line">   <span class="keyword">type</span> Asset <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID             <span class="keyword">string</span> <span class="string">`json:&quot;ID&quot;`</span></span><br><span class="line">    Color          <span class="keyword">string</span> <span class="string">`json:&quot;color&quot;`</span></span><br><span class="line">    Size           <span class="keyword">int</span>    <span class="string">`json:&quot;size&quot;`</span></span><br><span class="line">    Owner          <span class="keyword">string</span> <span class="string">`json:&quot;owner&quot;`</span></span><br><span class="line">    AppraisedValue <span class="keyword">int</span>    <span class="string">`json:&quot;appraisedValue&quot;`</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="Initializing-the-Chaincode-åˆå§‹åŒ–é“¾ç ">Initializing the Chaincode(åˆå§‹åŒ–é“¾ç )</h3><p>Next, weâ€™ll implement the <code>InitLedger</code> function to populate the ledger with some initial data.</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å®ç°<code>InitLedger</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä½¿ç”¨ä¸€äº›åˆå§‹åŒ–çš„æ•°æ®æ¥å¡«å……è´¦æœ¬ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// InitLedger adds a base set of assets to the ledger</span></span><br><span class="line">   <span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">InitLedger</span><span class="params">(ctx contractapi.TransactionContextInterface)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">      assets := []Asset&#123;</span><br><span class="line">        &#123;ID: <span class="string">&quot;asset1&quot;</span>, Color: <span class="string">&quot;blue&quot;</span>, Size: <span class="number">5</span>, Owner: <span class="string">&quot;Tomoko&quot;</span>, AppraisedValue: <span class="number">300</span>&#125;,</span><br><span class="line">        &#123;ID: <span class="string">&quot;asset2&quot;</span>, Color: <span class="string">&quot;red&quot;</span>, Size: <span class="number">5</span>, Owner: <span class="string">&quot;Brad&quot;</span>, AppraisedValue: <span class="number">400</span>&#125;,</span><br><span class="line">        &#123;ID: <span class="string">&quot;asset3&quot;</span>, Color: <span class="string">&quot;green&quot;</span>, Size: <span class="number">10</span>, Owner: <span class="string">&quot;Jin Soo&quot;</span>, AppraisedValue: <span class="number">500</span>&#125;,</span><br><span class="line">        &#123;ID: <span class="string">&quot;asset4&quot;</span>, Color: <span class="string">&quot;yellow&quot;</span>, Size: <span class="number">10</span>, Owner: <span class="string">&quot;Max&quot;</span>, AppraisedValue: <span class="number">600</span>&#125;,</span><br><span class="line">        &#123;ID: <span class="string">&quot;asset5&quot;</span>, Color: <span class="string">&quot;black&quot;</span>, Size: <span class="number">15</span>, Owner: <span class="string">&quot;Adriana&quot;</span>, AppraisedValue: <span class="number">700</span>&#125;,</span><br><span class="line">        &#123;ID: <span class="string">&quot;asset6&quot;</span>, Color: <span class="string">&quot;white&quot;</span>, Size: <span class="number">15</span>, Owner: <span class="string">&quot;Michel&quot;</span>, AppraisedValue: <span class="number">800</span>&#125;,</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> _, asset := <span class="keyword">range</span> assets &#123;</span><br><span class="line">      assetJSON, err := json.Marshal(asset)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      err = ctx.GetStub().PutState(asset.ID, assetJSON)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to put to world state. %v&quot;</span>, err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>Next, we write a function to create an asset on the ledger that does not yet exist. When writing chaincode, it is a good idea to check for the existence of something on the ledger prior to taking an action on it, as is demonstrated in the <code>CreateAsset</code> function below.</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªåˆ›å»ºä¸€ä¸ªè´¦æœ¬ä¸Šä¸å­˜åœ¨çš„èµ„äº§çš„æ–¹æ³•ã€‚å½“ç¼–å†™é“¾ç æ—¶ï¼Œæœ€å¥½å…ˆå¯¹åˆ†ç±»å¸è¿›è¡Œæ£€æŸ¥ï¼Œç„¶åå†å¯¹å…¶è¿›è¡Œæ“ä½œï¼Œå¦‚ä¸‹é¢çš„CreateAssetå‡½æ•°æ‰€ç¤ºã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CreateAsset issues a new asset to the world state with given details.</span></span><br><span class="line">   <span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">CreateAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>, color <span class="keyword">string</span>, size <span class="keyword">int</span>, owner <span class="keyword">string</span>, appraisedValue <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    exists, err := s.AssetExists(ctx, id)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> exists &#123;</span><br><span class="line">      <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;the asset %s already exists&quot;</span>, id)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    asset := Asset&#123;</span><br><span class="line">      ID:             id,</span><br><span class="line">      Color:          color,</span><br><span class="line">      Size:           size,</span><br><span class="line">      Owner:          owner,</span><br><span class="line">      AppraisedValue: appraisedValue,</span><br><span class="line">    &#125;</span><br><span class="line">    assetJSON, err := json.Marshal(asset)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ctx.GetStub().PutState(id, assetJSON)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>Now that we have populated the ledger with some initial assets and created an asset, letâ€™s write a function <code>ReadAsset</code> that allows us to read an asset from the ledger.</p><p>ç°åœ¨æˆ‘ä»¬å·²ç»ä½¿ç”¨åˆå§‹åŒ–èµ„äº§å’Œåˆ›å»ºä¸€ä¸ªèµ„äº§æ¥å¡«å……äº†è´¦æœ¬ï¼Œè®©æˆ‘ä»¬å†™ä¸€ä¸ª <code>ReadAsset</code> æ–¹æ³•æ¥å…è®¸æˆ‘ä»¬è¯»å–è´¦æœ¬ä¸Šçš„èµ„äº§ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ReadAsset returns the asset stored in the world state with given id.</span></span><br><span class="line">   <span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">ReadAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>)</span> <span class="params">(*Asset, error)</span></span> &#123;</span><br><span class="line">    assetJSON, err := ctx.GetStub().GetState(id)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;failed to read from world state: %v&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> assetJSON == <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;the asset %s does not exist&quot;</span>, id)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> asset Asset</span><br><span class="line">    err = json.Unmarshal(assetJSON, &amp;asset)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &amp;asset, <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>Now that we have assets on our ledger we can interact with, letâ€™s write a chaincode function <code>UpdateAsset</code> that allows us to update attributes of the asset that we are allowed to change.</p><p>ç°åœ¨æˆ‘ä»¬å·²ç»åœ¨æˆ‘ä»¬çš„è´¦æœ¬ä¸Šæœ‰èµ„äº§å¹¶èƒ½å¤Ÿä¸ä»–ä»¬äº¤äº’äº†ï¼Œè®©æˆ‘ä»¬å†™ä¸€ä¸ªé“¾ç æ–¹æ³• <code>UpdateAsset</code> æ¥ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ›´æ–°å…è®¸æ›´æ”¹çš„èµ„äº§çš„å±æ€§ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UpdateAsset updates an existing asset in the world state with provided parameters.</span></span><br><span class="line">   <span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">UpdateAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>, color <span class="keyword">string</span>, size <span class="keyword">int</span>, owner <span class="keyword">string</span>, appraisedValue <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">      exists, err := s.AssetExists(ctx, id)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> !exists &#123;</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;the asset %s does not exist&quot;</span>, id)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// overwriting original asset with new asset</span></span><br><span class="line">      asset := Asset&#123;</span><br><span class="line">        ID:             id,</span><br><span class="line">        Color:          color,</span><br><span class="line">        Size:           size,</span><br><span class="line">        Owner:          owner,</span><br><span class="line">        AppraisedValue: appraisedValue,</span><br><span class="line">      &#125;</span><br><span class="line">      assetJSON, err := json.Marshal(asset)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> ctx.GetStub().PutState(id, assetJSON)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>There may be cases where we need the ability to delete an asset from the ledger, so letâ€™s write a <code>DeleteAsset</code> function to handle that requirement.</p><p>å¯èƒ½æˆ‘æœ¬éœ€è¦ä»è´¦æœ¬ä¸Šåˆ é™¤ä¸€ä¸ªèµ„äº§ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å†™ä¸€ä¸ª <code>DeleteAsset</code> æ–¹æ³•æ¥å¤„ç†è¿™ä¸ªéœ€æ±‚ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DeleteAsset deletes an given asset from the world state.</span></span><br><span class="line">   <span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">DeleteAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">      exists, err := s.AssetExists(ctx, id)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> !exists &#123;</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;the asset %s does not exist&quot;</span>, id)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> ctx.GetStub().DelState(id)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>We said earlier that is was a good idea to check to see if an asset exists before taking an action on it, so letâ€™s write a function called <code>AssetExists</code> to implement that requirement.</p><p>æˆ‘ä»¬ä¹‹å‰è¯´åœ¨å¯¹ä¸€ä¸ªèµ„äº§è¿›è¡Œæ“ä½œä¹‹å‰ï¼Œæœ€å¥½å…ˆæ£€æŸ¥è¿™ä¸ªèµ„äº§æ˜¯å¦å­˜åœ¨ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å†™ä¸€ä¸ªåä¸º <code>AssetExists</code>çš„æ–¹æ³•æ¥å®ç°è¿™ä¸ªéœ€æ±‚ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AssetExists returns true when asset with given ID exists in world state</span></span><br><span class="line">   <span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">AssetExists</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">bool</span>, error)</span></span> &#123;</span><br><span class="line">      assetJSON, err := ctx.GetStub().GetState(id)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>, fmt.Errorf(<span class="string">&quot;failed to read from world state: %v&quot;</span>, err)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> assetJSON != <span class="literal">nil</span>, <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>Next, weâ€™ll write a function weâ€™ll call <code>TransferAsset</code> that enables the transfer of an asset from one owner to another.</p><p>æ¥ç€ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªæˆ‘ä»¬ç§°ä½œ<code>TransferAsset</code>çš„æ–¹æ³•ï¼Œè¯¥å‡½æ•°å¯å°†èµ„äº§ä»ä¸€ä¸ªæ‰€æœ‰è€…è½¬ç§»åˆ°å¦ä¸€ä¸ªæ‰€æœ‰è€…ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TransferAsset updates the owner field of asset with given id in world state.</span></span><br><span class="line">   <span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">TransferAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>, newOwner <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">      asset, err := s.ReadAsset(ctx, id)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      asset.Owner = newOwner</span><br><span class="line">      assetJSON, err := json.Marshal(asset)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> ctx.GetStub().PutState(id, assetJSON)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>Letâ€™s write a function weâ€™ll call <code>GetAllAssets</code> that enables the querying of the ledger to return all of the assets on the ledger.</p><p>è®©æˆ‘ä»¬å†™ä¸€ä¸ª <code>GetAllAssets</code> æ–¹æ³•æ¥æŸ¥è¯¢è´¦æœ¬ä¸Šçš„èµ„äº§ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›è´¦æœ¬ä¸Šçš„æ‰€æœ‰èµ„äº§ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GetAllAssets returns all assets found in world state</span></span><br><span class="line">   <span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">GetAllAssets</span><span class="params">(ctx contractapi.TransactionContextInterface)</span> <span class="params">([]*Asset, error)</span></span> &#123;</span><br><span class="line"><span class="comment">// range query with empty string for startKey and endKey does an</span></span><br><span class="line"><span class="comment">// open-ended query of all assets in the chaincode namespace.</span></span><br><span class="line">    resultsIterator, err := ctx.GetStub().GetStateByRange(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> resultsIterator.Close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> assets []*Asset</span><br><span class="line">    <span class="keyword">for</span> resultsIterator.HasNext() &#123;</span><br><span class="line">      queryResponse, err := resultsIterator.Next()</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> asset Asset</span><br><span class="line">      err = json.Unmarshal(queryResponse.Value, &amp;asset)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">      &#125;</span><br><span class="line">      assets = <span class="built_in">append</span>(assets, &amp;asset)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> assets, <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h3 id="Pulling-it-All-Togetherï¼ˆæŠŠè¿™äº›ä»£ç æ”¾åˆ°ä¸€èµ·ï¼‰">Pulling it All Togetherï¼ˆæŠŠè¿™äº›ä»£ç æ”¾åˆ°ä¸€èµ·ï¼‰</h3><p>Finally, we need to add the <code>main</code> function, which will call the <a href="https://godoc.org/github.com/hyperledger/fabric-contract-api-go/contractapi#ContractChaincode.Start">ContractChaincode.Start</a> function. Hereâ€™s the whole chaincode program source.</p><p>æœ€ç»ˆæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªè°ƒç”¨ <a href="https://godoc.org/github.com/hyperledger/fabric-contract-api-go/contractapi#ContractChaincode.Start">ContractChaincode.Start</a> æ–¹æ³•çš„ <code>main</code> æ–¹æ³•ã€‚ä¸‹é¢å°±æ˜¯å…¨éƒ¨çš„é“¾ç ç¨‹åºæºç ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;log&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// SmartContract provides functions for managing an Asset</span></span><br><span class="line">   <span class="keyword">type</span> SmartContract <span class="keyword">struct</span> &#123;</span><br><span class="line">      contractapi.Contract</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Asset describes basic details of what makes up a simple asset</span></span><br><span class="line">   <span class="keyword">type</span> Asset <span class="keyword">struct</span> &#123;</span><br><span class="line">      ID             <span class="keyword">string</span> <span class="string">`json:&quot;ID&quot;`</span></span><br><span class="line">      Color          <span class="keyword">string</span> <span class="string">`json:&quot;color&quot;`</span></span><br><span class="line">      Size           <span class="keyword">int</span>    <span class="string">`json:&quot;size&quot;`</span></span><br><span class="line">      Owner          <span class="keyword">string</span> <span class="string">`json:&quot;owner&quot;`</span></span><br><span class="line">      AppraisedValue <span class="keyword">int</span>    <span class="string">`json:&quot;appraisedValue&quot;`</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// InitLedger adds a base set of assets to the ledger</span></span><br><span class="line">   <span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">InitLedger</span><span class="params">(ctx contractapi.TransactionContextInterface)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    assets := []Asset&#123;</span><br><span class="line">      &#123;ID: <span class="string">&quot;asset1&quot;</span>, Color: <span class="string">&quot;blue&quot;</span>, Size: <span class="number">5</span>, Owner: <span class="string">&quot;Tomoko&quot;</span>, AppraisedValue: <span class="number">300</span>&#125;,</span><br><span class="line">      &#123;ID: <span class="string">&quot;asset2&quot;</span>, Color: <span class="string">&quot;red&quot;</span>, Size: <span class="number">5</span>, Owner: <span class="string">&quot;Brad&quot;</span>, AppraisedValue: <span class="number">400</span>&#125;,</span><br><span class="line">      &#123;ID: <span class="string">&quot;asset3&quot;</span>, Color: <span class="string">&quot;green&quot;</span>, Size: <span class="number">10</span>, Owner: <span class="string">&quot;Jin Soo&quot;</span>, AppraisedValue: <span class="number">500</span>&#125;,</span><br><span class="line">      &#123;ID: <span class="string">&quot;asset4&quot;</span>, Color: <span class="string">&quot;yellow&quot;</span>, Size: <span class="number">10</span>, Owner: <span class="string">&quot;Max&quot;</span>, AppraisedValue: <span class="number">600</span>&#125;,</span><br><span class="line">      &#123;ID: <span class="string">&quot;asset5&quot;</span>, Color: <span class="string">&quot;black&quot;</span>, Size: <span class="number">15</span>, Owner: <span class="string">&quot;Adriana&quot;</span>, AppraisedValue: <span class="number">700</span>&#125;,</span><br><span class="line">      &#123;ID: <span class="string">&quot;asset6&quot;</span>, Color: <span class="string">&quot;white&quot;</span>, Size: <span class="number">15</span>, Owner: <span class="string">&quot;Michel&quot;</span>, AppraisedValue: <span class="number">800</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, asset := <span class="keyword">range</span> assets &#123;</span><br><span class="line">      assetJSON, err := json.Marshal(asset)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      err = ctx.GetStub().PutState(asset.ID, assetJSON)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to put to world state. %v&quot;</span>, err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CreateAsset issues a new asset to the world state with given details.</span></span><br><span class="line">   <span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">CreateAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>, color <span class="keyword">string</span>, size <span class="keyword">int</span>, owner <span class="keyword">string</span>, appraisedValue <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    exists, err := s.AssetExists(ctx, id)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> exists &#123;</span><br><span class="line">      <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;the asset %s already exists&quot;</span>, id)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    asset := Asset&#123;</span><br><span class="line">      ID:             id,</span><br><span class="line">      Color:          color,</span><br><span class="line">      Size:           size,</span><br><span class="line">      Owner:          owner,</span><br><span class="line">      AppraisedValue: appraisedValue,</span><br><span class="line">    &#125;</span><br><span class="line">    assetJSON, err := json.Marshal(asset)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ctx.GetStub().PutState(id, assetJSON)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ReadAsset returns the asset stored in the world state with given id.</span></span><br><span class="line">   <span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">ReadAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>)</span> <span class="params">(*Asset, error)</span></span> &#123;</span><br><span class="line">    assetJSON, err := ctx.GetStub().GetState(id)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;failed to read from world state: %v&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> assetJSON == <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;the asset %s does not exist&quot;</span>, id)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> asset Asset</span><br><span class="line">    err = json.Unmarshal(assetJSON, &amp;asset)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &amp;asset, <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UpdateAsset updates an existing asset in the world state with provided parameters.</span></span><br><span class="line">   <span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">UpdateAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>, color <span class="keyword">string</span>, size <span class="keyword">int</span>, owner <span class="keyword">string</span>, appraisedValue <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    exists, err := s.AssetExists(ctx, id)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> !exists &#123;</span><br><span class="line">      <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;the asset %s does not exist&quot;</span>, id)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// overwriting original asset with new asset</span></span><br><span class="line">    asset := Asset&#123;</span><br><span class="line">      ID:             id,</span><br><span class="line">      Color:          color,</span><br><span class="line">      Size:           size,</span><br><span class="line">      Owner:          owner,</span><br><span class="line">      AppraisedValue: appraisedValue,</span><br><span class="line">    &#125;</span><br><span class="line">    assetJSON, err := json.Marshal(asset)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ctx.GetStub().PutState(id, assetJSON)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// DeleteAsset deletes an given asset from the world state.</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">DeleteAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    exists, err := s.AssetExists(ctx, id)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> !exists &#123;</span><br><span class="line">      <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;the asset %s does not exist&quot;</span>, id)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ctx.GetStub().DelState(id)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AssetExists returns true when asset with given ID exists in world state</span></span><br><span class="line">   <span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">AssetExists</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">bool</span>, error)</span></span> &#123;</span><br><span class="line">    assetJSON, err := ctx.GetStub().GetState(id)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>, fmt.Errorf(<span class="string">&quot;failed to read from world state: %v&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> assetJSON != <span class="literal">nil</span>, <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TransferAsset updates the owner field of asset with given id in world state.</span></span><br><span class="line">   <span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">TransferAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>, newOwner <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    asset, err := s.ReadAsset(ctx, id)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    asset.Owner = newOwner</span><br><span class="line">    assetJSON, err := json.Marshal(asset)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ctx.GetStub().PutState(id, assetJSON)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetAllAssets returns all assets found in world state</span></span><br><span class="line">   <span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">GetAllAssets</span><span class="params">(ctx contractapi.TransactionContextInterface)</span> <span class="params">([]*Asset, error)</span></span> &#123;</span><br><span class="line"><span class="comment">// range query with empty string for startKey and endKey does an</span></span><br><span class="line"><span class="comment">// open-ended query of all assets in the chaincode namespace.</span></span><br><span class="line">    resultsIterator, err := ctx.GetStub().GetStateByRange(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> resultsIterator.Close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> assets []*Asset</span><br><span class="line">    <span class="keyword">for</span> resultsIterator.HasNext() &#123;</span><br><span class="line">      queryResponse, err := resultsIterator.Next()</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> asset Asset</span><br><span class="line">      err = json.Unmarshal(queryResponse.Value, &amp;asset)</span><br><span class="line">      <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">      &#125;</span><br><span class="line">      assets = <span class="built_in">append</span>(assets, &amp;asset)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> assets, <span class="literal">nil</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    assetChaincode, err := contractapi.NewChaincode(&amp;SmartContract&#123;&#125;)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Panicf(<span class="string">&quot;Error creating asset-transfer-basic chaincode: %v&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err := assetChaincode.Start(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">      log.Panicf(<span class="string">&quot;Error starting asset-transfer-basic chaincode: %v&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="Chaincode-access-control">Chaincode access control</h2><p>Chaincode can utilize the client (submitter) certificate for access control decisions with <code>ctx.GetStub().GetCreator()</code>. Additionally the Fabric Contract API provides extension APIs that extract client identity from the submitterâ€™s certificate that can be used for access control decisions, whether that is based on client identity itself, or the org identity, or on a client identity attribute.</p><p>é“¾ç å¯ä»¥é€šè¿‡ <code>ctx.GetStub().GetCreator()</code>åˆ©ç”¨å®¢æˆ·ç«¯ï¼ˆæäº¤è€…ï¼‰è¯ä¹¦è¿›è¡Œè®¿é—®æ§åˆ¶å†³ç­–ã€‚æ­¤å¤–ï¼ŒFabric Contract APIè¿˜æä¾›äº†æ‰©å±•APIï¼Œè¿™äº›APIä»æäº¤è€…çš„è¯ä¹¦ä¸­æå–å®¢æˆ·ç«¯èº«ä»½ï¼Œå¯ç”¨äºè®¿é—®æ§åˆ¶å†³ç­–ï¼Œä¸è®ºæ˜¯åŸºäºå®¢æˆ·ç«¯èº«ä»½æœ¬èº«ï¼Œç»„ç»‡èº«ä»½æˆ–å®¢æˆ·ç«¯èº«ä»½å±æ€§ã€‚</p><p>For example an asset that is represented as a key/value may include the clientâ€™s identity as part of the value (for example as a JSON attribute indicating that asset owner), and only this client may be authorized to make updates to the key/value in the future. The client identity library extension APIs can be used within chaincode to retrieve this submitter information to make such access control decisions.</p><p>ä¾‹å¦‚ï¼Œè¡¨ç¤ºä¸ºé”®/å€¼çš„èµ„äº§å¯èƒ½åŒ…å«å®¢æˆ·çš„èº«ä»½ä½œä¸ºå€¼çš„ä¸€éƒ¨åˆ†ï¼ˆå¦‚ä½œä¸ºè¡¨ç¤ºè¯¥èµ„äº§æ‰€æœ‰è€…çš„JSONå±æ€§ï¼‰ï¼Œå¹¶ä¸”åªæœ‰è¿™ä¸ªå®¢æˆ·ç«¯å¯èƒ½æœ‰æƒé™æ¥åœ¨å°†æ¥æ›´æ–°è¿™äº› key/valueã€‚å®¢æˆ·ç«¯èº«ä»½åº“æ‰©å±•APIå¯ä»¥åœ¨é“¾ç ä¸­ä½¿ç”¨ï¼Œä»¥æ£€ç´¢æ­¤æäº¤è€…ä¿¡æ¯ä»¥åšå‡ºæ­¤ç±»è®¿é—®æ§åˆ¶å†³ç­–ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> chaincode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> chaincode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·»åŠ ä¸€ä¸ªæ–°çš„ç»„ç»‡åˆ°channel</title>
      <link href="2021/04/01/blockchain/fabric/%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E7%BB%84%E7%BB%87%E5%88%B0channel/"/>
      <url>2021/04/01/blockchain/fabric/%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E7%BB%84%E7%BB%87%E5%88%B0channel/</url>
      
        <content type="html"><![CDATA[<h1 id="æ·»åŠ ä¸€ä¸ªæ–°çš„ç»„ç»‡åˆ°channel">æ·»åŠ ä¸€ä¸ªæ–°çš„ç»„ç»‡åˆ°channel</h1><p><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/channel_update_tutorial.html">å®˜æ–¹æ–‡æ¡£</a></p><p>This tutorial extends the Fabric test network by adding a new organization â€“ Org3 â€“ to an application channel.</p><p>æœ¬æ•™ç¨‹é€šè¿‡å‘åº”ç”¨ç¨‹åºé€šé“æ·»åŠ æ–°ç»„ç»‡Org3æ‰©å±•äº†Fabricæµ‹è¯•ç½‘ç»œã€‚</p><p>While we will focus on adding a new organization to the channel, you can use a similar process to make other channel configuration updates (updating modification policies or altering batch size, for example). To learn more about the process and possibilities of channel config updates in general, check out <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/config_update.html">Updating a channel configuration</a>). Itâ€™s also worth noting that channel configuration updates like the one demonstrated here will usually be the responsibility of an organization admin (rather than a chaincode or application developer).</p><p>æˆ‘ä»¬å°†ä¸“æ³¨äºå‘channelæ·»åŠ æ–°ç»„ç»‡ï¼Œä½ å¯ä»¥ä½¿ç”¨ç›¸ä¼¼çš„æµç¨‹æ¥è¿›è¡Œå…¶ä»–æƒ…å†µçš„é€šé“é…ç½®æ›´æ–°ã€‚ç•¥</p><h2 id="Setup-the-Environmentï¼ˆå¯åŠ¨ç¯å¢ƒï¼‰">Setup the Environmentï¼ˆå¯åŠ¨ç¯å¢ƒï¼‰</h2><p>å¯åŠ¨æµ‹è¯•ç¯å¢ƒå¹¶åˆ›å»ºé»˜è®¤çš„channelï¼Œè¯·å‚è€ƒï¼š<a href="Fabric%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%E4%BD%BF%E7%94%A8.md">Fabricæµ‹è¯•ç½‘ç»œä½¿ç”¨</a></p><h2 id="Bring-Org3-into-the-Channel-with-the-Scriptï¼ˆä½¿ç”¨è„šæœ¬å°†Org3åŠ å…¥åˆ°é€šé“ï¼‰">Bring Org3 into the Channel with the Scriptï¼ˆä½¿ç”¨è„šæœ¬å°†Org3åŠ å…¥åˆ°é€šé“ï¼‰</h2><p>You should be in the <code>test-network</code> directory. To use the script, simply issue the following commands:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd addOrg3</span><br><span class="line">./addOrg3.sh up</span><br></pre></td></tr></table></figure><p>The output here is well worth reading. Youâ€™ll see the Org3 crypto material being generated, the Org3 organization definition being created, and then the channel configuration being updated, signed, and then submitted to the channel.</p><p>è¿™é‡Œçš„è¾“å‡ºå€¼çš„æˆ‘ä»¬ä¸€è¯»ã€‚ä½ ä¼šçœ‹åˆ°ç”ŸæˆOrg3ç»„ç»‡çš„åŠ å¯†ææ–™ï¼Œåˆ›å»ºç»„ç»‡Org3çš„å®šä¹‰ç„¶åé€šé“é…ç½®ä¼šè¢«æ›´æ–°ã€ç­¾åå¹¶ä¸”æäº¤åˆ°é€šé“ã€‚</p><p>If everything goes well, youâ€™ll get this message:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">========= Finished adding Org3 to your test network! =========</span><br></pre></td></tr></table></figure><p>Now that we have confirmed we can add Org3 to our channel, we can go through the steps to update the channel configuration that the script completed behind the scenes.</p><p>ç°åœ¨æˆ‘ä»¬å·²ç»ç¡®è®¤æˆ‘ä»¬å¯ä»¥æŠŠç»„ç»‡Org3æ·»åŠ åˆ°æˆ‘ä»¬çš„é€šé“ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ›´æ–°é€šé“é…ç½®æ¥å®Œæˆè„šæœ¬åœ¨å¹•åå®Œæˆå·¥ä½œã€‚</p><h2 id="Bring-Org3-into-the-Channel-Manuallyï¼ˆæ‰‹åŠ¨å°†Org3åŠ å…¥é€šé“ï¼‰">Bring Org3 into the Channel Manuallyï¼ˆæ‰‹åŠ¨å°†Org3åŠ å…¥é€šé“ï¼‰</h2><p>If you just used the <code>addOrg3.sh</code> script, youâ€™ll need to bring your network down. The following command will bring down all running components and remove the crypto material for all organizations:</p><p>å¦‚æœä½ åˆšæ‰ä½¿ç”¨äº† <code>addOrg3.sh</code>è„šæœ¬ï¼Œä½ éœ€è¦å…ˆæŠŠç½‘ç»œå…³é—­ã€‚ä¸‹é¢çš„å‘½ä»¤ä¼šå…³é—­æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ç»„ä»¶å¹¶ä¸”ç§»é™¤æ‰€æœ‰ç»„ç»‡çš„åŠ å¯†ææ–™ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd addOrg3</span><br><span class="line">./addOrg3.sh down</span><br></pre></td></tr></table></figure><p>After the network is brought down, bring it back up againï¼ˆç½‘ç»œå…³é—­ä¹‹åï¼Œé‡æ–°å¯åŠ¨å®ƒï¼‰:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ..</span><br><span class="line">./network.sh up createChannel</span><br></pre></td></tr></table></figure><p>This will bring your network back to the same state it was in before you executed the <code>addOrg3.sh</code> script.</p><p>è¿™å°†ä½¿æ‚¨çš„ç½‘ç»œæ¢å¤åˆ°æ‰§è¡ŒaddOrg3.shè„šæœ¬ä¹‹å‰çš„çŠ¶æ€ã€‚</p><p>Now weâ€™re ready to add Org3 to the channel manually. As a first step, weâ€™ll need to generate Org3â€™s crypto material.</p><p>ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½æ‰‹åŠ¨çš„å°†Org3æ·»åŠ åˆ°é€šé“ä¸­äº†ï¼Œç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦ç”ŸæˆOrg3çš„åŠ å¯†ææ–™ã€‚</p><h2 id="Generate-the-Org3-Crypto-Materialï¼ˆç”ŸæˆOrg3çš„åŠ å¯†ææ–™ï¼‰">Generate the Org3 Crypto Materialï¼ˆç”ŸæˆOrg3çš„åŠ å¯†ææ–™ï¼‰</h2><p>In another terminal, change into the <code>addOrg3</code> subdirectory from <code>test-network</code>.</p><p>åœ¨å¦ä¸€ä¸ªç»ˆç«¯åˆ‡æ¢åˆ° <code>test-network</code>ç›®å½•çš„å­ç›®å½• <code>addOrg3</code>ä¸­ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd addOrg3</span><br></pre></td></tr></table></figure><p>First, we are going to create the certificates and keys for the Org3 peer, along with an application and admin user. Because we are updating an example channel, we are going to use the cryptogen tool instead of using a Certificate Authority. The following command uses cryptogen to read the <code>org3-crypto.yaml</code> file and generate the Org3 crypto material in a new <code>org3.example.com</code> folder:</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä¸ºOrg3ç»„ç»‡çš„peerèŠ‚ç‚¹åŒ…æ‹¬åº”ç”¨ç¨‹åºå’Œç®¡ç†å‘˜ç”¨æˆ·åˆ›å»ºè¯ä¹¦å’Œå¯†é’¥ã€‚å› ä¸ºæˆ‘ä»¬æ­£åœ¨æ›´æ–°ç¤ºä¾‹é€šé“ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨<code>cryptogen</code>å·¥å…·è€Œä¸æ˜¯ä½¿ç”¨è¯ä¹¦é¢å‘æœºæ„ã€‚ ä¸‹é¢çš„å‘½ä»¤ä½¿ç”¨<code>cryptogen</code>è¯»å– <code>org3-crypto.yaml</code>æ–‡ä»¶ç„¶ååœ¨æ–°çš„ <code>org3.example.com</code> æ–‡ä»¶å¤¹ä¸‹é¢ç”ŸæˆOrg3çš„åŠ å¯†ææ–™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../../bin/cryptogen generate --config=org3-crypto.yaml --output=&quot;../organizations&quot;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> channel </category>
          
          <category> peer </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> channel </tag>
            
            <tag> peer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>contract_chaincode.goæºç å­¦ä¹ </title>
      <link href="2021/04/01/blockchain/fabric/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6API%E5%AD%A6%E4%B9%A0/contract_chaincode.go%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/"/>
      <url>2021/04/01/blockchain/fabric/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6API%E5%AD%A6%E4%B9%A0/contract_chaincode.go%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="Chaincodeå¦‚ä½•è¢«å¯ç”¨">Chaincodeå¦‚ä½•è¢«å¯ç”¨</h2><h3 id="å®šä¹‰æ™ºèƒ½åˆçº¦">å®šä¹‰æ™ºèƒ½åˆçº¦</h3><p>æˆ‘ä»¬çœ‹ä¸‹é¢çš„ï¼Œåä¸º<code>SmartContract</code>çš„ç»“æ„ï¼Œå°±æ˜¯æ™ºèƒ½åˆçº¦ï¼Œä½ ä¹Ÿå¯ä»¥èµ·å…¶ä»–çš„åå­—ï¼Œä½†æ˜¯æ— è®ºåå­—å«ä»€ä¹ˆï¼Œæ™ºèƒ½åˆçº¦éƒ½å¿…é¡»æœ‰ä¸€ä¸ªå†…åµŒçš„<code>contractapi.Contract</code>ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒçš„å®šä¹‰ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> SmartContract <span class="keyword">struct</span> &#123;</span><br><span class="line">contractapi.Contract</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨æ™ºèƒ½åˆçº¦çš„å…¥å£">å¯åŠ¨æ™ºèƒ½åˆçº¦çš„å…¥å£</h3><p>åœ¨æ¯ä¸ªchaincodeä¸­éƒ½å¿…é¡»æœ‰ä¸€ä¸ª<code>main</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„é“¾ç å¹¶è°ƒç”¨å®ƒçš„<code>Start()</code>æ–¹æ³•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// é€šè¿‡NewChaincode()æ–¹æ³•åˆ›å»ºé“¾ç </span></span><br><span class="line">chaincode, err := contractapi.NewChaincode(<span class="built_in">new</span>(SmartContract))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Panicf(<span class="string">&quot;Error create transfer asset chaincode: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">  <span class="comment">// è°ƒç”¨é“¾ç çš„Start()æ–¹æ³•æ¥å¯åŠ¨é“¾ç </span></span><br><span class="line"><span class="keyword">if</span> err := chaincode.Start(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Panicf(<span class="string">&quot;Error starting asset chaincode: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ™ºèƒ½åˆçº¦å¯åŠ¨çš„æºç ">æ™ºèƒ½åˆçº¦å¯åŠ¨çš„æºç </h3><p>è®©æˆ‘ä»¬å®Œæ•´çš„çœ‹ä¸€ä¸‹<code>contractapi</code>çš„æºç ï¼Œæºç è·¯å¾„ï¼š<code>github.com/hyperledger/fabric-contract-api-go/contractapi/contract_chaincode.go</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Copyright the Hyperledger Fabric contributors. All rights reserved.</span></span><br><span class="line"><span class="comment">// SPDX-License-Identifier: Apache-2.0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> contractapi</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;encoding/json&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;reflect&quot;</span></span><br><span class="line"><span class="string">&quot;sort&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line"><span class="string">&quot;unicode&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;github.com/hyperledger/fabric-chaincode-go/pkg/cid&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/hyperledger/fabric-chaincode-go/shim&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/hyperledger/fabric-contract-api-go/internal&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/hyperledger/fabric-contract-api-go/internal/utils&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/hyperledger/fabric-contract-api-go/metadata&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/hyperledger/fabric-contract-api-go/serializer&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/hyperledger/fabric-protos-go/peer&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> contractChaincodeContract <span class="keyword">struct</span> &#123;</span><br><span class="line">info                      metadata.InfoMetadata</span><br><span class="line">functions                 <span class="keyword">map</span>[<span class="keyword">string</span>]*internal.ContractFunction</span><br><span class="line">unknownTransaction        *internal.TransactionHandler</span><br><span class="line">beforeTransaction         *internal.TransactionHandler</span><br><span class="line">afterTransaction          *internal.TransactionHandler</span><br><span class="line">transactionContextHandler reflect.Type</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ContractChaincode a struct to meet the chaincode interface and provide routing of calls to contracts</span></span><br><span class="line"><span class="keyword">type</span> ContractChaincode <span class="keyword">struct</span> &#123;</span><br><span class="line">DefaultContract       <span class="keyword">string</span></span><br><span class="line">contracts             <span class="keyword">map</span>[<span class="keyword">string</span>]contractChaincodeContract</span><br><span class="line">metadata              metadata.ContractChaincodeMetadata</span><br><span class="line">Info                  metadata.InfoMetadata</span><br><span class="line">TransactionSerializer serializer.TransactionSerializer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SystemContractName the name of the system smart contract</span></span><br><span class="line"><span class="keyword">const</span> SystemContractName = <span class="string">&quot;org.hyperledger.fabric&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NewChaincode creates a new chaincode using contracts passed. The function parses each</span></span><br><span class="line"><span class="comment">// of the passed functions and stores details about their make-up to be used by the chaincode.</span></span><br><span class="line"><span class="comment">// Public functions of the contracts are stored and are made callable in the chaincode. The function</span></span><br><span class="line"><span class="comment">// will error if contracts are invalid e.g. public functions take in illegal types. A system contract is added</span></span><br><span class="line"><span class="comment">// to the chaincode which provides functionality for getting the metadata of the chaincode. The generated</span></span><br><span class="line"><span class="comment">// metadata is a JSON formatted MetadataContractChaincode containing each contract as a name and details</span></span><br><span class="line"><span class="comment">// of the public functions and types they take in/return. It also outlines version details for contracts and the</span></span><br><span class="line"><span class="comment">// chaincode. If these are blank strings this is set to latest. The names for parameters do not match those used</span></span><br><span class="line"><span class="comment">// in the functions, instead they are recorded as param0, param1, ..., paramN. If there exists a file</span></span><br><span class="line"><span class="comment">// contract-metadata/metadata.json then this will overwrite the generated metadata. The contents of this file must</span></span><br><span class="line"><span class="comment">// validate against the schema. The transaction serializer for the contract is set to be the JSONSerializer by</span></span><br><span class="line"><span class="comment">// default. This can be updated using by changing the TransactionSerializer property</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨ä¼ å…¥çš„`ContractInterface`åˆ—è¡¨åˆ›å»ºä¸€ä¸ªæ–°çš„é“¾ç ï¼ˆè¯´æ˜é“¾ç å¹¶ä¸æ˜¯æ™ºèƒ½åˆçº¦ï¼Œé“¾ç åŒ…å«äº†å¾ˆå¤šæ™ºèƒ½åˆçº¦ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">// è¯¥å‡½æ•°è§£ææ¯ä¸ªè¢«ä¼ é€’è¿‡æ¥çš„`ContractInterface`çš„å‡½æ•°ï¼Œå¹¶å­˜å‚¨æœ‰å…³é“¾ç å°†ä½¿ç”¨çš„å…¶ç»„æˆçš„è¯¦ç»†ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="comment">// contractsçš„å…¬å…±æ–¹æ³•è¢«å­˜å‚¨å¹¶ä¸”å¯ä»¥åœ¨é“¾ç ä¸­è°ƒç”¨è¿™äº›å…¬å…±æ–¹æ³•ã€‚å¦‚æœåˆçº¦å®šä¹‰çš„ä¸åˆæ³•ï¼ˆå¦‚å…¬å…±æ–¹æ³•ä½¿ç”¨éæ³•çš„ç±»å‹ï¼‰è¿™ä¸ªæ–¹æ³•ä¼šæŠ¥é”™ã€‚</span></span><br><span class="line"><span class="comment">// ä¸€ä¸ªç³»ç»Ÿåˆçº¦å·²æ·»åŠ åˆ°é“¾ç ä¸­ï¼Œè¯¥åˆçº¦æä¾›äº†è·å–é“¾ç å…ƒæ•°æ®çš„åŠŸèƒ½ã€‚</span></span><br><span class="line"><span class="comment">// ç”Ÿæˆçš„å…ƒæ•°æ®æ˜¯JSONæ ¼å¼çš„MetadataContractChaincodeï¼Œå…¶ä¸­åŒ…å«æ¯ä¸ªåˆçº¦çš„åç§°ä»¥åŠå…¬å…±å‡½æ•°ä»¥åŠå®ƒä»¬å‚æ•°å’Œè¿”å›çš„ç±»å‹çš„è¯¦ç»†ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="comment">// å®ƒè¿˜æ¦‚è¿°äº†åˆåŒå’Œé“¾ç çš„ç‰ˆæœ¬è¯¦ç»†ä¿¡æ¯ã€‚ å¦‚æœè¿™äº›æ˜¯ç©ºç™½å­—ç¬¦ä¸²ï¼Œåˆ™å°†å…¶è®¾ç½®ä¸ºæœ€æ–°ã€‚</span></span><br><span class="line"><span class="comment">// å…ƒæ•°æ®å¯¹äºå…¬å…±æ–¹æ³•çš„æè¿°çš„å‚æ•°åç§°ä¸åŸå§‹å®šä¹‰çš„å‡½æ•°ä¸­ä½¿ç”¨çš„åç§°ä¸åŒ¹é…ï¼Œè€Œæ˜¯è®°å½•ä¸ºparam0ï¼Œparam1ï¼Œ...ï¼ŒparamNã€‚</span></span><br><span class="line"><span class="comment">// å¦‚æœå­˜åœ¨contract-metadata/metadata.jsonæ–‡ä»¶ï¼Œé‚£ä¹ˆå®ƒå°†è¦†ç›–ç”Ÿæˆçš„å…ƒæ•°æ®ã€‚ è¯¥æ–‡ä»¶çš„å†…å®¹å¿…é¡»æ ¹æ®æ¶æ„è¿›è¡ŒéªŒè¯ã€‚</span></span><br><span class="line"><span class="comment">// é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆçº¦çš„äº¤æ˜“åºåˆ—åŒ–å™¨è®¾ç½®ä¸ºJSONSerializerã€‚å¯ä»¥é€šè¿‡æ›´æ”¹TransactionSerializerå±æ€§æ¥æ›´æ”¹ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewChaincode</span><span class="params">(contracts ...ContractInterface)</span> <span class="params">(*ContractChaincode, error)</span></span> &#123;</span><br><span class="line">ciMethods := getCiMethods()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// newä¸€ä¸ªContractChaincode</span></span><br><span class="line">cc := <span class="built_in">new</span>(ContractChaincode)</span><br><span class="line">  <span class="comment">// è®¾ç½®ccçš„contractsä¸ºä¸€ä¸ªç©ºmap</span></span><br><span class="line">cc.contracts = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]contractChaincodeContract)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// éå†ä¼ å…¥çš„åˆçº¦åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">for</span> _, contract := <span class="keyword">range</span> contracts &#123;</span><br><span class="line">additionalExcludes := []<span class="keyword">string</span>&#123;&#125;</span><br><span class="line">    <span class="comment">// å¦‚æœä¼ å…¥çš„åˆçº¦ç±»å‹æ˜¯IgnoreContractInterface</span></span><br><span class="line"><span class="keyword">if</span> castContract, ok := contract.(IgnoreContractInterface); ok &#123;</span><br><span class="line">      <span class="comment">// åˆ™æŠŠcastContractä¸­çš„éœ€è¦å¿½ç•¥çš„æ–¹æ³•èµ‹å€¼ç»™additionalExcludesåˆ‡ç‰‡</span></span><br><span class="line">additionalExcludes = castContract.GetIgnoredFunctions()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å‘ccä¸­æ·»åŠ åˆçº¦ï¼Œä¸‹é¢å†çœ‹addContractæ–¹æ³•éƒ½å¹²äº†ä»€ä¹ˆ</span></span><br><span class="line">err := cc.addContract(contract, <span class="built_in">append</span>(ciMethods, additionalExcludes...))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆ›å»ºç³»ç»Ÿåˆçº¦ï¼Œå¹¶æŠŠç³»ç»Ÿåˆçº¦æ·»åŠ åˆ°é“¾ç ä¸­</span></span><br><span class="line">sysC := <span class="built_in">new</span>(SystemContract)</span><br><span class="line">sysC.Name = SystemContractName</span><br><span class="line"></span><br><span class="line">cc.addContract(sysC, ciMethods) <span class="comment">// should never error as system contract is good</span></span><br><span class="line"><span class="comment">// å¢åŠ å…ƒæ•°æ®</span></span><br><span class="line">err := cc.augmentMetadata()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">metadataJSON, _ := json.Marshal(cc.metadata)</span><br><span class="line"><span class="comment">// æŠŠå…ƒæ•°æ®è®¾ç½®åˆ°ç³»ç»Ÿåˆçº¦ä¸­</span></span><br><span class="line">sysC.setMetadata(<span class="keyword">string</span>(metadataJSON))</span><br><span class="line">  <span class="comment">// è®¾ç½®é“¾ç çš„äº¤æ˜“åºåˆ—åŒ–å™¨</span></span><br><span class="line">cc.TransactionSerializer = <span class="built_in">new</span>(serializer.JSONSerializer)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> cc, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Start starts the chaincode in the fabric shim</span></span><br><span class="line"><span class="comment">// åœ¨fabric shimä¸­å¯åŠ¨é“¾ç </span></span><br><span class="line"><span class="comment">// è‡³äºshimæ˜¯ä»€ä¹ˆï¼Œå…ˆäº†è§£å¤§æ¦‚ï¼šshimåŒ…ä¸ºé“¾ç æä¾›APIï¼Œè¿™äº›APIå¯ä»¥è®¿é—®çŠ¶æ€å˜é‡ã€äº¤æ˜“ä¸Šä¸‹æ–‡å’Œè°ƒç”¨å…¶ä»–çš„é“¾ç ã€‚</span></span><br><span class="line"><span class="comment">// shimåŒ…æºç æ³¨é‡Šï¼š</span></span><br><span class="line"><span class="comment">// Package shim provides APIs for the chaincode to access its state</span></span><br><span class="line"><span class="comment">// variables, transaction context and call other chaincodes.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cc *ContractChaincode)</span> <span class="title">Start</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> shim.Start(cc)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Init is called during Instantiate transaction after the chaincode container</span></span><br><span class="line"><span class="comment">// has been established for the first time, passes off details of the request to Invoke</span></span><br><span class="line"><span class="comment">// for handling the request if a function name is passed, otherwise returns shim.Success</span></span><br><span class="line"><span class="comment">// é¦–æ¬¡å»ºç«‹é“¾ç å®¹å™¨åï¼Œåœ¨å®ä¾‹åŒ–äº¤æ˜“ä¹‹å‰è°ƒç”¨Init</span></span><br><span class="line"><span class="comment">// å¦‚æœä¸€ä¸ªæ–¹æ³•åè¢«ä¼ é€’äº†è¿‡æ¥ï¼Œåˆ™æŠŠè¯·æ±‚çš„è¯¦æƒ…ä¼ é€’ç»™Invokeæ–¹æ³•æ¥å¤„ç†ï¼Œå¦åˆ™è¿”å›shim.Success</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cc *ContractChaincode)</span> <span class="title">Init</span><span class="params">(stub shim.ChaincodeStubInterface)</span> <span class="title">peer</span>.<span class="title">Response</span></span> &#123;</span><br><span class="line">nsFcn, _ := stub.GetFunctionAndParameters()</span><br><span class="line"><span class="keyword">if</span> nsFcn == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> shim.Success([]<span class="keyword">byte</span>(<span class="string">&quot;Default initiator successful.&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> cc.Invoke(stub)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Invoke is called to update or query the ledger in a proposal transaction. Takes the</span></span><br><span class="line"><span class="comment">// args passed in the transaction and uses the first argument to identify the contract</span></span><br><span class="line"><span class="comment">// and function of that contract to be called. The remaining args are then used as</span></span><br><span class="line"><span class="comment">// parameters to that function. Args are converted from strings to the expected parameter</span></span><br><span class="line"><span class="comment">// types of the function before being passed using the set transaction serializer for the ContractChaincode.</span></span><br><span class="line"><span class="comment">// A transaction context is generated and is passed, if required, as the first parameter to the named function.</span></span><br><span class="line"><span class="comment">// Before and after functions are called before and after the named function passed if the contract defines such</span></span><br><span class="line"><span class="comment">// functions to exist. If the before function returns an error the named function is not called and its error</span></span><br><span class="line"><span class="comment">// is returned in shim.Error. If the after function returns an error then its value is returned</span></span><br><span class="line"><span class="comment">// to shim.Error otherwise the value returned from the named function is returned as shim.Success (formatted by</span></span><br><span class="line"><span class="comment">// the transaction serializer). If an unknown name is passed as part of the first arg a shim.Error is returned.</span></span><br><span class="line"><span class="comment">// If a valid name is passed but the function name is unknown then the contract with that name&#x27;s</span></span><br><span class="line"><span class="comment">// unknown function is called and its value returned as success or error depending on its return. If no</span></span><br><span class="line"><span class="comment">// unknown function is defined for the contract then shim.Error is returned by Invoke. In the case of</span></span><br><span class="line"><span class="comment">// unknown function names being passed (and the unknown handler returns an error) or the named function</span></span><br><span class="line"><span class="comment">// returning an error then the after function if defined is not called. If the named function or unknown</span></span><br><span class="line"><span class="comment">// function handler returns a non-error type then then the after transaction is sent this value. The same</span></span><br><span class="line"><span class="comment">// transaction context is passed as a pointer to before, after, named and unknown functions on each Invoke.</span></span><br><span class="line"><span class="comment">// If no contract name is passed then the default contract is used.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cc *ContractChaincode)</span> <span class="title">Invoke</span><span class="params">(stub shim.ChaincodeStubInterface)</span> <span class="title">peer</span>.<span class="title">Response</span></span> &#123;</span><br><span class="line">  <span class="comment">// è·å–æ–¹æ³•å’Œå…¥å‚</span></span><br><span class="line">nsFcn, params := stub.GetFunctionAndParameters()</span><br><span class="line"><span class="comment">// è·å–å­—ç¬¦ä¸²&quot;:&quot;åœ¨nsFcnä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä¸‹æ ‡</span></span><br><span class="line">li := strings.LastIndex(nsFcn, å­—ç¬¦ä¸²<span class="string">&quot;:&quot;</span>åœ¨)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆçº¦</span></span><br><span class="line"><span class="keyword">var</span> ns <span class="keyword">string</span></span><br><span class="line">  <span class="comment">// æ–¹æ³•</span></span><br><span class="line"><span class="keyword">var</span> fn <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœnsFcnä¸­ä¸å­˜åœ¨&quot;:&quot;ï¼Œåˆ™è¯´æ˜æ²¡æœ‰æŒ‡å®šåˆçº¦åç§°</span></span><br><span class="line"><span class="keyword">if</span> li == <span class="number">-1</span> &#123;</span><br><span class="line">ns = cc.DefaultContract</span><br><span class="line">fn = nsFcn</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">ns = nsFcn[:li]</span><br><span class="line">fn = nsFcn[li+<span class="number">1</span>:]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœåˆçº¦åä¸åœ¨é“¾ç çš„åˆçº¦é‡Œé¢ï¼Œåˆ™æŠ¥é”™</span></span><br><span class="line"><span class="keyword">if</span> _, ok := cc.contracts[ns]; !ok &#123;</span><br><span class="line"><span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">&quot;Contract not found with name %s&quot;</span>, ns))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœæ–¹æ³•ä¸ºç©ºï¼Œåˆ™æŠ¥é”™</span></span><br><span class="line"><span class="keyword">if</span> fn == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> shim.Error(<span class="string">&quot;Blank function name passed&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">originalFn := fn</span><br><span class="line">  <span class="comment">// æŠŠfnå¼ºè½¬æˆrune(int32ç±»å‹çš„åˆ«å)</span></span><br><span class="line">fnRune := []<span class="keyword">rune</span>(fn)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœä¼ å…¥çš„æ–¹æ³•åçš„é¦–å­—æ¯æ˜¯å°å†™çš„ï¼Œåˆ™è½¬æ¢æˆå¤§å†™</span></span><br><span class="line"><span class="keyword">if</span> unicode.IsLower(fnRune[<span class="number">0</span>]) &#123;</span><br><span class="line">fnRune[<span class="number">0</span>] = unicode.ToUpper(fnRune[<span class="number">0</span>])</span><br><span class="line">fn = <span class="keyword">string</span>(fnRune)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä»é“¾ç çš„åˆçº¦åˆ—è¡¨ä¸­è·å–åˆçº¦</span></span><br><span class="line">nsContract := cc.contracts[ns]</span><br><span class="line"><span class="comment">// é€šè¿‡åå°„newä¸€ä¸ªtransactionContextHandlerç±»å‹ï¼›è¿™å‡ è¡Œæœ‰ç‚¹çœ‹ä¸æ‡‚äº†ï¼Œæš‚åœä¸€ä¸‹TODO</span></span><br><span class="line">ctx := reflect.New(nsContract.transactionContextHandler)</span><br><span class="line">ctxIface := ctx.Interface().(SettableTransactionContextInterface)</span><br><span class="line">ctxIface.SetStub(stub)</span><br><span class="line"></span><br><span class="line">ci, _ := cid.New(stub)</span><br><span class="line">ctxIface.SetClientIdentity(ci)</span><br><span class="line"></span><br><span class="line">beforeTransaction := nsContract.beforeTransaction</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> beforeTransaction != <span class="literal">nil</span> &#123;</span><br><span class="line">_, _, errRes := beforeTransaction.Call(ctx, <span class="literal">nil</span>, <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> errRes != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> shim.Error(errRes.Error())</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> successReturn <span class="keyword">string</span></span><br><span class="line"><span class="keyword">var</span> successIFace <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> errorReturn error</span><br><span class="line"></span><br><span class="line">serializer := cc.TransactionSerializer</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> _, ok := nsContract.functions[fn]; !ok &#123;</span><br><span class="line">unknownTransaction := nsContract.unknownTransaction</span><br><span class="line"><span class="keyword">if</span> unknownTransaction == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> shim.Error(fmt.Sprintf(<span class="string">&quot;Function %s not found in contract %s&quot;</span>, originalFn, ns))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">successReturn, successIFace, errorReturn = unknownTransaction.Call(ctx, <span class="literal">nil</span>, serializer)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">var</span> transactionSchema *metadata.TransactionMetadata</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, v := <span class="keyword">range</span> cc.metadata.Contracts[ns].Transactions &#123;</span><br><span class="line"><span class="keyword">if</span> v.Name == fn &#123;</span><br><span class="line">transactionSchema = &amp;v</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">successReturn, successIFace, errorReturn = nsContract.functions[fn].Call(ctx, transactionSchema, &amp;cc.metadata.Components, serializer, params...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> errorReturn != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> shim.Error(errorReturn.Error())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">afterTransaction := nsContract.afterTransaction</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> afterTransaction != <span class="literal">nil</span> &#123;</span><br><span class="line">_, _, errRes := afterTransaction.Call(ctx, successIFace, <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> errRes != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> shim.Error(errRes.Error())</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> shim.Success([]<span class="keyword">byte</span>(successReturn))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cc *ContractChaincode)</span> <span class="title">addContract</span><span class="params">(contract ContractInterface, excludeFuncs []<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="comment">// è¿”å›åˆåŒåç§°ã€‚å½“åˆåŒç”¨äºåˆ›å»ºæ–°çš„é“¾ç æ—¶ï¼Œå°†è°ƒç”¨æ­¤å‡½æ•°ï¼Œç„¶åä½¿ç”¨è¿”å›çš„åç§°åœ¨è°ƒç”¨Init/Invokeæ—¶åœ¨é“¾ç ä¸­æ ‡è¯†åˆåŒã€‚</span></span><br><span class="line"><span class="comment">// æ­¤å‡½æ•°å¯ä»¥è¿”å›ç©ºç™½å­—ç¬¦ä¸²ï¼Œä½†è¿™æ˜¯æœªå®šä¹‰çš„è¡Œä¸ºã€‚</span></span><br><span class="line">ns := contract.GetName()</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœåˆçº¦åç§°ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨åˆçº¦ç±»å‹é€šè¿‡åå°„çš„æ–¹å¼è·å–åˆçº¦çš„åç§°</span></span><br><span class="line"><span class="keyword">if</span> ns == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">ns = reflect.TypeOf(contract).Elem().Name()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœé“¾ç ä¸­å·²ç»åŒ…å«äº†ç›¸åŒçš„åˆçº¦åç§°ï¼Œåˆ™æŠ›å¼‚å¸¸</span></span><br><span class="line"><span class="keyword">if</span> _, ok := cc.contracts[ns]; ok &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;Multiple contracts being merged into chaincode with name %s&quot;</span>, ns)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ccn := contractChaincodeContract&#123;&#125;</span><br><span class="line">ccn.transactionContextHandler = reflect.ValueOf(contract.GetTransactionContextHandler()).Elem().Type()</span><br><span class="line">transactionContextPtrHandler := reflect.ValueOf(contract.GetTransactionContextHandler()).Type()</span><br><span class="line">ccn.functions = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]*internal.ContractFunction)</span><br><span class="line"><span class="comment">// GetInfoæ–¹æ³•è¿”å›å­˜å‚¨çš„åˆçº¦çš„ä¿¡æ¯ï¼Œè¿™ä¸ªä¿¡æ¯ä¼šç”¨äºæ„å»ºåˆçº¦çš„å…ƒæ•°æ®ã€‚å¦‚æœæ­¤ä¿¡æ¯ä¸­çš„ç‰ˆæœ¬ä¿¡æ¯ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨&quot;latest&quot;</span></span><br><span class="line"><span class="comment">// å¦‚æœä¿¡æ¯ä¸­çš„titleä¸ºç©ºï¼Œåˆ™ä½¿ç”¨åˆçº¦çš„GetNameæ–¹æ³•è¿”å›çš„åç§°ï¼Œå¦‚æœè¿™ä¸ªåç§°ä¹Ÿä¸ºç©ºï¼Œåˆ™ä½¿ç”¨åˆçº¦çš„ç±»å‹å</span></span><br><span class="line">ccn.info = contract.GetInfo()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ccn.info.Version == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">ccn.info.Version = <span class="string">&quot;latest&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ccn.info.Title == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">ccn.info.Title = ns</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contractType := reflect.PtrTo(reflect.TypeOf(contract).Elem())</span><br><span class="line">contractValue := reflect.ValueOf(contract).Elem().Addr()</span><br><span class="line"><span class="comment">// returns the unknown function to be used for a contract.</span></span><br><span class="line"><span class="comment">// When the contract is used in creating a new chaincode this function is called</span></span><br><span class="line"><span class="comment">// and the unknown transaction returned is stored. The unknown function is then</span></span><br><span class="line"><span class="comment">// called in cases where an unknown function name is passed for a call to the</span></span><br><span class="line"><span class="comment">// contract via Init/Invoke of the chaincode. If nil is returned the</span></span><br><span class="line"><span class="comment">// chaincode uses its default handling for unknown function names</span></span><br><span class="line"><span class="comment">// è¿”å›è¦ç”¨äºåˆçº¦çš„æœªçŸ¥å‡½æ•°ï¼Œå½“åˆçº¦è¢«ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„é“¾ç æ—¶æ­¤æ–¹æ³•è¢«è°ƒç”¨å¹¶ä¸”è¿”å›å­˜å‚¨çš„æœªçŸ¥çš„äº¤æ˜“ã€‚</span></span><br><span class="line"><span class="comment">// åœ¨é“¾ç é€šè¿‡Init/Invokeè°ƒç”¨åˆçº¦æ—¶ï¼Œå¦‚æœä¸€ä¸ªæœªçŸ¥çš„æ–¹æ³•åç§°è¢«ä¼ å…¥äº†åˆ™è°ƒç”¨æ­¤æœªçŸ¥æ–¹æ³•</span></span><br><span class="line"><span class="comment">// å¦‚æœæ­¤æ–¹æ³•è¿”å›nilã€‚åˆ™chaincodeä½¿ç”¨ä¸€ä¸ªé»˜è®¤å€¼æ¥å¤„ç†æœªçŸ¥çš„æ–¹æ³•å</span></span><br><span class="line"><span class="comment">// ä¸ªäººç†è§£å°±æ˜¯ä¸æŒ‡å®šæ–¹æ³•åè°ƒç”¨åˆçº¦æ—¶çš„é»˜è®¤å¤„ç†é€»è¾‘ã€‚</span></span><br><span class="line">ut := contract.GetUnknownTransaction()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ut != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">var</span> err error</span><br><span class="line">ccn.unknownTransaction, err = internal.NewTransactionHandler(ut, transactionContextPtrHandler, internal.TransactionHandlerTypeUnknown)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// returns the before function to be used for a contract.</span></span><br><span class="line"><span class="comment">// When the contract is used in creating a new chaincode this function is called</span></span><br><span class="line"><span class="comment">// and the before transaction returned is stored. The before function is then</span></span><br><span class="line"><span class="comment">// called before the named function on each Init/Invoke of that contract via the</span></span><br><span class="line"><span class="comment">// chaincode. When called the before function is passed no extra args, only the</span></span><br><span class="line"><span class="comment">// the transaction context (if specified to take it). If nil is returned</span></span><br><span class="line"><span class="comment">// then no before function is called on Init/Invoke.</span></span><br><span class="line"><span class="comment">// è¿”å›éœ€è¦å¯¹æ­¤åˆçº¦ä½¿ç”¨çš„å‰ç½®å‡½æ•°ï¼Œå½“åˆçº¦è¢«ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„é“¾ç æ—¶æ­¤æ–¹æ³•è¢«è°ƒç”¨å¹¶ä¸”è¿”å›å­˜å‚¨çš„å‰ç½®äº¤æ˜“ã€‚</span></span><br><span class="line"><span class="comment">// ç„¶åé€šè¿‡é“¾ç åœ¨è¯¥åˆçº¦ä½¿ç”¨Init/Invokeè°ƒç”¨æŒ‡å®šå‡½æ•°ä¹‹å‰è°ƒç”¨å‰ç½®å‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">// å½“è°ƒç”¨beforeå‡½æ•°æ—¶ï¼Œä¸ä¼ é€’ä»»ä½•é¢å¤–çš„å‚æ•°ï¼Œä»…ä¼ é€’äº‹åŠ¡ä¸Šä¸‹æ–‡ï¼ˆå¦‚æœæŒ‡å®šä½¿ç”¨å®ƒï¼‰ã€‚</span></span><br><span class="line"><span class="comment">// å¦‚æœæ­¤æ–¹æ³•è¿”å›nilï¼Œåˆ™åœ¨è°ƒç”¨Init/Invokeä¹‹å‰æ²¡æœ‰éœ€è¦æ‰§è¡Œçš„å‡½æ•°ã€‚</span></span><br><span class="line">bt := contract.GetBeforeTransaction()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> bt != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">var</span> err error</span><br><span class="line">ccn.beforeTransaction, err = internal.NewTransactionHandler(bt, transactionContextPtrHandler, internal.TransactionHandlerTypeBefore)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–åç½®å‡½æ•°ï¼Œåœ¨è°ƒç”¨åˆçº¦çš„æŒ‡å®šæ–¹æ³•ä¹‹åè°ƒç”¨æ­¤å‡½æ•°</span></span><br><span class="line">at := contract.GetAfterTransaction()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> at != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">var</span> err error</span><br><span class="line">ccn.afterTransaction, err = internal.NewTransactionHandler(at, transactionContextPtrHandler, internal.TransactionHandlerTypeAfter)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">evaluateMethods := []<span class="keyword">string</span>&#123;&#125;</span><br><span class="line"><span class="keyword">if</span> eci, ok := contract.(EvaluationContractInterface); ok &#123;</span><br><span class="line"><span class="comment">// returns a list of function names that should be tagged in the</span></span><br><span class="line"><span class="comment">// metadata as &quot;evaluate&quot; to indicate to a user of the chaincode that they should query</span></span><br><span class="line"><span class="comment">// rather than invoke these functions</span></span><br><span class="line"><span class="comment">// è¿”å›åº”è¯¥åœ¨å…ƒæ•°æ®ä¸Šæ‰“ä¸Š&quot;æ±‚å€¼&quot;æ ‡ç­¾çš„æ–¹æ³•åˆ—è¡¨ï¼Œæ¥å‘é“¾ç çš„ç”¨æˆ·å±•ç¤ºä»–ä»¬åº”è¯¥æŸ¥è¯¢è¿™ä¸ªå‡½æ•°è€Œä¸æ˜¯è°ƒç”¨å®ƒ</span></span><br><span class="line"><span class="comment">// ä¸ªäººç†è§£ï¼šæ‰€ä»¥è¿™äº›å‡½æ•°åº”è¯¥åªæ˜¯è®¡ç®—ä¸€äº›æ•°æ®çš„ï¼Œä¸ä¼šå¯¹è´¦æœ¬äº§ç”Ÿå½±å“ã€‚å¦‚æœå¯¹è´¦æœ¬äº§ç”Ÿå½±å“åˆæ‰“ä¸Šè¿™ä¸ªæ ‡ç­¾æ˜¯ä¸æ˜¯å¾ˆæµæ°“ï¼Ÿ</span></span><br><span class="line">evaluateMethods = eci.GetEvaluateTransactions()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// éå†åˆçº¦ä¸­çš„æ‰€æœ‰çš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; contractType.NumMethod(); i++ &#123;</span><br><span class="line">typeMethod := contractType.Method(i)</span><br><span class="line">valueMethod := contractValue.Method(i)</span><br><span class="line"><span class="comment">// å¦‚æœæ­¤æ–¹æ³•ä¸å†æ’é™¤çš„åˆ—è¡¨ä¸­ï¼Œåˆ™å¯ä»¥è°ƒç”¨</span></span><br><span class="line"><span class="keyword">if</span> !utils.StringInSlice(typeMethod.Name, excludeFuncs) &#123;</span><br><span class="line"><span class="keyword">var</span> err error</span><br><span class="line"><span class="comment">// é»˜è®¤çš„è°ƒç”¨æ–¹å¼æ˜¯CallTypeSubmit</span></span><br><span class="line"><span class="keyword">var</span> callType internal.CallType = internal.CallTypeSubmit</span><br><span class="line"><span class="comment">// å¦‚æœåœ¨åªç”¨äºè®¡ç®—çš„å‡½æ•°åˆ—è¡¨ä¸­ï¼Œåˆ™è°ƒç”¨æ–¹æ³•ä¿®æ”¹ä¸ºCallTypeEvaluateï¼›</span></span><br><span class="line"><span class="comment">// ä¸¤æ¬¡è°ƒç”¨StringInSliceä¼šéå†å•Šä¸¤ä¸ªåˆ—è¡¨ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥ç”¨mapæŠŠè¿™é‡Œä¼˜åŒ–ä¸€ä¸‹å‘¢ï¼Ÿ</span></span><br><span class="line"><span class="keyword">if</span> utils.StringInSlice(typeMethod.Name, evaluateMethods) &#123;</span><br><span class="line">callType = internal.CallTypeEvaluate</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆ›å»ºåˆçº¦çš„æ–¹æ³•</span></span><br><span class="line">ccn.functions[typeMethod.Name], err = internal.NewContractFunctionFromReflect(typeMethod, valueMethod, callType, transactionContextPtrHandler)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¦‚æœåˆçº¦æ–¹æ³•çš„åˆ—è¡¨ä¸ºç©ºï¼Œåˆ™æŠ¥é”™ï¼Œä¸€ä¸ªåˆçº¦ä¸­è‡³å°‘æœ‰ä¸€ä¸ªå…¬å…±æ–¹æ³•</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(ccn.functions) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;Contracts are required to have at least 1 (non-ignored) public method. Contract %s has none. Method names that have been ignored: %s&quot;</span>, ns, utils.SliceAsCommaSentence(excludeFuncs))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cc.contracts[ns] = ccn</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœé“¾ç çš„é»˜è®¤çš„åˆçº¦ä¸ºç©ºï¼Œåˆ™æŠŠå½“å‰çš„åˆçº¦è®¾ç½®ä¸ºé»˜è®¤çš„åˆçº¦ï¼›æ‰€ä»¥ä¼ å…¥çš„ç¬¬ä¸€ä¸ªåˆçº¦å°±æ˜¯é»˜è®¤çš„åˆçº¦</span></span><br><span class="line"><span class="keyword">if</span> cc.DefaultContract == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">cc.DefaultContract = ns</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åå°„çš„æ–¹å¼è·å–å…ƒæ•°æ®</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cc *ContractChaincode)</span> <span class="title">reflectMetadata</span><span class="params">()</span> <span class="title">metadata</span>.<span class="title">ContractChaincodeMetadata</span></span> &#123;</span><br><span class="line">reflectedMetadata := metadata.ContractChaincodeMetadata&#123;&#125;</span><br><span class="line">reflectedMetadata.Contracts = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]metadata.ContractMetadata)</span><br><span class="line">reflectedMetadata.Components.Schemas = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]metadata.ObjectMetadata)</span><br><span class="line">reflectedMetadata.Info = &amp;cc.Info</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> cc.Info.Version == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">reflectedMetadata.Info.Version = <span class="string">&quot;latest&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> cc.Info.Title == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">reflectedMetadata.Info.Title = <span class="string">&quot;undefined&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// éå†é“¾ç çš„åˆçº¦</span></span><br><span class="line"><span class="keyword">for</span> key, contract := <span class="keyword">range</span> cc.contracts &#123;</span><br><span class="line"><span class="comment">// åˆ›å»ºåˆçº¦çš„å…ƒæ•°æ®</span></span><br><span class="line">contractMetadata := metadata.ContractMetadata&#123;&#125;</span><br><span class="line">contractMetadata.Name = key</span><br><span class="line">infoCopy := contract.info</span><br><span class="line">contractMetadata.Info = &amp;infoCopy</span><br><span class="line"><span class="comment">// å¦‚æœè¿™ä¸ªåˆçº¦æ˜¯é»˜è®¤çš„åˆçº¦ï¼Œå…ƒæ•°æ®çš„å­—æ®µä¹Ÿè®¾ç½®ä¸ºtrue</span></span><br><span class="line"><span class="keyword">if</span> cc.DefaultContract == key &#123;</span><br><span class="line">contractMetadata.Default = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// éå†åˆçº¦çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¹¶åˆ›å»ºæ–¹æ³•çš„å…ƒæ•°æ®ï¼Œæœ€åæŠŠè¿™äº›æ–¹æ³•çš„å…ƒæ•°æ®åŠ å…¥åˆ°åˆçº¦çš„å…ƒæ•°æ®</span></span><br><span class="line"><span class="keyword">for</span> key, fn := <span class="keyword">range</span> contract.functions &#123;</span><br><span class="line">fnMetadata := fn.ReflectMetadata(key, &amp;reflectedMetadata.Components)</span><br><span class="line"></span><br><span class="line">contractMetadata.Transactions = <span class="built_in">append</span>(contractMetadata.Transactions, fnMetadata)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sort.Slice(contractMetadata.Transactions, <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> contractMetadata.Transactions[i].Name &lt; contractMetadata.Transactions[j].Name</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">reflectedMetadata.Contracts[key] = contractMetadata</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> reflectedMetadata</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cc *ContractChaincode)</span> <span class="title">augmentMetadata</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="comment">// è¯»å–å…ƒæ•°æ®çš„æ–‡ä»¶ï¼Œå°±æ˜¯ä¸Šé¢è¯´çš„contract-metadata/metadata.jsonæ–‡ä»¶</span></span><br><span class="line">fileMetadata, err := metadata.ReadMetadataFile()</span><br><span class="line"><span class="comment">// å¦‚æœæŠ¥é”™äº†å¹¶ä¸”æŠ¥é”™ä¿¡æ¯ä¸æ˜¯å› ä¸ºæ–‡ä»¶ä¸å­˜åœ¨çš„é”™è¯¯ï¼Œåˆ™æŠŠé”™è¯¯æŠ›å‡ºå»</span></span><br><span class="line"><span class="comment">// ä¼˜åŒ–å»ºè®®ï¼šè¿™é‡Œèƒ½ä¸èƒ½ä½¿ç”¨ä¸åŒçš„errorç±»å‹æ¥åšè¿™ç§åˆ¤æ–­å‘¢ï¼Œè¿™ä¹ˆåˆ¤æ–­å¦‚æœerrorä¿¡æ¯æ›´æ”¹äº†å°±å¿…é¡»ä¸¤ä¸ªåœ°æ–¹åŒæ—¶ä¿®æ”¹</span></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &amp;&amp; !strings.Contains(err.Error(), <span class="string">&quot;Failed to read metadata from file&quot;</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">reflectedMetadata := cc.reflectMetadata()</span><br><span class="line"></span><br><span class="line">fileMetadata.Append(reflectedMetadata)</span><br><span class="line">err = fileMetadata.CompileSchemas()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// éªŒè¯</span></span><br><span class="line">err = metadata.ValidateAgainstSchema(fileMetadata)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cc.metadata = fileMetadata</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getCiMethods è·å–åˆçº¦æ¥å£çš„æ–¹æ³•æè¿°çš„åˆ‡ç‰‡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getCiMethods</span><span class="params">()</span> []<span class="title">string</span></span> &#123;</span><br><span class="line">  <span class="comment">// é€šè¿‡åå°„çš„æ–¹å¼è·å–è¿™ä¸ªç±»å‹</span></span><br><span class="line">contractInterfaceType := reflect.TypeOf((*ContractInterface)(<span class="literal">nil</span>)).Elem()</span><br><span class="line">ignoreContractInterfaceType := reflect.TypeOf((*IgnoreContractInterface)(<span class="literal">nil</span>)).Elem()</span><br><span class="line">evaluateContractInterfaceType := reflect.TypeOf((*EvaluationContractInterface)(<span class="literal">nil</span>)).Elem()</span><br><span class="line"></span><br><span class="line">interfaceTypes := []reflect.Type&#123;contractInterfaceType, ignoreContractInterfaceType, evaluateContractInterfaceType&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// éå†è¿™äº›åå°„çš„ç±»å‹ï¼ŒæŠŠä»–ä»¬çš„æ–¹æ³•æè¿°æ·»åŠ åˆ°ciMethodsåˆ‡ç‰‡ä¸­</span></span><br><span class="line"><span class="keyword">var</span> ciMethods []<span class="keyword">string</span></span><br><span class="line"><span class="keyword">for</span> _, interfaceType := <span class="keyword">range</span> interfaceTypes &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; interfaceType.NumMethod(); i++ &#123;</span><br><span class="line">ciMethods = <span class="built_in">append</span>(ciMethods, interfaceType.Method(i).Name)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ciMethods</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> API </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> API </tag>
            
            <tag> contractapi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabricæ™ºèƒ½åˆçº¦APIå­¦ä¹ </title>
      <link href="2021/04/01/blockchain/fabric/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6API%E5%AD%A6%E4%B9%A0/Fabric%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6API%E5%AD%A6%E4%B9%A0/"/>
      <url>2021/04/01/blockchain/fabric/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6API%E5%AD%A6%E4%B9%A0/Fabric%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6API%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>è¿™ç¯‡æ–‡æ¡£é€šè¿‡å­¦ä¹ ä¹‹å‰å†™çš„chaincodeæ¥æŸ¥çœ‹Fabricçš„æ™ºèƒ½åˆçº¦ç›¸å…³çš„æºç ã€‚å¹¶å­¦ä¹ è¿™äº›æºç çš„åŠŸèƒ½ã€‚</p><h2 id="æ™ºèƒ½åˆçº¦é‡Œé¢çš„æ–¹æ³•å¦‚ä½•å®šä¹‰çš„">æ™ºèƒ½åˆçº¦é‡Œé¢çš„æ–¹æ³•å¦‚ä½•å®šä¹‰çš„</h2><p>æ™ºèƒ½åˆçº¦ä¸­çš„æ¯ä¸ªå¯¼å‡ºçš„æ–¹æ³•éƒ½å¿…é¡»æœ‰<code>contractapi.TransactionContextInterface</code>ç±»å‹çš„å‚æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•æ˜¯è¢«å®šä¹‰åœ¨<code>SmartContract</code>ä¸Šçš„ï¼Œå¦‚ä¸‹é¢ä¸€ä¸ªè·å–èµ„äº§å‡ºä»·ä»·æ ¼çš„æ–¹æ³•ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GetAssetBidPrice returns the bid price</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">GetAssetBidPrice</span><span class="params">(ctx contractapi.TransactionContextInterface, assetID <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">string</span>, error)</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> getAssetPrice(ctx, assetID, typeAssetBid)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>contractapi.TransactionContextInterface</code>çš„æºç å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TransactionContextInterface defines the interface which TransactionContext</span></span><br><span class="line"><span class="comment">// meets. This can be taken by transacton functions on a contract which has not set</span></span><br><span class="line"><span class="comment">// a custom transaction context to allow transaction functions to take an interface</span></span><br><span class="line"><span class="comment">// to simplify unit testing.</span></span><br><span class="line"><span class="comment">// äº¤æ˜“ä¸Šä¸‹æ–‡æ¥å£ï¼Œä¸ºäº†æ–¹ä¾¿æµ‹è¯•</span></span><br><span class="line"><span class="keyword">type</span> TransactionContextInterface <span class="keyword">interface</span> &#123;</span><br><span class="line"><span class="comment">// GetStub should provide a way to access the stub set by Init/Invoke</span></span><br><span class="line">  <span class="comment">// è·å–ç”±Init/Invokeè®¾ç½®çš„å­˜æ ¹</span></span><br><span class="line">GetStub() shim.ChaincodeStubInterface</span><br><span class="line"><span class="comment">// GetClientIdentity should provide a way to access the client identity set by Init/Invoke</span></span><br><span class="line">  <span class="comment">// è·å–ç”±Init/Invokeè®¾ç½®çš„å®¢æˆ·ç«¯èº«ä»½</span></span><br><span class="line">GetClientIdentity() cid.ClientIdentity</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="mockæ–¹å¼æµ‹è¯•shim-ChaincodeStubInterfaceä¸­çš„æ–¹æ³•">mockæ–¹å¼æµ‹è¯•<code>shim.ChaincodeStubInterface</code>ä¸­çš„æ–¹æ³•</h3><p>æ¥ç€çœ‹<code>shim.ChaincodeStubInterface</code>æœ‰å“ªäº›åŠŸèƒ½ï¼Œæºç åœ¨è¿™é‡Œå°±ä¸è´´äº†ï¼Œç›´æ¥çœ‹æµ‹è¯•ç”¨ä¾‹,ä¸‹é¢çš„æµ‹è¯•ç”¨ä¾‹çš„å…¥å£æ˜¯<code>TestStart</code>ï¼Œä¸åŒ…å«å°šæœªå®ç°mockçš„æ–¹æ³•ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> chaincode_test</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;encoding/json&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/hyperledger/fabric-chaincode-go/pkg/statebased&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;testing&quot;</span></span><br><span class="line"><span class="string">&quot;unsafe&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;github.com/guozhe001/learn-contractapi-go/chaincode&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/hyperledger/fabric-chaincode-go/shim&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/hyperledger/fabric-chaincode-go/shimtest&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/stretchr/testify/require&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mockInitLedger</span><span class="params">(t *testing.T, stub *shimtest.MockStub)</span></span> &#123;</span><br><span class="line">assets := []chaincode.Asset&#123;</span><br><span class="line">&#123;ID: AssetId, Color: <span class="string">&quot;blue&quot;</span>, Size: <span class="number">5</span>, Owner: <span class="string">&quot;Tomoko&quot;</span>, AppraisedValue: <span class="number">300</span>&#125;,</span><br><span class="line">&#123;ID: <span class="string">&quot;asset2&quot;</span>, Color: <span class="string">&quot;red&quot;</span>, Size: <span class="number">5</span>, Owner: <span class="string">&quot;Brad&quot;</span>, AppraisedValue: <span class="number">400</span>&#125;,</span><br><span class="line">&#123;ID: <span class="string">&quot;asset3&quot;</span>, Color: <span class="string">&quot;green&quot;</span>, Size: <span class="number">10</span>, Owner: <span class="string">&quot;Jin Soo&quot;</span>, AppraisedValue: <span class="number">500</span>&#125;,</span><br><span class="line">&#123;ID: <span class="string">&quot;asset4&quot;</span>, Color: <span class="string">&quot;yellow&quot;</span>, Size: <span class="number">10</span>, Owner: <span class="string">&quot;Max&quot;</span>, AppraisedValue: <span class="number">600</span>&#125;,</span><br><span class="line">&#123;ID: <span class="string">&quot;asset5&quot;</span>, Color: <span class="string">&quot;black&quot;</span>, Size: <span class="number">15</span>, Owner: <span class="string">&quot;Adriana&quot;</span>, AppraisedValue: <span class="number">700</span>&#125;,</span><br><span class="line">&#123;ID: <span class="string">&quot;asset6&quot;</span>, Color: <span class="string">&quot;white&quot;</span>, Size: <span class="number">15</span>, Owner: <span class="string">&quot;Michel&quot;</span>, AppraisedValue: <span class="number">800</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line">stub.MockTransactionStart(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">putState(t, stub, assets...)</span><br><span class="line">id := stub.GetTxID()</span><br><span class="line">timestamp, err := stub.GetTxTimestamp()</span><br><span class="line">channelID := stub.GetChannelID()</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">require.NotNil(t, timestamp)</span><br><span class="line">log.Printf(<span class="string">&quot;GetTxID()=%s, GetTxTimestamp()=%s, GetChannelID()=%s&quot;</span>, id, timestamp, channelID)</span><br><span class="line">stub.MockTransactionEnd(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">marshal</span><span class="params">(asset chaincode.Asset, t *testing.T)</span> []<span class="title">byte</span></span> &#123;</span><br><span class="line">assetJSON, err := json.Marshal(asset)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line"><span class="keyword">return</span> assetJSON</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#PutState()</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">putState</span><span class="params">(t *testing.T, stub *shimtest.MockStub, assets ...chaincode.Asset)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> _, asset := <span class="keyword">range</span> assets &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;putState=%v&quot;</span>, asset)</span><br><span class="line">require.NoError(t, stub.PutState(asset.ID, marshal(asset, t)))</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#GetState()</span></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#PutState()</span></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#DelState()</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getState</span><span class="params">(assetId <span class="keyword">string</span>, t *testing.T, stub *shimtest.MockStub)</span></span> &#123;</span><br><span class="line"><span class="comment">// è·å–æŒ‡å®škeyçš„èµ„äº§çš„ä¸–ç•ŒçŠ¶æ€</span></span><br><span class="line">state, err := stub.GetState(assetId)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">printAsset(t, state)</span><br><span class="line">newAssetID := <span class="string">&quot;temp001&quot;</span></span><br><span class="line">newAsset := chaincode.Asset&#123;ID: newAssetID, Color: <span class="string">&quot;blue&quot;</span>, Size: <span class="number">5</span>, Owner: <span class="string">&quot;Tomoko&quot;</span>, AppraisedValue: <span class="number">300</span>&#125;</span><br><span class="line"><span class="comment">// putä¸€ä¸ªæ–°çš„èµ„äº§</span></span><br><span class="line">putState(t, stub, newAsset)</span><br><span class="line"><span class="comment">// æŸ¥è¯¢æ–°çš„èµ„äº§</span></span><br><span class="line">newState, err := stub.GetState(newAssetID)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">require.NotNil(t, newState)</span><br><span class="line">printAsset(t, newState)</span><br><span class="line"><span class="comment">// æŒ‡å®šèµ„äº§IDåˆ é™¤èµ„äº§</span></span><br><span class="line">require.NoError(t, stub.DelState(newAssetID))</span><br><span class="line"><span class="comment">// åˆ é™¤ä¹‹åé‡æ–°æŸ¥è¯¢æ–°çš„èµ„äº§</span></span><br><span class="line">newStateAgain, err := stub.GetState(newAssetID)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">require.Nil(t, newStateAgain)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getHistoryForKey</span><span class="params">(assetId <span class="keyword">string</span>, t *testing.T, stub *shimtest.MockStub)</span></span> &#123;</span><br><span class="line"><span class="comment">// è·å–keyçš„å†å²æ•°æ®ï¼Œç›®å‰mockè¿˜æœªå®ç°</span></span><br><span class="line">history, err := stub.GetHistoryForKey(assetId)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line"><span class="keyword">if</span> history != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">if</span> history.HasNext() &#123;</span><br><span class="line">next, err := history.Next()</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">marshal, err := json.Marshal(next)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">log.Printf(<span class="string">&quot;asset=%s history=%s&quot;</span>, assetId, marshal)</span><br><span class="line">&#125;</span><br><span class="line">history.Close()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printAsset</span><span class="params">(t *testing.T, state []<span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> a chaincode.Asset</span><br><span class="line">require.NoError(t, json.Unmarshal(state, &amp;a))</span><br><span class="line">marshal, err := json.Marshal(a)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">log.Printf(<span class="string">&quot;result state json value = %s&quot;</span>, marshal)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#GetArgs()</span></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#GetStringArgs()</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getArgs</span><span class="params">(t *testing.T, stub *shimtest.MockStub)</span></span> &#123;</span><br><span class="line">args := stub.GetArgs()</span><br><span class="line"><span class="keyword">for</span> _, arg := <span class="keyword">range</span> args &#123;</span><br><span class="line">log.Print(<span class="keyword">string</span>(arg))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stringArgs := stub.GetStringArgs()</span><br><span class="line"><span class="keyword">for</span> _, argString := <span class="keyword">range</span> stringArgs &#123;</span><br><span class="line">log.Print(argString)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#GetStateByRange(startKey, endKey string) (StateQueryIteratorInterface, error)</span></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#GetStateByRangeWithPagination(startKey, endKey string, pageSize int32, bookmark string) (StateQueryIteratorInterface, *pb.QueryResponseMetadata, error)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getStateByRange</span><span class="params">(t *testing.T, stub *shimtest.MockStub)</span></span> &#123;</span><br><span class="line"><span class="comment">// GetStateByRangeä¸æŒ‡å®šstartKeyå’ŒendKeyï¼Œä¼šè¿”å›å…¨éƒ¨çš„èµ„äº§ï¼›è°¨æ…ä½¿ç”¨</span></span><br><span class="line">states, err := stub.GetStateByRange(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">printStateQueryIteratorInterface(t, states)</span><br><span class="line"><span class="comment">// GetStateByRangeWithPagination å› ä¸ºmockStubç›´æ¥è¿”å›ä¸‰ä¸ªnilï¼Œæ‰€ä»¥æ— æ³•åœ¨mockç¯å¢ƒæµ‹è¯•</span></span><br><span class="line">pagination, metadata, err := stub.GetStateByRangeWithPagination(<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="number">5</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">log.Print(<span class="string">&quot;==========================================================================================&quot;</span>)</span><br><span class="line">log.Printf(<span class="string">&quot;GetStateByRangeWithPagination metadata=%v&quot;</span>, metadata)</span><br><span class="line">printStateQueryIteratorInterface(t, pagination)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printStateQueryIteratorInterface</span><span class="params">(t *testing.T, states shim.StateQueryIteratorInterface)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> states != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">for</span> states.HasNext() &#123;</span><br><span class="line">next, err := states.Next()</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">log.Print(next)</span><br><span class="line">&#125;</span><br><span class="line">states.Close()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#CreateCompositeKey(objectType string, attributes []string) (string, error)</span></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#SplitCompositeKey(compositeKey string) (string, []string, error)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createCompositeKey</span><span class="params">(t *testing.T, stub *shimtest.MockStub)</span></span> &#123;</span><br><span class="line">objectType := <span class="string">&quot;test&quot;</span></span><br><span class="line">attributes := []<span class="keyword">string</span>&#123;<span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>, <span class="string">&quot;param3&quot;</span>, <span class="string">&quot;end&quot;</span>&#125;</span><br><span class="line"><span class="comment">// åˆ›å»ºç»„åˆkeyï¼Œæ‹¼æ¥äº†ä¸€ä¸‹</span></span><br><span class="line">key, err := stub.CreateCompositeKey(objectType, attributes)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">log.Printf(<span class="string">&quot;key=%s&quot;</span>, key)</span><br><span class="line"><span class="comment">// åˆ†å‰²ç»„åˆkeyï¼ŒCreateCompositeKeyçš„é€†è¿ç®—</span></span><br><span class="line">compositeKey, strings, err := stub.SplitCompositeKey(key)</span><br><span class="line">require.Equal(t, objectType, compositeKey)</span><br><span class="line">require.Equal(t, attributes, strings)</span><br><span class="line">newAsset := chaincode.Asset&#123;ID: key, Color: <span class="string">&quot;blue&quot;</span>, Size: <span class="number">5</span>, Owner: <span class="string">&quot;Tomoko&quot;</span>, AppraisedValue: <span class="number">300</span>&#125;</span><br><span class="line">putState(t, stub, newAsset)</span><br><span class="line">empty := []<span class="keyword">string</span>&#123;&#125;</span><br><span class="line"><span class="comment">// æ ¹æ®åˆ›å»ºç»„åˆkeyçš„å‚æ•°æŸ¥è¯¢ï¼Œåé¢çš„å‚æ•°å¯ä»¥æ˜¯ç©ºï¼Œè¿™æ ·ä¼šå…¨éƒ¨åŒ¹é…å‡ºæ¥</span></span><br><span class="line">states, err := stub.GetStateByPartialCompositeKey(objectType, empty)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">require.NotNil(t, states)</span><br><span class="line">printStateQueryIteratorInterface(t, states)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">AssetId        <span class="keyword">string</span> = <span class="string">&quot;asset1&quot;</span></span><br><span class="line">TestMSP        <span class="keyword">string</span> = <span class="string">&quot;TestMSP&quot;</span></span><br><span class="line">TestCollection <span class="keyword">string</span> = <span class="string">&quot;private_TestMSP&quot;</span></span><br><span class="line">Blank          <span class="keyword">string</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#SetStateValidationParameter(key string, ep []byte) error</span></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#GetStateValidationParameter(key string) ([]byte, error)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setStateValidationParameter</span><span class="params">(t *testing.T, stub *shimtest.MockStub)</span></span> &#123;</span><br><span class="line"><span class="comment">// æ–°å»ºä¸€ä¸ªåŸºäºçŠ¶æ€çš„èƒŒä¹¦ç­–ç•¥</span></span><br><span class="line">endorsementPolicy, err := statebased.NewStateEP(<span class="literal">nil</span>)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line"><span class="comment">// å‘èƒŒä¹¦ç­–ç•¥æ·»åŠ éœ€è¦èƒŒä¹¦çš„å…¬å¸</span></span><br><span class="line">require.NoError(t, endorsementPolicy.AddOrgs(statebased.RoleTypeMember, TestMSP))</span><br><span class="line">policy, err := endorsementPolicy.Policy()</span><br><span class="line">require.NoError(t, err)</span><br><span class="line"><span class="comment">// SetStateValidationParameterè®¾ç½®åŸºäºçŠ¶æ€çš„èƒŒä¹¦ç­–ç•¥</span></span><br><span class="line">require.NoError(t, stub.SetStateValidationParameter(AssetId, policy))</span><br><span class="line"><span class="comment">// GetStateValidationParameterè·å–åŸºäºçŠ¶æ€çš„èƒŒä¹¦ç­–ç•¥</span></span><br><span class="line">parameter, err := stub.GetStateValidationParameter(AssetId)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">str := byteToString(parameter)</span><br><span class="line"><span class="comment">// æ‰“å°å‡ºæ¥çš„StateValidationParameteræœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œæ‰€ä»¥ä½¿ç”¨åŒ…å«ä¼ å…¥çš„å­—ç¬¦çš„æ–¹å¼æ–­è¨€</span></span><br><span class="line">log.Printf(<span class="string">&quot;ID=%s, StateValidationParameter=%s&quot;</span>, AssetId, str)</span><br><span class="line">require.Contains(t, str, TestMSP)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#GetPrivateData(collection, key string) ([]byte, error)</span></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#GetPrivateDataHash(collection, key string) ([]byte, error) è·å–ç§æœ‰æ•°æ®çš„hashå€¼ï¼Œè¿™ä¸ªæ–¹æ³•å°±ç®—ä¸æ˜¯ç§æœ‰æ•°æ®çš„æ‰€æœ‰è€…ä¹Ÿå¯ä»¥è°ƒç”¨ï¼Œmockç‰ˆæœ¬æ²¡æœ‰å®ç°ï¼›</span></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#DelPrivateData(collection, key string) error åˆ é™¤ç§æœ‰æ•°æ®ï¼Œmockç‰ˆæœ¬æ²¡æœ‰å®ç°ï¼›</span></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#SetPrivateDataValidationParameter(collection, key string, ep []byte) error è®¾ç½®ç§æœ‰æ•°æ®çš„</span></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#GetPrivateDataValidationParameter(collection, key string) ([]byte, error)</span></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#GetPrivateDataByRange(collection, startKey, endKey string) (StateQueryIteratorInterface, error) æ ¹æ®èŒƒå›´æŸ¥è¯¢ç§æœ‰æ•°æ®</span></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#GetPrivateDataByPartialCompositeKey(collection, objectType string, keys []string) (StateQueryIteratorInterface, error)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getPrivateData</span><span class="params">(t *testing.T, stub *shimtest.MockStub)</span></span> &#123;</span><br><span class="line">key := <span class="string">&quot;private001&quot;</span></span><br><span class="line">privateAsset := chaincode.Asset&#123;ID: key, Color: <span class="string">&quot;blue&quot;</span>, Size: <span class="number">5</span>, Owner: <span class="string">&quot;Tomoko&quot;</span>, AppraisedValue: <span class="number">300</span>&#125;</span><br><span class="line">bytes, err := json.Marshal(privateAsset)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line"><span class="comment">// æ·»åŠ ç§æœ‰æ•°æ®</span></span><br><span class="line">require.NoError(t, stub.PutPrivateData(TestCollection, key, bytes))</span><br><span class="line"><span class="comment">// è·å–ç§æœ‰èµ„äº§</span></span><br><span class="line">data, err := stub.GetPrivateData(TestCollection, key)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">require.NotNil(t, data)</span><br><span class="line">printAsset(t, data)</span><br><span class="line"><span class="comment">// ä½¿ç”¨ä¸å­˜åœ¨çš„å…¶ä»–çš„collectionè·å–ç§æœ‰èµ„äº§ï¼Œä¸ä¼šè¿”å›errorï¼Œä¼šè¿”å›nilæ•°æ®</span></span><br><span class="line">data, err = stub.GetPrivateData(<span class="string">&quot;test_collections&quot;</span>, key)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">require.Nil(t, data)</span><br><span class="line"><span class="comment">// ä½¿ç”¨å…¶ä»–çš„keyè·å–ä¸å­˜åœ¨ç§æœ‰èµ„äº§</span></span><br><span class="line">data, err = stub.GetPrivateData(TestCollection, AssetId)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">require.Nil(t, data)</span><br><span class="line"><span class="comment">// æŸ¥è¯¢å…¬å…±èµ„äº§æ•°æ®,æ–­è¨€æ²¡æœ‰è¿™ä¸ªèµ„äº§</span></span><br><span class="line">state, err := stub.GetState(key)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">require.Nil(t, state)</span><br><span class="line"></span><br><span class="line">endorsementPolicy, err := statebased.NewStateEP(<span class="literal">nil</span>)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">require.NoError(t, endorsementPolicy.AddOrgs(statebased.RoleTypeMember, TestMSP))</span><br><span class="line">policy, err := endorsementPolicy.Policy()</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">require.NoError(t, stub.SetPrivateDataValidationParameter(TestCollection, key, policy))</span><br><span class="line">parameter, err := stub.GetPrivateDataValidationParameter(TestCollection, key)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">str := byteToString(parameter)</span><br><span class="line"><span class="comment">// æ‰“å°å‡ºæ¥çš„StateValidationParameteræœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œæ‰€ä»¥ä½¿ç”¨åŒ…å«ä¼ å…¥çš„å­—ç¬¦çš„æ–¹å¼æ–­è¨€</span></span><br><span class="line">log.Printf(<span class="string">&quot;ID=%s, StateValidationParameter=%s&quot;</span>, AssetId, str)</span><br><span class="line">require.Contains(t, str, TestMSP)</span><br><span class="line"><span class="comment">// GetPrivateDataHash(collection, key string) ([]byte, error) è·å–ç§æœ‰æ•°æ®çš„hashå€¼ï¼Œè¿™ä¸ªæ–¹æ³•å°±ç®—ä¸æ˜¯ç§æœ‰æ•°æ®çš„æ‰€æœ‰è€…ä¹Ÿå¯ä»¥è°ƒç”¨ï¼Œmockç‰ˆæœ¬æ²¡æœ‰å®ç°ï¼›</span></span><br><span class="line"><span class="comment">// DelPrivateData(collection, key string) error åˆ é™¤ç§æœ‰æ•°æ®ï¼Œmockç‰ˆæœ¬æ²¡æœ‰å®ç°ï¼›</span></span><br><span class="line"><span class="comment">//require.NoError(t, stub.DelPrivateData(TestCollection, key))</span></span><br><span class="line"><span class="comment">//// åˆ é™¤ä¹‹åå†æ¬¡æŸ¥è¯¢ï¼Œæ–­è¨€å·²ç»æ²¡æœ‰æ­¤èµ„äº§</span></span><br><span class="line"><span class="comment">//data, err = stub.GetPrivateData(TestCollection, key)</span></span><br><span class="line"><span class="comment">//require.NoError(t, err)</span></span><br><span class="line"><span class="comment">//require.Nil(t, state)</span></span><br><span class="line"><span class="comment">// GetPrivateDataByRangeæ²¡æœ‰å®ç°</span></span><br><span class="line"><span class="comment">//byRange, err := stub.GetPrivateDataByRange(TestCollection, Blank, Blank)</span></span><br><span class="line"><span class="comment">//require.NoError(t, err)</span></span><br><span class="line"><span class="comment">//require.NotNil(t, byRange)</span></span><br><span class="line"><span class="comment">//for byRange.HasNext() &#123;</span></span><br><span class="line"><span class="comment">//next, err := byRange.Next()</span></span><br><span class="line"><span class="comment">//require.NotNil(t, err)</span></span><br><span class="line"><span class="comment">//log.Print(next)</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">byteToString</span><span class="params">(data []<span class="keyword">byte</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">str := (*<span class="keyword">string</span>)(unsafe.Pointer(&amp;data))</span><br><span class="line"><span class="keyword">return</span> *str</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#ChaincodeStubInterface#GetCreator() ([]byte, error) è·å–ç­¾çº¦äº¤æ˜“æè®®çš„äººï¼Œç­¾çº¦æè®®çš„äººä¹Ÿæ˜¯è¿™ä¸ªäº¤æ˜“çš„åˆ›å»ºè€…; mockstubæœªå®ç°</span></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#GetTransient() (map[string][]byte, error) è·å–ä¸´æ—¶æ•°æ®ï¼Œè¿™ä¸ªæ–¹æ³•åªæœ‰è®¾ç½®äº†ä¸´æ—¶æ•°æ®çš„peeræ‰èƒ½æŸ¥åˆ°æ•°æ®ï¼Œä¸»è¦æ˜¯ä¸ºäº†åšéšç§ä¿æŠ¤çš„ï¼Œè¯¦æƒ…å‚è€ƒéšç§˜çš„äº¤æ˜“èµ„äº§</span></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#GetBinding() ([]byte, error) TODO å¾…ç†è§£</span></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#GetDecorations() ([]byte, error) TODO å¾…ç†è§£,ç›®å‰çœ‹æ˜¯ä¸ºäº†ä¼ é€’æ›´å¤šå…³äºæè®®çš„çš„é¢å¤–æ•°æ®</span></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#GetSignedProposal() ([]byte, error) è·å–æè®®</span></span><br><span class="line"><span class="comment">// ChaincodeStubInterface#SetEvent(name string, payload []byte) error  å…è®¸é“¾ç åœ¨æè®®çš„responseè®¾ç½®ä¸€ä¸ªäº‹ä»¶ã€‚æ— è®ºäº¤æ˜“çš„æœ‰æ•ˆæ€§å¦‚ä½•ï¼Œäº‹ä»¶éƒ½å°†åœ¨å·²æäº¤çš„å—ä¸­çš„äº¤æ˜“å†…å¯ç”¨ã€‚ä¸€ä¸ªäº¤æ˜“åªèƒ½åŒ…å«ä¸€ä¸ªäº‹ä»¶ï¼Œå¹¶ä¸”å¦‚æœæ˜¯é“¾ç è°ƒç”¨å¦ä¸€ä¸ªé“¾ç çš„æƒ…å†µï¼Œäº‹ä»¶åªèƒ½åœ¨æœ€å¤–å±‚ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">stubOthers</span><span class="params">(t *testing.T, stub *shimtest.MockStub)</span></span> &#123;</span><br><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>][]<span class="keyword">byte</span>)</span><br><span class="line">tempAsset := chaincode.Asset&#123;ID: <span class="string">&quot;temp001&quot;</span>, Color: <span class="string">&quot;blue&quot;</span>, Size: <span class="number">5</span>, Owner: <span class="string">&quot;Tomoko&quot;</span>, AppraisedValue: <span class="number">300</span>&#125;</span><br><span class="line">m[<span class="string">&quot;temp_asset&quot;</span>], _ = json.Marshal(tempAsset)</span><br><span class="line">require.NoError(t, stub.SetTransient(m))</span><br><span class="line">transient, err := stub.GetTransient()</span><br><span class="line">require.NoError(t, err)</span><br><span class="line">require.NotNil(t, transient)</span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> transient &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;k=%s, v=%s&quot;</span>, k, v)</span><br><span class="line">&#125;</span><br><span class="line">decorations := stub.GetDecorations()</span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> decorations &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;k=%s, v=%s&quot;</span>, k, v)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•shim.ChaincodeStubInterfaceæ¥å£</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">stubTest</span><span class="params">(t *testing.T, stub *shimtest.MockStub)</span></span> &#123;</span><br><span class="line">assetId := AssetId</span><br><span class="line">mockInitLedger(t, stub)</span><br><span class="line">stub.MockTransactionStart(<span class="string">&quot;test1&quot;</span>)</span><br><span class="line">getState(assetId, t, stub)</span><br><span class="line"><span class="comment">//getHistoryForKey(assetId, t, stub)</span></span><br><span class="line">getArgs(t, stub)</span><br><span class="line">stub.MockTransactionStart(<span class="string">&quot;test1&quot;</span>)</span><br><span class="line">getStateByRange(t, stub)</span><br><span class="line">createCompositeKey(t, stub)</span><br><span class="line">setStateValidationParameter(t, stub)</span><br><span class="line">getPrivateData(t, stub)</span><br><span class="line">stubOthers(t, stub)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•contractapi.Contractçš„æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">contractTest</span><span class="params">(t *testing.T, ccc *contractapi.ContractChaincode, stub *shimtest.MockStub)</span></span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;DefaultContract=%s&quot;</span>, ccc.DefaultContract)</span><br><span class="line">info := ccc.Info</span><br><span class="line">log.Printf(<span class="string">&quot;info=%v&quot;</span>, info)</span><br><span class="line">stub.MockTransactionStart(<span class="string">&quot;contract_test&quot;</span>)</span><br><span class="line"><span class="comment">// å¦‚æœè°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œå¦‚æœå®ç°äº†GetUnknownTransactionæ¥å£ï¼Œåˆ™ä¼šæ‰§è¡Œæ­¤æ¥å£è¿”å›çš„æ–¹æ³•ï¼›å¦åˆ™ä¸æ‰§è¡Œï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯å¦‚æœæœ‰beforeæ–¹æ³•æ˜¯ä¼šæ‰§è¡Œçš„</span></span><br><span class="line">response := stub.MockInvoke(<span class="string">&quot;uuid_002&quot;</span>, [][]<span class="keyword">byte</span>&#123;[]<span class="keyword">byte</span>(<span class="string">&quot;Unknow&quot;</span>)&#125;)</span><br><span class="line">log.Printf(<span class="string">&quot;response=%#v, response.Status=%d, response.Payload=%s&quot;</span>, response, response.Status, byteToString(response.Payload))</span><br><span class="line"><span class="comment">// è°ƒç”¨ä¸€ä¸ªè¢«å¿½ç•¥çš„æ–¹æ³•, è™½ç„¶IgnoredMeæ–¹æ³•åœ¨æ™ºèƒ½åˆçº¦ä¸­å­˜åœ¨ï¼Œä½†æ˜¯å› ä¸ºåˆçº¦æ»¡è¶³IgnoreContractInterfaceæ¥å£ç„¶åæŠŠè¿™ä¸ªæ–¹æ³•åŠ å…¥åˆ°äº†å¿½ç•¥åˆ—è¡¨ä¸­ï¼Œæ‰€ä»¥æœ€åè¿˜æ˜¯è°ƒç”¨çš„é»˜è®¤æ–¹æ³•</span></span><br><span class="line">response = stub.MockInvoke(<span class="string">&quot;uuid_002&quot;</span>, [][]<span class="keyword">byte</span>&#123;[]<span class="keyword">byte</span>(<span class="string">&quot;IgnoredMe&quot;</span>)&#125;)</span><br><span class="line">log.Printf(<span class="string">&quot;response=%#v, response.Status=%d, response.Payload=%s&quot;</span>, response, response.Status, byteToString(response.Payload))</span><br><span class="line"><span class="comment">// æŒ‡å®šæŸä¸ªæŒ‡å®šåˆçº¦ï¼Œè°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œå†’å·å‰é¢çš„éƒ¨åˆ†æ˜¯æ™ºèƒ½åˆçº¦åç§°ï¼Œåé¢æ˜¯æ–¹æ³•åç§°</span></span><br><span class="line">response = stub.MockInvoke(<span class="string">&quot;uuid_002&quot;</span>, [][]<span class="keyword">byte</span>&#123;[]<span class="keyword">byte</span>(<span class="string">&quot;TestSmartContract:Unknow&quot;</span>)&#125;)</span><br><span class="line">log.Printf(<span class="string">&quot;response=%#v, response.Status=%d, response.Payload=%s&quot;</span>, response, response.Status, byteToString(response.Payload))</span><br><span class="line"><span class="comment">//invoke := ccc.Invoke(stub)</span></span><br><span class="line"><span class="comment">//log.Printf(&quot;response=%v&quot;, invoke)</span></span><br><span class="line">stub.MockTransactionEnd(<span class="string">&quot;uuid_001&quot;</span>)</span><br><span class="line">transactionSerializer := ccc.TransactionSerializer</span><br><span class="line">log.Printf(<span class="string">&quot;transactionSerializer=%v&quot;</span>, transactionSerializer)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµ‹è¯•å…¥å£</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestStart</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"><span class="comment">// ä¸€ä¸ªé“¾ç åŒ…ä¸­å¯ä»¥æœ‰å¤šä¸ªæ™ºèƒ½åˆçº¦</span></span><br><span class="line">assetChaincode, err := contractapi.NewChaincode(&amp;chaincode.SmartContract&#123;&#125;, &amp;TestSmartContract&#123;&#125;)</span><br><span class="line">require.NoError(t, err)</span><br><span class="line"><span class="comment">// NewMockStub</span></span><br><span class="line">stub := shimtest.NewMockStub(<span class="string">&quot;mockSub&quot;</span>, assetChaincode)</span><br><span class="line">stubTest(t, stub)</span><br><span class="line">contractTest(t, assetChaincode, stub)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TestSmartContract <span class="keyword">struct</span> &#123;</span><br><span class="line">contractapi.Contract</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetUnknownTransaction returns the current set unknownTransaction, may be nil</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *TestSmartContract)</span> <span class="title">GetUnknownTransaction</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line"><span class="keyword">return</span> t.UnknownTransaction</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Default å¦‚æœä¸æŒ‡å®šæ–¹æ³•åç§°æ—¶æŒ‡å®šçš„é»˜è®¤æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *TestSmartContract)</span> <span class="title">UnknownTransaction</span><span class="params">(ctx contractapi.TransactionContextInterface)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;hello, i&#x27;m Default func in TestSmartContractï¼&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;i&#x27;m TestSmartContract, Bye!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨æ™ºèƒ½åˆçº¦ä¸­æ·»åŠ äº†å¦‚ä¸‹çš„ä¸€äº›æ–¹æ³•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// GetUnknownTransaction returns the current set unknownTransaction, may be nil</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">GetUnknownTransaction</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line"><span class="keyword">return</span> s.UnknownTransaction</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Default å¦‚æœä¸æŒ‡å®šæ–¹æ³•åç§°æ—¶æŒ‡å®šçš„é»˜è®¤æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">UnknownTransaction</span><span class="params">(ctx contractapi.TransactionContextInterface)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;hello, i&#x27;m Default funcï¼&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;Bye!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetBeforeTransaction returns the current set beforeTransaction, may be nil</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">GetBeforeTransaction</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line"><span class="keyword">return</span> s.BeforeTransaction</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">BeforeTransaction</span><span class="params">(ctx contractapi.TransactionContextInterface)</span></span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;i&#x27;m BeforeTransaction&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetAfterTransaction returns the current set afterTransaction, may be nil</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">GetAfterTransaction</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line"><span class="keyword">return</span> s.AfterTransaction</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">AfterTransaction</span><span class="params">(ctx contractapi.TransactionContextInterface)</span></span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;i&#x27;m AfterTransaction&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">IgnoredMe</span><span class="params">(ctx contractapi.TransactionContextInterface)</span></span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;Ignored Me!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">GetIgnoredFunctions</span><span class="params">()</span> []<span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> []<span class="keyword">string</span>&#123;<span class="string">&quot;IgnoredMe&quot;</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•æ— æ³•mockæµ‹è¯•çš„shim-ChaincodeStubInterfaceæ–¹æ³•">æµ‹è¯•æ— æ³•mockæµ‹è¯•çš„<code>shim.ChaincodeStubInterface</code>æ–¹æ³•</h3><p>ä¸€äº›å…¶ä»–çš„æ— æ³•ä½¿ç”¨<code>shimtests</code>åšmockæµ‹è¯•çš„<code>shim.ChaincodeStubInterface</code>æ–¹æ³•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// SomeStubMethod stubå…¶ä»–çš„æ— æ³•é€šè¿‡mockæ–¹å¼æµ‹è¯•çš„æ–¹æ³•ç»ƒä¹ </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">SomeStubMethod</span><span class="params">(ctx contractapi.TransactionContextInterface, assetID <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">stub := ctx.GetStub()</span><br><span class="line"><span class="comment">// stub.GetArgs()å’Œstub.GetStringArgs()éƒ½æ˜¯è·å–è°ƒç”¨é“¾ç æ—¶çš„å…¥å‚ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ—¶æ–¹æ³•åï¼Œåé¢çš„å‚æ•°æ˜¯è¿™ä¸ªæ–¹æ³•çš„å‚æ•°çš„ä¿¡æ¯,å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment">// 2021/01/25 08:06:32 stub.GetArgs(),i=0, arg=Practice_SmartContract:SomeStubMethod</span></span><br><span class="line"><span class="comment">//2021/01/25 08:06:32 stub.GetArgs(),i=1, arg=asset1</span></span><br><span class="line"><span class="keyword">for</span> i, arg := <span class="keyword">range</span> stub.GetArgs() &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;stub.GetArgs(),i=%d, arg=%s&quot;</span>, i, byteToString(arg))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> i, arg := <span class="keyword">range</span> stub.GetStringArgs() &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;stub.GetStringArgs(),i=%d, arg=%s&quot;</span>, i, arg)</span><br><span class="line">&#125;</span><br><span class="line">binding, err := stub.GetBinding()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">log.Printf(<span class="string">&quot;stub.GetBinding()=%s&quot;</span>, byteToString(binding))</span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> stub.GetDecorations() &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;stub.GetDecorations(), k=%s, v=%s&quot;</span>, k, byteToString(v))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// stub.GetCreator()è¿”å›çš„æ˜¯è¯ä¹¦ï¼Œå¦‚è¿‡æ˜¯ç»„ç»‡s2.supply.comçš„ç®¡ç†å‘˜å‘èµ·çš„äº¤æ˜“ï¼Œåˆ™æ­¤å¤„è·å¾—çš„æ˜¯ï¼šAdmin@s2.supply.com-cert.pem</span></span><br><span class="line">creator, err := stub.GetCreator()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">log.Printf(<span class="string">&quot;stub.GetCreator()=%s&quot;</span>, byteToString(creator))</span><br><span class="line"><span class="comment">// å·²ç»ç­¾åçš„æè®®ï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</span></span><br><span class="line"><span class="comment">// 1.é€šé“åç§°</span></span><br><span class="line"><span class="comment">// 2.é“¾ç åç§°</span></span><br><span class="line"><span class="comment">// 3.å‘èµ·äº¤æ˜“çš„ç»„ç»‡åç§°</span></span><br><span class="line"><span class="comment">// 4.å‘èµ·äº¤æ˜“çš„äººçš„è¯ä¹¦</span></span><br><span class="line"><span class="comment">// 5.è°ƒç”¨é“¾ç æ—¶çš„å…¥å‚ï¼šæ–¹æ³•åï¼Œå‚æ•°ç­‰</span></span><br><span class="line"><span class="comment">// stub.GetSignedProposal().GetProposalBytes()çš„ä¿¡æ¯å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment">//2021/01/25 08:06:32 stub.GetSignedProposal().GetProposalBytes()=</span></span><br><span class="line"><span class="comment">//ï¿½</span></span><br><span class="line"><span class="comment">//vï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½&quot;alljoinchannel*@252b6bbd22eeaf2193cdbc86fe7bd9fa257e33a6209a5da7d81dcc41b8bb1b9d:secured_supplyï¿½</span></span><br><span class="line"><span class="comment">//ï¿½</span></span><br><span class="line"><span class="comment">//GylSOrg2MSPï¿½-----BEGIN CERTIFICATE-----</span></span><br><span class="line"><span class="comment">//MIICETCCAbegAwIBAgIRAJw2YUKkmyKusGHm33D7LhkwCgYIKoZIzj0EAwIwbTEL</span></span><br><span class="line"><span class="comment">//MAkGA1UEBhMCVVMxEzARBgNVBAgTCkNhbGlmb3JuaWExFjAUBgNVBAcTDVNhbiBG</span></span><br><span class="line"><span class="comment">//cmFuY2lzY28xFjAUBgNVBAoTDXMyLnN1cHBseS5jb20xGTAXBgNVBAMTEGNhLnMy</span></span><br><span class="line"><span class="comment">//LnN1cHBseS5jb20wHhcNMjEwMTA3MDgzMTAwWhcNMzEwMTA1MDgzMTAwWjBYMQsw</span></span><br><span class="line"><span class="comment">//CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMNU2FuIEZy</span></span><br><span class="line"><span class="comment">//YW5jaXNjbzEcMBoGA1UEAwwTQWRtaW5AczIuc3VwcGx5LmNvbTBZMBMGByqGSM49</span></span><br><span class="line"><span class="comment">//AgEGCCqGSM49AwEHA0IABJ6An5vHmug1YBIUXKuD50ZJ79TiwDkW5uEr2ZkXU5Em</span></span><br><span class="line"><span class="comment">//XwVlxwCOKpfqKOr1Xdk0DWMlAQPQIxeXktdVBJxFc4KjTTBLMA4GA1UdDwEB/wQE</span></span><br><span class="line"><span class="comment">//AwIHgDAMBgNVHRMBAf8EAjAAMCsGA1UdIwQkMCKAIGO9q5qcp089i7bDqwyxRYdg</span></span><br><span class="line"><span class="comment">//aX65Bvs4X5wCsXWbxj37MAoGCCqGSM49BAMCA0gAMEUCIQCRBC/uF8ooaLQzSDo6</span></span><br><span class="line"><span class="comment">//e5+4UbBqjSi5MUy3IYfVrM5tHQIgaGHKXcKZY7q0Txs6LsbtayW6kWPOAee6Z1W8</span></span><br><span class="line"><span class="comment">//top2VDc=</span></span><br><span class="line"><span class="comment">//-----END CERTIFICATE-----</span></span><br><span class="line"><span class="comment">//ï¿½wï¿½&#125;dÈ§C&gt;ï¿½vï¿½@ï¿½Elï¿½Sï¿½ï¿½ï¿½ï¿½I</span></span><br><span class="line"><span class="comment">//G</span></span><br><span class="line"><span class="comment">//Esecured_supply/</span></span><br><span class="line"><span class="comment">//%Practice_SmartContract:SomeStubMethod</span></span><br><span class="line"><span class="comment">//asset1</span></span><br><span class="line">proposal, err := stub.GetSignedProposal()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">log.Printf(<span class="string">&quot;stub.GetSignedProposal()=%#v&quot;</span>, proposal)</span><br><span class="line">bytes := proposal.GetProposalBytes()</span><br><span class="line">log.Printf(<span class="string">&quot;stub.GetSignedProposal().GetProposalBytes()=%s&quot;</span>, byteToString(bytes))</span><br><span class="line">p := &amp;peer.Proposal&#123;&#125;</span><br><span class="line">err = proto.Unmarshal(bytes, p)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">log.Printf(<span class="string">&quot;stub.GetSignedProposal().GetProposalBytes(),proto.Unmarshal=%#v&quot;</span>, p)</span><br><span class="line"><span class="comment">//headerBytes:= p.GetHeader()</span></span><br><span class="line"><span class="comment">//header := &amp;peer.ChaincodeHeaderExtension&#123;&#125;</span></span><br><span class="line"><span class="comment">//err = proto.Unmarshal(headerBytes, header)</span></span><br><span class="line"><span class="comment">//if err != nil &#123;</span></span><br><span class="line"><span class="comment">//return err</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//log.Printf(&quot;stub.GetSignedProposal().GetProposalBytes()-Proposal-GetHeader()=%#v&quot;, header)</span></span><br><span class="line"><span class="comment">//payloadBytes := p.GetPayload()</span></span><br><span class="line"><span class="comment">//payload := &amp;peer.ChaincodeProposalPayload&#123;&#125;</span></span><br><span class="line"><span class="comment">//err = proto.Unmarshal(payloadBytes, payload)</span></span><br><span class="line"><span class="comment">//if err != nil &#123;</span></span><br><span class="line"><span class="comment">//return err</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//log.Printf(&quot;stub.GetSignedProposal().GetProposalBytes()-Proposal-GetPayload()=%#v&quot;, payload)</span></span><br><span class="line">log.Printf(<span class="string">&quot;stub.GetSignedProposal().GetSignature()=%s&quot;</span>, byteToString(proposal.GetSignature()))</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®ä¸€ä¸ªEvent</span></span><br><span class="line"><span class="keyword">if</span> err := stub.SetEvent(<span class="string">&quot;hello event&quot;</span>, []<span class="keyword">byte</span>(<span class="string">&quot;hello&quot;</span>)); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2021/01/25 10:22:57 stub.GetHistoryForKey(asset1), next=&amp;queryresult.KeyModification&#123;</span></span><br><span class="line"><span class="comment">//TxId:&quot;f251ce5352e294cd628fc0b5d09271ebe8253b41d66069c164195fe2783c3adc&quot;,</span></span><br><span class="line"><span class="comment">//Value:[]uint8&#123;0x7b, 0x22, 0x49, 0x44, 0x22, 0x3a, 0x22, 0x61, 0x73, 0x73, 0x65, 0x74, 0x31, 0x22, 0x2c</span></span><br><span class="line"><span class="comment">//, 0x22, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x22, 0x3a, 0x22, 0x62, 0x6c, 0x75, 0x65, 0x22, 0x2c, 0x22, 0x73, 0x69, 0x7a, 0x65, 0x22, 0x3a, 0x35, 0x2c, 0x22, 0x6f, 0x77, 0x6e, 0x65, 0x72, 0x22, 0x3a, 0x22, 0x54, 0x6f, 0x6d, 0x6f, 0x6b, 0x6f, 0x22, 0x2c, 0x22, 0x61, 0x70, 0x70, 0x72, 0x61, 0x69, 0x73, 0x65, 0x64, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x22, 0x3a, 0x33, 0x30, 0x30, 0x7d&#125;,</span></span><br><span class="line"><span class="comment">//Timestamp:(*timestamp.Timestamp)(0xc00043d1a0),</span></span><br><span class="line"><span class="comment">//IsDelete:false, XXX_NoUnkeyedLiteral:struct &#123;&#125;&#123;&#125;,</span></span><br><span class="line"><span class="comment">//XXX_unrecognized:[]uint8(nil),</span></span><br><span class="line"><span class="comment">//XXX_sizecache:0&#125;</span></span><br><span class="line">assetHistory, err := stub.GetHistoryForKey(assetID)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> assetHistory.Close()</span><br><span class="line"><span class="keyword">for</span> assetHistory.HasNext() &#123;</span><br><span class="line">next, err := assetHistory.Next()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">log.Printf(<span class="string">&quot;stub.GetHistoryForKey(%s), next=%#v&quot;</span>, assetID, next)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">byteToString</span><span class="params">(data []<span class="keyword">byte</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">str := (*<span class="keyword">string</span>)(unsafe.Pointer(&amp;data))</span><br><span class="line"><span class="keyword">return</span> *str</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>shimåŒ…ä¸‹é¢ä¹Ÿæœ‰ä¸€ä¸ª<code>GetMSPID</code>æ–¹æ³•ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// GetMSPID returns the local mspid of the peer by checking the CORE_PEER_LOCALMSPID</span></span><br><span class="line"><span class="comment">// env var and returns an error if the env var is not set</span></span><br><span class="line"><span class="comment">// é€šè¿‡æ£€æŸ¥ç¯å¢ƒå˜é‡CORE_PEER_LOCALMSPIDè¿”å›peerèŠ‚ç‚¹æœ¬åœ°çš„mspidï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®è¿™ä¸ªç¯å¢ƒå˜é‡åˆ™è¿”å›ä¸€ä¸ªerror</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetMSPID</span><span class="params">()</span> <span class="params">(<span class="keyword">string</span>, error)</span></span> &#123;</span><br><span class="line">mspid := os.Getenv(<span class="string">&quot;CORE_PEER_LOCALMSPID&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> mspid == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, errors.New(<span class="string">&quot;&#x27;CORE_PEER_LOCALMSPID&#x27; is not set&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> mspid, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>TODO å¾…æ•´åˆåˆ°ä¸€èµ·</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> SPDX-License-Identifier: Apache-2.0</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;bytes&quot;</span></span><br><span class="line"><span class="string">&quot;crypto/sha256&quot;</span></span><br><span class="line"><span class="string">&quot;encoding/json&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;github.com/golang/protobuf/ptypes&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/hyperledger/fabric-chaincode-go/pkg/statebased&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/hyperledger/fabric-chaincode-go/shim&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">typeAssetForSale     = <span class="string">&quot;S&quot;</span></span><br><span class="line">typeAssetBid         = <span class="string">&quot;B&quot;</span></span><br><span class="line">typeAssetSaleReceipt = <span class="string">&quot;SR&quot;</span></span><br><span class="line">typeAssetBuyReceipt  = <span class="string">&quot;BR&quot;</span></span><br><span class="line">statusEnable         = <span class="string">&quot;enable&quot;</span></span><br><span class="line">statusDelete         = <span class="string">&quot;delete&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SmartContract <span class="keyword">struct</span> &#123;</span><br><span class="line">contractapi.Contract</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Asset struct and properties must be exported (start with capitals) to work with contract api metadata</span></span><br><span class="line"><span class="keyword">type</span> Asset <span class="keyword">struct</span> &#123;</span><br><span class="line">ObjectType        <span class="keyword">string</span> <span class="string">`json:&quot;objectType&quot;`</span> <span class="comment">// ObjectType is used to distinguish different object types in the same chaincode namespace</span></span><br><span class="line">ID                <span class="keyword">string</span> <span class="string">`json:&quot;assetID&quot;`</span></span><br><span class="line">OwnerOrg          <span class="keyword">string</span> <span class="string">`json:&quot;ownerOrg&quot;`</span></span><br><span class="line">PublicDescription <span class="keyword">string</span> <span class="string">`json:&quot;publicDescription&quot;`</span></span><br><span class="line">Status            <span class="keyword">string</span> <span class="string">`json:&quot;status&quot;`</span></span><br><span class="line">ParentID          <span class="keyword">string</span> <span class="string">`json:&quot;parentID&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> receipt <span class="keyword">struct</span> &#123;</span><br><span class="line">price     <span class="keyword">int</span></span><br><span class="line">timestamp time.Time</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AssetProperties èµ„äº§å±æ€§</span></span><br><span class="line"><span class="keyword">type</span> AssetProperties <span class="keyword">struct</span> &#123;</span><br><span class="line">ObjectType <span class="keyword">string</span>    <span class="string">`json:&quot;objectType&quot;`</span> <span class="comment">// ObjectType is used to distinguish different object types in the same chaincode namespace</span></span><br><span class="line">ID         <span class="keyword">string</span>    <span class="string">`json:&quot;assetID&quot;`</span></span><br><span class="line">Issuer     <span class="keyword">string</span>    <span class="string">`json:&quot;issuer&quot;`</span></span><br><span class="line">Amount     <span class="keyword">int</span>       <span class="string">`json:&quot;amount&quot;`</span></span><br><span class="line">CreateDate time.Time <span class="string">`json:&quot;createDate&quot;`</span></span><br><span class="line">EndDate    time.Time <span class="string">`json:&quot;endDate&quot;`</span></span><br><span class="line">Salt       <span class="keyword">string</span>    <span class="string">`json:&quot;salt&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CreateAsset creates an asset and sets it as owned by the client&#x27;s org</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">CreateAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, assetID, publicDescription <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="comment">// è·å–ä¸´æ—¶æ•°æ®åº“çš„æ•°æ®ï¼Œè¿”å›ä¸€ä¸ªmap[string][]byte</span></span><br><span class="line">transientMap, err := ctx.GetStub().GetTransient()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;error getting transient: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Asset properties must be retrieved from the transient field as they are private</span></span><br><span class="line">immutablePropertiesJSON, ok := transientMap[<span class="string">&quot;asset_properties&quot;</span>]</span><br><span class="line">fmt.Println(<span class="string">&quot;immutablePropertiesJSON:&quot;</span>, immutablePropertiesJSON)</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;asset_properties key not found in the transient map&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> createAsset(ctx, immutablePropertiesJSON, assetID, publicDescription, <span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CreateAsset creates an asset and sets it as owned by the client&#x27;s org</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, immutablePropertiesJSON []<span class="keyword">byte</span>, assetID, publicDescription <span class="keyword">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">parentID <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="comment">// Get client org id and verify it matches peer org id.</span></span><br><span class="line"><span class="comment">// In this scenario, client is only authorized to read/write private data from its own peer.</span></span><br><span class="line">clientOrgID, err := getClientOrgID(ctx, <span class="literal">true</span>)</span><br><span class="line">fmt.Println(<span class="string">&quot;clientOrgID:&quot;</span>, clientOrgID)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to get verified OrgID: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">asset := Asset&#123;</span><br><span class="line">ObjectType:        <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">ID:                assetID,</span><br><span class="line">OwnerOrg:          clientOrgID,</span><br><span class="line">PublicDescription: publicDescription,</span><br><span class="line">Status:            statusEnable,</span><br><span class="line">ParentID:          parentID,</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="string">&quot;asset:&quot;</span>, asset)</span><br><span class="line">assetBytes, err := json.Marshal(asset)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to create asset JSON: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">err = ctx.GetStub().PutState(asset.ID, assetBytes)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to put asset in public data: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set the endorsement policy such that an owner org peer is required to endorse future updates</span></span><br><span class="line">err = setAssetStateBasedEndorsement(ctx, asset.ID, clientOrgID)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed setting state based endorsement for owner: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Persist private immutable asset properties to owner&#x27;s private data collection</span></span><br><span class="line">collection := buildCollectionName(clientOrgID)</span><br><span class="line">fmt.Println(<span class="string">&quot;collection:&quot;</span>, collection)</span><br><span class="line">err = ctx.GetStub().PutPrivateData(collection, asset.ID, immutablePropertiesJSON)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to put Asset private details: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// // verifyAssetProperties éªŒè¯èµ„äº§å±æ€§çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment">// func verifyAssetProperties(immutablePropertiesJSON []byte, asset Asset) error &#123;</span></span><br><span class="line"><span class="comment">// assetProperties, err := getAssetProperties(immutablePropertiesJSON)</span></span><br><span class="line"><span class="comment">// if err != nil &#123;</span></span><br><span class="line"><span class="comment">// return err</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// // èµ„äº§çš„å±æ€§IDå’Œèµ„äº§IDç›¸åŒ</span></span><br><span class="line"><span class="comment">// if asset.ID != assetProperties.ID &#123;</span></span><br><span class="line"><span class="comment">// return fmt.Errorf(&quot;èµ„äº§IDå’Œèµ„äº§å±æ€§IDå¿…é¡»ç›¸åŒ&quot;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// // èµ„äº§çš„å‘è¡Œè€…å°±æ˜¯èµ„äº§çš„åˆ›å»ºè€…ï¼Œæ‰€æœ‰äººéƒ½å¯ä»¥å‘è¡Œï¼Œä½†æ˜¯åˆ«äººè®¤ä¸è®¤å¯è¿™ä¸ªç»„ç»‡å‘è¡Œçš„èµ„äº§æ˜¯å¦ä¸€å›äº‹</span></span><br><span class="line"><span class="comment">// if asset.OwnerOrg != assetProperties.Issuer &#123;</span></span><br><span class="line"><span class="comment">// return fmt.Errorf(&quot;èµ„äº§çš„å‘è¡Œæ–¹å¿…é¡»æ˜¯å½“å‰åˆ›å»ºèµ„äº§çš„ç»„ç»‡&quot;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// // ç†è®ºä¸Šè¿™é‡Œåº”è¯¥è¿˜æœ‰æ›´å¤šçš„æ ¡éªŒï¼Œæ¯”å¦‚è¯´åˆ›å»ºæ—¶é—´å’Œå¤±æ•ˆæ—¶é—´çš„éªŒè¯</span></span><br><span class="line"><span class="comment">// return nil</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// ChangePublicDescription updates the assets public description. Only the current owner can update the public description</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">ChangePublicDescription</span><span class="params">(ctx contractapi.TransactionContextInterface, assetID <span class="keyword">string</span>, newDescription <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">asset, err := s.ReadAsset(ctx, assetID)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to get asset: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> changeOriginAssetInfo(ctx, *asset, <span class="string">&quot;&quot;</span>, newDescription)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AgreeToSell adds seller&#x27;s asking price to seller&#x27;s implicit private data collection</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">AgreeToSell</span><span class="params">(ctx contractapi.TransactionContextInterface, assetID <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">asset, err := s.ReadAsset(ctx, assetID)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">clientOrgID, err := getClientOrgID(ctx, <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to get verified OrgID: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Verify that this clientOrgId actually owns the asset.</span></span><br><span class="line"><span class="keyword">if</span> clientOrgID != asset.OwnerOrg &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;a client from %s cannot sell an asset owned by %s&quot;</span>, clientOrgID, asset.OwnerOrg)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> agreeToPrice(ctx, assetID, typeAssetForSale)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AgreeToBuy adds buyer&#x27;s bid price to buyer&#x27;s implicit private data collection</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">AgreeToBuy</span><span class="params">(ctx contractapi.TransactionContextInterface, assetID <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> agreeToPrice(ctx, assetID, typeAssetBid)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// agreeToPrice adds a bid or ask price to caller&#x27;s implicit private data collection</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">agreeToPrice</span><span class="params">(ctx contractapi.TransactionContextInterface, assetID <span class="keyword">string</span>, priceType <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="comment">// In this scenario, client is only authorized to read/write private data from its own peer.</span></span><br><span class="line">clientOrgID, err := getClientOrgID(ctx, <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to get verified OrgID: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">transMap, err := ctx.GetStub().GetTransient()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;error getting transient: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Asset price must be retrieved from the transient field as they are private</span></span><br><span class="line">price, ok := transMap[<span class="string">&quot;asset_price&quot;</span>]</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;asset_price key not found in the transient map&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">collection := buildCollectionName(clientOrgID)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Persist the agreed to price in a collection sub-namespace based on priceType key prefix,</span></span><br><span class="line"><span class="comment">// to avoid collisions between private asset properties, sell price, and buy price</span></span><br><span class="line">assetPriceKey, err := ctx.GetStub().CreateCompositeKey(priceType, []<span class="keyword">string</span>&#123;assetID&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to create composite key: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The Price hash will be verified later, therefore always pass and persist price bytes as is,</span></span><br><span class="line"><span class="comment">// so that there is no risk of nondeterministic marshaling.</span></span><br><span class="line">err = ctx.GetStub().PutPrivateData(collection, assetPriceKey, price)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to put asset bid: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// VerifyAssetProperties  Allows a buyer to validate the properties of</span></span><br><span class="line"><span class="comment">// an asset against the owner&#x27;s implicit private data collection</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">VerifyAssetProperties</span><span class="params">(ctx contractapi.TransactionContextInterface, assetID <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">bool</span>, error)</span></span> &#123;</span><br><span class="line">transMap, err := ctx.GetStub().GetTransient()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, fmt.Errorf(<span class="string">&quot;error getting transient: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Asset properties must be retrieved from the transient field as they are private</span></span><br><span class="line">immutablePropertiesJSON, ok := transMap[<span class="string">&quot;asset_properties&quot;</span>]</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, fmt.Errorf(<span class="string">&quot;asset_properties key not found in the transient map&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">asset, err := s.ReadAsset(ctx, assetID)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, fmt.Errorf(<span class="string">&quot;failed to get asset: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ èµ„äº§çŠ¶æ€çš„éªŒè¯</span></span><br><span class="line"><span class="keyword">if</span> (*asset).Status != statusEnable &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, fmt.Errorf(<span class="string">&quot;èµ„äº§ä¸å¯ä»¥ï¼Œä¸å…è®¸äº¤æ˜“: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">collectionOwner := buildCollectionName(asset.OwnerOrg)</span><br><span class="line">immutablePropertiesOnChainHash, err := ctx.GetStub().GetPrivateDataHash(collectionOwner, assetID)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, fmt.Errorf(<span class="string">&quot;failed to read asset private properties hash from seller&#x27;s collection: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> immutablePropertiesOnChainHash == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, fmt.Errorf(<span class="string">&quot;asset private properties hash does not exist: %s&quot;</span>, assetID)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hash := sha256.New()</span><br><span class="line">hash.Write(immutablePropertiesJSON)</span><br><span class="line">calculatedPropertiesHash := hash.Sum(<span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// verify that the hash of the passed immutable properties matches the on-chain hash</span></span><br><span class="line"><span class="keyword">if</span> !bytes.Equal(immutablePropertiesOnChainHash, calculatedPropertiesHash) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>, fmt.Errorf(<span class="string">&quot;hash %x for passed immutable properties %s does not match on-chain hash %x&quot;</span>,</span><br><span class="line">calculatedPropertiesHash,</span><br><span class="line">immutablePropertiesJSON,</span><br><span class="line">immutablePropertiesOnChainHash,</span><br><span class="line">)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TransferAsset checks transfer conditions and then transfers asset state to buyer.</span></span><br><span class="line"><span class="comment">// TransferAsset can only be called by current owner</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">TransferAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, assetID <span class="keyword">string</span>, buyerOrgID <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">clientOrgID, err := getClientOrgID(ctx, <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to get verified OrgID: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">transMap, err := ctx.GetStub().GetTransient()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;error getting transient data: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">immutablePropertiesJSON, ok := transMap[<span class="string">&quot;asset_properties&quot;</span>]</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;asset_properties key not found in the transient map&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">priceJSON, ok := transMap[<span class="string">&quot;asset_price&quot;</span>]</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;asset_price key not found in the transient map&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> agreement Agreement</span><br><span class="line">err = json.Unmarshal(priceJSON, &amp;agreement)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to unmarshal price JSON: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">asset, err := s.ReadAsset(ctx, assetID)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to get asset: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ èµ„äº§çŠ¶æ€çš„éªŒè¯</span></span><br><span class="line"><span class="keyword">if</span> (*asset).Status != statusEnable &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;èµ„äº§ä¸å¯ä»¥ï¼Œä¸å…è®¸äº¤æ˜“&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">err = verifyTransferConditions(ctx, asset, immutablePropertiesJSON, clientOrgID, buyerOrgID, priceJSON)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed transfer verification: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">err = transferAssetState(ctx, asset, immutablePropertiesJSON, clientOrgID, buyerOrgID, agreement.Price)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed asset transfer: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SplitAsset æ‹†åˆ†èµ„äº§ä¸ºä¸¤ä¸ªèµ„äº§ï¼Œä¼ å…¥çš„amountæ˜¯æ‹†åˆ†åçš„å…¶ä¸­ä¸€ä¸ªèµ„äº§çš„é‡‘é¢</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">SplitAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, assetID <span class="keyword">string</span>, amount <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">asset, err := s.ReadAsset(ctx, assetID)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">immutableProperties, err := getAssetPrivateProperties(ctx, assetID)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">assetProperties, err := getAssetProperties(immutableProperties)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> assetProperties.Amount &lt;= amount &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;èµ„äº§IDçš„é‡‘é¢ä¸º%då°äºæƒ³è¦æ‹†åˆ†çš„é‡‘é¢ä¸º%dï¼Œä¸å…è®¸æ‹†åˆ†&quot;</span>, assetProperties.Amount, amount)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> err := splitAsset(ctx, assetProperties, assetID+<span class="string">&quot;1&quot;</span>, amount, *asset); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> err := splitAsset(ctx, assetProperties, assetID+<span class="string">&quot;2&quot;</span>, assetProperties.Amount-amount, *asset); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‹†åˆ†ä¹‹ååˆ é™¤æ—§èµ„äº§</span></span><br><span class="line">collection := buildCollectionName((*asset).OwnerOrg)</span><br><span class="line">err = ctx.GetStub().DelPrivateData(collection, asset.ID)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to delete Asset private details from org: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¿®æ”¹å…¬å…±èµ„äº§ä¿¡æ¯</span></span><br><span class="line">changeOriginAssetInfo(ctx, *asset, statusDelete, <span class="string">&quot;å·²æ‹†åˆ†&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ¹æ®transientè·å–çš„assetPropertiesçš„å­—èŠ‚æ•°ç»„è·å–AssetProperties</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getAssetProperties</span><span class="params">(immutablePropertiesJSON []<span class="keyword">byte</span>)</span> <span class="params">(AssetProperties, error)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> assetProperties AssetProperties</span><br><span class="line"><span class="keyword">if</span> err := json.Unmarshal(immutablePropertiesJSON, &amp;assetProperties); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> assetProperties, fmt.Errorf(<span class="string">&quot;failed to unmarshal price JSON: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> assetProperties, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ChangePublicDescription updates the assets public description. Only the current owner can update the public description</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">changeOriginAssetInfo</span><span class="params">(ctx contractapi.TransactionContextInterface, asset Asset, status <span class="keyword">string</span>, newDescription <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="comment">// No need to check client org id matches peer org id, rely on the asset ownership check instead.</span></span><br><span class="line">clientOrgID, err := getClientOrgID(ctx, <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to get verified OrgID: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Auth check to ensure that client&#x27;s org actually owns the asset</span></span><br><span class="line"><span class="keyword">if</span> clientOrgID != asset.OwnerOrg &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;a client from %s cannot update the description of a asset owned by %s&quot;</span>, clientOrgID, asset.OwnerOrg)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ èµ„äº§çŠ¶æ€çš„éªŒè¯</span></span><br><span class="line"><span class="keyword">if</span> asset.Status != statusEnable &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;èµ„äº§ä¸å¯ç”¨ï¼Œä¸å…è®¸ä¿®æ”¹&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> status != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">asset.Status = status</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> newDescription != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">asset.PublicDescription = newDescription</span><br><span class="line">&#125;</span><br><span class="line">updatedAssetJSON, err := json.Marshal(asset)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to marshal asset: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ctx.GetStub().PutState(asset.ID, updatedAssetJSON)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// splitAsset ä»åŸå§‹èµ„äº§å±æ€§æ‹†åˆ†æˆæŒ‡å®šIDå’Œé‡‘é¢çš„èµ„äº§</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">splitAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, originAssetProperties AssetProperties, newAssetID <span class="keyword">string</span>, newAmount <span class="keyword">int</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">asset Asset)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">originAssetProperties.Amount = newAmount</span><br><span class="line">originAssetProperties.ID = newAssetID</span><br><span class="line">immutablePropertiesJSON, err := json.Marshal(originAssetProperties)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> createAsset(ctx, immutablePropertiesJSON, newAssetID, asset.PublicDescription, asset.ID)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// verifyTransferConditions checks that client org currently owns asset and that both parties have agreed on price</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">verifyTransferConditions</span><span class="params">(ctx contractapi.TransactionContextInterface,</span></span></span><br><span class="line"><span class="function"><span class="params">asset *Asset,</span></span></span><br><span class="line"><span class="function"><span class="params">immutablePropertiesJSON []<span class="keyword">byte</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">clientOrgID <span class="keyword">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">buyerOrgID <span class="keyword">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">priceJSON []<span class="keyword">byte</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CHECK1: Auth check to ensure that client&#x27;s org actually owns the asset</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> clientOrgID != asset.OwnerOrg &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;a client from %s cannot transfer a asset owned by %s&quot;</span>, clientOrgID, asset.OwnerOrg)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CHECK2: Verify that the hash of the passed immutable properties matches the on-chain hash</span></span><br><span class="line"></span><br><span class="line">collectionSeller := buildCollectionName(clientOrgID)</span><br><span class="line">immutablePropertiesOnChainHash, err := ctx.GetStub().GetPrivateDataHash(collectionSeller, asset.ID)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to read asset private properties hash from seller&#x27;s collection: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> immutablePropertiesOnChainHash == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;asset private properties hash does not exist: %s&quot;</span>, asset.ID)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hash := sha256.New()</span><br><span class="line">hash.Write(immutablePropertiesJSON)</span><br><span class="line">calculatedPropertiesHash := hash.Sum(<span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// verify that the hash of the passed immutable properties matches the on-chain hash</span></span><br><span class="line"><span class="keyword">if</span> !bytes.Equal(immutablePropertiesOnChainHash, calculatedPropertiesHash) &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;hash %x for passed immutable properties %s does not match on-chain hash %x&quot;</span>,</span><br><span class="line">calculatedPropertiesHash,</span><br><span class="line">immutablePropertiesJSON,</span><br><span class="line">immutablePropertiesOnChainHash,</span><br><span class="line">)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CHECK3: Verify that seller and buyer agreed on the same price</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Get sellers asking price</span></span><br><span class="line">assetForSaleKey, err := ctx.GetStub().CreateCompositeKey(typeAssetForSale, []<span class="keyword">string</span>&#123;asset.ID&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to create composite key: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">sellerPriceHash, err := ctx.GetStub().GetPrivateDataHash(collectionSeller, assetForSaleKey)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to get seller price hash: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> sellerPriceHash == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;seller price for %s does not exist&quot;</span>, asset.ID)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get buyers bid price</span></span><br><span class="line">collectionBuyer := buildCollectionName(buyerOrgID)</span><br><span class="line">assetBidKey, err := ctx.GetStub().CreateCompositeKey(typeAssetBid, []<span class="keyword">string</span>&#123;asset.ID&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to create composite key: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// TODO ç–‘é—®ï¼šè¿™ä¸ªæ–¹æ³•æ˜¯ç”±èµ„äº§æ‹¥æœ‰è€…è°ƒç”¨çš„ï¼Œé‚£ä¹ˆèµ„äº§æ‹¥æœ‰è€…æ€ä¹ˆå¯ä»¥è·å–èµ„äº§ä¹°æ–¹çš„å‡ºä»·ä¿¡æ¯å‘¢ï¼Ÿå¦‚æœæ˜¯ä»å…¬å…±çŠ¶æ€è·å–è´­ä¹°æ–¹çš„å‡ºä»·hashæ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯ä»è´­ä¹°æ–¹çš„ç§æœ‰æ•°æ®é›†ä¸­è·å–å‡ºä»·hashå¾ˆè®©äººè´¹è§£ã€‚</span></span><br><span class="line">buyerPriceHash, err := ctx.GetStub().GetPrivateDataHash(collectionBuyer, assetBidKey)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to get buyer price hash: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> buyerPriceHash == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;buyer price for %s does not exist&quot;</span>, asset.ID)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hash = sha256.New()</span><br><span class="line">hash.Write(priceJSON)</span><br><span class="line">calculatedPriceHash := hash.Sum(<span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Verify that the hash of the passed price matches the on-chain sellers price hash</span></span><br><span class="line"><span class="keyword">if</span> !bytes.Equal(calculatedPriceHash, sellerPriceHash) &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;hash %x for passed price JSON %s does not match on-chain hash %x, seller hasn&#x27;t agreed to the passed trade id and price&quot;</span>,</span><br><span class="line">calculatedPriceHash,</span><br><span class="line">priceJSON,</span><br><span class="line">sellerPriceHash,</span><br><span class="line">)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Verify that the hash of the passed price matches the on-chain buyer price hash</span></span><br><span class="line"><span class="keyword">if</span> !bytes.Equal(calculatedPriceHash, buyerPriceHash) &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;hash %x for passed price JSON %s does not match on-chain hash %x, buyer hasn&#x27;t agreed to the passed trade id and price&quot;</span>,</span><br><span class="line">calculatedPriceHash,</span><br><span class="line">priceJSON,</span><br><span class="line">buyerPriceHash,</span><br><span class="line">)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// transferAssetState performs the public and private state updates for the transferred asset</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">transferAssetState</span><span class="params">(ctx contractapi.TransactionContextInterface, asset *Asset, immutablePropertiesJSON []<span class="keyword">byte</span>, clientOrgID <span class="keyword">string</span>, buyerOrgID <span class="keyword">string</span>, price <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">asset.OwnerOrg = buyerOrgID</span><br><span class="line">updatedAsset, err := json.Marshal(asset)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">err = ctx.GetStub().PutState(asset.ID, updatedAsset)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to write asset for buyer: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Change the endorsement policy to the new owner</span></span><br><span class="line">err = setAssetStateBasedEndorsement(ctx, asset.ID, buyerOrgID)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed setting state based endorsement for new owner: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Transfer the private properties (delete from seller collection, create in buyer collection)</span></span><br><span class="line">collectionSeller := buildCollectionName(clientOrgID)</span><br><span class="line">err = ctx.GetStub().DelPrivateData(collectionSeller, asset.ID)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to delete Asset private details from seller: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">collectionBuyer := buildCollectionName(buyerOrgID)</span><br><span class="line">err = ctx.GetStub().PutPrivateData(collectionBuyer, asset.ID, immutablePropertiesJSON)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to put Asset private properties for buyer: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delete the price records for seller</span></span><br><span class="line">assetPriceKey, err := ctx.GetStub().CreateCompositeKey(typeAssetForSale, []<span class="keyword">string</span>&#123;asset.ID&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to create composite key for seller: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">err = ctx.GetStub().DelPrivateData(collectionSeller, assetPriceKey)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to delete asset price from implicit private data collection for seller: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delete the price records for buyer</span></span><br><span class="line">assetPriceKey, err = ctx.GetStub().CreateCompositeKey(typeAssetBid, []<span class="keyword">string</span>&#123;asset.ID&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to create composite key for buyer: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">err = ctx.GetStub().DelPrivateData(collectionBuyer, assetPriceKey)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to delete asset price from implicit private data collection for buyer: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Keep record for a &#x27;receipt&#x27; in both buyers and sellers private data collection to record the sale price and date.</span></span><br><span class="line"><span class="comment">// Persist the agreed to price in a collection sub-namespace based on receipt key prefix.</span></span><br><span class="line">receiptBuyKey, err := ctx.GetStub().CreateCompositeKey(typeAssetBuyReceipt, []<span class="keyword">string</span>&#123;asset.ID, ctx.GetStub().GetTxID()&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to create composite key for receipt: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">txTimestamp, err := ctx.GetStub().GetTxTimestamp()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to create timestamp for receipt: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">timestamp, err := ptypes.Timestamp(txTimestamp)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">assetReceipt := receipt&#123;</span><br><span class="line">price:     price,</span><br><span class="line">timestamp: timestamp,</span><br><span class="line">&#125;</span><br><span class="line">receipt, err := json.Marshal(assetReceipt)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to marshal receipt: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">err = ctx.GetStub().PutPrivateData(collectionBuyer, receiptBuyKey, receipt)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to put private asset receipt for buyer: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">receiptSaleKey, err := ctx.GetStub().CreateCompositeKey(typeAssetSaleReceipt, []<span class="keyword">string</span>&#123;ctx.GetStub().GetTxID(), asset.ID&#125;)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to create composite key for receipt: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">err = ctx.GetStub().PutPrivateData(collectionSeller, receiptSaleKey, receipt)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to put private asset receipt for seller: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// getClientOrgID gets the client org ID.</span></span><br><span class="line"><span class="comment">// The client org ID can optionally be verified against the peer org ID, to ensure that a client</span></span><br><span class="line"><span class="comment">// from another org doesn&#x27;t attempt to read or write private data from this peer.</span></span><br><span class="line"><span class="comment">// The only exception in this scenario is for TransferAsset, since the current owner</span></span><br><span class="line"><span class="comment">// needs to get an endorsement from the buyer&#x27;s peer.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getClientOrgID</span><span class="params">(ctx contractapi.TransactionContextInterface, verifyOrg <span class="keyword">bool</span>)</span> <span class="params">(<span class="keyword">string</span>, error)</span></span> &#123;</span><br><span class="line"><span class="comment">// GetClientIdentity()è·å–å®¢æˆ·ç«¯çš„èº«ä»½ï¼Œè¿”å›ClientIdentityæ¥å£ï¼Œè¿™ä¸ªæ¥å£æœ‰å¦‚ä¸‹æ–¹æ³•ï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// GetID returns the ID associated with the invoking identity.  This ID</span></span><br><span class="line"><span class="comment">// is guaranteed to be unique within the MSP.</span></span><br><span class="line"><span class="comment">// * GetID() (string, error) è·å–</span></span><br><span class="line"></span><br><span class="line">clientOrgID, err := ctx.GetClientIdentity().GetMSPID()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, fmt.Errorf(<span class="string">&quot;failed getting client&#x27;s orgID: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> verifyOrg &#123;</span><br><span class="line">err = verifyClientOrgMatchesPeerOrg(clientOrgID)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> clientOrgID, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// verifyClientOrgMatchesPeerOrg checks the client org id matches the peer org id.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">verifyClientOrgMatchesPeerOrg</span><span class="params">(clientOrgID <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">peerOrgID, err := shim.GetMSPID()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed getting peer&#x27;s orgID: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> clientOrgID != peerOrgID &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;client from org %s is not authorized to read or write private data from an org %s peer&quot;</span>,</span><br><span class="line">clientOrgID,</span><br><span class="line">peerOrgID,</span><br><span class="line">)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// setAssetStateBasedEndorsement adds an endorsement policy to a asset so that only a peer from an owning org</span></span><br><span class="line"><span class="comment">// can update or transfer the asset.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">setAssetStateBasedEndorsement</span><span class="params">(ctx contractapi.TransactionContextInterface, assetID <span class="keyword">string</span>, orgToEndorse <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"></span><br><span class="line">endorsementPolicy, err := statebased.NewStateEP(<span class="literal">nil</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">err = endorsementPolicy.AddOrgs(statebased.RoleTypeMember, orgToEndorse)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to add org to endorsement policy: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">policy, err := endorsementPolicy.Policy()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;failed to create endorsement policy bytes from org: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// fmt.Printf(&quot;assetID=%s, orgToEndorse=%s, policy=%s, len(policy)=%d \n&quot;, assetID, orgToEndorse, policy, len(policy))</span></span><br><span class="line"><span class="comment">// fmt.Printf(&quot;assetID=%s, policy=%s, endorsementPolicy.ListOrgs=%s\n&quot;, assetID, string(policy[:]), endorsementPolicy.ListOrgs())</span></span><br><span class="line"><span class="keyword">return</span> ctx.GetStub().SetStateValidationParameter(assetID, policy)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">buildCollectionName</span><span class="params">(clientOrgID <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;_implicit_org_%s&quot;</span>, clientOrgID)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getClientImplicitCollectionName</span><span class="params">(ctx contractapi.TransactionContextInterface)</span> <span class="params">(<span class="keyword">string</span>, error)</span></span> &#123;</span><br><span class="line">clientOrgID, err := getClientOrgID(ctx, <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, fmt.Errorf(<span class="string">&quot;failed to get verified OrgID: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">err = verifyClientOrgMatchesPeerOrg(clientOrgID)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> buildCollectionName(clientOrgID), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">chaincode, err := contractapi.NewChaincode(<span class="built_in">new</span>(SmartContract))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Panicf(<span class="string">&quot;Error create transfer asset chaincode: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err := chaincode.Start(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Panicf(<span class="string">&quot;Error starting asset chaincode: %v&quot;</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> API </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> API </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ClientIdentityæ¥å£ç»ƒä¹ </title>
      <link href="2021/04/01/blockchain/fabric/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6API%E5%AD%A6%E4%B9%A0/ClientIdentity%E6%8E%A5%E5%8F%A3%E7%BB%83%E4%B9%A0/"/>
      <url>2021/04/01/blockchain/fabric/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6API%E5%AD%A6%E4%B9%A0/ClientIdentity%E6%8E%A5%E5%8F%A3%E7%BB%83%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>å­¦ä¹ <code>/github.com/hyperledger/fabric-chaincode-go/pkg/cid/interfaces.go</code>ä¸­çš„ClientIdentityæ¥å£ï¼Œæºç å¦‚ä¸‹ï¼Œæ¯”è¾ƒç®€å•ï¼š</p><h3 id="æºç ">æºç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ClientIdentity represents information about the identity that submitted the</span></span><br><span class="line"><span class="comment">// transaction</span></span><br><span class="line"><span class="comment">// ClientIdentityè¡¨ç¤ºæäº¤äº¤æ˜“çš„èº«ä»½çš„ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">type</span> ClientIdentity <span class="keyword">interface</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// GetID returns the ID associated with the invoking identity.  This ID</span></span><br><span class="line">   <span class="comment">// is guaranteed to be unique within the MSP.</span></span><br><span class="line">   <span class="comment">// è¿”å›ä¸è°ƒç”¨è€…èº«ä»½å…³è”çš„IDã€‚è¯¥IDåœ¨MSPä¸­ä¿è¯æ˜¯å”¯ä¸€çš„ã€‚</span></span><br><span class="line">   GetID() (<span class="keyword">string</span>, error)</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Return the MSP ID of the client</span></span><br><span class="line">   <span class="comment">// è·å–å®¢æˆ·ç«¯çš„MSPçš„ID</span></span><br><span class="line">   GetMSPID() (<span class="keyword">string</span>, error)</span><br><span class="line"></span><br><span class="line">   <span class="comment">// GetAttributeValue returns the value of the client&#x27;s attribute named `attrName`.</span></span><br><span class="line">   <span class="comment">// If the client possesses the attribute, `found` is true and `value` equals the</span></span><br><span class="line">   <span class="comment">// value of the attribute.</span></span><br><span class="line">   <span class="comment">// If the client does not possess the attribute, `found` is false and `value`</span></span><br><span class="line">   <span class="comment">// equals &quot;&quot;.</span></span><br><span class="line">   <span class="comment">// è¿”å›åä¸º`attrName`çš„å®¢æˆ·ç«¯çš„å±æ€§ä¿¡æ¯</span></span><br><span class="line">   <span class="comment">// å¦‚æœå®¢æˆ·ç«¯æœ‰è¿™ä¸ªå±æ€§ï¼Œè¿”å›å€¼`found`ç­‰äºtrueå¹¶ä¸”è¿”å›å€¼`value`ç­‰äºè¿™ä¸ªå±æ€§ã€‚</span></span><br><span class="line">   <span class="comment">// å¦‚æœè¿™ä¸ªå®¢æˆ·ç«¯ä¸æ‹¥æœ‰è¿™ä¸ªå±æ€§ï¼Œ`found`ç­‰äºfalseå¹¶ä¸”`value`ç­‰äº&quot;&quot;ã€‚</span></span><br><span class="line">   GetAttributeValue(attrName <span class="keyword">string</span>) (value <span class="keyword">string</span>, found <span class="keyword">bool</span>, err error)</span><br><span class="line"></span><br><span class="line">   <span class="comment">// AssertAttributeValue verifies that the client has the attribute named `attrName`</span></span><br><span class="line">   <span class="comment">// with a value of `attrValue`; otherwise, an error is returned.</span></span><br><span class="line">   <span class="comment">// éªŒè¯å®¢æˆ·ç«¯æ˜¯å¦æœ‰åä¸º`attrName`çš„å±æ€§ï¼Œå¹¶ä¸”å€¼ä¸º`attrValue`ï¼›å¦‚æœæ²¡æœ‰æˆ–è€…å€¼ä¸ä¸€è‡´åˆ™è¿”å›ä¸€ä¸ªerror</span></span><br><span class="line">   AssertAttributeValue(attrName, attrValue <span class="keyword">string</span>) error</span><br><span class="line"></span><br><span class="line">   <span class="comment">// GetX509Certificate returns the X509 certificate associated with the client,</span></span><br><span class="line">   <span class="comment">// or nil if it was not identified by an X509 certificate.</span></span><br><span class="line">   <span class="comment">// è¿”å›ä¸å®¢æˆ·ç«¯å…³è”çš„X509è¯ä¹¦ï¼Œå¦‚æœæ²¡æœ‰è¢«X509è¯ä¹¦æ ‡è¯†ï¼Œåˆ™è¿”å›nilã€‚</span></span><br><span class="line">   GetX509Certificate() (*x509.Certificate, error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•ä»£ç ï¼š">æµ‹è¯•ä»£ç ï¼š</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ClientIdentityPractice ClientIdentityæ¥å£æä¾›çš„æ–¹æ³•ç»ƒä¹ </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">ClientIdentityPractice</span><span class="params">(ctx contractapi.TransactionContextInterface)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">log.Println(<span class="string">&quot;ClientIdentityPractice==================start=====================&quot;</span>)</span><br><span class="line">clientIdentity := ctx.GetClientIdentity()</span><br><span class="line">id, err := clientIdentity.GetID()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">log.Printf(<span class="string">&quot;clientIdentity.GetID()=%s&quot;</span>, id)</span><br><span class="line">mspid, err := clientIdentity.GetMSPID()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">log.Printf(<span class="string">&quot;clientIdentity.GetMSPID()=%s&quot;</span>, mspid)</span><br><span class="line">certificate, err := clientIdentity.GetX509Certificate()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line">log.Printf(<span class="string">&quot;clientIdentity.GetX509Certificate()=%#v&quot;</span>, certificate)</span><br><span class="line">value, found, err := clientIdentity.GetAttributeValue(<span class="string">&quot;test&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> found &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;clientIdentity.GetAttributeValue(\&quot;test\&quot;)=%s&quot;</span>, value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> err := clientIdentity.AssertAttributeValue(<span class="string">&quot;test&quot;</span>, <span class="string">&quot;hello&quot;</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Printf(<span class="string">&quot;clientIdentity.AssertAttributeValue(\&quot;test\&quot;, \&quot;hello\&quot;) error!&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">log.Println(<span class="string">&quot;ClientIdentityPractice===================end======================&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•æ—¥å¿—">æµ‹è¯•æ—¥å¿—</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2021&#x2F;01&#x2F;25 03:42:33 ClientIdentityPractice&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;start&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">2021&#x2F;01&#x2F;25 03:42:33 clientIdentity.GetID()&#x3D;eDUwOTo6Q049QWRtaW5AczIuc3VwcGx5LmNvbSxMPVNhbiBGcmFuY2lzY28sU1Q9Q2FsaWZvcm5pYSxDPVVTOjpDTj1jYS5zMi5zdXBwbHkuY29tLE89czIuc3VwcGx5LmNvbSxMPVNhbiBGcmFuY2lzY28sU1Q9Q2FsaWZvcm5pYSxDPVVT</span><br><span class="line">2021&#x2F;01&#x2F;25 03:42:33 clientIdentity.GetMSPID()&#x3D;GylSOrg2MSP</span><br><span class="line">2021&#x2F;01&#x2F;25 03:42:33 clientIdentity.GetX509Certificate()&#x3D;&amp;x509.Certificate&#123;Raw:[]uint8&#123;0x30, 0x82, 0x2, 0x11, 0x30, 0x82, 0x1, 0xb7, 0xa0, 0x3, 0x2, 0x1, 0x2, 0x2, 0x11, 0x0, 0x9c, 0x36, 0x61, 0x42, 0xa4, 0x9b, 0x22, 0xae, 0xb0, 0x61, 0xe6, 0xdf, 0x70, 0xfb, 0x2e, 0x19, 0x30, 0xa, 0x6, 0x8, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x4, 0x3, 0x2, 0x30, 0x6d, 0x31, 0xb, 0x30, 0x9, 0x6, 0x3, 0x55, 0x4, 0x6, 0x13, 0x2, 0x55, 0x53, 0x31, 0x13, 0x30, 0x11, 0x6, 0x3, 0x55, 0x4, 0x8, 0x13, 0xa, 0x43, 0x61, 0x6c, 0x69, 0x66, 0x6f, 0x72, 0x6e, 0x69, 0x61, 0x31, 0x16, 0x30, 0x14, 0x6, 0x3, 0x55, 0x4, 0x7, 0x13, 0xd, 0x53, 0x61, 0x6e, 0x20, 0x46, 0x72, 0x61, 0x6e, 0x63, 0x69, 0x73, 0x63, 0x6f, 0x31, 0x16, 0x30, 0x14, 0x6, 0x3, 0x55, 0x4, 0xa, 0x13, 0xd, 0x73, 0x32, 0x2e, 0x73, 0x75, 0x70, 0x70, 0x6c, 0x79, 0x2e, 0x63, 0x6f, 0x6d, 0x31, 0x19, 0x30, 0x17, 0x6, 0x3, 0x55, 0x4, 0x3, 0x13, 0x10, 0x63, 0x61, 0x2e, 0x73, 0x32, 0x2e, 0x73, 0x75, 0x70, 0x70, 0x6c, 0x79, 0x2e, 0x63, 0x6f, 0x6d, 0x30, 0x1e, 0x17, 0xd, 0x32, 0x31, 0x30, 0x31, 0x30, 0x37, 0x30, 0x38, 0x33, 0x31, 0x30, 0x30, 0x5a, 0x17, 0xd, 0x33, 0x31, 0x30, 0x31, 0x30, 0x35, 0x30, 0x38, 0x33, 0x31, 0x30, 0x30, 0x5a, 0x30, 0x58, 0x31, 0xb, 0x30, 0x9, 0x6, 0x3, 0x55, 0x4, 0x6, 0x13, 0x2, 0x55, 0x53, 0x31, 0x13, 0x30, 0x11, 0x6, 0x3, 0x55, 0x4, 0x8, 0x13, 0xa, 0x43, 0x61, 0x6c, 0x69, 0x66, 0x6f, 0x72, 0x6e, 0x69, 0x61, 0x31, 0x16, 0x30, 0x14, 0x6, 0x3, 0x55, 0x4, 0x7, 0x13, 0xd, 0x53, 0x61, 0x6e, 0x20, 0x46, 0x72, 0x61, 0x6e, 0x63, 0x69, 0x73, 0x63, 0x6f, 0x31, 0x1c, 0x30, 0x1a, 0x6, 0x3, 0x55, 0x4, 0x3, 0xc, 0x13, 0x41, 0x64, 0x6d, 0x69, 0x6e, 0x40, 0x73, 0x32, 0x2e, 0x73, 0x75, 0x70, 0x70, 0x6c, 0x79, 0x2e, 0x63, 0x6f, 0x6d, 0x30, 0x59, 0x30, 0x13, 0x6, 0x7, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x2, 0x1, 0x6, 0x8, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x3, 0x1, 0x7, 0x3, 0x42, 0x0, 0x4, 0x9e, 0x80, 0x9f, 0x9b, 0xc7, 0x9a, 0xe8, 0x35, 0x60, 0x12, 0x14, 0x5c, 0xab, 0x83, 0xe7, 0x46, 0x49, 0xef, 0xd4, 0xe2, 0xc0, 0x39, 0x16, 0xe6, 0xe1, 0x2b, 0xd9, 0x99, 0x17, 0x53, 0x91, 0x26, 0x5f, 0x5, 0x65, 0xc7, 0x0, 0x8e, 0x2a, 0x97, 0xea, 0x28, 0xea, 0xf5, 0x5d, 0xd9, 0x34, 0xd, 0x63, 0x25, 0x1, 0x3, 0xd0, 0x23, 0x17, 0x97, 0x92, 0xd7, 0x55, 0x4, 0x9c, 0x45, 0x73, 0x82, 0xa3, 0x4d, 0x30, 0x4b, 0x30, 0xe, 0x6, 0x3, 0x55, 0x1d, 0xf, 0x1, 0x1, 0xff, 0x4, 0x4, 0x3, 0x2, 0x7, 0x80, 0x30, 0xc, 0x6, 0x3, 0x55, 0x1d, 0x13, 0x1, 0x1, 0xff, 0x4, 0x2, 0x30, 0x0, 0x30, 0x2b, 0x6, 0x3, 0x55, 0x1d, 0x23, 0x4, 0x24, 0x30, 0x22, 0x80, 0x20, 0x63, 0xbd, 0xab, 0x9a, 0x9c, 0xa7, 0x4f, 0x3d, 0x8b, 0xb6, 0xc3, 0xab, 0xc, 0xb1, 0x45, 0x87, 0x60, 0x69, 0x7e, 0xb9, 0x6, 0xfb, 0x38, 0x5f, 0x9c, 0x2, 0xb1, 0x75, 0x9b, 0xc6, 0x3d, 0xfb, 0x30, 0xa, 0x6, 0x8, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x4, 0x3, 0x2, 0x3, 0x48, 0x0, 0x30, 0x45, 0x2, 0x21, 0x0, 0x91, 0x4, 0x2f, 0xee, 0x17, 0xca, 0x28, 0x68, 0xb4, 0x33, 0x48, 0x3a, 0x3a, 0x7b, 0x9f, 0xb8, 0x51, 0xb0, 0x6a, 0x8d, 0x28, 0xb9, 0x31, 0x4c, 0xb7, 0x21, 0x87, 0xd5, 0xac, 0xce, 0x6d, 0x1d, 0x2, 0x20, 0x68, 0x61, 0xca, 0x5d, 0xc2, 0x99, 0x63, 0xba, 0xb4, 0x4f, 0x1b, 0x3a, 0x2e, 0xc6, 0xed, 0x6b, 0x25, 0xba, 0x91, 0x63, 0xce, 0x1, 0xe7, 0xba, 0x67, 0x55, 0xbc, 0xb6, 0x8a, 0x76, 0x54, 0x37&#125;, RawTBSCertificate:[]uint8&#123;0x30, 0x82, 0x1, 0xb7, 0xa0, 0x3, 0x2, 0x1, 0x2, 0x2, 0x11, 0x0, 0x9c, 0x36, 0x61, 0x42, 0xa4, 0x9b, 0x22, 0xae, 0xb0, 0x61, 0xe6, 0xdf, 0x70, 0xfb, 0x2e, 0x19, 0x30, 0xa, 0x6, 0x8, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x4, 0x3, 0x2, 0x30, 0x6d, 0x31, 0xb, 0x30, 0x9, 0x6, 0x3, 0x55, 0x4, 0x6, 0x13, 0x2, 0x55, 0x53, 0x31, 0x13, 0x30, 0x11, 0x6, 0x3, 0x55, 0x4, 0x8, 0x13, 0xa, 0x43, 0x61, 0x6c, 0x69, 0x66, 0x6f, 0x72, 0x6e, 0x69, 0x61, 0x31, 0x16, 0x30, 0x14, 0x6, 0x3, 0x55, 0x4, 0x7, 0x13, 0xd, 0x53, 0x61, 0x6e, 0x20, 0x46, 0x72, 0x61, 0x6e, 0x63, 0x69, 0x73, 0x63, 0x6f, 0x31, 0x16, 0x30, 0x14, 0x6, 0x3, 0x55, 0x4, 0xa, 0x13, 0xd, 0x73, 0x32, 0x2e, 0x73, 0x75, 0x70, 0x70, 0x6c, 0x79, 0x2e, 0x63, 0x6f, 0x6d, 0x31, 0x19, 0x30, 0x17, 0x6, 0x3, 0x55, 0x4, 0x3, 0x13, 0x10, 0x63, 0x61, 0x2e, 0x73, 0x32, 0x2e, 0x73, 0x75, 0x70, 0x70, 0x6c, 0x79, 0x2e, 0x63, 0x6f, 0x6d, 0x30, 0x1e, 0x17, 0xd, 0x32, 0x31, 0x30, 0x31, 0x30, 0x37, 0x30, 0x38, 0x33, 0x31, 0x30, 0x30, 0x5a, 0x17, 0xd, 0x33, 0x31, 0x30, 0x31, 0x30, 0x35, 0x30, 0x38, 0x33, 0x31, 0x30, 0x30, 0x5a, 0x30, 0x58, 0x31, 0xb, 0x30, 0x9, 0x6, 0x3, 0x55, 0x4, 0x6, 0x13, 0x2, 0x55, 0x53, 0x31, 0x13, 0x30, 0x11, 0x6, 0x3, 0x55, 0x4, 0x8, 0x13, 0xa, 0x43, 0x61, 0x6c, 0x69, 0x66, 0x6f, 0x72, 0x6e, 0x69, 0x61, 0x31, 0x16, 0x30, 0x14, 0x6, 0x3, 0x55, 0x4, 0x7, 0x13, 0xd, 0x53, 0x61, 0x6e, 0x20, 0x46, 0x72, 0x61, 0x6e, 0x63, 0x69, 0x73, 0x63, 0x6f, 0x31, 0x1c, 0x30, 0x1a, 0x6, 0x3, 0x55, 0x4, 0x3, 0xc, 0x13, 0x41, 0x64, 0x6d, 0x69, 0x6e, 0x40, 0x73, 0x32, 0x2e, 0x73, 0x75, 0x70, 0x70, 0x6c, 0x79, 0x2e, 0x63, 0x6f, 0x6d, 0x30, 0x59, 0x30, 0x13, 0x6, 0x7, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x2, 0x1, 0x6, 0x8, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x3, 0x1, 0x7, 0x3, 0x42, 0x0, 0x4, 0x9e, 0x80, 0x9f, 0x9b, 0xc7, 0x9a, 0xe8, 0x35, 0x60, 0x12, 0x14, 0x5c, 0xab, 0x83, 0xe7, 0x46, 0x49, 0xef, 0xd4, 0xe2, 0xc0, 0x39, 0x16, 0xe6, 0xe1, 0x2b, 0xd9, 0x99, 0x17, 0x53, 0x91, 0x26, 0x5f, 0x5, 0x65, 0xc7, 0x0, 0x8e, 0x2a, 0x97, 0xea, 0x28, 0xea, 0xf5, 0x5d, 0xd9, 0x34, 0xd, 0x63, 0x25, 0x1, 0x3, 0xd0, 0x23, 0x17, 0x97, 0x92, 0xd7, 0x55, 0x4, 0x9c, 0x45, 0x73, 0x82, 0xa3, 0x4d, 0x30, 0x4b, 0x30, 0xe, 0x6, 0x3, 0x55, 0x1d, 0xf, 0x1, 0x1, 0xff, 0x4, 0x4, 0x3, 0x2, 0x7, 0x80, 0x30, 0xc, 0x6, 0x3, 0x55, 0x1d, 0x13, 0x1, 0x1, 0xff, 0x4, 0x2, 0x30, 0x0, 0x30, 0x2b, 0x6, 0x3, 0x55, 0x1d, 0x23, 0x4, 0x24, 0x30, 0x22, 0x80, 0x20, 0x63, 0xbd, 0xab, 0x9a, 0x9c, 0xa7, 0x4f, 0x3d, 0x8b, 0xb6, 0xc3, 0xab, 0xc, 0xb1, 0x45, 0x87, 0x60, 0x69, 0x7e, 0xb9, 0x6, 0xfb, 0x38, 0x5f, 0x9c, 0x2, 0xb1, 0x75, 0x9b, 0xc6, 0x3d, 0xfb&#125;, RawSubjectPublicKeyInfo:[]uint8&#123;0x30, 0x59, 0x30, 0x13, 0x6, 0x7, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x2, 0x1, 0x6, 0x8, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x3, 0x1, 0x7, 0x3, 0x42, 0x0, 0x4, 0x9e, 0x80, 0x9f, 0x9b, 0xc7, 0x9a, 0xe8, 0x35, 0x60, 0x12, 0x14, 0x5c, 0xab, 0x83, 0xe7, 0x46, 0x49, 0xef, 0xd4, 0xe2, 0xc0, 0x39, 0x16, 0xe6, 0xe1, 0x2b, 0xd9, 0x99, 0x17, 0x53, 0x91, 0x26, 0x5f, 0x5, 0x65, 0xc7, 0x0, 0x8e, 0x2a, 0x97, 0xea, 0x28, 0xea, 0xf5, 0x5d, 0xd9, 0x34, 0xd, 0x63, 0x25, 0x1, 0x3, 0xd0, 0x23, 0x17, 0x97, 0x92, 0xd7, 0x55, 0x4, 0x9c, 0x45, 0x73, 0x82&#125;, RawSubject:[]uint8&#123;0x30, 0x58, 0x31, 0xb, 0x30, 0x9, 0x6, 0x3, 0x55, 0x4, 0x6, 0x13, 0x2, 0x55, 0x53, 0x31, 0x13, 0x30, 0x11, 0x6, 0x3, 0x55, 0x4, 0x8, 0x13, 0xa, 0x43, 0x61, 0x6c, 0x69, 0x66, 0x6f, 0x72, 0x6e, 0x69, 0x61, 0x31, 0x16, 0x30, 0x14, 0x6, 0x3, 0x55, 0x4, 0x7, 0x13, 0xd, 0x53, 0x61, 0x6e, 0x20, 0x46, 0x72, 0x61, 0x6e, 0x63, 0x69, 0x73, 0x63, 0x6f, 0x31, 0x1c, 0x30, 0x1a, 0x6, 0x3, 0x55, 0x4, 0x3, 0xc, 0x13, 0x41, 0x64, 0x6d, 0x69, 0x6e, 0x40, 0x73, 0x32, 0x2e, 0x73, 0x75, 0x70, 0x70, 0x6c, 0x79, 0x2e, 0x63, 0x6f, 0x6d&#125;, RawIssuer:[]uint8&#123;0x30, 0x6d, 0x31, 0xb, 0x30, 0x9, 0x6, 0x3, 0x55, 0x4, 0x6, 0x13, 0x2, 0x55, 0x53, 0x31, 0x13, 0x30, 0x11, 0x6, 0x3, 0x55, 0x4, 0x8, 0x13, 0xa, 0x43, 0x61, 0x6c, 0x69, 0x66, 0x6f, 0x72, 0x6e, 0x69, 0x61, 0x31, 0x16, 0x30, 0x14, 0x6, 0x3, 0x55, 0x4, 0x7, 0x13, 0xd, 0x53, 0x61, 0x6e, 0x20, 0x46, 0x72, 0x61, 0x6e, 0x63, 0x69, 0x73, 0x63, 0x6f, 0x31, 0x16, 0x30, 0x14, 0x6, 0x3, 0x55, 0x4, 0xa, 0x13, 0xd, 0x73, 0x32, 0x2e, 0x73, 0x75, 0x70, 0x70, 0x6c, 0x79, 0x2e, 0x63, 0x6f, 0x6d, 0x31, 0x19, 0x30, 0x17, 0x6, 0x3, 0x55, 0x4, 0x3, 0x13, 0x10, 0x63, 0x61, 0x2e, 0x73, 0x32, 0x2e, 0x73, 0x75, 0x70, 0x70, 0x6c, 0x79, 0x2e, 0x63, 0x6f, 0x6d&#125;, Signature:[]uint8&#123;0x30, 0x45, 0x2, 0x21, 0x0, 0x91, 0x4, 0x2f, 0xee, 0x17, 0xca, 0x28, 0x68, 0xb4, 0x33, 0x48, 0x3a, 0x3a, 0x7b, 0x9f, 0xb8, 0x51, 0xb0, 0x6a, 0x8d, 0x28, 0xb9, 0x31, 0x4c, 0xb7, 0x21, 0x87, 0xd5, 0xac, 0xce, 0x6d, 0x1d, 0x2, 0x20, 0x68, 0x61, 0xca, 0x5d, 0xc2, 0x99, 0x63, 0xba, 0xb4, 0x4f, 0x1b, 0x3a, 0x2e, 0xc6, 0xed, 0x6b, 0x25, 0xba, 0x91, 0x63, 0xce, 0x1, 0xe7, 0xba, 0x67, 0x55, 0xbc, 0xb6, 0x8a, 0x76, 0x54, 0x37&#125;, SignatureAlgorithm:10, PublicKeyAlgorithm:3, PublicKey:(*ecdsa.PublicKey)(0xc0003f4980), Version:3, SerialNumber:207641924046541125914056390919893757465, Issuer:pkix.Name&#123;Country:[]string&#123;&quot;US&quot;&#125;, Organization:[]string&#123;&quot;s2.supply.com&quot;&#125;, OrganizationalUnit:[]string(nil), Locality:[]string&#123;&quot;San Francisco&quot;&#125;, Province:[]string&#123;&quot;California&quot;&#125;, StreetAddress:[]string(nil), PostalCode:[]string(nil), SerialNumber:&quot;&quot;, CommonName:&quot;ca.s2.supply.com&quot;, Names:[]pkix.AttributeTypeAndValue&#123;pkix.AttributeTypeAndValue&#123;Type:asn1.ObjectIdentifier&#123;2, 5, 4, 6&#125;, Value:&quot;US&quot;&#125;, pkix.AttributeTypeAndValue&#123;Type:asn1.ObjectIdentifier&#123;2, 5, 4, 8&#125;, Value:&quot;California&quot;&#125;, pkix.AttributeTypeAndValue&#123;Type:asn1.ObjectIdentifier&#123;2, 5, 4, 7&#125;, Value:&quot;San Francisco&quot;&#125;, pkix.AttributeTypeAndValue&#123;Type:asn1.ObjectIdentifier&#123;2, 5, 4, 10&#125;, Value:&quot;s2.supply.com&quot;&#125;, pkix.AttributeTypeAndValue&#123;Type:asn1.ObjectIdentifier&#123;2, 5, 4, 3&#125;, Value:&quot;ca.s2.supply.com&quot;&#125;&#125;, ExtraNames:[]pkix.AttributeTypeAndValue(nil)&#125;, Subject:pkix.Name&#123;Country:[]string&#123;&quot;US&quot;&#125;, Organization:[]string(nil), OrganizationalUnit:[]string(nil), Locality:[]string&#123;&quot;San Francisco&quot;&#125;, Province:[]string&#123;&quot;California&quot;&#125;, StreetAddress:[]string(nil), PostalCode:[]string(nil), SerialNumber:&quot;&quot;, CommonName:&quot;Admin@s2.supply.com&quot;, Names:[]pkix.AttributeTypeAndValue&#123;pkix.AttributeTypeAndValue&#123;Type:asn1.ObjectIdentifier&#123;2, 5, 4, 6&#125;, Value:&quot;US&quot;&#125;, pkix.AttributeTypeAndValue&#123;Type:asn1.ObjectIdentifier&#123;2, 5, 4, 8&#125;, Value:&quot;California&quot;&#125;, pkix.AttributeTypeAndValue&#123;Type:asn1.ObjectIdentifier&#123;2, 5, 4, 7&#125;, Value:&quot;San Francisco&quot;&#125;, pkix.AttributeTypeAndValue&#123;Type:asn1.ObjectIdentifier&#123;2, 5, 4, 3&#125;, Value:&quot;Admin@s2.supply.com&quot;&#125;&#125;, ExtraNames:[]pkix.AttributeTypeAndValue(nil)&#125;, NotBefore:time.Time&#123;wall:0x0, ext:63745605060, loc:(*time.Location)(nil)&#125;, NotAfter:time.Time&#123;wall:0x0, ext:64060965060, loc:(*time.Location)(nil)&#125;, KeyUsage:1, Extensions:[]pkix.Extension&#123;pkix.Extension&#123;Id:asn1.ObjectIdentifier&#123;2, 5, 29, 15&#125;, Critical:true, Value:[]uint8&#123;0x3, 0x2, 0x7, 0x80&#125;&#125;, pkix.Extension&#123;Id:asn1.ObjectIdentifier&#123;2, 5, 29, 19&#125;, Critical:true, Value:[]uint8&#123;0x30, 0x0&#125;&#125;, pkix.Extension&#123;Id:asn1.ObjectIdentifier&#123;2, 5, 29, 35&#125;, Critical:false, Value:[]uint8&#123;0x30, 0x22, 0x80, 0x20, 0x63, 0xbd, 0xab, 0x9a, 0x9c, 0xa7, 0x4f, 0x3d, 0x8b, 0xb6, 0xc3, 0xab, 0xc, 0xb1, 0x45, 0x87, 0x60, 0x69, 0x7e, 0xb9, 0x6, 0xfb, 0x38, 0x5f, 0x9c, 0x2, 0xb1, 0x75, 0x9b, 0xc6, 0x3d, 0xfb&#125;&#125;&#125;, ExtraExtensions:[]pkix.Extension(nil), UnhandledCriticalExtensions:[]asn1.ObjectIdentifier(nil), ExtKeyUsage:[]x509.ExtKeyUsage(nil), UnknownExtKeyUsage:[]asn1.ObjectIdentifier(nil), BasicConstraintsValid:true, IsCA:false, MaxPathLen:-1, MaxPathLenZero:false, SubjectKeyId:[]uint8(nil), AuthorityKeyId:[]uint8&#123;0x63, 0xbd, 0xab, 0x9a, 0x9c, 0xa7, 0x4f, 0x3d, 0x8b, 0xb6, 0xc3, 0xab, 0xc, 0xb1, 0x45, 0x87, 0x60, 0x69, 0x7e, 0xb9, 0x6, 0xfb, 0x38, 0x5f, 0x9c, 0x2, 0xb1, 0x75, 0x9b, 0xc6, 0x3d, 0xfb&#125;, OCSPServer:[]string(nil), IssuingCertificateURL:[]string(nil), DNSNames:[]string(nil), EmailAddresses:[]string(nil), IPAddresses:[]net.IP(nil), URIs:[]*url.URL(nil), PermittedDNSDomainsCritical:false, PermittedDNSDomains:[]string(nil), ExcludedDNSDomains:[]string(nil), PermittedIPRanges:[]*net.IPNet(nil), ExcludedIPRanges:[]*net.IPNet(nil), PermittedEmailAddresses:[]string(nil), ExcludedEmailAddresses:[]string(nil), PermittedURIDomains:[]string(nil), ExcludedURIDomains:[]string(nil), CRLDistributionPoints:[]string(nil), PolicyIdentifiers:[]asn1.ObjectIdentifier(nil)&#125;</span><br><span class="line">2021&#x2F;01&#x2F;25 03:42:33 clientIdentity.AssertAttributeValue(&quot;test&quot;, &quot;hello&quot;) error!</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•æ—¥å¿—åˆ†æ">æµ‹è¯•æ—¥å¿—åˆ†æ</h3><h4 id="clientIdentity-GetID">clientIdentity.GetID()</h4><h5 id="æºç -v2">æºç </h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id := fmt.Sprintf(<span class="string">&quot;x509::%s::%s&quot;</span>, getDN(&amp;c.cert.Subject), getDN(&amp;c.cert.Issuer))</span><br><span class="line"><span class="keyword">return</span> base64.StdEncoding.EncodeToString([]<span class="keyword">byte</span>(id)), <span class="literal">nil</span></span><br></pre></td></tr></table></figure><p>è§£ç æ—¥å¿—è¾“å‡ºçš„base64ç¼–ç çš„å†…å®¹<code>eDUwOTo6Q049QWRtaW5AczIuc3VwcGx5LmNvbSxMPVNhbiBGcmFuY2lzY28sU1Q9Q2FsaWZvcm5pYSxDPVVTOjpDTj1jYS5zMi5zdXBwbHkuY29tLE89czIuc3VwcGx5LmNvbSxMPVNhbiBGcmFuY2lzY28sU1Q9Q2FsaWZvcm5pYSxDPVVT</code>ç»“æœå¦‚ä¸‹ï¼Œä¸»è¦æ˜¯è¯ä¹¦é‡Œé¢çš„æ‘˜è¦ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x509::CN=Admin@s2.supply.com,L=San Francisco,ST=California,C=US::CN=ca.s2.supply.com,O=s2.supply.com,L=San Francisco,ST=California,C=US</span><br></pre></td></tr></table></figure><h4 id="clientIdentity-GetAttributeValue-â€œtestâ€">clientIdentity.GetAttributeValue(â€œtestâ€)</h4><p><code>log.Printf(&quot;clientIdentity.GetAttributeValue(\&quot;test\&quot;)=%s&quot;, value)</code>è¿™è¡Œæ—¥å¿—æ²¡æœ‰æ‰“å°ï¼Œæ˜¯å› ä¸ºæ²¡æœ‰æŸ¥è¯¢åˆ°è¿™ä¸ªå±æ€§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> API </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> ClientIdentity </tag>
            
            <tag> API </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°†æ™ºèƒ½åˆçº¦éƒ¨ç½²åˆ°é€šé“</title>
      <link href="2021/04/01/blockchain/fabric/%E5%B0%86%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E9%83%A8%E7%BD%B2%E5%88%B0%E9%80%9A%E9%81%93/"/>
      <url>2021/04/01/blockchain/fabric/%E5%B0%86%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E9%83%A8%E7%BD%B2%E5%88%B0%E9%80%9A%E9%81%93/</url>
      
        <content type="html"><![CDATA[<h1 id="Deploying-a-smart-contract-to-a-channelï¼ˆå°†æ™ºèƒ½åˆçº¦éƒ¨ç½²åˆ°é€šé“ï¼‰">Deploying a smart contract to a channelï¼ˆå°†æ™ºèƒ½åˆçº¦éƒ¨ç½²åˆ°é€šé“ï¼‰</h1><p><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deploy_chaincode.html">å‚è€ƒæ–‡æ¡£</a></p><p>æœ€ç»ˆç”¨æˆ·é€šè¿‡è°ƒç”¨æ™ºèƒ½åˆçº¦ä¸åŒºå—é“¾è´¦æœ¬è¿›è¡Œäº¤äº’ã€‚åœ¨Hyperledger Fabricä¸­ï¼Œæ™ºèƒ½åˆçº¦é€šè¿‡ç§°ä¸ºchaincodeçš„è½¯ä»¶åŒ…è¿›è¡Œéƒ¨ç½²ã€‚ä¸€ä¸ªç»„ç»‡æƒ³è¦éªŒè¯äº¤æ˜“æˆ–è€…æŸ¥è¯¢è´¦æœ¬çš„å†…å®¹ï¼Œå°±éœ€è¦åœ¨å…¶peerèŠ‚ç‚¹ä¸Šéƒ¨ç½²chaincodeã€‚å½“ä¸€ä¸ªå·²ç»å®‰è£…äº†chaincodeçš„èŠ‚ç‚¹åŠ å…¥channelä¹‹åï¼Œchannelçš„æˆå‘˜å°±å¯ä»¥æŠŠchaincodeéƒ¨ç½²åˆ°channelä¸Šï¼Œç„¶åä½¿ç”¨chaincodeä¸Šçš„æ™ºèƒ½åˆçº¦æ¥åˆ›å»ºå’Œæ›´æ–°chanelè´¦æœ¬ä¸Šçš„èµ„äº§ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå«åšFabricé“¾ç ç”Ÿå‘½å‘¨æœŸçš„ç¨‹åºæ¥å°†chaincodeéƒ¨ç½²åˆ°channelä¸Šï¼›åœ¨é“¾ç å¯ä»¥è¢«ä½¿ç”¨äºäº¤æ˜“ä¹‹å‰ï¼ŒFabricé“¾ç ç”Ÿå‘½å‘¨æœŸéœ€è¦å¤šä¸ªç»„ç»‡åŒæ„é“¾ç å°†å¦‚ä½•æ“ä½œã€‚ï¼ˆ<em>ä¸ªäººç†è§£ï¼šéœ€è¦ç»„ç»‡åŒæ„æ™ºèƒ½åˆçº¦çš„å†…å®¹ï¼Œæ™ºèƒ½åˆçº¦æ‰èƒ½éƒ¨ç½²åˆ°channelä¸Š</em>ï¼‰ä¸¾ä¸ªä¾‹å­ï¼Œå½“ä¸€ä¸ªèƒŒä¹¦ç­–ç•¥åˆ¶å®šå“ªäº›ç»„ç»‡éœ€è¦æ‰§è¡Œchaincodeæ¥éªŒè¯ä¸€ä¸ªäº¤æ˜“æ—¶ï¼Œchannelä¸Šçš„æˆå‘˜éœ€è¦ä½¿ç”¨Fabricé“¾ç ç”Ÿå‘½å‘¨æœŸæ¥åŒæ„é“¾ç çš„èƒŒä¹¦ç­–ç•¥ã€‚æœ‰å…³å¦‚ä½•åœ¨é€šé“ä¸Šéƒ¨ç½²å’Œç®¡ç†é“¾ç çš„æ›´æ·±å…¥çš„æ¦‚è¿°ï¼Œè¯·å‚é˜…<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/chaincode_lifecycle.html">Fabric chaincode lifecycle</a>ã€‚</p><p>ä½ å¯ä»¥ä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html">peer lifecycle chaincode commands</a>è¿™ä¸ªæ•™ç¨‹æ¥å­¦ä¹ åœ¨Fabricæµ‹è¯•ç½‘ç»œä¸­å¦‚ä½•ä½¿ç”¨peer lifecycle chaincode commandsæ¥éƒ¨ç½²é“¾ç åˆ°channelã€‚äº†è§£å‘½ä»¤åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æœ¬æ•™ç¨‹ä¸­çš„æ­¥éª¤å°†è‡ªå·±çš„é“¾ç éƒ¨ç½²åˆ°æµ‹è¯•æˆ–ç”Ÿäº§ç½‘ç»œã€‚åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œä½ ä¼šéƒ¨ç½²æ•™ç¨‹<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/write_first_app.html">Writing your first application tutorial</a>ä½¿ç”¨çš„é“¾ç ç¨‹åºã€‚</p><p>**æ³¨æ„ï¼š**å½“å‰æ•™ç¨‹ä½¿ç”¨v2.0ç‰ˆæœ¬ä¸­å¼•å…¥çš„Fabricé“¾ç ç”Ÿå‘½å‘¨æœŸã€‚</p><h2 id="Start-the-networkï¼ˆå¯åŠ¨æµ‹è¯•ç½‘ç»œï¼‰">Start the networkï¼ˆå¯åŠ¨æµ‹è¯•ç½‘ç»œï¼‰</h2><p>å¯åŠ¨æµ‹è¯•ç½‘ç»œå¹¶åˆ›å»ºchannelï¼Œå…·ä½“æ­¥éª¤å‚è€ƒ<a href="Fabric%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%E4%BD%BF%E7%94%A8.md">Fabricæµ‹è¯•ç½‘ç»œä½¿ç”¨</a>ã€‚</p><p>ä½ å¯ä»¥æ ¹æ®ä»¥ä¸‹æ­¥éª¤ä½¿ç”¨èŠ‚ç‚¹çš„CLIæ¥éƒ¨ç½² asset-transfer (basic) é“¾ç åˆ°channelä¸­ï¼š</p><ul><li>[ç¬¬ä¸€æ­¥ï¼šæ‰“åŒ…æ™ºèƒ½åˆçº¦]</li><li>[ç¬¬äºŒæ­¥ï¼šå®‰è£…é“¾ç åŒ…]</li><li>[ç¬¬ä¸‰æ­¥ï¼šæ‰¹å‡†é“¾ç å®šä¹‰]</li><li>[ç¬¬å››éƒ¨ï¼šæäº¤é“¾ç å®šä¹‰åˆ°channelä¸­]</li></ul><h2 id="Setup-Logspout-optional-ï¼ˆå¯åŠ¨æ—¥å¿—è¾“å‡ºï¼Œå¯é€‰ï¼‰">Setup Logspout (optional)ï¼ˆå¯åŠ¨æ—¥å¿—è¾“å‡ºï¼Œå¯é€‰ï¼‰</h2><p>æ­¤æ­¥éª¤ä¸æ˜¯å¿…éœ€çš„ï¼Œä½†æ˜¯å¯¹äºæ•…éšœæ’é™¤é“¾ç éå¸¸æœ‰ç”¨ã€‚è¦ç›‘è§†æ™ºèƒ½åˆçº¦çš„æ—¥å¿—ï¼Œç®¡ç†å‘˜å¯ä»¥ä½¿ç”¨<a href="https://logdna.com/blog/what-is-logspout/">logspout</a>æŸ¥çœ‹ä¸€ç»„Dockerå®¹å™¨çš„èšåˆè¾“å‡ºã€‚è¿™ä¸ªå·¥å…·æ”¶é›†ä¸åŒçš„Dockerå®¹å™¨çš„è¾“å‡ºæµåˆ°ä¸€ä¸ªä½ç½®ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸€ä¸ªçª—å£çœ‹è¿™äº›å®¹å™¨éƒ½å‘ç”Ÿäº†ä»€ä¹ˆã€‚è¿™å¯ä»¥å¸®åŠ©ç®¡ç†å‘˜åœ¨å®‰è£…æ™ºèƒ½åˆçº¦æˆ–è€…æ˜¯å¼€å‘äººå‘˜è°ƒç”¨æ™ºèƒ½åˆçº¦æ—¶è°ƒè¯•é—®é¢˜ã€‚å› ä¸ºæŸäº›å®¹å™¨çš„åˆ›å»ºçº¯ç²¹æ˜¯ä¸ºäº†å¯åŠ¨æ™ºèƒ½åˆçº¦ï¼Œå¹¶ä¸”ä»…å­˜åœ¨å¾ˆçŸ­çš„æ—¶é—´ï¼Œæ‰€ä»¥ä»ç½‘ç»œä¸­æ”¶é›†æ‰€æœ‰æ—¥å¿—å°†å¾ˆæœ‰å¸®åŠ©ã€‚</p><p><a href="http://xn--FabricLogspoutmonitordocker-8c86b0p99fdhu31ag34avvicndd5i2t1e0etn22cmk5an23jl6lva1361ad0b263jzdgipw4t2gbf9d.sh">Fabricçš„å•†ä¸šç¥¨æ®ç¤ºä¾‹ä¸­å·²ç»åŒ…å«äº†ç”¨äºå®‰è£…å’Œé…ç½®Logspoutçš„è„šæœ¬monitordocker.sh</a>ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜å°†ä½¿ç”¨ç›¸åŒçš„è„šæœ¬ã€‚Logspoutå·¥å…·å°†æŒç»­å‘æ‚¨çš„ç»ˆç«¯æµå¼ä¼ è¾“æ—¥å¿—ï¼Œå› æ­¤æ‚¨å°†éœ€è¦ä½¿ç”¨æ–°çš„ç»ˆç«¯çª—å£ã€‚æ‰“å¼€ä¸€ä¸ªæ–°ç»ˆç«¯ï¼Œç„¶åå¯¼èˆªåˆ°test-networkç›®å½•ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd fabric-samples/test-network</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥åœ¨ä»»ä½•ç›®å½•ä¸‹è¿è¡Œ <code>monitordocker.sh</code>è„šæœ¬ï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨æˆ‘ä»¬æŠŠ <code>monitordocker.sh</code> ä»<code>commercial-paper</code>æ‹·è´åˆ°ä½ çš„å·¥ä½œç›®å½•(test-network)ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp ../commercial-paper/organization/digibank/configuration/cli/monitordocker.sh .</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥å¯åŠ¨Logspoutï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./monitordocker.sh net_test</span><br></pre></td></tr></table></figure><p>ä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Starting monitoring on all containers on the network net_basic</span><br><span class="line">Unable to find image &#x27;gliderlabs/logspout:latest&#x27; locally</span><br><span class="line">latest: Pulling from gliderlabs/logspout</span><br><span class="line">4fe2ade4980c: Pull complete</span><br><span class="line">decca452f519: Pull complete</span><br><span class="line">ad60f6b6c009: Pull complete</span><br><span class="line">Digest: sha256:374e06b17b004bddc5445525796b5f7adb8234d64c5c5d663095fccafb6e4c26</span><br><span class="line">Status: Downloaded newer image for gliderlabs/logspout:latest</span><br><span class="line">1f99d130f15cf01706eda3e1f040496ec885036d485cb6bcc0da4a567ad84361</span><br></pre></td></tr></table></figure><p>åœ¨æˆ‘ä»¬éƒ¨ç½²é“¾ç ä¹‹å‰ä½ ä¸ä¼šçœ‹åˆ°å¤ªå¤šçš„æ—¥å¿—ã€‚</p><h2 id="Package-the-smart-contractï¼ˆæ‰“åŒ…æ™ºèƒ½åˆçº¦ï¼‰">Package the smart contractï¼ˆæ‰“åŒ…æ™ºèƒ½åˆçº¦ï¼‰</h2><p>We need to package the chaincode before it can be installed on our peers. The steps are different if you want to install a smart contract written in <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deploy_chaincode.html#go">Go</a>, <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deploy_chaincode.html#javascript">JavaScript</a>, or <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deploy_chaincode.html#typescript">Typescript</a>.</p><p>åœ¨æŠŠæ™ºèƒ½åˆçº¦å®‰è£…åˆ°æˆ‘ä»¬çš„èŠ‚ç‚¹ä¹‹å‰éœ€è¦å…ˆå°†å…¶æ‰“åŒ…ã€‚æ ¹æ®ç¼–å†™æ™ºèƒ½åˆçº¦çš„è¯­è¨€çš„ä¸åŒï¼Œå…¶æ­¥éª¤ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚ï¼ˆ<em>æœ¬æ¬¡åªä½¿ç”¨Goï¼Œå…¶ä»–è¯­è¨€å¦‚<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deploy_chaincode.html#go">Go</a>, <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deploy_chaincode.html#javascript">JavaScript</a>, or <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deploy_chaincode.html#typescript">Typescript</a>è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£</em>ï¼‰</p><h3 id="Go">Go</h3><p>åœ¨æˆ‘ä»¬æ‰“åŒ…é“¾ç ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå®‰è£…é“¾ç çš„ä¾èµ–ã€‚åˆ‡æ¢åˆ°Goç‰ˆæœ¬çš„ asset-transfer (basic) é¡¹ç›®ç›®å½•ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd fabric-samples/asset-transfer-basic/chaincode-go</span><br></pre></td></tr></table></figure><p>è¯¥ç¤ºä¾‹ä½¿ç”¨Goæ¨¡å—æ¥å®‰è£…chaincodeä¾èµ–é¡¹ã€‚ä¾èµ–å…³ç³»åˆ—åœ¨asset-transfer-basic / chaincode-goç›®å½•çš„go.modæ–‡ä»¶ä¸­ã€‚æ‚¨åº”è¯¥èŠ±ä¸€ç‚¹æ—¶é—´æ¥æ£€æŸ¥æ­¤æ–‡ä»¶ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">module github.com/hyperledger/fabric-samples/asset-transfer-basic/chaincode-<span class="keyword">go</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="number">1.14</span></span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">        github.com/golang/protobuf v1<span class="number">.3</span><span class="number">.2</span></span><br><span class="line">        github.com/hyperledger/fabric-chaincode-<span class="keyword">go</span> v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200424173110</span>-d7076418f212</span><br><span class="line">        github.com/hyperledger/fabric-contract-api-<span class="keyword">go</span> v1<span class="number">.1</span><span class="number">.0</span></span><br><span class="line">        github.com/hyperledger/fabric-protos-<span class="keyword">go</span> v0<span class="number">.0</span><span class="number">.0</span><span class="number">-20200424173316</span>-dd554ba3746e</span><br><span class="line">        github.com/stretchr/testify v1<span class="number">.5</span><span class="number">.1</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>go.modæ–‡ä»¶å°†Fabricåˆçº¦APIå¯¼å…¥åˆ°æ™ºèƒ½åˆçº¦åŒ…ä¸­ã€‚ä½ å¯ä»¥æ‰“å¼€<code>asset-transfer-basic/chaincode-go/chaincode/smartcontract.go</code>æ¥æŸ¥çœ‹åœ¨æ™ºèƒ½åˆçº¦çš„æœ€å¼€å§‹æ˜¯å¦‚ä½¿ç”¨contract APIæ¥å®šä¹‰<code>SmartContract</code>ç±»çš„ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SmartContract provides functions for managing an Asset</span></span><br><span class="line"><span class="keyword">type</span> SmartContract <span class="keyword">struct</span> &#123;</span><br><span class="line">    contractapi.Contract</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œå°†SmartContractç±»å‹ç”¨äºä¸ºæ™ºèƒ½åˆçº¦ä¸­å®šä¹‰çš„æ–¹æ³•åˆ›å»ºäº¤æ˜“ä¸Šä¸‹æ–‡ï¼Œè¯¥æ–¹æ³•å¯å°†æ•°æ®è¯»å–å’Œå†™å…¥åŒºå—é“¾è´¦æœ¬ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// CreateAsset issues a new asset to the world state with given details.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartContract)</span> <span class="title">CreateAsset</span><span class="params">(ctx contractapi.TransactionContextInterface, id <span class="keyword">string</span>, color <span class="keyword">string</span>, size <span class="keyword">int</span>, owner <span class="keyword">string</span>, appraisedValue <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">exists, err := s.AssetExists(ctx, id)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> exists &#123;</span><br><span class="line"><span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;the asset %s already exists&quot;</span>, id)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">asset := Asset&#123;</span><br><span class="line">ID:             id,</span><br><span class="line">Color:          color,</span><br><span class="line">Size:           size,</span><br><span class="line">Owner:          owner,</span><br><span class="line">AppraisedValue: appraisedValue,</span><br><span class="line">&#125;</span><br><span class="line">assetJSON, err := json.Marshal(asset)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ctx.GetStub().PutState(id, assetJSON)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ å¯ä»¥é€šè¿‡è®¿é—® <a href="https://github.com/hyperledger/fabric-contract-api-go">API documentation</a> å’Œ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/developapps/smartcontract.html">smart contract processing topic</a>æ¥å­¦ä¹ æ›´å¤šçš„å…³äºåˆçº¦APIçš„å†…å®¹ã€‚</p><p>ä¸ºäº†å®‰è£…æ™ºèƒ½åˆçº¦çš„ä¾èµ–ï¼Œåœ¨<code>asset-transfer-basic/chaincode-go</code> ç›®å½•ä¸‹è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GO111MODULE=on go mod vendor</span><br></pre></td></tr></table></figure><p>å¦‚æœå‘½ä»¤æˆåŠŸï¼Œåˆ™goè½¯ä»¶åŒ…å°†å®‰è£…vendoræ–‡ä»¶å¤¹ä¸­ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¾èµ–çš„åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºchaincodeçš„åŒ…äº†ã€‚æŠŠå½“å‰ç›®å½•åˆ‡æ¢åˆ°<code>test-network</code> ä»¥ä¾¿æˆ‘ä»¬å¯ä»¥å°†é“¾ç äºå…¶ä»–ç½‘ç»œç»„ä»¶æ‰“åŒ…åœ¨ä¸€èµ·ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ..&#x2F;..&#x2F;test-network</span><br></pre></td></tr></table></figure><p>You can use the <code>peer</code> CLI to create a chaincode package in the required format. The <code>peer</code> binaries are located in the <code>bin</code> folder of the <code>fabric-samples</code> repository. Use the following command to add those binaries to your CLI Path:</p><p>æ‚¨å¯ä»¥ä½¿ç”¨<code>peer</code>CLIåˆ›å»ºæ‰€éœ€æ ¼å¼çš„é“¾ç åŒ…ã€‚<code>peer</code>äºŒè¿›åˆ¶æ–‡ä»¶ä½äºfabric-sampleså­˜å‚¨åº“çš„binæ–‡ä»¶å¤¹ä¸­ã€‚å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ·»åŠ åˆ°ä½ çš„ç¯å¢ƒå˜é‡ä¸­ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$&#123;PWD&#125;/../bin:$PATH</span><br></pre></td></tr></table></figure><p>æ‚¨è¿˜éœ€è¦å°†FABRIC_CFG_PATHè®¾ç½®ä¸ºæŒ‡å‘fabric-sampleså­˜å‚¨åº“ä¸­çš„core.yamlæ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export FABRIC_CFG_PATH=$PWD/../config/</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥çœ‹peerçš„ç‰ˆæœ¬ï¼Œå¦‚æœè¾“å‡ºæ­£å¸¸è¯´æ˜ä½ å·²ç»å¯ä»¥ä½¿ç”¨<code>peer</code>CLIäº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer version</span><br></pre></td></tr></table></figure><p>You can now create the chaincode package using the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-package">peer lifecycle chaincode package</a> command:</p><p>ç°åœ¨ä½ å¯ä»¥é€šè¿‡ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-package">peer lifecycle chaincode package</a> å‘½ä»¤æ¥åˆ›å»ºé“¾ç åŒ…äº†:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode package basic.tar.gz --path ../asset-transfer-basic/chaincode-go/ --lang golang --label basic_1.0</span><br></pre></td></tr></table></figure><p>This command will create a package named <code>basic.tar.gz</code> in your current directory. The <code>--lang</code> flag is used to specify the chaincode language and the <code>--path</code> flag provides the location of your smart contract code. The path must be a fully qualified path or a path relative to your present working directory. The <code>--label</code> flag is used to specify a chaincode label that will identity your chaincode after it is installed. It is recommended that your label include the chaincode name and version.</p><p>è¿™ä¸ªå‘½ä»¤ä¼šåœ¨ä½ çš„å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<code>basic.tar.gz</code>çš„å‹ç¼©åŒ…ã€‚<code>--lang</code>æ ‡å¿—æ˜¯åˆ¶å®šchaincodeçš„è¯­è¨€ï¼Œè€Œ<code>--path</code> æ ‡å¿—ç”¨äºæä¾›æ™ºèƒ½åˆçº¦ä»£ç çš„ä½ç½®ã€‚è¯¥è·¯å¾„å¿…é¡»æ˜¯æ ‡å‡†è·¯å¾„æˆ–ç›¸å¯¹äºæ‚¨å½“å‰å·¥ä½œç›®å½•çš„è·¯å¾„ã€‚<code>--label</code>æ ‡å¿—ç”¨äºæŒ‡å®šä¸€ä¸ªé“¾ç æ ‡ç­¾ï¼Œè¯¥æ ‡ç­¾å°†åœ¨å®‰è£…é“¾ç åå¯¹å…¶è¿›è¡Œæ ‡è¯†ã€‚å»ºè®®æ‚¨çš„æ ‡ç­¾åŒ…å«é“¾ç åç§°å’Œç‰ˆæœ¬ã€‚</p><p>Now that we created the chaincode package, we can <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deploy_chaincode.html#install-the-chaincode-package">install the chaincode</a> on the peers of the test network.</p><p>ç°åœ¨æˆ‘ä»¬å·²ç»åˆ›å»ºäº†é“¾ç åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠé“¾ç å®‰è£…åˆ°ç½‘ç»œä¸Šçš„èŠ‚ç‚¹ä¸Šäº†ã€‚</p><h2 id="Install-the-chaincode-packageï¼ˆå®‰è£…é“¾ç åŒ…ï¼‰">Install the chaincode packageï¼ˆå®‰è£…é“¾ç åŒ…ï¼‰</h2><p>After we package the asset-transfer (basic) smart contract, we can install the chaincode on our peers. The chaincode needs to be installed on every peer that will endorse a transaction. Because we are going to set the endorsement policy to require endorsements from both Org1 and Org2, we need to install the chaincode on the peers operated by both organizations:</p><p>åœ¨æˆ‘ä»¬æ‰“åŒ…äº† asset-transfer (basic) çš„æ™ºèƒ½åˆçº¦ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†æ­¤é“¾ç å®‰è£…åˆ°æˆ‘ä»¬çš„peerèŠ‚ç‚¹ä¸Šäº†ã€‚éœ€è¦åœ¨æ‰€æœ‰çš„äº¤æ˜“èƒŒä¹¦èŠ‚ç‚¹ä¸Šå®‰è£…é“¾ç ã€‚å› ä¸ºæˆ‘ä»¬å°†è®¾ç½®èƒŒä¹¦ç­–ç•¥è¦æ±‚æ¥è‡ªOrg1å’ŒOrg2çš„èƒŒä¹¦ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ä¸¤ä¸ªç»„ç»‡è¿è¥çš„å¯¹ç­‰æ–¹ä¸Šå®‰è£…é“¾ç ï¼š</p><ul><li><a href="http://peer0.org1.example.com">peer0.org1.example.com</a></li><li><a href="http://peer0.org2.example.com">peer0.org2.example.com</a></li></ul><p>Letâ€™s install the chaincode on the Org1 peer first. Set the following environment variables to operate the <code>peer</code> CLI as the Org1 admin user. The <code>CORE_PEER_ADDRESS</code> will be set to point to the Org1 peer, <code>peer0.org1.example.com</code>.</p><p>è®©æˆ‘ä»¬å…ˆæŠŠé“¾ç å®‰è£…åˆ°Org1çš„èŠ‚ç‚¹ä¸Šã€‚è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡æ¥ä½¿ç”¨Org1çš„adminç”¨æˆ·çš„èº«ä»½è¿è¡Œ<code>peer</code>CLIã€‚å°†CORE_PEER_ADDRESSè®¾ç½®ä¸ºæŒ‡å‘Org1çš„èŠ‚ç‚¹çš„<code>peer0.org1.example.com</code>ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export CORE_PEER_TLS_ENABLED=true</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:7051</span><br></pre></td></tr></table></figure><p>Issue the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-install">peer lifecycle chaincode install</a> command to install the chaincode on the peer:</p><p>å‘å‡ºåœ¨peerèŠ‚ç‚¹ä¸Šå®‰è£…é“¾ç çš„å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode install basic.tar.gz</span><br></pre></td></tr></table></figure><p>If the command is successful, the peer will generate and return the package identifier. This package ID will be used to approve the chaincode in the next step. You should see output similar to the following:</p><p>å¦‚æœå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œåˆ™peerå°†ç”Ÿæˆå¹¶è¿”å›å®‰è£…åŒ…çš„æ ‡è¯†ç¬¦ã€‚è¿™ä¸ªåŒ…çš„IDä¼šåœ¨ä¸‹ä¸€æ­¥æ‰¹å‡†è¿™ä¸ªé“¾ç æ—¶ä½¿ç”¨ã€‚ä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-21 14:46:18.360 CST [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 001 Installed remotely: response:&lt;status:200 payload:&quot;\nJbasic_1.0:2c47b5b060a64aafa3c878b4bcb0ca680bdb2417ca8855b5440fa595562517d2\022\tbasic_1.0&quot; &gt;</span><br><span class="line">2020-12-21 14:46:18.361 CST [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 002 Chaincode code package identifier: basic_1.0:2c47b5b060a64aafa3c878b4bcb0ca680bdb2417ca8855b5440fa595562517d2</span><br></pre></td></tr></table></figure><p>åœ¨è¿è¡Œ<code>monitordocker.sh</code>çš„ç»ˆç«¯å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„æ—¥å¿—ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">peer0.org1.example.com|2020-12-21 06:46:18.363 UTC [lifecycle] InstallChaincode -&gt; INFO 046 Successfully installed chaincode with package ID &#x27;basic_1.0:2c47b5b060a64aafa3c878b4bcb0ca680bdb2417ca8855b5440fa595562517d2&#x27;</span><br><span class="line">peer0.org1.example.com|2020-12-21 06:46:18.363 UTC [endorser] callChaincode -&gt; INFO 047 finished chaincode: _lifecycle duration: 35751ms channel= txID=26a66cb7</span><br><span class="line">peer0.org1.example.com|2020-12-21 06:46:18.363 UTC [comm.grpc.server] 1 -&gt; INFO 048 unary call completed grpc.service=protos.Endorser grpc.method=ProcessProposal grpc.peer_address=172.19.0.1:62970 grpc.code=OK grpc.call_duration=35.752599039s</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>We can now install the chaincode on the Org2 peer. Set the following environment variables to operate as the Org2 admin and target target the Org2 peer, <a href="http://peer0.org2.example.com">peer0.org2.example.com</a>.</p><p>ç°åœ¨æˆ‘ä»¬æŠŠé“¾ç å®‰è£…åˆ°Org2ç»„ç»‡çš„peerèŠ‚ç‚¹ä¸Šã€‚å…ˆè®¾ç½®ç¯å¢ƒå˜é‡è®©æˆ‘ä»¬å¯ä»¥ä»¥Org2çš„ç®¡ç†å‘˜èº«ä»½æ¥æ“ä½œOrg2çš„èŠ‚ç‚¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:9051</span><br></pre></td></tr></table></figure><p>Issue the following command to install the chaincodeï¼ˆå‘å‡ºä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…é“¾ç ï¼‰:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode install basic.tar.gz</span><br></pre></td></tr></table></figure><p>The chaincode is built by the peer when the chaincode is installed. The install command will return any build errors from the chaincode if there is a problem with the smart contract code.</p><p>åœ¨å®‰è£…é“¾ç æ—¶ï¼Œç”±peerèŠ‚ç‚¹æ¥æ„å»ºé“¾ç ã€‚å¦‚æœæ™ºèƒ½åˆçº¦æœ‰é—®é¢˜ï¼Œå®‰è£…å‘½ä»¤ä¼šæŠŠæ‰€æœ‰æ„å»ºçš„é”™è¯¯è¿”å›ã€‚</p><h2 id="Approve-a-chaincode-definitionï¼ˆæ‰¹å‡†é“¾ç å®šä¹‰ï¼‰">Approve a chaincode definitionï¼ˆæ‰¹å‡†é“¾ç å®šä¹‰ï¼‰</h2><p>After you install the chaincode package, you need to approve a chaincode definition for your organization. The definition includes the important parameters of chaincode governance such as the name, version, and the chaincode endorsement policy.</p><p>åœ¨å®‰è£…é“¾ç åŒ…ä¹‹åï¼Œéœ€è¦ä½ æ‰€åœ¨çš„ç»„ç»‡æ‰¹å‡†é“¾ç çš„å®šä¹‰ã€‚è¿™ä¸ªå®šä¹‰åŒ…æ‹¬é“¾ç ç®¡ç†çš„é‡è¦å‚æ•°ï¼Œä¾‹å¦‚åç§°ã€ç‰ˆæœ¬ä»¥åŠé“¾ç çš„èƒŒä¹¦ç­–ç•¥ã€‚</p><p>The set of channel members who need to approve a chaincode before it can be deployed is governed by the <code>Application/Channel/lifeycleEndorsement</code> <a href="http://policy.By">policy.By</a> default, this policy requires that a majority of channel members need to approve a chaincode before it can used on a channel.Because we have only two organizations on the channel, and a majority of 2 is 2, we need approve a chaincode definition of asset-transfer (basic) as Org1 and Org2.</p><p>åœ¨channelä¸Šçš„å“ªäº›æˆå‘˜éœ€è¦åœ¨å…¶å¯ä»¥éƒ¨ç½²é“¾ç ä¹‹å‰æ‰¹å‡†ï¼Œæ˜¯å®šä¹‰åœ¨<code>Application/Channel/lifeycleEndorsement</code>ç­–ç•¥ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤ç­–ç•¥è¦æ±‚å¤§å¤šæ•°channelçš„æˆå‘˜éœ€è¦æ‰¹å‡†é“¾ç åæ‰èƒ½åœ¨é¢‘é“ä¸Šä½¿ç”¨ã€‚å› ä¸ºåœ¨æˆ‘ä»¬çš„channelä¸Šåªæœ‰ä¸¤ä¸ªç»„ç»‡ï¼Œå¹¶ä¸”å¤§å¤šæ•°å°±æ˜¯2ï¼Œæˆ‘ä»¬éœ€è¦ä»¥Org1å’ŒOrg2çš„èº«ä»½æ¥æ‰¹å‡†asset-transfer (basic)çš„é“¾ç å®šä¹‰ã€‚</p><p>If an organization has installed the chaincode on their peer, they need to include the packageID in the chaincode definition approved by their organization. The package ID is used to associate the chaincode installed on a peer with an approved chaincode definition, and allows an organization to use the chaincode to endorse transactions. You can find the package ID of a chaincode by using the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-queryinstalled">peer lifecycle chaincode queryinstalled</a> command to query your peer.</p><p>å¦‚æœä¸€ä¸ªç»„ç»‡å·²ç»åœ¨å…¶peerèŠ‚ç‚¹ä¸Šå®‰è£…äº†é“¾ç ï¼Œè¿™ä¸ªç»„ç»‡éœ€è¦åœ¨å…¶æ‰¹å‡†çš„é“¾ç å®šä¹‰ä¸­åŒ…å«packageIDã€‚packageIDæ˜¯ç”¨æ¥æŠŠå®‰è£…åœ¨èŠ‚ç‚¹ä¸Šçš„chaincodeå’Œå·²ç»æ‰¹å‡†é€šè¿‡çš„é“¾ç å®šä¹‰å…³è”èµ·æ¥çš„ï¼Œå¹¶ä¸”å…è®¸ä¸€ä¸ªç»„ç»‡åœ¨èƒŒä¹¦èŠ‚ç‚¹ä½¿ç”¨è¿™ä¸ªé“¾ç ã€‚ä½ å¯ä»¥ä½¿ç”¨<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-queryinstalled">peer lifecycle chaincode queryinstalled</a> å‘½ä»¤åœ¨ä½ çš„peerèŠ‚ç‚¹ä¸ŠæŸ¥è¯¢ä¸€ä¸ªé“¾ç çš„packageIDã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode queryinstalled</span><br></pre></td></tr></table></figure><p>The package ID is the combination of the chaincode label and a hash of the chaincode binaries. Every peer will generate the same package ID. You should see output similar to the following:</p><p>packageIDæ˜¯é“¾ç æ ‡ç­¾å’Œé“¾ç äºŒè¿›åˆ¶æ–‡ä»¶çš„å“ˆå¸Œå€¼çš„ç»„åˆã€‚æ¯ä¸ªpeerå°†ç”Ÿæˆç›¸åŒçš„ç¨‹åºåŒ…IDã€‚æ‚¨åº”è¯¥çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Installed chaincodes on peer:</span><br><span class="line">Package ID: basic_1.0:2c47b5b060a64aafa3c878b4bcb0ca680bdb2417ca8855b5440fa595562517d2, Label: basic_1.0</span><br></pre></td></tr></table></figure><p>We are going to use the package ID when we approve the chaincode, so letâ€™s go ahead and save it as an environment variable. Paste the package ID returned by <code>peer lifecycle chaincode queryinstalled</code> into the command below. <strong>Note:</strong> The package ID will not be the same for all users, so you need to complete this step using the package ID returned from your command window in the previous step.</p><p>åœ¨æˆ‘ä»¬æ‰¹å‡†é“¾ç æ—¶æˆ‘ä»¬éœ€è¦ä½¿ç”¨è¿™ä¸ª package IDï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å…ˆæŠŠå®ƒä¿å­˜ä¸ºä¸€ä¸ªç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export CC_PACKAGE_ID=basic_1.0:2c47b5b060a64aafa3c878b4bcb0ca680bdb2417ca8855b5440fa595562517d2</span><br></pre></td></tr></table></figure><p>Because the environment variables have been set to operate the <code>peer</code> CLI as the Org2 admin, we can approve the chaincode definition of asset-transfer (basic) as Org2. Chaincode is approved at the organization level, so the command only needs to target one peer. The approval is distributed to the other peers within the organization using gossip. Approve the chaincode definition using the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-approveformyorg">peer lifecycle chaincode approveformyorg</a> command:</p><p>å› ä¸ºå½“å‰çš„ç¯å¢ƒå˜é‡å·²ç»è®¾ç½®ä¸ºä»¥Org2ç»„ç»‡çš„ç®¡ç†å‘˜æ¥æ“ä½œ<code>peer</code>CLIï¼Œæˆ‘ä»¬å¯ä»¥ä»¥ç»„ç»‡Org2çš„èº«ä»½æ‰¹å‡†è¿™ä¸ªasset-transfer (basic)çš„é“¾ç å®šä¹‰ã€‚é“¾ç æ˜¯åœ¨ç»„ç»‡çš„çº§åˆ«è¿›è¡Œæ‰¹å‡†çš„ï¼Œæ‰€ä»¥è¿™ä¸ªå‘½ä»¤åªéœ€è¦é’ˆå¯¹ä¸€ä¸ªpeerèŠ‚ç‚¹å³å¯ã€‚è¿™ä¸ªæ‰¹å‡†çš„åŠ¨ä½œä¼šä½¿ç”¨gossipæ¥åœ¨ç»„ç»‡å†…éƒ¨ä¼ æ’­ã€‚ä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-approveformyorg">peer lifecycle chaincode approveformyorg</a>å‘½ä»¤æ¥æ‰¹å‡†é“¾ç å®šä¹‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode approveformyorg -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name basic --version 1.0 --package-id $CC_PACKAGE_ID --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br></pre></td></tr></table></figure><p>The command above uses the <code>--package-id</code> flag to include the package identifier in the chaincode definition. The <code>--sequence</code> parameter is an integer that keeps track of the number of times a chaincode has been defined or updated. Because the chaincode is being deployed to the channel for the first time, the sequence number is 1. When the asset-transfer (basic) chaincode is upgraded, the sequence number will be incremented to 2. If you are using the low level APIs provided by the Fabric Chaincode Shim API, you could pass the <code>--init-required</code> flag to the command above to request the execution of the Init function to initialize the chaincode. The first invoke of the chaincode would need to target the Init function and include the <code>--isInit</code> flag before you could use the other functions in the chaincode to interact with the ledger.</p><p>ä¸Šé¢çš„å‘½ä»¤ä½¿ç”¨<code>--package-id</code>æ ‡å¿—å°†è½¯ä»¶åŒ…æ ‡è¯†ç¬¦åŒ…å«åœ¨é“¾ç å®šä¹‰ä¸­ã€‚<code>--sequence</code>å‚æ•°æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œç”¨äºè·Ÿè¸ªå®šä¹‰æˆ–æ›´æ–°é“¾ç çš„æ¬¡æ•°ï¼›ç”±äºé“¾ç æ˜¯ç¬¬ä¸€æ¬¡éƒ¨ç½²åˆ°channelï¼Œå› æ­¤åºåˆ—å·ä¸º1ã€‚å½“asset-transfer (basic) çš„é“¾ç åœ¨æ›´æ–°æ—¶ï¼Œè¿™ä¸ªåºåˆ—å·ä¼šå¢åŠ åˆ°2ã€‚é“¾ä»£ç çš„é¦–æ¬¡è°ƒç”¨éœ€è¦ä½¿ç”¨<code>--isInit</code>æ¥æŒ‡æ˜è°ƒç”¨é“¾ç çš„Initå‡½æ•°ï¼Œç„¶åæ‰èƒ½ä½¿ç”¨é“¾ä»£ç ä¸­çš„å…¶ä»–å‡½æ•°ä¸è´¦æœ¬è¿›è¡Œäº¤äº’ã€‚</p><p>We could have provided a <code>--signature-policy</code> or <code>--channel-config-policy</code> argument to the <code>approveformyorg</code> command to specify a chaincode endorsement policy. The endorsement policy specifies how many peers belonging to different channel members need to validate a transaction against a given chaincode. Because we did not set a policy, the definition of asset-transfer (basic) will use the default endorsement policy, which requires that a transaction be endorsed by a majority of channel members present when the transaction is submitted. This implies that if new organizations are added or removed from the channel, the endorsement policy is updated automatically to require more or fewer endorsements. In this tutorial, the default policy will require a majority of 2 out of 2 and transactions will need to be endorsed by a peer from Org1 and Org2. If you want to specify a custom endorsement policy, you can use the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/endorsement-policies.html">Endorsement Policies</a> operations guide to learn about the policy syntax.</p><p>æˆ‘ä»¬å¯ä»¥åœ¨<code>approveformyorg</code>å‘½ä»¤ä¸­æä¾›<code>--signature-policy</code>æˆ–<code>--channel-config-policy</code>å‚æ•°ï¼Œä»¥æŒ‡å®šé“¾ç èƒŒä¹¦ç­–ç•¥ã€‚èƒŒä¹¦ç­–ç•¥æŒ‡å®šéœ€è¦å¤šå°‘ä¸ªå±äºä¸åŒæ¸ é“æˆå‘˜çš„peeræ ¹æ®ç»™å®šçš„é“¾ç éªŒè¯æ¥äº¤æ˜“ã€‚å› ä¸ºæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šåˆæ ¼ç­–ç•¥ï¼Œasset-transfer (basic) çš„å®šä¹‰ä¼šä½¿ç”¨é»˜è®¤çš„èƒŒä¹¦ç­–ç•¥ï¼Œè¯¥æ”¿ç­–è¦æ±‚åœ¨æäº¤äº¤æ˜“æ—¶ï¼Œè¯¥äº¤æ˜“å¿…é¡»å¾—åˆ°channelä¸­å¤§å¤šæ•°æˆå‘˜çš„è®¤å¯ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœåœ¨channelä¸­æ·»åŠ æˆ–åˆ é™¤ç»„ç»‡ï¼Œåˆ™èƒŒä¹¦æ”¿ç­–ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œä»¥è¦æ±‚æ›´å¤šæˆ–æ›´å°‘çš„è®¤å¯ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œé»˜è®¤ç­–ç•¥éœ€è¦2ä¸ªä¸­çš„å¤§å¤šæ•°ä¹Ÿå°±æ˜¯2ï¼Œå¹¶ä¸”äº¤æ˜“éœ€è¦ç”±æ¥è‡ªOrg1å’ŒOrg2çš„peerè®¤å¯ã€‚å¦‚æœè¦æŒ‡å®šè‡ªå®šä¹‰è®¤å¯ç­–ç•¥ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/endorsement-policies.html">Endorsement Policies</a> æ“ä½œæŒ‡å—æ¥äº†è§£ç­–ç•¥è¯­æ³•ã€‚</p><p>You need to approve a chaincode definition with an identity that has an admin role. As a result, the <code>CORE_PEER_MSPCONFIGPATH</code> variable needs to point to the MSP folder that contains an admin identity. You cannot approve a chaincode definition with a client user. The approval needs to be submitted to the ordering service, which will validate the admin signature and then distribute the approval to your peers.</p><p>ä½ éœ€è¦ä½¿ç”¨å…·æœ‰ç®¡ç†å‘˜è§’è‰²çš„èº«ä»½æ¥æ‰¹å‡†çš„é“¾ç å®šä¹‰ã€‚å³<code>CORE_PEER_MSPCONFIGPATH</code>å˜é‡éœ€è¦æŒ‡å‘åŒ…å«ç®¡ç†å‘˜èº«ä»½çš„MSPæ–‡ä»¶å¤¹ã€‚ä½ ä¸èƒ½ä½¿ç”¨å®¢æˆ·ç«¯ç”¨æˆ·çš„èº«ä»½æ¥æ‰¹å‡†é“¾ç ã€‚è¿™ä¸ªå®¡æ‰¹ç»“æœéœ€è¦æäº¤ç»™æ’åºæœåŠ¡ï¼Œæ’åºæœåŠ¡ä¼šéªŒè¯ç®¡ç†å‘˜çš„ç­¾åï¼Œç„¶ååˆ†å‘è¿™ä¸ªéªŒè¯ç»“æœåˆ°ä½ çš„peerèŠ‚ç‚¹ã€‚</p><p>We still need to approve the chaincode definition as Org1. Set the following environment variables to operate as the Org1 admin:</p><p>ä½ è¿˜éœ€è¦åœ¨ç»„ç»‡Org1ä¸Šæ‰¹å‡†è¿™ä¸ªé“¾ç å®šä¹‰ï¼ŒæŠŠç¯å¢ƒå˜é‡ä¿®æ”¹ä¸ºä»¥ç»„ç»‡Org1çš„ç®¡ç†å‘˜èº«ä»½æ¥æ“ä½œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:7051</span><br></pre></td></tr></table></figure><p>You can now approve the chaincode definition as Org1.</p><p>ç°åœ¨ä½ å¯ä»¥ä»¥ç»„ç»‡Org1çš„èº«ä»½æ‰¹å‡†é“¾ç å®šä¹‰äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode approveformyorg -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name basic --version 1.0 --package-id $CC_PACKAGE_ID --sequence 1 --tls --cafile $&#123;PWD&#125;&#x2F;organizations&#x2F;ordererOrganizations&#x2F;example.com&#x2F;orderers&#x2F;orderer.example.com&#x2F;msp&#x2F;tlscacerts&#x2F;tlsca.example.com-cert.pem</span><br></pre></td></tr></table></figure><p>We now have the majority we need to deploy the asset-transfer (basic) the chaincode to the channel. While only a majority of organizations need to approve a chaincode definition (with the default policies), all organizations need to approve a chaincode definition to start the chaincode on their peers. If you commit the definition before a channel member has approved the chaincode, the organization will not be able to endorse transactions. As a result, it is recommended that all channel members approve a chaincode before committing the chaincode definition.</p><p>ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†å°†asset-transfer (basic) çš„é“¾ç éƒ¨ç½²åˆ°æ¸ é“çš„å¤§å¤šæ•°çš„æ‰¹å‡†ã€‚åœ¨å°†é“¾ç å®šä¹‰éƒ¨ç½²åˆ°channelä¸Šæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¤§å¤šæ•°ç»„ç»‡çš„æ‰¹å‡†ï¼ˆä½¿ç”¨é»˜è®¤çš„ç­–ç•¥ï¼‰ï¼›ä½†æ˜¯æ‰€æœ‰çš„ç»„ç»‡éƒ½éœ€æ‰¹å‡†é“¾ç å®šä¹‰æ‰èƒ½åœ¨å…¶peerå¯åŠ¨è¿™ä¸ªé“¾ç ã€‚å¦‚æœä½ åœ¨ä¸€ä¸ªchannelæˆå‘˜æ‰¹å‡†å®šä¹‰ä¹‹å‰å°†é“¾ç å®šä¹‰æäº¤åˆ°channelï¼Œé‚£ä¹ˆè¿™ä¸ªç»„ç»‡å°†æ— æ³•æ‰¹å‡†äº¤æ˜“ã€‚ç»“æœï¼Œå»ºè®®æ‰€æœ‰é€šé“æˆå‘˜åœ¨æäº¤é“¾ç å®šä¹‰ä¹‹å‰æ‰¹å‡†é“¾ç ã€‚</p><h2 id="Committing-the-chaincode-definition-to-the-channelï¼ˆå°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼‰">Committing the chaincode definition to the channelï¼ˆå°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼‰</h2><p>After a sufficient number of organizations have approved a chaincode definition, one organization can commit the chaincode definition to the channel. If a majority of channel members have approved the definition, the commit transaction will be successful and the parameters agreed to in the chaincode definition will be implemented on the channel.</p><p>åœ¨æœ‰è¶³å¤Ÿæ•°é‡çš„ç»„ç»‡æ‰¹å‡†é“¾ç å®šä¹‰ä¹‹åï¼Œå…¶ä¸­ä¸€ä¸ªç»„ç»‡å°±å¯ä»¥æŠŠé“¾ç å®šä¹‰æäº¤åˆ°é€šé“ä¸­äº†ã€‚å¦‚æœå¤§å¤šæ•°é€šé“æˆå‘˜å·²æ‰¹å‡†è¯¥å®šä¹‰ï¼Œåˆ™æäº¤å®šä¹‰çš„äº¤æ˜“å°†ä¼šæˆåŠŸï¼Œå¹¶ä¸”é“¾ç å®šä¹‰ä¸­åŒæ„çš„å‚æ•°å°†åœ¨è¯¥é€šé“ä¸Šå®ç°ã€‚</p><p>You can use the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-checkcommitreadiness">peer lifecycle chaincode checkcommitreadiness</a> command to check whether channel members have approved the same chaincode definition. The flags used for the <code>checkcommitreadiness</code> command are identical to the flags used to approve a chaincode for your organization. However, you do not need to include the <code>--package-id</code> flag.</p><p>ä½ å¯ä»¥ä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-checkcommitreadiness">peer lifecycle chaincode checkcommitreadiness</a>å‘½ä»¤æ¥æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†ç›¸åŒçš„é“¾ç å®šä¹‰ã€‚ç”¨äº<code>checkcommitreadiness</code>å‘½ä»¤çš„æ ‡å¿—ä¸æ‚¨çš„ç»„ç»‡æ‰¹å‡†é“¾ç çš„æ ‡å¿—ç›¸åŒï¼›ä½†æ˜¯ä¸éœ€è¦åŒ…æ‹¬<code>--package-id</code>æ ‡å¿—ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode checkcommitreadiness --channelID mychannel --name basic --version 1.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem --output json</span><br></pre></td></tr></table></figure><p>The command will produce a JSON map that displays if a channel member has approved the parameters that were specified in the <code>checkcommitreadiness</code> command:</p><p>è¿™ä¸ªå‘½ä»¤ä¼šç”Ÿæˆä¸€ä¸ªJSONæ¥æ˜¾ç¤ºé€šé“æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†å®šä¹‰ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">          <span class="attr">&quot;Approvals&quot;</span>: &#123;</span><br><span class="line">                  <span class="attr">&quot;Org1MSP&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                  <span class="attr">&quot;Org2MSP&quot;</span>: <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>Since both organizations that are members of the channel have approved the same parameters, the chaincode definition is ready to be committed to the channel. You can use the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-commit">peer lifecycle chaincode commit</a> command to commit the chaincode definition to the channel. The commit command also needs to be submitted by an organization admin.</p><p>å› ä¸ºchannelä¸Šçš„ä¸¤ä¸ªæˆå‘˜éƒ½å·²ç»æ‰¹å‡†äº†ç›¸åŒçš„å‚æ•°ï¼Œå› æ­¤é“¾ç å®šä¹‰å·²å‡†å¤‡å¥½æäº¤ç»™channelã€‚ä½ å¯ä»¥ä½¿ç”¨<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-commit">peer lifecycle chaincode commit</a> å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°channelã€‚commitå‘½ä»¤ä¾ç„¶éœ€è¦ç”±ç»„ç»‡ç®¡ç†å‘˜æ¥å‘èµ·ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode commit -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name basic --version 1.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>The transaction above uses the <code>--peerAddresses</code> flag to target <code>peer0.org1.example.com</code> from Org1 and <code>peer0.org2.example.com</code> from Org2. The <code>commit</code> transaction is submitted to the peers joined to the channel to query the chaincode definition that was approved by the organization that operates the peer. The command needs to target the peers from a sufficient number of organizations to satisfy the policy for deploying a chaincode. Because the approval is distributed within each organization, you can target any peer that belongs to a channel member.</p><p>ä¸Šé¢çš„äº¤æ˜“ä½¿ç”¨<code>--peerAddresses</code>æ ‡å¿—æ¥æŒ‡å®šOrg1ä¸­çš„<code>peer0.org1.example.com</code>å’ŒOrg2ä¸­çš„<code>peer0.org2.example.com</code>ã€‚ <code>commit</code> äº¤æ˜“ä¼šæäº¤ç»™å·²ç»åŠ å…¥é€šé“çš„peerèŠ‚ç‚¹ï¼Œç”¨äºpeerèŠ‚ç‚¹æŸ¥è¯¢åŒç»„ç»‡å†…å…¶ä»–èŠ‚ç‚¹æ‰¹å‡†çš„é“¾ç å®šä¹‰ã€‚è¯¥å‘½ä»¤éœ€è¦æŒ‡æ˜æ¥è‡ªè¶³å¤Ÿæ•°é‡çš„ç»„ç»‡ä¸­çš„peerèŠ‚ç‚¹ï¼Œä»¥æ»¡è¶³éƒ¨ç½²é“¾ç çš„ç­–ç•¥ã€‚å› ä¸ºæ‰¹å‡†æ“ä½œå·²ç»åœ¨æ¯ä¸ªç»„ç»‡å†…éƒ¨è¿›è¡Œå¹¿æ’­ï¼Œæ‰€ä»¥ä½ å¯ä»¥æŒ‡å®šå±äºä¸€ä¸ªé€šé“æˆå‘˜çš„ä»»æ„çš„peerèŠ‚ç‚¹ã€‚</p><p>The chaincode definition endorsements by channel members are submitted to the ordering service to be added to a block and distributed to the channel. The peers on the channel then validate whether a sufficient number of organizations have approved the chaincode definition. The <code>peer lifecycle chaincode commit</code> command will wait for the validations from the peer before returning a response.</p><p>é€šé“æˆå‘˜å¯¹é“¾ç å®šä¹‰çš„è®¤å¯ä¼šæäº¤ç»™æ’åºæœåŠ¡ï¼Œä»¥æ·»åŠ åˆ°åŒºå—å¹¶åˆ†å‘ç»™æ¸ é“ã€‚ç„¶åé€šé“ä¸Šçš„peerèŠ‚ç‚¹éªŒè¯æ˜¯å¦æœ‰è¶³å¤Ÿæ•°é‡çš„ç»„ç»‡æ‰¹å‡†äº†é“¾ç å®šä¹‰ã€‚<code>peer lifecycle chaincode commit</code>å‘½ä»¤åœ¨è¿”å›ç›¸åº”ä¹‹å‰ä¼šç­‰å¾…peerèŠ‚ç‚¹çš„éªŒè¯ã€‚</p><p>You can use the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-querycommitted">peer lifecycle chaincode querycommitted</a> command to confirm that the chaincode definition has been committed to the channel.</p><p>ä½ å¯ä»¥ä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-querycommitted">peer lifecycle chaincode querycommitted</a> å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode querycommitted --channelID mychannel --name basic --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br></pre></td></tr></table></figure><p>If the chaincode was successful committed to the channel, the <code>querycommitted</code> command will return the sequence and version of the chaincode definition:</p><p>å¦‚æœé“¾ç å·²ç»æˆåŠŸæäº¤åˆ°é€šé“ï¼Œ<code>querycommitted</code> å‘½ä»¤ä¼šè¿”å›è¯¥é“¾ç å®šä¹‰çš„åºåˆ—å·å’Œç‰ˆæœ¬å·ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Committed chaincode definition for chaincode &#x27;basic&#x27; on channel &#x27;mychannel&#x27;:</span><br><span class="line">Version: 1.0, Sequence: 1, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [Org1MSP: true, Org2MSP: true]</span><br></pre></td></tr></table></figure><h2 id="Invoking-the-chaincodeï¼ˆè°ƒç”¨é“¾ç ï¼‰">Invoking the chaincodeï¼ˆè°ƒç”¨é“¾ç ï¼‰</h2><p>After the chaincode definition has been committed to a channel, the chaincode will start on the peers joined to the channel where the chaincode was installed. The asset-transfer (basic) chaincode is now ready to be invoked by client applications. Use the following command create an initial set of assets on the ledger. Note that the invoke command needs target a sufficient number of peers to meet chaincode endorsement policy.</p><p>åœ¨é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ä¹‹åï¼Œé“¾ç å¯ä»¥ç”±åŠ å…¥äº†é€šé“å¹¶ä¸”å®‰è£…äº†æ­¤é“¾ç çš„peerèŠ‚ç‚¹æ¥å¯åŠ¨ã€‚ asset-transfer (basic) çš„é“¾ç å·²ç»å¯ä»¥ç”±å®¢æˆ·ç«¯ç¨‹åºè¿›è¡Œè°ƒç”¨ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨è´¦æœ¬ä¸Šåˆ›å»ºå’Œåˆå§‹åŒ–èµ„äº§ã€‚è¯·æ³¨æ„ï¼Œinvokeå‘½ä»¤éœ€è¦ä»¥è¶³å¤Ÿæ•°é‡çš„peerä¸ºç›®æ ‡ï¼Œä»¥æ»¡è¶³é“¾ç çš„èƒŒä¹¦ç­–ç•¥ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n basic --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;InitLedger&quot;,&quot;Args&quot;:[]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>If the command is successful, you should be able to a response similar to the following:</p><p>å¦‚æœå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„å“åº”ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2020-12-21 16:51:11.086 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200</span><br></pre></td></tr></table></figure><p>We can use a query function to read the set of cars that were created by the chaincode:</p><p>æˆ‘ä»¬ä½¿ç”¨æŸ¥è¯¢æ–¹æ³•æ¥æŸ¥çœ‹æˆ‘ä»¬é€šè¿‡é“¾ç åˆ›å»ºçš„è½¦ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -C mychannel -n basic -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>The response to the query should be the following list of assets:</p><p>ä¸‹é¢çš„èµ„äº§åˆ—è¡¨å°±æ˜¯æŸ¥è¯¢çš„å“åº”ç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;&quot;ID&quot;:&quot;asset1&quot;,&quot;color&quot;:&quot;blue&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Tomoko&quot;,&quot;appraisedValue&quot;:300&#125;,&#123;&quot;ID&quot;:&quot;asset2&quot;,&quot;color&quot;:&quot;red&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Brad&quot;,&quot;appraisedValue&quot;:400&#125;,&#123;&quot;ID&quot;:&quot;asset3&quot;,&quot;color&quot;:&quot;green&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Jin Soo&quot;,&quot;appraisedValue&quot;:500&#125;,&#123;&quot;ID&quot;:&quot;asset4&quot;,&quot;color&quot;:&quot;yellow&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Max&quot;,&quot;appraisedValue&quot;:600&#125;,&#123;&quot;ID&quot;:&quot;asset5&quot;,&quot;color&quot;:&quot;black&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Adriana&quot;,&quot;appraisedValue&quot;:700&#125;,&#123;&quot;ID&quot;:&quot;asset6&quot;,&quot;color&quot;:&quot;white&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Michel&quot;,&quot;appraisedValue&quot;:800&#125;]</span><br></pre></td></tr></table></figure><h2 id="Upgrading-a-smart-contractï¼ˆæ›´æ–°æ™ºèƒ½åˆçº¦ï¼‰">Upgrading a smart contractï¼ˆæ›´æ–°æ™ºèƒ½åˆçº¦ï¼‰</h2><p>You can use the same Fabric chaincode lifecycle process to upgrade a chaincode that has already been deployed to a channel. Channel members can upgrade a chaincode by installing a new chaincode package and then approving a chaincode definition with the new package ID, a new chaincode version, and with the sequence number incremented by one. The new chaincode can be used after the chaincode definition is committed to the channel. This process allows channel members to coordinate on when a chaincode is upgraded, and ensure that a sufficient number of channel members are ready to use the new chaincode before it is deployed to the channel.</p><p>æ‚¨å¯ä»¥ä½¿ç”¨ç›¸åŒçš„Fabricé“¾ç ç”Ÿå‘½å‘¨æœŸæµç¨‹æ¥å‡çº§å·²ç»éƒ¨ç½²åˆ°é€šé“çš„é“¾ç ã€‚é€šé“æˆå‘˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å‡çº§é“¾ç ï¼šå®‰è£…æ–°çš„é“¾ç åŒ…ï¼Œç„¶åæ‰¹å‡†è¿™ä¸ªå…·æœ‰æ–°packageIDã€æ–°é“¾ç ç‰ˆæœ¬ä»¥åŠåºåˆ—å·åŠ 1çš„é“¾ç å®šä¹‰ã€‚åœ¨é“¾ç å®šä¹‰è¢«æäº¤ç»™é€šé“åæ–°çš„é“¾ç å°±å¯ä»¥è¢«ä½¿ç”¨ã€‚æ­¤è¿‡ç¨‹å…è®¸é€šé“æˆå‘˜åœ¨å‡çº§é“¾ç æ—¶è¿›è¡Œåè°ƒï¼Œå¹¶ç¡®ä¿åœ¨å°†æ–°é“¾ç éƒ¨ç½²åˆ°é€šé“ä¹‹å‰ï¼Œæœ‰è¶³å¤Ÿæ•°é‡çš„é€šé“æˆå‘˜å‡†å¤‡ä½¿ç”¨æ–°é“¾ç ã€‚</p><p>Channel members can also use the upgrade process to change the chaincode endorsement policy. By approving a chaincode definition with a new endorsement policy and committing the chaincode definition to the channel, channel members can change the endorsement policy governing a chaincode without installing a new chaincode package.</p><p>é€šé“æˆå‘˜ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ›´æ–°æµç¨‹æ¥ä¿®æ”¹é“¾ç çš„èƒŒä¹¦ç­–ç•¥ã€‚é€šè¿‡æ‰¹å‡†å…·æœ‰æ–°èƒŒä¹¦ç­–ç•¥çš„é“¾ç å®šä¹‰å¹¶å°†å…¶æäº¤ç»™æ¸ é“ï¼Œæ¸ é“æˆå‘˜å¯ä»¥æ›´æ”¹èƒŒä¹¦ç­–ç•¥è€Œæ— éœ€å®‰è£…æ–°çš„é“¾ç åŒ…ã€‚</p><p>To provide a scenario for upgrading the asset-transfer (basic) chaincode that we just deployed,letâ€™s assume that Org1 and Org2 would like to install a version of the chaincode that is written in another language. They will use the Fabric chaincode lifecycle to update the chaincode version and ensure that both organizations have installed the new chaincode before it becomes active on the channel.</p><p>ä¸ºäº†æä¾›ä¸€ä¸ªæˆ‘ä»¬åˆšæ‰éƒ¨ç½²çš„asset-transfer (basic) é“¾ç å‡çº§çš„æƒ…æ™¯ï¼Œè®©æˆ‘ä»¬å‡è®¾Org1å’ŒOrg2æƒ³è¦å®‰è£…ä¸€ä¸ªé€šè¿‡å…¶ä»–è¯­è¨€ç¼–å†™çš„é“¾ç ç‰ˆæœ¬ã€‚ä»–ä»¬ä¼šä½¿ç”¨Fabricé“¾ç ç”Ÿå‘½å‘¨æœŸæ¥æ›´æ–°é“¾ç çš„ç‰ˆæœ¬å¹¶ä¸”åœ¨æ–°é“¾ç å¯ç”¨äºé€šé“ä¹‹å‰ç¡®ä¿æ‰€æœ‰çš„ç»„ç»‡å·²ç»å®‰è£…äº†æ–°çš„é“¾ç ã€‚</p><p>We are going to assume that Org1 and Org2 initially installed the GO version of the asset-transfer (basic) chaincode, but would be more comfortable working with a chaincode written in JavaScript. The first step is to package the JavaScript version of the asset-transfer (basic) chaincode. If you used the JavaScript instructions to package your chaincode when you went through the tutorial, you can install new chaincode binaries by following the steps for packaging a chaincode written in <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deploy_chaincode.html#go">Go</a> or <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/deploy_chaincode.html#typescript">TypeScript</a>.</p><p>æˆ‘ä»¬å‡è®¾Org1å’ŒOrg2æœ€åˆå®‰è£…äº†asset-transfer (basic) GOç‰ˆæœ¬çš„é“¾ç ï¼Œä½†ä½¿ç”¨JavaScriptç¼–å†™çš„é“¾ç ä¼šæ›´èˆ’é€‚ã€‚ç¬¬ä¸€æ­¥å°±æ˜¯æ‰“åŒ…JavaScriptç‰ˆæœ¬çš„asset-transfer (basic) é“¾ç ã€‚</p><p>Issue the following commands from the <code>test-network</code> directory to install the chaincode dependences.</p><p>åœ¨<code>test-network</code> ç›®å½•ä¸‹è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥å®‰è£…é“¾ç çš„ä¾èµ–ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ../asset-transfer-basic/chaincode-javascript</span><br><span class="line">npm install</span><br><span class="line">cd ../../test-network</span><br></pre></td></tr></table></figure><h3 id="æ‰“åŒ…">æ‰“åŒ…</h3><p>You can then issue the following commands to package the JavaScript chaincode from the <code>test-network</code> directory. We will set the environment variables needed to use the <code>peer</code> CLI again in case you closed your terminal.</p><p>ç„¶åä½ å¯ä»¥åœ¨<code>test-network</code> ç›®å½•ä¸‹è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æ‰“åŒ…JavaScriptç‰ˆæœ¬çš„é“¾ç ã€‚åœ¨è¿è¡Œå‘½ä»¤ä¹‹å‰å…ˆå‚è€ƒå‰é¢çš„å†…å®¹æ¥è®¾ç½®å¯ä»¥æ“ä½œOrg1çš„ç¯å¢ƒå˜é‡ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode package basic_2.tar.gz --path ../asset-transfer-basic/chaincode-javascript/ --lang node --label basic_2.0</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…">å®‰è£…</h3><p>We can now use the following command to install the new chaincode package on the Org1 peer.</p><p>ä½ å¯ä»¥åœ¨Org1ç»„ç»‡çš„peerèŠ‚ç‚¹é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥å®‰è£…ä¸€ä¸ªæ–°çš„é“¾ç åŒ…ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode install basic_2.tar.gz</span><br></pre></td></tr></table></figure><p>The new chaincode package will create a new package ID. We can find the new package ID by querying our peer.</p><p>æ–°çš„é“¾ç åŒ…ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„package IDï¼Œæˆ‘ä»¬é€šè¿‡æŸ¥è¯¢peeræ¥è·å–æ–°çš„package IDã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode queryinstalled</span><br></pre></td></tr></table></figure><p>The <code>queryinstalled</code> command will return a list of the chaincode that have been installed on your peer similar to this output.</p><p><code>queryinstalled</code> å‘½ä»¤ä¼šè¿”å›ä½ çš„peerå·²ç»å®‰è£…çš„é“¾ç ï¼Œè¾“å‡ºç±»ä¼¼å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Installed chaincodes on peer:</span><br><span class="line">Package ID: basic_1.0:2c47b5b060a64aafa3c878b4bcb0ca680bdb2417ca8855b5440fa595562517d2, Label: basic_1.0</span><br><span class="line">Package ID: basic_2.0:59cb45985332d79a903ef39d710eeb23a1c63bddaf8cd999481071457d22acbd, Label: basic_2.0</span><br></pre></td></tr></table></figure><p>You can use the package label to find the package ID of the new chaincode and save it as a new environment variable. This output is for example only â€“ your package ID will be different, so DO NOT COPY AND PASTE!</p><p>ä½ å¯ä»¥æŠŠæ–°çš„ package IDä¿å­˜ä¸ºä¸€ä¸ªæ–°çš„ç¯å¢ƒå˜é‡ã€‚ä¸‹é¢çš„å‘½ä»¤åªæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œä¸è¦ç›´æ¥copyã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export NEW_CC_PACKAGE_ID&#x3D;basic_2.0:59cb45985332d79a903ef39d710eeb23a1c63bddaf8cd999481071457d22acbd</span><br></pre></td></tr></table></figure><h3 id="æ‰¹å‡†é“¾ç å®šä¹‰">æ‰¹å‡†é“¾ç å®šä¹‰</h3><p>Org1 can now approve a new chaincode definitionï¼ˆOrg1ç°åœ¨å¯ä»¥æ‰¹å‡†è¿™ä¸ªæ–°çš„é“¾ç å®šä¹‰ï¼‰:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode approveformyorg -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name basic --version 2.0 --package-id $NEW_CC_PACKAGE_ID --sequence 2 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br></pre></td></tr></table></figure><p>The new chaincode definition uses the package ID of the JavaScript chaincode package and updates the chaincode version. Because the sequence parameter is used by the Fabric chaincode lifecycle to keep track of chaincode upgrades, Org1 also needs to increment the sequence number from 1 to 2. You can use the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-querycommitted">peer lifecycle chaincode querycommitted</a> command to find the sequence of the chaincode that was last committed to the channel.</p><p>æ–°çš„é“¾ç å®šä¹‰ä½¿ç”¨JavaScriptç‰ˆæœ¬çš„é“¾ç åŒ…çš„packageIDä»¥åŠæ–°çš„é“¾ç ç‰ˆæœ¬ã€‚ç”±äºFabricé“¾ç ç”Ÿå‘½å‘¨æœŸä½¿ç”¨åºåˆ—å·æ¥è·Ÿè¸ªé“¾ç å‡çº§ï¼Œå› æ­¤Org1è¿˜éœ€è¦å°†åºåˆ—å·ä»1é€’å¢åˆ°2ã€‚ä½ å¯ä»¥ä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-querycommitted">peer lifecycle chaincode querycommitted</a>å‘½ä»¤æ¥æŸ¥è¯¢é“¾ç ä¸Šæ¬¡æäº¤åˆ°é€šé“çš„åºåˆ—å·ã€‚</p><p>We now need to install the chaincode package and approve the chaincode definition as Org2 in order to upgrade the chaincode. Run the following commands to operate the <code>peer</code> CLI as the Org2 admin:</p><p>æˆ‘ä»¬ç°åœ¨éœ€è¦ä»¥Org2ç»„ç»‡çš„èº«ä»½æ¥å®‰è£…é“¾ç å¹¶ä¸”æ‰¹å‡†é“¾ç å®šä¹‰æ¥æ›´æ–°é“¾ç ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥ä½¿ç”¨Org2ç»„ç»‡çš„ç®¡ç†å‘˜è¿›è¡Œæ“ä½œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:9051</span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–ç»„ç»‡å®‰è£…é“¾ç ">å…¶ä»–ç»„ç»‡å®‰è£…é“¾ç </h3><p>We can now use the following command to install the new chaincode package on the Org2 peer.</p><p>æˆ‘ä»¬ç°åœ¨å°±å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥å®‰è£…æ–°çš„é“¾ç åŒ…åˆ°Org2ç»„ç»‡çš„peerä¸Šã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode install basic_2.tar.gz</span><br></pre></td></tr></table></figure><h3 id="æ‰¹å‡†é“¾ç å®šä¹‰-v2">æ‰¹å‡†é“¾ç å®šä¹‰</h3><p>You can now approve the new chaincode definition for Org2.</p><p>æˆ‘ä»¬ç°åœ¨å¯ä»¥ä¸ºOrg2ç»„ç»‡æ‰¹å‡†è¿™ä¸ªæ–°çš„é“¾ç å®šä¹‰ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode approveformyorg -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name basic --version 2.0 --package-id $NEW_CC_PACKAGE_ID --sequence 2 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br></pre></td></tr></table></figure><p>Use the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-checkcommitreadiness">peer lifecycle chaincode checkcommitreadiness</a> command to check if the chaincode definition with sequence 2 is ready to be committed to the channel:</p><p>ä½¿ç”¨<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-checkcommitreadiness">peer lifecycle chaincode checkcommitreadiness</a> æ•ç²æ¥æ£€æŸ¥åºåˆ—å·ä¸º2çš„é“¾ç å®šä¹‰æ˜¯å¦å·²ç»å‡†å¤‡å¥½è¢«æäº¤åˆ°channelä¸Šï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode checkcommitreadiness --channelID mychannel --name basic --version 2.0 --sequence 2 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem --output json</span><br></pre></td></tr></table></figure><p>The chaincode is ready to be upgraded if the command returns the following JSON:</p><p>å¦‚æœè¿™ä¸ªå‘½ä»¤è¿”å›ä»¥ä¸‹å†…å®¹ï¼Œè¯´æ˜å·²ç»å‡†å¤‡å¥½æ›´æ–°äº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;approvals&quot;: &#123;</span><br><span class="line">&quot;Org1MSP&quot;: true,</span><br><span class="line">&quot;Org2MSP&quot;: true</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The chaincode will be upgraded on the channel after the new chaincode definition is committed. Until then, the previous chaincode will continue to run on the peers of both organizations. Org2 can use the following command to upgrade the chaincode:</p><p>åœ¨æ–°çš„é“¾ç å®šä¹‰æäº¤åï¼Œé€šé“ä¸Šçš„é“¾ç å°†ä¼šå‡çº§ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå…ˆå‰çš„é“¾ç å°†ç»§ç»­åœ¨ä¸¤ä¸ªç»„ç»‡çš„peerä¸Šè¿è¡Œã€‚Org2ç»„ç»‡å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æ›´æ–°é“¾ç ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode commit -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name basic --version 2.0 --sequence 2 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>A successful commit transaction will start the new chaincode right away. If the chaincode definition changed the endorsement policy, the new policy would be put in effect.</p><p>æˆåŠŸçš„æäº¤çš„äº¤æ˜“å°†ç«‹å³å¯åŠ¨æ–°çš„é“¾ç ã€‚å¦‚æœé“¾ç å®šä¹‰æ›´æ”¹äº†èƒŒä¹¦ç­–ç•¥ï¼Œåˆ™æ–°æ”¿ç­–å°†ç”Ÿæ•ˆã€‚</p><p>You can use the <code>docker ps</code> command to verify that the new chaincode has started on your peers:</p><p>ä½ ç°åœ¨å¯ä»¥ä½¿ç”¨ <code>docker ps</code> å‘½ä»¤æ¥éªŒè¯æ–°çš„é“¾ç å·²ç»åœ¨ä½ çš„peerèŠ‚ç‚¹å¯åŠ¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE                                                                                                                                                                    COMMAND                  CREATED         STATUS         PORTS                              NAMES</span><br><span class="line">2e253d5141c3   dev-peer0.org2.example.com-basic_2.0-59cb45985332d79a903ef39d710eeb23a1c63bddaf8cd999481071457d22acbd-c00efc2e7c009601f23247ba3330c47fc5b737d476f8233da9b404c28681847b   &quot;docker-entrypoint.sâ€¦&quot;   2 minutes ago   Up 2 minutes                                      dev-peer0.org2.example.com-basic_2.0-59cb45985332d79a903ef39d710eeb23a1c63bddaf8cd999481071457d22acbd</span><br><span class="line">cb7260fc3aa6   dev-peer0.org1.example.com-basic_2.0-59cb45985332d79a903ef39d710eeb23a1c63bddaf8cd999481071457d22acbd-ececda85b7ddf5cad9e5cbca808ffe76bc0b4b0d3067c345afa365a764b062ff   &quot;docker-entrypoint.sâ€¦&quot;   2 minutes ago   Up 2 minutes                                      dev-peer0.org1.example.com-basic_2.0-59cb45985332d79a903ef39d710eeb23a1c63bddaf8cd999481071457d22acbd</span><br><span class="line">ee12e6769e93   gliderlabs/logspout                                                                                                                                                      &quot;/bin/logspout&quot;          6 hours ago     Up 6 hours     127.0.0.1:8000-&gt;80/tcp             logspout</span><br><span class="line">628b12f2b3f0   hyperledger/fabric-peer:latest                                                                                                                                           &quot;peer node start&quot;        6 hours ago     Up 6 hours     7051/tcp, 0.0.0.0:9051-&gt;9051/tcp   peer0.org2.example.com</span><br><span class="line">e47cbd1b0b15   hyperledger/fabric-peer:latest                                                                                                                                           &quot;peer node start&quot;        6 hours ago     Up 6 hours     0.0.0.0:7051-&gt;7051/tcp             peer0.org1.example.com</span><br><span class="line">e67946f412a7   hyperledger/fabric-orderer:latest                                                                                                                                        &quot;orderer&quot;                6 hours ago     Up 6 hours     0.0.0.0:7050-&gt;7050/tcp             orderer.example.com</span><br></pre></td></tr></table></figure><p>If you used the <code>--init-required</code> flag, you need to invoke the Init function before you can use the upgraded chaincode. Because we did not request the execution of Init, we can test our new JavaScript chaincode by creating a new car:</p><p>æˆ‘ä»¬ç°åœ¨å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çš„æ±½è½¦æ¥æµ‹è¯•æˆ‘ä»¬æ–°çš„JavaScriptç‰ˆæœ¬çš„é“¾ç ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n basic --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;CreateAsset&quot;,&quot;Args&quot;:[&quot;asset8&quot;,&quot;blue&quot;,&quot;16&quot;,&quot;Kelley&quot;,&quot;750&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>You can query all the cars on the ledger again to see the new car:</p><p>ä½ å¯ä»¥æŸ¥è¯¢è´¦æœ¬ä¸Šæ‰€æœ‰çš„è½¦æ¥çœ‹æ–°åˆ›å»ºçš„carï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -C mychannel -n basic -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>You should see the following result from the JavaScript chaincode:</p><p>é€šè¿‡JavaScriptç‰ˆæœ¬çš„é“¾ç ï¼Œä½ ä¼šçœ‹åˆ°ä¸‹é¢çš„ç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;&quot;Key&quot;:&quot;asset1&quot;,&quot;Record&quot;:&#123;&quot;ID&quot;:&quot;asset1&quot;,&quot;color&quot;:&quot;blue&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Tomoko&quot;,&quot;appraisedValue&quot;:300&#125;&#125;,&#123;&quot;Key&quot;:&quot;asset2&quot;,&quot;Record&quot;:&#123;&quot;ID&quot;:&quot;asset2&quot;,&quot;color&quot;:&quot;red&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Brad&quot;,&quot;appraisedValue&quot;:400&#125;&#125;,&#123;&quot;Key&quot;:&quot;asset3&quot;,&quot;Record&quot;:&#123;&quot;ID&quot;:&quot;asset3&quot;,&quot;color&quot;:&quot;green&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Jin Soo&quot;,&quot;appraisedValue&quot;:500&#125;&#125;,&#123;&quot;Key&quot;:&quot;asset4&quot;,&quot;Record&quot;:&#123;&quot;ID&quot;:&quot;asset4&quot;,&quot;color&quot;:&quot;yellow&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Max&quot;,&quot;appraisedValue&quot;:600&#125;&#125;,&#123;&quot;Key&quot;:&quot;asset5&quot;,&quot;Record&quot;:&#123;&quot;ID&quot;:&quot;asset5&quot;,&quot;color&quot;:&quot;black&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Adriana&quot;,&quot;appraisedValue&quot;:700&#125;&#125;,&#123;&quot;Key&quot;:&quot;asset6&quot;,&quot;Record&quot;:&#123;&quot;ID&quot;:&quot;asset6&quot;,&quot;color&quot;:&quot;white&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Michel&quot;,&quot;appraisedValue&quot;:800&#125;&#125;,&#123;&quot;Key&quot;:&quot;asset8&quot;,&quot;Record&quot;:&#123;&quot;ID&quot;:&quot;asset8&quot;,&quot;Color&quot;:&quot;blue&quot;,&quot;Size&quot;:&quot;16&quot;,&quot;Owner&quot;:&quot;Kelley&quot;,&quot;AppraisedValue&quot;:&quot;750&quot;&#125;&#125;]</span><br></pre></td></tr></table></figure><h2 id="Clean-upï¼ˆæ¸…ç†ï¼‰">Clean upï¼ˆæ¸…ç†ï¼‰</h2><p>When you are finished using the chaincode, you can also use the following commands to remove the Logspout tool.</p><p>å½“ä½ ä½¿ç”¨é“¾ç ç»“æŸä¹‹åï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥ç§»é™¤Logspout toolã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stop logspout</span><br><span class="line">docker rm logspout</span><br></pre></td></tr></table></figure><p>You can then bring down the test network by issuing the following command from the <code>test-network</code> directory:</p><p>ä½ ç°åœ¨å¯ä»¥åœ¨<code>test-network</code> ç›®å½•ä¸‹ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥å…³é—­æµ‹è¯•ç½‘ç»œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./network.sh down</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> channel </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> channel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨Fabricä¸­ä½¿ç”¨ç§æœ‰æ•°æ®</title>
      <link href="2021/04/01/blockchain/fabric/%E5%9C%A8Fabric%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%A7%81%E6%9C%89%E6%95%B0%E6%8D%AE/"/>
      <url>2021/04/01/blockchain/fabric/%E5%9C%A8Fabric%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%A7%81%E6%9C%89%E6%95%B0%E6%8D%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="åœ¨Fabricä¸­ä½¿ç”¨ç§æœ‰æ•°æ®">åœ¨Fabricä¸­ä½¿ç”¨ç§æœ‰æ•°æ®</h1><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/private_data_tutorial.html">Using Private Data in Fabric</a></p><p>This tutorial will demonstrate the use of Private Data Collections (PDC) to provide storage and retrieval of private data on the blockchain network for authorized peers of organizations. The collection is specified using a collection definition file containing the policies governing that collection.</p><p>æœ¬æ•™ç¨‹å°†æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ç§æœ‰æ•°æ®é›†ï¼ˆPDCï¼‰ä¸ºç»„ç»‡çš„æœ‰æƒé™çš„peeråœ¨åŒºå—é“¾ç½‘ç»œä¸Šæä¾›ç§æœ‰æ•°æ®çš„å­˜å‚¨å’Œæ£€ç´¢ã€‚ä½¿ç”¨åŒ…å«å®šä¹‰è¯¥PDCç­–ç•¥çš„é›†åˆå®šä¹‰æ–‡ä»¶æ¥ç®¡ç†PDCã€‚</p><p>The information in this tutorial assumes knowledge of private data stores and their use cases. For more information, check out <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/private-data/private-data.html">Private data</a>.</p><p>æœ¬æ•™ç¨‹ä¸­çš„ä¿¡æ¯å‡å®šæ‚¨äº†è§£ç§æœ‰æ•°æ®å­˜å‚¨åŠå…¶ä½¿ç”¨æ¡ˆä¾‹ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/private-data/private-data.html">Private data</a>ã€‚</p><p>The tutorial will take you through the following steps to practice defining, configuring and using private data with Fabric:</p><p>æœ¬æ•™ç¨‹å°†æŒ‡å¯¼æ‚¨å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼Œä»¥ç»ƒä¹ å®šä¹‰ã€é…ç½®å’Œä½¿ç”¨Fabricç§æœ‰æ•°æ®ï¼š</p><ol><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/private_data_tutorial.html#pd-use-case">Asset transfer private data sample use case</a> èµ„äº§è½¬ç§»ç§æœ‰æ•°æ®æ ·ä¾‹ä½¿ç”¨æ–¹æ³•</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/private_data_tutorial.html#pd-build-json">Build a collection definition JSON file</a> æ„å»ºä¸€ä¸ªé›†åˆå®šä¹‰JSONæ–‡ä»¶</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/private_data_tutorial.html#pd-read-write-private-data">Read and Write private data using chaincode APIs</a> ä½¿ç”¨chaincode APIè¯»å†™ç§æœ‰æ•°æ®</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/private_data_tutorial.html#pd-install-define-cc">Deploy the private data smart contract to the channel</a> éƒ¨ç½²ç§æœ‰æ•°æ®æ™ºèƒ½åˆçº¦åˆ°é€šé“</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/private_data_tutorial.html#pd-register-identities">Register identities</a> æ³¨å†Œèº«ä»½</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/private_data_tutorial.html#pd-store-private-data">Create an asset in private data</a> åœ¨ç§æœ‰æ•°æ®é›†ä¸­åˆ›å»ºèµ„äº§</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/private_data_tutorial.html#pd-query-authorized">Query the private data as an authorized peer</a> é€šè¿‡æœ‰æƒé™çš„peeræŸ¥è¯¢ç§æœ‰æ•°æ®</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/private_data_tutorial.html#pd-query-unauthorized">Query the private data as an unauthorized peer</a> é€šè¿‡æ²¡æœ‰æƒé™çš„peeræŸ¥è¯¢ç§æœ‰æ•°æ®</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/private_data_tutorial.html#pd-transfer-asset">Transfer the Asset</a> äº¤æ˜“åœ¨ç§æœ‰æ•°æ®é›†ä¸­çš„èµ„äº§</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/private_data_tutorial.html#pd-purge">Purge Private Data</a> æ¸…é™¤ç§æœ‰æ•°æ®</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/private_data_tutorial.html#pd-indexes">Using indexes with private data</a> å¯¹ç§æœ‰æ•°æ®ä½¿ç”¨ç´¢å¼•</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/private_data_tutorial.html#pd-ref-material">Additional resources</a> é¢å¤–èµ„æº</li></ol><p>This tutorial will deploy the <a href="https://github.com/hyperledger/fabric-samples/tree/master/asset-transfer-private-data/chaincode-go">asset transfer private data sample</a> to the Fabric test network to demonstrate how to create, deploy, and use a collection of private data. You should have completed the task <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/install.html">Install Samples, Binaries, and Docker Images</a>.</p><p>è¿™ä¸ªæ•™ç¨‹ä¼šéƒ¨ç½² <a href="https://github.com/hyperledger/fabric-samples/tree/master/asset-transfer-private-data/chaincode-go">asset transfer private data sample</a>åˆ°Fabricçš„æµ‹è¯•ç½‘ç»œæ¥æ¼”ç¤ºå¦‚ä½•åˆ›å»ºã€éƒ¨ç½²ä»¥åŠä½¿ç”¨PDCã€‚</p><h2 id="Asset-transfer-private-data-sample-use-caseï¼ˆèµ„äº§è½¬ç§»ç§æœ‰æ•°æ®æ ·ä¾‹ä½¿ç”¨æ–¹æ³•ï¼‰">Asset transfer private data sample use caseï¼ˆèµ„äº§è½¬ç§»ç§æœ‰æ•°æ®æ ·ä¾‹ä½¿ç”¨æ–¹æ³•ï¼‰</h2><p>This sample demonstrates the use of three private data collections, <code>assetCollection</code>, <code>Org1MSPPrivateCollection</code> &amp; <code>Org2MSPPrivateCollection</code> to transfer an asset between Org1 and Org2, using following use case:</p><p>è¿™ä¸ªæ ·ä¾‹ä½¿ç”¨ä»¥ä¸‹ç”¨ä¾‹æ¼”ç¤ºä½¿ç”¨ä¸‰ä¸ªç§æœ‰æ•°æ®é›†ï¼ˆPDCï¼‰æ¥åœ¨Org1å’ŒOrg2ç»„ç»‡ä¹‹é—´äº¤æ˜“èµ„äº§ï¼›è¿™ä¸‰ä¸ªPDCä¸ºï¼š<code>assetCollection</code>, <code>Org1MSPPrivateCollection</code> &amp; <code>Org2MSPPrivateCollection</code> ã€‚</p><p>A member of Org1 creates a new asset, henceforth referred as owner. The public details of the asset, including the identity of the owner, are stored in the private data collection named <code>assetCollection</code>. The asset is also created with an appraised value supplied by the owner. The appraised value is used by each participant to agree to the transfer of the asset, and is only stored in owner organizationâ€™s collection. In our case, the initial appraisal value agreed by the owner is stored in the <code>Org1MSPPrivateCollection</code>.</p><p>ç»„ç»‡Org1çš„ä¸€ä¸ªæˆå‘˜åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„äº§ï¼Œå¹¶æ‹¥æœ‰è¿™ä¸ªèµ„äº§ã€‚å…¬å…±çš„èµ„äº§è¯¦æƒ…ï¼ŒåŒ…æ‹¬æ‹¥æœ‰è€…çš„èº«ä»½è¢«å­˜å‚¨åœ¨ç§°ä½œ <code>assetCollection</code>çš„ç§æœ‰æ•°æ®é›†ä¸­ã€‚èµ„äº§æ‰€æœ‰è€…ä¹Ÿä¼šä¸ºè¿™ä¸ªèµ„äº§åˆ›å»ºä¸€ä¸ªè¯„ä¼°ä»·å€¼ï¼Œé€šé“ä¸Šçš„æ¯ä¸ªå‚ä¸è€…éƒ½ä½¿ç”¨è¿™ä¸ªè¯„ä¼°ä»·å€¼æ¥åŒæ„èµ„äº§è½¬è®©ï¼Œå¹¶ä¸”å®ƒä»…å­˜å‚¨åœ¨æ‰€æœ‰è€…ç»„ç»‡çš„é›†åˆä¸­ã€‚åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œæ‰€æœ‰è€…ç¡®è®¤çš„åˆå§‹è¯„ä¼°å€¼å­˜å‚¨åœ¨<code>Org1MSPPrivateCollection</code>ä¸­ã€‚</p><p>To purchase the asset, the buyer needs to agree to the same appraised value as the asset owner. In this step, the buyer (a member of Org2) creates an agreement to trade and agree to an appraisal value using smart contract function <code>'AgreeToTransfer'</code>. This value is stored in <code>Org2MSPPrivateCollection</code> collection. Now, the asset owner can transfer the asset to the buyer using smart contract function <code>'TransferAsset'</code>. The <code>'TransferAsset'</code> function uses the hash on the channel ledger to confirm that the owner and the buyer have agreed to the same appraised value before transferring the asset.</p><p>è¦è´­ä¹°èµ„äº§ï¼Œè´­ä¹°è€…éœ€è¦åŒæ„ä¸èµ„äº§æ‰€æœ‰è€…ç›¸åŒçš„è¯„ä¼°ä»·å€¼ã€‚åœ¨æ­¤æ­¥éª¤ä¸­ï¼Œä¹°æ–¹ï¼ˆOrg2çš„æˆå‘˜ï¼‰ä½¿ç”¨æ™ºèƒ½åˆçº¦çš„<code>â€œAgreeToTransferâ€</code>æ–¹æ³•æ¥åˆ›å»ºäº¤æ˜“åè®®å¹¶åŒæ„è¯„ä¼°ä»·å€¼ã€‚æ­¤å€¼å­˜å‚¨åœ¨<code>Org2MSPPrivateCollection</code>é›†åˆä¸­ã€‚ç°åœ¨èµ„äº§çš„æ‹¥æœ‰è€…å¯ä»¥é€šè¿‡æ™ºèƒ½åˆçº¦ä¸­çš„<code>'TransferAsset'</code>æ–¹æ³•æ¥äº¤æ˜“èµ„äº§äº†ã€‚ <code>'TransferAsset'</code> æ–¹æ³•åœ¨è½¬è®©èµ„äº§ä¹‹å‰å…ˆä½¿ç”¨é€šé“è´¦æœ¬ä¸Šçš„hashæ¥éªŒè¯ä¹°å–åŒæ–¹å·²ç»å¯¹ç›¸åŒçš„è¯„ä¼°ä»·æ ¼è¾¾æˆäº†ä¸€è‡´ã€‚</p><p>Before we go through the transfer scenario, we will discuss how organizations can use private data collections in Fabric.</p><p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å°†è®¨è®ºç»„ç»‡å¦‚ä½•åœ¨Fabricä¸­ä½¿ç”¨ç§æœ‰æ•°æ®é›†åˆã€‚</p><h2 id="Build-a-collection-definition-JSON-fileï¼ˆæ„å»ºä¸€ä¸ªé›†åˆå®šä¹‰JSONæ–‡ä»¶ï¼‰">Build a collection definition JSON fileï¼ˆæ„å»ºä¸€ä¸ªé›†åˆå®šä¹‰JSONæ–‡ä»¶ï¼‰</h2><p>Before a set of organizations can transact using private data, all organizations on channel need to build a collection definition file that defines the private data collections associated with each chaincode. Data that is stored in a private data collection is only distributed to the peers of certain organizations instead of all members of the channel. The collection definition file describes all of the private data collections that organizations can read and write to from a chaincode.</p><p>åœ¨ä¸€ç»„ç»„ç»‡å¯ä»¥ä½¿ç”¨ç§æœ‰æ•°æ®è¿›è¡Œäº¤æ˜“ä¹‹å‰ï¼Œé€šé“ä¸Šçš„æ‰€æœ‰ç»„ç»‡éœ€è¦æ„å»ºä¸€ä¸ªé›†åˆå®šä¹‰æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å®šä¹‰ä¸æ¯ä¸ªé“¾ç å…³è”çš„ç§æœ‰æ•°æ®é›†åˆã€‚å­˜å‚¨åœ¨ç§æœ‰æ•°æ®é›†åˆä¸­çš„æ•°æ®ä»…åˆ†å‘ç»™ç›¸åŒç»„ç»‡çš„peerèŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯åˆ†å‘ç»™é€šé“çš„æ‰€æœ‰æˆå‘˜ã€‚é›†åˆå®šä¹‰æ–‡ä»¶æè¿°äº†ç»„ç»‡å¯ä»¥é€šè¿‡é“¾ç è¯»å†™çš„æ‰€æœ‰ç§æœ‰æ•°æ®é›†ã€‚</p><p>Each collection is defined by the following properties:</p><ul><li><code>name</code>: Name of the collection.</li><li><code>policy</code>: Defines the organization peers allowed to persist the collection data.</li><li><code>requiredPeerCount</code>: Number of peers required to disseminate the private data as a condition of the endorsement of the chaincode</li><li><code>maxPeerCount</code>: For data redundancy purposes, the number of other peers that the current endorsing peer will attempt to distribute the data to. If an endorsing peer goes down, these other peers are available at commit time if there are requests to pull the private data.</li><li><code>blockToLive</code>: For very sensitive information such as pricing or personal information, this value represents how long the data should live on the private database in terms of blocks. The data will live for this specified number of blocks on the private database and after that it will get purged, making this data obsolete from the network. To keep private data indefinitely, that is, to never purge private data, set the <code>blockToLive</code> property to <code>0</code>.</li><li><code>memberOnlyRead</code>: a value of <code>true</code> indicates that peers automatically enforce that only clients belonging to one of the collection member organizations are allowed read access to private data.</li><li><code>memberOnlyWrite</code>: a value of <code>true</code> indicates that peers automatically enforce that only clients belonging to one of the collection member organizations are allowed write access to private data.</li><li><code>endorsementPolicy</code>: defines the endorsement policy that needs to be met in order to write to the private data collection. The collection level endorsement policy overrides to chaincode level policy. For more information on building a policy definition refer to the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/endorsement-policies.html">Endorsement policies</a> topic.</li></ul><p>æ‰€æœ‰çš„é›†åˆéƒ½æ˜¯ç”¨ä¸‹é¢çš„å±æ€§æ¥å®šä¹‰ï¼š</p><ul><li><code>name</code>: é›†åˆåç§°</li><li><code>policy</code>: å®šä¹‰å…è®¸æŒä¹…åŒ–é›†åˆæ•°æ®çš„ç»„ç»‡çš„peerèŠ‚ç‚¹ã€‚</li><li><code>requiredPeerCount</code>: ä¼ æ’­ç§æœ‰æ•°æ®æ‰€éœ€çš„peeræ•°ç›®ï¼Œä»¥ä½œä¸ºå¯¹é“¾ç çš„è®¤å¯</li><li><code>maxPeerCount</code>: ä¸ºäº†æ•°æ®å†—ä½™ï¼Œå½“å‰åˆæ³•peerå°†å°è¯•å‘å…¶åˆ†å‘æ•°æ®çš„å…¶ä»–peerçš„æ•°é‡ã€‚å¦‚æœä¸€ä¸ªåˆæ³•çš„peeræŒ‚äº†ï¼Œå¦‚æœæœ‰è¯·æ±‚æ‹‰ç§æœ‰æ•°æ®çš„è¯·æ±‚ï¼Œåˆ™è¿™äº›å…¶ä»–peeråœ¨æäº¤æ—¶å¯ç”¨ã€‚</li><li><code>blockToLive</code>: å¯¹äºå¦‚ä»·æ ¼æˆ–ä¸ªäººä¿¡æ¯è¿™ç±»éå¸¸æ•æ„Ÿçš„ä¿¡æ¯ï¼Œæ­¤å€¼è¡¨ç¤ºæ•°æ®åº”åœ¨ç§æœ‰æ•°æ®åº“çš„å—ä¸Šä¿å­˜çš„æ—¶é—´ã€‚æ•°æ®å°†åœ¨ç§æœ‰æ•°æ®åº“å—ä¸Šä¿ç•™æŒ‡å®šçš„æ—¶é—´ï¼Œç„¶åæ¸…é™¤ï¼Œä½¿è¯¥æ•°æ®ä»ç½‘ç»œä¸Šè¿‡æ—¶ã€‚è¦æ— é™æœŸä¿ç•™ç§æœ‰æ•°æ®ï¼Œå³ä»ä¸æ¸…é™¤ç§æœ‰æ•°æ®ï¼Œè¯·å°†<code>blockToLive</code>å±æ€§è®¾ç½®ä¸º0ã€‚</li><li><code>memberOnlyRead</code>: å€¼ä¸ºtrueè¡¨ç¤ºpeerèŠ‚ç‚¹è‡ªåŠ¨å¼ºåˆ¶åªæœ‰å±äºé›†åˆæˆå‘˜ç»„ç»‡çš„å®¢æˆ·ç«¯æ‰å…è®¸è¯»å–ç§æœ‰æ•°æ®ã€‚</li><li><code>memberOnlyWrite</code>:å€¼ä¸ºtrueè¡¨ç¤ºpeerèŠ‚ç‚¹è‡ªåŠ¨å¼ºåˆ¶åªæœ‰å±äºé›†åˆæˆå‘˜ç»„ç»‡çš„å®¢æˆ·ç«¯æ‰å…è®¸å†™å…¥ç§æœ‰æ•°æ®ã€‚</li><li><code>endorsementPolicy</code>: å®šä¹‰äº†å†™å…¥ç§æœ‰æ•°æ®é›†åˆéœ€è¦æ»¡è¶³çš„è®¤å¯ç­–ç•¥ã€‚é›†åˆçº§åˆ«çš„èƒŒä¹¦ç­–ç•¥ä¼šè¦†ç›–chaincodeçº§åˆ«çš„ç­–ç•¥ã€‚æœ‰å…³æ„å»ºç­–ç•¥å®šä¹‰çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/endorsement-policies.html">Endorsement policies</a>ä¸»é¢˜ã€‚</li></ul><p>The same collection definition file needs to be deployed by all organizations that use the chaincode, even if the organization does not belong to any collections. In addition to the collections that are explicitly defined in a collection file, each organization has access to an implicit collection on their peers that can only be read by their organization. For an example that uses implicit data collections, see the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/secured_asset_transfer/secured_private_asset_transfer_tutorial.html">Secured asset transfer in Fabric</a>.</p><p>æ‰€æœ‰ä½¿ç”¨åŒä¸€ä¸ªchaincodeçš„ç»„ç»‡éƒ½è¦éƒ¨ç½²ç›¸åŒçš„é›†åˆå®šä¹‰æ–‡ä»¶ï¼Œå³ä½¿è¿™ä¸ªç»„ç»‡ä¸å±äºä»»ä½•é›†åˆã€‚é™¤äº†åœ¨é›†åˆæ–‡ä»¶ä¸­æ˜¾å¼å®šä¹‰çš„é›†åˆä¹‹å¤–ï¼Œæ¯ä¸ªç»„ç»‡éƒ½å¯ä»¥è®¿é—®å…¶peerèŠ‚ç‚¹ä¸Šçš„éšå¼é›†åˆï¼Œè¿™äº›éšå¼é›†åˆåªèƒ½ç”±å…¶ç»„ç»‡è¯»å–ã€‚ä½¿ç”¨éšå¼æ•°æ®é›†çš„ä¾‹å­å¯ä»¥çœ‹<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/secured_asset_transfer/secured_private_asset_transfer_tutorial.html">Secured asset transfer in Fabric</a>ã€‚</p><p>The asset transfer private data example contains a collections_config.json file that defines three private data collection definitions: <code>assetCollection</code>, <code>Org1MSPPrivateCollection</code>, and <code>Org2MSPPrivateCollection</code>.</p><p>èµ„äº§è½¬ç§»ç§æœ‰æ•°æ®çš„ç¤ºä¾‹åŒ…å«ä¸€ä¸ªcollections_config.jsonæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å®šä¹‰äº†ä¸‰ä¸ªç§æœ‰æ•°æ®é›†åˆå®šä¹‰ï¼š<code>assetCollection</code>, <code>Org1MSPPrivateCollection</code>, and <code>Org2MSPPrivateCollection</code>ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// collections_config.json</span></span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">   &#123;</span><br><span class="line">   <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;assetCollection&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;policy&quot;</span>: <span class="string">&quot;OR(&#x27;Org1MSP.member&#x27;, &#x27;Org2MSP.member&#x27;)&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;requiredPeerCount&quot;</span>: <span class="number">1</span>,</span><br><span class="line">   <span class="attr">&quot;maxPeerCount&quot;</span>: <span class="number">1</span>,</span><br><span class="line">   <span class="attr">&quot;blockToLive&quot;</span>:<span class="number">1000000</span>,</span><br><span class="line">   <span class="attr">&quot;memberOnlyRead&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">   <span class="attr">&quot;memberOnlyWrite&quot;</span>: <span class="literal">true</span></span><br><span class="line">   &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">   <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Org1MSPPrivateCollection&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;policy&quot;</span>: <span class="string">&quot;OR(&#x27;Org1MSP.member&#x27;)&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;requiredPeerCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">   <span class="attr">&quot;maxPeerCount&quot;</span>: <span class="number">1</span>,</span><br><span class="line">   <span class="attr">&quot;blockToLive&quot;</span>:<span class="number">3</span>,</span><br><span class="line">   <span class="attr">&quot;memberOnlyRead&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">   <span class="attr">&quot;memberOnlyWrite&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">   <span class="attr">&quot;endorsementPolicy&quot;</span>: &#123;</span><br><span class="line">       <span class="attr">&quot;signaturePolicy&quot;</span>: <span class="string">&quot;OR(&#x27;Org1MSP.member&#x27;)&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line">   &#125;,</span><br><span class="line">   &#123;</span><br><span class="line">   <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Org2MSPPrivateCollection&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;policy&quot;</span>: <span class="string">&quot;OR(&#x27;Org2MSP.member&#x27;)&quot;</span>,</span><br><span class="line">   <span class="attr">&quot;requiredPeerCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">   <span class="attr">&quot;maxPeerCount&quot;</span>: <span class="number">1</span>,</span><br><span class="line">   <span class="attr">&quot;blockToLive&quot;</span>:<span class="number">3</span>,</span><br><span class="line">   <span class="attr">&quot;memberOnlyRead&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">   <span class="attr">&quot;memberOnlyWrite&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">   <span class="attr">&quot;endorsementPolicy&quot;</span>: &#123;</span><br><span class="line">       <span class="attr">&quot;signaturePolicy&quot;</span>: <span class="string">&quot;OR(&#x27;Org2MSP.member&#x27;)&quot;</span></span><br><span class="line">   &#125;</span><br><span class="line">   &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>The <code>policy</code> property in the <code>assetCollection</code> definition specifies that both Org1 and Org2 can store the collection on their peers. The <code>memberOnlyRead</code> and <code>memberOnlyWrite</code> parameters are used to specify that only Org1 and Org2 clients can read and write to this collection.</p><p><code>assetCollection</code>å®šä¹‰ä¸­çš„<code>policy</code>å±æ€§æŒ‡å®šOrg1å’ŒOrg2éƒ½å¯ä»¥åœ¨å…¶peerèŠ‚ç‚¹ä¸Šå­˜å‚¨é›†åˆã€‚ <code>memberOnlyRead</code> å’Œ <code>memberOnlyWrite</code> å‚æ•°è¢«ç”¨äºæŒ‡å®šåªæœ‰Org1å’ŒOrg2çš„å®¢æˆ·ç«¯å¯ä»¥è¯»å†™è¿™ä¸ªé›†åˆã€‚</p><p>The <code>Org1MSPPrivateCollection</code> collection allows only peers of Org1 to have the private data in their private database, while the <code>Org2MSPPrivateCollection</code> collection can only be stored by the peers of Org2. The <code>endorsementPolicy</code> parameter is used to create a collection specific endorsement policy. Each update to <code>Org1MSPPrivateCollection</code> or <code>Org2MSPPrivateCollection</code> needs to be endorsed by the organization that stores the collection on their peers. We will see how these collections are used to transfer the asset in the course of the tutorial.</p><p><code>Org1MSPPrivateCollection</code> é›†åˆåªå…è®¸Org1çš„peerèŠ‚ç‚¹åœ¨ä»–ä»¬çš„ç§æœ‰æ•°æ®åº“ä¸­æ‹¥æœ‰ç§æœ‰æ•°æ®ï¼Œè€Œ<code>Org2MSPPrivateCollection</code>é›†åˆåªèƒ½ç”±Org2çš„peerèŠ‚ç‚¹å­˜å‚¨ã€‚ <code>endorsementPolicy</code> å‚æ•°ç”¨äºåˆ›å»ºç‰¹å®šé›†åˆçš„è®¤å¯ç­–ç•¥ã€‚å¯¹<code>Org1MSPPrivateCollection</code>æˆ–<code>Org2MSPPrivateCollection</code>çš„æ¯æ¬¡æ›´æ–°éƒ½éœ€è¦ç”±å°†é›†åˆå­˜å‚¨åœ¨å…¶peerèŠ‚ç‚¹çš„ç»„ç»‡è®¤å¯ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨è¿™äº›é›†åˆæ¥è½¬ç§»èµ„äº§ã€‚</p><p>This collection definition file is deployed when the chaincode definition is committed to the channel using the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-commit">peer lifecycle chaincode commit command</a>. More details on this process are provided in Section 3 below.</p><p>è¿™ä¸ªé›†åˆå®šä¹‰æ–‡ä»¶æ˜¯åœ¨ä½¿ç”¨<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerlifecycle.html#peer-lifecycle-chaincode-commit">peer lifecycle chaincode commit command</a>æŠŠé“¾ç å®šä¹‰æäº¤åˆ°é€šé“æ—¶è¢«éƒ¨ç½²çš„ã€‚</p><h2 id="Read-and-Write-private-data-using-chaincode-APIsï¼ˆä½¿ç”¨chaincode-APIè¯»å†™ç§æœ‰æ•°æ®ï¼‰">Read and Write private data using chaincode APIsï¼ˆä½¿ç”¨chaincode APIè¯»å†™ç§æœ‰æ•°æ®ï¼‰</h2><p>The next step in understanding how to privatize data on a channel is to build the data definition in the chaincode. The asset transfer private data sample divides the private data into three separate data definitions according to how the data will be accessed.</p><p>ä¸‹ä¸€æ­¥æ˜¯äº†è§£å¦‚ä½•åœ¨é“¾ç ä¸­å»ºç«‹æ•°æ®å®šä¹‰æ¥å¯¹é€šé“ä¸Šçš„æ•°æ®è¿›è¡Œç§æœ‰åŒ–ã€‚èµ„äº§è½¬ç§»ç§æœ‰æ•°æ®å®ä¾‹æ ¹æ®è®¿é—®æ•°æ®çš„æ–¹å¼å°†ç§æœ‰æ•°æ®åˆ†ä¸ºä¸‰ä¸ªå•ç‹¬çš„æ•°æ®å®šä¹‰ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Peers in Org1 and Org2 will have this private data in a side database</span></span><br><span class="line"><span class="keyword">type</span> Asset <span class="keyword">struct</span> &#123;</span><br><span class="line">       Type  <span class="keyword">string</span> <span class="string">`json:&quot;objectType&quot;`</span> <span class="comment">//Type is used to distinguish the various types of objects in state database</span></span><br><span class="line">       ID    <span class="keyword">string</span> <span class="string">`json:&quot;assetID&quot;`</span></span><br><span class="line">       Color <span class="keyword">string</span> <span class="string">`json:&quot;color&quot;`</span></span><br><span class="line">       Size  <span class="keyword">int</span>    <span class="string">`json:&quot;size&quot;`</span></span><br><span class="line">       Owner <span class="keyword">string</span> <span class="string">`json:&quot;owner&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AssetPrivateDetails describes details that are private to owners</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Only peers in Org1 will have this private data in a side database</span></span><br><span class="line"><span class="keyword">type</span> AssetPrivateDetails <span class="keyword">struct</span> &#123;</span><br><span class="line">       ID             <span class="keyword">string</span> <span class="string">`json:&quot;assetID&quot;`</span></span><br><span class="line">       AppraisedValue <span class="keyword">int</span>    <span class="string">`json:&quot;appraisedValue&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Only peers in Org2 will have this private data in a side database</span></span><br><span class="line"><span class="keyword">type</span> AssetPrivateDetails <span class="keyword">struct</span> &#123;</span><br><span class="line">       ID             <span class="keyword">string</span> <span class="string">`json:&quot;assetID&quot;`</span></span><br><span class="line">       AppraisedValue <span class="keyword">int</span>    <span class="string">`json:&quot;appraisedValue&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Specifically, access to the private data will be restricted as follows:</p><ul><li><code>objectType, color, size, and owner</code> are stored in <code>assetCollection</code> and hence will be visible to members of the channel per the definition in the collection policy (Org1 and Org2).</li><li><code>AppraisedValue</code> of an asset is stored in collection <code>Org1MSPPrivateCollection</code> or <code>Org2MSPPrivateCollection</code> , depending on the owner of the asset. The value is only accessible to the users who belong to the organization that can store the collection.</li></ul><p>å…·ä½“æ¥è¯´ï¼Œå¯¹ç§æœ‰æ•°æ®çš„è®¿é—®å°†å—åˆ°ä»¥ä¸‹é™åˆ¶ï¼š</p><ul><li><code>objectType, color, size, and owner</code> è¢«å­˜å‚¨åœ¨ <code>assetCollection</code> å› æ­¤ï¼Œæ ¹æ®é›†åˆç­–ç•¥ä¸­çš„å®šä¹‰ï¼Œè¿™äº›æ•°æ®å¯¹é€šé“ä¸Šçš„Org1å’ŒOrg2æ˜¯å¯ä»¥è®¿é—®çš„ã€‚</li><li>èµ„äº§çš„è¯„ä¼°ä»·å€¼è¢«å­˜å‚¨åœ¨ <code>Org1MSPPrivateCollection</code> æˆ– <code>Org2MSPPrivateCollection</code> é›†åˆä¸­ï¼Œå–å†³äºèµ„äº§çš„æ‰€æœ‰è€…ã€‚åªæœ‰å±äºå¯ä»¥å­˜å‚¨é›†åˆçš„ç»„ç»‡çš„ç”¨æˆ·æ‰èƒ½è®¿é—®è¯¥è¯„ä¼°å€¼ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> Secured </tag>
            
            <tag> Private Data </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨Fabricä¸­äº¤æ˜“å—ä¿æŠ¤çš„èµ„äº§</title>
      <link href="2021/04/01/blockchain/fabric/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/"/>
      <url>2021/04/01/blockchain/fabric/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/</url>
      
        <content type="html"><![CDATA[<h1 id="åœ¨Fabricä¸­äº¤æ˜“å—ä¿æŠ¤çš„èµ„äº§">åœ¨Fabricä¸­äº¤æ˜“å—ä¿æŠ¤çš„èµ„äº§</h1><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/secured_asset_transfer/secured_private_asset_transfer_tutorial.html">Secured asset transfer in Fabric</a></p><p>This tutorial will demonstrate how an asset can be represented and traded between organizations in a Hyperledger Fabric blockchain channel, while keeping details of the asset and transaction private using private data. Each on-chain asset is a non-fungible token (NFT) that represents a specific asset having certain immutable metadata properties (such as size and color) with a unique owner. When the owner wants to sell the asset, both parties need to agree to the same price before the asset is transferred. The private asset transfer smart contract enforces that only the owner of the asset can transfer the asset. In the course of this tutorial, you will learn how Fabric features such as state based endorsement, private data, and access control come together to provide secured transactions that are both private and verifiable.</p><p>æœ¬æ–‡æ¡£ä¼šæ¼”ç¤ºå¦‚ä½•åœ¨Hyperledger FabricåŒºå—é“¾çš„é€šé“ä¸­çš„ç»„ç»‡ä¹‹é—´è¡¨ç¤ºå’Œäº¤æ˜“èµ„äº§ï¼ŒåŒæ—¶ä¿æŒèµ„äº§å’Œäº¤æ˜“çš„ç§æœ‰æ€§ã€‚é“¾ä¸Šçš„æ¯ä¸ªèµ„äº§éƒ½æ˜¯ä¸€ä¸ªNFTï¼ˆnon-fungible tokenï¼Œä¸å¯æ›¿ä»£ä»¤ç‰Œï¼‰ï¼Œè¿™ä¸ªNFTä»£è¡¨å…·æœ‰å”¯ä¸€æ‹¥æœ‰è€…ã€å…·æœ‰æŸäº›ä¸å˜çš„å…ƒæ•°æ®å±æ€§ï¼ˆä¾‹å¦‚å¤§å°å’Œé¢œè‰²ï¼‰çš„ç‰¹å®šèµ„äº§ã€‚å½“æ‰€æœ‰è€…æƒ³è¦å‡ºå”®èµ„äº§æ—¶ï¼ŒåŒæ–¹éœ€è¦åœ¨è½¬è®©èµ„äº§ä¹‹å‰è¾¾æˆä¸€è‡´çš„ä»·æ ¼ã€‚ç§æœ‰èµ„äº§è½¬è®©æ™ºèƒ½åˆçº¦å¼ºåˆ¶è§„å®šåªæœ‰èµ„äº§æ‰€æœ‰è€…æ‰èƒ½è½¬è®©èµ„äº§ã€‚åœ¨æœ¬æ•™ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•æŠŠFabricçš„ç‰¹æ€§ï¼ˆå¦‚åŸºäºçŠ¶æ€çš„èƒŒä¹¦ã€ç§æœ‰æ•°æ®å’Œè®¿é—®æ§åˆ¶ï¼‰ç»„åˆåœ¨ä¸€èµ·ï¼Œä»¥æä¾›ç§æœ‰ä¸”å¯éªŒè¯çš„å®‰å…¨äº¤æ˜“ã€‚</p><p>This tutorial will deploy the <a href="https://github.com/hyperledger/fabric-samples/tree/master/asset-transfer-secured-agreement/chaincode-go">secured asset transfer sample</a> to demonstrate how to transfer a private asset between two organizations without publicly sharing data. You should have completed the task <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/secured_asset_transfer/install.html#install-samples-binaries-and-docker-images">Install Samples, Binaries, and Docker Images</a>.</p><p>æœ¬æ•™ç¨‹ä¼šéƒ¨ç½² <a href="https://github.com/hyperledger/fabric-samples/tree/master/asset-transfer-secured-agreement/chaincode-go">secured asset transfer sample</a> æ¥æ¼”ç¤ºå¦‚ä½•åœ¨ä¸¤ä¸ªç»„ç»‡ä¹‹é—´è½¬ç§»ç§æœ‰èµ„äº§è€Œä¸å…¬å¼€å…±äº«æ•°æ®ã€‚</p><h2 id="Scenario-requirementsï¼ˆæ–¹æ¡ˆè¦æ±‚ï¼‰">Scenario requirementsï¼ˆæ–¹æ¡ˆè¦æ±‚ï¼‰</h2><p>The private asset transfer scenario is bound by the following requirements:</p><ul><li>An asset may be issued by the first ownerâ€™s organization (in the real world issuance may be restricted to some authority that certifies an assetâ€™s properties).</li><li>Ownership is managed at the organization level (the Fabric permissioning scheme would equally support ownership at an individual identity level within an organization).</li><li>The asset identifier and owner is stored as public channel data for all channel members to see.</li><li>The asset metadata properties however are private information known only to the asset owner (and prior owners).</li><li>An interested buyer will want to verify an assetâ€™s private properties.</li><li>An interested buyer will want to verify an assetâ€™s provenance, specifically the assetâ€™s origin and chain of custody. They will also want to verify that the asset has not changed since issuance, and that all prior transfers have been legitimate.</li><li>To transfer an asset, a buyer and seller must first agree on the sales price.</li><li>Only the current owner may transfer their asset to another organization.</li><li>The actual private asset transfer must verify that the legitimate asset is being transferred, and verify that the price has been agreed to. Both buyer and seller must endorse the transfer.</li></ul><p>ç§æœ‰èµ„äº§äº¤æ˜“æ–¹æ¡ˆå—ä»¥ä¸‹è¦æ±‚çº¦æŸï¼š</p><ul><li>ä¸€ä¸ªèµ„äº§å¯èƒ½ç”±ç¬¬ä¸€ä¸ªæ‹¥æœ‰è€…çš„ç»„ç»‡å‘è¡Œï¼ˆåœ¨ç°å®ä¸–ç•Œä¸­ï¼Œå¯èƒ½åªèƒ½ç”±æŸä¸ªæƒå¨çš„å¯ä»¥è¯æ˜èµ„äº§å±æ€§çš„ç»„ç»‡æ¥å‘è¡Œï¼‰ã€‚</li><li>æ‰€æœ‰æƒæ˜¯åœ¨ç»„ç»‡çº§åˆ«è¿›è¡Œç®¡ç†çš„ï¼ˆFabricè®¸å¯æ–¹æ¡ˆå°†åŒæ ·æ”¯æŒç»„ç»‡å†…ä¸ªäººèº«ä»½çº§åˆ«çš„æ‰€æœ‰æƒï¼‰ã€‚</li><li>èµ„äº§çš„IDå’Œæ‰€æœ‰äººä½œä¸ºå¯ä»¥è¢«channelä¸Šçš„æ‰€æœ‰æˆå‘˜å¯è§çš„å…¬å…±æ•°æ®è¢«å­˜å‚¨ã€‚</li><li>ä½†æ˜¯èµ„äº§çš„å…ƒæ•°æ®ä½œä¸ºç§æœ‰ä¿¡æ¯ï¼Œåªèƒ½è¢«èµ„äº§çš„æ‰€æœ‰è€…çœ‹åˆ°ï¼ˆä¹ŸåŒ…æ‹¬å‰æ‰€æœ‰è€…ï¼‰ã€‚</li><li>æœ‰å…´è¶£çš„ä¹°å®¶å°†å¸Œæœ›éªŒè¯èµ„äº§çš„ç§æœ‰å±æ€§ã€‚</li><li>æœ‰å…´è¶£çš„ä¹°å®¶å°†å¸Œæœ›éªŒè¯èµ„äº§çš„å‡ºå¤„ï¼Œç‰¹åˆ«æ˜¯èµ„äº§çš„æ¥æºå’Œäº§é”€ç›‘ç®¡é“¾ã€‚ä»–ä»¬è¿˜å¸Œæœ›éªŒè¯èµ„äº§è‡ªä»å‘è¡Œä¹‹åæ²¡æœ‰è¢«ç¯¡æ”¹è¿‡ï¼Œå¹¶ä¸”è¿™ä¸ªèµ„äº§çš„å‰é¢çš„æ‰€æœ‰äº¤æ˜“éƒ½æ˜¯åˆæ³•çš„ã€‚</li><li>åœ¨èµ„äº§äº¤æ˜“ä¹‹å‰ï¼Œä¹°å–åŒæ–¹å¿…é¡»å¯¹èµ„äº§çš„ä»·æ ¼è¾¾æˆä¸€è‡´ã€‚</li><li>åªæœ‰å½“å‰æ‹¥æœ‰è€…å¯ä»¥æŠŠä»–ä»¬çš„èµ„äº§è½¬è®©ç»™å¦ä¸€ä¸ªç»„ç»‡ã€‚</li><li>å®é™…çš„ç§æœ‰èµ„äº§äº¤æ˜“å¿…é¡»ç¡®è®¤åˆæ³•èµ„äº§æ­£åœ¨è½¬è®©ï¼Œå¹¶ç¡®è®¤åŒæ–¹å·²ç»å¯¹ä»·æ ¼è¾¾æˆä¸€è‡´ã€‚ä¹°å–åŒæ–¹éƒ½å¿…é¡»å¯¹äº¤æ˜“è¿›è¡ŒèƒŒä¹¦ã€‚</li></ul><h2 id="How-privacy-is-maintainedï¼ˆå¦‚ä½•ä¿æŒéšç§æ€§ï¼‰">How privacy is maintainedï¼ˆå¦‚ä½•ä¿æŒéšç§æ€§ï¼‰</h2><p>The smart contract uses the following techniques to ensure that the asset properties remain private:</p><ul><li>The asset metadata properties are stored in the current owning organizationâ€™s implicit private data collection on the organizationâ€™s peers only. Each organization on a Fabric channel has a private data collection that their own organization can use. This collection is <em>implicit</em> because it does not need to be explicitly defined in the chaincode.</li><li>Although a hash of the private properties is automatically stored on-chain for all channel members to see, a random salt is included in the private properties so that other channel members cannot guess the private data pre-image through a dictionary attack.</li><li>Smart contract requests utilize the transient field for private data so that private data does not get included in the final on-chain transaction.</li><li>Private data queries must originate from a client whose org id matches the peerâ€™s org id, which must be the same as the asset ownerâ€™s org id.</li></ul><p>æ™ºèƒ½åˆçº¦ä½¿ç”¨ä»¥ä¸‹æŠ€æœ¯æ¥ç¡®ä¿èµ„äº§å±æ€§ä¿æŒéšç§ï¼š</p><ul><li>èµ„äº§å…ƒæ•°æ®å±æ€§ä»…å­˜å‚¨åœ¨å½“å‰æ‹¥æœ‰ç»„ç»‡çš„èŠ‚ç‚¹çš„éšå¼ç§æœ‰æ•°æ®é›†åˆä¸­ã€‚æ¯ä¸ªç»„ç»‡åœ¨Fabricé€šé“ä¸Šéƒ½æœ‰ä¸€ä¸ªåªèƒ½ç”±ç»„ç»‡è‡ªå·±å¯ä»¥ä½¿ç”¨çš„ç§æœ‰æ•°æ®é›†åˆã€‚è¯¥é›†åˆæ˜¯éšå¼çš„ï¼Œå› ä¸ºä¸éœ€è¦åœ¨é“¾ç ä¸­æ˜¾å¼å®šä¹‰å®ƒã€‚</li><li>è™½ç„¶ç§æœ‰å±æ€§çš„hashå€¼è¢«è‡ªåŠ¨ä¿å­˜åœ¨é“¾ä¸Šç„¶åé€šé“ä¸Šæ‰€æœ‰æˆå‘˜éƒ½å¯ä»¥çœ‹åˆ°ï¼Œä½†æ˜¯ç§æœ‰å±æ€§ä¸­åŒ…å«éšæœºç›ï¼Œå› æ­¤å…¶ä»–çš„é€šé“æˆå‘˜æ— æ³•é€šè¿‡å­—å…¸æ”»å‡»çŒœæµ‹ç§æœ‰æ•°æ®åŸåƒã€‚</li><li>æ™ºèƒ½åˆçº¦è¯·æ±‚å°†ç¬æ€å­—æ®µç”¨äºç§æœ‰æ•°æ®ï¼Œå› æ­¤ç§æœ‰æ•°æ®ä¸ä¼šåŒ…å«åœ¨æœ€ç»ˆçš„é“¾ä¸Šäº¤æ˜“ä¸­ã€‚</li><li>å¯¹ç§æœ‰æ•°æ®çš„æŸ¥è¯¢å¿…é¡»æ¥è‡ªç»„ç»‡IDä¸peerçš„ç»„ç»‡IDä¸€è‡´çš„å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”è¯¥å®¢æˆ·ç«¯çš„IDå¿…é¡»ä¸èµ„äº§æ‰€æœ‰è€…çš„ç»„ç»‡IDç›¸åŒã€‚</li></ul><h2 id="How-the-transfer-is-implementedï¼ˆäº¤æ˜“æ˜¯å¦‚ä½•å®æ–½çš„ï¼‰">How the transfer is implementedï¼ˆäº¤æ˜“æ˜¯å¦‚ä½•å®æ–½çš„ï¼‰</h2><p>Before we start using the private asset transfer smart contract we will provide an overview of the transaction flow and how Fabric features are used to protect the asset created on the blockchain:</p><p>åœ¨æˆ‘ä»¬å¼€å§‹ä½¿ç”¨ç§æœ‰èµ„äº§äº¤æ˜“çš„æ™ºèƒ½åˆçº¦ä¹‹å‰ï¼Œæˆ‘ä»¬å°†æ¦‚è¿°äº¤æ˜“æµç¨‹ä»¥åŠå¦‚ä½•ä½¿ç”¨FabricåŠŸèƒ½æ¥ä¿æŠ¤åœ¨åŒºå—é“¾ä¸Šåˆ›å»ºçš„èµ„äº§ï¼š</p><h3 id="Creating-the-assetï¼ˆåˆ›å»ºèµ„äº§ï¼‰">Creating the assetï¼ˆåˆ›å»ºèµ„äº§ï¼‰</h3><p>The private asset transfer smart contract is deployed with an endorsement policy that requires an endorsement from any channel member. This allows any organization to create an asset that they own without requiring an endorsement from other channel members. The creation of the asset is the only transaction that uses the chaincode level endorsement policy. Transactions that update or transfer existing assets will be governed by state based endorsement policies or the endorsement policies of private data collections. Note that in other scenarios, you may want an issuing authority to also endorse create transactions.</p><p>ç§æœ‰èµ„äº§äº¤æ˜“æ™ºèƒ½åˆçº¦åœ¨éƒ¨ç½²æ—¶æœ‰ä¸€ä¸ªèƒŒä¹¦ç­–ç•¥ï¼Œè¿™ä¸ªèƒŒä¹¦ç­–ç•¥æ˜¯ï¼šä¸éœ€è¦ä»»ä½•æ¸ é“æˆå‘˜çš„è®¤å¯ã€‚è¿™æ ·ä»»ä½•ç»„ç»‡éƒ½å¯ä»¥åˆ›å»ºå±äºä»–ä»¬è‡ªå·±çš„èµ„äº§ï¼Œè€Œä¸éœ€è¦å…¶ä»–çš„é€šé“æˆå‘˜æ‰¹å‡†ã€‚èµ„äº§çš„åˆ›å»ºæ˜¯å”¯ä¸€ä½¿ç”¨é“¾ç çº§èƒŒä¹¦ç­–ç•¥çš„äº¤æ˜“ã€‚æ›´æ–°æˆ–äº¤æ˜“ç°æœ‰èµ„äº§çš„äº¤æ˜“å°†å—åŸºäºçŠ¶æ€è®¤å¯æ”¿ç­–æˆ–ç§æœ‰æ•°æ®é›†åˆè®¤å¯æ”¿ç­–çš„çº¦æŸã€‚æ³¨æ„åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½æƒ³è¦ä¸€ä¸ªå‘è¡Œæœºæ„ä¹Ÿè®¤å¯åˆ›å»ºäº¤æ˜“ã€‚</p><p>The smart contract uses the following Fabric features to ensure that the asset can only be updated or transferred by the organization that owns the asset:</p><ul><li>When the asset is created, the smart contract gets the MSP ID of the organization that submitted the request, and stores the MSP ID as the owner in the asset key/value in the public chaincode world state. Subsequent smart contract requests to update or transfer the asset will use access control logic to verify that the requesting client is from the same organization. Note that in other scenarios, the ownership could be based on a specific client identity within an organization, rather than an organization itself.</li><li>Also when the asset is created, the smart contract sets a state based endorsement policy for the asset key. The state based policy specifies that a peer from the organization that owns the asset must endorse a subsequent request to update or transfer the asset. This prevents any other organization from updating or transferring the asset using a smart contract that has been maliciously altered on their own peers.</li></ul><p>æ™ºèƒ½åˆçº¦ä½¿ç”¨ä»¥ä¸‹çš„FabricåŠŸèƒ½æ¥ç¡®ä¿èµ„äº§åªèƒ½ç”±æ‹¥æœ‰å®ƒçš„ç»„ç»‡è¿›è¡Œæ›´æ–°å’Œäº¤æ˜“ï¼š</p><ul><li>åœ¨èµ„äº§åˆ›å»ºåï¼Œæ™ºèƒ½åˆçº¦ä¼šè·å–æäº¤è¯·æ±‚çš„ç»„ç»‡çš„MSP ID ï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªMSP IDä½œä¸ºèµ„äº§çš„æ‹¥æœ‰è€…å­˜å‚¨åœ¨å…¬å…±é“¾ç ä¸–ç•ŒçŠ¶æ€çš„key/valueä¸­ã€‚åç»­çš„æ›´æ–°æˆ–äº¤æ˜“èµ„äº§çš„æ™ºèƒ½åˆçº¦è¯·æ±‚å°†ä¼šä½¿ç”¨è®¿é—®æ§åˆ¶é€»è¾‘æ¥éªŒè¯å‘å‡ºè¯·æ±‚çš„å®¢æˆ·ç«¯æ¥è‡ªåŒä¸€ä¸ªç»„ç»‡ã€‚è¯·æ³¨æ„åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æƒå¯ä»¥åŸºäºç»„ç»‡å†…çš„ç‰¹å®šå®¢æˆ·ç«¯èº«ä»½ï¼Œè€Œä¸æ˜¯ç»„ç»‡æœ¬èº«ã€‚</li><li>åŒæ ·ï¼Œåœ¨åˆ›å»ºèµ„äº§æ—¶ï¼Œæ™ºèƒ½åˆçº¦ä¼šä¸ºèµ„äº§å¯†é’¥è®¾ç½®åŸºäºçŠ¶æ€çš„èƒŒä¹¦ç­–ç•¥ã€‚åŸºäºçŠ¶æ€çš„ç­–ç•¥æŒ‡å®šæ‹¥æœ‰èµ„äº§çš„ç»„ç»‡ä¸­çš„peerèŠ‚ç‚¹å¿…é¡»è®¤å¯åç»­çš„æ›´æ–°æˆ–è½¬è®©èµ„äº§çš„è¯·æ±‚ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢ä»»ä½•å…¶ä»–ç»„ç»‡åˆ©ç”¨æ¶æ„æ›´æ”¹çš„æ™ºèƒ½åˆçº¦æ¥æ›´æ”¹å’Œäº¤æ˜“èµ„äº§ã€‚</li></ul><h3 id="Agreeing-to-the-transferï¼ˆåŒæ„äº¤æ˜“ï¼‰">Agreeing to the transferï¼ˆåŒæ„äº¤æ˜“ï¼‰</h3><p>After a asset is created, channel members can use the smart contract to agree to transfer the asset:</p><ul><li>The owner of the asset can change the description in the public ownership record, for example to advertise that the asset is for sale. Smart contract access control enforces that this change needs to be submitted from a member of the asset owner organization. The state based endorsement policy enforces that this description change must be endorsed by a peer from the ownerâ€™s organization.</li></ul><p>åœ¨èµ„äº§åˆ›å»ºä¹‹åï¼Œé€šé“ä¸Šçš„æˆå‘˜å¯ä»¥ä½¿ç”¨æ™ºèƒ½åˆçº¦æ¥åŒæ„äº¤æ˜“èµ„äº§ï¼š</p><ul><li>èµ„äº§çš„æ‹¥æœ‰è€…å¯ä»¥æ›´æ”¹å…¬å…±è®°å½•ä¸Šçš„æè¿°ï¼Œä¾‹å¦‚å¹¿å‘Šè¯´è¿™ä¸ªèµ„äº§è¦å–å‡ºã€‚æ™ºèƒ½åˆçº¦è®¿é—®æ§åˆ¶å¼ºåˆ¶è¦æ±‚æ­¤æ›´æ”¹éœ€è¦ä»æ‹¥æœ‰æ­¤èµ„äº§çš„ç»„ç»‡çš„æˆå‘˜æäº¤ã€‚åŸºäºçŠ¶æ€çš„èƒŒä¹¦ç­–ç•¥è§„å®šï¼Œæ­¤æè¿°æ›´æ”¹å¿…é¡»å¾—åˆ°æ‹¥æœ‰èµ„äº§çš„ç»„ç»‡çš„æˆå‘˜ç¡®è®¤ã€‚</li></ul><p>The asset owner and the asset buyer agree to transfer the asset for a certain price:</p><ul><li>The price agreed to by the buyer and the seller is stored in each organizationâ€™s implicit private data collection. The private data collection keeps the agreed price secret from other members of the channel. The endorsement policy of the private data collection ensures that the respective organizationâ€™s peer endorsed the price agreement, and the smart contract access control logic ensures that the price agreement was submitted by a client of the associated organization.</li><li>A hash of each price agreement is stored on the ledger. The two hashes will match only if the two organizations have agreed to the same price. This allows the organizations to verify that they have come to agreement on the transfer details before the transfer takes place. A random trade id is added to the price agreement, which serves as a <em>salt</em> to ensure that other channel members can not use the hash on the ledger to guess the price.</li></ul><p>èµ„äº§æ‰€æœ‰è€…å’Œèµ„äº§è´­ä¹°è€…åŒæ„ä»¥ä¸€å®šä»·æ ¼äº¤æ˜“èµ„äº§ï¼š</p><ul><li>ä¹°å–åŒæ–¹éƒ½åŒæ„çš„ä»·æ ¼è¢«å­˜å‚¨åœ¨ä»–ä»¬å„è‡ªçš„éšå¼ç§æœ‰æ•°æ®é›†åˆä¸­ã€‚ç§æœ‰æ•°æ®é›†åˆä¿è¯æˆäº¤ä»·æ ¼å¯¹é€šé“ä¸Šçš„å…¶ä»–æˆå‘˜æ¥è¯´æ˜¯ç§å¯†çš„ã€‚ç§æœ‰æ•°æ®é›†åˆèƒŒä¹¦ç­–ç•¥ç¡®ä¿å„è‡ªç»„ç»‡çš„peerèŠ‚ç‚¹å¯¹ä»·æ ¼è¾¾æˆäº†ä¸€è‡´ï¼Œæ™ºèƒ½åˆçº¦è®¿é—®æ§åˆ¶é€»è¾‘ç¡®ä¿ä»·æ ¼åè®®æ˜¯ç”±ä¸ç»„ç»‡æœ‰å…³è”çš„å®¢æˆ·ç«¯æäº¤çš„ã€‚</li><li>äº¤æ˜“åŒæ–¹ç”Ÿæˆçš„ä»·æ ¼åè®®çš„hashå€¼è¢«å­˜å‚¨åœ¨äº†è´¦æœ¬ä¸Šã€‚åªæœ‰åœ¨ä¸¤ä¸ªç»„ç»‡åŒæ„åŒä¸€ä¸ªä»·æ ¼æ—¶ï¼Œè¿™ä¸¤ä¸ªhashå€¼æ‰ä¼šåŒ¹é…ã€‚è¿™ä½¿ç»„ç»‡èƒ½å¤Ÿåœ¨è½¬ç§»å‘ç”Ÿä¹‹å‰éªŒè¯ä»–ä»¬å·²å°±è½¬ç§»ç»†èŠ‚è¾¾æˆåè®®ã€‚ä»·æ ¼åè®®ä¸­æ·»åŠ äº†éšæœºäº¤æ˜“IDï¼Œè¿™æ˜¯ç¡®ä¿é€šé“å…¶ä»–æˆå‘˜ä¸èƒ½ä½¿ç”¨è´¦æœ¬ä¸Šçš„å“ˆå¸Œå€¼æ¥çŒœæµ‹ä»·æ ¼çš„ä¸€ç§ç›ã€‚</li></ul><h3 id="Transferring-the-assetï¼ˆäº¤æ˜“èµ„äº§ï¼‰">Transferring the assetï¼ˆäº¤æ˜“èµ„äº§ï¼‰</h3><p>After the two organizations have agreed to the same price, the asset owner can use the transfer function to transfer the asset to the buyer:</p><ul><li>Smart contract access control ensures that the transfer must be initiated by a member of the organization that owns the asset.</li><li>The transfer function verifies that the assetâ€™s private immutable properties passed to the transfer function matches the on chain hash of the asset data in private collection, to ensure that the asset owner is <em>selling</em> the same asset that they own.</li><li>The transfer function uses the hash of the price agreement on the ledger to ensure that both organizations have agreed to the same price.</li><li>If the transfer conditions are met, the transfer function adds the asset to the implicit private data collection of the buyer, and deletes the asset from the collection of the seller. The transfer also updates the owner in the public ownership record.</li><li>Because of the endorsement policies of the seller and buyer implicit data collections, and the state based endorsement policy of the public record (requiring the seller to endorse), the transfer needs to be endorsed by peers from both buyer and seller.</li><li>The state based endorsement policy of the public asset record is updated so that only a peer of the new owner of the asset can update or sell their new asset.</li><li>The price agreements are also deleted from both the seller and buyer implicit private data collection, and a sales receipt is created in each private data collection.</li></ul><p>åœ¨ä¸¤ä¸ªç»„ç»‡å·²ç»å¯¹ç›¸åŒçš„ä»·æ ¼è¾¾æˆä¸€è‡´ä¹‹åï¼Œèµ„äº§çš„æ‹¥æœ‰è€…å¯ä»¥ä½¿ç”¨è½¬è®©æ–¹æ³•æ¥æŠŠèµ„äº§è½¬è®©ç»™ä¹°æ–¹ï¼š</p><ul><li>æ™ºèƒ½åˆçº¦è®¿é—®æ§åˆ¶ç¡®ä¿è½¬è´¦å¿…é¡»ç”±æ‹¥æœ‰èµ„äº§çš„ç»„ç»‡çš„æˆå‘˜æ¥å‘èµ·</li><li>è½¬è´¦æ–¹æ³•éªŒè¯ä¼ é€’ç»™å®ƒçš„èµ„äº§çš„ç§æœ‰ä¸å¯å˜å±æ€§æ˜¯å¦ä¸ç§æœ‰é›†åˆä¸­èµ„äº§æ•°æ®çš„é“¾ä¸Šå“ˆå¸ŒåŒ¹é…ï¼Œç¡®ä¿èµ„äº§æ‰€æœ‰è€…åœ¨å‡ºå”®ä»–ä»¬æ‹¥æœ‰çš„ç›¸åŒçš„èµ„äº§ã€‚</li><li>è½¬è´¦æ–¹æ³•ä½¿ç”¨è´¦æœ¬ä¸Šçš„ä»·æ ¼åè®®çš„hashå€¼æ¥ç¡®ä¿ä¸¤ä¸ªç»„ç»‡å·²ç»åŒæ„äº†ç›¸åŒçš„ä»·æ ¼ã€‚</li><li>å¦‚æœæ»¡è¶³è½¬è®©æ¡ä»¶ï¼Œåˆ™è½¬è´¦å‡½æ•°ä¼šå°†èµ„äº§æ·»åŠ åˆ°ä¹°æ–¹çš„éšå¼ç§æœ‰æ•°æ®é›†åˆä¸­ï¼Œå¹¶ä¸”ä»å–æ–¹çš„é›†åˆä¸­åˆ é™¤è¿™ä¸ªèµ„äº§ã€‚è½¬è®©è¿˜ä¼šæ›´æ–°å…¬å…±æ‰€æœ‰æƒè®°å½•ä¸­çš„èµ„äº§çš„æ‰€æœ‰è€…ã€‚</li><li>å› ä¸ºä¹°å–åŒæ–¹éšå¼æ•°æ®é›†åˆçš„èƒŒä¹¦ç­–ç•¥å’Œå…¬å…±æ•°æ®çš„åŸºäºçŠ¶æ€çš„èƒŒä¹¦ç­–ç•¥ï¼ˆè¦æ±‚å–æ–¹ç¡®è®¤ï¼‰ï¼Œæ‰€ä»¥äº¤æ˜“éœ€è¦å¾—åˆ°ä¹°å–åŒæ–¹èŠ‚ç‚¹çš„è®¤å¯ã€‚</li><li>å…¬å…±èµ„äº§è®°å½•çš„åŸºäºçŠ¶æ€çš„èƒŒä¹¦ç­–ç•¥éœ€è¦æ›´æ–°ï¼Œè¿™æ ·åªæœ‰æ–°çš„æ‰€æœ‰è€…çš„peerèŠ‚ç‚¹æ‰èƒ½å¤Ÿæ›´æ–°å’Œå‡ºå”®ä»–ä»¬çš„æ–°èµ„äº§ã€‚</li><li>ä»·æ ¼åè®®ä¹Ÿä»ä¹°å–åŒæ–¹éšå¼ç§äººæ•°æ®é›†åˆä¸­åˆ é™¤ï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªç§äººæ•°æ®é›†åˆä¸­åˆ›å»ºé”€å”®æ”¶æ®ã€‚</li></ul><h2 id="Running-the-private-asset-transfer-smart-contractï¼ˆè¿è¡Œç§æœ‰èµ„äº§è½¬è´¦æ™ºèƒ½åˆçº¦ï¼‰">Running the private asset transfer smart contractï¼ˆè¿è¡Œç§æœ‰èµ„äº§è½¬è´¦æ™ºèƒ½åˆçº¦ï¼‰</h2><p>You can use the Fabric test network to run the private asset transfer smart contract. The test network contains two peer organizations, Org1 and Org1, that operate one peer each. In this tutorial, we will deploy the smart contract to a channel of the test network joined by both organizations. We will first create an asset that is owned by Org1. After the two organizations agree on the price, we will transfer the asset from Org1 to Org2.</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Fabricçš„testç½‘ç»œæ¥è¿è¡Œç§æœ‰èµ„äº§è½¬è´¦æ™ºèƒ½åˆçº¦ã€‚ï¼ˆçœç•¥ã€‚ã€‚ã€‚ï¼‰æˆ‘ä»¬å…ˆé€šè¿‡Org1ç»„ç»‡åˆ›å»ºä¸€ä¸ªèµ„äº§ï¼Œåœ¨ä¸¤ä¸ªç»„ç»‡å¯¹ä»·æ ¼è¾¾æˆä¸€è‡´ä¹‹åï¼Œæˆ‘ä»¬æŠŠèµ„äº§ç”±Org1ç»„ç»‡äº¤æ˜“åˆ°Org2ç»„ç»‡ã€‚</p><h2 id="Deploy-the-test-networkï¼ˆéƒ¨ç½²æµ‹è¯•ç½‘ç»œï¼‰">Deploy the test networkï¼ˆéƒ¨ç½²æµ‹è¯•ç½‘ç»œï¼‰</h2><p>è¯·å‚è€ƒï¼š<a href="https://guozhe001.github.io/2021/04/01/blockchain/fabric/Fabric%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%E4%BD%BF%E7%94%A8/">Fabricæµ‹è¯•ç½‘ç»œä½¿ç”¨</a></p><h2 id="Deploy-the-smart-contract-éƒ¨ç½²æ™ºèƒ½åˆçº¦">Deploy the smart contract(éƒ¨ç½²æ™ºèƒ½åˆçº¦)</h2><p>You can use the test network script to deploy the secured asset transfer smart contract to the channel. Run the following command to deploy the smart contract to <code>mychannel</code>:</p><p>ä½ å¯ä»¥ä½¿ç”¨æµ‹è¯•ç½‘ç»œè„šæœ¬æ¥éƒ¨ç½²å®‰å…¨èµ„äº§äº¤æ˜“æ™ºèƒ½åˆçº¦åˆ°é€šé“ä¸Šã€‚è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥éƒ¨ç½²æ™ºèƒ½åˆçº¦åˆ°<code>mychannel</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;network.sh deployCC -ccn secured -ccp ..&#x2F;asset-transfer-secured-agreement&#x2F;chaincode-go&#x2F; -ccl go -ccep &quot;OR(&#39;Org1MSP.peer&#39;,&#39;Org2MSP.peer&#39;)&quot;</span><br></pre></td></tr></table></figure><p>Note that we are using the <code>-ccep</code> flag to deploy the smart contract with an endorsement policy of <code>&quot;OR('Org1MSP.peer','Org2MSP.peer')&quot;</code>. This allows either organization to create an asset without receiving an endorsement from the other organization.</p><p>æ³¨æ„æˆ‘ä»¬ä½¿ç”¨<code>-ccep</code>æ ‡å¿—æ¥éƒ¨ç½²æ™ºèƒ½åˆçº¦ï¼Œè¿™ä¸ªæ™ºèƒ½åˆçº¦æœ‰ä¸€ä¸ªèƒŒä¹¦ç­–ç•¥<code>&quot;OR('Org1MSP.peer','Org2MSP.peer')&quot;</code>ã€‚è€…å…è®¸ä»»æ„ä¸€ä¸ªç»„ç»‡åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„äº§æ—¶ä¸éœ€è¦å…¶ä»–ç»„ç»‡çš„ç¡®è®¤ã€‚</p><h3 id="Set-the-environment-variables-to-operate-as-Org2ï¼ˆè®¾ç½®ç¯å¢ƒå˜é‡ä»¥Org2çš„ç®¡ç†å‘˜èº«ä»½æ“ä½œï¼‰">Set the environment variables to operate as Org2ï¼ˆè®¾ç½®ç¯å¢ƒå˜é‡ä»¥Org2çš„ç®¡ç†å‘˜èº«ä»½æ“ä½œï¼‰</h3><p>ç•¥ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªç»ˆç«¯åˆ†åˆ«ä»¥Org1å’ŒOrg2ç»„ç»‡ç®¡ç†å‘˜çš„èº«ä»½æ“ä½œpeerã€‚ç¯å¢ƒå˜é‡è®¾ç½®å‚è€ƒï¼š[Fabricæµ‹è¯•ç½‘ç»œä½¿ç”¨](<a href="https://guozhe001.github.io/2021/04/01/blockchain/fabric/Fabric%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%E4%BD%BF%E7%94%A8/">https://guozhe001.github.io/2021/04/01/blockchain/fabric/Fabricæµ‹è¯•ç½‘ç»œä½¿ç”¨/</a></p><p>[)</p><h2 id="Create-an-assetï¼ˆåˆ›å»ºä¸€ä¸ªèµ„äº§ï¼‰">Create an assetï¼ˆåˆ›å»ºä¸€ä¸ªèµ„äº§ï¼‰</h2><p>Any channel member can use the smart contract to create an asset that is owned by their organization. The details of the asset will be stored in a private data collection, and can only accessed by the organization that owns the asset. A public record of the asset, its owner, and a public description is stored on the channel ledger. Any channel member can access the public ownership record to see who owns the asset, and can read the description to see if the asset is for sale.</p><p>ä»»ä½•ä¸€ä¸ªé€šé“æˆå‘˜éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ™ºèƒ½åˆçº¦æ¥åˆ›å»ºä¸€ä¸ªå±äºç»„ç»‡è‡ªå·±çš„èµ„äº§ã€‚èµ„äº§çš„è¯¦æƒ…ä¼šå­˜å‚¨åœ¨ç§æœ‰æ•°æ®é›†åˆä¸­ï¼Œå¹¶ä¸”åªèƒ½ç”±æ‹¥æœ‰èµ„äº§çš„ç»„ç»‡è®¿é—®ã€‚èµ„äº§ï¼Œå…¶æ‰€æœ‰è€…å’Œå…¬å…±æè¿°çš„å…¬å…±è®°å½•å­˜å‚¨åœ¨é€šé“è´¦æœ¬ä¸­ã€‚ä»»ä½•é€šé“æˆå‘˜éƒ½å¯ä»¥è®¿é—®å…¬å…±è®°å½•æ¥æŸ¥çœ‹è°æ‹¥æœ‰è¿™ä¸ªèµ„äº§ï¼Œå¹¶ä¸”å¯ä»¥æŸ¥çœ‹æè¿°æ¥åˆ¤æ–­èµ„äº§æ˜¯å¦åœ¨å‡ºå”®ã€‚</p><h3 id="Operate-from-the-Org1-terminalï¼ˆé€šè¿‡Org1çš„ç»ˆç«¯æ“ä½œï¼‰">Operate from the Org1 terminalï¼ˆé€šè¿‡Org1çš„ç»ˆç«¯æ“ä½œï¼‰</h3><p>Before we create the asset, we need to specify the details of what our asset will be. Issue the following command to create a JSON that will describe the asset. The <code>&quot;salt&quot;</code> parameter is a random string that would prevent another member of the channel from guessing the asset using the hash on the ledger. If there was no salt, a user could theoretically guess asset parameters until the hash of the of the guess and the hash on the ledger matched (this is known as a dictionary attack). This string is encoded in Base64 format so that it can be passed to the creation transaction as transient data.</p><p>åœ¨åˆ›å»ºèµ„äº§ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šèµ„äº§çš„è¯¦ç»†ä¿¡æ¯ã€‚é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªJSONæ¥æè¿°èµ„äº§ã€‚<code>&quot;salt&quot;</code>å‚æ•°æ˜¯ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²æ¥é˜²æ­¢é€šé“ä¸Šçš„å¦ä¸€ä¸ªæˆå‘˜é€šè¿‡è´¦æœ¬ä¸Šçš„hashå€¼æ¥çŒœæµ‹è¿™ä¸ªèµ„äº§ã€‚å¦‚æœæ²¡æœ‰ç›ï¼Œç†è®ºä¸Šç”¨æˆ·å¯ä»¥çŒœæµ‹èµ„äº§å‚æ•°ï¼Œç›´åˆ°çŒœæµ‹çš„å“ˆå¸Œå€¼å’Œè´¦æœ¬çš„å“ˆå¸Œå€¼åŒ¹é…ï¼ˆè¿™ç§°ä¸ºå­—å…¸æ”»å‡»ï¼‰ä¸ºæ­¢ã€‚è¯¥å­—ç¬¦ä¸²ä»¥Base64æ ¼å¼ç¼–ç ï¼Œå› æ­¤å¯ä»¥ä½œä¸ºä¸´æ—¶æ•°æ®ä¼ é€’ç»™åˆ›å»ºäº¤æ˜“ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export ASSET_PROPERTIES=$(echo -n &quot;&#123;\&quot;object_type\&quot;:\&quot;asset_properties\&quot;,\&quot;asset_id\&quot;:\&quot;asset1\&quot;,\&quot;color\&quot;:\&quot;blue\&quot;,\&quot;size\&quot;:35,\&quot;salt\&quot;:\&quot;a94a8fe5ccb19ba61c4c0873d391e987982fbbd3\&quot;&#125;&quot; | base64 | tr -d \\n)</span><br></pre></td></tr></table></figure><p>We can now use the following command to create a asset that belongs to Org1:</p><p>æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªå±äºOrg1ç»„ç»‡çš„èµ„äº§ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;CreateAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;, &quot;A new asset for Org1MSP&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_properties\&quot;:\&quot;$ASSET_PROPERTIES\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>We can can query the Org1 implicit data collection to see the asset that was created:</p><p>æˆ‘ä»¬å¯ä»¥æŸ¥è¯¢Org1ç»„ç»‡çš„éšç§æ•°æ®é›†åˆæ¥æŸ¥çœ‹åˆ›å»ºçš„èµ„äº§ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>When successful, the command will return the following result:</p><p>å¦‚æœæˆåŠŸï¼Œå‘½ä»¤ä¼šè¿”å›ä¸‹é¢çš„ç»“æœï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;object_type&quot;</span>: <span class="string">&quot;asset_properties&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;asset_id&quot;</span>: <span class="string">&quot;asset1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;color&quot;</span>: <span class="string">&quot;blue&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;size&quot;</span>: <span class="number">35</span>,</span><br><span class="line">  <span class="attr">&quot;salt&quot;</span>: <span class="string">&quot;a94a8fe5ccb19ba61c4c0873d391e987982fbbd3&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>We can also query the ledger to see the public ownership record:</p><p>æˆ‘ä»¬è¿˜å¯ä»¥æŸ¥è¯¢è´¦æœ¬æ¥æŸ¥çœ‹å…¬å…±è®°å½•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>The command will return the record that the asset1 is owned by Org1:</p><p>è¿™ä¸ªå‘½ä»¤ä¼šè¿”å›æ•°æ®è¯´æ˜èµ„äº§asset1å±äºOrg1ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;objectType&quot;</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assetID&quot;</span>: <span class="string">&quot;asset1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ownerOrg&quot;</span>: <span class="string">&quot;Org1MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publicDescription&quot;</span>: <span class="string">&quot;A new asset for Org1MSP&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Because the market for assets is hot, Org1 wants to flip this asset and put it up for sale. As the asset owner, Org1 can update the public description to advertise that the asset is for sale. Run the following command to change the asset description:</p><p>å› ä¸ºèµ„äº§å¸‚åœºå¾ˆçƒ­ï¼Œæ‰€ä»¥Org1å¸Œæœ›ç¿»è½¬è¯¥èµ„äº§å¹¶å°†å…¶å‡ºå”®ã€‚ä½œä¸ºèµ„äº§çš„æ‹¥æœ‰è€…ï¼ŒOrg1ç»„ç»‡å¯ä»¥æ›´æ–°å…¬å…±æè¿°æ¥å¹¿å‘Šè¯´èµ„äº§åœ¨å‡ºå”®ã€‚è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æ›´æ–°èµ„äº§æè¿°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset1&quot;,&quot;This asset is for sale&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>Query the ledger again to see the updated description:</p><p>é‡æ–°æŸ¥è¯¢è´¦æœ¬æ¥æŸ¥çœ‹æ›´æ–°åçš„æè¿°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>We can now see that the asset is for sale:</p><p>æˆ‘ä»¬ç°åœ¨å¯ä»¥çœ‹åˆ°è¿™ä¸ªèµ„äº§åœ¨å‡ºå”®ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;objectType&quot;</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assetID&quot;</span>: <span class="string">&quot;asset1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ownerOrg&quot;</span>: <span class="string">&quot;Org1MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publicDescription&quot;</span>: <span class="string">&quot;This asset is for sale&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/transfer_assets_1.png" alt="transfer_assets_1"></p><p><em>Figure 1: When Org1 creates an asset that they own, the asset details are stored in the Org1 implicit data collection on the Org1 peer. The public ownership record is stored in the channel world state, and is stored on both the Org1 and Org2 peers. A hash of the asset key and a hash the asset details are also visible in the channel world state and are stored on the peers of both organizations.</em></p><p><em>å›¾ç‰‡1:å½“ç»„ç»‡Org1åˆ›å»ºäº†ä¸€ä¸ªå±äºä»–ä»¬çš„èµ„äº§æ—¶ï¼Œèµ„äº§çš„ç»†èŠ‚ä¿å­˜åœ¨å±äºç»„ç»‡Org1çš„peerçš„éšå¼æ•°æ®é›†åˆä¸­ã€‚å…¬å…±çš„è®°å½•è¢«ä¿å­˜åœ¨é€šé“çš„ä¸–ç•ŒçŠ¶æ€ï¼Œå¹¶ä¸”ä¿å­˜åœ¨ç»„ç»‡Org1å’ŒOrg2çš„peerèŠ‚ç‚¹ã€‚èµ„äº§çš„keyçš„hashå’Œèµ„äº§è¯¦æƒ…çš„hashåœ¨é€šé“çš„ä¸–ç•ŒçŠ¶æ€æ˜¯å¯è®¿é—®çš„ï¼Œå¹¶ä¸”å­˜å‚¨åœ¨æ‰€æœ‰ç»„ç»‡çš„peerèŠ‚ç‚¹ã€‚</em></p><h3 id="Operate-from-the-Org2-terminalï¼ˆé€šè¿‡ç»„ç»‡Org2çš„ç»ˆç«¯æ“ä½œï¼‰">Operate from the Org2 terminalï¼ˆé€šè¿‡ç»„ç»‡Org2çš„ç»ˆç«¯æ“ä½œï¼‰</h3><p>If we operate from the Org2 terminal, we can use the smart contract query the public asset data:</p><p>å¦‚æœæˆ‘ä»¬é€šè¿‡ç»„ç»‡Org2çš„ç»ˆç«¯æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ™ºèƒ½åˆçº¦æ¥æŸ¥è¯¢å…¬å…±çš„èµ„äº§æ•°æ®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>From this query, Org2 learns that asset1 is for saleï¼ˆé€šè¿‡è¿™ä¸ªæŸ¥è¯¢ï¼Œç»„ç»‡Org2çŸ¥é“äº†èµ„äº§asset1æ­£åœ¨å‡ºå”®ï¼‰:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;objectType&quot;</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assetID&quot;</span>: <span class="string">&quot;asset1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ownerOrg&quot;</span>: <span class="string">&quot;Org1MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publicDescription&quot;</span>: <span class="string">&quot;This asset is for sale&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>In a real chaincode you may want to query for all assets for sale, by using a JSON query, or by creating a different sale key and using a key range query to find the assets currently for sale.</em> Any changes to the public description of the asset owned by Org1 needs to be endorsed by Org1. The endorsement policy is reinforced by an access control policy within the chaincode that any update needs to be submitted by the organization that owns the asset. Lets see what happens if Org2 tried to change the public description as a prank:</p><p>*åœ¨çœŸå®çš„é“¾ç ä¸­ï¼Œæ‚¨å¯èƒ½å¸Œæœ›é€šè¿‡ä½¿ç”¨JSONæŸ¥è¯¢æˆ–é€šè¿‡åˆ›å»ºå…¶ä»–é”€å”®å¯†é’¥å¹¶ä½¿ç”¨å¯†é’¥çš„èŒƒå›´æ¥æŸ¥æ‰¾å½“å‰å¾…å”®èµ„äº§ï¼Œä»¥æŸ¥è¯¢æ‰€æœ‰å¾…å”®èµ„äº§ã€‚*æ‰€æœ‰å±äºç»„ç»‡Org1çš„èµ„äº§çš„å…¬å…±æè¿°åœ¨è¿›è¡Œä»»ä½•æ›´æ”¹æ—¶éƒ½å¿…é¡»å¾—åˆ°ç»„ç»‡Org1çš„è®¤å¯ã€‚é“¾ç ä¸­çš„è®¿é—®æ§åˆ¶ç­–ç•¥åŠ å¼ºäº†èƒŒä¹¦ç­–ç•¥ï¼Œä»»ä½•æ›´æ–°éƒ½å¿…é¡»ç”±æ¥è‡ªäºèµ„äº§æ‹¥æœ‰è€…çš„ç»„ç»‡æ¥æäº¤ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚æœOrg2è¯•å›¾ä»¥æ¶ä½œå‰§æ–¹å¼æ›´æ”¹å…¬å…±æè¿°ä¼šå‘ç”Ÿä»€ä¹ˆï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset1&quot;,&quot;the worst asset&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>The smart contract does not allow Org2 to access the public description of the asset.</p><p>æ™ºèƒ½åˆçº¦ä¸å…è®¸ç»„ç»‡Org2è®¿é—®è¿™ä¸ªèµ„äº§çš„å…¬å…±æè¿°ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: endorsement failure during invoke. response: status:500 message:&quot;a client from Org2MSP cannot update the description of a asset owned by Org1MSP&quot;</span><br></pre></td></tr></table></figure><h2 id="Agree-to-sell-the-asset-å…è®¸å‡ºå”®èµ„äº§">Agree to sell the asset(å…è®¸å‡ºå”®èµ„äº§)</h2><p>To sell an asset, both the buyer and the seller must agree on an asset price. Each party stores the price that they agree to in their own private data collection. The private asset transfer smart contract enforces that both parties need to agree to the same price before the asset can be transferred.</p><p>ä¸ºäº†å‡ºå”®èµ„äº§ã€‚ä¹°å–åŒæ–¹éƒ½å¿…é¡»åŒæ„ç›¸åŒçš„èµ„äº§ä»·æ ¼ã€‚æ¯ä¸€æ–¹éƒ½éœ€è¦åœ¨ä»–ä»¬çš„ç§æœ‰æ•°æ®é›†åˆä¸­ä¿å­˜ä»–ä»¬åŒæ„çš„ä»·æ ¼ã€‚ç§æœ‰èµ„äº§äº¤æ˜“æ™ºèƒ½åˆçº¦å¼ºåˆ¶åŒæ–¹å¿…é¡»åŒæ„ç›¸åŒçš„ä»·æ ¼æ‰èƒ½è½¬è®©èµ„äº§ã€‚</p><h2 id="Agree-to-sell-as-Org1ï¼ˆä»¥Org1çš„èº«ä»½åŒæ„å‡ºå”®ï¼‰">Agree to sell as Org1ï¼ˆä»¥Org1çš„èº«ä»½åŒæ„å‡ºå”®ï¼‰</h2><p>Operate from the Org1 terminal. Org1 will agree to set the asset price as 110 dollars. The <code>trade_id</code> is used as salt to prevent a channel member that is not a buyer or a seller from guessing the price. This value needs to be passed out of band, through email or other communication, between the buyer and the seller. The buyer and the seller can also add salt to the asset key to prevent other members of the channel from guessing which asset is for sale.</p><p>é€šè¿‡ç»„ç»‡Org1çš„ç»ˆç«¯è¿›è¡Œæ“ä½œã€‚Org1åŒæ„å°†èµ„äº§ä»·æ ¼è®¾ç½®ä¸º110ç¾å…ƒã€‚trade_idç”¨ä½œç›ä»¥é˜²æ­¢ä¸æ˜¯ä¹°å®¶æˆ–å–å®¶çš„é€šé“æˆå‘˜çŒœæµ‹ä»·æ ¼ã€‚è¿™ä¸ªä»·æ ¼éœ€è¦é€šè¿‡ä¹°å–åŒæ–¹ä¹‹é—´ä»¥ç”µå­é‚®ä»¶æˆ–å…¶ä»–é€šä¿¡æ–¹å¼åœ¨è´¦æœ¬å¤–ä¼ é€’ã€‚ä¹°å–åŒæ–¹è¿˜å¯ä»¥å¯¹èµ„äº§çš„keyè¿›è¡Œâ€œåŠ ç›â€ï¼Œä»¥é˜²æ­¢æ¸ é“çš„å…¶ä»–æˆå‘˜çŒœæµ‹è¦å‡ºå”®çš„èµ„äº§ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ASSET_PRICE=$(echo -n &quot;&#123;\&quot;asset_id\&quot;:\&quot;asset1\&quot;,\&quot;trade_id\&quot;:\&quot;109f4b3c50d7b0df729d299bc6f8e9ef9066971f\&quot;,\&quot;price\&quot;:110&#125;&quot; | base64)</span><br><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToSell&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_price\&quot;:\&quot;$ASSET_PRICE\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>We can query the Org1 private data collection to read the agreed to selling price:</p><p>æˆ‘ä»¬å¯ä»¥æŸ¥è¯¢ç»„ç»‡Org1çš„ç§æœ‰æ•°æ®é›†åˆæ¥è¯»å–åŒæ„çš„é”€å”®ä»·æ ¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetSalesPrice&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><h2 id="Agree-to-buy-as-Org2-ä»¥Org2çš„èº«ä»½åŒæ„è´­ä¹°">Agree to buy as Org2(ä»¥Org2çš„èº«ä»½åŒæ„è´­ä¹°)</h2><p>Operate from the Org2 terminal. Run the following command to verify the asset properties before agreeing to buy. The asset properties and salt would be passed out of band, through email or other communication, between the buyer and seller.</p><p>é€šè¿‡Org2çš„ç»ˆç«¯æ“ä½œã€‚è¿è¡Œä¸‹é¢çš„å‘½ä»¤åœ¨åŒæ„è´­ä¹°ä¹‹å‰éªŒè¯èµ„äº§çš„å±æ€§ã€‚èµ„äº§çš„å±æ€§å’Œç›ä¼šåœ¨åŒºå—é“¾è´¦æœ¬å¤–åœ¨ä¹°å–åŒæ–¹ä¹‹é—´é€šè¿‡é‚®ä»¶æˆ–è€…å…¶ä»–æ–¹å¼è¿›è¡Œä¼ é€’ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ASSET_PROPERTIES=$(echo -n &quot;&#123;\&quot;object_type\&quot;:\&quot;asset_properties\&quot;,\&quot;asset_id\&quot;:\&quot;asset1\&quot;,\&quot;color\&quot;:\&quot;blue\&quot;,\&quot;size\&quot;:35,\&quot;salt\&quot;:\&quot;a94a8fe5ccb19ba61c4c0873d391e987982fbbd3\&quot;&#125;&quot; | base64)</span><br><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;VerifyAssetProperties&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_properties\&quot;:\&quot;$ASSET_PROPERTIES\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>Run the following command to agree to buy asset1 for 100 dollars. As of now, Org2 will agree to a different price than Org2. Donâ€™t worry, the two organizations will agree to the same price in a future step. However, we we can use this temporary disagreement as a test of what happens if the buyer and the seller agree to a different price. Org2 needs to use the same <code>trade_id</code> as Org1.</p><p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥åŒæ„ä»¥100åˆ€çš„ä»·æ ¼è´­ä¹°asset1ã€‚ç°åœ¨Org2åŒæ„äº†ä¸€ä¸ªä¸Org1ä¸åŒçš„ä»·æ ¼ã€‚ä¸è¦æ‹…å¿ƒï¼Œè¿™ä¸¤ä¸ªç»„ç»‡ä¼šåœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤åŒæ„ç›¸åŒçš„ä»·æ ¼ã€‚ä½†æ˜¯æˆ‘ä»¬é€šè¿‡ä¸´æ—¶çš„åˆ†æ­§æ¥æµ‹è¯•å¦‚æœä¹°æ–¹å’Œå–æ–¹åŒæ„äº†ä¸åŒçš„ä»·æ ¼å°†ä¼šå‘ç”Ÿä»€ä¹ˆã€‚Org2éœ€è¦ä½¿ç”¨ä¸Org1ç›¸åŒçš„ <code>trade_id</code> ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ASSET_PRICE=$(echo -n &quot;&#123;\&quot;asset_id\&quot;:\&quot;asset1\&quot;,\&quot;trade_id\&quot;:\&quot;109f4b3c50d7b0df729d299bc6f8e9ef9066971f\&quot;,\&quot;price\&quot;:100&#125;&quot; | base64)</span><br><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToBuy&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_price\&quot;:\&quot;$ASSET_PRICE\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>You can read the agreed purchase price from the Org2 implicit data collection:</p><p>æ‚¨å¯ä»¥ä»Org2éšå¼æ•°æ®é›†åˆä¸­è¯»å–çº¦å®šçš„è´­ä¹°ä»·æ ¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetBidPrice&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/transfer_assets_2.png" alt="transfer_assets_2"></p><p><em>Figure 2: After Org1 and Org2 agree to transfer the asset, the price agreed to by each organization is stored in their private data collections. A composite key for the seller and the buyer is used to prevent a collision with the asset details and asset ownership record. The price that is agreed to is only stored on the peers of each organization. However, the hash of both agreements is stored in the channel world state on every peer joined to the channel.</em></p><p><em>å›¾2:åœ¨Org1å’ŒOrg2åŒæ„äº¤æ˜“è¿™ä¸ªèµ„äº§ï¼Œæ¯ä¸ªç»„ç»‡çš„åŒæ„çš„ä»·æ ¼è¢«å­˜å‚¨åœ¨ä»–ä»¬çš„ç§æœ‰æ•°æ®é›†åˆä¸­ã€‚ä¹°å–åŒæ–¹çš„ç»„åˆé”®ç”¨äºé˜²æ­¢ä¸èµ„äº§è¯¦ç»†ä¿¡æ¯å’Œèµ„äº§æ‰€æœ‰æƒè®°å½•å‘ç”Ÿå†²çªã€‚å·²ç»åŒæ„çš„ä»·æ ¼åªæ˜¯å­˜å‚¨åœ¨åŒæ–¹ç»„ç»‡çš„peerèŠ‚ç‚¹ã€‚ä½†æ˜¯ä¸¤ä¸ªåè®®çš„hashå€¼è¢«å­˜å‚¨åœ¨åŠ å…¥é€šé“çš„æ‰€æœ‰peerèŠ‚ç‚¹çš„é€šé“çš„ä¸–ç•ŒçŠ¶æ€ä¸­ã€‚</em></p><h2 id="Transfer-the-asset-from-Org1-to-Org2ï¼ˆæŠŠèµ„äº§ä»Org1äº¤æ˜“åˆ°Org2ï¼‰">Transfer the asset from Org1 to Org2ï¼ˆæŠŠèµ„äº§ä»Org1äº¤æ˜“åˆ°Org2ï¼‰</h2><p>After both organizations have agreed to their price, Org1 can attempt to transfer the asset to Org2. The private asset transfer function in the smart contract uses the hash on the ledger to check that both organizations have agreed to the same price. The function will also use the hash of the private asset details to check that the asset that is transferred is the same asset that Org1 owns.</p><p>åœ¨åŒæ–¹ç»„ç»‡éƒ½åŒæ„äº†ä»–ä»¬çš„ä»·æ ¼ä¹‹åï¼ŒOrg1å¯ä»¥å°è¯•å°†èµ„äº§äº¤æ˜“ç»™Org2ã€‚åœ¨æ™ºèƒ½åˆçº¦ä¸­çš„ç§æœ‰èµ„äº§äº¤æ˜“æ–¹æ³•ä½¿ç”¨è´¦æœ¬ä¸Šçš„hashæ¥æ£€æŸ¥ä¸¤ä¸ªç»„ç»‡æ˜¯å¦åŒæ„äº†ç›¸åŒçš„ä»·æ ¼ã€‚è¿™ä¸ªæ–¹æ³•ä¹Ÿä¼šä½¿ç”¨ç§æœ‰èµ„äº§è¯¦æƒ…çš„hashå€¼æ¥æ£€æŸ¥è¢«äº¤æ˜“çš„èµ„äº§ä¸å±äºOrg1çš„èµ„äº§æ˜¯åŒä¸€ç¬”èµ„äº§ã€‚</p><h3 id="Transfer-the-asset-as-Org1ï¼ˆä»¥Org1çš„èº«ä»½äº¤æ˜“èµ„äº§ï¼‰">Transfer the asset as Org1ï¼ˆä»¥Org1çš„èº«ä»½äº¤æ˜“èµ„äº§ï¼‰</h3><p>Operate from the Org1 terminal. The owner of the asset needs to initiate the transfer. Note that the command below uses the <code>--peerAddresses</code> flag to target the peers of both Org1 and Org2. Both organizations need to endorse the transfer. <em>Also note that the asset properties and price are passed in the transfer request as transient properties. These are passed so that the current owner can be sure that the correct asset is transferred for the correct price. These properties will be checked against the on-chain hashes by both endorsers.</em></p><p>é€šè¿‡Org1çš„ç»ˆç«¯æ“ä½œã€‚èµ„äº§çš„æ‰€æœ‰è€…éœ€è¦å‘èµ·è¿™ä¸ªäº¤æ˜“ã€‚æ³¨æ„ä¸‹é¢çš„å‘½ä»¤ä½¿ç”¨<code>--peerAddresses</code> æ ‡å¿—æ¥æŒ‡å®šOrg1å’ŒOrg2çš„peerèŠ‚ç‚¹ã€‚ä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦ç¡®è®¤è¿™ä¸ªäº¤æ˜“ã€‚<em>å¦å¤–è¯·æ³¨æ„ï¼Œèµ„äº§å±æ€§å’Œä»·æ ¼åœ¨äº¤æ˜“è¯·æ±‚ä¸­ä½œä¸ºä¸´æ—¶å±æ€§ä¼ é€’ã€‚ä¼ é€’è¿™äº›æ˜¯ä¸ºäº†å½“å‰çš„æ‹¥æœ‰è€…å¯ä»¥ç¡®ä¿ä»¥å½“å‰çš„ä»·æ ¼æ¥è½¬è®©å½“å‰çš„èµ„äº§ã€‚ä¸¤ä¸ªèƒŒä¹¦è€…å°†å¯¹ç…§é“¾ä¸Šå“ˆå¸Œæ£€æŸ¥è¿™äº›å±æ€§ã€‚</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;TransferAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;,&quot;Org2MSP&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_properties\&quot;:\&quot;$ASSET_PROPERTIES\&quot;,\&quot;asset_price\&quot;:\&quot;$ASSET_PRICE\&quot;&#125;&quot; --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>Because the two organizations have not agreed to the same price, the transfer cannot be completed:</p><p>å› ä¸ºä¸¤ä¸ªç»„ç»‡åŒæ„çš„ä»·æ ¼ä¸ä¸€è‡´ï¼Œè¿™ä¸ªäº¤æ˜“ä¸èƒ½å®Œæˆï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: endorsement failure during invoke. response: status:500 message:&quot;failed transfer verification: hash 0fc413250501855af7c9896af00993b973510995fb10d56cddbb85ca47bd5dba for passed price JSON &#123;\&quot;asset_id\&quot;:\&quot;asset1\&quot;,\&quot;trade_id\&quot;:\&quot;109f4b3c50d7b0df729d299bc6f8e9ef9066971f\&quot;,\&quot;price\&quot;:110&#125; does not match on-chain hash 84b0d57eaa5c77076483ae8f482c96a64912c47df5541451e94fb7698bf37ee9, buyer hasn&#x27;t agreed to the passed trade id and price&quot;</span><br></pre></td></tr></table></figure><p>As a result, Org1 and Org2 come to a new agreement on the price at which the asset will be purchased. Org1 drops the price of the asset to 100:</p><p>ç»“æœï¼ŒOrg1å’ŒOrg2å°±è´­ä¹°èµ„äº§çš„ä»·æ ¼è¾¾æˆäº†æ–°åè®®ã€‚ Org1å°†èµ„äº§ä»·æ ¼é™è‡³100ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export ASSET_PRICE=$(echo -n &quot;&#123;\&quot;asset_id\&quot;:\&quot;asset1\&quot;,\&quot;trade_id\&quot;:\&quot;109f4b3c50d7b0df729d299bc6f8e9ef9066971f\&quot;,\&quot;price\&quot;:100&#125;&quot; | base64)</span><br><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToSell&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_price\&quot;:\&quot;$ASSET_PRICE\&quot;&#125;&quot;</span><br></pre></td></tr></table></figure><p>Now that the buyer and seller have agreed to the same price, Org1 can transfer the asset to Org2.</p><p>ç°åœ¨ä¹°å–åŒæ–¹å·²ç»åŒæ„äº†ç›¸åŒçš„ä»·æ ¼ï¼ŒOrg1å¯ä»¥å°†èµ„äº§äº¤æ˜“ç»™Org2ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;TransferAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;,&quot;Org2MSP&quot;]&#125;&#x27; --transient &quot;&#123;\&quot;asset_properties\&quot;:\&quot;$ASSET_PROPERTIES\&quot;,\&quot;asset_price\&quot;:\&quot;$ASSET_PRICE\&quot;&#125;&quot; --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>You can query the asset ownership record to verify that the transfer was successful.</p><p>ä½ å¯ä»¥æŸ¥è¯¢èµ„äº§çš„å½’å±ä¿¡æ¯æ¥éªŒè¯äº¤æ˜“å·²ç»æˆåŠŸ.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>The record now lists Org2 as the asset owner:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;objectType&quot;</span>: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assetID&quot;</span>: <span class="string">&quot;asset1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ownerOrg&quot;</span>: <span class="string">&quot;Org2MSP&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;publicDescription&quot;</span>: <span class="string">&quot;This asset is for sale&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/transfer_assets_3.png" alt="transfer_assets_3"></p><p><em>Figure 3: After the asset is transferred, the asset details are placed in the Org2 implicit data collection and deleted from the Org1 implicit data collection. As a result, the asset details are now only stored on the Org2 peer. The asset ownership record on the ledger is updated to reflect that the asset is owned by Org1.</em></p><p><em>å›¾3:åœ¨èµ„äº§äº¤æ˜“ä¹‹åï¼Œèµ„äº§ç»†èŠ‚å­˜åœ¨äºOrg2çš„éšå¼æ•°æ®é›†åˆå¹¶ä¸”ä»Org1çš„éšå¼æ•°æ®é›†åˆä¸­è¢«åˆ é™¤ã€‚ç»“æœï¼Œèµ„äº§çš„ç§æœ‰ä¿¡æ¯å€¼ä¿å­˜åœ¨Org2çš„peerèŠ‚ç‚¹ã€‚åœ¨è´¦æœ¬ä¸Šçš„èµ„äº§çš„å½’å±ä¿¡æ¯ä¹Ÿè¢«æ›´æ–°ï¼Œä»¥åæ˜ èµ„äº§å½’Org2æ‰€æœ‰ã€‚</em></p><h3 id="Update-the-asset-description-as-Org2ï¼ˆä»¥Org2çš„èº«ä»½æ›´æ–°èµ„äº§æè¿°ï¼‰">Update the asset description as Org2ï¼ˆä»¥Org2çš„èº«ä»½æ›´æ–°èµ„äº§æè¿°ï¼‰</h3><p>Operate from the Org2 terminal. Now that Org2 owns the asset, we can read the asset details from the Org2 implicit data collection:</p><p>é€šè¿‡Org2çš„ç»ˆç«¯æ“ä½œï¼Œç°åœ¨Org2æ‹¥æœ‰è¿™ä¸ªèµ„äº§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Org2çš„éšå¼æ•°æ®é›†åˆè¯»å–èµ„äº§çš„è¯¦æƒ…ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>Org2 can now update the asset public descriptionï¼ˆOrg2ç°åœ¨å¯ä»¥æ›´æ–°èµ„äº§çš„å…¬å…±æè¿°ï¼‰:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset1&quot;,&quot;This asset is not for sale&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>Query the ledger to verify that the asset is no longer for sale:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><h2 id="Clean-up">Clean up</h2><p>When you are finished transferring assets, you can bring down the test network. The command will remove all the nodes of the test network, and delete any ledger data that you created:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;network.sh down</span><br></pre></td></tr></table></figure><h2 id="æµç¨‹å›¾">æµç¨‹å›¾</h2><p>è‡ªå·±çš„ç†è§£ç”»çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š</p><p><img src="/2021/04/01/blockchain/fabric/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/apple/Desktop/%E7%A7%81%E6%9C%89%E6%95%B0%E6%8D%AE%E4%BA%A4%E6%98%93%E5%90%88%E7%BA%A6%E6%B5%81%E7%A8%8B%E5%9B%BE.jpg" alt="ç§æœ‰æ•°æ®äº¤æ˜“æµç¨‹å›¾"></p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> Secured </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ›å»ºä¸€ä¸ªæ–°çš„channel</title>
      <link href="2021/04/01/blockchain/fabric/%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84channel/"/>
      <url>2021/04/01/blockchain/fabric/%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84channel/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ›å»ºä¸€ä¸ªæ–°çš„channel">åˆ›å»ºä¸€ä¸ªæ–°çš„channel</h1><p><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/create_channel/create_channel.html">å®˜æ–¹æ–‡æ¡£</a></p><p>You can use this tutorial to learn how to create new channels using the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/configtxgen.html">configtxgen</a> CLI tool and then use the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerchannel.html">peer channel</a> commands to join a channel with your peers. While this tutorial will leverage the Fabric test network to create the new channel, the steps in this tutorial can also be used by network operators in a production environment.</p><p>ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªæ•™ç¨‹æ¥å­¦ä¹ é€šè¿‡ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/configtxgen.html">configtxgen</a>CLIå·¥å…·æ¥åˆ›å»ºæ–°çš„é€šé“ï¼Œç„¶åé€šè¿‡ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerchannel.html">peer channel</a> å‘½ä»¤å°†peerèŠ‚ç‚¹åŠ å…¥é€šé“ã€‚å°½ç®¡æœ¬æ•™ç¨‹å°†åˆ©ç”¨Fabricæµ‹è¯•ç½‘ç»œæ¥åˆ›å»ºæ–°æ¸ é“ï¼Œç½‘ç»œæ“ä½œäººå‘˜ä¹Ÿå¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æœ¬æ•™ç¨‹ä¸­çš„æ­¥éª¤ã€‚</p><p>In the process of creating the channel, this tutorial will take you through the following steps and concepts:</p><p>åœ¨åˆ›å»ºé¢‘é“çš„è¿‡ç¨‹ä¸­ï¼Œæœ¬æ•™ç¨‹å°†å¸¦æ‚¨å®Œæˆä»¥ä¸‹æ­¥éª¤å’Œæ¦‚å¿µï¼š</p><ul><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/create_channel/create_channel.html#setting-up-the-configtxgen-tool">Setting up the configtxgen tool</a>ï¼šè®¾ç½®configtxgenå·¥å…·</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/create_channel/create_channel.html#the-configtx-yaml-file">Using the configtx.yaml file</a>ï¼šä½¿ç”¨configtx.yamlé…ç½®æ–‡ä»¶</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/create_channel/create_channel.html#the-orderer-system-channel">The orderer system channel</a>ï¼šæ’åºçš„ç³»ç»Ÿé€šé“ä»‹ç»</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/create_channel/create_channel.html#creating-an-application-channel">Creating an application channel</a>ï¼šåˆ›å»ºä¸€ä¸ªåº”ç”¨é€šé“</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/create_channel/create_channel.html#join-peers-to-the-channel">Joining peers to the channel</a>ï¼šå°†peerèŠ‚ç‚¹åŠ å…¥é€šé“</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/create_channel/create_channel.html#set-anchor-peers">Setting anchor peers</a>ï¼šè®¾ç½®é”šèŠ‚ç‚¹</li></ul><h3 id="Setting-up-the-configtxgen-toolï¼ˆè®¾ç½®configtxgenå·¥å…·ï¼‰">Setting up the configtxgen toolï¼ˆè®¾ç½®configtxgenå·¥å…·ï¼‰</h3><p>Channels are created by building a channel creation transaction and submitting the transaction to the ordering service. The channel creation transaction specifies the initial configuration of the channel and is used by the ordering service to write the channel genesis block. While it is possible to build the channel creation transaction file manually, it is easier to use the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/configtxgen.html">configtxgen</a> tool. The tool works by reading a <code>configtx.yaml</code> file that defines the configuration of your channel, and then writing the relevant information into the channel creation transaction. Before we discuss the <code>configtx.yaml</code> file in the next section, we can get started by downloading and setting up the <code>configtxgen</code> tool.</p><p>é€šé“çš„åˆ›å»ºæ˜¯é€šè¿‡æ„å»ºä¸€ä¸ªåˆ›å»ºé€šé“çš„äº¤æ˜“ç„¶åå°†æ­¤äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡æ¥å®Œæˆçš„ã€‚â€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€æŒ‡æ˜äº†æ­¤é€šé“çš„åˆå§‹åŒ–é…ç½®å¹¶ä¸”ç”±æ’åºæœåŠ¡å†™å…¥é€šé“çš„åˆ›ä¸–çºªåŒºå—ä¸­ã€‚å°½ç®¡å¯ä»¥æ‰‹åŠ¨æ„å»ºâ€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€ï¼Œä½†ä½¿ç”¨configtxgenå·¥å…·æ›´å®¹æ˜“ã€‚configtxgenå·¥å…·è¯»å–å®šä¹‰äº†channleé…ç½®çš„<code>configtx.yaml</code>æ–‡ä»¶ï¼Œç„¶åå°†ç›¸å…³ä¿¡æ¯å†™å…¥â€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€ä¸­ã€‚åœ¨æˆ‘ä»¬è®¨è®º <code>configtx.yaml</code> æ–‡ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¼€å§‹ä¸‹è½½å¹¶è®¾ç½®<code>configtxgen</code> å·¥å…·ã€‚</p><p>You can download the <code>configtxgen</code> binaries by following the steps to <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/install.html">install the samples, binaries and Docker images</a>. <code>configtxgen</code> will be downloaded to the <code>bin</code> folder of your local clone of the <code>fabric-samples</code> repository along with other Fabric tools.</p><p>ä½ å¯ä»¥è·Ÿç€ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/install.html">install the samples, binaries and Docker images</a>çš„æ­¥éª¤æ¥ä¸‹è½½ <code>configtxgen</code> ã€‚ <code>configtxgen</code> ä¼šä¸‹è½½åˆ°<code>fabric-samples</code>ä»“åº“çš„<code>bin</code>ç›®å½•ä¸‹ã€‚</p><p>For the purposes of this tutorial, we will want to operate from the <code>test-network</code> directory inside <code>fabric-samples</code>. Navigate to that directory using the following command:</p><p>ä¸ºäº†æœ¬æ•™ç¨‹çš„ç›®çš„ï¼Œæˆ‘ä»¬ä¼šæƒ³è¦åœ¨<code>fabric-samples</code>ä¸‹é¢çš„ <code>test-network</code> ç›®å½•ä¸‹è¿›è¡Œæ“ä½œï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åˆ‡æ¢åˆ°æ­¤ç›®å½•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd fabric-samples/test-network</span><br></pre></td></tr></table></figure><p>We will operate from the <code>test-network</code> directory for the remainder of the tutorial. Use the following command to add the configtxgen tool to your CLI path:</p><p>åœ¨æœ¬æ•™ç¨‹çš„å…¶ä½™éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ä»test-networkç›®å½•è¿›è¡Œæ“ä½œã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†configtxgenå·¥å…·æ·»åŠ åˆ°æ‚¨çš„CLIè·¯å¾„ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$&#123;PWD&#125;/../bin:$PATH</span><br></pre></td></tr></table></figure><p>In order to use <code>configtxgen</code>, you need to the set the <code>FABRIC_CFG_PATH</code> environment variable to the path of the directory that contains your local copy of the <code>configtx.yaml</code> file. For this tutorial, we will reference the <code>configtx.yaml</code> used to setup the Fabric test network in the <code>configtx</code> folder:</p><p>ä¸ºäº†ä½¿ç”¨<code>configtxgen</code>ï¼Œæ‚¨éœ€è¦å°†<code>FABRIC_CFG_PATH</code>ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºåŒ…å«<code>configtx.yaml</code>çš„æœ¬åœ°ç›®å½•ã€‚å¯¹äºæœ¬æ•™ç¨‹ï¼Œæˆ‘ä»¬å°†åœ¨æ­¤ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºåœ¨Fabric test networkç›®å½•ä¸‹çš„åŒ…å«<code>configtx.yaml</code>çš„<code>configtx</code> ç›®å½•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export FABRIC_CFG_PATH=$&#123;PWD&#125;/configtx</span><br></pre></td></tr></table></figure><p>You can check that you can are able to use the tool by printing the <code>configtxgen</code> help text:</p><p>ä½ å¯ä»¥é€šè¿‡æ‰“å° <code>configtxgen</code>å·¥å…·çš„helpæ¥æ£€æŸ¥æ˜¯å¦å·²ç»è®¾ç½®å¥½:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configtxgen --help</span><br></pre></td></tr></table></figure><h2 id="The-configtx-yaml-fileï¼ˆconfigtx-yamlæ–‡ä»¶ï¼‰">The configtx.yaml fileï¼ˆconfigtx.yamlæ–‡ä»¶ï¼‰</h2><p>The <code>configtx.yaml</code> file specifies the <strong>channel configuration</strong> of new channels. The information that is required to build the channel configuration is specified in a readable and editable form in the <code>configtx.yaml</code> file. The <code>configtxgen</code> tool uses the channel profiles defined in the <code>configtx.yaml</code> file to create the channel configuration and write it to the <a href="https://developers.google.com/protocol-buffers">protobuf format</a> that can be read by Fabric.</p><p><code>configtx.yaml</code> æ–‡ä»¶æŒ‡æ˜äº†ä¸€ä¸ªæ–°çš„é€šé“çš„é€šé“é…ç½®ã€‚åœ¨<code>configtx.yaml</code>æ–‡ä»¶ä¸­å¯ä»¥è¯»å–å’Œç¼–è¾‘æ„å»ºé€šé“é…ç½®æ‰€éœ€çš„ä¿¡æ¯ã€‚ <code>configtxgen</code> å·¥å…·é€šè¿‡ä½¿ç”¨ <code>configtx.yaml</code>æ–‡ä»¶ä¸­çš„é€šé“å±æ€§çš„å®šä¹‰æ¥åˆ›å»ºé€šé“é…ç½®ï¼Œå¹¶å°†å…¶å†™å…¥å¯ç”±Fabricè¯»å–çš„ <a href="https://developers.google.com/protocol-buffers">protobufæ ¼å¼</a>ã€‚</p><p>You can find the <code>configtx.yaml</code> file that is used to deploy the test network in the <code>configtx</code> folder in the <code>test-network</code> directory. The file contains the following information that we will use to create our new channel:</p><p>ä½ å¯ä»¥åœ¨<code>test-network</code>ç›®å½•çš„<code>configtx</code> æ–‡ä»¶å¤¹ä¸‹é¢çœ‹åˆ° <code>configtx.yaml</code> æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åŒ…å«åœ¨åˆ›å»ºæ–°é€šé“æ—¶ä¼šç”¨åˆ°çš„ä¸‹é¢çš„ä¿¡æ¯ï¼š</p><ul><li><p><strong>Organizations:</strong> The organizations that can become members of your channel. Each organization has a reference to the cryptographic material that is used to build the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/membership/membership.html">channel MSP</a>.</p><ul><li>å¯ä»¥æˆä¸ºä½ çš„é€šé“æˆå‘˜çš„ç»„ç»‡ä¿¡æ¯ï¼Œæ¯ä¸€ä¸ªç»„ç»‡éƒ½æœ‰å¯¹ç”¨äºæ„å»º<a href="%5D(https://hyperledger-fabric.readthedocs.io/en/release-2.2/membership/membership.html)">é€šé“MSP</a>çš„åŠ å¯†ææ–™çš„å¼•ç”¨ã€‚</li></ul></li><li><p><strong>Ordering service:</strong> Which ordering nodes will form the ordering service of the network, and consensus method they will use to agree to a common order of transactions. The file also contains the organizations that will become the ordering service administrators.</p><ul><li>å“ªäº›æ’åºèŠ‚ç‚¹å°†å½¢æˆç½‘ç»œä¸­çš„æ’åºæœåŠ¡ï¼Œä»¥åŠå®ƒä»¬ç”¨äºåŒæ„äº¤æ˜“é¡ºåºçš„å…±è¯†æ–¹æ³•ã€‚æ­¤æ–‡ä»¶è¿˜åŒ…å«äº†ä¼šæˆä¸ºæ’åºæœåŠ¡ç®¡ç†å‘˜çš„ç»„ç»‡çš„ä¿¡æ¯ã€‚</li></ul></li><li><p><strong>Channel policiesï¼š</strong> Different sections of the file work together to define the policies that will govern how organizations interact with the channel and which organizations need to approve channel updates. For the purposes of this tutorial, we will use the default policies used by Fabric.</p><ul><li>æ–‡ä»¶çš„ä¸åŒéƒ¨åˆ†ä¸€èµ·å®šä¹‰é€šé“ç­–ç•¥ï¼Œè¿™äº›ç­–ç•¥å°†æ§åˆ¶ç»„ç»‡ä¸é€šé“çš„äº¤äº’æ–¹å¼ä»¥åŠå“ªäº›ç»„ç»‡éœ€è¦æ‰¹å‡†æ¸ é“æ›´æ–°ã€‚å°±æœ¬æ•™ç¨‹è€Œè¨€ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Fabricä½¿ç”¨çš„é»˜è®¤ç­–ç•¥ã€‚</li></ul></li><li><p><strong>Channel profiles</strong> Each channel profile references information from other sections of the <code>configtx.yaml</code> file to build a channel configuration. The profiles are used the create the genesis block of the orderer system channel and the channels that will be used by peer organizations. To distinguish them from the system channel, the channels used by peer organizations are often referred to as application channels.</p><ul><li>æ¯ä¸ªé€šé“çš„é…ç½®ä¿¡æ¯éƒ½å¼•ç”¨<code>configtx.yaml</code>æ–‡ä»¶çš„å…¶ä»–éƒ¨åˆ†æ¥æ„å»ºé€šé“é…ç½®ã€‚è¿™äº›é…ç½®ä¿¡æ¯æ˜¯ç”¨æ¥åˆ›å»º<strong>orderer system channel</strong> çš„åˆ›ä¸–çºªåŒºå—çš„ï¼Œç„¶åé€šé“ä¼šè¢«åŒç­‰çš„å…¶ä»–ç»„ç»‡æ‰€ä½¿ç”¨ã€‚ä¸ºäº†å°†å®ƒä»¬ï¼ˆ<strong>orderer system channel</strong>ï¼‰ä¸ç³»ç»Ÿé€šé“åŒºåˆ†å¼€æ¥ï¼Œç»„ç»‡ä½¿ç”¨çš„é€šé“é€šå¸¸ç§°ä¸ºåº”ç”¨ç¨‹åºé€šé“ã€‚</li></ul><p>The <code>configtxgen</code> tool uses <code>configtx.yaml</code> file to create a complete genesis block for the system channel. As a result, the system channel profile needs to specify the full system channel configuration. The channel profile used to create the channel creation transaction only needs to contain the additional configuration information required to create an application channel.</p></li></ul><p><code>configtxgen</code>å·¥å…·ä½¿ç”¨<code>configtx.yaml</code>æ–‡ä»¶ä¸ºç³»ç»Ÿé€šé“åˆ›å»ºå®Œæ•´çš„åˆ›ä¸–å—ã€‚ç»“æœï¼Œç³»ç»Ÿé€šé“é…ç½®æ–‡ä»¶éœ€è¦æŒ‡å®šå®Œæ•´çš„ç³»ç»Ÿé€šé“é…ç½®ã€‚ç”¨äºåˆ›å»ºâ€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€ä½¿ç”¨çš„é€šé“é…ç½®ä»…éœ€è¦åŒ…å«åˆ›å»ºåº”ç”¨ç¨‹åºé€šé“æ‰€éœ€çš„å…¶ä»–é…ç½®ä¿¡æ¯ã€‚</p><p>You can visit the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/create_channel/create_channel_genesis.html">Using configtx.yaml to create a channel genesis block</a> tutorial to learn more about this file. For now, we will return to the operational aspects of creating the channel, though we will reference parts of this file in future steps.</p><p>ä½ å¯ä»¥è®¿é—® <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/create_channel/create_channel_genesis.html">Using configtx.yaml to create a channel genesis block</a> æ•™ç¨‹æ¥å­¦ä¹ æ­¤æ–‡ä»¶çš„æ›´å¤šä¿¡æ¯ã€‚ç°åœ¨æˆ‘ä»¬å›åˆ°åˆ›å»ºé€šé“çš„æ“ä½œæ–¹é¢ã€‚</p><h2 id="Start-the-networkï¼ˆå¯åŠ¨ç½‘ç»œï¼‰">Start the networkï¼ˆå¯åŠ¨ç½‘ç»œï¼‰</h2><p>å‚è€ƒ<a href="Fabric%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%E4%BD%BF%E7%94%A8.md">Fabricæµ‹è¯•ç½‘ç»œä½¿ç”¨</a></p><p>Our instance of the test network was deployed without creating an application channel. However, the test network script creates the system channel when you issue the <code>./network.sh up</code> command. Under the covers, the script uses the <code>configtxgen</code> tool and the <code>configtx.yaml</code> file to build the genesis block of the system channel. Because the system channel is used to create other channels, we need to take some time to understand the orderer system channel before we can create an application channel.</p><p>æˆ‘ä»¬éƒ¨ç½²çš„æµ‹è¯•ç½‘ç»œå®ä¾‹æœªåˆ›å»ºåº”ç”¨ç¨‹åºé€šé“ã€‚ä½†æ˜¯æµ‹è¯•ç½‘ç»œè„šæœ¬åœ¨ä½ è¿è¡Œ<code>./network.sh up</code> å‘½ä»¤æ—¶åˆ›å»ºäº†ç³»ç»Ÿé€šé“ã€‚åœ¨å¹•åï¼Œè„šæœ¬ä½¿ç”¨<code>configtxgen</code>å·¥å…·å’Œ<code>configtx.yaml</code>æ–‡ä»¶æ¥æ„å»ºç³»ç»Ÿé€šé“çš„åˆ›ä¸–çºªå—ã€‚å› ä¸ºç³»ç»Ÿé€šé“æ˜¯ç”¨æ¥åˆ›å»ºå…¶ä»–é€šé“çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åˆ›å»ºä¸€ä¸ªåº”ç”¨é€šé“ä¹‹å‰éœ€è¦èŠ±ä¸€äº›æ—¶é—´å»äº†è§£æ’åºç³»ç»Ÿé€šé“ï¼ˆ <strong>orderer system channel</strong> ï¼‰</p><h2 id="The-orderer-system-channelï¼ˆæ’åºç³»ç»Ÿé€šé“ï¼‰">The orderer system channelï¼ˆæ’åºç³»ç»Ÿé€šé“ï¼‰</h2><p>ç•¥</p><h2 id="Creating-an-application-channelï¼ˆåˆ›å»ºä¸€ä¸ªåº”ç”¨é€šé“ï¼‰">Creating an application channelï¼ˆåˆ›å»ºä¸€ä¸ªåº”ç”¨é€šé“ï¼‰</h2><p>Now that we have deployed the nodes of the network and created the orderer system channel using the <code>network.sh</code> script, we can start the process of creating a new channel for our peer organizations. We have already set the environment variables that are required to use the <code>configtxgen</code> tool. Run the following command to create a channel creation transaction for <code>channel1</code>:</p><p>ç°åœ¨æˆ‘ä»¬å·²ç»ä½¿ç”¨<code>network.sh</code>è„šæœ¬åœ¨æµ‹è¯•ç½‘ç»œä¸­éƒ¨ç½²äº†èŠ‚ç‚¹ï¼Œå¹¶ä¸”åˆ›å»ºäº†æ’åºç³»ç»Ÿé€šé“ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥å¼€å§‹ä¸ºæˆ‘ä»¬çš„ç»„ç»‡åˆ›å»ºä¸€ä¸ªæ–°é€šé“çš„ç¨‹åºäº†ã€‚æˆ‘ä»¬å·²ç»è®¾ç½®äº†ä½¿ç”¨<code>configtxgen</code>å·¥å…·æ‰€éœ€çš„ç¯å¢ƒå˜é‡ã€‚è¿è¡Œä¸‹é¢çš„ç¨‹åºæ¥ä¸º<code>channel1</code>é€šé“åˆ›å»ºä¸€ä¸ªâ€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel1.tx -channelID channel1</span><br></pre></td></tr></table></figure><p>The <code>-channelID</code> will be the name of the future channel. Channel names must be all lower case, less than 250 characters long and match the regular expression <code>[a-z][a-z0-9.-]*</code>. The command uses the uses the <code>-profile</code> flag to reference the <code>TwoOrgsChannel:</code> profile from <code>configtx.yaml</code> that is used by the test network to create application channels:</p><p><code>-channelID</code>æ ‡å¿—åˆ¶å®šäº†åˆ›å»ºçš„é€šé“çš„åç§°ï¼Œé€šé“çš„åç§°å¿…é¡»å…¨æ˜¯å°å†™ï¼Œä¸è¶…è¿‡250ä¸ªå­—ç¬¦å¹¶ä¸”ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼<code>[a-z][a-z0-9.-]*</code>ã€‚è¯¥å‘½ä»¤ä½¿ç”¨<code>-profile</code>æ ‡å¿—æ¥å¼•ç”¨<code>configtx.yaml</code>æ–‡ä»¶ä¸­çš„<code>TwoOrgsChannelï¼š</code>é…ç½®ï¼Œæµ‹è¯•ç½‘ç»œä½¿ç”¨å®ƒæ¥åˆ›å»ºåº”ç”¨ç¨‹åºé€šé“ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">TwoOrgsChannel:</span></span><br><span class="line">    <span class="attr">Consortium:</span> <span class="string">SampleConsortium</span></span><br><span class="line">    <span class="string">&lt;&lt;:</span> <span class="meta">*ChannelDefaults</span></span><br><span class="line">    <span class="attr">Application:</span></span><br><span class="line">        <span class="string">&lt;&lt;:</span> <span class="meta">*ApplicationDefaults</span></span><br><span class="line">        <span class="attr">Organizations:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="meta">*Org1</span></span><br><span class="line">            <span class="bullet">-</span> <span class="meta">*Org2</span></span><br><span class="line">        <span class="attr">Capabilities:</span></span><br><span class="line">            <span class="string">&lt;&lt;:</span> <span class="meta">*ApplicationCapabilities</span></span><br></pre></td></tr></table></figure><p>The profile references the name of the <code>SampleConsortium</code> from the system channel, and includes both peer organizations from the consortium as channel members. Because the system channel is used as a template to create the application channel, the ordering nodes defined in the system channel become the default <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/glossary.html#consenter-set">consenter set</a> of the new channel, while the administrators of the ordering service become the orderer administrators of the channel. Ordering nodes and ordering organizations can be added or removed from the consenter set using channel updates.</p><p>è¯¥é…ç½®æ–‡ä»¶ä»ç³»ç»Ÿé€šé“å¼•ç”¨<code>SampleConsortium</code>çš„åç§°ï¼Œå¹¶ä¸”åŒ…å«æ¥è‡ªè¯¥è”ç›Ÿçš„ä¸¤ä¸ªç»„ç»‡ä½œä¸ºé€šé“æˆå‘˜ã€‚å› ä¸ºç³»ç»Ÿé€šé“è¢«ç”¨ä½œæ¨¡ç‰ˆæ¥åˆ›å»ºåº”ç”¨é€šé“ï¼Œç³»ç»Ÿé€šé“ä¸­å®šä¹‰çš„æ’åºèŠ‚ç‚¹æˆä¸ºæ–°æ¸ é“çš„é»˜è®¤<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/glossary.html#consenter-set">consenter set</a>ï¼Œè€Œæ’åºæœåŠ¡çš„ç®¡ç†å‘˜å°†æˆä¸ºæ–°æ¸ é“çš„æ’åºç®¡ç†å‘˜ã€‚å¯ä»¥ä½¿ç”¨é€šé“æ›´æ–°åœ¨<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/glossary.html#consenter-set">consenter set</a>ä¸­æ·»åŠ æˆ–åˆ é™¤æ’åºèŠ‚ç‚¹å’Œæ’åºç»„ç»‡ã€‚</p><p>If the command successful, you will see logs of <code>configtxgen</code> loading the <code>configtx.yaml</code> file and printing a channel creation transaction:</p><p>å¦‚æœä¸Šé¢çš„å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œä½ ä¼šçœ‹åˆ°<code>configtxgen</code> å·¥å…·åŠ è½½ <code>configtx.yaml</code> æ–‡ä»¶å¹¶ä¸”æ‰“å°äº†ä¸€ä¸ªåˆ›å»ºé€šé“çš„äº¤æ˜“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2020-12-23 14:25:49.175 CST [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2020-12-23 14:25:49.185 CST [common.tools.configtxgen.localconfig] Load -&gt; INFO 002 Loaded configuration: /Users/apple/code/open-source/blockchain/hyperledger/fabric-samples/test-network/configtx/configtx.yaml</span><br><span class="line">2020-12-23 14:25:49.185 CST [common.tools.configtxgen] doOutputChannelCreateTx -&gt; INFO 003 Generating new channel configtx</span><br><span class="line">2020-12-23 14:25:49.188 CST [common.tools.configtxgen] doOutputChannelCreateTx -&gt; INFO 004 Writing new channel tx</span><br></pre></td></tr></table></figure><p>We can use the <code>peer</code> CLI to submit the channel creation transaction to the ordering service. To use the <code>peer</code> CLI, we need to set the <code>FABRIC_CFG_PATH</code> to the <code>core.yaml</code> file located in the <code>fabric-samples/config</code> directory. Set the <code>FABRIC_CFG_PATH</code> environment variable by running the following command:</p><p>ä½ å¯ä»¥ä½¿ç”¨ <code>peer</code>CLIæ¥æŠŠè¿™ä¸ªâ€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€æäº¤åˆ°æ’åºæœåŠ¡ã€‚ä¸ºäº†ä½¿ç”¨<code>peer</code> CLIï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡<code>FABRIC_CFG_PATH</code>ä¸º <code>fabric-samples/config</code> ç›®å½•ä¸‹çš„<code>core.yaml</code>æ–‡ä»¶ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è®¾ç½®<code>FABRIC_CFG_PATH</code>ç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export FABRIC_CFG_PATH=$PWD/../config/</span><br></pre></td></tr></table></figure><p>Before the ordering service creates the channel, the ordering service will check the permission of the identity that submitted the request. By default, only admin identities of organizations that belong to the system channel consortium can create a new channel. Issue the commands below to operate the <code>peer</code> CLI as the admin user from Org1:</p><p>åœ¨æ’åºæœåŠ¡åˆ›å»ºé€šé“æ—¶ï¼Œæ’åºæœåŠ¡ä¼šæ£€æŸ¥æäº¤è¯·æ±‚çš„èº«ä»½çš„æƒé™ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰å±äºç³»ç»Ÿé€šé“è”ç›Ÿçš„ç»„ç»‡çš„ç®¡ç†å‘˜èº«ä»½æ‰èƒ½åˆ›å»ºæ–°çš„é€šé“ã€‚è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥ä»¥Org1çš„ç®¡ç†å‘˜èº«ä»½æ“ä½œ <code>peer</code> CLI:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export CORE_PEER_TLS_ENABLED=true</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:7051</span><br></pre></td></tr></table></figure><p>You can now create the channel by using the following command:</p><p>ä½ ç°åœ¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥åˆ›å»ºé€šé“äº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel create -o localhost:7050  --ordererTLSHostnameOverride orderer.example.com -c channel1 -f ./channel-artifacts/channel1.tx --outputBlock ./channel-artifacts/channel1.block --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br></pre></td></tr></table></figure><p>The command above provides the path to the channel creation transaction file using the <code>-f</code> flag and uses the <code>-c</code> flag to specify the channel name. The <code>-o</code> flag is used to select the ordering node that will be used to create the channel. The <code>--cafile</code> is the path to the TLS certificate of the ordering node. When you run the <code>peer channel create</code> command, the <code>peer</code> CLI will generate the following response:</p><p>ä¸Šé¢çš„å‘½ä»¤ä½¿ç”¨ <code>-f</code>æ ‡å¿—æ¥æŒ‡å®šâ€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€çš„æ–‡ä»¶ï¼Œå¹¶ä¸”ä½¿ç”¨ <code>-c</code> æ ‡å¿—æ¥æŒ‡å®šé€šé“åç§°ã€‚<code>-o</code>æ ‡å¿—æ˜¯ç”¨æ¥é€‰æ‹©ç”¨æ¥åˆ›å»ºé€šé“çš„æ’åºèŠ‚ç‚¹çš„ã€‚<code>--cafile</code> æ ‡å¿—æ˜¯æ’åºèŠ‚ç‚¹çš„TLSè¯ä¹¦è·¯å¾„ã€‚å½“ä½ è¿è¡Œ <code>peer channel create</code>å‘½ä»¤æ—¶ï¼Œ <code>peer</code> CLIä¼šç”Ÿæˆä¸‹é¢çš„å“åº”ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-23 14:36:09.386 CST [channelCmd] InitCmdFactory -&gt; INFO 00b Endorser and orderer connections initialized</span><br><span class="line">2020-12-23 14:36:09.595 CST [cli.common] readBlock -&gt; INFO 00c Received block: 0</span><br></pre></td></tr></table></figure><p>Because we are using a Raft ordering service, you may get some status unavailable messages that you can safely ignore. The command will return the genesis block of the new channel to the location specified by the <code>--outputBlock</code> flag.</p><p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªRaftç­–ç•¥çš„æ’åºæœåŠ¡ï¼Œä½ å¯èƒ½ä¼šæ”¶åˆ°ä¸€äº›çŠ¶æ€ä¸å¯ç”¨çš„ä¿¡æ¯ä½ å¯ä»¥æ”¾å¿ƒçš„å¿½ç•¥ä»–ä»¬ã€‚è¯¥å‘½ä»¤ä¼šå°†æ–°é€šé“çš„åˆ›ä¸–çºªåŒºå—è¾“å‡ºåˆ°<code>--outputBlock</code>æ ‡å¿—æŒ‡å®šçš„ä½ç½®ã€‚</p><h2 id="Join-peers-to-the-channelï¼ˆæŠŠèŠ‚ç‚¹åŠ å…¥é€šé“ä¸­ï¼‰">Join peers to the channelï¼ˆæŠŠèŠ‚ç‚¹åŠ å…¥é€šé“ä¸­ï¼‰</h2><p>After the channel has been created, we can join the channel with our peers. Organizations that are members of the channel can fetch the channel genesis block from the ordering service using the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerchannel.html#peer-channel-fetch">peer channel fetch</a> command. The organization can then use the genesis block to join the peer to the channel using the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerchannel.html#peer-channel-join">peer channel join</a> command. Once the peer is joined to the channel, the peer will build the blockchain ledger by retrieving the other blocks on the channel from the ordering service.</p><p>åœ¨é€šé“åˆ›å»ºä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæˆ‘ä»¬çš„peerèŠ‚ç‚¹åŠ å…¥åˆ°é€šé“ã€‚å±äºé€šé“æˆå‘˜çš„ç»„ç»‡å¯ä»¥ä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerchannel.html#peer-channel-fetch">peer channel fetch</a>å‘½ä»¤ä»æ’åºæœåŠ¡é‚£é‡Œè·å–é€šé“çš„åˆ›ä¸–çºªåŒºå—ã€‚ç„¶åè¿™ä¸ªç»„ç»‡å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªåˆ›ä¸–çºªåŒºå—æ¥é€šè¿‡ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerchannel.html#peer-channel-join">peer channel join</a> å‘½ä»¤å°†peerèŠ‚ç‚¹åŠ å…¥åˆ°é€šé“äº†ã€‚ä¸€æ—¦peerèŠ‚ç‚¹åŠ å…¥äº†é€šé“ï¼ŒpeerèŠ‚ç‚¹å°†é€šè¿‡ä»æ’åºæœåŠ¡ä¸­æ£€ç´¢å…¶ä»–åŒºå—æ¥æ„å»ºåŒºå—é“¾è´¦æœ¬äº†ã€‚</p><p>Since we are already operating the <code>peer</code> CLI as the Org1 admin, letâ€™s join the Org1 peer to the channel. Since Org1 submitted the channel creation transaction, we already have the channel genesis block on our file system. Join the Org1 peer to the channel using the command below.</p><p>å› ä¸ºæˆ‘ä»¬å·²ç»é€šè¿‡Org1çš„ç®¡ç†å‘˜æ“ä½œäº† <code>peer</code> CLI ï¼Œè®©æˆ‘ä»¬æŠŠOrg1çš„peerèŠ‚ç‚¹åŠ å…¥åˆ°é€šé“ã€‚å› ä¸ºæ˜¯Org1ç»„ç»‡æäº¤çš„â€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€ï¼Œæˆ‘ä»¬å·²ç»åœ¨æˆ‘ä»¬æœ¬åœ°çš„æ–‡ä»¶ç³»ç»Ÿä¸­æ‹¥æœ‰äº†é€šé“çš„åˆ›ä¸–çºªåŒºå—ã€‚ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°†ç»„ç»‡Org1çš„peerèŠ‚ç‚¹åŠ å…¥åˆ°é€šé“ä¸­ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel join -b ./channel-artifacts/channel1.block</span><br></pre></td></tr></table></figure><p>The <code>CORE_PEER_ADDRESS</code> environment variable has been set to target <code>peer0.org1.example.com</code>. A successful command will generate a response from <code>peer0.org1.example.com</code> joining the channel:</p><p>ç¯å¢ƒå˜é‡<code>CORE_PEER_ADDRESS</code>å·²ç»è®¾ç½®ä¸ºæŒ‡å‘äº†<code>peer0.org1.example.com</code>ï¼Œå¦‚æœå‘½ä»¤æˆåŠŸçš„è¯ä¼šè·å– <code>peer0.org1.example.com</code> åŠ å…¥é€šé“çš„å“åº”ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-03-06 17:49:09.903 EST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2020-03-06 17:49:10.060 EST [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel</span><br></pre></td></tr></table></figure><p>æˆ‘æœ¬åœ°çš„è¿è¡ŒæŠ¥é”™å¦‚ä¸‹ï¼Œè®°å½•TODOï¼Œæœ€ç»ˆä½¿ç”¨æœ€æ–°2.3.0çš„ç‰ˆæœ¬å°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚2.2.0ç‰ˆæœ¬æ²¡æœ‰æˆåŠŸå¯åŠ¨org1çš„peerã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(base) apple@WHOAMIdeMacBook-Pro:~/code/open-source/blockchain/hyperledger/fabric-samples/test-network$     peer channel join -b ./channel-artifacts/channel1.block</span><br><span class="line">2020-12-23 14:59:02.760 CST [comm.tls] ClientHandshake -&gt; ERRO 001 Client TLS handshake failed after 2.782623ms with error: EOF remoteaddress=[::1]:7051</span><br><span class="line">2020-12-23 14:59:03.768 CST [comm.tls] ClientHandshake -&gt; ERRO 002 Client TLS handshake failed after 2.438885ms with error: EOF remoteaddress=[::1]:7051</span><br><span class="line">2020-12-23 14:59:05.075 CST [comm.tls] ClientHandshake -&gt; ERRO 003 Client TLS handshake failed after 1.857716ms with error: EOF remoteaddress=[::1]:7051</span><br><span class="line">Error: error getting endorser client for channel: endorser client failed to connect to localhost:7051: failed to create new connection: context deadline exceeded</span><br></pre></td></tr></table></figure><p>You can verify that the peer has joined the channel using the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerchannel.html#peer-channel-getinfo">peer channel getinfo</a> command:</p><p>ä½ å¯ä»¥ä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/peerchannel.html#peer-channel-getinfo">peer channel getinfo</a> å‘½ä»¤æ¥éªŒè¯peerèŠ‚ç‚¹å·²ç»åŠ å…¥äº†é€šé“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel getinfo -c channel1</span><br></pre></td></tr></table></figure><p>The command will list the block height of the channel and the hash of the most recent block. Because the genesis block is the only block on the channel, the height of the channel will be 1:</p><p>è¿™ä¸ªå‘½ä»¤ä¼šåˆ—å‡ºé€šé“åŒºå—çš„é«˜åº¦å’Œæœ€æ–°çš„åŒºå—çš„hashå€¼ï¼Œå› ä¸ºè¿™ä¸ªé€šé“ä¸Šåªæœ‰ä¸€ä¸ªåˆ›ä¸–çºªåŒºå—ï¼Œæ‰€ä»¥è¿™ä¸ªé€šé“ä¸Šçš„åŒºå—é«˜åº¦æ˜¯1:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-03-13 10:50:06.978 EDT [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">Blockchain info: &#123;&quot;height&quot;:1,&quot;currentBlockHash&quot;:&quot;kvtQYYEL2tz0kDCNttPFNC4e6HVUFOGMTIDxZ+DeNQM=&quot;&#125;</span><br></pre></td></tr></table></figure><p>We can now join the Org2 peer to the channel. Set the following environment variables to operate the <code>peer</code> CLI as the Org2 admin. The environment variables will also set the Org2 peer, <code>peer0.org1.example.com</code>, as the target peer.</p><p>æˆ‘ä»¬ç°åœ¨å¯ä»¥æŠŠç»„ç»‡Org2çš„peerèŠ‚ç‚¹åŠ å…¥é€šé“äº†ã€‚è®¾ç½®ä¸‹é¢çš„ç¯å¢ƒå˜é‡æ¥ä½¿ç”¨Org2çš„ç®¡ç†å‘˜æ“ä½œ<code>peer</code> CLIã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export CORE_PEER_TLS_ENABLED=true</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:9051</span><br></pre></td></tr></table></figure><p>While we still have the channel genesis block on our file system, in a more realistic scenario, Org2 would have the fetch the block from the ordering service. As an example, we will use the <code>peer channel fetch</code> command to get the genesis block for Org2:</p><p>ç„¶è€Œåœ¨æˆ‘ä»¬æœ¬åœ°ç³»ç»Ÿä¸­ä»ç„¶å­˜åœ¨é€šé“çš„åˆ›ä¸–çºªåŒºå—ï¼Œåœ¨ä¸€ä¸ªæ›´çœŸå®çš„æƒ…å½¢ä¸­ï¼Œç»„ç»‡Org2åº”è¯¥ä»æ’åºæœåŠ¡è·å–è¿™ä¸ªåŒºå—ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ <code>peer channel fetch</code>å‘½ä»¤æ¥ä¸ºç»„ç»‡Org2è·å–åˆ›ä¸–çºªåŒºå—ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch 0 ./channel-artifacts/channel_org2.block -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com -c channel1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br></pre></td></tr></table></figure><p>The command uses <code>0</code> to specify that it needs to fetch the genesis block that is required to join the channel. If the command is successful, you should see the following output:</p><p>è¯¥å‘½ä»¤ä½¿ç”¨<code>0</code>æ¥æŒ‡æ˜å®ƒéœ€è¦è·å–åˆ›ä¸–çºªå—ï¼Œè¯¥åˆ›ä¸–çºªåŒºå—ç”¨äºåŠ å…¥é€šé“ã€‚å¦‚æœå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œä½ ä¼šçœ‹åˆ°ä¸‹é¢çš„è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-03-13 11:32:06.309 EDT [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2020-03-13 11:32:06.336 EDT [cli.common] readBlock -&gt; INFO 002 Received block: 0</span><br></pre></td></tr></table></figure><p>The command returns the channel genesis block and names it <code>channel_org2.block</code> to distinguish it from the block pulled by org1. You can now use the block to join the Org2 peer to the channel:</p><p>è¿™ä¸ªå‘½ä»¤ä¼šè·å–åˆ°åä¸º <code>channel_org2.block</code> çš„é€šé“åˆ›ä¸–çºªåŒºå—ï¼Œä»¥ä¸Org1çš„åŒºå—ä½œåŒºåˆ†ã€‚ä½ ç°åœ¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªåŒºå—æŠŠOrg2çš„peerèŠ‚ç‚¹åŠ å…¥åˆ°é€šé“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel join -b ./channel-artifacts/channel_org2.block</span><br></pre></td></tr></table></figure><h2 id="Set-anchor-peersï¼ˆè®¾ç½®é”šèŠ‚ç‚¹ï¼‰">Set anchor peersï¼ˆè®¾ç½®é”šèŠ‚ç‚¹ï¼‰</h2><p>After an organizations has joined their peers to the channel, they should select at least one of their peers to become an anchor peer. <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/gossip.html#anchor-peers">Anchor peers</a> are required in order to take advantage of features such as private data and service discovery. Each organization should set multiple anchor peers on a channel for redundancy. For more information about gossip and anchor peers, see the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/gossip.html">Gossip data dissemination protocol</a>.</p><p>åœ¨ä¸€ä¸ªç»„ç»‡å°†ä»–ä»¬çš„peerèŠ‚ç‚¹åŠ å…¥åˆ°é€šé“ä¹‹åï¼Œä»–ä»¬è¿˜éœ€è¦åœ¨ä»–ä»¬çš„ç»„ç»‡å†…éƒ¨é€‰æ‹©è‡³å°‘ä¸€ä¸ªpeerèŠ‚ç‚¹ä½œä¸ºé”šèŠ‚ç‚¹ã€‚<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/gossip.html#anchor-peers">Anchor peers</a> éœ€è¦é”šèŠ‚ç‚¹çš„å¥½å¤„æ˜¯ä»–èƒ½å¤Ÿåˆ©ç”¨ç§æœ‰æ•°æ®ä»¥åŠåšæœåŠ¡å‘ç°ã€‚æ¯ä¸ªç»„ç»‡éƒ½åº”åœ¨ä¸€ä¸ªé€šé“ä¸Šè®¾ç½®å¤šä¸ªé”šèŠ‚ç‚¹ä»¥å®ç°å†—ä½™ã€‚</p><p>The endpoint information of the anchor peers of each organization is included in the channel configuration. Each channel member can specify their anchor peers by updating the channel. We will use the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/configtxlator.html">configtxlator</a> tool to update the channel configuration and select an anchor peer for Org1 and Org2. The process for setting an anchor peer is similar to the steps that are required to make other channel updates and provides an introduction to how to use <code>configtxlator</code> to <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/config_update.html">update a channel configuration</a>. You will also need to install the <a href="https://stedolan.github.io/jq/">jq tool</a> on your local machine.</p><p>é€šé“é…ç½®ä¸­åŒ…å«æ¯ä¸ªç»„ç»‡çš„é”šèŠ‚ç‚¹çš„ç»ˆç‚¹ä¿¡æ¯ã€‚æ¯ä¸ªç»„ç»‡éƒ½å¯ä»¥é€šè¿‡æ›´æ–°é€šé“é…ç½®æ¥çŸ¥åä»–ä»¬çš„é”šèŠ‚ç‚¹ã€‚æˆ‘ä»¬ä¼šä½¿ç”¨ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/commands/configtxlator.html">configtxlator</a>å·¥å…·æ¥æ›´æ–°é€šé“é…ç½®å¹¶ä¸”ä¸ºç»„ç»‡Org1å’ŒOrg2å„é€‰æ‹©ä¸€ä¸ªé”šèŠ‚ç‚¹ã€‚è®¾ç½®é”šèŠ‚ç‚¹çš„æµç¨‹ä¸æ•™ç¨‹<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/config_update.html">update a channel configuration</a>çš„æ­¥éª¤å¾ˆç±»ä¼¼ã€‚ä½ è¿˜éœ€è¦åœ¨ä½ çš„æœ¬åœ°å®‰è£…<a href="https://stedolan.github.io/jq/">jq</a> å·¥å…·ã€‚</p><p>We will start by selecting an anchor peer as Org1. The first step is to pull the most recent channel configuration block using the <code>peer channel fetch</code> command. Set the following environment variables to operate the <code>peer</code> CLI as the Org1 admin:</p><p>æˆ‘ä»¬å…ˆä»¥Org1çš„èº«ä»½æ¥é€‰æ‹©ä¸€ä¸ªé”šèŠ‚ç‚¹ã€‚ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨<code>peer channel fetch</code> å‘½ä»¤æ‹‰å»æœ€æ–°çš„é€šé“é…ç½®åŒºå—ã€‚è®¾ç½®ç¯å¢ƒå˜é‡ä»¥Org1ç®¡ç†å‘˜çš„èº«ä»½æ“ä½œ <code>peer</code> CLI ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export FABRIC_CFG_PATH=$PWD/../config/</span><br><span class="line">export CORE_PEER_TLS_ENABLED=true</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:7051</span><br></pre></td></tr></table></figure><p>You can use the following command to fetch the channel configuration:</p><p>ä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥è·å–é€šé“é…ç½®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch config channel-artifacts/config_block.pb -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com -c channel1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br></pre></td></tr></table></figure><p>Because the most recent channel configuration block is the channel genesis block, you will see the command return block 0 from the channel.</p><p>å› ä¸ºæœ€æ–°çš„é€šé“é…ç½®åŒºå—æ˜¯é€šé“çš„åˆ›ä¸–çºªåŒºå—ï¼Œä½ ä¼šçœ‹åˆ°è¯¥å‘½ä»¤ä¼šè¿”å›é€šé“ä¸Šçš„0åŒºå—ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2020-12-23 16:37:33.686 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2020-12-23 16:37:33.689 CST [cli.common] readBlock -&gt; INFO 002 Received block: 0</span><br><span class="line">2020-12-23 16:37:33.689 CST [channelCmd] fetch -&gt; INFO 003 Retrieving last config block: 0</span><br><span class="line">2020-12-23 16:37:33.693 CST [cli.common] readBlock -&gt; INFO 004 Received block: 0</span><br></pre></td></tr></table></figure><p>The channel configuration block was stored in the <code>channel-artifacts</code> folder to keep the update process separate from other artifacts. Change into the <code>channel-artifacts</code> folder to complete the next steps:</p><p>é€šé“é…ç½®åŒºå—è¢«å­˜å‚¨åœ¨channel-artifactsç›®å½•ä¸‹ï¼Œä»¥ä½¿æ›´æ–°æµç¨‹ä¸å…¶ä»–çš„ç»„ä»¶åŒºåˆ†å¼€ã€‚è¿›å…¥ <code>channel-artifacts</code> ç›®å½•ä¸‹æ¥å®Œæˆæ¥ä¸‹æ¥çš„æ­¥éª¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd channel-artifacts</span><br></pre></td></tr></table></figure><p>We can now start using the <code>configtxlator</code> tool to start working with the channel configuration. The first step is to decode the block from protobuf into a JSON object that can be read and edited. We also strip away the unnecessary block data, leaving only the channel configuration.</p><p>æˆ‘ä»¬ç°åœ¨å¼€å§‹ä½¿ç”¨ <code>configtxlator</code> å·¥å…·å’Œé€šé“é…ç½®ä¸€èµ·å·¥ä½œã€‚ç¬¬ä¸€æ­¥æ˜¯å°†æ¥è‡ªåŒºå—çš„protobufæ ¼å¼è§£ç ä¸ºå¯ä»¥è¯»å–å’Œç¼–è¾‘çš„JSONæ ¼å¼ã€‚æˆ‘ä»¬è¿˜å°†å»é™¤ä¸å¿…è¦çš„å—æ•°æ®ï¼Œä»…ä¿ç•™é€šé“é…ç½®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_decode --input config_block.pb --type common.Block --output config_block.json</span><br><span class="line">jq .data.data[0].payload.data.config config_block.json &gt; config.json</span><br></pre></td></tr></table></figure><p>These commands convert the channel configuration block into a streamlined JSON, <code>config.json</code>, that will serve as the baseline for our update. Because we donâ€™t want to edit this file directly, we will make a copy that we can edit. We will use the original channel config in a future step.</p><p>è¿™äº›å‘½ä»¤å°†é€šé“é…ç½®åŒºå—è½¬æ¢ä¸ºç®€åŒ–çš„JSONæ ¼å¼çš„æ–‡ä»¶<code>config.json</code>ï¼Œå®ƒå°†ä½œä¸ºæˆ‘ä»¬æ›´æ–°çš„åŸºå‡†ã€‚å› ä¸ºæˆ‘ä»¬ä¸æƒ³ç›´æ¥ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬ä¼šå…ˆåˆ›å»ºä¸€ä¸ªå¯ä»¥ç¼–è¾‘çš„å‰¯æœ¬ã€‚æˆ‘ä»¬å°†åœ¨ä»¥åçš„æ­¥éª¤ä¸­ä½¿ç”¨åŸå§‹çš„é€šé“é…ç½®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp config.json config_copy.json</span><br></pre></td></tr></table></figure><p>You can use the <code>jq</code> tool to add the Org1 anchor peer to the channel configuration.</p><p>ä½ å¯ä»¥ä½¿ç”¨<code>jq</code> å·¥å…·æ¥æ·»åŠ Org1ç»„ç»‡çš„é”šèŠ‚ç‚¹åˆ°é€šé“é…ç½®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jq &#x27;.channel_group.groups.Application.groups.Org1MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.org1.example.com&quot;,&quot;port&quot;: 7051&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; config_copy.json &gt; modified_config.json</span><br></pre></td></tr></table></figure><p>After this step, we have an updated version of channel configuration in JSON format in the <code>modified_config.json</code> file. We can now convert both the original and modified channel configurations back into protobuf format and calculate the difference between them.</p><p>å®Œæˆæ­¤æ­¥éª¤åï¼Œæˆ‘ä»¬åœ¨<code>modified_config.json</code>æ–‡ä»¶ä¸­ä»¥JSONæ ¼å¼è·å–äº†é€šé“é…ç½®çš„æ›´æ–°ç‰ˆæœ¬ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_encode --input config.json --type common.Config --output config.pb</span><br><span class="line">configtxlator proto_encode --input modified_config.json --type common.Config --output modified_config.pb</span><br><span class="line">configtxlator compute_update --channel_id channel1 --original config.pb --updated modified_config.pb --output config_update.pb</span><br></pre></td></tr></table></figure><p>The new protobuf named <code>channel_update.pb</code> contains the anchor peer update that we need to apply to the channel configuration. We can wrap the configuration update in a transaction envelope to create the channel configuration update transaction.</p><p>æ ¼å¼ä¸ºprotobufçš„æ–°çš„<code>channel_update.pb</code>æ–‡ä»¶åŒ…å«æˆ‘ä»¬éœ€è¦åº”ç”¨äºé€šé“é…ç½®ä¸Šçš„é”šèŠ‚ç‚¹æ›´æ–°ã€‚æˆ‘ä»¬å¯ä»¥å°†é…ç½®æ›´æ–°åŒ…è£…åœ¨äº¤æ˜“ä¿¡å°ä¸­ä»¥åˆ›å»ºé€šé“é…ç½®æ›´æ–°äº¤æ˜“ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_decode --input config_update.pb --type common.ConfigUpdate --output config_update.json</span><br><span class="line">echo &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;channel1&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; config_update_in_envelope.json</span><br><span class="line">configtxlator proto_encode --input config_update_in_envelope.json --type common.Envelope --output config_update_in_envelope.pb</span><br></pre></td></tr></table></figure><p>We can now use the final artifact, <code>config_update_in_envelope.pb</code>, that can be used to update the channel. Navigate back to the <code>test-network</code> directory:</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ€ç»ˆå·¥ä»¶<code>config_update_in_envelope.pb</code>ï¼Œè¯¥å·¥ä»¶å¯ä»¥ç”¨äºæ›´æ–°é€šé“ã€‚å›åˆ°<code>test-network</code> ç›®å½•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ..</span><br></pre></td></tr></table></figure><p>We can add the anchor peer by providing the new channel configuration to the <code>peer channel update</code> command. Because we are updating a section of the channel configuration that only affects Org1, other channel members do not need to approve the channel update.</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘<code>peer channel update</code>å‘½ä»¤æä¾›æ–°çš„é€šé“é…ç½®æ¥æ·»åŠ é”šèŠ‚ç‚¹ã€‚å› ä¸ºæˆ‘ä»¬æ­£åœ¨æ›´æ–°ä»…å½±å“Org1çš„éƒ¨åˆ†é€šé“é…ç½®ï¼Œæ‰€ä»¥å…¶ä»–é€šé“æˆå‘˜ä¸éœ€è¦æ‰¹å‡†é€šé“æ›´æ–°ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel update -f channel-artifacts/config_update_in_envelope.pb -c channel1 -o localhost:7050  --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br></pre></td></tr></table></figure><p>When the channel update is successful, you should see the following response:</p><p>å½“æ¸ é“æ›´æ–°æˆåŠŸåï¼Œä½ ä¼šçœ‹åˆ°ä¸‹é¢çš„å“åº”ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-23 17:05:48.187 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">2020-12-23 17:05:48.222 CST [channelCmd] update -&gt; INFO 002 Successfully submitted channel update</span><br></pre></td></tr></table></figure><p>We can set the anchor peers for Org2. Because we are going through the process a second time, we will go through the steps more quickly. Set the environment variables to operate the <code>peer</code> CLI as the Org2 admin:</p><p>æˆ‘ä»¬å¯ä»¥ä¸ºOrg2è®¾ç½®é”šèŠ‚ç‚¹ã€‚å› ä¸ºæˆ‘ä»¬æ˜¯ç¬¬äºŒæ¬¡è¿›è¡Œè¯¥è¿‡ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æ›´å¿«åœ°å®Œæˆè¿™äº›æ­¥éª¤ã€‚è®¾ç½®ç¯å¢ƒå˜é‡ä»¥Org2ç®¡ç†å‘˜çš„èº«ä»½æ“ä½œ <code>peer</code> CLI ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export CORE_PEER_TLS_ENABLED=true</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:9051</span><br></pre></td></tr></table></figure><p>Pull the latest channel configuration block, which is now the second block on the channel:</p><p>æ‹‰å»æœ€æ–°çš„é€šé“é…ç½®åŒºå—ï¼Œå³ç›®å‰é€šé“ä¸Šçš„ç¬¬äºŒä¸ªåŒºå—ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel fetch config channel-artifacts/config_block.pb -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com -c channel1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br></pre></td></tr></table></figure><p>Navigate back to the <code>channel-artifacts</code> directoryï¼ˆåˆ‡æ¢å› <code>channel-artifacts</code> ç›®å½•ï¼‰:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd channel-artifacts</span><br></pre></td></tr></table></figure><p>You can then decode and copy the configuration block.ï¼ˆä½ å¯ä»¥è§£ç å¹¶å¤åˆ¶é…ç½®åŒºå—ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_decode --input config_block.pb --type common.Block --output config_block.json</span><br><span class="line">jq .data.data[0].payload.data.config config_block.json &gt; config.json</span><br><span class="line">cp config.json config_copy.json</span><br></pre></td></tr></table></figure><p>Add the Org2 peer that is joined to the channel as the anchor peer in the channel configuration:</p><p>åœ¨é€šé“é…ç½®ä¸­æ·»åŠ Org2çš„å·²ç»åŠ å…¥é€šé“çš„èŠ‚ç‚¹ä½œä¸ºé”šèŠ‚ç‚¹:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jq &#x27;.channel_group.groups.Application.groups.Org2MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.org2.example.com&quot;,&quot;port&quot;: 9051&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; config_copy.json &gt; modified_config.json</span><br></pre></td></tr></table></figure><p>We can now convert both the original and updated channel configurations back into protobuf format and calculate the difference between them.</p><p>æˆ‘ä»¬å¯ä»¥å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_encode --input config.json --type common.Config --output config.pb</span><br><span class="line">configtxlator proto_encode --input modified_config.json --type common.Config --output modified_config.pb</span><br><span class="line">configtxlator compute_update --channel_id channel1 --original config.pb --updated modified_config.pb --output config_update.pb</span><br></pre></td></tr></table></figure><p>Wrap the configuration update in a transaction envelope to create the channel configuration update transaction:</p><p>å°†é…ç½®æ›´æ–°åŒ…è£…åœ¨äº¤æ˜“ä¿¡å°ä¸­ä»¥åˆ›å»ºé€šé“é…ç½®æ›´æ–°äº¤æ˜“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configtxlator proto_decode --input config_update.pb --type common.ConfigUpdate --output config_update.json</span><br><span class="line">echo &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;channel1&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; config_update_in_envelope.json</span><br><span class="line">configtxlator proto_encode --input config_update_in_envelope.json --type common.Envelope --output config_update_in_envelope.pb</span><br></pre></td></tr></table></figure><p>Navigate back to the <code>test-network</code> directory.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ..</span><br></pre></td></tr></table></figure><p>Update the channel and set the Org2 anchor peer by issuing the following command:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel update -f channel-artifacts/config_update_in_envelope.pb -c channel1 -o localhost:7050  --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem</span><br></pre></td></tr></table></figure><p>You can confirm that the channel has been updated successfully by running the <code>peer channel info</code> command:</p><p>ä½ å¯ä»¥ä½¿ç”¨ <code>peer channel info</code>å‘½ä»¤æ¥ç¡®è®¤é€šé“å·²ç»æˆåŠŸæ›´æ–°ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer channel getinfo -c channel1</span><br></pre></td></tr></table></figure><p>Now that the channel has been updated by adding two channel configuration blocks to the channel genesis block, the height of the channel will have grown to three:</p><p>ç°åœ¨å·²ç»é€šè¿‡åœ¨åˆ›ä¸–çºªåŒºå—ä¸Šæ·»åŠ ä¸¤ä¸ªé€šé“é…ç½®åŒºå—æ›´æ–°äº†é€šé“ï¼Œé€šé“çš„åŒºå—é«˜åº¦ä¼šå¢é•¿åˆ°3:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-12-23 17:19:08.620 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized</span><br><span class="line">Blockchain info: &#123;&quot;height&quot;:3,&quot;currentBlockHash&quot;:&quot;0xMLgGnvbUE+gfDpxjbfB1OsxROF3djLzPX9S76ai2I=&quot;,&quot;previousBlockHash&quot;:&quot;6oIrHH8zjeOuhlj2/rrpzxh0pNmGOdPTDjiphJwCXcQ=&quot;&#125;</span><br></pre></td></tr></table></figure><h2 id="Deploy-a-chaincode-to-the-new-channelï¼ˆéƒ¨ç½²é“¾ç åˆ°æ–°é€šé“ä¸Šï¼‰">Deploy a chaincode to the new channelï¼ˆéƒ¨ç½²é“¾ç åˆ°æ–°é€šé“ä¸Šï¼‰</h2><p>We can confirm that the channel was created successfully by deploying a chaincode to the channel. We can use the <code>network.sh</code> script to deploy the Basic asset transfer chaincode to any test network channel. Deploy a chaincode to our new channel using the following command:</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨é€šé“ä¸Šéƒ¨ç½²é“¾ç æ¥ç¡®è®¤é€šé“å·²ç»åˆ›å»ºæˆåŠŸã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>network.sh</code> è„šæœ¬éƒ¨ç½²Basic asset transfer é“¾ç åˆ°ä»»ä½•æµ‹è¯•é€šé“ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°†é“¾ç éƒ¨ç½²åˆ°æ–°é€šé“ä¸Šï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./network.sh deployCC -ccn basic -ccp ../asset-transfer-basic/chaincode-go/ -ccl go -c channel1 -cci InitLedger</span><br></pre></td></tr></table></figure><p>After you run the command, you should see the chaincode being deployed to the channel in your logs. The chaincode is invoked to add data to the channel ledger.</p><p>è¿è¡Œå‘½ä»¤åï¼Œæ‚¨åº”è¯¥åœ¨æ—¥å¿—ä¸­çœ‹åˆ°é“¾ç å·²éƒ¨ç½²åˆ°é€šé“ã€‚è°ƒç”¨é“¾ç å°†æ•°æ®æ·»åŠ åˆ°é€šé“è´¦æœ¬ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -C channel1 -n basic -c &#x27;&#123;&quot;Args&quot;:[&quot;getAllAssets&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>After you run the query, you should see the assets that were added to the channel ledger.</p><p>åœ¨è¿è¡ŒæŸ¥è¯¢ä¹‹åï¼Œä½ ä¼šçœ‹åˆ°å·²ç»æ·»åŠ åˆ°é€šé“è´¦æœ¬ä¸Šçš„èµ„äº§åˆ—è¡¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;&quot;ID&quot;:&quot;asset1&quot;,&quot;color&quot;:&quot;blue&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Tomoko&quot;,&quot;appraisedValue&quot;:300&#125;,&#123;&quot;ID&quot;:&quot;asset2&quot;,&quot;color&quot;:&quot;red&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Brad&quot;,&quot;appraisedValue&quot;:400&#125;,&#123;&quot;ID&quot;:&quot;asset3&quot;,&quot;color&quot;:&quot;green&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Jin Soo&quot;,&quot;appraisedValue&quot;:500&#125;,&#123;&quot;ID&quot;:&quot;asset4&quot;,&quot;color&quot;:&quot;yellow&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Max&quot;,&quot;appraisedValue&quot;:600&#125;,&#123;&quot;ID&quot;:&quot;asset5&quot;,&quot;color&quot;:&quot;black&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Adriana&quot;,&quot;appraisedValue&quot;:700&#125;,&#123;&quot;ID&quot;:&quot;asset6&quot;,&quot;color&quot;:&quot;white&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Michel&quot;,&quot;appraisedValue&quot;:800&#125;]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> channel </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> channel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>èº«ä»½è¯†åˆ«</title>
      <link href="2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/%E8%BA%AB%E5%88%86%E8%AF%86%E5%88%AB/"/>
      <url>2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/%E8%BA%AB%E5%88%86%E8%AF%86%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<p>å®˜æ–¹æ–‡æ¡£<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/identity/identity.html">Identity</a></p><h2 id="What-is-an-Identity-ï¼ˆä»€ä¹ˆæ˜¯èº«ä»½è¯†åˆ«ï¼‰">What is an Identity?ï¼ˆä»€ä¹ˆæ˜¯èº«ä»½è¯†åˆ«ï¼‰</h2><p>The different actors in a blockchain network include peers, orderers, client applications, administrators and more. Each of these actors â€” active elements inside or outside a network able to consume services â€” has a digital identity encapsulated in an X.509 digital certificate. These identities really matter because they <strong>determine the exact permissions over resources and access to information that actors have in a blockchain network.</strong></p><p>åŒºå—é“¾ç½‘ç»œä¸­åŒ…å«ä¸åŒçš„æˆå‘˜ï¼ŒåŒ…æ‹¬peersã€orderersã€client applicationsã€administratorsç­‰ã€‚è¿™äº›å‚ä¸è€…ï¼ˆç½‘ç»œå†…éƒ¨æˆ–å¤–éƒ¨èƒ½å¤Ÿä½¿ç”¨æœåŠ¡çš„æ´»åŠ¨å…ƒç´ ï¼‰ä¸­çš„æ¯ä¸€ä¸ªéƒ½æœ‰å°è£…åœ¨X.509æ•°å­—è¯ä¹¦ä¸­çš„æ•°å­—èº«ä»½ã€‚è¿™äº›èº«ä»½ç¡®å®å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒä»¬<strong>ç¡®å®šäº†å¯¹èµ„æºçš„ç¡®åˆ‡æƒé™ä»¥åŠå¯¹å‚ä¸è€…åœ¨åŒºå—é“¾ç½‘ç»œä¸­æ‹¥æœ‰çš„è®¿é—®ä¿¡æ¯çš„æƒé™</strong>ã€‚</p><p>A digital identity furthermore has some additional attributes that Fabric uses to determine permissions, and it gives the union of an identity and the associated attributes a special name â€” <strong>principal</strong>. Principals are just like userIDs or groupIDs, but a little more flexible because they can include a wide range of properties of an actorâ€™s identity, such as the actorâ€™s organization, organizational unit, role or even the actorâ€™s specific identity. When we talk about principals, they are the properties which determine their permissions.</p><p>æ­¤å¤–ï¼Œæ•°å­—èº«ä»½è¿˜å…·æœ‰Fabricç”¨æ¥ç¡®å®šæƒé™çš„å…¶ä»–ä¸€äº›å±æ€§ï¼Œå®ƒä¸ºèº«ä»½å’Œç›¸å…³å±æ€§çš„å¹¶é›†æä¾›äº†ä¸€ä¸ªç‰¹æ®Šåç§°-<strong>ä¸»ä½“</strong>ã€‚ä¸»ä½“å°±åƒæ˜¯userIDsæˆ–groupIDsï¼Œä½†æ›´åŠ çµæ´»ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥åŒ…å«æˆå‘˜èº«ä»½çš„å„ç§å±æ€§ï¼Œä¾‹å¦‚æˆå‘˜çš„ç»„ç»‡ï¼Œç»„ç»‡å•ä½ï¼Œè§’è‰²ï¼Œç”šè‡³æˆå‘˜çš„ç‰¹å®šèº«ä»½ã€‚å½“æˆ‘ä»¬è°ˆè®ºä¸»ä½“æ—¶ï¼Œå®ƒä»¬æ˜¯ç¡®å®šå…¶æƒé™çš„å±æ€§ã€‚</p><p>For an identity to be <strong>verifiable</strong>, it must come from a <strong>trusted</strong> authority. A <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/membership/membership.html">membership service provider</a> (MSP) is that trusted authority in Fabric. More specifically, an MSP is a component that defines the rules that govern the valid identities for this organization. The default MSP implementation in Fabric uses X.509 certificates as identities, adopting a traditional Public Key Infrastructure (PKI) hierarchical model (more on PKI later).</p><p>ä¸ºäº†ä½¿èº«ä»½å¯éªŒè¯ï¼Œå®ƒå¿…é¡»æ¥è‡ªå—ä¿¡ä»»çš„æƒå¨ã€‚ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/membership/membership.html">membership service provider</a> (MSP)å°±æ˜¯ä¸€ä¸ªåœ¨Fabricä¸­çš„å—ä¿¡ä»»çš„æƒå¨ã€‚æ›´å…·ä½“åœ°è¯´ï¼ŒMSPæ˜¯å®šä¹‰ç”¨äºç®¡ç†è¯¥ç»„ç»‡è§’è‰²çš„æœ‰æ•ˆèº«ä»½çš„ç»„ä»¶ã€‚ã€‚ Fabricä¸­çš„é»˜è®¤MSPå®ç°æ˜¯ä½¿ç”¨X.509è¯ä¹¦ä½œä¸ºèº«ä»½ï¼Œå¹¶é‡‡ç”¨ä¼ ç»Ÿçš„å…¬å…±å¯†é’¥åŸºç¡€ç»“æ„ï¼ˆPKIï¼‰å±‚æ¬¡æ¨¡å‹ï¼ˆç¨åå°†åœ¨PKIä¸Šè¿›è¡Œä»‹ç»ï¼‰ã€‚</p><h2 id="A-Simple-Scenario-to-Explain-the-Use-of-an-Identityï¼ˆé€šè¿‡ä¸€ä¸ªç®€å•çš„æ–¹æ¡ˆæ¥è§£é‡Šèº«ä»½è¯†åˆ«çš„ç”¨æ³•ï¼‰">A Simple Scenario to Explain the Use of an Identityï¼ˆé€šè¿‡ä¸€ä¸ªç®€å•çš„æ–¹æ¡ˆæ¥è§£é‡Šèº«ä»½è¯†åˆ«çš„ç”¨æ³•ï¼‰</h2><p>Imagine that you visit a supermarket to buy some groceries. At the checkout you see a sign that says that only Visa, Mastercard and AMEX cards are accepted. If you try to pay with a different card â€” letâ€™s call it an â€œImagineCardâ€ â€” it doesnâ€™t matter whether the card is authentic and you have sufficient funds in your account. It will be not be accepted.</p><p>æƒ³è±¡ä¸€ä¸‹ä½ å»ä¸€ä¸ªè¶…çº§å¸‚åœºå»ä¹°ä¸€äº›æ‚è´§ã€‚åœ¨ç»“è´¦æ—¶ä½ çœ‹åˆ°ä¸€ä¸ªæ ‡å¿—è¯´åªæ”¯æŒVisaã€Mastercardå’ŒAMEXé“¶è¡Œå¡ã€‚å¦‚æœä½ å°è¯•ä½¿ç”¨å…¶ä»–é“¶è¡Œå¡-è®©æˆ‘ä»¬å«å®ƒâ€œæƒ³è±¡çš„å¡ç‰‡â€-é“¶è¡Œå¡æ˜¯å¦çœŸå®å’Œå¸æˆ·ä¸­æ˜¯å¦æœ‰è¶³å¤Ÿçš„èµ„é‡‘éƒ½æ²¡å…³ç³»ã€‚å®ƒå°†ä¸è¢«æ¥å—ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/identity.diagram.6.png" alt="identity.diagram.6"></p><p><em>Having a valid credit card is not enough â€” it must also be accepted by the store! PKIs and MSPs work together in the same way â€” a PKI provides a list of identities, and an MSP says which of these are members of a given organization that participates in the network.</em></p><p><em>æ‹¥æœ‰ä¸€ä¸ªåˆæ³•çš„ä¿¡ç”¨å¡è¿˜ä¸å¤Ÿï¼Œä»–è¿˜å¿…é¡»è¢«å•†åº—æ¥å—ï¼PKIså’ŒMSPsä»¥ç›¸åŒçš„æ–¹å¼ä¸€èµ·å·¥ä½œ-PKIæä¾›äº†èº«ä»½è¯†åˆ«çš„åˆ—è¡¨ï¼ŒMSPæŒ‡å‡ºå…¶ä¸­çš„å“ªäº›æ˜¯å‚ä¸è¯¥ç½‘ç»œçš„ç»™å®šç»„ç»‡çš„æˆå‘˜ã€‚</em></p><p>PKI certificate authorities and MSPs provide a similar combination of functionalities. A PKI is like a card provider â€” it dispenses many different types of verifiable identities. An MSP, on the other hand, is like the list of card providers accepted by the store, determining which identities are the trusted members (actors) of the store payment network. <strong>MSPs turn verifiable identities into the members of a blockchain network</strong>.</p><p>PKIè¯ä¹¦é¢å‘æœºæ„å’ŒMSPæä¾›äº†ç±»ä¼¼çš„åŠŸèƒ½ç»„åˆã€‚PKIå°±åƒé“¶è¡Œå¡å‘å¡ç»„ç»‡ä¸€æ ·ï¼Œå®ƒåˆ†é…è®¸å¤šä¸åŒç±»å‹çš„å¯éªŒè¯èº«ä»½ã€‚å¦ä¸€æ–¹é¢ï¼ŒMSPå°±åƒå•†åº—æ¥å—çš„å‘å¡ç»„ç»‡åˆ—è¡¨ä¸€æ ·ï¼Œç¡®å®šå“ªäº›èº«ä»½æ˜¯å•†åº—æ”¯ä»˜ç½‘ç»œçš„å—ä¿¡ä»»æˆå‘˜ï¼ˆå‚ä¸è€…ï¼‰ã€‚<strong>MSPå°†å¯éªŒè¯èº«ä»½è½¬æ¢ä¸ºåŒºå—é“¾ç½‘ç»œçš„æˆå‘˜ã€‚</strong></p><p>Letâ€™s drill into these concepts in a little more detail.</p><p>è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°ç ”ç©¶è¿™äº›æ¦‚å¿µã€‚</p><h2 id="What-are-PKIs-ï¼ˆä»€ä¹ˆæ˜¯PKIsï¼Ÿï¼‰">What are PKIs?ï¼ˆä»€ä¹ˆæ˜¯PKIsï¼Ÿï¼‰</h2><p><strong>A public key infrastructure (PKI) is a collection of internet technologies that provides secure communications in a network.</strong> Itâ€™s PKI that puts the <strong>S</strong> in <strong>HTTPS</strong> â€” and if youâ€™re reading this documentation on a web browser, youâ€™re probably using a PKI to make sure it comes from a verified source.</p><p>å…¬é’¥åŸºç¡€ç»“æ„ï¼ˆPKIï¼‰æ˜¯ç½‘ç»œæŠ€æœ¯çš„é›†åˆï¼Œè¿™äº›æŠ€æœ¯åœ¨ç½‘ç»œä¸­æä¾›å®‰å…¨çš„é€šä¿¡ã€‚æ˜¯PKIå°†Sç½®äºHTTPSä¸­-å¦‚æœæ‚¨æ­£åœ¨ç½‘ç»œæµè§ˆå™¨ä¸Šé˜…è¯»æ­¤æ–‡æ¡£ï¼Œæ‚¨å¯èƒ½æ­£åœ¨ä½¿ç”¨PKIæ¥ç¡®ä¿å®ƒæ¥è‡ªç»è¿‡éªŒè¯çš„æ¥æºã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/identity.diagram.7.png" alt="identity.diagram.7"></p><p><em>The elements of Public Key Infrastructure (PKI). A PKI is comprised of Certificate Authorities who issue digital certificates to parties (e.g., users of a service, service provider), who then use them to authenticate themselves in the messages they exchange in their environment. A CAâ€™s Certificate Revocation List (CRL) constitutes a reference for the certificates that are no longer valid. Revocation of a certificate can happen for a number of reasons. For example, a certificate may be revoked because the cryptographic private material associated to the certificate has been exposed.</em></p><p><em>å…¬é’¥åŸºç¡€ç»“æ„ï¼ˆPKIï¼‰çš„å…ƒç´ ã€‚PKIç”±è¯ä¹¦é¢å‘æœºæ„ç»„æˆï¼Œè¯ä¹¦é¢å‘æœºæ„å‘å„æ–¹é¢å‘æ•°å­—è¯ä¹¦ï¼Œç„¶åä»–ä»¬ä½¿ç”¨å®ƒä»¬åœ¨ç¯å¢ƒä¸­äº¤æ¢çš„æ¶ˆæ¯ä¸­å¯¹è‡ªå·±è¿›è¡Œèº«ä»½éªŒè¯ã€‚CAçš„è¯ä¹¦åŠé”€åˆ—è¡¨ï¼ˆCRLï¼‰æ„æˆäº†ä¸å†æœ‰æ•ˆçš„è¯ä¹¦çš„å‚è€ƒã€‚åŠé”€è¯ä¹¦çš„åŸå› æœ‰å¾ˆå¤šã€‚ä¾‹å¦‚ï¼Œç”±äºä¸è¯ä¹¦å…³è”çš„åŠ å¯†ç§æœ‰ææ–™å·²è¢«æš´éœ²ï¼Œå› æ­¤è¯ä¹¦å¯èƒ½è¢«åŠé”€ã€‚</em></p><p>Although a blockchain network is more than a communications network, it relies on the PKI standard to ensure secure communication between various network participants, and to ensure that messages posted on the blockchain are properly authenticated. Itâ€™s therefore important to understand the basics of PKI and then why MSPs are so important.</p><p>å°½ç®¡åŒºå—é“¾ç½‘ç»œä¸ä»…ä»…æ˜¯é€šä¿¡ç½‘ç»œï¼Œä½†å®ƒä¾èµ–äºPKIæ ‡å‡†æ¥ç¡®ä¿å„ç§ç½‘ç»œå‚ä¸è€…ä¹‹é—´çš„å®‰å…¨é€šä¿¡ï¼Œå¹¶ç¡®ä¿æ­£ç¡®éªŒè¯å‘å¸ƒåœ¨åŒºå—é“¾ä¸Šçš„æ¶ˆæ¯ã€‚å› æ­¤ï¼Œé‡è¦çš„æ˜¯è¦äº†è§£PKIçš„åŸºç¡€çŸ¥è¯†ï¼Œç„¶åç†è§£MSPä¸ºä½•å¦‚æ­¤é‡è¦ã€‚</p><p>There are four key elements to PKIï¼ŒPKIæœ‰å››ä¸ªå…³é”®å…ƒç´ :</p><ul><li><strong>Digital Certificates</strong>ï¼ˆæ•°å­—è¯ä¹¦ï¼‰</li><li><strong>Public and Private Keys</strong>ï¼ˆå…¬ç§é’¥å¯¹ï¼‰</li><li><strong>Certificate Authorities</strong>ï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰</li><li><strong>Certificate Revocation Lists</strong>ï¼ˆè¯ä¹¦åŠé”€åˆ—è¡¨ï¼‰</li></ul><p>Letâ€™s quickly describe these PKI basics, and if you want to know more details, <a href="https://en.wikipedia.org/wiki/Public_key_infrastructure">Wikipedia</a> is a good place to start.</p><p>è®©æˆ‘ä»¬å¿«é€Ÿä»‹ç»ä¸€ä¸‹è¿™äº›PKIåŸºç¡€çŸ¥è¯†ï¼Œå¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œé‚£ä¹ˆ<a href="https://en.wikipedia.org/wiki/Public_key_infrastructure">Public_key_infrastructure</a>æ˜¯ä¸€ä¸ªä¸é”™çš„èµ·ç‚¹ã€‚</p><h2 id="Digital-Certificates-æ•°å­—è¯ä¹¦">Digital Certificates(æ•°å­—è¯ä¹¦)</h2><p>A digital certificate is a document which holds a set of attributes relating to the holder of the certificate. The most common type of certificate is the one compliant with the <a href="https://en.wikipedia.org/wiki/X.509">X.509 standard</a>, which allows the encoding of a partyâ€™s identifying details in its structure.</p><p>æ•°å­—è¯ä¹¦æ˜¯ä¸€ç§æ–‡æ¡£ï¼Œå…¶ä¸­åŒ…å«ä¸è¯ä¹¦æŒæœ‰è€…æœ‰å…³çš„ä¸€ç»„å±æ€§ã€‚æœ€å¸¸è§çš„è¯ä¹¦ç±»å‹æ˜¯ç¬¦åˆ<a href="https://en.wikipedia.org/wiki/X.509">X.509æ ‡å‡†</a>çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦å…è®¸åœ¨å…¶ç»“æ„ä¸­å¯¹å‚ä¸æ–¹çš„æ ‡è¯†è¯¦ç»†ä¿¡æ¯è¿›è¡Œç¼–ç ã€‚</p><p>For example, Mary Morris in the Manufacturing Division of Mitchell Cars in Detroit, Michigan might have a digital certificate with a <code>SUBJECT</code> attribute of <code>C=US</code>, <code>ST=Michigan</code>, <code>L=Detroit</code>, <code>O=Mitchell Cars</code>, <code>OU=Manufacturing</code>, <code>CN=Mary Morris /UID=123456</code>. Maryâ€™s certificate is similar to her government identity card â€” it provides information about Mary which she can use to prove key facts about her. There are many other attributes in an X.509 certificate, but letâ€™s concentrate on just these for now.</p><p>ä¾‹å¦‚ï¼Œåº•ç‰¹å¾‹Mitchellæ±½è½¦åˆ¶é€ éƒ¨é—¨çš„Mary Morrisï¼Œå¯†æ­‡æ ¹å·å¯èƒ½æœ‰ä¸€ä¸ªæ•°å­—è¯ä¹¦ï¼Œå…¶<code>SUBJECT</code>å±æ€§ä¸º<code>C = US</code>ï¼Œ<code>ST = Michigan</code>ï¼Œ<code>L = Detroit</code>ï¼Œ<code>O = Mitchell Cars</code>ï¼Œ<code>OU = Manufacturing</code>ï¼Œ<code>CN = Mary Morris / UID = 123456</code>ã€‚Maryçš„è¯ä¹¦ç±»ä¼¼äºå¥¹çš„æ”¿åºœèº«ä»½è¯ï¼Œå®ƒæä¾›äº†æœ‰å…³ç›ä¸½çš„ä¿¡æ¯ï¼Œå¥¹å¯ä»¥ç”¨æ¥è¯æ˜æœ‰å…³å¥¹çš„å…³é”®äº‹å®ã€‚X.509è¯ä¹¦ä¸­è¿˜æœ‰è®¸å¤šå…¶ä»–å±æ€§ï¼Œä½†ç°åœ¨è®©æˆ‘ä»¬ä»…å…³æ³¨è¿™äº›å±æ€§ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/identity.diagram.8.png" alt="identity.diagram.8"></p><p><em>A digital certificate describing a party called Mary Morris. Mary is the <code>SUBJECT</code> of the certificate, and the highlighted <code>SUBJECT</code> text shows key facts about Mary. The certificate also holds many more pieces of information, as you can see. Most importantly, Maryâ€™s public key is distributed within her certificate, whereas her private signing key is not. This signing key must be kept private.</em></p><p><em>æ•°å­—è¯ä¹¦æè¿°äº†ä¸€ä¸ªå«åšMary Morrisçš„å½“äº‹äººï¼ŒMaryæ˜¯è¯ä¹¦çš„<code>SUBJECT</code> ï¼Œçªå‡ºæ˜¾ç¤ºçš„<code>SUBJECT</code> æ–‡æœ¬æ˜¾ç¤ºäº†æœ‰å…³Maryçš„å…³é”®äº‹å®ã€‚å¦‚æ‚¨æ‰€è§ï¼Œè¯¥è¯ä¹¦è¿˜åŒ…å«æ›´å¤šä¿¡æ¯ã€‚æœ€é‡è¦çš„æ˜¯ï¼ŒMaryçš„å…¬é’¥åœ¨è¯ä¹¦ä¸­æè¿°ï¼Œä½†æ˜¯ç§é’¥æ²¡æœ‰åœ¨è¯ä¹¦ä¸­ã€‚ç­¾åç”¨çš„ç§é’¥å¿…é¡»ä¿å¯†ã€‚</em></p><p>What is important is that all of Maryâ€™s attributes can be recorded using a mathematical technique called cryptography (literally, â€œ<em>secret writing</em>â€) so that tampering will invalidate the certificate. Cryptography allows Mary to present her certificate to others to prove her identity so long as the other party trusts the certificate issuer, known as a <strong>Certificate Authority</strong> (CA). As long as the CA keeps certain cryptographic information securely (meaning, its own <strong>private signing key</strong>), anyone reading the certificate can be sure that the information about Mary has not been tampered with â€” it will always have those particular attributes for Mary Morris. Think of Maryâ€™s X.509 certificate as a digital identity card that is impossible to change.</p><p>é‡è¦çš„æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨ç§°ä¸ºåŠ å¯†çš„æ•°å­¦æŠ€æœ¯æ¥è®°å½•Maryçš„æ‰€æœ‰å±æ€§ï¼Œä»¥å…ç¯¡æ”¹è¯ä¹¦ã€‚åªè¦å¯¹æ–¹ä¿¡ä»»è¯ä¹¦é¢å‘è€…ï¼ˆ<strong>Certificate Authority</strong> (CA)ï¼‰ï¼Œå¯†ç å­¦å°±å¯ä»¥å…è®¸Maryå‘ä»–äººå‡ºç¤ºå¥¹çš„è¯ä¹¦ä»¥è¯æ˜è‡ªå·±çš„èº«ä»½ã€‚åªè¦CAå®‰å…¨åœ°ä¿å­˜æŸäº›åŠ å¯†ä¿¡æ¯ï¼ˆå³å…¶è‡ªå·±çš„ä¸“ç”¨ç­¾åå¯†é’¥ï¼‰ï¼Œä»»ä½•é˜…è¯»è¯ä¹¦çš„äººéƒ½å¯ä»¥ç¡®ä¿æœ‰å…³Maryçš„ä¿¡æ¯æœªè¢«ç¯¡æ”¹-å®ƒå§‹ç»ˆå…·æœ‰Mary Morrisçš„é‚£äº›ç‰¹å®šå±æ€§ã€‚å°†Maryçš„X.509è¯ä¹¦è§†ä¸ºæ— æ³•æ›´æ”¹çš„æ•°å­—èº«ä»½è¯ã€‚</p><h2 id="Authentication-Public-keys-and-Private-Keysï¼ˆè®¤è¯æ–¹å¼ï¼Œå…¬é’¥å’Œç§é’¥ï¼‰">Authentication, Public keys, and Private Keysï¼ˆè®¤è¯æ–¹å¼ï¼Œå…¬é’¥å’Œç§é’¥ï¼‰</h2><p>Authentication and message integrity are important concepts in secure communications. Authentication requires that parties who exchange messages are assured of the identity that created a specific message. For a message to have â€œintegrityâ€ means that cannot have been modified during its transmission. For example, you might want to be sure youâ€™re communicating with the real Mary Morris rather than an impersonator. Or if Mary has sent you a message, you might want to be sure that it hasnâ€™t been tampered with by anyone else during transmission.</p><p>èº«ä»½éªŒè¯å’Œæ¶ˆæ¯å®Œæ•´æ€§æ˜¯å®‰å…¨é€šä¿¡ä¸­çš„é‡è¦æ¦‚å¿µã€‚èº«ä»½éªŒè¯è¦æ±‚äº¤æ¢æ¶ˆæ¯çš„å„æ–¹ç¡®ä¿åˆ›å»ºäº†ç‰¹å®šæ¶ˆæ¯çš„èº«ä»½ã€‚æ¶ˆæ¯å…·æœ‰â€œå®Œæ•´æ€§â€æ„å‘³ç€ä¸èƒ½åœ¨å…¶ä¼ è¾“è¿‡ç¨‹ä¸­å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½è¦ç¡®ä¿ä¸çœŸå®çš„ç›ä¸½Â·è«é‡Œæ–¯ï¼ˆMary Morrisï¼‰è€Œéæ¨¡ä»¿è€…è¿›è¡Œäº¤æµã€‚æˆ–è€…å¦‚æœMaryå·²ç»ç»™ä½ å‘é€äº†ä¸€ä¸ªæ¶ˆæ¯ï¼Œä½ å¯èƒ½æƒ³è¦ç¡®ä¿åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«å…¶ä»–ä»»ä½•äººç¯¡æ”¹è¿‡è¯¥æ¶ˆæ¯ã€‚</p><p>Traditional authentication mechanisms rely on <strong>digital signatures</strong> that, as the name suggests, allow a party to digitally <strong>sign</strong> its messages. Digital signatures also provide guarantees on the integrity of the signed message.</p><p>Technically speaking, digital signature mechanisms require each party to hold two cryptographically connected keys: a public key that is made widely available and acts as authentication anchor, and a private key that is used to produce <strong>digital signatures</strong> on messages. Recipients of digitally signed messages can verify the origin and integrity of a received message by checking that the attached signature is valid under the public key of the expected sender.</p><p><strong>The unique relationship between a private key and the respective public key is the cryptographic magic that makes secure communications possible</strong>. The unique mathematical relationship between the keys is such that the private key can be used to produce a signature on a message that only the corresponding public key can match, and only on the same message.</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/identity.diagram.9.png" alt="identity.diagram.9"></p><p>In the example above, Mary uses her private key to sign the message. The signature can be verified by anyone who sees the signed message using her public key.</p><h2 id="Certificate-Authoritiesï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰">Certificate Authoritiesï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰</h2><p>As youâ€™ve seen, an actor or a node is able to participate in the blockchain network, via the means of a <strong>digital identity</strong> issued for it by an authority trusted by the system. In the most common case, digital identities (or simply <strong>identities</strong>) have the form of cryptographically validated digital certificates that comply with X.509 standard and are issued by a Certificate Authority (CA).</p><p>CAs are a common part of internet security protocols, and youâ€™ve probably heard of some of the more popular ones: Symantec (originally Verisign), GeoTrust, DigiCert, GoDaddy, and Comodo, among others.</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/identity.diagram.11.png" alt="identity.diagram.11"></p><p><em>A Certificate Authority dispenses certificates to different actors. These certificates are digitally signed by the CA and bind together the actor with the actorâ€™s public key (and optionally with a comprehensive list of properties). As a result, if one trusts the CA (and knows its public key), it can trust that the specific actor is bound to the public key included in the certificate, and owns the included attributes, by validating the CAâ€™s signature on the actorâ€™s certificate.</em></p><p>Certificates can be widely disseminated, as they do not include either the actorsâ€™ nor the CAâ€™s private keys. As such they can be used as anchor of trusts for authenticating messages coming from different actors.</p><p>CAs also have a certificate, which they make widely available. This allows the consumers of identities issued by a given CA to verify them by checking that the certificate could only have been generated by the holder of the corresponding private key (the CA).</p><p>In a blockchain setting, every actor who wishes to interact with the network needs an identity. In this setting, you might say that <strong>one or more CAs</strong> can be used to <strong>define the members of an organizationâ€™s from a digital perspective</strong>. Itâ€™s the CA that provides the basis for an organizationâ€™s actors to have a verifiable digital identity.</p><h3 id="Root-CAs-Intermediate-CAs-and-Chains-of-Trustï¼ˆæ ¹CAã€ä¸­çº§CAå’Œä¿¡ä»»é“¾ï¼‰">Root CAs, Intermediate CAs and Chains of Trustï¼ˆæ ¹CAã€ä¸­çº§CAå’Œä¿¡ä»»é“¾ï¼‰</h3><p>CAs come in two flavors: <strong>Root CAs</strong> and <strong>Intermediate CAs</strong>. Because Root CAs (Symantec, Geotrust, etc) have to <strong>securely distribute</strong> hundreds of millions of certificates to internet users, it makes sense to spread this process out across what are called <em>Intermediate CAs</em>. These Intermediate CAs have their certificates issued by the root CA or another intermediate authority, allowing the establishment of a â€œchain of trustâ€ for any certificate that is issued by any CA in the chain. This ability to track back to the Root CA not only allows the function of CAs to scale while still providing security â€” allowing organizations that consume certificates to use Intermediate CAs with confidence â€” it limits the exposure of the Root CA, which, if compromised, would endanger the entire chain of trust. If an Intermediate CA is compromised, on the other hand, there will be a much smaller exposure.</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/identity.diagram.1.png" alt="identity.diagram.1"></p><p><em>A chain of trust is established between a Root CA and a set of Intermediate CAs as long as the issuing CA for the certificate of each of these Intermediate CAs is either the Root CA itself or has a chain of trust to the Root CA.</em></p><p>Intermediate CAs provide a huge amount of flexibility when it comes to the issuance of certificates across multiple organizations, and thatâ€™s very helpful in a permissioned blockchain system (like Fabric). For example, youâ€™ll see that different organizations may use different Root CAs, or the same Root CA with different Intermediate CAs â€” it really does depend on the needs of the network.</p><h3 id="Fabric-CA">Fabric CA</h3><p>Itâ€™s because CAs are so important that Fabric provides a built-in CA component to allow you to create CAs in the blockchain networks you form. This component â€” known as <strong>Fabric CA</strong> is a private root CA provider capable of managing digital identities of Fabric participants that have the form of X.509 certificates. Because Fabric CA is a custom CA targeting the Root CA needs of Fabric, it is inherently not capable of providing SSL certificates for general/automatic use in browsers. However, because <strong>some</strong> CA must be used to manage identity (even in a test environment), Fabric CA can be used to provide and manage certificates. It is also possible â€” and fully appropriate â€” to use a public/commercial root or intermediate CA to provide identification.</p><p>å› ä¸ºCAéå¸¸é‡è¦ï¼Œæ‰€ä»¥Fabricæä¾›äº†å†…ç½®çš„CAç»„ä»¶ï¼Œå¯è®©æ‚¨åœ¨å½¢æˆçš„åŒºå—é“¾ç½‘ç»œä¸­åˆ›å»ºCAã€‚è¯¥ç»„ä»¶ï¼ˆç§°ä¸º<strong>Fabric CA</strong>ï¼‰æ˜¯ç§æœ‰çš„æ ¹CAæä¾›è€…ï¼Œèƒ½å¤Ÿç®¡ç†å…·æœ‰X.509è¯ä¹¦å½¢å¼çš„Fabricå‚ä¸è€…çš„æ•°å­—èº«ä»½ã€‚ç”±äºFabric CAæ˜¯é’ˆå¯¹Fabricçš„æ ¹CAéœ€æ±‚çš„è‡ªå®šä¹‰CAï¼Œå› æ­¤å®ƒå›ºæœ‰åœ°æ— æ³•æä¾›SSLè¯ä¹¦ä¾›æµè§ˆå™¨ä¸­çš„å¸¸è§„/è‡ªåŠ¨ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œç”±äºå¿…é¡»ä½¿ç”¨æŸäº›CAæ¥ç®¡ç†èº«ä»½ï¼ˆå³ä½¿åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ï¼Œå› æ­¤å¯ä»¥å°†Fabric CAç”¨äºæä¾›å’Œç®¡ç†è¯ä¹¦ã€‚ä½¿ç”¨å…¬å…±/å•†ä¸šæ ¹æˆ–ä¸­é—´CAè¿›è¡Œæ ‡è¯†ä¹Ÿæ˜¯å¯èƒ½çš„ï¼Œå¹¶ä¸”æ˜¯å®Œå…¨åˆé€‚çš„ã€‚</p><p>If youâ€™re interested, you can read a lot more about Fabric CA <a href="http://hyperledger-fabric-ca.readthedocs.io/">in the CA documentation section</a>.</p><p>å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥ åœ¨<a href="http://hyperledger-fabric-ca.readthedocs.io/">the CA documentation section</a>æ–‡æ¡£ä¸­é˜…è¯»æ›´å¤šçš„å…³äº Fabric CAçš„å†…å®¹ã€‚</p><h2 id="Certificate-Revocation-Listsï¼ˆè¯ä¹¦åŠé”€åˆ—è¡¨ï¼‰">Certificate Revocation Listsï¼ˆè¯ä¹¦åŠé”€åˆ—è¡¨ï¼‰</h2><p>A Certificate Revocation List (CRL) is easy to understand â€” itâ€™s just a list of references to certificates that a CA knows to be revoked for one reason or another. If you recall the store scenario, a CRL would be like a list of stolen credit cards.</p><p>When a third party wants to verify another partyâ€™s identity, it first checks the issuing CAâ€™s CRL to make sure that the certificate has not been revoked. A verifier doesnâ€™t have to check the CRL, but if they donâ€™t they run the risk of accepting a compromised identity.</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/identity.diagram.12.png" alt="identity.diagram.12"></p><p><em>Using a CRL to check that a certificate is still valid. If an impersonator tries to pass a compromised digital certificate to a validating party, it can be first checked against the issuing CAâ€™s CRL to make sure itâ€™s not listed as no longer valid.</em></p><p>Note that a certificate being revoked is very different from a certificate expiring. Revoked certificates have not expired â€” they are, by every other measure, a fully valid certificate. For more in-depth information about CRLs, click <a href="https://hyperledger-fabric-ca.readthedocs.io/en/latest/users-guide.html#generating-a-crl-certificate-revocation-list">here</a>.</p><p>Now that youâ€™ve seen how a PKI can provide verifiable identities through a chain of trust, the next step is to see how these identities can be used to represent the trusted members of a blockchain network. Thatâ€™s where a Membership Service Provider (MSP) comes into play â€” <strong>it identifies the parties who are the members of a given organization in the blockchain network</strong>.</p><p>To learn more about membership, check out the conceptual documentation on <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/membership/membership.html">MSPs</a>.</p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> Key Concepts </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> Identity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>The Ordering Service</title>
      <link href="2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/The-Ordering-Service/"/>
      <url>2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/The-Ordering-Service/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ¡£æ¥è‡ª<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/orderer/ordering_service.html">The Ordering Service</a>,æœ‰æ‰€ç®€åŒ–ã€‚</p><h2 id="What-is-ordering">What is ordering?</h2><p>Many distributed blockchains, such as Ethereum and Bitcoin, are not permissioned, which means that any node can participate in the consensus process, wherein transactions are ordered and bundled into blocks. Because of this fact, these systems rely on <strong>probabilistic</strong> consensus algorithms which eventually guarantee ledger consistency to a high degree of probability, but which are still vulnerable to divergent ledgers (also known as a ledger â€œforkâ€), where different participants in the network have a different view of the accepted order of transactions.</p><p>è®¸å¤šçš„åˆ†å¸ƒå¼åŒºå—é“¾ç³»ç»Ÿï¼Œä¾‹å¦‚ä»¥å¤ªåŠå’Œæ¯”ç‰¹å¸éƒ½æ˜¯ä¸éœ€è¦è®¤å¯çš„ï¼›è¿™æ„å‘³ç€ä»»ä½•èŠ‚ç‚¹éƒ½å¯ä»¥å‚ä¸å…±è¯†è¿‡ç¨‹ï¼Œè¿™ä¸ªå…±è¯†å°±æ˜¯æŠŠäº¤æ˜“æ’åºå¹¶æ‰“åŒ…æˆåŒºå—ã€‚ç”±äºè¿™ä¸ªäº‹å®ï¼Œè¿™äº›ç³»ç»Ÿä¾èµ–äºæ¦‚ç‡å…±è¯†ç®—æ³•ï¼ˆç›®å‰æ˜¯Powå…±è¯†ç®—æ³•ï¼‰ï¼Œè¯¥ç®—æ³•æœ€ç»ˆå¯ä»¥ç¡®ä¿åˆ†ç±»å¸çš„ä¸€è‡´æ€§å…·æœ‰å¾ˆé«˜çš„æ¦‚ç‡ï¼Œä½†æ˜¯å®ƒä»¬ä»ç„¶å®¹æ˜“æ”¶åˆ°åˆ†å‰çš„å½±å“ï¼Œåœ¨åˆ†å‰çš„åˆ†ç±»è´¦ä¸­ï¼Œç½‘ç»œä¸­çš„ä¸åŒå‚ä¸è€…å¯¹æ¥å—çš„äº¤æ˜“é¡ºåºæœ‰ä¸åŒçš„çœ‹æ³•ã€‚</p><p>Hyperledger Fabric works differently. It features a node called an <strong>orderer</strong> (itâ€™s also known as an â€œordering nodeâ€) that does this transaction ordering, which along with other orderer nodes forms an <strong>ordering service</strong>. Because Fabricâ€™s design relies on <strong>deterministic</strong> consensus algorithms, any block validated by the peer is guaranteed to be final and correct. Ledgers cannot fork the way they do in many other distributed and permissionless blockchain networks.</p><p>Hyperledger Fabricçš„å·¥ä½œæ–¹å¼æœ‰æ‰€ä¸åŒã€‚å®ƒå…·æœ‰ä¸€ä¸ªç§°ä¸ºâ€œæ’åºè€…â€çš„èŠ‚ç‚¹ï¼ˆä¹Ÿç§°ä¸ºâ€œæ’åºèŠ‚ç‚¹â€ï¼‰æ¥æ‰§è¡Œæ­¤äº¤æ˜“çš„æ’åºï¼Œè¯¥èŠ‚ç‚¹ä¸å…¶ä»–æ’åºèŠ‚ç‚¹ä¸€èµ·æ„æˆæ’åºæœåŠ¡ã€‚ç”±äºFabricçš„è®¾è®¡ä¾èµ–äºç¡®å®šæ€§å…±è¯†ç®—æ³•ï¼Œå› æ­¤å¯ä»¥ä¿è¯peeréªŒè¯çš„ä»»ä½•å—éƒ½æ˜¯æœ€ç»ˆçš„å’Œæ­£ç¡®çš„ã€‚è´¦æœ¬ä¹Ÿä¸ä¼šåƒä»¥å¤ªåŠå’Œæ¯”ç‰¹å¸é‚£æ ·å‡ºç°åˆ†å‰ã€‚</p><p>In addition to promoting finality, separating the endorsement of chaincode execution (which happens at the peers) from ordering gives Fabric advantages in performance and scalability, eliminating bottlenecks which can occur when execution and ordering are performed by the same nodes.</p><p>é™¤äº†ä¿ƒè¿›ä¸å¯å˜æ€§ä¹‹å¤–ï¼Œå°†é“¾ç æ‰§è¡Œçš„èƒŒä¹¦ï¼ˆåœ¨åŒçº§ä¸­å‘ç”Ÿï¼‰ä¸æ’åºåˆ†å¼€å¯ä»¥ä½¿Fabricåœ¨æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§æ–¹é¢å…·æœ‰ä¼˜åŠ¿ï¼Œæ¶ˆé™¤äº†ç”±ç›¸åŒèŠ‚ç‚¹æ‰§è¡Œå’Œæ’åºæ—¶å¯èƒ½å‘ç”Ÿçš„ç“¶é¢ˆã€‚</p><h2 id="Orderer-nodes-and-channel-configuration">Orderer nodes and channel configuration</h2><p>In addition to their <strong>ordering</strong> role, orderers also maintain the list of organizations that are allowed to create channels. This list of organizations is known as the â€œconsortiumâ€, and the list itself is kept in the configuration of the â€œorderer system channelâ€ (also known as the â€œordering system channelâ€). By default, this list, and the channel it lives on, can only be edited by the orderer admin. Note that it is possible for an ordering service to hold several of these lists, which makes the consortium a vehicle for Fabric multi-tenancy.</p><p>é™¤äº†ä½œä¸ºæ’åºçš„è§’è‰²ä¹‹å¤–ï¼Œorderersè¿˜ç»´æŠ¤å…è®¸åˆ›å»ºé€šé“çš„ç»„ç»‡çš„åˆ—è¡¨ã€‚è¿™ä¸ªç»„ç»‡çš„åˆ—è¡¨è¢«ç§°ä¸ºâ€œè”ç›Ÿâ€ï¼Œå¹¶ä¸”è¿™ä¸ªåˆ—è¡¨è¢«ä¿å­˜åœ¨ â€œorderer system channelâ€ çš„é…ç½®ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤åˆ—è¡¨åŠå…¶æ‰€å¤„çš„é€šé“åªèƒ½ç”±ordererçš„ç®¡ç†å‘˜è¿›è¡Œç¼–è¾‘ã€‚</p><p>Orderers also enforce basic access control for channels, restricting who can read and write data to them, and who can configure them. Remember that who is authorized to modify a configuration element in a channel is subject to the policies that the relevant administrators set when they created the consortium or the channel. Configuration transactions are processed by the orderer, as it needs to know the current set of policies to execute its basic form of access control. In this case, the orderer processes the configuration update to make sure that the requestor has the proper administrative rights. If so, the orderer validates the update request against the existing configuration, generates a new configuration transaction, and packages it into a block that is relayed to all peers on the channel. The peers then process the configuration transactions in order to verify that the modifications approved by the orderer do indeed satisfy the policies defined in the channel.</p><p>Orderersè¿˜å¯¹é€šé“å®æ–½åŸºæœ¬è®¿é—®æ§åˆ¶ï¼Œé™åˆ¶è°å¯ä»¥å‘é€šé“è¯»å–å’Œå†™å…¥æ•°æ®ä»¥åŠè°å¯ä»¥å¯¹å…¶è¿›è¡Œé…ç½®ã€‚</p><h2 id="Orderer-nodes-and-identity">Orderer nodes and identity</h2><p>Everything that interacts with a blockchain network, including peers, applications, admins, and orderers, acquires their organizational identity from their digital certificate and their Membership Service Provider (MSP) definition.</p><p>For more information about identities and MSPs, check out our documentation on <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/identity/identity.html">Identity</a> and <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/membership/membership.html">Membership</a>.</p><p>Just like peers, ordering nodes belong to an organization. And similar to peers, a separate Certificate Authority (CA) should be used for each organization. Whether this CA will function as the root CA, or whether you choose to deploy a root CA and then intermediate CAs associated with that root CA, is up to you.</p><h2 id="Orderers-and-the-transaction-flow">Orderers and the transaction flow</h2><h3 id="Phase-one-Proposal">Phase one: Proposal</h3><p>Weâ€™ve seen from our topic on <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/peers/peers.html">Peers</a> that they form the basis for a blockchain network, hosting ledgers, which can be queried and updated by applications through smart contracts.</p><p>Specifically, applications that want to update the ledger are involved in a process with three phases that ensures all of the peers in a blockchain network keep their ledgers consistent with each other.</p><p>å…·ä½“æ¥è¯´ï¼Œåº”ç”¨ç¨‹åºæƒ³è¦æ›´æ–°è´¦æœ¬éœ€è¦æ¶‰åŠä¸‰ä¸ªé˜¶æ®µçš„è¿‡ç¨‹æ¥ç¡®ä¿åŒºå—é“¾ç½‘ç»œä¸­çš„æ‰€æœ‰peerèŠ‚ç‚¹ä¿æŒè´¦æœ¬å½¼æ­¤ä¸€è‡´ã€‚</p><p>In the first phase, a client application sends a transaction proposal to a subset of peers that will invoke a smart contract to produce a proposed ledger update and then endorse the results. The endorsing peers do not apply the proposed update to their copy of the ledger at this time. Instead, the endorsing peers return a proposal response to the client application. The endorsed transaction proposals will ultimately be ordered into blocks in phase two, and then distributed to all peers for final validation and commit in phase three.</p><p>åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µä¸­ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå°†äº¤æ˜“å»ºè®®å‘é€ç»™ä¸€äº›peerèŠ‚ç‚¹ï¼Œè¿™äº›peerèŠ‚ç‚¹å°†è°ƒç”¨æ™ºèƒ½åˆçº¦ä»¥äº§ç”Ÿæè®®çš„è´¦æœ¬æ›´æ–°ï¼Œç„¶åå¯¹ç»“æœè¿›è¡ŒèƒŒä¹¦ã€‚èƒŒä¹¦çš„peerèŠ‚ç‚¹æ­¤æ—¶ä¸å°†å»ºè®®çš„æ›´æ–°åº”ç”¨äºå…¶è´¦æœ¬å‰¯æœ¬ã€‚ç›¸åï¼ŒèƒŒä¹¦çš„å¯¹ç­‰æ–¹å°†æè®®å“åº”è¿”å›åˆ°å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚ç„¶åè®¤å¯çš„äº¤æ˜“å»ºè®®å°†æœ€ç»ˆåœ¨ç¬¬äºŒé˜¶æ®µæŒ‰é¡ºåºæ’åˆ—ï¼Œç„¶ååˆ†å‘ç»™æ‰€æœ‰peerèŠ‚ç‚¹ä»¥è¿›è¡Œæœ€ç»ˆéªŒè¯å¹¶åœ¨ç¬¬ä¸‰é˜¶æ®µè¿›è¡Œæäº¤ã€‚</p><p>For an in-depth look at the first phase, refer back to the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/peers/peers.html#phase-1-proposal">Peers</a> topic.</p><h3 id="Phase-two-Ordering-and-packaging-transactions-into-blocks">Phase two: Ordering and packaging transactions into blocks</h3><p>After the completion of the first phase of a transaction, a client application has received an endorsed transaction proposal response from a set of peers. Itâ€™s now time for the second phase of a transaction.</p><p>åœ¨å®Œæˆäº¤æ˜“çš„ç¬¬ä¸€é˜¶æ®µä¹‹åï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå·²ç»æ¥æ”¶åˆ°æ¥è‡ªä¸€ç¾¤peerèŠ‚ç‚¹çš„å·²ç»èƒŒä¹¦çš„äº¤æ˜“æè®®å“åº”ã€‚***</p><p>In this phase, application clients submit transactions containing endorsed transaction proposal responses to an ordering service node. The ordering service creates blocks of transactions which will ultimately be distributed to all peers on the channel for final validation and commit in phase three.</p><p>åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæäº¤åŒ…å«å·²ç»èƒŒä¹¦çš„äº¤æ˜“æè®®å“åº”çš„äº¤æ˜“åˆ°ä¸€ä¸ªæ’åºæœåŠ¡èŠ‚ç‚¹ã€‚æ’åºæœåŠ¡åˆ›å»ºåŒ…å«äº¤æ˜“çš„åŒºå—ï¼Œè¿™ä¸ªåŒºå—æœ€ç»ˆå°†åˆ†å‘ç»™é€šé“ä¸Šçš„æ‰€æœ‰peerèŠ‚ç‚¹ï¼Œä»¥è¿›è¡Œæœ€ç»ˆéªŒè¯å¹¶åœ¨ç¬¬ä¸‰é˜¶æ®µè¿›è¡Œæäº¤ã€‚</p><p>Ordering service nodes receive transactions from many different application clients concurrently. These ordering service nodes work together to collectively form the ordering service. Its job is to arrange batches of submitted transactions into a well-defined sequence and package them into <em>blocks</em>. These blocks will become the <em>blocks</em> of the blockchain!</p><p>æ’åºæœåŠ¡èŠ‚ç‚¹åŒæ—¶æ¥æ”¶æ¥è‡ªè®¸å¤šä¸åŒåº”ç”¨ç¨‹åºå®¢æˆ·ç«¯çš„äº¤æ˜“ã€‚è¿™äº›æ’åºæœåŠ¡èŠ‚ç‚¹ä¸€èµ·å·¥ä½œä»¥å…±åŒå½¢æˆæ’åºæœåŠ¡ã€‚æ’åºæœåŠ¡çš„å·¥ä½œæ˜¯å¯¹æäº¤è¿‡æ¥çš„æ‰¹é‡çš„äº¤æ˜“å®‰æ’ä¸€ä¸ªæ˜ç¡®å®šä¹‰çš„é¡ºåºï¼Œå¹¶å°†å®ƒä»¬æ‰“åŒ…æˆåŒºå—ã€‚è¿™äº›åŒºå—å°†æˆä¸ºåŒºå—é“¾çš„åŒºå—ï¼</p><p>The number of transactions in a block depends on channel configuration parameters related to the desired size and maximum elapsed duration for a block (<code>BatchSize</code> and <code>BatchTimeout</code> parameters, to be exact). The blocks are then saved to the ordererâ€™s ledger and distributed to all peers that have joined the channel. If a peer happens to be down at this time, or joins the channel later, it will receive the blocks after reconnecting to an ordering service node, or by gossiping with another peer. Weâ€™ll see how this block is processed by peers in the third phase.</p><p>åŒºå—ä¸­çš„äº¤æ˜“æ•°é‡å–å†³äºé€šé“é…ç½®å‚æ•°ï¼Œä¸åŒºå—çš„æ‰€éœ€å¤§å°å’Œæœ€å¤§ç»è¿‡æ—¶é—´æœ‰å…³ï¼ˆæ›´ç²¾ç¡®çš„è¯´æ˜¯<code>BatchSize</code> å’Œ <code>BatchTimeout</code> ä¸¤ä¸ªå‚æ•°ï¼‰ã€‚ç„¶åè¿™ä¸ªåŒºå—è¢«ä¿å­˜åˆ°æ’åºè€…çš„è´¦æœ¬ä¸­å¹¶åˆ†å‘ç»™åŠ å…¥åˆ°é€šé“çš„æ‰€æœ‰peerèŠ‚ç‚¹ã€‚å¦‚æœæŸä¸ªpeerèŠ‚ç‚¹åœ¨è¿™æ—¶å‘ç”Ÿäº†å®•æœºæˆ–è€…åœ¨è¿™ä»¥ååŠ å…¥åˆ°é€šé“ï¼Œä»–ä¼šåœ¨é‡æ–°è¿æ¥åˆ°æ’åºæœåŠ¡èŠ‚ç‚¹ä¹‹åæ”¶åˆ°æ­¤åŒºå—ï¼Œæˆ–è€…é€šè¿‡gossipingä»å…¶ä»–peerè·å–ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/orderer.diagram.1.png" alt="Orderer1"></p><p><em>The first role of an ordering node is to package proposed ledger updates. In this example, application A1 sends a transaction T1 endorsed by E1 and E2 to the orderer O1. In parallel, Application A2 sends transaction T2 endorsed by E1 to the orderer O1. O1 packages transaction T1 from application A1 and transaction T2 from application A2 together with other transactions from other applications in the network into block B2. We can see that in B2, the transaction order is T1,T2,T3,T4,T6,T5 â€“ which may not be the order in which these transactions arrived at the orderer! (This example shows a very simplified ordering service configuration with only one ordering node.)</em></p><p><em>æ’åºèŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªè§’è‰²æ—¶æ‰“åŒ…æè®®çš„è´¦æœ¬æ›´æ–°ã€‚</em></p><p>Itâ€™s worth noting that the sequencing of transactions in a block is not necessarily the same as the order received by the ordering service, since there can be multiple ordering service nodes that receive transactions at approximately the same time. Whatâ€™s important is that the ordering service puts the transactions into a strict order, and peers will use this order when validating and committing transactions.</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ªåŒºå—ä¸­çš„äº¤æ˜“é¡ºåºä¸ä¸€å®šä¸æ’åºæœåŠ¡æ‰€æ¥æ”¶çš„è®¢å•é¡ºåºç›¸åŒï¼Œå› ä¸ºå¯èƒ½æœ‰å¤šä¸ªæ’åºæœåŠ¡èŠ‚ç‚¹å¤§çº¦åœ¨åŒä¸€æ—¶é—´æ¥æ”¶äº¤æ˜“ã€‚é‡è¦çš„æ˜¯æ’åºæœåŠ¡å°†äº¤æ˜“ç½®äºä¸¥æ ¼çš„é¡ºåºä¸­ï¼Œå¹¶ä¸”peerèŠ‚ç‚¹åœ¨éªŒè¯å’Œæäº¤äº¤æ˜“æ—¶å°†ä½¿ç”¨è¯¥é¡ºåºã€‚</p><p><em>ä¸ªäººç†è§£ï¼šçœ‹ç¬¬ä¸€éæ—¶è§‰å¾—å¤šä¸ªæ’åºæœåŠ¡èŠ‚ç‚¹æ”¶åˆ°ä¸åŒçš„äº¤æ˜“è¿›è¡Œæ’åºï¼Œè¿™äº›æ’åºæœåŠ¡æ˜¯å¦‚ä½•ä¿æŒäº¤æ˜“é¡ºåºçš„ä¸€è‡´æ€§çš„å‘¢ï¼Ÿå¦‚æœæŠŠæ’åºæœåŠ¡çœ‹ä½œä¸€ä¸ªæ•´ä½“è¿™ä¸ªé—®é¢˜å°±è§£å†³äº†ï¼Œä¸åŒçš„æ’åºæœåŠ¡èŠ‚ç‚¹æ¥æ”¶åˆ°äº¤æ˜“ä¹‹åè¿˜ä¼šå¯¹æ‰€æœ‰çš„æ¥æ”¶åˆ°çš„äº¤æ˜“åšä¸€ä¸ªæ±‡æ€»ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªæ’åºæœåŠ¡èŠ‚ç‚¹éƒ½å¯¹äº¤æ˜“è¿›è¡Œæ’åºã€‚å†µä¸”æ¯ä¸ªæ’åºæœåŠ¡èŠ‚ç‚¹åªæ˜¯æ¥æ”¶è¿æ¥åˆ°è¿™ä¸ªæ’åºæœåŠ¡èŠ‚ç‚¹çš„åº”ç”¨ç¨‹åºçš„äº¤æ˜“ï¼Œæ‰€ä»¥æ¥æ”¶åˆ°çš„äº¤æ˜“å¹¶ä¸æ˜¯æ•´ä¸ªé€šé“ä¸Šçš„æ‰€æœ‰çš„äº¤æ˜“å†…å®¹ï¼Œå› æ­¤è‚¯å®šæ˜¯ä¸èƒ½å¤Ÿç”±æ’åºæœåŠ¡èŠ‚ç‚¹è¿›è¡Œå•ç‹¬æ’åºçš„ã€‚</em></p><p>This strict ordering of transactions within blocks makes Hyperledger Fabric a little different from other blockchains where the same transaction can be packaged into multiple different blocks that compete to form a chain. In Hyperledger Fabric, the blocks generated by the ordering service are <strong>final</strong>. Once a transaction has been written to a block, its position in the ledger is immutably assured. As we said earlier, Hyperledger Fabricâ€™s finality means that there are no <strong>ledger forks</strong> â€” validated transactions will never be reverted or dropped.</p><p>è¿™ç§åŒºå—å†…çš„äº¤æ˜“å…·æœ‰ä¸¥æ ¼çš„é¡ºåºä½¿Hyperledger Fabricå’Œå…¶ä»–çš„åŒºå—é“¾ç³»ç»Ÿæœ‰ä¸€ç‚¹ä¸åŒï¼Œå…¶ä»–çš„åŒºå—é“¾ç³»ç»Ÿç›¸åŒçš„äº¤æ˜“å¯ä»¥è¢«æ‰“åŒ…åˆ°ä¸åŒåŒºå—ä¸­ç„¶åç«äº‰å½¢æˆä¸€ä¸ªé“¾ã€‚åœ¨ Hyperledger Fabricä¸­ï¼Œç”±æ’åºæœåŠ¡ç”Ÿæˆçš„åŒºå—æ˜¯æœ€ç»ˆçš„ã€‚ä¸€æ—¦ä¸€ä¸ªäº¤æ˜“è¢«å†™å…¥ä¸€ä¸ªåŒºå—ï¼Œå®ƒåœ¨è´¦æœ¬ä¸­çš„ä½ç½®å°±æ°¸è¿œä¸å˜äº†ã€‚åƒæˆ‘ä»¬ä¹‹å‰è¯´çš„ï¼Œ Hyperledger Fabricçš„æœ€ç»ˆæ€§æ„å‘³ç€æ²¡æœ‰è´¦æœ¬åˆ†å‰ â€“ ç»éªŒè¯çš„äº¤æ˜“å°†æ°¸è¿œä¸ä¼šè¢«å›æ»šæˆ–ä¸¢å¼ƒã€‚</p><p>We can also see that, whereas peers execute smart contracts and process transactions, orderers most definitely do not. Every authorized transaction that arrives at an orderer is mechanically packaged in a block â€” the orderer makes no judgement as to the content of a transaction (except for channel configuration transactions, as mentioned earlier).</p><p>æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ï¼ŒpeerèŠ‚ç‚¹æ‰§è¡Œæ™ºèƒ½åˆçº¦å¹¶å¤„ç†äº¤æ˜“ï¼Œè€Œæ’åºè€…ç»å¯¹ä¸ä¼šåšè¿™äº›ã€‚åˆ°è¾¾æ’åºè€…çš„æ¯ç¬”å·²ç»æˆæƒäº¤æ˜“ä»¥æœºæ¢°æ–¹å¼æ‰“åŒ…åœ¨ä¸€ä¸ªåŒºå—ä¸­ â€“ æ’åºè€…ä¸å¯¹äº¤æ˜“çš„å†…å®¹åšå‡ºåˆ¤æ–­ï¼ˆé™¤äº†å‰é¢æ‰€è¿°çš„é€šé“é…ç½®äº¤æ˜“ï¼‰ã€‚</p><p>At the end of phase two, we see that orderers have been responsible for the simple but vital processes of collecting proposed transaction updates, ordering them, and packaging them into blocks, ready for distribution.</p><p>åœ¨ç¬¬äºŒé˜¶æ®µçš„æœ€åï¼Œæˆ‘ä»¬çœ‹åˆ°æ’åºè€…è´Ÿè´£ç®€å•ä½†è‡³å…³é‡è¦çš„è¿‡ç¨‹ï¼Œè¿™äº›è¿‡ç¨‹åŒ…æ‹¬æ”¶é›†æè®®çš„äº¤æ˜“æ›´æ–°ï¼Œè¿›è¡Œæ’åºå¹¶å°†å®ƒä»¬æ‰“åŒ…æˆåŒºå—ä»¥ä¾¿åˆ†å‘ã€‚</p><h3 id="Phase-three-Validation-and-commit">Phase three: Validation and commit</h3><p>The third phase of the transaction workflow involves the distribution and subsequent validation of blocks from the orderer to the peers, where they can be committed to the ledger.</p><p>Phase 3 begins with the orderer distributing blocks to all peers connected to it. Itâ€™s also worth noting that not every peer needs to be connected to an orderer â€” peers can cascade blocks to other peers using the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/gossip.html"><strong>gossip</strong></a> protocol.</p><p>Each peer will validate distributed blocks independently, but in a deterministic fashion, ensuring that ledgers remain consistent. Specifically, each peer in the channel will validate each transaction in the block to ensure it has been endorsed by the required organizationâ€™s peers, that its endorsements match, and that it hasnâ€™t become invalidated by other recently committed transactions which may have been in-flight when the transaction was originally endorsed. Invalidated transactions are still retained in the immutable block created by the orderer, but they are marked as invalid by the peer and do not update the ledgerâ€™s state.</p><p><img src="https://gitee.com/guozhe001/images/raw/master/orderer.diagram.2.png" alt="Orderer2"></p><p><em>The second role of an ordering node is to distribute blocks to peers. In this example, orderer O1 distributes block B2 to peer P1 and peer P2. Peer P1 processes block B2, resulting in a new block being added to ledger L1 on P1. In parallel, peer P2 processes block B2, resulting in a new block being added to ledger L1 on P2. Once this process is complete, the ledger L1 has been consistently updated on peers P1 and P2, and each may inform connected applications that the transaction has been processed.</em></p><p>In summary, phase three sees the blocks generated by the ordering service applied consistently to the ledger. The strict ordering of transactions into blocks allows each peer to validate that transaction updates are consistently applied across the blockchain network.</p><p>For a deeper look at phase 3, refer back to the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/peers/peers.html#phase-3-validation-and-commit">Peers</a> topic.</p><h2 id="Ordering-service-implementations">Ordering service implementations</h2><p>While every ordering service currently available handles transactions and configuration updates the same way, there are nevertheless several different implementations for achieving consensus on the strict ordering of transactions between ordering service nodes.</p><p>å½“å‰å¯ç”¨çš„æ¯ä¸ªæ’åºæœåŠ¡éƒ½ä»¥ç›¸åŒçš„æ–¹å¼å¤„ç†äº¤æ˜“å’Œé…ç½®æ›´æ–°ï¼Œä½†æ˜¯æœ‰å‡ ç§ä¸åŒçš„å®ç°æ–¹å¼å¯ç”¨äºåœ¨æ’åºæœåŠ¡èŠ‚ç‚¹ä¹‹é—´å¯¹ä¸¥æ ¼çš„äº¤æ˜“é¡ºåºè¾¾æˆå…±è¯†ã€‚</p><p>For information about how to stand up an ordering node (regardless of the implementation the node will be used in), check out <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/orderer_deploy.html">our documentation on standing up an ordering node</a>.</p><ul><li><p><strong>Raft</strong> (recommended)</p><p>New as of v1.4.1, Raft is a crash fault tolerant (CFT) ordering service based on an implementation of <a href="https://raft.github.io/raft.pdf">Raft protocol</a> in <a href="https://coreos.com/etcd/"><code>etcd</code></a>. Raft follows a â€œleader and followerâ€ model, where a leader node is elected (per channel) and its decisions are replicated by the followers. Raft ordering services should be easier to set up and manage than Kafka-based ordering services, and their design allows different organizations to contribute nodes to a distributed ordering service.</p><p>è‡ªv1.4.1èµ·æ–°å¢ï¼ŒRaftæ˜¯åŸºäº<a href="https://coreos.com/etcd/"><code>etcd</code></a>çš„ <a href="https://raft.github.io/raft.pdf">Raft åè®®</a> å®ç°çš„æ•…éšœå®¹é”™æ’åºæœåŠ¡ã€‚Raftéµä»â€œé¢†å¯¼è€…å’Œè·Ÿéšè€…â€æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹æ˜¯é¢†å¯¼è€…èŠ‚ç‚¹ï¼ˆæŒ‰é€šé“ï¼‰è¢«é€‰å‡ºå¹¶ç”±è·Ÿéšè€…å¤åˆ¶å…¶å†³ç­–ã€‚Raftåè®®æ’åºæœåŠ¡ç›¸è¾ƒäºåŸºäºKafkaçš„æ’åºæœåŠ¡æ›´å®¹æ˜“è®¾ç½®å’Œç®¡ç†ï¼Œå…¶è®¾è®¡å…è®¸ä¸åŒçš„ç»„ç»‡å°†èŠ‚ç‚¹è´¡çŒ®ç»™åˆ†å¸ƒå¼æ’åºæœåŠ¡ã€‚ï¼ˆ<em>ä¸ªäººç†è§£æœ€åä¸€å¥è¯æ˜¯è¯´æ’åºæœåŠ¡æ˜¯ç”±ä¸åŒç»„ç»‡çš„æ’åºæœåŠ¡èŠ‚ç‚¹ç»„æˆ</em>ï¼‰</p></li><li><p><strong>Kafka</strong> (deprecated in v2.x)</p><p>Similar to Raft-based ordering, Apache Kafka is a CFT implementation that uses a â€œleader and followerâ€ node configuration. Kafka utilizes a ZooKeeper ensemble for management purposes. The Kafka based ordering service has been available since Fabric v1.0, but many users may find the additional administrative overhead of managing a Kafka cluster intimidating or undesirable.</p><p>ä¸åŸºäºRaftçš„æ’åºç±»ä¼¼ï¼ŒApache Kafkaæ˜¯ä½¿ç”¨â€œé¢†å¯¼è€…å’Œè·Ÿéšè€…â€èŠ‚ç‚¹é…ç½®çš„CFTå®ç°ã€‚Kafkaåˆ©ç”¨ZooKeeperé›†åˆè¿›è¡Œç®¡ç†ã€‚ä»Fabric v1.0å¼€å§‹æä¾›åŸºäºKafkaçš„æ’åºæœåŠ¡ï¼Œä½†æ˜¯è®¸å¤šç”¨æˆ·å¯èƒ½ä¼šå‘ç°ç®¡ç†Kafkaç¾¤é›†çš„é¢å¤–ç®¡ç†å¼€é”€ä»¤äººç”Ÿç•æˆ–ä¸å—æ¬¢è¿ã€‚</p></li><li><p><strong>Solo</strong> (deprecated in v2.x)</p><p>The Solo implementation of the ordering service is intended for test only and consists only of a single ordering node. It has been deprecated and may be removed entirely in a future release. Existing users of Solo should move to a single node Raft network for equivalent function.</p><p>æ’åºæœåŠ¡çš„Soloå®ç°ä»…ç”¨äºæµ‹è¯•ï¼Œå¹¶ä¸”ä»…åŒ…å«ä¸€ä¸ªè®¢è´­èŠ‚ç‚¹ã€‚å®ƒå·²è¢«å¼ƒç”¨ï¼Œåœ¨å°†æ¥çš„å‘è¡Œç‰ˆä¸­å¯èƒ½ä¼šå®Œå…¨åˆ é™¤ã€‚Soloçš„ç°æœ‰ç”¨æˆ·åº”ç§»è‡³å•èŠ‚ç‚¹Raftç½‘ç»œä»¥å®ç°ç­‰æ•ˆåŠŸèƒ½ã€‚</p></li></ul><h2 id="Raft">Raft</h2><p>For information on how to configure a Raft ordering service, check out our <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/raft_configuration.html">documentation on configuring a Raft ordering service</a>.</p><p>The go-to ordering service choice for production networks, the Fabric implementation of the established Raft protocol uses a â€œleader and followerâ€ model, in which a leader is dynamically elected among the ordering nodes in a channel (this collection of nodes is known as the â€œconsenter setâ€), and that leader replicates messages to the follower nodes. Because the system can sustain the loss of nodes, including leader nodes, as long as there is a majority of ordering nodes (whatâ€™s known as a â€œquorumâ€) remaining, Raft is said to be â€œcrash fault tolerantâ€ (CFT). In other words, if there are three nodes in a channel, it can withstand the loss of one node (leaving two remaining). If you have five nodes in a channel, you can lose two nodes (leaving three remaining nodes). This feature of a Raft ordering service is a factor in the establishment of a high availability strategy for your ordering service. Additionally, in a production environment, you would want to spread these nodes across data centers and even locations. For example, by putting one node in three different data centers. That way, if a data center or entire location becomes unavailable, the nodes in the other data centers continue to operate.</p><p>ç”Ÿäº§ç½‘ç»œçš„é¦–é€‰æ’åºæœåŠ¡å®ç°æ–¹å¼ï¼ŒFabricä¸­å·²å»ºç«‹çš„Raftåè®®çš„å®ç°æ˜¯ä½¿ç”¨â€œé¢†å¯¼è€…å’Œè·Ÿéšè€…â€æ¨¡å‹ï¼Œå…¶ä¸­é¢†å¯¼è€…æ˜¯åœ¨é€šé“ä¸­çš„æ’åºèŠ‚ç‚¹ä¹‹é—´åŠ¨æ€é€‰ä¸¾çš„ï¼ˆè¯¥èŠ‚ç‚¹é›†åˆç§°ä¸ºâ€œåŒæ„è€…é›†â€ï¼‰ï¼Œé¢†å¯¼è€…å°†æ¶ˆæ¯å¤åˆ¶åˆ°è·Ÿéšè€…èŠ‚ç‚¹ã€‚å› ä¸ºç³»ç»Ÿå¯ä»¥æ‰¿å—åŒ…æ‹¬é¢†å¯¼èŠ‚ç‚¹åœ¨å†…çš„èŠ‚ç‚¹çš„ä¸¢å¤±ï¼Œæ‰€ä»¥åªè¦å‰©ä¸‹å¤§å¤šæ•°æ’åºèŠ‚ç‚¹ï¼ˆæ‰€è°“çš„â€œæ³•å®šäººæ•°â€ï¼‰å³å¯ï¼Œå› æ­¤Raftè¢«ç§°ä¸ºâ€œæ•…éšœå®¹é”™â€ï¼ˆCFTï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœé€šé“ä¸­æœ‰ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥æ‰¿å—ä¸€ä¸ªèŠ‚ç‚¹çš„æŸå¤±ï¼ˆå‰©ä¸‹ä¸¤ä¸ªæ´»ç€çš„èŠ‚ç‚¹ï¼‰ã€‚å¦‚æœé€šé“ä¸­æœ‰äº”ä¸ªèŠ‚ç‚¹ï¼Œåˆ™å…è®¸ä¸¢å¤±ä¸¤ä¸ªèŠ‚ç‚¹ï¼ˆå‰©ä¸‹ä¸‰ä¸ªå‰©ä½™èŠ‚ç‚¹ï¼‰ã€‚Raftæ’åºæœåŠ¡çš„æ­¤åŠŸèƒ½æ˜¯ä¸ºæ‚¨çš„æ’åºæœåŠ¡å»ºç«‹é«˜å¯ç”¨æ€§ç­–ç•¥çš„ä¸€ä¸ªå› ç´ ã€‚æ­¤å¤–ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å°†è¿™äº›èŠ‚ç‚¹åˆ†å¸ƒåœ¨æ•°æ®ä¸­å¿ƒç”šè‡³æœ¬åœ°ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡å°†èŠ‚ç‚¹æ”¾ç½®åœ¨ä¸‰ä¸ªä¸åŒçš„æ•°æ®ä¸­å¿ƒä¸­ã€‚è¿™æ ·ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®ä¸­å¿ƒæˆ–æ•´ä¸ªä½ç½®ä¸å¯ç”¨ï¼Œåˆ™å…¶ä»–æ•°æ®ä¸­å¿ƒä¸­çš„èŠ‚ç‚¹å°†ç»§ç»­è¿è¡Œã€‚</p><p>From the perspective of the service they provide to a network or a channel, Raft and the existing Kafka-based ordering service (which weâ€™ll talk about later) are similar. Theyâ€™re both CFT ordering services using the leader and follower design. If you are an application developer, smart contract developer, or peer administrator, you will not notice a functional difference between an ordering service based on Raft versus Kafka. However, there are a few major differences worth considering, especially if you intend to manage an ordering service:</p><p>ä»å®ƒä»¬æä¾›ç»™ç½‘ç»œæˆ–é€šé“çš„æœåŠ¡çš„è§’åº¦æ¥çœ‹ï¼ŒRaftä¸ç°æœ‰çš„åŸºäºKafkaçš„æ’åºæœåŠ¡ï¼ˆæˆ‘ä»¬å°†åœ¨åé¢è®¨è®ºï¼‰å¾ˆç›¸ä¼¼ã€‚ å®ƒä»¬éƒ½æ˜¯é‡‡ç”¨é¢†å¯¼è€…å’Œè·Ÿéšè€…è®¾è®¡çš„CFTæ’åºæœåŠ¡ã€‚å¦‚æœä½ æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºå¼€å‘è€…ã€æ™ºèƒ½åˆçº¦å¼€å‘è€…æˆ–è€…æ˜¯peerç»©ç‚¹ç®¡ç†å‘˜ï¼Œæ‚¨ä¸ä¼šæ³¨æ„åˆ°åŸºäºRaftå’ŒKafkaçš„æ’åºæœåŠ¡ä¹‹é—´çš„åŠŸèƒ½å·®å¼‚ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸€äº›ä¸»è¦å·®å¼‚å€¼å¾—è€ƒè™‘ï¼Œå°¤å…¶æ˜¯å¦‚æœæ‚¨æ‰“ç®—ç®¡ç†æ’åºæœåŠ¡ï¼š</p><ul><li><p>Raft is easier to set up. Although Kafka has many admirers, even those admirers will (usually) admit that deploying a Kafka cluster and its ZooKeeper ensemble can be tricky, requiring a high level of expertise in Kafka infrastructure and settings. Additionally, there are many more components to manage with Kafka than with Raft, which means that there are more places where things can go wrong. And Kafka has its own versions, which must be coordinated with your orderers. <strong>With Raft, everything is embedded into your ordering node</strong>.</p><p>Raftçš„æ’åºæœåŠ¡æ›´å®¹æ˜“æ­å»ºã€‚</p></li><li><p>Kafka and Zookeeper are not designed to be run across large networks. While Kafka is CFT, it should be run in a tight group of hosts. This means that practically speaking you need to have one organization run the Kafka cluster. Given that, having ordering nodes run by different organizations when using Kafka (which Fabric supports) doesnâ€™t give you much in terms of decentralization because the nodes will all go to the same Kafka cluster which is under the control of a single organization. With Raft, each organization can have its own ordering nodes, participating in the ordering service, which leads to a more decentralized system.</p><p>Kafkaå’ŒZookeeperå¹¶éæ˜¯ä¸ºäº†è·¨å¤§å‹ç½‘ç»œè¿è¡Œè€Œè®¾è®¡çš„ã€‚</p></li><li><p>Raft is supported natively, which means that users are required to get the requisite images and learn how to use Kafka and ZooKeeper on their own. Likewise, support for Kafka-related issues is handled through <a href="https://kafka.apache.org/">Apache</a>, the open-source developer of Kafka, not Hyperledger Fabric. The Fabric Raft implementation, on the other hand, has been developed and will be supported within the Fabric developer community and its support apparatus.</p></li><li><p>Where Kafka uses a pool of servers (called â€œKafka brokersâ€) and the admin of the orderer organization specifies how many nodes they want to use on a particular channel, Raft allows the users to specify which ordering nodes will be deployed to which channel. In this way, peer organizations can make sure that, if they also own an orderer, this node will be made a part of a ordering service of that channel, rather than trusting and depending on a central admin to manage the Kafka nodes.</p></li><li><p>Raft is the first step toward Fabricâ€™s development of a byzantine fault tolerant (BFT) ordering service. As weâ€™ll see, some decisions in the development of Raft were driven by this. If you are interested in BFT, learning how to use Raft should ease the transition.</p><p>Raftæ˜¯Fabricå¼€å‘æ‹œå åº­å¼å®¹é”™ï¼ˆBFTï¼‰æ’åºæœåŠ¡çš„ç¬¬ä¸€æ­¥ã€‚</p></li></ul><p>Note: Similar to Solo and Kafka, a Raft ordering service can lose transactions after acknowledgement of receipt has been sent to a client. For example, if the leader crashes at approximately the same time as a follower provides acknowledgement of receipt. Therefore, application clients should listen on peers for transaction commit events regardless (to check for transaction validity), but extra care should be taken to ensure that the client also gracefully tolerates a timeout in which the transaction does not get committed in a configured timeframe. Depending on the application, it may be desirable to resubmit the transaction or collect a new set of endorsements upon such a timeout.</p><p>åœ¨å·²å°†å›æ‰§ç¡®è®¤å‘é€ç»™å®¢æˆ·ä¹‹åï¼ŒRaftæ’åºæœåŠ¡å¯èƒ½ä¼šä¸¢å¤±äº¤æ˜“ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé¢†å¯¼è€…å¤§çº¦åœ¨è¿½éšè€…æä¾›å›æ‰§ç¡®è®¤çš„åŒæ—¶å´©æºƒã€‚å› æ­¤ï¼Œæ— è®ºå¦‚ä½•åº”ç”¨ç¨‹åºå®¢æˆ·ç«¯éƒ½åº”åœ¨peerä¸Šä¾¦å¬äº¤æ˜“æäº¤äº‹ä»¶ï¼ˆä»¥æ£€æŸ¥äº¤æ˜“æœ‰æ•ˆæ€§ï¼‰ï¼Œä½†åº”æ ¼å¤–å°å¿ƒï¼Œä»¥ç¡®ä¿å®¢æˆ·ç«¯ä¹Ÿèƒ½å®¹å¿è¶…æ—¶ï¼Œåœ¨è¯¥è¶…æ—¶ä¸­ä¸ä¼šåœ¨é…ç½®çš„æ—¶é—´èŒƒå›´å†…æäº¤äº‹åŠ¡ã€‚</p><h3 id="Raft-concepts">Raft concepts</h3><p>While Raft offers many of the same features as Kafka â€” albeit in a simpler and easier-to-use package â€” it functions substantially different under the covers from Kafka and introduces a number of new concepts, or twists on existing concepts, to Fabric.</p><p>å°½ç®¡Raftæä¾›äº†è®¸å¤šä¸Kafkaç›¸åŒçš„åŠŸèƒ½ â€“ å°½ç®¡é‡‡ç”¨äº†æ›´ç®€å•æ˜“ç”¨çš„è½¯ä»¶åŒ… â€“ å®ƒçš„åŠŸèƒ½ä¸Kafkaçš„è¡¨é¢å¤§ä¸ç›¸åŒï¼Œå¹¶ä¸ºFabricå¼•å…¥äº†è®¸å¤šæ–°æ¦‚å¿µæˆ–æ‰­æ›²ç°æœ‰çš„æ¦‚å¿µã€‚</p><p><strong>Log entry</strong>. The primary unit of work in a Raft ordering service is a â€œlog entryâ€, with the full sequence of such entries known as the â€œlogâ€. We consider the log consistent if a majority (a quorum, in other words) of members agree on the entries and their order, making the logs on the various orderers replicated.</p><p>Raftæ’åºæœåŠ¡çš„ä¸»è¦å·¥ä½œå•å…ƒæ˜¯ â€œlog entryâ€ï¼Œè¿™äº›æ¡ç›®çš„å®Œæ•´åºåˆ—ç§°ä¸ºâ€œlogâ€ã€‚å¦‚æœå¤šæ•°æˆå‘˜ï¼ˆæ¢è¨€ä¹‹ï¼Œä¸ºæ³•å®šäººæ•°ï¼‰åŒæ„æ¡ç›®åŠå…¶é¡ºåºï¼Œåˆ™æˆ‘ä»¬è®¤ä¸ºæ—¥å¿—æ˜¯ä¸€è‡´çš„ï¼Œä½¿æ—¥å¿—å¤åˆ¶åˆ°å„ä¸ªæ’åºè€…ä¸Šã€‚</p><p><strong>Consenter set</strong>. The ordering nodes actively participating in the consensus mechanism for a given channel and receiving replicated logs for the channel. This can be all of the nodes available (either in a single cluster or in multiple clusters contributing to the system channel), or a subset of those nodes.</p><p><strong>åŒæ„è€…é›†</strong>ã€‚æ’åºèŠ‚ç‚¹ç§¯æå‚ä¸ç»™å®šé€šé“çš„å…±è¯†æœºåˆ¶ï¼Œå¹¶æ¥æ”¶è¯¥é€šé“çš„å¤åˆ¶æ—¥å¿—ã€‚è¿™å¯ä»¥æ˜¯æ‰€æœ‰å¯ç”¨èŠ‚ç‚¹ï¼ˆåœ¨å•ä¸ªç¾¤é›†ä¸­æˆ–åœ¨ç»„æˆç³»ç»Ÿé€šé“çš„å¤šä¸ªç¾¤é›†ä¸­ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯é‚£äº›èŠ‚ç‚¹çš„å­é›†ã€‚</p><p><strong>Finite-State Machine (FSM)</strong>. Every ordering node in Raft has an FSM and collectively theyâ€™re used to ensure that the sequence of logs in the various ordering nodes is deterministic (written in the same sequence).</p><p><strong>æœ‰é™çŠ¶æ€æœº</strong>ã€‚Raftä¸­çš„æ¯ä¸ªæ’åºèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªFSMï¼Œå¹¶å…±åŒä½¿ç”¨å®ƒä»¬æ¥ç¡®ä¿å„ä¸ªæ’åºèŠ‚ç‚¹ä¸­çš„æ—¥å¿—é¡ºåºæ˜¯ç¡®å®šçš„ï¼ˆä»¥ç›¸åŒçš„é¡ºåºå†™å…¥ï¼‰ã€‚</p><p><strong>Quorum</strong>. Describes the minimum number of consenters that need to affirm a proposal so that transactions can be ordered. For every consenter set, this is a <strong>majority</strong> of nodes. In a cluster with five nodes, three must be available for there to be a quorum. If a quorum of nodes is unavailable for any reason, the ordering service cluster becomes unavailable for both read and write operations on the channel, and no new logs can be committed.</p><p><strong>æ³•å®šäººæ•°</strong>ã€‚æè¿°éœ€è¦ç¡®è®¤æè®®ä»¥ä¾¿å¯ä»¥æ’åºäº¤æ˜“çš„åŒæ„è€…çš„æœ€å°æ•°é‡ã€‚å¯¹äºæ¯ä¸ªåŒæ„é›†ï¼Œè¿™æ˜¯å¤§å¤šæ•°èŠ‚ç‚¹ã€‚åœ¨ä¸€ä¸ªç”±äº”ä¸ªèŠ‚ç‚¹ç»„æˆçš„é›†ç¾¤ä¸­ï¼Œå¿…é¡»æœ‰ä¸‰ä¸ªèŠ‚ç‚¹å¯ç”¨æ‰èƒ½è¾¾åˆ°æ³•å®šäººæ•°ã€‚å¦‚æœç”±äºä»»ä½•åŸå› æ— æ³•è¾¾åˆ°æ³•å®šæ•°é‡çš„èŠ‚ç‚¹ï¼Œæ’åºæœåŠ¡ç¾¤é›†å°†æ— æ³•ç”¨äºé€šé“ä¸Šçš„è¯»å–å’Œå†™å…¥æ“ä½œï¼Œå¹¶ä¸”æ— æ³•æäº¤ä»»ä½•æ–°æ—¥å¿—ã€‚</p><p><strong>Leader</strong>. This is not a new concept â€” Kafka also uses leaders, as weâ€™ve said â€” but itâ€™s critical to understand that at any given time, a channelâ€™s consenter set elects a single node to be the leader (weâ€™ll describe how this happens in Raft later). The leader is responsible for ingesting new log entries, replicating them to follower ordering nodes, and managing when an entry is considered committed. This is not a special <strong>type</strong> of orderer. It is only a role that an orderer may have at certain times, and then not others, as circumstances determine.</p><p><strong>é¢†å¯¼è€…</strong>ã€‚ è¿™ä¸æ˜¯ä¸€ä¸ªæ–°æ¦‚å¿µ â€“ æ­£å¦‚æˆ‘ä»¬æ‰€è¯´çš„ï¼ŒKafkaä¹Ÿä½¿ç”¨é¢†å¯¼è€… â€“ ä½†è‡³å…³é‡è¦çš„æ˜¯è¦äº†è§£ï¼Œåœ¨ä»»ä½•ç»™å®šæ—¶é—´ï¼Œé€šé“çš„åŒæ„è€…é›†ä¼šé€‰ä¸¾ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºé¢†å¯¼è€…ï¼ˆæˆ‘ä»¬ç¨åå°†æè¿°åœ¨Raftä¸­å¦‚ä½•å‘ç”Ÿï¼‰ã€‚é¢†å¯¼è€…è´Ÿè´£è·å–æ–°çš„æ—¥å¿—æ¡ç›®ï¼Œå°†å®ƒä»¬å¤åˆ¶åˆ°è·Ÿéšè€…æ’åºèŠ‚ç‚¹ï¼Œå¹¶ç®¡ç†ä½•æ—¶å°†æ¡ç›®è§†ä¸ºå·²æäº¤ã€‚è¿™ä¸æ˜¯æ’åºè€…çš„ç‰¹æ®Šç±»å‹ã€‚è¿™åªæ˜¯æ’åºè€…å¯èƒ½åœ¨æŸäº›æ—¶å€™æ‰®æ¼”çš„è§’è‰²ï¼Œ***ã€‚</p><p><strong>Follower</strong>. Again, not a new concept, but whatâ€™s critical to understand about followers is that the followers receive the logs from the leader and replicate them deterministically, ensuring that logs remain consistent. As weâ€™ll see in our section on leader election, the followers also receive â€œheartbeatâ€ messages from the leader. In the event that the leader stops sending those message for a configurable amount of time, the followers will initiate a leader election and one of them will be elected the new leader.</p><p><strong>è¿½éšè€…</strong>ã€‚äº†è§£è¿½éšè€…çš„å…³é”®æ˜¯è¿½éšè€…ä»é¢†å¯¼è€…é‚£é‡Œæ¥æ”¶æ—¥å¿—å¹¶ç¡®å®šæ€§åœ°å¤åˆ¶å®ƒä»¬ï¼Œä»¥ç¡®ä¿æ—¥å¿—ä¿æŒä¸€è‡´ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨é¢†å¯¼è€…é€‰ä¸¾éƒ¨åˆ†ä¸­æ‰€çœ‹åˆ°çš„é‚£æ ·ï¼Œè¿½éšè€…è¿˜ä¼šä»é¢†å¯¼è€…é‚£é‡Œæ¥æ”¶â€œå¿ƒè·³â€æ¶ˆæ¯ã€‚å¦‚æœé¢†å¯¼è€…åœ¨å¯é…ç½®çš„æ—¶é—´å†…åœæ­¢å‘é€è¿™äº›æ¶ˆæ¯ï¼Œåˆ™è·Ÿéšè€…å°†å‘èµ·é¢†å¯¼è€…é€‰ä¸¾ï¼Œå…¶ä¸­ä¸€ä¸ªå°†è¢«é€‰ä¸¾ä¸ºæ–°é¢†å¯¼è€…ã€‚</p><h3 id="Raft-in-a-transaction-flow">Raft in a transaction flow</h3><p>Every channel runs on a <strong>separate</strong> instance of the Raft protocol, which allows each instance to elect a different leader. This configuration also allows further decentralization of the service in use cases where clusters are made up of ordering nodes controlled by different organizations. While all Raft nodes must be part of the system channel, they do not necessarily have to be part of all application channels. Channel creators (and channel admins) have the ability to pick a subset of the available orderers and to add or remove ordering nodes as needed (as long as only a single node is added or removed at a time).</p><p>æ¯ä¸ªé€šé“éƒ½è¿è¡Œä¸€ä¸ªå•ç‹¬çš„Raftåè®®å®ä¾‹ï¼Œè¿™å…è®¸æ¯ä¸ªå®ä¾‹é€‰æ‹©ä¸åŒçš„é¢†å¯¼è€…ã€‚åœ¨ç”±ä¸åŒç»„ç»‡æ§åˆ¶çš„æ’åºèŠ‚ç‚¹ç»„æˆçš„ç¾¤é›†ç”¨ä¾‹ä¸­ï¼Œæ­¤é…ç½®è¿˜å…è®¸è¿›ä¸€æ­¥åˆ†æ•£æœåŠ¡ã€‚å°½ç®¡æ‰€æœ‰RaftèŠ‚ç‚¹éƒ½å¿…é¡»æ˜¯ç³»ç»Ÿé€šé“çš„ä¸€éƒ¨åˆ†ï¼Œä½†ä¸ä¸€å®šå¿…é¡»æ˜¯æ‰€æœ‰åº”ç”¨ç¨‹åºé€šé“çš„ä¸€éƒ¨åˆ†ã€‚é€šé“åˆ›å»ºè€…ï¼ˆå’Œé€šé“ç®¡ç†å‘˜ï¼‰å¯ä»¥é€‰æ‹©å¯ç”¨è®¢è´­è€…çš„å­é›†ï¼Œå¹¶æ ¹æ®éœ€è¦æ·»åŠ æˆ–åˆ é™¤è®¢è´­èŠ‚ç‚¹ï¼ˆåªè¦ä¸€æ¬¡ä»…æ·»åŠ æˆ–åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ã€‚</p><p>While this configuration creates more overhead in the form of redundant heartbeat messages and goroutines, it lays necessary groundwork for BFT.</p><p>è™½ç„¶æ­¤é…ç½®ä»¥å†—ä½™å¿ƒè·³æ¶ˆæ¯å’Œgoroutineçš„å½¢å¼åˆ›å»ºäº†æ›´å¤šå¼€é”€ï¼Œä½†ä¸ºBFTå¥ å®šäº†å¿…è¦çš„åŸºç¡€ã€‚</p><p>In Raft, transactions (in the form of proposals or configuration updates) are automatically routed by the ordering node that receives the transaction to the current leader of that channel. This means that peers and applications do not need to know who the leader node is at any particular time. Only the ordering nodes need to know.</p><p>åœ¨Raftä¸­ï¼Œäº¤æ˜“ï¼ˆä»¥å»ºè®®ä¹¦æˆ–é…ç½®æ›´æ–°çš„å½¢å¼ï¼‰ç”±æ¥æ”¶äº¤æ˜“çš„æ’åºèŠ‚ç‚¹è‡ªåŠ¨è·¯ç”±åˆ°è¯¥é€šé“çš„å½“å‰leaderèŠ‚ç‚¹ã€‚è¿™æ„å‘³ç€peerèŠ‚ç‚¹å’Œåº”ç”¨ç¨‹åºèŠ‚ç‚¹ä¸éœ€è¦çŸ¥é“å½“å‰æ—¶é—´è°æ˜¯leaderèŠ‚ç‚¹ã€‚åªæœ‰æ’åºæœåŠ¡èŠ‚ç‚¹éœ€è¦çŸ¥é“ã€‚</p><p>When the orderer validation checks have been completed, the transactions are ordered, packaged into blocks, consented on, and distributed, as described in phase two of our transaction flow.</p><h3 id="Architectural-notes">Architectural notes</h3><h4 id="How-leader-election-works-in-Raft">How leader election works in Raft</h4><p>Although the process of electing a leader happens within the ordererâ€™s internal processes, itâ€™s worth noting how the process works.</p><p>Raft nodes are always in one of three states: follower, candidate, or leader. All nodes initially start out as a <strong>follower</strong>. In this state, they can accept log entries from a leader (if one has been elected), or cast votes for leader. If no log entries or heartbeats are received for a set amount of time (for example, five seconds), nodes self-promote to the <strong>candidate</strong> state. In the candidate state, nodes request votes from other nodes. If a candidate receives a quorum of votes, then it is promoted to a <strong>leader</strong>. The leader must accept new log entries and replicate them to the followers.</p><p>Raftçš„èŠ‚ç‚¹ä¸€ç›´å¤„äºä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼šfollowerï¼Œcandidateï¼ˆå€™é€‰ï¼‰ï¼Œæˆ–leaderã€‚æ‰€æœ‰çš„èŠ‚ç‚¹çš„æœ€åˆçŠ¶æ€éƒ½æ˜¯<strong>follower</strong>ã€‚åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼Œä»–ä»¬å¯ä»¥ä»leaderæ¥æ”¶æ—¥å¿—æ¡ç›®ï¼Œæˆ–è€…æŠ•ç¥¨é€‰ä¸¾leaderã€‚å¦‚æœåœ¨è®¾ç½®çš„æ—¶é—´æ®µå†…ï¼ˆä¾‹å¦‚ï¼Œäº”ç§’é’Ÿï¼‰æœªæ¥æ”¶åˆ°æ—¥å¿—æ¡ç›®æˆ–å¿ƒè·³ï¼Œåˆ™èŠ‚ç‚¹ä¼šè‡ªåŠ¨å‡çº§ä¸º <strong>candidate</strong> çŠ¶æ€ã€‚åœ¨å€™é€‰çŠ¶æ€ä¸‹ï¼ŒèŠ‚ç‚¹ä¼šå‘å…¶ä»–èŠ‚ç‚¹è¯·æ±‚æŠ•ç¥¨ã€‚å¦‚æœå€™é€‰äººè·å¾—æ³•å®šäººæ•°çš„é€‰ç¥¨ï¼Œåˆ™å°†å…¶æ™‹å‡ä¸º <strong>leader</strong>ã€‚leaderèŠ‚ç‚¹å¿…é¡»æ¥å—æ–°çš„æ—¥å¿—æ¡ç›®å¹¶ä¸”å°†å…¶å¤åˆ¶åˆ°followersã€‚</p><p>For a visual representation of how the leader election process works, check out <a href="http://thesecretlivesofdata.com/raft/">The Secret Lives of Data</a>.</p><h4 id="Snapshots">Snapshots</h4><p>If an ordering node goes down, how does it get the logs it missed when it is restarted?</p><p>å¦‚æœä¸€ä¸ªæ’åºèŠ‚ç‚¹å®•æœºäº†ï¼Œå®ƒå¦‚ä½•åœ¨é‡æ–°å¯åŠ¨æ—¶è·å–ä¸¢å¤±çš„æ—¥å¿—ä¿¡æ¯å‘¢ï¼Ÿ</p><p>While itâ€™s possible to keep all logs indefinitely, in order to save disk space, Raft uses a process called â€œsnapshottingâ€, in which users can define how many bytes of data will be kept in the log. This amount of data will conform to a certain number of blocks (which depends on the amount of data in the blocks. Note that only full blocks are stored in a snapshot).</p><p>å°½ç®¡å¯ä»¥æ— é™æœŸä¿ç•™æ‰€æœ‰æ—¥å¿—ï¼Œä½†æ˜¯ä¸ºäº†èŠ‚çœç£ç›˜ç©ºé—´ï¼ŒRaftä½¿ç”¨äº†ä¸€ç§ç§°ä¸ºâ€œsnapshottingâ€çš„ç¨‹åºï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­å®šä¹‰å°†åœ¨æ—¥å¿—ä¸­ä¿ç•™å¤šå°‘å­—èŠ‚çš„æ•°æ®ã€‚æ­¤æ•°æ®é‡å°†ç¬¦åˆä¸€å®šæ•°é‡çš„åŒºå—ï¼ˆè¿™å–å†³äºå—ä¸­çš„æ•°æ®é‡ï¼Œè¯·æ³¨æ„ï¼Œå¿«ç…§ä¸­ä»…å­˜å‚¨å®Œæ•´å—ï¼‰ã€‚</p><p>For example, letâ€™s say lagging replica <code>R1</code> was just reconnected to the network. Its latest block is <code>100</code>. Leader <code>L</code> is at block <code>196</code>, and is configured to snapshot at amount of data that in this case represents 20 blocks. <code>R1</code> would therefore receive block <code>180</code> from <code>L</code> and then make a <code>Deliver</code> request for blocks <code>101</code> to <code>180</code>. Blocks <code>180</code> to <code>196</code> would then be replicated to <code>R1</code> through the normal Raft protocol.</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æ»åçš„å‰¯æœ¬<code>R1</code>åˆšåˆšé‡æ–°è¿æ¥åˆ°ç½‘ç»œã€‚å®ƒçš„æœ€åä¸€ä¸ªåŒºå—æ˜¯<code>100</code>.LeaderèŠ‚ç‚¹<code>L</code>æœ€åä¸€ä¸ªåŒºå—æ˜¯<code>196</code>ï¼Œå¹¶ä¸”è®¾ç½®å¿«ç…§çš„æ•°é‡ä»£è¡¨20ä¸ªåŒºå—ã€‚å› æ­¤ï¼Œ<code>R1</code>å°†ä»<code>L</code>æ¥æ”¶åŒºå—<code>180</code>ä¸ªï¼Œç„¶åå¯¹åŒºå—<code>101</code>åˆ°<code>180</code>å‘å‡º <code>Deliver</code> è¯·æ±‚ã€‚<code>180</code>åˆ°<code>196</code>ä¹‹é—´çš„åŒºå—ä¼šä½¿ç”¨å¸¸è§„çš„Raftåè®®å¤åˆ¶åˆ°<code>R1</code>ã€‚</p><h3 id="Kafka-deprecated-in-v2-x">Kafka (deprecated in v2.x)</h3><p>The other crash fault tolerant ordering service supported by Fabric is an adaptation of a Kafka distributed streaming platform for use as a cluster of ordering nodes. You can read more about Kafka at the <a href="https://kafka.apache.org/intro">Apache Kafka Web site</a>, but at a high level, Kafka uses the same conceptual â€œleader and followerâ€ configuration used by Raft, in which transactions (which Kafka calls â€œmessagesâ€) are replicated from the leader node to the follower nodes. In the event the leader node goes down, one of the followers becomes the leader and ordering can continue, ensuring fault tolerance, just as with Raft.</p><p>The management of the Kafka cluster, including the coordination of tasks, cluster membership, access control, and controller election, among others, is handled by a ZooKeeper ensemble and its related APIs.</p><p>Kafka clusters and ZooKeeper ensembles are notoriously tricky to set up, so our documentation assumes a working knowledge of Kafka and ZooKeeper. If you decide to use Kafka without having this expertise, you should complete, <em>at a minimum</em>, the first six steps of the <a href="https://kafka.apache.org/quickstart">Kafka Quickstart guide</a> before experimenting with the Kafka-based ordering service. You can also consult <a href="https://github.com/hyperledger/fabric/blob/release-1.1/bddtests/dc-orderer-kafka.yml">this sample configuration file</a> for a brief explanation of the sensible defaults for Kafka and ZooKeeper.</p><p>To learn how to bring up a Kafka-based ordering service, check out <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/kafka.html">our documentation on Kafka</a>.</p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> Key Concepts </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> Ordering Service </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Private data</title>
      <link href="2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Private%20data/"/>
      <url>2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Private%20data/</url>
      
        <content type="html"><![CDATA[<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/private-data/private-data.html">Private data</a></p><h2 id="What-is-a-private-data-collection">What is a private data collection?</h2><p>A collection is the combination of two elements:</p><ol><li><strong>The actual private data</strong>, sent peer-to-peer <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/gossip.html">via gossip protocol</a> to only the organization(s) authorized to see it. This data is stored in a private state database on the peers of authorized organizations, which can be accessed from chaincode on these authorized peers. The ordering service is not involved here and does not see the private data. Note that because gossip distributes the private data peer-to-peer across authorized organizations, it is required to set up anchor peers on the channel, and configure CORE_PEER_GOSSIP_EXTERNALENDPOINT on each peer, in order to bootstrap cross-organization communication.</li><li><strong>A hash of that data</strong>, which is endorsed, ordered, and written to the ledgers of every peer on the channel. The hash serves as evidence of the transaction and is used for state validation and can be used for audit purposes.</li></ol><p>The following diagram illustrates the ledger contents of a peer authorized to have private data and one which is not.</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/PrivateDataConcept-2.png" alt="PrivateDataConcept-2"></p><p>Collection members may decide to share the private data with other parties if they get into a dispute or if they want to transfer the asset to a third party. The third party can then compute the hash of the private data and see if it matches the state on the channel ledger, proving that the state existed between the collection members at a certain point in time.</p><p>In some cases, you may decide to have a set of collections each comprised of a single organization. For example an organization may record private data in their own collection, which could later be shared with other channel members and referenced in chaincode transactions. Weâ€™ll see examples of this in the sharing private data topic below.</p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> Key Concepts </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> Private data </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Smart Contracts and Chaincode</title>
      <link href="2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Smart%20Contracts%20and%20Chaincode/"/>
      <url>2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Smart%20Contracts%20and%20Chaincode/</url>
      
        <content type="html"><![CDATA[<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/smartcontract/smartcontract.html">Smart Contracts and Chaincode</a></p><p>TODO</p><p>ä¸‹å›¾å±•ç¤ºFabricæ˜¯å¦‚ä½•å¤„ç†éªŒè¯æˆåŠŸçš„äº¤æ˜“å’ŒéªŒè¯ä¸æˆåŠŸçš„äº¤æ˜“çš„ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/smartcontract.diagram.04.png" alt="smartcontract.diagram.04"></p><p><em>All transactions have an identifier, a proposal, and a response signed by a set of organizations. All transactions are recorded on the blockchain, whether valid or invalid, but only valid transactions contribute to the world state.</em></p><h2 id="Intercommunication">Intercommunication</h2><p>A Smart Contract can call other smart contracts both within the same channel and across different channels. It this way, they can read and write world state data to which they would not otherwise have access due to smart contract namespaces.</p><p>There are limitations to this inter-contract communication, which are described fully in the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/developapps/chaincodenamespace.html#cross-chaincode-access">chaincode namespace</a> topic.</p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> Key Concepts </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> Smart Contracts and Chaincode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Policies(ç­–ç•¥)</title>
      <link href="2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Policies/"/>
      <url>2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Policies/</url>
      
        <content type="html"><![CDATA[<h2 id="What-is-a-policy">What is a policy</h2><p>At its most basic level, a policy is a set of rules that define the structure for how decisions are made and specific outcomes are reached. To that end, policies typically describe a <strong>who</strong> and a <strong>what</strong>, such as the access or rights that an individual has over an <strong>asset</strong>. We can see that policies are used throughout our daily lives to protect assets of value to us, from car rentals, health, our homes, and many more.</p><p>åœ¨æœ€åŸºæœ¬çš„çº§åˆ«ä¸Šï¼Œç­–ç•¥æ˜¯ä¸€ç»„è§„åˆ™ï¼Œè¿™äº›è§„åˆ™å®šä¹‰äº†å¦‚ä½•åˆ¶å®šå†³ç­–å’Œè¾¾åˆ°ç‰¹å®šç»“æœçš„ç»“æ„ã€‚ä¸ºæ­¤ï¼Œç­–ç•¥é€šå¸¸æè¿°<strong>WHO</strong>å’Œ<strong>WHAT</strong>ï¼Œä¾‹å¦‚ä¸ªäººå¯¹<strong>ASSET</strong>çš„è®¿é—®æˆ–æƒåˆ©ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç­–ç•¥åœ¨æˆ‘ä»¬çš„æ—¥å¸¸ç”Ÿæ´»ä¸­ä¸€ç›´è¢«ç”¨æ¥ä¿æŠ¤å¯¹æˆ‘ä»¬æœ‰ä»·å€¼çš„èµ„äº§ï¼Œä½¿å…¶å…å—æ±½è½¦ç§Ÿèµï¼ŒåŒ»ç–—ï¼Œæˆ¿å±‹ç­‰çš„ä¾µå®³ã€‚</p><p>For example, an insurance policy defines the conditions, terms, limits, and expiration under which an insurance payout will be made. The policy is agreed to by the policy holder and the insurance company, and defines the rights and responsibilities of each party.</p><p>ä¾‹å¦‚ï¼Œä¿é™©å•å®šä¹‰äº†å°†è¦æ”¯ä»˜ä¿é™©é‡‘çš„æ¡ä»¶ï¼Œæ¡æ¬¾ï¼Œé™é¢å’Œæœ‰æ•ˆæœŸã€‚è¯¥ä¿å•ç»ä¿å•æŒæœ‰äººå’Œä¿é™©å…¬å¸åŒæ„ï¼Œå¹¶å®šä¹‰äº†åŒæ–¹çš„æƒåˆ©å’Œè´£ä»»ã€‚</p><p>Whereas an insurance policy is put in place for risk management, in Hyperledger Fabric, policies are the mechanism for infrastructure management. Fabric policies represent how members come to agreement on accepting or rejecting changes to the network, a channel, or a smart contract. Policies are agreed to by the consortium members when a network is originally configured, but they can also be modified as the network evolves. For example, they describe the criteria for adding or removing members from a channel, change how blocks are formed, or specify the number of organizations required to endorse a smart contract. All of these actions are described by a policy which defines who can perform the action. Simply put, everything you want to do on a Fabric network is controlled by a policy.</p><p>å°½ç®¡å·²ä¸ºé£é™©ç®¡ç†åˆ¶å®šäº†ä¿é™©å•ï¼Œä½†åœ¨Hyperledger Fabricä¸­ï¼Œé£é™©ç®¡ç†æ˜¯åŸºç¡€æ¶æ„ç®¡ç†çš„æœºåˆ¶ã€‚Fabricçš„ç­–ç•¥ä»£è¡¨æˆå‘˜å¦‚ä½•å°±æ¥å—æˆ–æ‹’ç»å¯¹ç½‘ç»œï¼Œæ¸ é“æˆ–æ™ºèƒ½åˆçº¦çš„æ›´æ”¹è¾¾æˆåè®®ã€‚æœ€åˆé…ç½®ç½‘ç»œæ—¶ï¼Œç­–ç•¥æ˜¯ç”±è”ç›Ÿæˆå‘˜åŒæ„çš„ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥éšç€ç½‘ç»œçš„å‘å±•è€Œä¿®æ”¹ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œå®ƒä»¬æè¿°äº†åœ¨é€šé“ä¸­æ·»åŠ æˆ–åˆ é™¤æˆå‘˜ï¼Œæ›´æ”¹åŒºå—çš„å½¢æˆæ–¹å¼æˆ–æŒ‡å®šè®¤å¯æ™ºèƒ½åˆçº¦æ‰€éœ€çš„ç»„ç»‡æ•°é‡çš„æ ‡å‡†ã€‚æ‰€æœ‰è¿™äº›åŠ¨ä½œå‡ç”±å®šä¹‰äº†è°å¯ä»¥æ‰§è¡Œè¯¥åŠ¨ä½œçš„ç­–ç•¥æ¥æè¿°ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæ‚¨è¦åœ¨Fabricç½‘ç»œä¸Šæ‰§è¡Œçš„æ‰€æœ‰æ“ä½œå‡å—ç­–ç•¥æ§åˆ¶ã€‚</p><h2 id="Why-are-policies-needed">Why are policies needed</h2><p>Policies are one of the things that make Hyperledger Fabric different from other blockchains like Ethereum or Bitcoin. In those systems, transactions can be generated and validated by any node in the network. The policies that govern the network are fixed at any point in time and can only be changed using the same process that governs the code. Because Fabric is a permissioned blockchain whose users are recognized by the underlying infrastructure, those users have the ability to decide on the governance of the network before it is launched, and change the governance of a running network.</p><p>ç­–ç•¥æ˜¯ä½¿Hyperledger Fabricä¸ä»¥å¤ªåŠæˆ–æ¯”ç‰¹å¸ç­‰å…¶ä»–åŒºå—é“¾ä¸åŒçš„åŸå› ä¹‹ä¸€ã€‚åœ¨æ¯”ç‰¹å¸æˆ–ä»¥å¤ªåŠç³»ç»Ÿä¸­ï¼Œäº¤æ˜“å¯ä»¥ç”±ç½‘ç»œä¸Šçš„ä»»æ„èŠ‚ç‚¹ç”Ÿæˆå’ŒéªŒè¯ã€‚æ”¯é…ç½‘ç»œçš„ç­–ç•¥åœ¨ä»»ä½•æ—¶é—´éƒ½æ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸”åªèƒ½ä½¿ç”¨æ”¯é…ä»£ç çš„ç›¸åŒè¿‡ç¨‹è¿›è¡Œæ›´æ”¹ã€‚ç”±äºFabricæ˜¯è®¸å¯çš„åŒºå—é“¾ï¼Œå…¶ç”¨æˆ·è¢«åŸºç¡€æ¶æ„æ‰€è¯†åˆ«ï¼Œå› æ­¤è¿™äº›ç”¨æˆ·å…·æœ‰åœ¨å¯åŠ¨ç½‘ç»œä¹‹å‰å†³å®šç½‘ç»œæ²»ç†çš„èƒ½åŠ›ï¼Œå¹¶ä¸”ä¹Ÿå…·æœ‰æ›´æ”¹è¿è¡Œä¸­ç½‘ç»œçš„æ²»ç†çš„èƒ½åŠ›ã€‚</p><p>Policies allow members to decide which organizations can access or update a Fabric network, and provide the mechanism to enforce those decisions. Policies contain the lists of organizations that have access to a given resource, such as a user or system chaincode. They also specify how many organizations need to agree on a proposal to update a resource, such as a channel or smart contracts. Once they are written, policies evaluate the collection of signatures attached to transactions and proposals and validate if the signatures fulfill the governance agreed to by the network.</p><p>ç­–ç•¥å…è®¸æˆå‘˜å†³å®šå“ªäº›ç»„ç»‡å¯ä»¥è®¿é—®æˆ–æ›´æ–°ä¸€ä¸ªFabricç½‘ç»œï¼Œå¹¶æä¾›æ‰§è¡Œè¿™äº›å†³å®šçš„æœºåˆ¶ã€‚ç­–ç•¥åŒ…å«å¯¹ç»™å®šçš„èµ„æºçš„æœ‰è®¿é—®æƒé™çš„ç»„ç»‡çš„åˆ—è¡¨ï¼Œæ¯”å¦‚ä¸€ä¸ªç”¨æˆ·æˆ–è€…ç³»ç»Ÿé“¾ç ã€‚ç­–ç•¥è¿˜æŒ‡å®šæœ‰å¤šå°‘ç»„ç»‡éœ€è¦å°±æ›´æ–°èµ„æºï¼ˆä¾‹å¦‚é€šé“æˆ–æ™ºèƒ½åˆçº¦ï¼‰çš„ææ¡ˆè¾¾æˆåè®®ã€‚ä¸€æ—¦å†™å…¥ï¼Œç­–ç•¥å°†è¯„ä¼°é™„åŠ åœ¨äº¤æ˜“å’Œæè®®ä¸­çš„ç­¾åçš„é›†åˆï¼Œå¹¶éªŒè¯ç­¾åæ˜¯å¦æ»¡è¶³ç½‘ç»œæ‰€åŒæ„çš„æ²»ç†ã€‚</p><h2 id="How-are-policies-implemented-throughout-Fabric">How are policies implemented throughout Fabric</h2><p>Policies are implemented at different levels of a Fabric network. Each policy domain governs different aspects of how a network operates.</p><p>ç­–ç•¥æ˜¯åœ¨Fabricç½‘ç»œçš„ä¸åŒçº§åˆ«ä¸Šå®ç°çš„ã€‚æ¯ä¸ªç­–ç•¥åŸŸç®¡ç†ç½‘ç»œè¿è¡Œçš„ä¸åŒæ–¹é¢ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/FabricPolicyHierarchy-2.png" alt="FabricPolicyHierarchy-2"></p><p><em>A visual representation of the Fabric policy hierarchy.</em></p><p><em>Fabricç­–ç•¥å±‚æ¬¡ç»“æ„çš„ç›´è§‚è¡¨ç¤ºã€‚</em></p><h3 id="System-channel-configuration">System channel configuration</h3><p>Every network begins with an ordering <strong>system channel</strong>. There must be exactly one ordering system channel for an ordering service, and it is the first channel to be created. The system channel also contains the organizations who are the members of the ordering service (ordering organizations) and those that are on the networks to transact (consortium organizations).</p><p>æ¯ä¸ªç½‘ç»œéƒ½ä»ä¸€ä¸ªæ’åºç³»ç»Ÿé€šé“å¼€å§‹ã€‚å¯¹æ’åºæœæ¥è¯´ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªç¡®å®šçš„æ’åºç³»ç»Ÿé€šé“ï¼Œå¹¶ä¸”ä»–æ˜¯ç¬¬ä¸€ä¸ªéœ€è¦åˆ›å»ºçš„é€šé“ã€‚ç³»ç»Ÿé€šé“è¿˜åŒ…å«ä½œä¸ºæ’åºæœåŠ¡æˆå‘˜çš„ç»„ç»‡ï¼ˆæ’åºç»„ç»‡ï¼‰å’Œåœ¨ç½‘ç»œä¸Šè¿›è¡Œäº¤æ˜“çš„ç»„ç»‡ï¼ˆè”ç›Ÿç»„ç»‡ï¼‰ã€‚</p><p>The policies in the ordering system channel configuration blocks govern the consensus used by the ordering service and define how new blocks are created. The system channel also governs which members of the consortium are allowed to create new channels.</p><p>æ’åºç³»ç»Ÿé€šé“é…ç½®åŒºå—ä¸­çš„ç­–ç•¥æ§åˆ¶æ’åºæœåŠ¡ä½¿ç”¨çš„å…±è¯†ï¼Œå¹¶å®šä¹‰å¦‚ä½•åˆ›å»ºæ–°åŒºå—ã€‚ç³»ç»Ÿé€šé“ä¹Ÿæ§åˆ¶è”ç›Ÿä¸­çš„å“ªäº›æˆå‘˜å…è®¸åˆ›å»ºæ–°çš„é€šé“ã€‚</p><h3 id="Application-channel-configuration">Application channel configuration</h3><p>Application <em>channels</em> are used to provide a private communication mechanism between organizations in the consortium.</p><p>åº”ç”¨ç¨‹åºé€šé“ç”¨äºåœ¨è”ç›Ÿä¸­çš„ç»„ç»‡ä¹‹é—´æä¾›ä¸“ç”¨çš„é€šä¿¡æœºåˆ¶ã€‚</p><p>The policies in an application channel govern the ability to add or remove members from the channel. Application channels also govern which organizations are required to approve a chaincode before the chaincode is defined and committed to a channel using the Fabric chaincode lifecycle. When an application channel is initially created, it inherits all the ordering service parameters from the orderer system channel by default. However, those parameters (and the policies governing them) can be customized in each channel.</p><p>åº”ç”¨ç¨‹åºé€šé“ä¸­çš„ç­–ç•¥æ§åˆ¶äº†ä»é€šé“ä¸­æ·»åŠ æˆ–è€…ç§»é™¤æˆå‘˜çš„èƒ½åŠ›ã€‚åº”ç”¨ç¨‹åºé€šé“ä¹Ÿæ§åˆ¶äº†åœ¨ä½¿ç”¨Fabricé“¾ç ç”Ÿå‘½å‘¨æœŸå®šä¹‰é“¾ç å¹¶å°†å…¶æäº¤ç»™é€šé“ä¹‹å‰ï¼Œéœ€è¦å“ªäº›æˆå‘˜éœ€è¦ã€‚æœ€åˆåˆ›å»ºåº”ç”¨ç¨‹åºé€šé“æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒå°†ä»æ’åºç³»ç»Ÿé€šé“ç»§æ‰¿æ‰€æœ‰æ’åºæœåŠ¡å‚æ•°ã€‚ä½†æ˜¯ï¼Œå¯ä»¥åœ¨æ¯ä¸ªé€šé“ä¸­è‡ªå®šä¹‰è¿™äº›å‚æ•°ï¼ˆä»¥åŠæ§åˆ¶å®ƒä»¬çš„ç­–ç•¥ï¼‰ã€‚</p><h3 id="Access-control-lists-ACLs">Access control lists (ACLs)</h3><p>Network administrators will be especially interested in the Fabric use of ACLs, which provide the ability to configure access to resources by associating those resources with existing policies. These â€œresourcesâ€ could be functions on system chaincode (e.g., â€œGetBlockByNumberâ€ on the â€œqsccâ€ system chaincode) or other resources (e.g.,who can receive Block events). ACLs refer to policies defined in an application channel configuration and extends them to control additional resources. The default set of Fabric ACLs is visible in the <code>configtx.yaml</code> file under the <code>Application: &amp;ApplicationDefaults</code> section but they can and should be overridden in a production environment. The list of resources named in <code>configtx.yaml</code> is the complete set of all internal resources currently defined by Fabric.</p><p>ç½‘ç»œç®¡ç†å‘˜å¯èƒ½å¯¹Fabricä½¿ç”¨çš„ACç‰¹åˆ«æ„Ÿå…´è¶£ï¼ŒACLå¯ä»¥é€šè¿‡å°†èµ„æºä¸ç°æœ‰ç­–ç•¥ç›¸å…³è”æ¥é…ç½®å¯¹èµ„æºçš„è®¿é—®ã€‚è¿™äº›â€œèµ„æºâ€å¯ä»¥æ˜¯ç³»ç»Ÿé“¾ç ä¸Šçš„åŠŸèƒ½ï¼ˆå¦‚ï¼Œåœ¨â€œ qsccâ€ç³»ç»Ÿé“¾ç ä¸Šçš„â€œ GetBlockByNumberâ€ï¼‰æˆ–å…¶ä»–èµ„æºï¼ˆå¦‚è°å¯ä»¥æ¥æ”¶Blockäº‹ä»¶ï¼‰ã€‚ACLå¼•ç”¨åœ¨åº”ç”¨ç¨‹åºé€šé“é…ç½®ä¸­å®šä¹‰çš„ç­–ç•¥ï¼Œå¹¶å°†å…¶æ‰©å±•ä»¥æ§åˆ¶å…¶ä»–èµ„æºã€‚é»˜è®¤çš„Fabric ACLé›†åœ¨<code>configtx.yaml</code>æ–‡ä»¶é‡Œçš„ <code>Application: &amp;ApplicationDefaults</code> éƒ¨åˆ†ä¸‹çš„å¯è§ï¼Œä½†æ˜¯å¯ä»¥å¹¶ä¸”åº”è¯¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¦†ç›–å®ƒä»¬ã€‚<code>configtx.yaml</code>ä¸­å‘½åçš„èµ„æºåˆ—è¡¨æ˜¯Fabricå½“å‰å®šä¹‰çš„æ‰€æœ‰å†…éƒ¨èµ„æºçš„å®Œæ•´é›†åˆã€‚</p><p>In that file, ACLs are expressed using the following format:</p><p>åœ¨è¯¥æ–‡ä»¶ä¸­ï¼ŒACLä½¿ç”¨ä»¥ä¸‹æ ¼å¼è¡¨ç¤ºï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ACL policy for chaincode to chaincode invocation</span></span><br><span class="line"><span class="attr">peer/ChaincodeToChaincode:</span> <span class="string">/Channel/Application/Readers</span></span><br></pre></td></tr></table></figure><p>Where <code>peer/ChaincodeToChaincode</code> represents the resource being secured and <code>/Channel/Application/Readers</code> refers to the policy which must be satisfied for the associated transaction to be considered valid.</p><p>å…¶ä¸­ <code>peer/ChaincodeToChaincode</code> è¡¨ç¤ºå—ä¿æŠ¤çš„èµ„æºï¼Œ <code>/Channel/Application/Readers</code>æ˜¯æŒ‡å¿…é¡»æ»¡è¶³çš„ç­–ç•¥ï¼Œå…³è”äº¤æ˜“æ‰è¢«è§†ä¸ºæœ‰æ•ˆã€‚</p><p>For a deeper dive into ACLS, refer to the topic in the Operations Guide on <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/access_control.html">ACLs</a>.</p><p>è¦æ·±å…¥äº†è§£ACLSï¼Œè¯·å‚é˜…<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/access_control.html">ACLs</a>çš„æ“ä½œæŒ‡å—ä¸­çš„ä¸»é¢˜ã€‚</p><h3 id="Smart-contract-endorsement-policiesï¼ˆæ™ºèƒ½åˆçº¦çš„èƒŒä¹¦ç­–ç•¥ï¼‰">Smart contract endorsement policiesï¼ˆæ™ºèƒ½åˆçº¦çš„èƒŒä¹¦ç­–ç•¥ï¼‰</h3><p>Every smart contract inside a chaincode package has an endorsement policy that specifies how many peers belonging to different channel members need to execute and validate a transaction against a given smart contract in order for the transaction to be considered valid. Hence, the endorsement policies define the organizations (through their peers) who must â€œendorseâ€ (i.e., approve of) the execution of a proposal.</p><p>é“¾ç åŒ…é‡Œé¢çš„æ¯ä¸ªæ™ºèƒ½åˆçº¦éƒ½æœ‰ä¸€ä¸ªèƒŒä¹¦ç­–ç•¥ï¼Œè¿™ä¸ªèƒŒä¹¦ç­–ç•¥æŒ‡å®šäº†éœ€è¦å¤šå°‘ä¸ªæ¥è‡ªä¸åŒé€šé“æˆå‘˜çš„peerèŠ‚ç‚¹éœ€è¦é’ˆå¯¹ç»™å®šçš„æ™ºèƒ½åˆçº¦æ‰§è¡Œå’ŒéªŒè¯äº¤æ˜“ï¼Œä»¥ä¾¿è¯¥äº¤æ˜“è¢«è§†ä¸ºæœ‰æ•ˆã€‚å› æ­¤ï¼ŒèƒŒä¹¦æ”¿ç­–å®šä¹‰äº†å¿…é¡»â€œèƒŒä¹¦â€ï¼ˆå³æ‰¹å‡†ï¼‰ææ¡ˆæ‰§è¡Œçš„ç»„ç»‡ï¼ˆé€šè¿‡å…¶peerï¼‰ã€‚</p><h3 id="Modification-policiesï¼ˆä¿®æ”¹æ”¿ç­–ï¼‰">Modification policiesï¼ˆä¿®æ”¹æ”¿ç­–ï¼‰</h3><p>There is one last type of policy that is crucial to how policies work in Fabric, the <code>Modification policy</code>. Modification policies specify the group of identities required to sign (approve) any configuration <em>update</em>. It is the policy that defines how the policy is updated. Thus, each channel configuration element includes a reference to a policy which governs its modification.</p><p>æœ€åä¸€ç§ç­–ç•¥å¯¹äºFabricä¸­çš„ç­–ç•¥å·¥ä½œè‡³å…³é‡è¦ï¼Œå³<code>Modification policy</code>ã€‚ä¿®æ”¹ç­–ç•¥æŒ‡å®šäº†ä»»ä½•é…ç½®æ›´æ–°æ—¶éœ€è¦ç­¾åï¼ˆæ‰¹å‡†ï¼‰çš„ä¸€ç»„èº«ä»½ã€‚è¯¥ç­–ç•¥å®šä¹‰äº†å¦‚ä½•æ›´æ–°ç­–ç•¥ã€‚å› æ­¤ï¼Œæ¯ä¸ªé€šé“é…ç½®å…ƒç´ éƒ½åŒ…å«ä¸€ä¸ªå¯¹ç®¡ç†å…¶ä¿®æ”¹çš„ç­–ç•¥çš„å¼•ç”¨ã€‚</p><h2 id="The-Fabric-policy-domains">The Fabric policy domains</h2><p>While Fabric policies are flexible and can be configured to meet the needs of a network, the policy structure naturally leads to a division between the domains governed by either the Ordering Service organizations or the members of the consortium. In the following diagram you can see how the default policies implement control over the Fabric policy domains below.</p><p>è™½ç„¶Fabricçš„ç­–ç•¥æ˜¯çµæ´»çš„ï¼Œå¯ä»¥é…ç½®ä¸ºæ»¡è¶³ç½‘ç»œéœ€æ±‚ï¼Œä½†æ˜¯ç­–ç•¥ç»“æ„è‡ªç„¶ä¼šå¯¼è‡´ç”±æ’åºæœåŠ¡ç»„ç»‡æˆ–è”ç›Ÿæˆå‘˜ç®¡ç†çš„åŸŸä¹‹é—´çš„åˆ’åˆ†ã€‚åœ¨ä¸‹å›¾ä¸­ä½ ä¼šçœ‹åˆ°é»˜è®¤ç­–ç•¥æ˜¯å¦‚ä½•å®ç°å¯¹ç»“æ„ç­–ç•¥åŸŸçš„æ§åˆ¶ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/FabricPolicyHierarchy-4.png" alt="FabricPolicyHierarchy-4"></p><p><em>A more detailed look at the policy domains governed by the Orderer organizations and consortium organizations.</em></p><p><em>æ›´è¯¦ç»†åœ°äº†è§£ç”±è®¢è´­è€…ç»„ç»‡å’Œè´¢å›¢ç»„ç»‡ç®¡ç†çš„ç­–ç•¥åŸŸã€‚</em></p><p>A fully functional Fabric network can feature many organizations with different responsibilities. The domains provide the ability to extend different privileges and roles to different organizations by allowing the founders of the ordering service the ability to establish the initial rules and membership of the consortium. They also allow the organizations that join the consortium to create private application channels, govern their own business logic, and restrict access to the data that is put on the network.</p><p>åŠŸèƒ½é½å…¨çš„Fabricç½‘ç»œå¯ä»¥ä½¿è®¸å¤šä¸ªç»„ç»‡æ‰¿æ‹…ä¸åŒçš„èŒè´£ã€‚åŸŸé€šè¿‡å…è®¸æ’åºæœåŠ¡çš„åˆ›å»ºè€…å»ºç«‹è”ç›Ÿçš„åˆå§‹è§„åˆ™å’Œæˆå‘˜èµ„æ ¼çš„èƒ½åŠ›æ¥æä¾›å°†ä¸åŒçš„ç‰¹æƒå’Œè§’è‰²æ‰©å±•åˆ°ä¸åŒç»„ç»‡çš„èƒ½åŠ›ã€‚åŸŸè¿˜å…è®¸åŠ å…¥è¯¥è”ç›Ÿçš„ç»„ç»‡åˆ›å»ºç§æœ‰åº”ç”¨ç¨‹åºé€šé“ï¼Œç®¡ç†ä»–ä»¬è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶é™åˆ¶å¯¹ç½‘ç»œä¸Šæ”¾ç½®çš„æ•°æ®çš„è®¿é—®ã€‚</p><p>The system channel configuration and a portion of each application channel configuration provides the ordering organizations control over which organizations are members of the consortium, how blocks are delivered to channels, and the consensus mechanism used by the nodes of the ordering service.</p><p>ç³»ç»Ÿé€šé“é…ç½®å’Œæ¯ä¸ªåº”ç”¨ç¨‹åºé€šé“é…ç½®çš„ä¸€éƒ¨åˆ†ä¸ºæ’åºç»„ç»‡æä¾›äº†æ§åˆ¶ï¼Œè¿™äº›ç»„ç»‡å¯ä»¥æ§åˆ¶å“ªäº›ç»„ç»‡æ˜¯è”ç›Ÿçš„æˆå‘˜ï¼Œå¦‚ä½•å°†åŒºå—äº¤ä»˜åˆ°æ¸ é“ä»¥åŠæ’åºæœåŠ¡çš„èŠ‚ç‚¹æ‰€ä½¿ç”¨çš„å…±è¯†æœºåˆ¶ã€‚</p><p>The system channel configuration provides members of the consortium the ability to create channels. Application channels and ACLs are the mechanism that consortium organizations use to add or remove members from a channel and restrict access to data and smart contracts on a channel.</p><p>ç³»ç»Ÿé€šé“æä¾›äº†å“ªäº›è”ç›Ÿçš„æˆå‘˜æœ‰èƒ½åŠ›åˆ›å»ºé€šé“ã€‚ç³»ç»Ÿé€šé“å’ŒACLæ˜¯è”ç›Ÿç»„ç»‡ç”¨äºåœ¨é€šé“ä¸­æ·»åŠ æˆ–åˆ é™¤æˆå‘˜å¹¶é™åˆ¶å¯¹é€šé“ä¸Šæ•°æ®å’Œæ™ºèƒ½åˆçº¦çš„è®¿é—®çš„æœºåˆ¶ã€‚</p><h2 id="How-do-you-write-a-policy-in-Fabric">How do you write a policy in Fabric</h2><p>If you want to change anything in Fabric, the policy associated with the resource describes <strong>who</strong> needs to approve it, either with an explicit sign off from individuals, or an implicit sign off by a group. In the insurance domain, an explicit sign off could be a single member of the homeowners insurance agents group. And an implicit sign off would be analogous to requiring approval from a majority of the managerial members of the homeowners insurance group. This is particularly useful because the members of that group can change over time without requiring that the policy be updated. In Hyperledger Fabric, explicit sign offs in policies are expressed using the <code>Signature</code> syntax and implicit sign offs use the <code>ImplicitMeta</code> syntax.</p><p>å¦‚æœè¦æ›´æ”¹Fabricä¸­çš„ä»»ä½•å†…å®¹ï¼Œåˆ™ä¸èµ„æºç›¸å…³è”çš„ç­–ç•¥æè¿°äº†è°éœ€è¦æ‰¹å‡†å®ƒï¼Œå¯ä»¥æ˜¯ä¸ªäººçš„æ˜¾ç¤ºç­¾åï¼Œä¹Ÿå¯ä»¥æ˜¯ç»„çš„éšå¼ç­¾åã€‚åœ¨ä¿é™©é¢†åŸŸï¼Œæ˜¾ç¤ºç­¾åå¯ä»¥æ˜¯æˆ¿ä¸»ä¿é™©ä»£ç†äººç»„çš„å•ä¸ªæˆå‘˜ã€‚éšå¼ç­¾åç±»ä¼¼äºè¦æ±‚æˆ¿ä¸»ä¿é™©é›†å›¢çš„å¤§å¤šæ•°ç®¡ç†äººå‘˜æ‰¹å‡†ã€‚è¿™ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºè¯¥ç»„çš„æˆå‘˜å¯ä»¥éšæ—¶é—´å˜åŒ–è€Œæ— éœ€æ›´æ–°ç­–ç•¥ã€‚åœ¨Hyperledger Fabricä¸­ï¼Œç­–ç•¥ä¸­çš„æ˜¾å¼ç­¾åä½¿ç”¨<code>Signature</code>è¯­æ³•è¡¨ç¤ºï¼Œè€Œéšå¼ç­¾åä½¿ç”¨<code>ImplicitMeta</code>è¯­æ³•ã€‚</p><h3 id="Signature-policies">Signature policies</h3><p><code>Signature</code> policies define specific types of users who must sign in order for a policy to be satisfied such as <code>OR('Org1.peer', 'Org2.peer')</code>. These policies are considered the most versatile because they allow for the construction of extremely specific rules like: â€œAn admin of org A and 2 other admins, or 5 of 6 organization adminsâ€. The syntax supports arbitrary combinations of <code>AND</code>, <code>OR</code> and <code>NOutOf</code>. For example, a policy can be easily expressed by using <code>AND('Org1.member', 'Org2.member')</code> which means that a signature from at least one member in Org1 AND one member in Org2 is required for the policy to be satisfied.</p><p><code>Signature</code> ç­–ç•¥å®šä¹‰äº†å¿…é¡»ç”±æŒ‡å®šç±»å‹çš„ç”¨æˆ·ç­¾åæ‰èƒ½æ»¡è¶³ç­–ç•¥ï¼Œä¾‹å¦‚ <code>OR('Org1.peer', 'Org2.peer')</code>ã€‚è¿™äº›ç­–ç•¥è¢«è®¤ä¸ºæ˜¯æœ€é€šç”¨çš„ï¼Œå› ä¸ºå®ƒä»¬å…è®¸æ„å»ºæå…¶ç‰¹å®šçš„è§„åˆ™ï¼Œä¾‹å¦‚ï¼šâ€œç»„ç»‡Açš„ä¸€ä¸ªç®¡ç†å‘˜å’Œ2ä¸ªå…¶ä»–ç®¡ç†å‘˜ï¼Œæˆ–6ä¸ªç»„ç»‡ä¸­çš„5ä¸ªç®¡ç†å‘˜â€ã€‚</p><h3 id="ImplicitMeta-policies">ImplicitMeta policies</h3><p><code>ImplicitMeta</code> policies are only valid in the context of channel configuration which is based on a tiered hierarchy of policies in a configuration tree. ImplicitMeta policies aggregate the result of policies deeper in the configuration tree that are ultimately defined by Signature policies. They are <code>Implicit</code> because they are constructed implicitly based on the current organizations in the channel configuration, and they are <code>Meta</code> because their evaluation is not against specific MSP principals, but rather against other sub-policies below them in the configuration tree.</p><p><code>ImplicitMeta</code> ç­–ç•¥ä»…åœ¨é€šé“é…ç½®çš„ä¸Šä¸‹æ–‡ä¸­æœ‰æ•ˆï¼Œè¯¥é…ç½®åŸºäºé…ç½®æ ‘ä¸­ç­–ç•¥çš„åˆ†å±‚å±‚æ¬¡ç»“æ„ã€‚<code> ImplicitMeta</code>ç­–ç•¥å°†åœ¨é…ç½®æ ‘ä¸­æ›´æ·±çš„ç­–ç•¥çš„ç»“æœæ±‡æ€»åœ¨ä¸€èµ·ï¼Œè¿™äº›ç­–ç•¥æœ€ç»ˆç”±ç­¾åç­–ç•¥å®šä¹‰ã€‚å®ƒä»¬æ˜¯<code>Implicit</code>çš„ï¼Œå› ä¸ºå®ƒä»¬æ˜¯åŸºäºæ¸ é“é…ç½®ä¸­çš„å½“å‰ç»„ç»‡éšå¼æ„é€ çš„ï¼Œä¹‹æ‰€ä»¥ç§°ä¸º<code>Meta</code>ï¼Œæ˜¯å› ä¸ºå®ƒä»¬çš„è¯„ä¼°ä¸æ˜¯é’ˆå¯¹ç‰¹å®šçš„MSPä¸»ä½“ï¼Œè€Œæ˜¯é’ˆå¯¹é…ç½®æ ‘ä¸­ä½äºå…¶ä¸‹æ–¹çš„å…¶ä»–å­ç­–ç•¥ã€‚</p><p>The following diagram illustrates the tiered policy structure for an application channel and shows how the <code>ImplicitMeta</code> channel configuration admins policy, named <code>/Channel/Admins</code>, is resolved when the sub-policies named <code>Admins</code> below it in the configuration hierarchy are satisfied where each check mark represents that the conditions of the sub-policy were satisfied.</p><p>ä¸‹å›¾è¯´æ˜äº†åº”ç”¨ç¨‹åºé€šé“çš„åˆ†å±‚ç­–ç•¥ç»“æ„,å¹¶æ˜¾ç¤ºåä¸º <code>/Channel/Admins</code>çš„ <code>ImplicitMeta</code> é€šé“é…ç½®ç®¡ç†å‘˜ç­–ç•¥ï¼Œå½“æ»¡è¶³é…ç½®å±‚æ¬¡ç»“æ„ä¸­ä½äºå…¶ä¸‹æ–¹çš„åä¸º<code>Admins</code>çš„å­ç­–ç•¥æ—¶ï¼Œå°†è§£å†³æ­¤é—®é¢˜ï¼Œå…¶ä¸­æ¯ä¸ªå¤é€‰æ ‡è®°è¡¨ç¤ºå·²æ»¡è¶³è¯¥å­ç­–ç•¥çš„æ¡ä»¶ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/FabricPolicyHierarchy-6.png" alt="FabricPolicyHierarchy-6"></p><p>As you can see in the diagram above, <code>ImplicitMeta</code> policies, Type = 3, use a different syntax, <code>&quot;&lt;ANY|ALL|MAJORITY&gt; &lt;SubPolicyName&gt;&quot;</code>, for example:</p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œ<code>ImplicitMeta</code> ç­–ç•¥ï¼Œ Type = 3ï¼Œä½¿ç”¨ä¸åŒçš„è¯­æ³•<code>&quot;&lt;ANY|ALL|MAJORITY&gt; &lt;SubPolicyName&gt;&quot;</code>ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#96;MAJORITY sub policy: Admins&#96;</span><br></pre></td></tr></table></figure><p>The diagram shows a sub-policy <code>Admins</code>, which refers to all the <code>Admins</code> policy below it in the configuration tree. You can create your own sub-policies and name them whatever you want and then define them in each of your organizations.</p><p>è¯¥å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªå­ç­–ç•¥<code>Admins</code>ï¼Œå®ƒå¼•ç”¨é…ç½®æ ‘ä¸­å…¶ä¸‹æ–¹çš„æ‰€æœ‰<code>Admins</code>ç­–ç•¥ã€‚æ‚¨å¯ä»¥åˆ›å»ºè‡ªå·±çš„å­ç­–ç•¥ï¼Œå¹¶æ ¹æ®éœ€è¦å‘½åå®ƒä»¬ï¼Œç„¶ååœ¨ä½ çš„æ¯ä¸ªç»„ç»‡ä¸­å¯¹å…¶è¿›è¡Œå®šä¹‰ã€‚</p><p>As mentioned above, a key benefit of an <code>ImplicitMeta</code> policy such as <code>MAJORITY Admins</code> is that when you add a new admin organization to the channel, you do not have to update the channel policy. Therefore <code>ImplicitMeta</code> policies are considered to be more flexible as the consortium members change. The consortium on the orderer can change as new members are added or an existing member leaves with the consortium members agreeing to the changes, but no policy updates are required. Recall that <code>ImplicitMeta</code> policies ultimately resolve the <code>Signature</code> sub-policies underneath them in the configuration tree as the diagram shows.</p><p>å¦‚ä¸Šæ‰€è¿°ï¼Œ<code>ImplicitMeta</code>ç­–ç•¥ï¼ˆä¾‹å¦‚<code>MAJORITY Admins</code>ï¼‰çš„ä¸»è¦ä¼˜åŠ¿åœ¨äºï¼Œå½“æ‚¨å‘é€šé“æ·»åŠ æ–°çš„ç®¡ç†å‘˜ç»„ç»‡æ—¶ï¼Œä¸å¿…æ›´æ–°é¢‘é“ç­–ç•¥ã€‚å› æ­¤ï¼Œéšç€è”ç›Ÿæˆå‘˜çš„å˜åŒ–ï¼Œ<code>ImplicitMeta</code>ç­–ç•¥è¢«è®¤ä¸ºæ›´åŠ çµæ´»ã€‚å½“æ·»åŠ æ–°æˆå‘˜æˆ–ç°æœ‰æˆå‘˜ç¦»å¼€æ—¶ï¼Œæ’åºè€…ä¸Šçš„è”ç›Ÿå¯ä»¥æ›´æ”¹ï¼Œè”ç›Ÿæˆå‘˜åŒæ„æ›´æ”¹ï¼Œä½†æ˜¯ä¸éœ€è¦æ›´æ–°ç­–ç•¥ã€‚å›æƒ³ä¸€ä¸‹ï¼Œ<code>ImplicitMeta</code>ç­–ç•¥æœ€ç»ˆåœ¨é…ç½®æ ‘ä¸­è§£å†³äº†å…¶ä¸‹æ–¹çš„<code>Signature</code>å­ç­–ç•¥ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p><p>You can also define an application level implicit policy to operate across organizations, in a channel for example, and either require that ANY of them are satisfied, that ALL are satisfied, or that a MAJORITY are satisfied. This format lends itself to much better, more natural defaults, so that each organization can decide what it means for a valid endorsement.</p><p>æ‚¨è¿˜å¯ä»¥å®šä¹‰ä¸€ä¸ªåº”ç”¨ç¨‹åºçº§åˆ«çš„éšå¼ç­–ç•¥ï¼Œä»¥åœ¨ç»„ç»‡ä¸­ï¼ˆä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªé€šé“ä¸­ï¼‰è¿›è¡Œæ“ä½œï¼Œå¹¶è¦æ±‚æ»¡è¶³å®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œæ»¡è¶³æ‰€æœ‰æ¡ä»¶æˆ–æ»¡è¶³å¤§å¤šæ•°æ¡ä»¶ã€‚è¿™ç§æ ¼å¼é€‚åˆäºæ›´å¥½ï¼Œæ›´è‡ªç„¶çš„é»˜è®¤è®¾ç½®ï¼Œä»¥ä¾¿æ¯ä¸ªç»„ç»‡å¯ä»¥å†³å®šå¯¹æœ‰æ•ˆèƒŒä¹¦çš„å«ä¹‰ã€‚</p><p>Further granularity and control can be achieved if you include <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/policies/msp.html#organizational-units"><code>NodeOUs</code></a> in your organization definition. Organization Units (OUs) are defined in the Fabric CA client configuration file and can be associated with an identity when it is created. In Fabric, <code>NodeOUs</code> provide a way to classify identities in a digital certificate hierarchy. For instance, an organization having specific <code>NodeOUs</code> enabled could require that a â€˜peerâ€™ sign for it to be a valid endorsement, whereas an organization without any might simply require that any member can sign.</p><p>å¦‚æœåœ¨ç»„ç»‡å®šä¹‰ä¸­åŒ…å«<code>NodeOU</code>ï¼Œåˆ™å¯ä»¥å®ç°è¿›ä¸€æ­¥çš„ç²’åº¦å’Œæ§åˆ¶ã€‚ç»„ç»‡å•ä½ï¼ˆOUï¼‰åœ¨Fabric CAå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ï¼Œå¹¶ä¸”åœ¨åˆ›å»ºæ—¶å¯ä»¥ä¸èº«ä»½ç›¸å…³è”ã€‚NodeOUæä¾›äº†ä¸€ç§åœ¨æ•°å­—è¯ä¹¦å±‚æ¬¡ç»“æ„ä¸­å¯¹èº«ä»½è¿›è¡Œåˆ†ç±»çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¯ç”¨äº†ç‰¹å®š<code>NodeOU</code>çš„ç»„ç»‡å¯èƒ½è¦æ±‚â€œpeerâ€æ ‡å¿—æ‰èƒ½æœ‰æ•ˆåœ°èƒŒä¹¦ï¼Œè€Œåªæœ‰ç»„ç»‡è€Œä¸åŒ…å«ä»»ä½•å…¶ä»–å¯èƒ½åªè¦æ±‚ä»»ä½•æˆå‘˜éƒ½å¯ä»¥ç­¾åã€‚</p><h2 id="An-example-channel-configuration-policy">An example: channel configuration policy</h2><p>Understanding policies begins with examining the <code>configtx.yaml</code> where the channel policies are defined. We can use the <code>configtx.yaml</code> file in the Fabric test network to see examples of both policy syntax types. We are going to examine the configtx.yaml file used by the <a href="https://github.com/hyperledger/fabric-samples/blob/release-2.2/test-network/configtx/configtx.yaml">fabric-samples/test-network</a> sample.</p><p>The first section of the file defines the organizations of the network. Inside each organization definition are the default policies for that organization, <code>Readers</code>, <code>Writers</code>, <code>Admins</code>, and <code>Endorsement</code>, although you can name your policies anything you want. Each policy has a <code>Type</code> which describes how the policy is expressed (<code>Signature</code> or <code>ImplicitMeta</code>) and a <code>Rule</code>.</p><p>The test network example below shows the Org1 organization definition in the system channel, where the policy <code>Type</code> is <code>Signature</code> and the endorsement policy rule is defined as <code>&quot;OR('Org1MSP.peer')&quot;</code>. This policy specifies that a peer that is a member of <code>Org1MSP</code> is required to sign. It is these signature policies that become the sub-policies that the ImplicitMeta policies point to.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   SECTION: Application</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - This section defines the values to encode into a config transaction or</span></span><br><span class="line"><span class="comment">#   genesis block for application related parameters</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Application:</span> <span class="meta">&amp;ApplicationDefaults</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Organizations is the list of orgs which are defined as participants on</span></span><br><span class="line">    <span class="comment"># the application side of the network</span></span><br><span class="line">    <span class="attr">Organizations:</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Policies defines the set of policies at this level of the config tree</span></span><br><span class="line">    <span class="comment"># For Application policies, their canonical path is</span></span><br><span class="line">    <span class="comment">#   /Channel/Application/&lt;PolicyName&gt;</span></span><br><span class="line">    <span class="attr">Policies:</span></span><br><span class="line">        <span class="attr">Readers:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;ANY Readers&quot;</span></span><br><span class="line">        <span class="attr">Writers:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;ANY Writers&quot;</span></span><br><span class="line">        <span class="attr">Admins:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;MAJORITY Admins&quot;</span></span><br><span class="line">        <span class="attr">LifecycleEndorsement:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;MAJORITY Endorsement&quot;</span></span><br><span class="line">        <span class="attr">Endorsement:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;MAJORITY Endorsement&quot;</span></span><br></pre></td></tr></table></figure><p>The next example shows the <code>ImplicitMeta</code> policy type used in the <code>Application</code> section of the <code>configtx.yaml</code>. These set of policies lie on the <code>/Channel/Application/</code> path. If you use the default set of Fabric ACLs, these policies define the behavior of many important features of application channels, such as who can query the channel ledger, invoke a chaincode, or update a channel config. These policies point to the sub-policies defined for each organization. The Org1 defined in the section above contains <code>Reader</code>, <code>Writer</code>, and <code>Admin</code> sub-policies that are evaluated by the <code>Reader</code>, <code>Writer</code>, and <code>Admin</code> <code>ImplicitMeta</code> policies in the <code>Application</code> section. Because the test network is built with the default policies, you can use the example Org1 to query the channel ledger, invoke a chaincode, and approve channel updates for any test network channel that you create.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   SECTION: Application</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - This section defines the values to encode into a config transaction or</span></span><br><span class="line"><span class="comment">#   genesis block for application related parameters</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Application:</span> <span class="meta">&amp;ApplicationDefaults</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Organizations is the list of orgs which are defined as participants on</span></span><br><span class="line">    <span class="comment"># the application side of the network</span></span><br><span class="line">    <span class="attr">Organizations:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Policies defines the set of policies at this level of the config tree</span></span><br><span class="line">    <span class="comment"># For Application policies, their canonical path is</span></span><br><span class="line">    <span class="comment">#   /Channel/Application/&lt;PolicyName&gt;</span></span><br><span class="line">    <span class="attr">Policies:</span></span><br><span class="line">        <span class="attr">Readers:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;ANY Readers&quot;</span></span><br><span class="line">        <span class="attr">Writers:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;ANY Writers&quot;</span></span><br><span class="line">        <span class="attr">Admins:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;MAJORITY Admins&quot;</span></span><br><span class="line">        <span class="attr">LifecycleEndorsement:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;MAJORITY Endorsement&quot;</span></span><br><span class="line">        <span class="attr">Endorsement:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;MAJORITY Endorsement&quot;</span></span><br></pre></td></tr></table></figure><h2 id="Fabric-chaincode-lifecycle">Fabric chaincode lifecycle</h2><p>In the Fabric 2.0 release, a new chaincode lifecycle process was introduced, whereby a more democratic process is used to govern chaincode on the network. The new process allows multiple organizations to vote on how a chaincode will be operated before it can be used on a channel. This is significant because it is the combination of this new lifecycle process and the policies that are specified during that process that dictate the security across the network. More details on the flow are available in the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/chaincode_lifecycle.html">Fabric chaincode lifecycle</a> concept topic, but for purposes of this topic you should understand how policies are used in this flow. The new flow includes two steps where policies are specified: when chaincode is <strong>approved</strong> by organization members, and when it is <strong>committed</strong> to the channel.</p><p>The <code>Application</code> section of the <code>configtx.yaml</code> file includes the default chaincode lifecycle endorsement policy. In a production environment you would customize this definition for your own use case.</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   SECTION: Application</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#   - This section defines the values to encode into a config transaction or</span></span><br><span class="line"><span class="comment">#   genesis block for application related parameters</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">################################################################################</span></span><br><span class="line"><span class="attr">Application:</span> <span class="meta">&amp;ApplicationDefaults</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Organizations is the list of orgs which are defined as participants on</span></span><br><span class="line">    <span class="comment"># the application side of the network</span></span><br><span class="line">    <span class="attr">Organizations:</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Policies defines the set of policies at this level of the config tree</span></span><br><span class="line">    <span class="comment"># For Application policies, their canonical path is</span></span><br><span class="line">    <span class="comment">#   /Channel/Application/&lt;PolicyName&gt;</span></span><br><span class="line">    <span class="attr">Policies:</span></span><br><span class="line">        <span class="attr">Readers:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;ANY Readers&quot;</span></span><br><span class="line">        <span class="attr">Writers:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;ANY Writers&quot;</span></span><br><span class="line">        <span class="attr">Admins:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;MAJORITY Admins&quot;</span></span><br><span class="line">        <span class="attr">LifecycleEndorsement:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;MAJORITY Endorsement&quot;</span></span><br><span class="line">        <span class="attr">Endorsement:</span></span><br><span class="line">            <span class="attr">Type:</span> <span class="string">ImplicitMeta</span></span><br><span class="line">            <span class="attr">Rule:</span> <span class="string">&quot;MAJORITY Endorsement&quot;</span></span><br></pre></td></tr></table></figure><ul><li><p>The <code>LifecycleEndorsement</code> policy governs who needs to <em>approve a chaincode definition</em>.</p><p><code>LifecycleEndorsement</code> ç­–ç•¥ç®¡ç†è°éœ€è¦æ‰¹å‡†é“¾ç å®šä¹‰</p></li><li><p>The <code>Endorsement</code> policy is the <em>default endorsement policy for a chaincode</em>. More on this below.</p><p><code>Endorsement</code>ç­–ç•¥æ˜¯é“¾ç çš„é»˜è®¤èƒŒä¹¦ç­–ç•¥ï¼Œè¯¦æƒ…åœ¨ä¸‹é¢ã€‚</p></li></ul><h2 id="Chaincode-endorsement-policies">Chaincode endorsement policies</h2><p>The endorsement policy is specified for a <strong>chaincode</strong> when it is approved and committed to the channel using the Fabric chaincode lifecycle (that is, one endorsement policy covers all of the state associated with a chaincode). The endorsement policy can be specified either by reference to an endorsement policy defined in the channel configuration or by explicitly specifying a Signature policy.</p><p>åœ¨ä½¿ç”¨Fabricé“¾ç ç”Ÿå‘½å‘¨æœŸæ‰¹å‡†é“¾ç å¹¶å°†å…¶æäº¤ç»™é€šé“æ—¶ä¾¿æŒ‡å®šäº†é“¾ç çš„èƒŒä¹¦ç­–ç•¥ï¼ˆå³ï¼Œä¸€ç§èƒŒä¹¦ç­–ç•¥æ¶µç›–äº†ä¸é“¾ç ç›¸å…³è”çš„æ‰€æœ‰çŠ¶æ€ï¼‰ã€‚å¯ä»¥é€šè¿‡å‚è€ƒåœ¨é€šé“é…ç½®ä¸­å®šä¹‰çš„èƒŒä¹¦ç­–ç•¥æ¥æŒ‡å®šèƒŒä¹¦ç­–ç•¥ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ˜¾å¼æŒ‡å®šç­¾åç­–ç•¥æ¥æŒ‡å®šèƒŒä¹¦ç­–ç•¥ã€‚</p><p>If an endorsement policy is not explicitly specified during the approval step, the default <code>Endorsement</code> policy <code>&quot;MAJORITY Endorsement&quot;</code> is used which means that a majority of the peers belonging to the different channel members (organizations) need to execute and validate a transaction against the chaincode in order for the transaction to be considered valid. This default policy allows organizations that join the channel to become automatically added to the chaincode endorsement policy. If you donâ€™t want to use the default endorsement policy, use the Signature policy format to specify a more complex endorsement policy (such as requiring that a chaincode be endorsed by one organization, and then one of the other organizations on the channel).</p><p>Signature policies also allow you to include <code>principals</code> which are simply a way of matching an identity to a role. Principals are just like user IDs or group IDs, but they are more versatile because they can include a wide range of properties of an actorâ€™s identity, such as the actorâ€™s organization, organizational unit, role or even the actorâ€™s specific identity. When we talk about principals, they are the properties which determine their permissions. Principals are described as â€˜MSP.ROLEâ€™, where <code>MSP</code> represents the required MSP ID (the organization), and <code>ROLE</code> represents one of the four accepted roles: Member, Admin, Client, and Peer. A role is associated to an identity when a user enrolls with a CA. You can customize the list of roles available on your Fabric CA.</p><p>Some examples of valid principals are:</p><ul><li>â€˜Org0.Adminâ€™: an administrator of the Org0 MSP</li><li>â€˜Org1.Memberâ€™: a member of the Org1 MSP</li><li>â€˜Org1.Clientâ€™: a client of the Org1 MSP</li><li>â€˜Org1.Peerâ€™: a peer of the Org1 MSP</li><li>â€˜OrdererOrg.Ordererâ€™: an orderer in the OrdererOrg MSP</li></ul><p>There are cases where it may be necessary for a particular state (a particular key-value pair, in other words) to have a different endorsement policy. This <strong>state-based endorsement</strong> allows the default chaincode-level endorsement policies to be overridden by a different policy for the specified keys.</p><p>For a deeper dive on how to write an endorsement policy refer to the topic on <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/endorsement-policies.html">Endorsement policies</a> in the Operations Guide.</p><p><strong>Note:</strong> Policies work differently depending on which version of Fabric you are using:</p><ul><li>In Fabric releases prior to 2.0, chaincode endorsement policies can be updated during chaincode instantiation or by using the chaincode lifecycle commands. If not specified at instantiation time, the endorsement policy defaults to â€œany member of the organizations in the channelâ€. For example, a channel with â€œOrg1â€ and â€œOrg2â€ would have a default endorsement policy of â€œOR(â€˜Org1.memberâ€™, â€˜Org2.memberâ€™)â€.</li><li>Starting with Fabric 2.0, Fabric introduced a new chaincode lifecycle process that allows multiple organizations to agree on how a chaincode will be operated before it can be used on a channel. The new process requires that organizations agree to the parameters that define a chaincode, such as name, version, and the chaincode endorsement policy.</li></ul><h2 id="Overriding-policy-definitions">Overriding policy definitions</h2><p>Hyperledger Fabric includes default policies which are useful for getting started, developing, and testing your blockchain, but they are meant to be customized in a production environment. You should be aware of the default policies in the <code>configtx.yaml</code> file. Channel configuration policies can be extended with arbitrary verbs, beyond the default <code>Readers, Writers, Admins</code> in <code>configtx.yaml</code>. The orderer system and application channels are overridden by issuing a config update when you override the default policies by editing the <code>configtx.yaml</code> for the orderer system channel or the <code>configtx.yaml</code> for a specific channel.</p><p>See the topic on <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/config_update.html#updating-a-channel-configuration">Updating a channel configuration</a> for more information.</p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> Key Concepts </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> Policies </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Peers</title>
      <link href="2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Peers/"/>
      <url>2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Peers/</url>
      
        <content type="html"><![CDATA[<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/peers/peers.html">Peers</a></p><h1 id="Peers">Peers</h1><p>A blockchain network is comprised primarily of a set of <em>peer nodes</em> (or, simply, <em>peers</em>). Peers are a fundamental element of the network because they host ledgers and smart contracts. Recall that a ledger immutably records all the transactions generated by smart contracts (which in Hyperledger Fabric are contained in a <em>chaincode</em>, more on this later). Smart contracts and ledgers are used to encapsulate the shared <em>processes</em> and shared <em>information</em> in a network, respectively. These aspects of a peer make them a good starting point to understand a Fabric network.</p><p>åŒºå—é“¾ç½‘ç»œä¸»è¦ç”±ä¸€ç»„peerèŠ‚ç‚¹ç»„æˆï¼ˆç®€ç§°peersï¼‰ã€‚peersæ˜¯ç½‘ç»œçš„åŸºæœ¬å…ƒç´ ï¼Œæ˜¯å› ä¸ºå®ƒä»¬æ‰˜ç®¡è´¦æœ¬å’Œæ™ºèƒ½åˆçº¦ã€‚å›æƒ³ä¸€ä¸‹ï¼Œè´¦æœ¬ä¸€æˆä¸å˜åœ°è®°å½•äº†æ™ºèƒ½åˆçº¦ç”Ÿæˆçš„æ‰€æœ‰äº¤æ˜“ã€‚æ™ºèƒ½åˆçº¦å’Œè´¦æœ¬åˆ†åˆ«ç”¨äºå°è£…ç½‘ç»œä¸­çš„å…±äº«ç¨‹åºå’Œå…±äº«ä¿¡æ¯ã€‚peersçš„è¿™äº›æ–¹é¢ä½¿å®ƒä»¬æˆä¸ºäº†è§£Fabricç½‘ç»œçš„è‰¯å¥½èµ·ç‚¹ã€‚</p><p>Other elements of the blockchain network are of course important: ledgers and smart contracts, orderers, policies, channels, applications, organizations, identities, and membership, and you can read more about them in their own dedicated sections. This section focusses on peers, and their relationship to those other elements in a Fabric network.</p><p>ç»„æˆåŒºå—é“¾ç½‘ç»œçš„å…¶ä»–å…ƒç´ å½“ç„¶ä¹Ÿå¾ˆé‡è¦ï¼šè´¦æœ¬å’Œæ™ºèƒ½åˆçº¦ã€orderersã€ç­–ç•¥ã€é€šé“ã€åº”ç”¨ç¨‹åºã€ç»„ç»‡ã€èº«ä»½è¯†åˆ«ï¼Œä»¥åŠè”ç›Ÿæˆå‘˜ï¼Œæ‚¨å¯ä»¥åœ¨ä»–ä»¬è‡ªå·±çš„ä¸“ç”¨éƒ¨åˆ†ä¸­é˜…è¯»æœ‰å…³å®ƒä»¬çš„æ›´å¤šä¿¡æ¯ã€‚æœ¬èŠ‚é‡ç‚¹ä»‹ç»peersåŠå…¶ä¸Fabricç½‘ç»œä¸­å…¶ä»–å…ƒç´ çš„å…³ç³»ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/peers.diagram.1.png" alt="peers.diagram.1"></p><p><em>A blockchain network is comprised of peer nodes, each of which can hold copies of ledgers and copies of smart contracts. In this example, the network N consists of peers P1, P2 and P3, each of which maintain their own instance of the distributed ledger L1. P1, P2 and P3 use the same chaincode, S1, to access their copy of that distributed ledger</em>.</p><p><em>æ™ºèƒ½åˆçº¦çš„ç½‘ç»œæ˜¯ç”±peerèŠ‚ç‚¹æ„æˆï¼Œæ¯ä¸ªpeerèŠ‚ç‚¹éƒ½æ‰˜ç®¡è´¦æœ¬çš„å‰¯æœ¬ä»¥åŠæ™ºèƒ½åˆçº¦çš„å‰¯æœ¬ã€‚ç•¥ã€‚ã€‚ã€‚</em></p><p>Peers can be created, started, stopped, reconfigured, and even deleted. They expose a set of APIs that enable administrators and applications to interact with the services that they provide. Weâ€™ll learn more about these services in this section.</p><p>Peerså¯ä»¥è¢«åˆ é™¤ã€å¯åŠ¨ã€åœæ­¢ã€é‡æ–°é…ç½®ç”šè‡³åˆ é™¤ã€‚å®ƒä»¬æš´éœ²äº†ä¸€ç»„APIï¼Œä½¿ç®¡ç†å‘˜å’Œåº”ç”¨ç¨‹åºå¯ä»¥ä¸å…¶æä¾›çš„æœåŠ¡è¿›è¡Œäº¤äº’ã€‚æˆ‘ä»¬å°†åœ¨æœ¬èŠ‚ä¸­è¯¦ç»†äº†è§£è¿™äº›æœåŠ¡ã€‚</p><h2 id="A-word-on-terminologyï¼ˆæœ¯è¯­ï¼‰">A word on terminologyï¼ˆæœ¯è¯­ï¼‰</h2><p>Fabric implements <strong>smart contracts</strong> with a technology concept it calls <strong>chaincode</strong> â€” simply a piece of code that accesses the ledger, written in one of the supported programming languages. In this topic, weâ€™ll usually use the term <strong>chaincode</strong>, but feel free to read it as <strong>smart contract</strong> if youâ€™re more used to that term. Itâ€™s the same thing! If you want to learn more about chaincode and smart contracts, check out our <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/smartcontract/smartcontract.html">documentation on smart contracts and chaincode</a>.</p><p>Fabricé€šè¿‡ç§°ä¸ºé“¾ç çš„æŠ€æœ¯æ¦‚å¿µå®ç°æ™ºèƒ½åˆçº¦ï¼Œ<strong>chaincode</strong>æ˜¯ç”¨ä¸€ç§ä½¿ç”¨Fabricæ”¯æŒçš„ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„è®¿é—®è´¦æœ¬çš„ä¸€æ®µä»£ç ã€‚åœ¨æœ¬ä¸»é¢˜ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨<strong>chaincode</strong>ä¸€è¯ï¼Œä½†å¦‚æœæ‚¨æ›´ä¹ æƒ¯<strong>smart contract</strong>æœ¯è¯­ï¼Œä¹Ÿå¯ä»¥å°†å…¶ä½œä¸ºæ™ºèƒ½åˆçº¦é˜…è¯»ã€‚Itâ€™s the same thing! If you want to learn more about chaincode and smart contracts, check out our <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/smartcontract/smartcontract.html">documentation on smart contracts and chaincode</a>.</p><h2 id="Ledgers-and-Chaincode">Ledgers and Chaincode</h2><p>Letâ€™s look at a peer in a little more detail. We can see that itâ€™s the peer that hosts both the ledger and chaincode. More accurately, the peer actually hosts <em>instances</em> of the ledger, and <em>instances</em> of chaincode. Note that this provides a deliberate redundancy in a Fabric network â€” it avoids single points of failure. Weâ€™ll learn more about the distributed and decentralized nature of a blockchain network later in this section.</p><p>è®©æˆ‘ä»¬å†è¯¦ç»†çš„çœ‹ä¸€ä¸‹peerã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°peeræ—¢æ‰˜ç®¡äº†è´¦æœ¬ä¹Ÿæ‰˜ç®¡äº†é“¾ç ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œpeerå®é™…ä¸Šæ‰˜ç®¡è´¦æœ¬å®ä¾‹å’Œé“¾ç å®ä¾‹ã€‚è¯·æ³¨æ„ï¼Œè¿™åœ¨Fabricç½‘ç»œä¸­æä¾›äº†æœ‰æ„çš„å†—ä½™-é¿å…äº†å•ç‚¹æ•…éšœã€‚åœ¨æœ¬èŠ‚çš„åé¢ï¼Œæˆ‘ä»¬å°†è¯¦ç»†äº†è§£åŒºå—é“¾ç½‘ç»œçš„åˆ†å¸ƒå¼å’Œåˆ†æ•£å¼æ€§è´¨ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/peers.diagram.2.png" alt="peers.diagram.2"></p><p><em>A peer hosts instances of ledgers and instances of chaincodes. In this example, P1 hosts an instance of ledger L1 and an instance of chaincode S1. There can be many ledgers and chaincodes hosted on an individual peer.</em></p><p>Because a peer is a <em>host</em> for ledgers and chaincodes, applications and administrators must interact with a peer if they want to access these resources. Thatâ€™s why peers are considered the most fundamental building blocks of a Fabric network. When a peer is first created, it has neither ledgers nor chaincodes. Weâ€™ll see later how ledgers get created, and how chaincodes get installed, on peers.</p><p>å› ä¸ºpeeræ‰˜ç®¡äº†è´¦æœ¬å’Œé“¾ç ï¼Œå› æ­¤åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿç®¡ç†å‘˜å¦‚æœæƒ³è¦è·å–è¿™äº›èµ„æºå¿…é¡»ä¸peerè¿›è¡Œäº¤äº’ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå°†peerè§†ä¸ºFabricç½‘ç»œçš„æœ€åŸºæœ¬ç»„æˆéƒ¨åˆ†ã€‚å½“peeråœ¨ä¸€å¼€å§‹è¢«åˆ›å»ºæ—¶ï¼Œå®ƒæ—¢æ²¡æœ‰è´¦æœ¬ä¹Ÿæ²¡æœ‰é“¾ç ã€‚æˆ‘ä»¬ä¼šåœ¨åé¢çœ‹åˆ°åœ¨peersä¸Šè´¦æœ¬æ˜¯å¦‚ä½•åˆ›å»ºçš„ä»¥åŠé“¾ç æ˜¯å¦‚ä½•å®‰è£…çš„ã€‚</p><h3 id="Multiple-Ledgers">Multiple Ledgers</h3><p>A peer is able to host more than one ledger, which is helpful because it allows for a flexible system design. The simplest configuration is for a peer to manage a single ledger, but itâ€™s absolutely appropriate for a peer to host two or more ledgers when required.</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/peers.diagram.3.png" alt="peers.diagram.3"></p><p><em>A peer hosting multiple ledgers. Peers host one or more ledgers, and each ledger has zero or more chaincodes that apply to them. In this example, we can see that the peer P1 hosts ledgers L1 and L2. Ledger L1 is accessed using chaincode S1. Ledger L2 on the other hand can be accessed using chaincodes S1 and S2.</em></p><p><em>peeræ‰˜ç®¡äº†ä¸€ä¸ªæˆ–å¤šä¸ªè´¦æœ¬ï¼Œå¹¶ä¸”æ‰˜ç®¡äº†0ä¸ªæˆ–æ›´å¤šçš„é“¾ç </em></p><p>Although it is perfectly possible for a peer to host a ledger instance without hosting any chaincodes which access that ledger, itâ€™s rare that peers are configured this way. The vast majority of peers will have at least one chaincode installed on it which can query or update the peerâ€™s ledger instances. Itâ€™s worth mentioning in passing that, whether or not users have installed chaincodes for use by external applications, peers also have special <strong>system chaincodes</strong> that are always present. These are not discussed in detail in this topic.</p><p>å°½ç®¡å¯¹ç­‰ç‚¹å®Œå…¨æœ‰å¯èƒ½æ‰˜ç®¡ä¸€ä¸ªè´¦æœ¬å®ä¾‹è€Œä¸æ‰˜ç®¡ä»»ä½•è®¿é—®è¯¥è´¦æœ¬çš„é“¾ç ï¼Œä½†å¾ˆå°‘æœ‰peerä»¥è¿™ç§æ–¹å¼é…ç½®ã€‚ç»å¤§å¤šæ•°å¯¹ç­‰ç‚¹å°†è‡³å°‘å®‰è£…ä¸€ä¸ªé“¾ç ï¼Œå¯ä»¥æŸ¥è¯¢æˆ–æ›´æ–°peerçš„è´¦æœ¬å®ä¾‹ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ— è®ºç”¨æˆ·æ˜¯å¦å®‰è£…äº†ä¾›å¤–éƒ¨åº”ç”¨ç¨‹åºä½¿ç”¨çš„é“¾ç ï¼Œpeeréƒ½æœ‰å§‹ç»ˆå­˜åœ¨çš„ç‰¹æ®Šçš„ç³»ç»Ÿé“¾ç ã€‚è¿™äº›å°†ä¸åœ¨æœ¬ä¸»é¢˜ä¸­è¯¦ç»†è®¨è®ºã€‚</p><h3 id="Multiple-Chaincodes">Multiple Chaincodes</h3><p>There isnâ€™t a fixed relationship between the number of ledgers a peer has and the number of chaincodes that can access that ledger. A peer might have many chaincodes and many ledgers available to it.</p><p>Peeræ‹¥æœ‰çš„è´¦æœ¬æ•°é‡ä¸å¯ä»¥è®¿é—®è¯¥è´¦æœ¬çš„é“¾ç æ•°é‡ä¹‹é—´çš„å…³ç³»ä¸æ˜¯å›ºå®šçš„ã€‚ä¸€ä¸ªpeerå¯èƒ½æœ‰è®¸å¤šå¯ç”¨çš„é“¾ç å’Œåˆ†ç±»å¸ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/peers.diagram.4.png" alt="peers.diagram.4"></p><p><em>An example of a peer hosting multiple chaincodes. Each ledger can have many chaincodes which access it. In this example, we can see that peer P1 hosts ledgers L1 and L2, where L1 is accessed by chaincodes S1 and S2, and L2 is accessed by S1 and S3. We can see that S1 can access both L1 and L2.</em></p><p><em>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ—¢å¯ä»¥æœ‰å¤šä¸ªé“¾ç è®¿é—®åŒä¸€ä¸ªè´¦æœ¬ï¼›ä¹Ÿå¯ä»¥ä¸€ä¸ªé“¾ç è®¿é—®å¤šä¸ªè´¦æœ¬ã€‚</em></p><p>Weâ€™ll see a little later why the concept of <strong>channels</strong> in Fabric is important when hosting multiple ledgers or multiple chaincodes on a peer.</p><p>æˆ‘ä»¬ç¨åå†çœ‹åˆ°å½“åœ¨peerä¸Šæ‰˜ç®¡å¤šä¸ªåˆ†ç±»å¸æˆ–å¤šä¸ªé“¾ç æ—¶ï¼ŒFabricä¸­çš„é€šé“æ¦‚å¿µé‡è¦çš„åŸå› ã€‚</p><h2 id="Applications-and-Peers">Applications and Peers</h2><p>Weâ€™re now going to show how applications interact with peers to access the ledger. Ledger-query interactions involve a simple three-step dialogue between an application and a peer; ledger-update interactions are a little more involved, and require two extra steps. Weâ€™ve simplified these steps a little to help you get started with Fabric, but donâ€™t worry â€” whatâ€™s most important to understand is the difference in application-peer interactions for ledger-query compared to ledger-update transaction styles.</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†å±•ç¤ºåº”ç”¨ç¨‹åºå¦‚ä½•ä¸peeräº¤äº’ä»¥è®¿é—®è´¦æœ¬ã€‚è´¦æœ¬æŸ¥è¯¢äº¤äº’åŒ…æ‹¬åº”ç”¨ç¨‹åºå’Œpeerä¹‹é—´ç®€å•çš„ä¸‰æ­¥å¯¹è¯ï¼›è´¦æœ¬æ›´æ–°çš„äº¤äº’è¦å¤æ‚å¾—å¤šï¼Œå¹¶ä¸”éœ€è¦ä¸¤ä¸ªé¢å¤–çš„æ­¥éª¤ã€‚æˆ‘ä»¬å·²ç®€åŒ–äº†è¿™äº›æ­¥éª¤ï¼Œä»¥å¸®åŠ©æ‚¨å¼€å§‹ä½¿ç”¨Fabricï¼Œä½†è¯·æ”¾å¿ƒï¼Œæœ€é‡è¦çš„æ˜¯è¦äº†è§£è´¦æœ¬æŸ¥è¯¢ä¸è´¦æœ¬æ›´æ–°ä¸¤ç§äº¤æ˜“æ–¹å¼ä¹‹é—´çš„åº”ç”¨ç¨‹åºå’Œpeeräº¤äº’çš„å·®å¼‚ã€‚</p><p>Applications always connect to peers when they need to access ledgers and chaincodes. The Fabric Software Development Kit (SDK) makes this easy for programmers â€” its APIs enable applications to connect to peers, invoke chaincodes to generate transactions, submit transactions to the network that will get ordered, validated and committed to the distributed ledger, and receive events when this process is complete.</p><p>å½“åº”ç”¨ç¨‹åºéœ€è¦è®¿é—®è´¦æœ¬å’Œé“¾ç æ—¶æ€»æ˜¯ä¸peeré“¾æ¥ã€‚Fabricçš„SDKè®©è¿™å˜å¾—ç®€å•ï¼Œå®ƒçš„APIå¯ä»¥è®©åº”ç”¨ç¨‹åºé“¾æ¥åˆ°peersï¼Œè°ƒç”¨é“¾ç æ¥ç”Ÿæˆäº¤æ˜“ï¼Œæäº¤äº¤æ˜“åˆ°ç½‘ç»œå¹¶ä¸”è·å¾—æ’åºï¼ŒéªŒè¯å’Œæäº¤åˆ°åˆ†å¸ƒå¼è´¦æœ¬ä»¥åŠå½“è¿™äº›ç¨‹åºç»“æŸæ—¶æ¥æ”¶äº‹ä»¶ã€‚</p><p>Through a peer connection, applications can execute chaincodes to query or update a ledger. The result of a ledger query transaction is returned immediately, whereas ledger updates involve a more complex interaction between applications, peers and orderers. Letâ€™s investigate this in a little more detail.</p><p>é€šè¿‡è¿æ¥åˆ°ä¸€ä¸ªpeerï¼Œåº”ç”¨ç¨‹åºå¯ä»¥æ‰§è¡Œé“¾ç æ¥æŸ¥è¯¢æˆ–è€…æ›´æ–°è´¦æœ¬ã€‚è´¦æœ¬çš„æŸ¥è¯¢äº¤æ˜“ç»“æœå°†ç«‹å³è¿”å›ï¼Œä½†æ˜¯è´¦æœ¬çš„æ›´æ–°å°†æ¶‰åŠåº”ç”¨ç¨‹åºã€peerså’Œorderersä¹‹é—´çš„æ›´å¤æ‚çš„çš„äº¤äº’ã€‚è®©æˆ‘ä»¬å¯¹æ­¤è¿›è¡Œæ›´è¯¦ç»†çš„ç ”ç©¶ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/peers.diagram.6.png" alt="peers.diagram.6"></p><p><em>Peers, in conjunction with orderers, ensure that the ledger is kept up-to-date on every peer. In this example, application A connects to P1 and invokes chaincode S1 to query or update the ledger L1. P1 invokes S1 to generate a proposal response that contains a query result or a proposed ledger update. Application A receives the proposal response and, for queries, the process is now complete. For updates, A builds a transaction from all of the responses, which it sends to O1 for ordering. O1 collects transactions from across the network into blocks, and distributes these to all peers, including P1. P1 validates the transaction before committing to L1. Once L1 is updated, P1 generates an event, received by A, to signify completion.</em></p><p>æŸ¥è¯¢æ—¶æœ‰å›¾ä¸­çš„1ã€2ã€3ä¸‰ä¸ªæ­¥éª¤ã€‚æ›´æ–°æ—¶éœ€è¦é¢å¤–çš„4ã€5ä¸¤ä¸ªæ­¥éª¤çš„æ“ä½œã€‚</p><ul><li>1 åº”ç”¨ç¨‹åºé“¾æ¥åˆ°peer</li><li>2 åº”ç”¨ç¨‹åºï¼ˆå¸¦ç€äº¤æ˜“æè®®ï¼‰è°ƒç”¨é“¾ç </li><li>2.1 peerï¼ˆå¸¦ç€äº¤æ˜“æè®®ï¼‰è°ƒç”¨æ‰˜ç®¡åœ¨peerä¸Šçš„é“¾ç </li><li>2.2 é“¾ç ç”ŸæˆæŸ¥è¯¢æˆ–æ›´æ–°çš„æè®®å“åº”</li><li>3 peeræŠŠæè®®å“åº”è¿”å›ç»™åº”ç”¨ç¨‹åº</li><li>4 åº”ç”¨ç¨‹åºè¯·æ±‚æ’åºèŠ‚ç‚¹å¯¹äº¤æ˜“è¿›è¡Œæ’åº</li><li>4.1 æ’åºèŠ‚ç‚¹æŠŠæ’å¥½åºå¹¶æ‰“åŒ…åœ¨åŒºå—ä¸­äº¤æ˜“å‘é€ç»™peers</li><li>4.2 peerä½¿ç”¨äº¤æ˜“åŒºå—æ›´æ–°æœ¬åœ°çš„è´¦æœ¬</li><li>5 peerå‘å‡ºè´¦æœ¬æ›´æ–°çš„äº‹ä»¶</li></ul><p>A peer can return the results of a query to an application immediately since all of the information required to satisfy the query is in the peerâ€™s local copy of the ledger. Peers never consult with other peers in order to respond to a query from an application. Applications can, however, connect to one or more peers to issue a query; for example, to corroborate a result between multiple peers, or retrieve a more up-to-date result from a different peer if thereâ€™s a suspicion that information might be out of date. In the diagram, you can see that ledger query is a simple three-step process.</p><p>peerå¯ä»¥é©¬ä¸ŠæŠŠæŸ¥è¯¢ç»“æœè¿”å›ç»™åº”ç”¨ç¨‹åºæ˜¯å› ä¸ºæŸ¥è¯¢çš„æ‰€æœ‰ä¿¡æ¯éƒ½å­˜åœ¨äºpeerèŠ‚ç‚¹çš„æœ¬åœ°è´¦æœ¬å‰¯æœ¬ä¸­ã€‚Peersä»ä¸ä¸å…¶ä»–peeråå•†ä»¥å“åº”æ¥è‡ªåº”ç”¨ç¨‹åºçš„æŸ¥è¯¢ã€‚ä½†æ˜¯åº”ç”¨ç¨‹åºå¯ä»¥é“¾æ¥ä¸€ä¸ªæˆ–å¤šä¸ªpeeræ¥å‘å‡ºæŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼Œåœ¨å¤šä¸ªpeerä¹‹é—´ç¡®è®¤ç»“æœï¼Œæˆ–è€…å¦‚æœæ€€ç–‘ä¿¡æ¯å¯èƒ½å·²è¿‡æ—¶ï¼Œåˆ™ä»å¦ä¸€ä¸ªpeeræ£€ç´¢æœ€æ–°ç»“æœã€‚</p><p>An update transaction starts in the same way as a query transaction, but has two extra steps. Although ledger-updating applications also connect to peers to invoke a chaincode, unlike with ledger-querying applications, an individual peer cannot perform a ledger update at this time, because other peers must first agree to the change â€” a process called <strong>consensus</strong>. Therefore, peers return to the application a <strong>proposed</strong> update â€” one that this peer would apply subject to other peersâ€™ prior agreement. The first extra step â€” step four â€” requires that applications send an appropriate set of matching proposed updates to the entire network of peers as a transaction for commitment to their respective ledgers. This is achieved by the application by using an <strong>orderer</strong> to package transactions into blocks, and distributing them to the entire network of peers, where they can be verified before being applied to each peerâ€™s local copy of the ledger. As this whole ordering processing takes some time to complete (seconds), the application is notified asynchronously, as shown in step five.</p><p>Later in this section, youâ€™ll learn more about the detailed nature of this ordering process â€” and for a really detailed look at this process see the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/txflow.html">Transaction Flow</a> topic.</p><h2 id="Peers-and-Channels">Peers and Channels</h2><p>Although this section is about peers rather than channels, itâ€™s worth spending a little time understanding how peers interact with each other, and with applications, via <em>channels</em> â€” a mechanism by which a set of components within a blockchain network can communicate and transact <em>privately</em>.</p><p>å°½ç®¡æœ¬éƒ¨åˆ†ä»‹ç»çš„æ˜¯peerè€Œä¸æ˜¯é€šé“ï¼Œä½†æ˜¯å€¼å¾—èŠ±ä¸€äº›æ—¶é—´æ¥äº†è§£peerå¦‚ä½•é€šè¿‡é€šé“ä¸å…¶ä»–peerä»¥åŠåº”ç”¨ç¨‹åºè¿›è¡Œäº¤äº’ã€‚é€šé“æ˜¯ä¸€ç§æœºåˆ¶ï¼ŒåŒºå—é“¾ç½‘ç»œä¸­çš„ä¸€ç»„ç»„ä»¶å¯ä»¥é€šè¿‡è¯¥æœºåˆ¶è¿›è¡Œç§ä¸‹é€šä¿¡å’Œäº¤æ˜“ã€‚</p><p>These components are typically peer nodes, orderer nodes and applications and, by joining a channel, they agree to collaborate to collectively share and manage identical copies of the ledger associated with that channel. Conceptually, you can think of channels as being similar to groups of friends (though the members of a channel certainly donâ€™t need to be friends!). A person might have several groups of friends, with each group having activities they do together. These groups might be totally separate (a group of work friends as compared to a group of hobby friends), or there can be some crossover between them. Nevertheless, each group is its own entity, with â€œrulesâ€ of a kind.</p><p>è¿™äº›ç»„ä»¶é€šå¸¸æ˜¯peerèŠ‚ç‚¹ï¼ŒordererèŠ‚ç‚¹å’Œåº”ç”¨ç¨‹åºï¼Œé€šè¿‡åŠ å…¥é€šé“ï¼Œå®ƒä»¬åŒæ„åä½œä»¥å…±åŒå…±äº«å’Œç®¡ç†ä¸è¯¥é€šé“å…³è”çš„è´¦æœ¬çš„ç›¸åŒå‰¯æœ¬ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œæ‚¨å¯ä»¥å°†é€šé“è§†ä¸ºä¸æœ‹å‹ç»„ç›¸ä¼¼ã€‚ä¸€ä¸ªäººå¯èƒ½æœ‰å¤šç»„æœ‹å‹ï¼Œæ¯ç»„éƒ½æœ‰ä»–ä»¬ä¸€èµ·åšçš„æ´»åŠ¨ã€‚è¿™äº›ç»„å¯èƒ½å®Œå…¨åˆ†å¼€ï¼Œå®ƒä»¬ä¹‹é—´ä¹Ÿå¯èƒ½ä¼šæœ‰äº¤å‰ã€‚ä½†æ˜¯ï¼Œæ¯ä¸ªç»„éƒ½æ˜¯å…¶è‡ªå·±çš„å®ä½“ï¼Œå…·æœ‰æŸç§â€œè§„åˆ™â€ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/peers.diagram.5.png" alt="peers.diagram.5"></p><p><em>Channels allow a specific set of peers and applications to communicate with each other within a blockchain network. In this example, application A can communicate directly with peers P1 and P2 using channel C. You can think of the channel as a pathway for communications between particular applications and peers. (For simplicity, orderers are not shown in this diagram, but must be present in a functioning network.)</em></p><p><em>åœ¨åŒºå—é“¾ç½‘ç»œä¸­é€šé“å…è®¸æŒ‡å®šçš„ä¸€ç»„peerå’Œåº”ç”¨ç¨‹åºè¿›è¡Œé€šä¿¡ã€‚</em></p><p>We see that channels donâ€™t exist in the same way that peers do â€” itâ€™s more appropriate to think of a channel as a logical structure that is formed by a collection of physical peers. <em>It is vital to understand this point â€” peers provide the control point for access to, and management of, channels</em>.</p><p>é€šé“æ˜¯ä¸€ç»„ç‰©ç†peerçš„é€»è¾‘ç»“æ„ï¼Œpeeræä¾›äº†å¯¹é€šé“çš„è®¿é—®ä¸ç®¡ç†æƒé™ã€‚</p><h2 id="Peers-and-Organizations">Peers and Organizations</h2><p>Now that you understand peers and their relationship to ledgers, chaincodes and channels, youâ€™ll be able to see how multiple organizations come together to form a blockchain network.</p><p>Blockchain networks are administered by a collection of organizations rather than a single organization. Peers are central to how this kind of distributed network is built because they are owned by â€” and are the connection points to the network for â€” these organizations.</p><p>åŒºå—é“¾ç½‘ç»œç”±å¤šä¸ªç»„ç»‡ç®¡ç†ï¼Œè€Œä¸æ˜¯å•ä¸ªç»„ç»‡ç®¡ç†ã€‚peerså¯¹äºè¿™ç§åˆ†å¸ƒå¼ç½‘ç»œçš„æ„å»ºè‡³å…³é‡è¦å› ä¸ºä»–ä»¬å±äºä»–ä»¬çš„ç»„ç»‡ï¼Œå¹¶ä¸”ä»–ä»¬æ˜¯ä»–ä»¬ç»„ç»‡çš„ç½‘ç»œè¿æ¥ç‚¹ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/peers.diagram.8.png" alt="peers.diagram.8"></p><p><em>Peers in a blockchain network with multiple organizations. The blockchain network is built up from the peers owned and contributed by the different organizations. In this example, we see four organizations contributing eight peers to form a network. The channel C connects five of these peers in the network N â€” P1, P3, P5, P7 and P8. The other peers owned by these organizations have not been joined to this channel, but are typically joined to at least one other channel. Applications that have been developed by a particular organization will connect to their own organizationâ€™s peers as well as those of different organizations. Again, for simplicity, an orderer node is not shown in this diagram.</em></p><p>Itâ€™s really important that you can see whatâ€™s happening in the formation of a blockchain network. <em>The network is both formed and managed by the multiple organizations who contribute resources to it.</em> Peers are the resources that weâ€™re discussing in this topic, but the resources an organization provides are more than just peers. Thereâ€™s a principle at work here â€” the network literally does not exist without organizations contributing their individual resources to the collective network. Moreover, the network grows and shrinks with the resources that are provided by these collaborating organizations.</p><p>åŒºå—é“¾ç”±å‘å…¶è´¡çŒ®èµ„æºçš„å¤šä¸ªç»„ç»‡ç»„æˆå’Œç®¡ç†ã€‚</p><p>You can see that (other than the ordering service) there are no centralized resources â€” in the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/peers/peers.html#Peer8">example above</a>, the network, <strong>N</strong>, would not exist if the organizations did not contribute their peers. This reflects the fact that the network does not exist in any meaningful sense unless and until organizations contribute the resources that form it. Moreover, the network does not depend on any individual organization â€” it will continue to exist as long as one organization remains, no matter which other organizations may come and go. This is at the heart of what it means for a network to be decentralized.</p><p>Applications in different organizations, as in the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/peers/peers.html#Peer8">example above</a>, may or may not be the same. Thatâ€™s because itâ€™s entirely up to an organization as to how its applications process their peersâ€™ copies of the ledger. This means that both application and presentation logic may vary from organization to organization even though their respective peers host exactly the same ledger data.</p><p>å¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œä¸åŒç»„ç»‡ä¸­çš„åº”ç”¨ç¨‹åºå¯èƒ½ç›¸åŒï¼Œä¹Ÿå¯èƒ½ä¸åŒã€‚</p><p>Applications connect either to peers in their organization, or peers in another organization, depending on the nature of the ledger interaction thatâ€™s required. For ledger-query interactions, applications typically connect to their own organizationâ€™s peers. For ledger-update interactions, weâ€™ll see later why applications need to connect to peers representing <em>every</em> organization that is required to endorse the ledger update.</p><p>åº”ç”¨ç¨‹åºå¯ä»¥è¿æ¥åˆ°è‡ªå·±ç»„ç»‡çš„peerèŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥è¿æ¥åˆ°å…¶ä»–ç»„ç»‡çš„peerèŠ‚ç‚¹ï¼Œå…·ä½“å–å†³äºæ‰€éœ€çš„è´¦æœ¬äº¤äº’çš„æ€§è´¨ã€‚å¯¹äºè´¦æœ¬æŸ¥è¯¢äº¤äº’ï¼Œåº”ç”¨ç¨‹åºé€šå¸¸ä¼šè¿æ¥åˆ°è‡ªå·±ç»„ç»‡çš„peerèŠ‚ç‚¹ã€‚å¯¹äºè´¦æœ¬æ›´æ–°äº¤äº’ï¼Œæˆ‘ä»¬å°†åœ¨åé¢çœ‹åˆ°ä¸ºä»€ä¹ˆåº”ç”¨ç¨‹åºéœ€è¦è¿æ¥åˆ°ä»£è¡¨è®¤å¯è´¦æœ¬æ›´æ–°æ‰€éœ€çš„æ¯ä¸ªç»„ç»‡çš„peerã€‚</p><h2 id="Peers-and-Identity">Peers and Identity</h2><p>Now that youâ€™ve seen how peers from different organizations come together to form a blockchain network, itâ€™s worth spending a few moments understanding how peers get assigned to organizations by their administrators.</p><p>Peers have an identity assigned to them via a digital certificate from a particular certificate authority. You can read lots more about how X.509 digital certificates work elsewhere in this guide but, for now, think of a digital certificate as being like an ID card that provides lots of verifiable information about a peer. <em>Each and every peer in the network is assigned a digital certificate by an administrator from its owning organization</em>.</p><p>Peerså…·æœ‰é€šè¿‡ç‰¹å®šè¯ä¹¦é¢å‘æœºæ„é€šè¿‡æ•°å­—è¯ä¹¦åˆ†é…ç»™ä»–ä»¬çš„èº«ä»½ã€‚***ã€‚ç½‘ç»œä¸­çš„æ¯ä¸ªpeerèŠ‚ç‚¹éƒ½ç”±å…¶æ‰€å±ç»„ç»‡çš„ç®¡ç†å‘˜åˆ†é…çš„æ•°å­—è¯ä¹¦ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/peers.diagram.9.png" alt="peers.diagram.9"></p><p><em>When a peer connects to a channel, its digital certificate identifies its owning organization via a channel MSP. In this example, P1 and P2 have identities issued by CA1. Channel C determines from a policy in its channel configuration that identities from CA1 should be associated with Org1 using ORG1.MSP. Similarly, P3 and P4 are identified by ORG2.MSP as being part of Org2.</em></p><p><em>å½“peerè¿æ¥åˆ°é€šé“æ—¶ï¼Œå…¶æ•°å­—è¯ä¹¦é€šè¿‡é€šé“MSPæ ‡è¯†å…¶å½’å±çš„ç»„ç»‡ã€‚</em></p><p>Whenever a peer connects using a channel to a blockchain network, <em>a policy in the channel configuration uses the peerâ€™s identity to determine its rights.</em> The mapping of identity to organization is provided by a component called a <em>Membership Service Provider</em> (MSP) â€” it determines how a peer gets assigned to a specific role in a particular organization and accordingly gains appropriate access to blockchain resources. Moreover, a peer can be owned only by a single organization, and is therefore associated with a single MSP. Weâ€™ll learn more about peer access control later in this section, and thereâ€™s an entire section on MSPs and access control policies elsewhere in this guide. But for now, think of an MSP as providing linkage between an individual identity and a particular organizational role in a blockchain network.</p><p>æ¯å½“peerä½¿ç”¨é€šé“è¿æ¥åˆ°åŒºå—é“¾ç½‘ç»œæ—¶ï¼Œé€šé“é…ç½®ä¸­çš„ç­–ç•¥éƒ½ä¼šä½¿ç”¨peerçš„èº«ä»½æ¥ç¡®å®šå…¶æƒåˆ©ã€‚***</p><p>To digress for a moment, peers as well as <em>everything that interacts with a blockchain network acquire their organizational identity from their digital certificate and an MSP</em>. Peers, applications, end users, administrators and orderers must have an identity and an associated MSP if they want to interact with a blockchain network. <em>We give a name to every entity that interacts with a blockchain network using an identity â€” a principal.</em> You can learn lots more about principals and organizations elsewhere in this guide, but for now you know more than enough to continue your understanding of peers!</p><p>Peersä»¥åŠä¸åŒºå—é“¾ç½‘ç»œäº¤äº’çš„æ‰€æœ‰äº‹ç‰©å‡ä»å…¶æ•°å­—è¯ä¹¦å’ŒMSPè·å–å…¶ç»„ç»‡èº«ä»½ã€‚***</p><p>Finally, note that itâ€™s not really important where the peer is physically located â€” it could reside in the cloud, or in a data centre owned by one of the organizations, or on a local machine â€” itâ€™s the digital certificate associated with it that identifies it as being owned by a particular organization. In our example above, P3 could be hosted in Org1â€™s data center, but as long as the digital certificate associated with it is issued by CA2, then itâ€™s owned by Org2.</p><p>æœ€åï¼Œæ³¨æ„peerçš„ç‰©ç†ä½ç½®ä¸æ˜¯å¾ˆé‡è¦ï¼Œå®ƒå¯ä»¥éƒ¨ç½²åœ¨äº‘ä¸Šï¼Œä¹Ÿå¯ä»¥éƒ¨ç½²åœ¨æœ¬åœ°ç‰©ç†æœºä¸Šï¼›ä¸ç®¡å®ƒåœ¨å“ªé‡Œï¼Œä¹‹ç›¸å…³è”çš„æ•°å­—è¯ä¹¦å°†å…¶æ ‡è¯†ä¸ºç‰¹å®šç»„ç»‡æ‰€æ‹¥æœ‰ã€‚***</p><h2 id="Peers-and-Orderers">Peers and Orderers</h2><p>Weâ€™ve seen that peers form the basis for a blockchain network, hosting ledgers and smart contracts which can be queried and updated by peer-connected applications. However, the mechanism by which applications and peers interact with each other to ensure that every peerâ€™s ledger is kept consistent with each other is mediated by special nodes called <em>orderers</em>, and itâ€™s to these nodes we now turn our attention.</p><p>An update transaction is quite different from a query transaction because a single peer cannot, on its own, update the ledger â€” updating requires the consent of other peers in the network. A peer requires other peers in the network to approve a ledger update before it can be applied to a peerâ€™s local ledger. This process is called <em>consensus</em>, which takes much longer to complete than a simple query. But when all the peers required to approve the transaction do so, and the transaction is committed to the ledger, peers will notify their connected applications that the ledger has been updated. Youâ€™re about to be shown a lot more detail about how peers and orderers manage the consensus process in this section.</p><p>æ›´æ–°äº¤æ˜“ä¸æŸ¥è¯¢äº¤æ˜“æ˜¯æœ‰å¾ˆå¤§åŒºåˆ«çš„ï¼Œå› ä¸ºå•ç‹¬çš„peerä¸å¯ä»¥è‡ªå·±å®Œæˆæ›´æ–°è´¦æœ¬çš„å·¥ä½œã€‚æ›´æ–°è´¦æœ¬çš„æ“ä½œéœ€è¦ç½‘ç»œä¸­å…¶ä»–peerçš„åŒæ„ã€‚peeréœ€è¦ç½‘ç»œä¸­çš„å…¶ä»–peeræ‰¹å‡†è´¦æœ¬æ›´æ–°ï¼Œç„¶åæ‰èƒ½å°†å…¶åº”ç”¨äºpeerä¸Šçš„æœ¬åœ°è´¦æœ¬ã€‚æ­¤è¿‡ç¨‹ç§°ä¸ºå…±è¯†ï¼Œä¸ç®€å•çš„æŸ¥è¯¢ç›¸æ¯”ï¼Œæ­¤è¿‡ç¨‹éœ€è¦æ›´é•¿çš„æ—¶é—´æ‰èƒ½å®Œæˆã€‚ä½†æ˜¯ï¼Œå½“æ‰€æœ‰éœ€è¦æ‰¹å‡†äº¤æ˜“çš„peerèŠ‚ç‚¹éƒ½æ‰¹å‡†äº†è¯¥äº¤æ˜“å¹¶å°†äº¤æ˜“æäº¤åˆ°è´¦æœ¬æ—¶ï¼Œpeerå°†é€šçŸ¥å…¶è¿æ¥çš„åº”ç”¨ç¨‹åºè´¦æœ¬å·²æ›´æ–°ã€‚åœ¨æœ¬éƒ¨åˆ†ä¸­ï¼Œæ‚¨å°†è·å¾—æœ‰å…³peerså’Œpeerså¦‚ä½•ç®¡ç†å…±è¯†è¿‡ç¨‹çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p><p>Specifically, applications that want to update the ledger are involved in a 3-phase process, which ensures that all the peers in a blockchain network keep their ledgers consistent with each other.</p><p>å…·ä½“æ¥è¯´ï¼Œæƒ³è¦æ›´æ–°è´¦æœ¬çš„åº”ç”¨ç¨‹åºéœ€è¦3ä¸ªé˜¶æ®µçš„è¿‡ç¨‹ï¼Œè¿™ç¡®ä¿äº†åŒºå—é“¾ç½‘ç»œä¸­çš„æ‰€æœ‰peerä¿æŒè´¦æœ¬å½¼æ­¤ä¸€è‡´ã€‚</p><ul><li><p>In the first phase, applications work with a subset of <em>endorsing peers</em>, each of which provide an endorsement of the proposed ledger update to the application, but do not apply the proposed update to their copy of the ledger.</p><p>åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œåº”ç”¨ç¨‹åºä¸ä¸€äº›èƒŒä¹¦peerèŠ‚ç‚¹ä¸€èµ·å·¥ä½œï¼Œæ¯ä¸ªèƒŒä¹¦peerèŠ‚ç‚¹éƒ½å‘åº”ç”¨ç¨‹åºæä¾›å¯¹æè®®çš„è´¦æœ¬æ›´æ–°çš„èƒŒä¹¦ï¼Œä½†ä¸å°†æè®®çš„æ›´æ–°åº”ç”¨äºå…¶è´¦æœ¬çš„å‰¯æœ¬ã€‚</p></li><li><p>In the second phase, these separate endorsements are collected together as transactions and packaged into blocks.</p><p>åœ¨ç¬¬äºŒé˜¶æ®µï¼Œè¿™äº›å•ç‹¬çš„èƒŒä¹¦å°†ä½œä¸ºäº¤æ˜“æ”¶é›†åœ¨ä¸€èµ·ï¼Œå¹¶æ‰“åŒ…æˆå—ã€‚</p></li><li><p>In the third and final phase, these blocks are distributed back to every peer where each transaction is validated before being committed to that peerâ€™s copy of the ledger.</p><p>åœ¨ç¬¬ä¸‰é˜¶æ®µï¼ˆä¹Ÿæ˜¯æœ€åé˜¶æ®µï¼‰ï¼Œè¿™äº›åŒºå—ä¼šé‡æ–°åˆ†é…ç»™æ¯ä¸ªpeerèŠ‚ç‚¹ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæ¯ä¸ªäº¤æ˜“å‡ç»è¿‡éªŒè¯ï¼Œç„¶åå†æäº¤ç»™è¯¥peerçš„è´¦æœ¬å‰¯æœ¬ã€‚</p></li></ul><p>As you will see, orderer nodes are central to this process, so letâ€™s investigate in a little more detail how applications and peers use orderers to generate ledger updates that can be consistently applied to a distributed, replicated ledger.</p><p>å¦‚æ‚¨æ‰€è§ï¼Œæ’åºè€…èŠ‚ç‚¹æ˜¯æ­¤è¿‡ç¨‹çš„æ ¸å¿ƒï¼Œå› æ­¤ï¼Œè®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°ç ”ç©¶ä¸€ä¸‹åº”ç”¨ç¨‹åºå’Œpeerå¦‚ä½•ä½¿ç”¨æ’åºæœåŠ¡æ¥ç”Ÿæˆè´¦æœ¬æ›´æ–°ï¼Œè¯¥æ›´æ–°å¯å§‹ç»ˆåº”ç”¨äºåˆ†å¸ƒå¼å¤åˆ¶åˆ†ç±»å¸ã€‚</p><h3 id="Phase-1-Proposal">Phase 1: Proposal</h3><p>Phase 1 of the transaction workflow involves an interaction between an application and a set of peers â€” it does not involve orderers. Phase 1 is only concerned with an application asking different organizationsâ€™ endorsing peers to agree to the results of the proposed chaincode invocation.</p><p>äº¤æ˜“æµç¨‹çš„ç¬¬ä¸€é˜¶æ®µæ¶‰åŠåº”ç”¨ç¨‹åºä¸ä¸€ç»„peerä¹‹é—´çš„äº¤äº’-å®ƒä¸æ¶‰åŠæ’åºè€…ã€‚ç¬¬ä¸€é˜¶æ®µåªå…³å¿ƒåº”ç”¨ç¨‹åºè¦æ±‚ä¸åŒç»„ç»‡çš„èƒŒä¹¦èŠ‚ç‚¹åŒæ„æè®®çš„é“¾ç è°ƒç”¨çš„ç»“æœã€‚</p><p>To start phase 1, applications generate a transaction proposal which they send to each of the required set of peers for endorsement. Each of these <em>endorsing peers</em> then independently executes a chaincode using the transaction proposal to generate a transaction proposal response. It does not apply this update to the ledger, but rather simply signs it and returns it to the application. Once the application has received a sufficient number of signed proposal responses, the first phase of the transaction flow is complete. Letâ€™s examine this phase in a little more detail.</p><p>ä¸ºäº†å¼€å§‹ç¬¬ä¸€é˜¶æ®µï¼Œåº”ç”¨ç¨‹åºç”Ÿæˆä¸€ä¸ªäº¤æ˜“æè®®ï¼Œç„¶åå‘é€è¿™ä¸ªäº¤æ˜“æè®®åˆ°æ¯ä¸ªéœ€è¦èƒŒä¹¦çš„peeråˆ—è¡¨ã€‚ç„¶åæ¯ä¸ªèƒŒä¹¦èŠ‚ç‚¹ä½¿ç”¨äº¤æ˜“æè®®æ‰§è¡Œé“¾ç æ¥ç”Ÿæˆäº¤æ˜“æè®®å“åº”ã€‚å®ƒä¸ä¼šå°†æ­¤æ›´æ–°åº”ç”¨äºè´¦æœ¬ï¼Œè€Œåªæ˜¯å¯¹å…¶è¿›è¡Œç­¾åå¹¶å°†å…¶è¿”å›ç»™åº”ç”¨ç¨‹åºã€‚ä¸€æ—¦åº”ç”¨ç¨‹åºæ”¶åˆ°è¶³å¤Ÿæ•°é‡çš„å·²ç­¾åææ¡ˆå“åº”åï¼Œäº¤æ˜“æµç¨‹çš„ç¬¬ä¸€é˜¶æ®µå°±å®Œæˆäº†ã€‚è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°ç ”ç©¶è¿™ä¸ªé˜¶æ®µã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/peers.diagram.10.png" alt="peers.diagram.10"></p><p><em>Transaction proposals are independently executed by peers who return endorsed proposal responses. In this example, application A1 generates transaction T1 proposal P which it sends to both peer P1 and peer P2 on channel C. P1 executes S1 using transaction T1 proposal P generating transaction T1 response R1 which it endorses with E1. Independently, P2 executes S1 using transaction T1 proposal P generating transaction T1 response R2 which it endorses with E2. Application A1 receives two endorsed responses for transaction T1, namely E1 and E2.</em></p><p><em>äº¤æ˜“æè®®è¢«æ¯ä¸ªpeerèŠ‚ç‚¹ç‹¬ç«‹çš„æ‰§è¡Œç„¶åè¿”å›èƒŒä¹¦æè®®å“åº”ã€‚</em></p><p>Initially, a set of peers are chosen by the application to generate a set of proposed ledger updates. Which peers are chosen by the application? Well, that depends on the <em>endorsement policy</em> (defined for a chaincode), which defines the set of organizations that need to endorse a proposed ledger change before it can be accepted by the network. This is literally what it means to achieve consensus â€” every organization who matters must have endorsed the proposed ledger change <em>before</em> it will be accepted onto any peerâ€™s ledger.</p><p>æœ€åˆåº”ç”¨ç¨‹åºé€‰æ‹©ä¸€ç»„peerèŠ‚ç‚¹æ¥ç”Ÿæˆä¸€ç»„æè®®çš„è´¦æœ¬æ›´æ–°ã€‚åº”ç”¨ç¨‹åºä¼šé€‰æ‹©å“ªäº›peerèŠ‚ç‚¹å‘¢ï¼Ÿè¿™å–å†³äºï¼ˆä¸ºé“¾ç å®šä¹‰çš„ï¼‰èƒŒä¹¦ç­–ç•¥ï¼Œè¯¥ç­–ç•¥å®šä¹‰äº†ä¸€ä¸ªéœ€è¦åœ¨ç½‘ç»œæ¥å—ä¹‹å‰æ‰¹å‡†æè®®çš„è´¦æœ¬æ›´æ–°çš„ç»„ç»‡åˆ—è¡¨ã€‚ä»å­—é¢ä¸Šçœ‹ï¼Œè¿™æ˜¯è¾¾æˆå…±è¯†çš„æ„æ€ â€“ æ¯ä¸ªé‡è¦çš„ç»„ç»‡éƒ½å¿…é¡»å·²ç»æ‰¹å‡†æè®®çš„è´¦æœ¬æ›´æ–°ï¼Œç„¶åè¯¥æ›´æ”¹æ‰ä¼šè¢«æ¥å—åˆ°å…¶ä»–peerçš„è´¦æœ¬ä¸­ã€‚</p><p>A peer endorses a proposal response by adding its digital signature, and signing the entire payload using its private key. This endorsement can be subsequently used to prove that this organizationâ€™s peer generated a particular response. In our example, if peer P1 is owned by organization Org1, endorsement E1 corresponds to a digital proof that â€œTransaction T1 response R1 on ledger L1 has been provided by Org1â€™s peer P1!â€.</p><p>peerèŠ‚ç‚¹é€šè¿‡æ·»åŠ æ•°å­—ç­¾åæ¥è®¤å¯æè®®å“åº”ï¼Œå¹¶ä¸”ä½¿ç”¨å®ƒçš„ç§é’¥å¯¹æ•´ä¸ªè´Ÿè½½çš„æ•°æ®è¿›è¡Œç­¾åã€‚è¿™ä¸ªèƒŒä¹¦éšåå¯ä»¥è¢«ç”¨äºè¯æ˜è¿™ä¸ªç»„ç»‡çš„peerç”Ÿæˆäº†å“åº”ã€‚***</p><p>Phase 1 ends when the application receives signed proposal responses from sufficient peers. We note that different peers can return different and therefore inconsistent transaction responses to the application <em>for the same transaction proposal</em>. It might simply be that the result was generated at different times on different peers with ledgers at different states, in which case an application can simply request a more up-to-date proposal response. Less likely, but much more seriously, results might be different because the chaincode is <em>non-deterministic</em>. Non-determinism is the enemy of chaincodes and ledgers and if it occurs it indicates a serious problem with the proposed transaction, as inconsistent results cannot, obviously, be applied to ledgers. An individual peer cannot know that their transaction result is non-deterministic â€” transaction responses must be gathered together for comparison before non-determinism can be detected. (Strictly speaking, even this is not enough, but we defer this discussion to the transaction section, where non-determinism is discussed in detail.)</p><p>å½“åº”ç”¨ç¨‹åºæ”¶åˆ°è¶³å¤Ÿçš„peerç­¾ç½²çš„æè®®å“åº”æ—¶ï¼Œé˜¶æ®µä¸€å°±ç»“æŸäº†ã€‚å¯¹äºåŒä¸€äº¤æ˜“æè®®ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¯èƒ½æ”¶åˆ°ä¸ä¸€è‡´çš„äº¤æ˜“å“åº”ã€‚è¿™å¯èƒ½åªæ˜¯ç®€å•çš„å› ä¸ºç»“æœæ˜¯åœ¨ä¸åŒçš„æ—¶é—´ã€ä¸åŒçš„peerèŠ‚ç‚¹ä½¿ç”¨ä¸åŒçš„è´¦æœ¬çŠ¶æ€ä¸‹ç”Ÿæˆçš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ç®€å•åœ°è¯·æ±‚æœ€æ–°çš„æè®®å“åº”ã€‚å¯èƒ½æ€§è¾ƒå°ä½†æ˜¯æ›´ä¸¥é‡çš„æ˜¯ï¼Œç»“æœå¯èƒ½ä¼šå› ä¸ºé“¾ç æ˜¯ä¸ç¡®å®šçš„è€Œæœ‰æ‰€ä¸åŒã€‚éç¡®å®šæ€§æ˜¯é“¾ç å’Œè´¦æœ¬çš„æ•Œäººï¼Œå¦‚æœå‘ç”Ÿï¼Œåˆ™è¡¨æ˜æè®®äº¤æ˜“å­˜åœ¨ä¸¥é‡é—®é¢˜ï¼Œå› ä¸ºä¸ä¸€è‡´çš„ç»“æœæ˜¾ç„¶ä¸èƒ½åº”ç”¨äºè´¦æœ¬ã€‚å•ä¸ªpeeræ— æ³•çŸ¥é“å…¶äº¤æ˜“ç»“æœæ˜¯ä¸ç¡®å®šçš„ â€“ å¿…é¡»å…ˆæ”¶é›†äº¤æ˜“å“åº”ä»¥è¿›è¡Œæ¯”è¾ƒï¼Œç„¶åæ‰èƒ½æ£€æµ‹åˆ°ä¸ç¡®å®šæ€§ã€‚ï¼ˆä¸¥æ ¼è¯´æ¥ï¼Œè¿™è¿˜ä¸å¤Ÿï¼Œä½†æ˜¯æˆ‘ä»¬å°†è®¨è®ºæ¨è¿Ÿåˆ°äº¤æ˜“éƒ¨åˆ†ï¼Œåœ¨æ­¤éƒ¨åˆ†å°†è¯¦ç»†è®¨è®ºä¸ç¡®å®šæ€§ã€‚ï¼‰</p><p>At the end of phase 1, the application is free to discard inconsistent transaction responses if it wishes to do so, effectively terminating the transaction workflow early. Weâ€™ll see later that if an application tries to use an inconsistent set of transaction responses to update the ledger, it will be rejected.</p><p>åœ¨é˜¶æ®µä¸€ç»“æŸæ—¶ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥éšæ„ä¸¢å¼ƒä¸ä¸€è‡´çš„äº¤æ˜“å“åº”ï¼Œä»è€Œæœ‰æ•ˆåœ°å°½æ—©ç»ˆæ­¢äº¤æ˜“æµç¨‹ã€‚ç¨åæˆ‘ä»¬å°†çœ‹åˆ°ï¼Œå¦‚æœåº”ç”¨ç¨‹åºå°è¯•ä½¿ç”¨ä¸€ç»„ä¸ä¸€è‡´çš„äº¤æ˜“å“åº”æ¥æ›´æ–°è´¦æœ¬ï¼Œå®ƒå°†è¢«æ‹’ç»ã€‚</p><h3 id="Phase-2-Ordering-and-packaging-transactions-into-blocks">Phase 2: Ordering and packaging transactions into blocks</h3><p>The second phase of the transaction workflow is the packaging phase. The orderer is pivotal to this process â€” it receives transactions containing endorsed transaction proposal responses from many applications, and orders the transactions into blocks. For more details about the ordering and packaging phase, check out our <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/orderer/ordering_service.html#phase-two-ordering-and-packaging-transactions-into-blocks">conceptual information about the ordering phase</a>.</p><p>äº¤æ˜“æµç¨‹çš„ç¬¬äºŒä¸ªé˜¶æ®µæ˜¯æ‰“åŒ…é˜¶æ®µã€‚æ’åºè€…å¯¹äºæ­¤è¿‡ç¨‹è‡³å…³é‡è¦-å®ƒä»è®¸å¤šåº”ç”¨ç¨‹åºæ¥æ”¶åŒ…å«èƒŒä¹¦çš„äº¤æ˜“æè®®å“åº”çš„äº¤æ˜“ï¼Œå¹¶å°†äº¤æ˜“æ’åºæ‰“åŒ…æˆåŒºå—ã€‚***</p><h3 id="Phase-3-Validation-and-commit">Phase 3: Validation and commit</h3><p>At the end of phase 2, we see that orderers have been responsible for the simple but vital processes of collecting proposed transaction updates, ordering them, and packaging them into blocks, ready for distribution to the peers.</p><p>The final phase of the transaction workflow involves the distribution and subsequent validation of blocks from the orderer to the peers, where they can be committed to the ledger. Specifically, at each peer, every transaction within a block is validated to ensure that it has been consistently endorsed by all relevant organizations before it is committed to the ledger. Failed transactions are retained for audit, but are not committed to the ledger.</p><p>äº¤æ˜“æµç¨‹çš„æœ€åé˜¶æ®µæ¶‰åŠä»æ’åºè€…åˆ°peerèŠ‚ç‚¹çš„åŒºå—åˆ†é…å’Œåç»­éªŒè¯ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µå¯ä»¥å°†å®ƒä»¬æäº¤åˆ°è´¦æœ¬ã€‚å…·ä½“æ¥è¯´ï¼Œæ¯ä¸ªpeerèŠ‚ç‚¹å¯¹åŒºå—ä¸­çš„æ¯ä¸ªäº¤æ˜“éƒ½è¿›è¡ŒéªŒè¯ï¼Œä»¥ç¡®ä¿åœ¨å°†å…¶æäº¤åˆ°è´¦æœ¬ä¹‹å‰æ‰€æœ‰ç›¸å…³ç»„ç»‡éƒ½ä¸€è‡´è®¤å¯è¯¥äº¤æ˜“ã€‚å¤±è´¥çš„äº¤æ˜“å°†ä¿ç•™ä»¥è¿›è¡Œå®¡æ ¸ï¼Œä½†ä¸ä¼šæäº¤åˆ°åˆ†ç±»è´¦ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/peers.diagram.12.png" alt="peers.diagram.12"></p><p><em>The second role of an orderer node is to distribute blocks to peers. In this example, orderer O1 distributes block B2 to peer P1 and peer P2. Peer P1 processes block B2, resulting in a new block being added to ledger L1 on P1. In parallel, peer P2 processes block B2, resulting in a new block being added to ledger L1 on P2. Once this process is complete, the ledger L1 has been consistently updated on peers P1 and P2, and each may inform connected applications that the transaction has been processed.</em></p><p><em>æ’åºè€…èŠ‚ç‚¹çš„ç¬¬äºŒä¸ªæŒ‡è´£æ˜¯å°†åŒºå—åˆ†å‘åˆ°peerèŠ‚ç‚¹ã€‚</em></p><p>Phase 3 begins with the orderer distributing blocks to all peers connected to it. Peers are connected to orderers on channels such that when a new block is generated, all of the peers connected to the orderer will be sent a copy of the new block. Each peer will process this block independently, but in exactly the same way as every other peer on the channel. In this way, weâ€™ll see that the ledger can be kept consistent. Itâ€™s also worth noting that not every peer needs to be connected to an orderer â€” peers can cascade blocks to other peers using the <strong>gossip</strong> protocol, who also can process them independently. But letâ€™s leave that discussion to another time!</p><p>ç¬¬ä¸‰é˜¶æ®µå¼€å§‹äºæ’åºè€…åˆ†å‘åŒºå—åˆ°é“¾æ¥å®ƒçš„æ‰€æœ‰peerèŠ‚ç‚¹ä¸Šã€‚peerèŠ‚ç‚¹é“¾æ¥åˆ°é€šé“ä¸Šçš„æ’åºèŠ‚ç‚¹ï¼Œè¿™æ ·å½“ä¸€ä¸ªæ–°çš„åŒºå—ç”Ÿæˆæ˜¯ï¼Œæ‰€æœ‰çš„é“¾æ¥åˆ°æ’åºèŠ‚ç‚¹çš„peeréƒ½ä¼šæ”¶åˆ°ä¸€ä¸ªæ–°åŒºå—çš„å‰¯æœ¬ã€‚æ¯ä¸ªpeeréƒ½ä½¿ç”¨ä¸é€šé“ä¸Šçš„å…¶ä»–èŠ‚ç‚¹ä¸€æ ·çš„æ–¹å¼æ¥ç‹¬ç«‹å¤„ç†è¿™ä¸ªåŒºå—ã€‚é€šè¿‡è¿™ç§æ–¹å¼è´¦æœ¬å°±å¯ä»¥ä¿æŒä¸€è‡´äº†ã€‚è¿˜å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¹¶éæ¯ä¸ªpeerèŠ‚ç‚¹éƒ½éœ€è¦è¿æ¥åˆ°æ’åºè€… â€“ peerèŠ‚ç‚¹å¯ä»¥ä½¿ç”¨å…«å¦åè®®å°†å—çº§è”åˆ°å…¶ä»–peerï¼Œè¿™äº›peerä¹Ÿå¯ä»¥ç‹¬ç«‹å¤„ç†åŒºå—ã€‚</p><p>Upon receipt of a block, a peer will process each transaction in the sequence in which it appears in the block. For every transaction, each peer will verify that the transaction has been endorsed by the required organizations according to the <em>endorsement policy</em> of the chaincode which generated the transaction. For example, some transactions may only need to be endorsed by a single organization, whereas others may require multiple endorsements before they are considered valid. This process of validation verifies that all relevant organizations have generated the same outcome or result. Also note that this validation is different than the endorsement check in phase 1, where it is the application that receives the response from endorsing peers and makes the decision to send the proposal transactions. In case the application violates the endorsement policy by sending wrong transactions, the peer is still able to reject the transaction in the validation process of phase 3.</p><p>æ”¶åˆ°åŒºå—ä¹‹ååï¼ŒpeerèŠ‚ç‚¹å°†æŒ‰ç…§åŒºå—å—ä¸­çš„é¡ºåºå¤„ç†æ¯ä¸ªäº¤æ˜“ã€‚å¯¹äºæ¯ç¬”äº¤æ˜“ï¼Œæ¯ä¸ªpeerèŠ‚ç‚¹éƒ½å°†æ ¹æ®äº§ç”Ÿäº¤æ˜“çš„é“¾ç çš„èƒŒä¹¦æ”¿ç­–æ¥éªŒè¯è¯¥äº¤æ˜“æ˜¯å¦å·²è¢«æ‰€éœ€çš„ç»„ç»‡èƒŒä¹¦ã€‚ä¾‹å¦‚ï¼ŒæŸäº›äº¤æ˜“å¯èƒ½åªéœ€è¦ç”±å•ä¸ªç»„ç»‡èƒŒä¹¦ï¼Œè€Œå…¶ä»–äº¤æ˜“å¯èƒ½éœ€è¦å¤šä¸ªèƒŒä¹¦æ‰èƒ½è¢«è§†ä¸ºæœ‰æ•ˆã€‚è¿™ä¸ªéªŒè¯è¿‡ç¨‹éªŒè¯æ‰€æœ‰ç›¸å…³çš„ç»„ç»‡éƒ½ç”Ÿæˆç›¸åŒçš„äº§ç‰©æˆ–ç»“æœã€‚å¦è¯·æ³¨æ„ï¼Œæ­¤éªŒè¯ä¸ç¬¬ä¸€é˜¶æ®µä¸­çš„èƒŒä¹¦æ£€æŸ¥ä¸åŒï¼Œç¬¬ä¸€é˜¶æ®µçš„èƒŒä¹¦æ£€æŸ¥æ˜¯åº”ç”¨ç¨‹åºåœ¨æ¥æ”¶åˆ°æ¥è‡ªèƒŒä¹¦èŠ‚ç‚¹çš„å“åº”å¹¶åšå‡ºå‘é€æè®®äº¤æ˜“çš„å†³å®šã€‚å¦‚æœåº”ç”¨ç¨‹åºå‘é€äº†é”™è¯¯çš„äº¤æ˜“è¿åäº†èƒŒä¹¦ç­–ç•¥ï¼Œåœ¨ç¬¬ä¸‰é˜¶æ®µçš„éªŒè¯ç¨‹åºä¸­peerèŠ‚ç‚¹ä»ç„¶æœ‰èƒ½åŠ›æ‹’ç»æ­¤äº¤æ˜“ã€‚</p><p>If a transaction has been endorsed correctly, the peer will attempt to apply it to the ledger. To do this, a peer must perform a ledger consistency check to verify that the current state of the ledger is compatible with the state of the ledger when the proposed update was generated. This may not always be possible, even when the transaction has been fully endorsed. For example, another transaction may have updated the same asset in the ledger such that the transaction update is no longer valid and therefore can no longer be applied. In this way, the ledger is kept consistent across each peer in the channel because they each follow the same rules for validation.</p><p>å¦‚æœäº¤æ˜“å·²è¢«æ­£ç¡®çš„è®¤å¯ï¼Œåˆ™peerèŠ‚ç‚¹å°†å°è¯•å°†å…¶åº”ç”¨äºè´¦æœ¬ã€‚ä¸ºæ­¤ï¼ŒpeerèŠ‚ç‚¹å¿…é¡»æ‰§è¡Œè´¦æœ¬ä¸€è‡´æ€§æ£€æŸ¥ï¼Œä»¥éªŒè¯ç”Ÿæˆæè®®çš„æ›´æ–°æ—¶è´¦æœ¬çš„çŠ¶æ€ä¸å½“å‰è´¦æœ¬çš„çŠ¶æ€ä¸€è‡´ã€‚å³ä½¿äº¤æ˜“å·²å¾—åˆ°å®Œå…¨è®¤å¯ï¼Œè¿™ä¹Ÿä¸æ€»æ˜¯ä¸€è‡´çš„ã€‚ä¾‹å¦‚ï¼Œå¦ä¸€ç¬”äº¤æ˜“å¯èƒ½å·²æ›´æ–°è´¦æœ¬ä¸­çš„åŒä¸€èµ„äº§ï¼Œå› æ­¤è¯¥äº¤æ˜“æ›´æ–°ä¸å†æœ‰æ•ˆï¼Œå› æ­¤æ— æ³•å†åº”ç”¨ã€‚è¿™æ ·ï¼Œè´¦æœ¬åœ¨é€šé“ä¸­çš„æ¯ä¸ªpeerèŠ‚ç‚¹ä¹‹é—´ä¿æŒä¸€è‡´ï¼Œå› ä¸ºå®ƒä»¬éƒ½éµå¾ªç›¸åŒçš„éªŒè¯è§„åˆ™ã€‚</p><p>After a peer has successfully validated each individual transaction, it updates the ledger. Failed transactions are not applied to the ledger, but they are retained for audit purposes, as are successful transactions. This means that peer blocks are almost exactly the same as the blocks received from the orderer, except for a valid or invalid indicator on each transaction in the block.</p><p>åœ¨peerèŠ‚ç‚¹æˆåŠŸéªŒè¯äº†æ¯ä¸ªå•ç‹¬çš„äº¤æ˜“åï¼Œå®ƒå°†æ›´æ–°åˆ†ç±»å¸ã€‚å¤±è´¥çš„äº¤æ˜“ä¸ä¼šè¢«åº”ç”¨äºè´¦æœ¬ï¼Œä½†ä¿ç•™å®ƒä»¬ä»¥è¿›è¡Œå®¡è®¡ï¼Œå°±åƒæˆåŠŸäº¤æ˜“ä¸€æ ·ã€‚è¿™æ„å‘³ç€peerèŠ‚ç‚¹çš„åŒºå—<strong>å‡ ä¹</strong>ä¸ä»æ’åºè€…æ¥æ”¶åˆ°çš„åŒºå—å®Œå…¨ç›¸åŒï¼Œé™¤äº†è¯¥å—ä¸­æ¯ä¸ªäº¤æ˜“çš„æœ‰æ•ˆæˆ–æ— æ•ˆæŒ‡ç¤ºç¬¦ã€‚</p><p>We also note that phase 3 does not require the running of chaincodes â€” this is done only during phase 1, and thatâ€™s important. It means that chaincodes only have to be available on endorsing nodes, rather than throughout the blockchain network. This is often helpful as it keeps the logic of the chaincode confidential to endorsing organizations. This is in contrast to the output of the chaincodes (the transaction proposal responses) which are shared with every peer in the channel, whether or not they endorsed the transaction. This specialization of endorsing peers is designed to help scalability and confidentiality.</p><p>æˆ‘ä»¬è¿˜æ³¨æ„åˆ°ï¼Œç¬¬3é˜¶æ®µä¸éœ€è¦è¿è¡ŒChaincodeï¼Œè¿™ä»…åœ¨ç¬¬1é˜¶æ®µæ‰åšï¼Œè¿™ä¸€ç‚¹å¾ˆé‡è¦ã€‚è¿™æ„å‘³ç€é“¾ç ä»…åœ¨èƒŒä¹¦èŠ‚ç‚¹ä¸Šå¯ç”¨ï¼Œè€Œä¸æ˜¯åœ¨æ•´ä¸ªåŒºå—é“¾ç½‘ç»œä¸Šå¯ç”¨ã€‚è¿™é€šå¸¸å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥ä½¿èƒŒä¹¦ç»„ç»‡çš„é“¾ç é€»è¾‘ä¿æŒç§å¯†ã€‚è¿™ä¸é“¾ç çš„è¾“å‡ºï¼ˆäº¤æ˜“æè®®å“åº”ï¼‰ç›¸åï¼Œé“¾ç çš„è¾“å‡ºä¸é€šé“ä¸­çš„æ¯ä¸ªpeerèŠ‚ç‚¹å…±äº«ï¼Œæ— è®ºä»–ä»¬æ˜¯å¦è®¤å¯äº¤æ˜“ã€‚è¿™ç§èƒŒä¹¦èŠ‚ç‚¹çš„ä¸“ä¸šåŒ–æ—¨åœ¨å¸®åŠ©æé«˜å¯ä¼¸ç¼©æ€§å’Œæœºå¯†æ€§ã€‚</p><p>Finally, every time a block is committed to a peerâ€™s ledger, that peer generates an appropriate <em>event</em>. <em>Block events</em> include the full block content, while <em>block transaction events</em> include summary information only, such as whether each transaction in the block has been validated or invalidated. <em>Chaincode</em> events that the chaincode execution has produced can also be published at this time. Applications can register for these event types so that they can be notified when they occur. These notifications conclude the third and final phase of the transaction workflow.</p><p>æœ€åï¼Œæ¯æ¬¡å°†ä¸€ä¸ªåŒºå—æäº¤ç»™peerèŠ‚ç‚¹çš„è´¦æœ¬ä¹‹åï¼Œè¯¥peerèŠ‚ç‚¹éƒ½ä¼šç”Ÿæˆä¸€ä¸ªé€‚å½“çš„<em>event</em>ã€‚</p><ul><li><em>Block events</em> åŒ…å«æ‰€æœ‰çš„åŒºå—å†…å®¹ï¼Œ</li><li><em>block transaction events</em> åªåŒ…å«æ‘˜è¦ä¿¡æ¯ï¼ˆä¾‹å¦‚åŒºå—ä¸­çš„æ¯ç¬”äº¤æ˜“æ˜¯å¦å·²é€šè¿‡éªŒè¯æˆ–æ— æ•ˆï¼‰</li><li><em>Chaincode</em> events é“¾ç æ‰§è¡Œæ—¶äº§ç”Ÿçš„<em>Chaincode</em> eventsä¹Ÿå¯ä»¥åœ¨æ­¤æ—¶å‘å¸ƒ</li></ul><p>åº”ç”¨ç¨‹åºå¯ä»¥æ³¨å†Œè¿™äº›äº‹ä»¶ç±»å‹ï¼Œä»¥ä¾¿åœ¨äº‹ä»¶å‘ç”Ÿæ—¶å¾—åˆ°é€šçŸ¥ã€‚è¿™äº›é€šçŸ¥ç»“æŸäº†äº¤æ˜“æµç¨‹çš„ç¬¬ä¸‰é˜¶æ®µä¹Ÿå°±æ˜¯æœ€åé˜¶æ®µã€‚</p><p>In summary, phase 3 sees the blocks which are generated by the orderer consistently applied to the ledger. The strict ordering of transactions into blocks allows each peer to validate that transaction updates are consistently applied across the blockchain network.</p><p>æ€»ç»“æ¥è¯´ï¼Œç¬¬ä¸‰é˜¶æ®µå°†çœ‹åˆ°æ’åºè€…ç”Ÿæˆçš„åŒºå—ä¸€è‡´çš„åº”ç”¨äºè´¦æœ¬ã€‚ä¸¥æ ¼çš„å°†äº¤æ˜“æ’åºç„¶åæ‰“åŒ…åˆ°åŒºå—ä½¿æ¯ä¸ªpeerèŠ‚ç‚¹éªŒè¯äº¤æ˜“æ›´æ–°è¢«ä¸€è‡´åº”ç”¨åˆ°blockchainç½‘ç»œä¸­ã€‚</p><h3 id="Orderers-and-Consensus">Orderers and Consensus</h3><p>This entire transaction workflow process is called <em>consensus</em> because all peers have reached agreement on the order and content of transactions, in a process that is mediated by orderers. Consensus is a multi-step process and applications are only notified of ledger updates when the process is complete â€” which may happen at slightly different times on different peers.</p><p>æ•´ä¸ªäº¤æ˜“æµç¨‹è¢«ç§°ä¸ºå…±è¯†ï¼Œæ˜¯å› ä¸ºåœ¨æ’åºèŠ‚ç‚¹çš„è°ƒè§£ä¸‹æ‰€æœ‰peerèŠ‚ç‚¹éƒ½å·²å°±äº¤æ˜“çš„é¡ºåºå’Œå†…å®¹è¾¾æˆå…±è¯†ã€‚å…±è¯†æ˜¯ä¸€ä¸ªå¤šæ­¥éª¤çš„è¿‡ç¨‹ï¼Œåªæœ‰åœ¨è¯¥è¿‡ç¨‹å®Œæˆåï¼Œæ‰å°†è´¦æœ¬æ›´æ–°é€šçŸ¥åº”ç”¨ç¨‹åº â€“ åœ¨ä¸åŒçš„peerä¸Šï¼Œå‘ç”Ÿæ—¶é—´å¯èƒ½ç•¥æœ‰ä¸åŒã€‚</p><p>We will discuss orderers in a lot more detail in a future orderer topic, but for now, think of orderers as nodes which collect and distribute proposed ledger updates from applications for peers to validate and include on the ledger.</p><p>Thatâ€™s it! Weâ€™ve now finished our tour of peers and the other components that they relate to in Fabric. Weâ€™ve seen that peers are in many ways the most fundamental element â€” they form the network, host chaincodes and the ledger, handle transaction proposals and responses, and keep the ledger up-to-date by consistently applying transaction updates to it.</p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> Key Concepts </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> Peers </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ledger(è´¦æœ¬)</title>
      <link href="2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Ledger/"/>
      <url>2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Ledger/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ¡£æ¥è‡ªäº<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/ledger/ledger.html">Ledger</a>ï¼Œä¸ºäº†æé«˜å­¦ä¹ æ•ˆç‡è€Œåšäº†ç®€åŒ–ã€‚</p><h2 id="The-Ledger">The Ledger</h2><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/ledger.diagram.1.png" alt="ledger.diagram.1"></p><ul><li>Ledgerï¼šç”±World Stateå’ŒBlockchainç»„æˆ</li><li>World Stateï¼šæ˜¯ä¿å­˜è´¦æœ¬stateçš„å½“å‰çŠ¶æ€çš„æ•°æ®åº“ï¼ˆä¸ªäººç†è§£ï¼šå¯ä»¥ç±»æ¯”æ¯”ç‰¹å¸çš„UTXOï¼‰</li><li>Blockchainï¼šè®°å½•æ‰€æœ‰å¯¼è‡´å½“å‰World Stateå‘ç”Ÿçš„æ›´æ”¹çš„äº‹åŠ¡æ—¥å¿—ï¼ˆä¸ªäººç†è§£ï¼šä¸æ¯”ç‰¹å¸çš„åŒºå—é“¾åŸºæœ¬ä¸€è‡´ï¼‰</li></ul><h2 id="World-State">World State</h2><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/ledger.diagram.3.png" alt="ledger.diagram.3"></p><ul><li>ä¸–ç•ŒçŠ¶æ€æ˜¯ä¸€äº›äº‹å®çš„é”®å€¼å¯¹</li><li>ä¸–ç•ŒçŠ¶æ€æ˜¯é€šè¿‡æ•°æ®åº“å®ç°çš„</li><li>åº”ç”¨ç¨‹åºæäº¤æ”¹å˜ä¸–ç•ŒçŠ¶æ€çš„äº¤æ˜“ï¼Œè¿™äº›äº¤æ˜“æœ€ç»ˆè¢«æäº¤åˆ°è´¦æœ¬çš„åŒºå—é“¾</li><li>ä¸–ç•ŒçŠ¶æ€è®°å½•çš„äº‹å®éƒ½æœ‰ç‰ˆæœ¬ï¼Œä¾›Hyperledger Fabricå†…éƒ¨ä½¿ç”¨ï¼Œå¹¶ä¸”æ¯æ¬¡çŠ¶æ€æ›´æ”¹æ—¶éƒ½ä¼šé€’å¢</li><li>å½“é¦–æ¬¡åˆ›å»ºåˆ†ç±»å¸æ—¶ï¼Œä¸–ç•ŒçŠ¶æ€ä¸ºç©º</li></ul><h2 id="Blockchain">Blockchain</h2><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/ledger.diagram.2.png" alt="ledger.diagram.2"></p><ul><li>Blockchainæ˜¯æœ‰å…³ä¸–ç•ŒçŠ¶æ€ä¸­çš„stateæ˜¯å¦‚ä½•åˆ°è¾¾å…¶å½“å‰çŠ¶æ€çš„äº‹å®çš„å†å²è®°å½•</li><li>Fabricä¸­çš„Blockchainæ˜¯ç”±æ–‡ä»¶å®ç°</li><li>Blockchainç”±Blockç»„æˆ</li><li>BlockåŒ…å«Block headerã€Block dataå’ŒBlock metadata</li><li>Block headerä¸­åŒ…å«Block dataçš„hashå€¼å’Œä¸Šä¸€ä¸ªåŒºå—çš„hashå€¼</li><li>Block dataä¸­åŒ…å«äº¤æ˜“åˆ—è¡¨</li></ul><h2 id="Blocks">Blocks</h2><ul><li><strong>Block Header</strong><ul><li><strong>Block number</strong>: ä»é›¶å¼€å§‹çš„æ•°å­—ï¼Œåˆ›ä¸–åŒºå—æ˜¯0ï¼Œæ¯æ¬¡è¿½åŠ ä¸€ä¸ªæ–°çš„åŒºå—è¿™ä¸ªBlock numberè‡ªå¢1</li><li><strong>Current Block Hash</strong>: å½“å‰åŒºå—åŒ…å«çš„æ‰€æœ‰çš„äº¤æ˜“çš„hashå€¼</li><li><strong>Previous Block Header Hash</strong>: ä¸Šä¸€ä¸ªåŒºå—çš„Block Headerä¸­çš„hashå€¼</li></ul></li></ul><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/ledger.diagram.4.png" alt="ledger.diagram.4"></p><ul><li><p><strong>Block Data</strong></p><p>Block DataåŒ…å«å·²ç»æ’å¥½åºçš„äº¤æ˜“åˆ—è¡¨ï¼Œè¿™äº›äº¤æ˜“åœ¨æ’åºæœåŠ¡åˆ›å»ºåŒºå—æ—¶å†™å…¥åˆ°Block Data</p></li><li><p><strong>Block Metadata</strong></p><ul><li>Block MetadataåŒ…å«åŒºå—åˆ›å»ºè€…çš„è¯ä¹¦å’Œç­¾åï¼Œç”¨äºé€šè¿‡ç½‘ç»œèŠ‚ç‚¹éªŒè¯å—ã€‚</li><li>åŒºå—æäº¤è€…å°†æ¯ä¸ªäº¤æ˜“çš„æœ‰æ•ˆ/æ— æ•ˆæŒ‡ç¤ºç¬¦æ·»åŠ åˆ°Block Metadataçš„bitmapä¸­</li><li>ç›´åˆ°ï¼ˆåŒ…æ‹¬ï¼‰è¯¥å—ä¸ºæ­¢çš„ç´¯ç§¯çŠ¶æ€çš„å“ˆå¸Œå€¼ï¼Œä»¥ä¾¿æ£€æµ‹çŠ¶æ€æ´¾ç”Ÿï¼ˆè¿™æ˜¯ä¸ºäº†åœ¨æäº¤ä¹‹å‰éªŒè¯çŠ¶æ€æœ‰æ²¡æœ‰è¢«å…¶ä»–çš„äº¤æ˜“æ›´æ”¹ï¼‰</li></ul></li></ul><h2 id="Transactions">Transactions</h2><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/ledger.diagram.5.png" alt="ledger.diagram.5"></p><p>æ¯ä¸ªäº¤æ˜“éƒ½åŒ…å«ä»¥ä¸‹å››éƒ¨åˆ†ï¼š</p><ul><li><p><strong>Header</strong></p><p>å–å¾—æœ‰å…³äº¤æ˜“çš„ä¸€äº›åŸºæœ¬å…ƒæ•°æ®-ä¾‹å¦‚ç›¸å…³é“¾ç çš„åç§°åŠå…¶ç‰ˆæœ¬ã€‚</p></li><li><p><strong>Signature</strong></p><p>åŒ…å«å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºçš„ç­¾åï¼›æ­¤å­—æ®µç”¨äºæ£€æŸ¥äº¤æ˜“æ˜ç»†æ˜¯å¦æœªè¢«ç¯¡æ”¹ï¼Œå› ä¸ºå®ƒéœ€è¦åº”ç”¨ç¨‹åºçš„ç§é’¥æ¥ç”Ÿæˆã€‚</p></li><li><p><strong>Proposal</strong></p><p>ä¿å­˜ç¼–ç åçš„åº”ç”¨ç¨‹åºæä¾›ç»™æ™ºèƒ½åˆçº¦çš„è¾“å…¥å‚æ•°ï¼Œä½¿ç”¨è¿™äº›å‚æ•°æ¥åˆ›å»ºæ›´æ–°è´¦æœ¬çš„æè®®ã€‚å½“æ™ºèƒ½åˆçº¦è¿è¡Œæ—¶ï¼Œè¯¥æè®®æä¾›äº†ä¸€ç»„è¾“å…¥å‚æ•°ï¼Œè¿™äº›è¾“å…¥å‚æ•°ä¸å½“å‰çš„ä¸–ç•ŒçŠ¶æ€ä¸€èµ·ç¡®å®šäº†æ–°çš„ä¸–ç•ŒçŠ¶æ€ã€‚</p></li><li><p><strong>Response</strong></p><p>è·å–ä¸–ç•ŒçŠ¶æ€çš„å‰åå€¼ï¼Œä½œä¸ºè¯»å†™é›†ï¼ˆRW-setï¼‰ã€‚å®ƒæ˜¯æ™ºèƒ½åˆçº¦çš„è¾“å‡ºï¼Œå¦‚æœäº¤æ˜“æˆåŠŸé€šè¿‡éªŒè¯ï¼Œå®ƒå°†åº”ç”¨äºè´¦æœ¬æ¥æ›´æ–°ä¸–ç•ŒçŠ¶æ€ã€‚</p></li><li><p><strong>Endorsements</strong></p><p>è¿™æ˜¯æ»¡è¶³èƒŒä¹¦ç­–ç•¥çš„ç»„ç»‡çš„ç­¾ååˆ—è¡¨ã€‚äº¤æ˜“å“åº”åŒ…å«äº†èƒŒä¹¦åˆ—è¡¨ï¼Œå¹¶ä¸”åªæœ‰æ»¡è¶³äº¤æ˜“èƒŒä¹¦ç­–ç•¥çš„èƒŒä¹¦åˆ—è¡¨æ‰ä¼šå­˜åœ¨åœ¨æ­¤ï¼Œå¦‚æœä¸æ»¡è¶³èƒŒä¹¦ç­–ç•¥åˆ™ä¸åœ¨æ­¤è®°å½•ï¼Œå› ä¸ºä¹Ÿä¸ä¼šæ›´æ–°ä¸–ç•ŒçŠ¶æ€ã€‚</p></li></ul><h2 id="World-State-database-options">World State database options</h2><p>The world state is physically implemented as a database, to provide simple and efficient storage and retrieval of ledger states. As weâ€™ve seen, ledger states can have simple or compound values, and to accommodate this, the world state database implementation can vary, allowing these values to be efficiently implemented. Options for the world state database currently include LevelDB and CouchDB.</p><p>ä¸–ç•ŒçŠ¶æ€åœ¨ç‰©ç†ä¸Šæ˜¯ä½¿ç”¨æ•°æ®åº“å®ç°çš„ï¼Œä»¥æä¾›ç®€å•æœ‰æ•ˆçš„å­˜å‚¨å’Œè´¦æœ¬çŠ¶æ€æ£€ç´¢ã€‚å¦‚æˆ‘ä»¬æ‰€è§ï¼Œè´¦æœ¬çŠ¶æ€å¯ä»¥å…·æœ‰ç®€å•å€¼æˆ–å¤åˆå€¼ï¼Œä¸ºäº†é€‚åº”è¿™ç§æƒ…å†µï¼Œä¸–ç•ŒçŠ¶æ€æ•°æ®åº“çš„å®ç°æ–¹å¼å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œä»è€Œå¯ä»¥æœ‰æ•ˆåœ°å®ç°è¿™äº›æƒ…å†µã€‚ä¸–ç•ŒçŠ¶æ€æ•°æ®åº“çš„é€‰é¡¹å½“å‰åŒ…æ‹¬LevelDBå’ŒCouchDBã€‚</p><p>LevelDB is the default and is particularly appropriate when ledger states are simple key-value pairs. A LevelDB database is co-located with the peer node â€“ it is embedded within the same operating system process.</p><p>LevelDBæ˜¯é»˜è®¤å€¼ï¼Œå½“è´¦æœ¬çŠ¶æ€ä¸ºç®€å•é”®/å€¼å¯¹æ—¶å°¤å…¶é€‚ç”¨ã€‚LevelDBæ•°æ®åº“ä¸peerèŠ‚ç‚¹ä½äºåŒä¸€ä½ç½®éƒ½åµŒå…¥åœ¨åŒä¸€æ“ä½œç³»ç»Ÿè¿›ç¨‹ä¸­ã€‚</p><p>CouchDB is a particularly appropriate choice when ledger states are structured as JSON documents because CouchDB supports the rich queries and update of richer data types often found in business transactions. Implementation-wise, CouchDB runs in a separate operating system process, but there is still a 1:1 relation between a peer node and a CouchDB instance. All of this is invisible to a smart contract. See <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/couchdb_as_state_database.html">CouchDB as the StateDatabase</a> for more information on CouchDB.</p><p>å½“è´¦æœ¬çŠ¶æ€è¢«æ„é€ ä¸ºJSONæ ¼å¼çš„æ–‡æ¡£æ—¶ï¼ŒCouchDBæ˜¯ä¸€ä¸ªç‰¹åˆ«åˆé€‚çš„é€‰æ‹©ï¼Œå› ä¸ºCouchDBæ”¯æŒä¸°å¯Œçš„æŸ¥è¯¢å’Œä¸šåŠ¡äº¤æ˜“ä¸­ç»å¸¸å‘ç”Ÿçš„ä¸°å¯Œæ•°æ®ç±»å‹çš„æ›´æ–°ã€‚åœ¨å®ç°æ–¹é¢ï¼ŒCouchDBåœ¨å•ç‹¬çš„æ“ä½œç³»ç»Ÿè¿›ç¨‹ä¸­è¿è¡Œï¼Œä½†æ˜¯peerèŠ‚ç‚¹å’ŒCouchDBå®ä¾‹ä¹‹é—´ä»ç„¶å­˜åœ¨1æ¯”1çš„å…³ç³»ã€‚</p><p>In LevelDB and CouchDB, we see an important aspect of Hyperledger Fabric â€“ it is <em>pluggable</em>. The world state database could be a relational data store, or a graph store, or a temporal database. This provides great flexibility in the types of ledger states that can be efficiently accessed, allowing Hyperledger Fabric to address many different types of problems.</p><p>åœ¨LevelDBå’ŒCouchDBä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†Hyperledger Fabricçš„é‡è¦æ–¹é¢â€“å®ƒæ˜¯æ’ä»¶åŒ–çš„ã€‚ä¸–ç•ŒçŠ¶æ€æ•°æ®åº“å¯ä»¥æ˜¯å…³ç³»æ•°æ®å­˜å‚¨ï¼Œå›¾å½¢å­˜å‚¨æˆ–æ—¶æ€æ•°æ®åº“ã€‚è¿™ä¸ºå¯ä»¥æœ‰æ•ˆè®¿é—®çš„è´¦æœ¬çŠ¶æ€ç±»å‹æä¾›äº†æå¤§çš„çµæ´»æ€§ï¼Œä»è€Œä½¿Hyperledger Fabricå¯ä»¥è§£å†³è®¸å¤šä¸åŒç±»å‹çš„é—®é¢˜ã€‚</p><h2 id="Example-Ledger-Basic-Asset-Transfer">Example Ledger: Basic Asset Transfer</h2><p>ä½¿ç”¨åŒä¸€ä¸ªèº«ä»½åˆ›å»ºå››ä¸ªèµ„äº§ï¼Œè´¦æœ¬ä¼šå˜æˆä¸‹é¢è¿™æ ·ï¼š</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/ledger.diagram.6.png" alt="ledger.diagram.6"></p><h2 id="Namespaces">Namespaces</h2><p>Even though we have presented the ledger as though it were a single world state and single blockchain, thatâ€™s a little bit of an over-simplification. In reality, each chaincode has its own world state that is separate from all other chaincodes. World states are in a namespace so that only smart contracts within the same chaincode can access a given namespace.</p><p>å³ä½¿æˆ‘ä»¬å·²ç»å°†è´¦æœ¬å‘ˆç°ä¸ºä¸€ä¸ªå•ä¸€çš„ä¸–ç•ŒçŠ¶æ€å’Œå•ä¸ªåŒºå—é“¾ï¼Œä½†è¿™è¿˜æ˜¯æœ‰ç‚¹è¿‡åˆ†ç®€åŒ–äº†ã€‚å®é™…ä¸Šï¼Œæ¯ä¸ªé“¾ç éƒ½æœ‰å…¶è‡ªå·±çš„ä¸–ç•ŒçŠ¶æ€ï¼Œè¯¥çŠ¶æ€ä¸æ‰€æœ‰å…¶ä»–é“¾ç åˆ†å¼€ã€‚ä¸–ç•ŒçŠ¶æ€ä½äºåç§°ç©ºé—´ä¸­ï¼Œå› æ­¤åªæœ‰ç›¸åŒé“¾ç å†…çš„æ™ºèƒ½åˆçº¦æ‰èƒ½è®¿é—®ç»™å®šçš„åç§°ç©ºé—´ã€‚</p><p>A blockchain is not namespaced. It contains transactions from many different smart contract namespaces. You can read more about chaincode namespaces in this <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/developapps/chaincodenamespace.html">topic</a>.</p><p>åŒºå—é“¾æ²¡æœ‰å‘½åç©ºé—´ã€‚å®ƒåŒ…å«æ¥è‡ªè®¸å¤šä¸åŒçš„æ™ºèƒ½åˆçº¦å‘½åç©ºé—´çš„äº¤æ˜“ã€‚æ‚¨å¯ä»¥åœ¨<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/developapps/chaincodenamespace.html">Chaincode namespace</a>ä¸­é˜…è¯»æœ‰å…³é“¾ç åç§°ç©ºé—´çš„æ›´å¤šä¿¡æ¯ã€‚</p><h2 id="Channels">Channels</h2><p>In Hyperledger Fabric, each <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/channels.html">channel</a> has a completely separate ledger. This means a completely separate blockchain, and completely separate world states, including namespaces. It is possible for applications and smart contracts to communicate between channels so that ledger information can be accessed between them.</p><p>åœ¨Hyperledger Fabricä¸­ï¼Œæ¯ä¸ªé€šé“éƒ½æœ‰ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„è´¦æœ¬ã€‚è¿™æ„å‘³ç€å®Œå…¨ç‹¬ç«‹çš„åŒºå—é“¾ï¼Œä»¥åŠå®Œå…¨ç‹¬ç«‹çš„ä¸–ç•ŒçŠ¶æ€ä»¥åŠåç§°ç©ºé—´ã€‚åº”ç”¨ç¨‹åºå’Œæ™ºèƒ½åˆçº¦å¯ä»¥åœ¨é€šé“ä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œä»¥ä¾¿å¯ä»¥åœ¨å®ƒä»¬ä¹‹é—´è®¿é—®åˆ†ç±»å¸ä¿¡æ¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> Key Concepts </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> Ledger </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Membership Service Provider (MSP)</title>
      <link href="2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/MSP/"/>
      <url>2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/MSP/</url>
      
        <content type="html"><![CDATA[<h2 id="Why-do-I-need-an-MSP-ï¼ˆä¸ºä»€ä¹ˆæˆ‘éœ€è¦MSPï¼‰">Why do I need an MSP?ï¼ˆä¸ºä»€ä¹ˆæˆ‘éœ€è¦MSPï¼‰</h2><p>Because Fabric is a permissioned network, blockchain participants need a way to prove their identity to the rest of the network in order to transact on the network. If youâ€™ve read through the documentation on <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/identity/identity.html">Identity</a> youâ€™ve seen how a Public Key Infrastructure (PKI) can provide verifiable identities through a chain of trust. How is that chain of trust used by the blockchain network?</p><p>å› ä¸ºFabricæ˜¯ä¸€ä¸ªè®¸å¯å½¢å¼çš„ç½‘ç»œï¼ŒåŒºå—é“¾å‚ä¸è€…éœ€è¦ä¸€ç§å‘ç½‘ç»œå…¶ä»–æˆå‘˜è¯æ˜è‡ªå·±èº«ä»½çš„æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨ç½‘ç»œä¸Šè¿›è¡Œäº¤æ˜“ã€‚å¦‚æœä½ å·²ç»é˜…è¯»äº† <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/identity/identity.html">Identity</a> æ–‡æ¡£ï¼Œä½ å·²ç»çœ‹åˆ°PKIå¦‚ä½•é€šè¿‡ä¿¡ä»»é“¾æä¾›å¯éªŒè¯çš„èº«ä»½ã€‚åŒºå—é“¾ç½‘ç»œå¦‚ä½•ä½¿ç”¨è¯¥ä¿¡ä»»é“¾ï¼Ÿ</p><p>Certificate Authorities issue identities by generating a public and private key which forms a key-pair that can be used to prove identity. Because a private key can never be shared publicly, a mechanism is required to enable that proof which is where the MSP comes in. For example, a peer uses its private key to digitally sign, or endorse, a transaction. The MSP on the ordering service contains the peerâ€™s public key which is then used to verify that the signature attached to the transaction is valid. The private key is used to produce a signature on a transaction that only the corresponding public key, that is part of an MSP, can match. Thus, the MSP is the mechanism that allows that identity to be trusted and recognized by the rest of the network without ever revealing the memberâ€™s private key.</p><p>è¯ä¹¦é¢å‘æœºæ„é€šè¿‡ç”Ÿæˆå…¬é’¥å’Œç§é’¥æ¥é¢å‘èº«ä»½ï¼Œè¯¥å…¬é’¥å’Œç§é’¥å½¢æˆå¯ç”¨äºè¯æ˜èº«ä»½çš„å¯†é’¥å¯¹ã€‚ç”±äºæ°¸è¿œä¸èƒ½å…¬å¼€å…±äº«ç§é’¥ï¼Œå› æ­¤éœ€è¦ä¸€ç§æœºåˆ¶æ¥è¯æ˜ä»–æ˜¯è°ï¼Œç„¶åMSPå°±æ˜¯åšè¿™ä»¶äº‹çš„ã€‚ä¾‹å¦‚ä¸€ä¸ªpeerèŠ‚ç‚¹æ˜¯ç”¨ä»–è‡ªå·±çš„ç§é’¥æ¥ç­¾åæˆ–è€…èƒŒä¹¦ä¸€ä¸ªäº¤æ˜“ã€‚æ’åºæœåŠ¡çš„MSPåŒ…å«äº†peerèŠ‚ç‚¹çš„å…¬é’¥ï¼Œè¯¥å…¬é’¥éšåç”¨äºéªŒè¯é™„åŠ åˆ°äº¤æ˜“çš„ç­¾åæ˜¯å¦æœ‰æ•ˆã€‚ç§é’¥ç”¨äºåœ¨äº¤æ˜“ä¸Šäº§ç”Ÿç­¾åï¼Œåªæœ‰ç›¸åº”çš„å…¬é’¥ï¼ˆMSPçš„ä¸€éƒ¨åˆ†ï¼‰æ‰èƒ½åŒ¹é…è¯¥ç­¾åã€‚å› æ­¤ï¼ŒMSPæ˜¯ä¸€ç§å…è®¸èº«ä»½ç”±ç½‘ç»œçš„å…¶ä½™éƒ¨åˆ†ä¿¡ä»»å’Œè¯†åˆ«ï¼Œè€Œæ— éœ€é€éœ²æˆå‘˜çš„ç§é’¥çš„æœºåˆ¶ã€‚</p><p>Recall from the credit card scenario in the Identity topic that the Certificate Authority is like a card provider â€” it dispenses many different types of verifiable identities. An MSP, on the other hand, determines which credit card providers are accepted at the store. In this way, the MSP turns an identity (the credit card) into a role (the ability to buy things at the store).</p><p>ä»â€œèº«ä»½â€ä¸»é¢˜ä¸­çš„ä¿¡ç”¨å¡ä¸šåŠ¡æƒ…æ™¯ä¸­å›æƒ³èµ·ï¼Œè¯ä¹¦é¢å‘æœºæ„å°±åƒå‘å¡ç»„ç»‡ä¸€æ ·-å®ƒåˆ†é…äº†è®¸å¤šä¸åŒç±»å‹çš„å¯éªŒè¯èº«ä»½ã€‚å¦ä¸€æ–¹é¢ï¼ŒMSPç¡®å®šå•†åº—æ¥å—å“ªäº›ä¿¡ç”¨å¡å‘å¡ç»„ç»‡ã€‚è¿™æ ·ï¼ŒMSPå°†èº«ä»½ï¼ˆä¿¡ç”¨å¡ï¼‰è½¬å˜ä¸ºè§’è‰²ï¼ˆåœ¨å•†åº—è´­ä¹°å•†å“çš„èƒ½åŠ›ï¼‰ã€‚</p><p>This ability to turn verifiable identities into roles is fundamental to the way Fabric networks function, since it allows organizations, nodes, and channels the ability establish MSPs that determine who is allowed to do what at the organization, node, and channel level.</p><p>è¿™ç§å°†å¯éªŒè¯èº«ä»½è½¬æ¢ä¸ºè§’è‰²çš„èƒ½åŠ›æ˜¯Fabricç½‘ç»œè¿è¡Œæ–¹å¼çš„åŸºç¡€ï¼Œå› ä¸ºå®ƒå…è®¸ç»„ç»‡ï¼ŒèŠ‚ç‚¹å’Œæ¸ é“å…·å¤‡å»ºç«‹MSPçš„èƒ½åŠ›ï¼Œä»è€Œç¡®å®šå…è®¸è°åœ¨ç»„ç»‡ï¼ŒèŠ‚ç‚¹å’Œæ¸ é“çº§åˆ«ä¸Šåšä»€ä¹ˆã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/membership.msp.diagram.png" alt="membership.msp.diagram"></p><p><em>Identities are similar to your credit cards that are used to prove you can pay. The MSP is similar to the list of accepted credit cards.</em></p><p>Consider a consortium of banks that operate a blockchain network. Each bank operates peer and ordering nodes, and the peers endorse transactions submitted to the network. However, each bank would also have departments and account holders. The account holders would belong to each organization, but would not run nodes on the network. They would only interact with the system from their mobile or web application. So how does the network recognize and differentiate these identities? A CA was used to create the identities, but like the card example, those identities canâ€™t just be issued, they need to be recognized by the network. MSPs are used to define the organizations that are trusted by the network members. MSPs are also the mechanism that provide members with a set of roles and permissions within the network. Because the MSPs defining these organizations are known to the members of a network, they can then be used to validate that network entities that attempt to perform actions are allowed to.</p><p>è€ƒè™‘ä¸€ä¸ªç»è¥åŒºå—é“¾ç½‘ç»œçš„é“¶è¡Œè”ç›Ÿã€‚æ¯ä¸ªé“¶è¡Œéƒ½æ“ä½œpeerèŠ‚ç‚¹å’Œæ’åºèŠ‚ç‚¹ï¼Œå¹¶ä¸”peerèŠ‚ç‚¹è®¤å¯æäº¤ç»™ç½‘ç»œçš„äº¤æ˜“ã€‚ä½†æ˜¯æ¯ä¸ªé“¶è¡Œä¹ŸåŒæ ·æœ‰éƒ¨é—¨å’Œè´¦æˆ·æŒæœ‰è€…ã€‚å¸æˆ·æŒæœ‰è€…å°†å±äºå„è‡ªçš„ç»„ç»‡ï¼Œä½†ä¸ä¼šåœ¨ç½‘ç»œä¸Šè¿è¡ŒèŠ‚ç‚¹ã€‚ä»–ä»¬åªèƒ½é€šè¿‡å…¶ç§»åŠ¨æˆ–Webåº”ç”¨ç¨‹åºä¸ç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚é‚£ä¹ˆç½‘ç»œå¦‚ä½•è¯†åˆ«å’ŒåŒºåˆ†è¿™äº›èº«ä»½å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨CAæ¥åˆ›å»ºèº«ä»½ï¼Œä½†æ˜¯å°±åƒå¡ç‰‡ç¤ºä¾‹ä¸€æ ·ï¼Œä¸èƒ½ä»…ä»…æ˜¯é¢å‘äº†èº«ä»½ï¼Œè¿˜å¿…é¡»ç”±ç½‘ç»œæ¥è¯†åˆ«è¿™äº›èº«ä»½ã€‚MSPç”¨äºå®šä¹‰ç½‘ç»œæˆå‘˜ä¿¡ä»»çš„ç»„ç»‡ã€‚MSPè¿˜æ˜¯ä¸€ä¸ªæœºåˆ¶ï¼Œè¿™ä¸ªæœºåˆ¶ä¸ºæˆå‘˜æä¾›ç½‘ç»œä¸­çš„ä¸€ç»„è§’è‰²å’Œæƒé™ã€‚ç”±äºMSPå®šä¹‰çš„è¿™äº›ç»„ç»‡å¯¹ç½‘ç»œæˆå‘˜è€Œè¨€æ˜¯å·²çŸ¥çš„ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥ç”¨äºéªŒè¯å…è®¸å°è¯•æ‰§è¡Œæ“ä½œçš„ç½‘ç»œå®ä½“ã€‚</p><p>Finally, consider if you want to join an <em>existing</em> network, you need a way to turn your identity into something that is recognized by the network. The MSP is the mechanism that enables you to participate on a permissioned blockchain network. To transact on a Fabric network a member needs to:</p><ol><li>Have an identity issued by a CA that is trusted by the network.</li><li>Become a member of an <em>organization</em> that is recognized and approved by the network members. The MSP is how the identity is linked to the membership of an organization. Membership is achieved by adding the memberâ€™s public key (also known as certificate, signing cert, or signcert) to the organizationâ€™s MSP.</li><li>Add the MSP to either a <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/glossary.html#consortium">consortium</a> on the network or a channel.</li><li>Ensure the MSP is included in the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/policies/policies.html">policy</a> definitions on the network.</li></ol><p>æœ€åï¼Œè€ƒè™‘å¦‚æœä½ æƒ³è¦åŠ å…¥ä¸€ä¸ªç°æœ‰ç½‘ç»œï¼Œä½ éœ€è¦ä¸€ä¸ªæ–¹æ³•æ¥å°†ä½ çš„èº«ä»½è½¬æ¢ä¸ºç½‘ç»œå¯è¯†åˆ«çš„å†…å®¹ã€‚MSPæ˜¯ä½¿æ‚¨èƒ½å¤Ÿå‚ä¸è®¸å¯çš„åŒºå—é“¾ç½‘ç»œçš„æœºåˆ¶ã€‚ä¸ºäº†åœ¨Fabricçš„ç½‘ç»œä¸Šè¿›è¡Œäº¤æ˜“ï¼Œä¸€ä¸ªæˆå‘˜éœ€è¦ï¼š</p><ol><li>å…·æœ‰ç”±ç½‘ç»œä¿¡ä»»çš„CAé¢å‘çš„èº«ä»½ã€‚</li><li>æˆä¸ºç”±ç½‘ç»œæˆå‘˜è®¤å¯å¹¶æ‰¹å‡†çš„ç»„ç»‡çš„æˆå‘˜ã€‚MSPæ˜¯å°†èº«ä»½é“¾æ¥åˆ°ç»„ç»‡æˆå‘˜çš„æ–¹å¼ã€‚æˆå‘˜èµ„æ ¼æ˜¯é€šè¿‡å°†æˆå‘˜çš„å…¬é’¥ï¼ˆä¹Ÿç§°ä¸ºè¯ä¹¦ï¼Œç­¾åè¯ä¹¦æˆ–signcertï¼‰æ·»åŠ åˆ°ç»„ç»‡çš„MSPä¸­æ¥å®ç°çš„ã€‚</li><li>å°†MSPæ·»åŠ åˆ°ç½‘ç»œä¸Šçš„è”ç›Ÿæˆ–é€šé“ä¸Šã€‚</li><li>ç¡®ä¿MSPåŒ…å«åœ¨ç½‘ç»œä¸Šå®šä¹‰çš„ç­–ç•¥ã€‚</li></ol><h2 id="What-is-an-MSP">What is an MSP?</h2><p>Despite its name, the Membership Service Provider does not actually provide anything. Rather, the implementation of the MSP requirement is a set of folders that are added to the configuration of the network and is used to define an organization both inwardly (organizations decide who its admins are) and outwardly (by allowing other organizations to validate that entities have the authority to do what they are attempting to do). Whereas Certificate Authorities generate the certificates that represent identities, the MSP contains a list of permissioned identities.</p><p>The MSP identifies which Root CAs and Intermediate CAs are accepted to define the members of a trust domain by listing the identities of their members, or by identifying which CAs are authorized to issue valid identities for their members.</p><p>But the power of an MSP goes beyond simply listing who is a network participant or member of a channel. It is the MSP that turns an identity into a <strong>role</strong> by identifying specific privileges an actor has on a node or channel. Note that when a user is registered with a Fabric CA, a role of admin, peer, client, orderer, or member must be associated with the user. For example, identities registered with the â€œpeerâ€ role should, naturally, be given to a peer. Similarly, identities registered with the â€œadminâ€ role should be given to organization admins. Weâ€™ll delve more into the significance of these roles later in the topic.</p><p>In addition, an MSP can allow for the identification of a list of identities that have been revoked â€” as discussed in the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/identity/identity.html">Identity</a> documentation â€” but we will talk about how that process also extends to an MSP.</p><h2 id="MSP-domains">MSP domains</h2><p>MSPs occur in two domains in a blockchain network:</p><ul><li>Locally on an actorâ€™s node (<strong>local MSP</strong>)</li><li>In channel configuration (<strong>channel MSP</strong>)</li></ul><p>The key difference between local and channel MSPs is not how they function â€“ both turn identities into roles â€“ but their <strong>scope</strong>. Each MSP lists roles and permissions at a particular level of administration.</p><p>æœ¬åœ°MSPå’Œé€šé“MSPä¹‹é—´çš„ä¸»è¦åŒºåˆ«ä¸æ˜¯å®ƒä»¬çš„åŠŸèƒ½ï¼ˆä¸¤è€…éƒ½å°†èº«ä»½è½¬æ¢ä¸ºè§’è‰²ï¼‰ï¼Œè€Œæ˜¯å®ƒä»¬çš„èŒƒå›´ã€‚æ¯ä¸ªMSPéƒ½åˆ—å‡ºç‰¹å®šç®¡ç†çº§åˆ«çš„è§’è‰²å’Œæƒé™ã€‚</p><h3 id="Local-MSPs">Local MSPs</h3><p><strong>Local MSPs are defined for clients and for nodes (peers and orderers)</strong>. Local MSPs define the permissions for a node (who are the peer admins who can operate the node, for example). The local MSPs of clients (the account holders in the banking scenario above), allow the user to authenticate itself in its transactions as a member of a channel (e.g. in chaincode transactions), or as the owner of a specific role into the system such as an organization admin, for example, in configuration transactions.</p><p><strong>Local MSPs</strong>æ˜¯ä¸ºå®¢æˆ·ç«¯å’ŒèŠ‚ç‚¹ï¼ˆpeerså’Œè®¢orderersï¼‰å®šä¹‰çš„ã€‚æœ¬åœ°MSPå®šä¹‰äº†ä¸€ä¸ªèŠ‚ç‚¹çš„æƒé™ï¼ˆä¾‹å¦‚è°æ˜¯peerçš„ç®¡ç†å‘˜ï¼Œè°å¯ä»¥æ“ä½œè¿™ä¸ªèŠ‚ç‚¹ï¼‰ã€‚å®¢æˆ·ç«¯çš„æœ¬åœ°MSPï¼ˆä¸Šè¿°é“¶è¡Œä¸šåŠ¡åœºæ™¯ä¸­çš„å¸æˆ·æŒæœ‰äººï¼‰å…è®¸ç”¨æˆ·åœ¨è‡ªèº«äº¤æ˜“ä¸­ä½œä¸ºé€šé“æˆå‘˜è¿›è¡Œèº«ä»½éªŒè¯ï¼ˆä¾‹å¦‚åœ¨é“¾ç ä¸­äº¤æ˜“ä¸­ï¼‰ï¼Œæˆ–è€…ä½œä¸ºç³»ç»Ÿä¸­ç‰¹å®šè§’è‰²ï¼ˆä¾‹å¦‚ç»„ç»‡ç®¡ç†å‘˜ï¼‰çš„æ‰€æœ‰è€…ï¼Œä¾‹å¦‚ï¼Œåœ¨é…ç½®äº‹åŠ¡ä¸­ã€‚</p><p><strong>Every node must have a local MSP defined</strong>, as it defines who has administrative or participatory rights at that level (peer admins will not necessarily be channel admins, and vice versa). This allows for authenticating member messages outside the context of a channel and to define the permissions over a particular node (who has the ability to install chaincode on a peer, for example). Note that one or more nodes can be owned by an organization. An MSP defines the organization admins. And the organization, the admin of the organization, the admin of the node, and the node itself should all have the same root of trust.</p><p><strong>æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦å®šä¹‰ä¸€ä¸ªæœ¬åœ°çš„MSP</strong>ï¼Œå› ä¸ºå®ƒå®šä¹‰äº†åœ¨è¯¥çº§åˆ«å…·æœ‰ç®¡ç†æˆ–å‚ä¸æƒçš„äººï¼ˆpeerç®¡ç†å‘˜ä¸ä¸€å®šæ˜¯é€šé“ç®¡ç†å‘˜ï¼Œåä¹‹äº¦ç„¶ï¼‰ã€‚è¿™å…è®¸åœ¨é€šé“ä¸Šä¸‹æ–‡ä¹‹å¤–å¯¹æˆå‘˜æ¶ˆæ¯è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå¹¶å®šä¹‰å¯¹ç‰¹å®šèŠ‚ç‚¹çš„æƒé™ï¼ˆå¦‚è°æœ‰èƒ½åŠ›åœ¨peerä¸Šå®‰è£…é“¾ç ï¼‰ã€‚è¯·æ³¨æ„ï¼Œä¸€ä¸ªç»„ç»‡å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ã€‚MSPå®šä¹‰ç»„ç»‡ç®¡ç†å‘˜ã€‚ç»„ç»‡ã€ç»„ç»‡çš„ç®¡ç†å‘˜ã€èŠ‚ç‚¹çš„ç®¡ç†å‘˜ä»¥åŠèŠ‚ç‚¹æœ¬èº«éƒ½åº”å…·æœ‰ç›¸åŒçš„æ ¹CAã€‚</p><p>An orderer local MSP is also defined on the file system of the node and only applies to that node. Like peer nodes, orderers are also owned by a single organization and therefore have a single MSP to list the actors or nodes it trusts.</p><p>åœ¨æ’åºè€…èŠ‚ç‚¹çš„æ–‡ä»¶ç³»ç»Ÿä¸Šä¹Ÿå®šä¹‰äº†æœ¬åœ°MSPï¼Œå®ƒä»…é€‚ç”¨äºè¯¥èŠ‚ç‚¹ã€‚å°±åƒpeerèŠ‚ç‚¹ä¸€æ ·ï¼Œæ’åºè€…ç”±å•ä¸ªç»„ç»‡æ‹¥æœ‰ï¼Œå› æ­¤æœ‰ä¸€ä¸ªMSPåˆ—å‡ºå…¶ä¿¡ä»»çš„å‚ä¸è€…æˆ–èŠ‚ç‚¹ã€‚</p><h3 id="Channel-MSPs">Channel MSPs</h3><p>In contrast, <strong>channel MSPs define administrative and participatory rights at the channel level</strong>. Peers and ordering nodes on an application channel share the same view of channel MSPs, and will therefore be able to correctly authenticate the channel participants. This means that if an organization wishes to join the channel, an MSP incorporating the chain of trust for the organizationâ€™s members would need to be included in the channel configuration. Otherwise transactions originating from this organizationâ€™s identities will be rejected. Whereas local MSPs are represented as a folder structure on the file system, channel MSPs are described in a channel configuration.</p><p>ç›¸åï¼Œ<strong>é€šé“MSPåœ¨é€šé“çº§åˆ«å®šä¹‰äº†ç®¡ç†æƒå’Œå‚ä¸æƒ</strong>ã€‚åº”ç”¨ç¨‹åºé€šé“ä¸Šçš„peerèŠ‚ç‚¹å’Œæ’åºèŠ‚ç‚¹å…±äº«é€šé“MSPçš„ç›¸åŒè§†å›¾ï¼Œå› æ­¤å°†èƒ½å¤Ÿæ­£ç¡®åœ°éªŒè¯é€šé“å‚ä¸è€…ã€‚è¿™æ„å‘³ç€å¦‚æœç»„ç»‡å¸Œæœ›åŠ å…¥é€šé“ï¼Œåˆ™éœ€è¦åœ¨é€šé“é…ç½®ä¸­åŒ…å«ä¸€ä¸ªåŒ…å«ç»„ç»‡æˆå‘˜ä¿¡ä»»é“¾çš„MSPã€‚å¦åˆ™ï¼Œæ¥è‡ªè¯¥ç»„ç»‡èº«ä»½çš„äº¤æ˜“å°†è¢«æ‹’ç»ã€‚æœ¬åœ°MSPåœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šè¡¨ç¤ºä¸ºæ–‡ä»¶å¤¹ç»“æ„ï¼Œè€Œé€šé“MSPåˆ™åœ¨é€šé“é…ç½®ä¸­æè¿°ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/ChannelMSP.png" alt="ChannelMSP"></p><p><em>Snippet from a channel config.json file that includes two organization MSPs.</em></p><p><strong>Channel MSPs identify who has authorities at a channel level</strong>. The channel MSP defines the <em>relationship</em> between the identities of channel members (which themselves are MSPs) and the enforcement of channel level policies. Channel MSPs contain the MSPs of the organizations of the channel members.</p><p>**é€šé“MSPè¯†åˆ«è°æ‹¥æœ‰é€šé“çº§åˆ«çš„æƒé™ã€‚**é€šé“MSPå®šä¹‰äº†é€šé“æˆå‘˜èº«ä»½ï¼ˆæœ¬èº«å°±æ˜¯MSPï¼‰å’Œé€šé“çº§ç­–ç•¥æ‰§è¡Œä¹‹é—´çš„å…³ç³»ã€‚é€šé“MSPåŒ…å«é€šé“æˆå‘˜ç»„ç»‡çš„MSPã€‚</p><p><strong>Every organization participating in a channel must have an MSP defined for it</strong>. In fact, it is recommended that there is a one-to-one mapping between organizations and MSPs. The MSP defines which members are empowered to act on behalf of the organization. This includes configuration of the MSP itself as well as approving administrative tasks that the organization has role, such as adding new members to a channel. If all network members were part of a single organization or MSP, data privacy is sacrificed. Multiple organizations facilitate privacy by segregating ledger data to only channel members. If more granularity is required within an organization, the organization can be further divided into organizational units (OUs) which we describe in more detail later in this topic.</p><p>**æ¯ä¸ªå‚ä¸æ¸ é“çš„ç»„ç»‡éƒ½å¿…é¡»ä¸ºå…¶å®šä¹‰MSPã€‚**å®é™…ä¸Šï¼Œå»ºè®®ç»„ç»‡ä¸MSPä¹‹é—´å­˜åœ¨ä¸€å¯¹ä¸€çš„æ˜ å°„ã€‚MSPå®šä¹‰äº†å“ªäº›æˆå‘˜æœ‰æƒä»£è¡¨ç»„ç»‡è¡Œäº‹ã€‚è¿™åŒ…æ‹¬MSPæœ¬èº«çš„é…ç½®ä»¥åŠæ‰¹å‡†ç»„ç»‡æ‰€æ‰®æ¼”çš„ç®¡ç†ä»»åŠ¡ï¼Œä¾‹å¦‚å°†æ–°æˆå‘˜æ·»åŠ åˆ°æ¸ é“ã€‚å¦‚æœæ‰€æœ‰ç½‘ç»œæˆå‘˜éƒ½æ˜¯å•ä¸ªç»„ç»‡æˆ–MSPçš„ä¸€éƒ¨åˆ†ï¼Œåˆ™ä¼šç‰ºç‰²æ•°æ®éšç§ã€‚å¤šä¸ªç»„ç»‡é€šè¿‡å°†è´¦æœ¬æ•°æ®ä»…éš”ç¦»åˆ°é€šé“æˆå‘˜æ¥ä¿ƒæˆéšç§ã€‚å¦‚æœåœ¨ç»„ç»‡å†…éœ€è¦æ›´å¤šçš„ç²’åº¦ï¼Œåˆ™å¯ä»¥å°†ç»„ç»‡è¿›ä¸€æ­¥åˆ’åˆ†ä¸ºç»„ç»‡å•ä½ï¼ˆOUï¼‰ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬ä¸»é¢˜çš„åé¢éƒ¨åˆ†å¯¹æ­¤è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚</p><p><strong>The system channel MSP includes the MSPs of all the organizations that participate in an ordering service.</strong> An ordering service will likely include ordering nodes from multiple organizations and collectively these organizations run the ordering service, most importantly managing the consortium of organizations and the default policies that are inherited by the application channels.</p><p>**ç³»ç»Ÿé€šé“MSPåŒ…æ‹¬åŠ å…¥æ’åºæœåŠ¡çš„æ‰€æœ‰ç»„ç»‡çš„MSPã€‚**æ’åºæœåŠ¡å¯èƒ½ä¼šåŒ…æ‹¬æ¥è‡ªå¤šä¸ªç»„ç»‡çš„æ’åºèŠ‚ç‚¹ï¼Œå¹¶ä¸”è¿™äº›ç»„ç»‡å…±åŒè¿è¡Œæ’åºæœåŠ¡ï¼Œæœ€é‡è¦çš„æ˜¯ç®¡ç†ç»„ç»‡è”ç›Ÿå’Œåº”ç”¨ç¨‹åºé€šé“ç»§æ‰¿çš„é»˜è®¤ç­–ç•¥ã€‚</p><p><strong>Local MSPs are only defined on the file system of the node or user</strong> to which they apply. Therefore, physically and logically there is only one local MSP per node. However, as channel MSPs are available to all nodes in the channel, they are logically defined once in the channel configuration. However, <strong>a channel MSP is also instantiated on the file system of every node in the channel and kept synchronized via consensus</strong>. So while there is a copy of each channel MSP on the local file system of every node, logically a channel MSP resides on and is maintained by the channel or the network.</p><p>**æœ¬åœ°MSPä»…åœ¨å®ƒä»¬åº”ç”¨åˆ°çš„èŠ‚ç‚¹æˆ–ç”¨æˆ·çš„æ–‡ä»¶ç³»ç»Ÿä¸Šå®šä¹‰ã€‚**å› æ­¤ï¼Œåœ¨ç‰©ç†ä¸Šå’Œé€»è¾‘ä¸Šæ¯ä¸ªèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªæœ¬åœ°MSPã€‚ä½†æ˜¯ï¼Œç”±äºé€šé“MSPå¯ç”¨äºé€šé“ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œå› æ­¤å®ƒä»¬åœ¨é€šé“é…ç½®ä¸­è¢«é€»è¾‘å®šä¹‰ä¸€æ¬¡ã€‚ä½†æ˜¯ï¼Œ<strong>é€šé“MSPä¹Ÿä¼šåœ¨è¯¥é€šé“ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„æ–‡ä»¶ç³»ç»Ÿä¸Šå®ä¾‹åŒ–ï¼Œå¹¶é€šè¿‡å…±è¯†ä¿æŒåŒæ­¥</strong>ã€‚å› æ­¤ï¼Œå°½ç®¡æ¯ä¸ªèŠ‚ç‚¹çš„æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸Šéƒ½æœ‰æ¯ä¸ªé€šé“MSPçš„å‰¯æœ¬ï¼Œä½†ä»é€»è¾‘ä¸Šè®²ï¼Œé€šé“MSPé©»ç•™åœ¨é€šé“æˆ–ç½‘ç»œä¸Šå¹¶ç”±é€šé“æˆ–ç½‘ç»œç»´æŠ¤ã€‚</p><p>The following diagram illustrates how local and channel MSPs coexist on the network:</p><p>ä¸‹å›¾è¯´æ˜äº†æœ¬åœ°å’Œé€šé“MSPåœ¨ç½‘ç»œä¸Šå¦‚ä½•å…±å­˜ï¼š</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/membership.diagram.2.png" alt="membership.diagram.2"></p><p><em>The MSPs for the peer and orderer are local, whereas the MSPs for a channel (including the network configuration channel, also known as the system channel) are global, shared across all participants of that channel. In this figure, the network system channel is administered by ORG1, but another application channel can be managed by ORG1 and ORG2. The peer is a member of and managed by ORG2, whereas ORG1 manages the orderer of the figure. ORG1 trusts identities from RCA1, whereas ORG2 trusts identities from RCA2. It is important to note that these are administration identities, reflecting who can administer these components. So while ORG1 administers the network, ORG2.MSP does exist in the network definition.</em></p><h2 id="What-role-does-an-organization-play-in-an-MSP-ï¼ˆç»„ç»‡åœ¨MSPä¸­æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Ÿï¼‰">What role does an organization play in an MSP?ï¼ˆç»„ç»‡åœ¨MSPä¸­æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Ÿï¼‰</h2><p>An <strong>organization</strong> is a logical managed group of members. This can be something as big as a multinational corporation or a small as a flower shop. Whatâ€™s most important about organizations (or <strong>orgs</strong>) is that they manage their members under a single MSP. The MSP allows an identity to be linked to an organization. Note that this is different from the organization concept defined in an X.509 certificate, which we mentioned above.</p><p>ç»„ç»‡æ˜¯æˆå‘˜çš„é€»è¾‘æ‰˜ç®¡ç»„ã€‚å®ƒå¯ä»¥åƒè·¨å›½å…¬å¸ä¸€æ ·å¤§ï¼Œä¹Ÿå¯ä»¥åƒèŠ±åº—ä¸€æ ·å°ã€‚å¯¹äºç»„ç»‡è€Œè¨€æœ€é‡è¦çš„æ˜¯ä»–ä»¬åœ¨å•ä¸ªMSPä¸‹ç®¡ç†æˆå‘˜ã€‚MSPå…è®¸å°†èº«ä»½é“¾æ¥åˆ°ç»„ç»‡ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸æˆ‘ä»¬ä¸Šé¢æåˆ°çš„X.509è¯ä¹¦ä¸­å®šä¹‰çš„ç»„ç»‡æ¦‚å¿µä¸åŒã€‚</p><p>The exclusive relationship between an organization and its MSP makes it sensible to name the MSP after the organization, a convention youâ€™ll find adopted in most policy configurations. For example, organization <code>ORG1</code> would likely have an MSP called something like <code>ORG1-MSP</code>. In some cases an organization may require multiple membership groups â€” for example, where channels are used to perform very different business functions between organizations. In these cases it makes sense to have multiple MSPs and name them accordingly, e.g., <code>ORG2-MSP-NATIONAL</code> and <code>ORG2-MSP-GOVERNMENT</code>, reflecting the different membership roots of trust within <code>ORG2</code> in the <code>NATIONAL</code> sales channel compared to the <code>GOVERNMENT</code> regulatory channel.</p><p>ç”±äºç»„ç»‡åŠå…¶MSPä¹‹é—´çš„æ’ä»–å…³ç³»ï¼Œå› æ­¤ç”¨ç»„ç»‡åç§°æ¥å‘½åMSPæ˜¯å¾ˆæ˜æ™ºçš„ï¼Œè¿™æ˜¯å¤§å¤šæ•°ç­–ç•¥é…ç½®ä¸­éƒ½ä¼šé‡‡ç”¨çš„çº¦å®šã€‚ä¾‹å¦‚ç»„ç»‡<code>ORG1</code> ä¼šæœ‰ä¸€ä¸ªåä¸º<code>ORG1-MSP</code>çš„MSPã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ç»„ç»‡å¯èƒ½éœ€è¦å¤šä¸ªæˆå‘˜ç»„ï¼›ä¾‹å¦‚ï¼Œåœ¨ç»„ç»‡ä¹‹é—´ä½¿ç”¨é€šé“æ‰§è¡Œéå¸¸ä¸åŒçš„ä¸šåŠ¡åŠŸèƒ½çš„æƒ…å†µã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ‹¥æœ‰å¤šä¸ªMSPå¹¶ç›¸åº”åœ°å‘½åå®ƒä»¬æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ï¼Œï¼Œä¾‹å¦‚<code>ORG2-MSP-NATIONAL</code>å’Œ<code>ORG2-MSP-GOVERNMENT</code>ï¼Œä½“ç°å‡º<code>ORG2</code>å†…éƒ¨åœ¨äº¤æ˜“é€šé“å’Œç›‘ç®¡é€šé“çš„ä¸¤ä¸ªä¸åŒçš„ä¿¡ä»»æ ¹æºã€‚</p><h3 id="Organizational-Units-OUs-and-MSPsï¼ˆç»„ç»‡å•ä½ï¼ˆOUï¼‰å’ŒMSPï¼‰">Organizational Units (OUs) and MSPsï¼ˆç»„ç»‡å•ä½ï¼ˆOUï¼‰å’ŒMSPï¼‰</h3><p>An organization can also be divided into multiple <strong>organizational units</strong>, each of which has a certain set of responsibilities, also referred to as <code>affiliations</code>. Think of an OU as a department inside an organization. For example, the <code>ORG1</code> organization might have both <code>ORG1.MANUFACTURING</code> and <code>ORG1.DISTRIBUTION</code> OUs to reflect these separate lines of business. When a CA issues X.509 certificates, the <code>OU</code> field in the certificate specifies the line of business to which the identity belongs. A benefit of using OUs like this is that these values can then be used in policy definitions in order to restrict access or in smart contracts for attribute-based access control. Otherwise, separate MSPs would need to be created for each organization.</p><p>ä¸€ä¸ªç»„ç»‡ä¹Ÿå¯ä»¥åˆ†ä¸ºå¤šä¸ªç»„ç»‡å•ä½ï¼Œæ¯ä¸ªç»„ç»‡å•ä½éƒ½æœ‰ä¸€å®šçš„èŒè´£é›†ï¼Œä¹Ÿç§°ä¸ºä»å±å…³ç³»ã€‚å°†OUè§†ä¸ºç»„ç»‡å†…éƒ¨çš„ä¸€ä¸ªéƒ¨é—¨ã€‚ä¾‹å¦‚ï¼Œ<code>ORG1</code>ç»„ç»‡å¯èƒ½åŒæ—¶å…·æœ‰<code>ORG1.MANUFACTURING</code>å’Œ<code>ORG1.DISTRIBUTION</code> ä¸¤ä¸ªç»„ç»‡å•ä½ï¼Œä»¥åæ˜ è¿™äº›å•ç‹¬çš„ä¸šåŠ¡çº¿ã€‚å½“CAé¢å‘X.509è¯ä¹¦æ—¶ï¼Œè¯ä¹¦ä¸­çš„<code>OU</code>å­—æ®µä¼šæŒ‡å®šèº«ä»½æ‰€å±çš„ä¸šåŠ¡èŒƒå›´ã€‚ä½¿ç”¨è¿™æ ·çš„OUçš„å¥½å¤„æ˜¯ï¼Œå¯å°†å…¶ç”¨äºç­–ç•¥å®šä¹‰ä¸­ä»¥é™åˆ¶è®¿é—®ï¼Œæˆ–ç”¨äºåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶çš„æ™ºèƒ½åˆçº¦ä¸­ã€‚å¦åˆ™ï¼Œå°†éœ€è¦ä¸ºæ¯ä¸ªç»„ç»‡åˆ›å»ºå•ç‹¬çš„MSPã€‚</p><p>Specifying OUs is optional. If OUs are not used, all of the identities that are part of an MSP â€” as identified by the Root CA and Intermediate CA folders â€” will be considered members of the organization.</p><p>æŒ‡å®šOUæ˜¯å¯é€‰çš„ã€‚å¦‚æœä¸ä½¿ç”¨OUï¼Œåˆ™MSPéƒ¨åˆ†çš„æ‰€æœ‰èº«ä»½ï¼ˆç”±æ ¹CAå’Œä¸­çº§CAæ–‡ä»¶å¤¹æ ‡è¯†ï¼‰å°†è¢«è§†ä¸ºç»„ç»‡çš„æˆå‘˜ã€‚</p><h3 id="Node-OU-Roles-and-MSPs">Node OU Roles and MSPs</h3><p>Additionally, there is a special kind of OU, sometimes referred to as a <code>Node OU</code>, that can be used to confer a role onto an identity. These Node OU roles are defined in the <code>$FABRIC_CFG_PATH/msp/config.yaml</code> file and contain a list of organizational units whose members are considered to be part of the organization represented by this MSP. This is particularly useful when you want to restrict the members of an organization to the ones holding an identity (signed by one of MSP designated CAs) with a specific Node OU role in it. For example, with node OUâ€™s you can implement a more granular endorsement policy that requires Org1 peers to endorse a transaction, rather than any member of Org1.</p><p>æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç§ç‰¹æ®Šçš„OUï¼Œæœ‰æ—¶ä¹Ÿç§°ä¸ºèŠ‚ç‚¹OUï¼Œå¯ç”¨äºå°†è§’è‰²èµ‹äºˆèº«ä»½ã€‚è¿™äº›èŠ‚ç‚¹OUè§’è‰²åœ¨<code>$FABRIC_CFG_PATH/msp/config.yaml</code>æ–‡ä»¶ä¸­å®šä¹‰ï¼Œå¹¶ä¸”åŒ…å«ä¸€ä¸ªç»„ç»‡å•ä½åˆ—è¡¨ï¼Œå…¶æˆå‘˜è¢«è§†ä¸ºæ­¤MSPä»£è¡¨çš„ç»„ç»‡çš„ä¸€éƒ¨åˆ†ã€‚å½“æ‚¨å¸Œæœ›å°†ç»„ç»‡çš„æˆå‘˜é™åˆ¶ä¸ºæŒæœ‰å…·æœ‰ç‰¹å®šNode OUè§’è‰²çš„èº«ä»½ï¼ˆç”±MSPæŒ‡å®šçš„CAä¹‹ä¸€ç­¾åï¼‰çš„æˆå‘˜æ—¶ï¼Œæ­¤åŠŸèƒ½ç‰¹åˆ«æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡èŠ‚ç‚¹OUï¼Œæ‚¨å¯ä»¥å®æ–½æ›´ç²¾ç»†çš„è®¤å¯æ”¿ç­–ï¼Œè¯¥æ”¿ç­–è¦æ±‚Org1peerè®¤å¯äº¤æ˜“ï¼Œè€Œä¸æ˜¯Org1çš„ä»»ä½•æˆå‘˜ã€‚</p><p>In order to use the Node OU roles, the â€œidentity classificationâ€ feature must be enabled for the network. When using the folder-based MSP structure, this is accomplished by enabling â€œNode OUsâ€ in the config.yaml file which resides in the root of the MSP folder:</p><p>ä¸ºäº†ä½¿ç”¨èŠ‚ç‚¹OUè§’è‰²ï¼Œå¿…é¡»ä¸ºç½‘ç»œå¯ç”¨â€œèº«ä»½åˆ†ç±»â€åŠŸèƒ½ã€‚å½“ä½¿ç”¨åŸºäºæ–‡ä»¶å¤¹çš„MSPç»“æ„æ—¶ï¼Œå¯é€šè¿‡å¯ç”¨ä½äºMSPæ–‡ä»¶å¤¹æ ¹ç›®å½•ä¸­çš„config.yamlæ–‡ä»¶ä¸­çš„ â€œNode OUsâ€æ¥å®ç°</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">NodeOUs:</span></span><br><span class="line">  <span class="attr">Enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">ClientOUIdentifier:</span></span><br><span class="line">    <span class="attr">Certificate:</span> <span class="string">cacerts/ca.sampleorg-cert.pem</span></span><br><span class="line">    <span class="attr">OrganizationalUnitIdentifier:</span> <span class="string">client</span></span><br><span class="line">  <span class="attr">PeerOUIdentifier:</span></span><br><span class="line">    <span class="attr">Certificate:</span> <span class="string">cacerts/ca.sampleorg-cert.pem</span></span><br><span class="line">    <span class="attr">OrganizationalUnitIdentifier:</span> <span class="string">peer</span></span><br><span class="line">  <span class="attr">AdminOUIdentifier:</span></span><br><span class="line">    <span class="attr">Certificate:</span> <span class="string">cacerts/ca.sampleorg-cert.pem</span></span><br><span class="line">    <span class="attr">OrganizationalUnitIdentifier:</span> <span class="string">admin</span></span><br><span class="line">  <span class="attr">OrdererOUIdentifier:</span></span><br><span class="line">    <span class="attr">Certificate:</span> <span class="string">cacerts/ca.sampleorg-cert.pem</span></span><br><span class="line">    <span class="attr">OrganizationalUnitIdentifier:</span> <span class="string">orderer</span></span><br></pre></td></tr></table></figure><p>In the example above, there are 4 possible Node OU <code>ROLES</code> for the MSP:</p><ul><li>client</li><li>peer</li><li>admin</li><li>orderer</li></ul><p>This convention allows you to distinguish MSP roles by the OU present in the CommonName attribute of the X509 certificate. The example above says that any certificate issued by cacerts/ca.sampleorg-cert.pem in which OU=client will identified as a client, OU=peer as a peer, etc. Starting with Fabric v1.4.3, there is also an OU for the orderer and for admins. The new admins role means that you no longer have to explicitly place certs in the admincerts folder of the MSP directory. Rather, the <code>admin</code> role present in the userâ€™s signcert qualifies the identity as an admin user.</p><p>æ­¤çº¦å®šå…è®¸æ‚¨é€šè¿‡X509è¯ä¹¦çš„CommonNameå±æ€§ä¸­å­˜åœ¨çš„OUåŒºåˆ†MSPè§’è‰²ã€‚ä¸Šé¢çš„ç¤ºä¾‹è¡¨æ˜ï¼Œç”±cacerts/ca.sampleorg-cert.pemé¢å‘çš„è¯ä¹¦ä¸­ï¼ŒOU=client å°†è¢«æ ‡è¯†ä¸ºå®¢æˆ·ç«¯ï¼ŒOU=peer å°†è¢«æ ‡è¯†ä¸ºpeerã€‚ä»Fabric v1.4.3å¼€å§‹ï¼Œæ’åºè€…å’Œç®¡ç†å‘˜ä¹Ÿæœ‰å¯¹åº”çš„OUã€‚æ–°çš„ç®¡ç†å‘˜è§’è‰²æ„å‘³ç€æ‚¨ä¸å†éœ€è¦å°†è¯ä¹¦æ˜ç¡®æ”¾ç½®åœ¨MSPç›®å½•çš„admincertsæ–‡ä»¶å¤¹ä¸­ï¼›è€Œæ˜¯ç”¨æˆ·ç­¾åè¯ä¹¦ä¸­çš„ç®¡ç†å‘˜è§’è‰²å¯ä»¥å°†èº«ä»½æ ‡è¯†ä¸ºç®¡ç†å‘˜ç”¨æˆ·ã€‚</p><p>These Role and OU attributes are assigned to an identity when the Fabric CA or SDK is used to <code>register</code> a user with the CA. It is the subsequent <code>enroll</code> user command that generates the certificates in the usersâ€™ <code>/msp</code> folder.</p><p>å½“ä½¿ç”¨Fabricçš„CAæˆ–SDKå‘CAæ³¨å†Œç”¨æˆ·æ—¶ï¼Œè¿™äº›è§’è‰²å’ŒOUå±æ€§å°†åˆ†é…ç»™ä¸€ä¸ªèº«ä»½ã€‚éšåä½¿ç”¨ç”¨æˆ·å‘½ä»¤<code>enroll</code> åœ¨ç”¨æˆ· <code>/msp</code> æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆè¯ä¹¦ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/ca-msp-visualization.png" alt="ca-msp-visualization"></p><p>The resulting ROLE and OU attributes are visible inside the X.509 signing certificate located in the <code>/signcerts</code> folder. The <code>ROLE</code> attribute is identified as <code>hf.Type</code> and refers to an actorâ€™s role within its organization, (specifying, for example, that an actor is a <code>peer</code>). See the following snippet from a signing certificate shows how the Roles and OUs are represented in the certificate.</p><p>ç”Ÿæˆçš„ROLEå’ŒOUå±æ€§åœ¨<code>/signcerts</code> æ–‡ä»¶å¤¹ä¸­çš„X.509ç­¾åè¯ä¹¦ä¸­å¯ä»¥çœ‹åˆ°ã€‚<code>ROLE</code>å±æ€§æ ‡è¯†ä¸º<code>hf.Type</code>ï¼Œæ˜¯æŒ‡å‚ä¸è€…åœ¨å…¶ç»„ç»‡ä¸­çš„è§’è‰²(ä¾‹å¦‚æŒ‡å®šæ˜¯ä¸€ä¸ª<code>peer</code>)ã€‚è¯·å‚é˜…ç­¾åè¯ä¹¦ä¸­çš„ä»¥ä¸‹ç‰‡æ®µï¼Œä»¥æ˜¾ç¤ºè§’è‰²å’ŒOUå¦‚ä½•åœ¨è¯ä¹¦ä¸­è¡¨ç¤ºã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/signcert.png" alt="signcert"></p><p><strong>Note:</strong> For Channel MSPs, just because an actor has the role of an administrator it doesnâ€™t mean that they can administer particular resources. The actual power a given identity has with respect to administering the system is determined by the <em>policies</em> that manage system resources. For example, a channel policy might specify that <code>ORG1-MANUFACTURING</code> administrators, meaning identities with a role of <code>admin</code> and a Node OU of <code>ORG1-MANUFACTURING</code>, have the rights to add new organizations to the channel, whereas the <code>ORG1-DISTRIBUTION</code> administrators have no such rights.</p><p>**æ³¨æ„ï¼š**å¯¹äºé€šé“MSPï¼Œä»…ä»…å› ä¸ºå‚ä¸è€…å…·æœ‰ç®¡ç†å‘˜è§’è‰²ï¼Œå¹¶ä¸æ„å‘³ç€ä»–ä»¬å¯ä»¥ç®¡ç†ç‰¹å®šèµ„æºã€‚ç»™å®šèº«ä»½åœ¨ç®¡ç†ç³»ç»Ÿæ–¹é¢çš„å®é™…èƒ½åŠ›ç”±ç®¡ç†ç³»ç»Ÿèµ„æºçš„ç­–ç•¥ç¡®å®šã€‚ä¾‹å¦‚ï¼Œæ¸ é“ç­–ç•¥å¯èƒ½æŒ‡å®š<code>ORG1-MANUFACTURING</code>ç®¡ç†å‘˜ï¼Œå³å…·æœ‰<code>admin</code>è§’è‰²å’Œ<code>ORG1-MANUFACTURING</code>çš„èŠ‚ç‚¹OUçš„èº«ä»½ï¼Œæœ‰æƒå‘é¢‘é“æ·»åŠ æ–°ç»„ç»‡ï¼Œè€Œ<code>ORG1-DISTRIBUTION</code>ç®¡ç†å‘˜åˆ™æ— æ­¤æƒåˆ©ã€‚</p><p>Finally, OUs could be used by different organizations in a consortium to distinguish each other. But in such cases, the different organizations have to use the same Root CAs and Intermediate CAs for their chain of trust, and assign the OU field to identify members of each organization. When every organization has the same CA or chain of trust, this makes the system more centralized than what might be desirable and therefore deserves careful consideration on a blockchain network.</p><p>æœ€åï¼Œè”ç›Ÿä¸­çš„ä¸åŒç»„ç»‡å¯ä»¥ä½¿ç”¨OUæ¥åŒºåˆ†å½¼æ­¤ã€‚ä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸åŒçš„ç»„ç»‡å¿…é¡»ä¸ºå®ƒä»¬çš„ä¿¡ä»»é“¾ä½¿ç”¨ç›¸åŒçš„æ ¹CAå’Œä¸­é—´CAï¼Œå¹¶åˆ†é…OUå­—æ®µä»¥æ ‡è¯†æ¯ä¸ªç»„ç»‡çš„æˆå‘˜ã€‚å½“æ¯ä¸ªç»„ç»‡éƒ½å…·æœ‰ç›¸åŒçš„CAæˆ–ä¿¡ä»»é“¾æ—¶ï¼Œè¿™ä¼šä½¿ç³»ç»Ÿæ¯”å¯èƒ½éœ€è¦çš„ç³»ç»Ÿæ›´åŠ é›†ä¸­ï¼Œå› æ­¤åœ¨åŒºå—é“¾ç½‘ç»œä¸Šå€¼å¾—ä»”ç»†è€ƒè™‘ã€‚</p><h2 id="MSP-Structure">MSP Structure</h2><p>Letâ€™s explore the MSP elements that render the functionality weâ€™ve described so far.</p><p>è®©æˆ‘ä»¬æ¢ç´¢MSPçš„å…ƒç´ å‘ˆç°æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢æ‰€æè¿°çš„åŠŸèƒ½ã€‚</p><p>A local MSP folder contains the following sub-folders:</p><p>æœ¬åœ°MSPæ–‡ä»¶å¤¹åŒ…å«ä»¥ä¸‹å­æ–‡ä»¶å¤¹ï¼š</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/membership.diagram.6.png" alt="membership.diagram.6"></p><p><em>The figure above shows the subfolders in a local MSP on the file system</em></p><p><em>ä¸Šå›¾æ˜¾ç¤ºäº†æ–‡ä»¶ç³»ç»Ÿä¸Šæœ¬åœ°MSPä¸­çš„å­æ–‡ä»¶å¤¹</em></p><ul><li><p><strong>config.yaml:</strong> Used to configure the identity classification feature in Fabric by enabling â€œNode OUsâ€ and defining the accepted roles.</p><p>ç”¨äºé€šè¿‡å¯ç”¨â€œNode OUsâ€å¹¶å®šä¹‰æ¥å—çš„è§’è‰²æ¥åœ¨Fabricä¸­é…ç½®èº«ä»½åˆ†ç±»åŠŸèƒ½ã€‚</p></li><li><p><strong>cacerts:</strong> This folder contains a list of self-signed X.509 certificates of the Root CAs trusted by the organization represented by this MSP. There must be at least one Root CA certificate in this MSP folder.</p><p>æ­¤æ–‡ä»¶å¤¹åŒ…å«ç”±æ­¤MSPä»£è¡¨çš„ç»„ç»‡ä¿¡ä»»çš„æ ¹CAçš„è‡ªç­¾åX.509è¯ä¹¦çš„åˆ—è¡¨ã€‚æ­¤MSPæ–‡ä»¶å¤¹ä¸­è‡³å°‘å¿…é¡»æœ‰ä¸€ä¸ªæ ¹CAè¯ä¹¦ã€‚</p><p>This is the most important folder because it identifies the CAs from which all other certificates must be derived to be considered members of the corresponding organization to form the chain of trust.</p><p>è¿™æ˜¯æœ€é‡è¦çš„æ–‡ä»¶å¤¹ï¼Œå®ƒæ ‡è¯†äº†å¿…é¡»ä»ä¸­å¯¼å‡ºæ‰€æœ‰å…¶ä»–è¯ä¹¦çš„CAï¼Œæ‰èƒ½å°†å…¶è§†ä¸ºç›¸åº”ç»„ç»‡çš„æˆå‘˜ä»¥å½¢æˆä¿¡ä»»é“¾ã€‚</p></li><li><p><strong>intermediatecerts:</strong> This folder contains a list of X.509 certificates of the Intermediate CAs trusted by this organization. Each certificate must be signed by one of the Root CAs in the MSP or by any Intermediate CA whose issuing CA chain ultimately leads back to a trusted Root CA.</p><p>æ­¤æ–‡ä»¶å¤¹åŒ…å«æ­¤ç»„ç»‡ä¿¡ä»»çš„ä¸­é—´CAçš„X.509è¯ä¹¦çš„åˆ—è¡¨ã€‚æ¯ä¸ªè¯ä¹¦å¿…é¡»ç”±MSPä¸­çš„ä¸€ä¸ªæ ¹CAç­¾åï¼Œæˆ–ç”±å…¶å‘è¡ŒCAé“¾æœ€ç»ˆå¼•å›åˆ°å—ä¿¡ä»»çš„æ ¹CAçš„ä»»ä½•ä¸­é—´CAã€‚</p><p>An intermediate CA may represent a different subdivision of the organization (like <code>ORG1-MANUFACTURING</code> and <code>ORG1-DISTRIBUTION</code> do for <code>ORG1</code>), or the organization itself (as may be the case if a commercial CA is leveraged for the organizationâ€™s identity management). In the latter case intermediate CAs can be used to represent organization subdivisions. <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/msp.html">Here</a> you may find more information on best practices for MSP configuration. Notice, that it is possible to have a functioning network that does not have an Intermediate CA, in which case this folder would be empty.</p><p>ä¸­é—´CAå¯èƒ½ä»£è¡¨ç»„ç»‡çš„ä¸åŒéƒ¨é—¨ï¼ˆä¾‹å¦‚<code>ORG1</code>çš„<code>ORG1-MANUFACTURING</code>å’Œ<code>ORG1-DISTRIBUTION</code>ï¼‰ï¼Œæˆ–è€…æ˜¯ç»„ç»‡æœ¬èº«ï¼ˆå¦‚æœåˆ©ç”¨å•†ä¸šCAæ¥è¿›è¡Œç»„ç»‡çš„èº«ä»½ç®¡ç†ï¼Œå¯èƒ½å°±æ˜¯è¿™ç§æƒ…å†µï¼‰ã€‚åœ¨åä¸€ç§æƒ…å†µä¸‹ï¼Œä¸­é—´CAå¯ä»¥ç”¨æ¥è¡¨ç¤ºç»„ç»‡ç»†åˆ†ã€‚è¯·æ³¨æ„ï¼Œä¸€ä¸ªæ­£å¸¸è¿è¡Œçš„ç½‘ç»œå¯èƒ½æ²¡æœ‰ä¸­é—´ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ­¤æ–‡ä»¶å¤¹å°†ä¸ºç©ºã€‚</p><p>Like the Root CA folder, this folder defines the CAs from which certificates must be issued to be considered members of the organization.</p><p>ä¸â€œæ ¹CAâ€æ–‡ä»¶å¤¹ç±»ä¼¼ï¼Œæ­¤æ–‡ä»¶å¤¹å®šä¹‰çš„è¯ä¹¦å¿…é¡»æ˜¯ç”±å½“å‰ç»„ç»‡çš„æˆå‘˜æ‰€é¢å‘çš„ã€‚</p></li><li><p><strong>admincerts (Deprecated from Fabric v1.4.3 and higher):</strong> This folder contains a list of identities that define the actors who have the role of administrators for this organization. In general, there should be one or more X.509 certificates in this list.</p><p>è¯¥æ–‡ä»¶å¤¹åŒ…å«ä¸€ä¸ªèº«ä»½åˆ—è¡¨ï¼Œè¿™äº›èº«ä»½å®šä¹‰äº†å“ªäº›å‚ä¸è€…å…·æœ‰è¯¥ç»„ç»‡çš„ç®¡ç†å‘˜è§’è‰²ã€‚é€šå¸¸ï¼Œæ­¤åˆ—è¡¨ä¸­åº”è¯¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªX.509è¯ä¹¦ã€‚</p><p><strong>Note:</strong> Prior to Fabric v1.4.3, admins were defined by explicitly putting certs in the <code>admincerts</code> folder in the local MSP directory of your peer. <strong>With Fabric v1.4.3 or higher, certificates in this folder are no longer required.</strong> Instead, it is recommended that when the user is registered with the CA, that the <code>admin</code> role is used to designate the node administrator. Then, the identity is recognized as an <code>admin</code> by the Node OU role value in their signcert. As a reminder, in order to leverage the admin role, the â€œidentity classificationâ€ feature must be enabled in the config.yaml above by setting â€œNode OUsâ€ to <code>Enable: true</code>. Weâ€™ll explore this more later.</p><p><strong>æ³¨æ„ï¼š</strong> åœ¨Fabric v1.4.3ä¹‹å‰ï¼Œé€šè¿‡æ˜¾å¼å°†è¯ä¹¦æ”¾å…¥peerçš„æœ¬åœ°MSPç›®å½•ä¸‹çš„<code>admincerts</code>æ–‡ä»¶å¤¹ä¸­æ¥å®šä¹‰ç®¡ç†å‘˜ã€‚å¯¹äºFabric v1.4.3æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œä¸å†éœ€è¦æ­¤æ–‡ä»¶å¤¹ä¸­çš„è¯ä¹¦ã€‚ç›¸åï¼Œå»ºè®®åœ¨å‘CAæ³¨å†Œç”¨æˆ·åï¼Œä½¿ç”¨adminè§’è‰²æŒ‡å®šèŠ‚ç‚¹ç®¡ç†å‘˜ã€‚ç„¶åé€šè¿‡å…¶ç­¾åè¯ä¹¦ä¸­çš„èŠ‚ç‚¹OUè§’è‰²å€¼å°†èº«ä»½è¯†åˆ«ä¸ºç®¡ç†å‘˜ã€‚æé†’ä¸€ä¸‹ï¼Œä¸ºäº†åˆ©ç”¨ç®¡ç†å‘˜è§’è‰²ï¼Œå¿…é¡»åœ¨ä¸Šé¢çš„config.yamlä¸­é€šè¿‡å°†â€œNode OUsâ€è®¾ç½®ä¸º<code>Enableï¼štrue</code>æ¥å¯ç”¨â€œèº«ä»½åˆ†ç±»â€åŠŸèƒ½ã€‚æˆ‘ä»¬å°†åœ¨ä»¥åè¿›è¡Œæ¢è®¨ã€‚</p><p>And as a reminder, for Channel MSPs, just because an actor has the role of an administrator it doesnâ€™t mean that they can administer particular resources. The actual power a given identity has with respect to administering the system is determined by the <em>policies</em> that manage system resources. For example, a channel policy might specify that <code>ORG1-MANUFACTURING</code> administrators have the rights to add new organizations to the channel, whereas the <code>ORG1-DISTRIBUTION</code> administrators have no such rights.</p><p>æé†’ä¸€ä¸‹ï¼Œå¯¹äºé€šé“MSPï¼Œä»…ä»…å› ä¸ºå‚ä¸è€…å…·æœ‰ç®¡ç†å‘˜è§’è‰²ï¼Œå¹¶ä¸æ„å‘³ç€ä»–ä»¬å¯ä»¥ç®¡ç†ç‰¹å®šèµ„æºã€‚ç»™å®šèº«ä»½åœ¨ç®¡ç†ç³»ç»Ÿæ–¹é¢çš„å®é™…èƒ½åŠ›ç”±ç®¡ç†ç³»ç»Ÿèµ„æºçš„ç­–ç•¥ç¡®å®šã€‚ä¾‹å¦‚ï¼Œé€šé“æ”¿ç­–å¯èƒ½æŒ‡å®š<code>ORG1-MANUFACTURING</code>ç®¡ç†å‘˜æœ‰æƒå‘è¯¥æ¸ é“æ·»åŠ æ–°ç»„ç»‡ï¼Œè€Œ<code>ORG1-DISTRIBUTION</code>ç®¡ç†å‘˜æ²¡æœ‰è¿™ç§æƒåˆ©ã€‚</p></li><li><p><strong>keystore: (private Key)</strong> This folder is defined for the local MSP of a peer or orderer node (or in a clientâ€™s local MSP), and contains the nodeâ€™s private key. This key is used to sign data â€” for example to sign a transaction proposal response, as part of the endorsement phase.</p><p>æ­¤æ–‡ä»¶å¤¹æ˜¯ä¸ºpeerèŠ‚ç‚¹æˆ–ordererèŠ‚ç‚¹çš„æœ¬åœ°MSPï¼ˆæˆ–åœ¨å®¢æˆ·ç«¯çš„æœ¬åœ°MSPä¸­ï¼‰å®šä¹‰çš„ï¼Œå®ƒåŒ…å«èŠ‚ç‚¹çš„ç§é’¥ã€‚è¿™ä¸ªç§é’¥ç”¨äºç­¾åæ•°æ® - ä¾‹å¦‚åœ¨èƒŒä¹¦é˜¶æ®µç­¾ç½²äº¤æ˜“å»ºè®®å“åº”ã€‚</p><p>This folder is mandatory for local MSPs, and must contain exactly one private key. Obviously, access to this folder must be limited only to the identities of users who have administrative responsibility on the peer.</p><p>å¯¹äºæœ¬åœ°MSPï¼Œæ­¤æ–‡ä»¶å¤¹æ˜¯å¿…éœ€çš„ï¼Œå¹¶ä¸”å¿…é¡»ä»…åŒ…å«ä¸€ä¸ªç§é’¥ã€‚æ˜¾ç„¶ï¼Œå¯¹æ­¤æ–‡ä»¶å¤¹çš„è®¿é—®å¿…é¡»ä»…é™äºå¯¹peerå…·æœ‰ç®¡ç†è´£ä»»çš„ç”¨æˆ·çš„èº«ä»½ã€‚</p><p>The <strong>channel MSP</strong> configuration does not include this folder, because channel MSPs solely aim to offer identity validation functionalities and not signing abilities.</p><p>é€šé“MSPé…ç½®ä¸åŒ…æ‹¬æ­¤æ–‡ä»¶å¤¹ï¼Œå› ä¸ºé€šé“MSPä»…æ—¨åœ¨æä¾›èº«ä»½éªŒè¯åŠŸèƒ½è€Œä¸æ˜¯ç­¾ååŠŸèƒ½ã€‚</p><p><strong>Note:</strong> If you are using a <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/hsm.html">Hardware Security Module(HSM)</a> for key management, this folder is empty because the private key is generated by and stored in the HSM.</p><p><strong>æ³¨æ„ï¼š</strong> å¦‚æœä½ ä½¿ç”¨<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/hsm.html">ç¡¬ä»¶çº§åˆ«çš„å®‰å…¨æ¨¡å—(HSM)</a> æ¥ç®¡ç†keyï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹æ˜¯ç©ºçš„å› ä¸ºç§é’¥å·²ç»è¢«ç”Ÿæˆå¹¶å­˜å‚¨åœ¨HSMã€‚</p></li><li><p><strong>signcert:</strong> For a peer or orderer node (or in a clientâ€™s local MSP) this folder contains the nodeâ€™s certificate issued by CA. The certificate represents the nodeâ€™s identity, and this certificateâ€™s corresponding <strong>private key</strong> can be used to generate signatures which may be verified by anyone with a copy of this certificate.</p><p>å¯¹äºpeerèŠ‚ç‚¹orderedèŠ‚ç‚¹ï¼ˆæˆ–åœ¨å®¢æˆ·ç«¯çš„æœ¬åœ°MSPä¸­ï¼‰ï¼Œæ­¤æ–‡ä»¶å¤¹åŒ…å«CAé¢å‘çš„èŠ‚ç‚¹çš„è¯ä¹¦ã€‚è¯¥è¯ä¹¦ä»£è¡¨èŠ‚ç‚¹çš„èº«ä»½ï¼Œå¹¶ä¸”è¯¥è¯ä¹¦çš„ç›¸åº”ç§é’¥å¯ç”¨äºç”Ÿæˆç­¾åï¼Œä»»ä½•æ‹¥æœ‰æ­¤è¯ä¹¦å‰¯æœ¬çš„äººéƒ½å¯ä»¥å¯¹å…¶è¿›è¡ŒéªŒè¯ã€‚</p><p>This folder is mandatory for local MSPs, and must contain exactly one <strong>public key</strong>. Obviously, access to this folder must be limited only to the identities of users who have administrative responsibility on the peer.</p><p>æ­¤æ–‡ä»¶å¤¹å¯¹äºæœ¬åœ°MSPæ˜¯å¿…éœ€çš„ï¼Œå¹¶ä¸”å¿…é¡»ä»…åŒ…å«ä¸€ä¸ªå…¬å…±å¯†é’¥ã€‚æ˜¾ç„¶ï¼Œå¯¹æ­¤æ–‡ä»¶å¤¹çš„è®¿é—®å¿…é¡»ä»…é™äºå¯¹peerå…·æœ‰ç®¡ç†è´£ä»»çš„ç”¨æˆ·çš„èº«ä»½ã€‚</p><p>Configuration of a <strong>channel MSP</strong> does not include this folder, as channel MSPs solely aim to offer identity validation functionalities and not signing abilities.</p><p>é€šé“MSPçš„é…ç½®ä¸åŒ…æ‹¬æ­¤æ–‡ä»¶å¤¹ï¼Œå› ä¸ºé€šé“MSPä»…æ—¨åœ¨æä¾›èº«ä»½éªŒè¯åŠŸèƒ½è€Œä¸æ˜¯ç­¾ååŠŸèƒ½ã€‚</p></li><li><p><strong>tlscacerts:</strong> This folder contains a list of self-signed X.509 certificates of the Root CAs trusted by this organization <strong>for secure communications between nodes using TLS</strong>. An example of a TLS communication would be when a peer needs to connect to an orderer so that it can receive ledger updates.</p><p>æ­¤æ–‡ä»¶å¤¹åŒ…å«æ­¤ç»„ç»‡ä¿¡ä»»çš„æ ¹CAçš„è‡ªç­¾åX.509è¯ä¹¦åˆ—è¡¨ï¼Œä»¥ä½¿ç”¨TLSåœ¨èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œå®‰å…¨é€šä¿¡ã€‚TLSé€šä¿¡çš„ä¸€ä¸ªç¤ºä¾‹æ˜¯peeréœ€è¦è¿æ¥åˆ°orderedä»¥ä¾¿æ¥æ”¶è´¦æœ¬æ›´æ–°ã€‚</p><p>MSP TLS information relates to the nodes inside the network â€” the peers and the orderers, in other words, rather than the applications and administrations that consume the network.</p><p>MSP TLSä¿¡æ¯ä¸ç½‘ç»œå†…éƒ¨çš„èŠ‚ç‚¹æœ‰å…³ï¼ˆpeerså’Œorderersï¼‰ï¼Œæ¢å¥è¯è¯´ï¼Œè€Œä¸æ˜¯æ¶ˆè€—ç½‘ç»œçš„åº”ç”¨ç¨‹åºå’Œç®¡ç†ã€‚</p><p>There must be at least one TLS Root CA certificate in this folder. For more information about TLS, see <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/enable_tls.html">Securing Communication with Transport Layer Security (TLS)</a>.</p><p>æ­¤æ–‡ä»¶å¤¹ä¸­è‡³å°‘å¿…é¡»æœ‰ä¸€ä¸ªTLSæ ¹CAè¯ä¹¦ï¼Œ æœ‰å…³TLSçš„æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/enable_tls.html">Securing Communication with Transport Layer Security (TLS)</a>ã€‚</p></li><li><p><strong>tlsintermediatecacerts:</strong> This folder contains a list intermediate CA certificates CAs trusted by the organization represented by this MSP <strong>for secure communications between nodes using TLS</strong>. This folder is specifically useful when commercial CAs are used for TLS certificates of an organization. Similar to membership intermediate CAs, specifying intermediate TLS CAs is optional.</p><p>æ­¤æ–‡ä»¶å¤¹åŒ…å«æ­¤MSPä»£è¡¨çš„ç»„ç»‡ä¿¡ä»»çš„ä¸­é—´CAè¯ä¹¦CAåˆ—è¡¨ï¼Œ<strong>ç”¨äºä½¿ç”¨TLSçš„èŠ‚ç‚¹ä¹‹é—´çš„å®‰å…¨é€šä¿¡</strong>ã€‚å½“ç»„ç»‡ä½¿ç”¨å•†ä¸šCAä½œä¸ºTLSè¯ä¹¦æ—¶ï¼Œæ­¤æ–‡ä»¶å¤¹ç‰¹åˆ«æœ‰ç”¨ã€‚ä¸æˆå‘˜èµ„æ ¼ä¸­é—´CAç›¸ä¼¼ï¼ŒæŒ‡å®šä¸­é—´TLS CAæ˜¯å¯é€‰çš„ã€‚</p></li><li><p><strong>operationscerts:</strong> This folder contains the certificates required to communicate with the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/operations_service.html">Fabric Operations Service</a> API.</p><p>è¯¥æ–‡ä»¶å¤¹åŒ…å«ä¸ <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/operations_service.html">Fabric Operations Service</a> APIé€šä¿¡æ‰€éœ€çš„è¯ä¹¦ã€‚</p></li></ul><p>A channel MSP includes the following additional folder:</p><p>é€šé“MSPåŒ…æ‹¬ä»¥ä¸‹é¢å¤–çš„æ–‡ä»¶å¤¹ï¼š</p><ul><li><p><strong>Revoked Certificates:</strong> If the identity of an actor has been revoked, identifying information about the identity â€” not the identity itself â€” is held in this folder. For X.509-based identities, these identifiers are pairs of strings known as Subject Key Identifier (SKI) and Authority Access Identifier (AKI), and are checked whenever the certificate is being used to make sure the certificate has not been revoked.</p><p>å¦‚æœå‚ä¸è€…çš„èº«ä»½å·²è¢«æ’¤é”€ï¼Œåˆ™æœ‰å…³è¯¥èº«ä»½çš„è¯†åˆ«ä¿¡æ¯ï¼ˆè€Œä¸æ˜¯èº«ä»½æœ¬èº«ï¼‰å°†ä¿å­˜åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­ã€‚å¯¹äºåŸºäºX.509çš„èº«ä»½ï¼Œè¿™äº›æ ‡è¯†ç¬¦æ˜¯ç§°ä¸ºSubject Key Identifierï¼ˆSKIï¼‰å’Œæˆæƒè®¿é—®æ ‡è¯†ç¬¦ï¼ˆAKIï¼‰çš„å­—ç¬¦ä¸²å¯¹ï¼Œå¹¶åœ¨ä½¿ç”¨è¯ä¹¦æ—¶è¿›è¡Œæ£€æŸ¥ï¼Œä»¥ç¡®ä¿è¯ä¹¦æœªè¢«åŠé”€ã€‚</p><p>This list is conceptually the same as a CAâ€™s Certificate Revocation List (CRL), but it also relates to revocation of membership from the organization. As a result, the administrator of a channel MSP can quickly revoke an actor or node from an organization by advertising the updated CRL of the CA. This â€œlist of listsâ€ is optional. It will only become populated as certificates are revoked.</p><p>æ­¤åˆ—è¡¨åœ¨æ¦‚å¿µä¸Šä¸CAçš„è¯ä¹¦åŠé”€åˆ—è¡¨ï¼ˆCRLï¼‰ç›¸åŒï¼Œä½†ä¹Ÿä¸ç»„ç»‡çš„æˆå‘˜èµ„æ ¼åŠé”€æœ‰å…³ã€‚ç»“æœï¼Œé€šé“MSPçš„ç®¡ç†å‘˜å¯ä»¥é€šè¿‡å‘å¸ƒCAçš„æ›´æ–°çš„CRLæ¥å¿«é€Ÿä»ç»„ç»‡æ’¤æ¶ˆå‚ä¸è€…æˆ–èŠ‚ç‚¹ã€‚æ­¤â€œåˆ—è¡¨â€æ˜¯å¯é€‰çš„ã€‚ä»…å½“è¯ä¹¦è¢«åŠé”€æ—¶ï¼Œå®ƒæ‰ä¼šè¢«å¡«å……ã€‚</p></li></ul><p>If youâ€™ve read this doc as well as our doc on <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/identity/identity.html">Identity</a>, you should now have a pretty good grasp of how identities and MSPs work in Hyperledger Fabric. Youâ€™ve seen how a PKI and MSPs are used to identify the actors collaborating in a blockchain network. Youâ€™ve learned how certificates, public/private keys, and roots of trust work, in addition to how MSPs are physically and logically structured.</p><p>å¦‚æœä½ å·²ç»é˜…è¯»è¿‡æˆ‘ä»¬çš„<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/identity/identity.html">Identity</a>æ–‡æ¡£ï¼Œæ‚¨ç°åœ¨åº”è¯¥å¯¹èº«ä»½å’ŒMSPåœ¨Hyperledger Fabricä¸­çš„å·¥ä½œæ–¹å¼æœ‰äº†å¾ˆå¥½çš„äº†è§£ã€‚æ‚¨å·²ç»äº†è§£äº†å¦‚ä½•ä½¿ç”¨PKIå’ŒMSPæ¥è¯†åˆ«åœ¨åŒºå—é“¾ç½‘ç»œä¸­è¿›è¡Œåä½œçš„å‚ä¸è€…ã€‚æ‚¨å·²ç»äº†è§£äº†è¯ä¹¦ã€å…¬é’¥/ç§é’¥å’Œä¿¡ä»»æ ¹çš„å·¥ä½œåŸç†ï¼Œä»¥åŠMSPçš„ç‰©ç†å’Œé€»è¾‘ç»“æ„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> Key Concepts </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> MSP </tag>
            
            <tag> Membership Service Provider </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hyperledger-Fabricæ¨¡å‹</title>
      <link href="2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Hyperledger-Fabric%E6%A8%A1%E5%9E%8B/"/>
      <url>2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Hyperledger-Fabric%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="Hyperledger-Fabricæ¨¡å‹">Hyperledger-Fabricæ¨¡å‹</h1><p>This section outlines the key design features woven into Hyperledger Fabric that fulfill its promise of a comprehensive, yet customizable, enterprise blockchain solution:</p><p>æœ¬èŠ‚æ¦‚è¿°äº†ç¼–ç»‡åˆ°Hyperledger Fabricä¸­çš„å…³é”®è®¾è®¡åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½å®ç°äº†å…¶å…¨é¢ï¼Œå¯å®šåˆ¶çš„ä¼ä¸šåŒºå—é“¾è§£å†³æ–¹æ¡ˆçš„æ‰¿è¯ºï¼š</p><ul><li><p><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/fabric_model.html#assets">Assets</a> â€” Asset definitions enable the exchange of almost anything with monetary value over the network, from whole foods to antique cars to currency futures.</p><p>èµ„äº§å®šä¹‰äº†å…è®¸é€šè¿‡ç½‘ç»œäº¤æ¢çš„å‡ ä¹æ‰€æœ‰å…·æœ‰è´§å¸ä»·å€¼çš„ä¸œè¥¿ï¼Œä»é£Ÿå“åˆ°å¤è‘£è½¦å†åˆ°è´§å¸æœŸè´§ã€‚</p></li><li><p><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/fabric_model.html#chaincode">Chaincode</a> â€” Chaincode execution is partitioned from transaction ordering, limiting the required levels of trust and verification across node types, and optimizing network scalability and performance.</p><p>é“¾ç æ‰§è¡Œä»äº¤æ˜“é¡ºåºä¸­åˆ’åˆ†å‡ºæ¥ï¼Œä»è€Œé™åˆ¶äº†è·¨èŠ‚ç‚¹ç±»å‹æ‰€éœ€çš„ä¿¡ä»»å’ŒéªŒè¯çº§åˆ«ï¼Œå¹¶ä¼˜åŒ–ç½‘ç»œå¯ä¼¸ç¼©å’Œæ€§èƒ½ã€‚</p></li><li><p><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/fabric_model.html#ledger-features">Ledger Features</a> â€” The immutable, shared ledger encodes the entire transaction history for each channel, and includes SQL-like query capability for efficient auditing and dispute resolution.</p><p>ä¸å˜çš„ï¼Œå…±äº«çš„è´¦æœ¬å¯¹æ¯ä¸ªé€šé“çš„æ•´ä¸ªäº¤æ˜“å†å²è¿›è¡Œç¼–ç ï¼Œå¹¶åŒ…æ‹¬ç±»ä¼¼SQLçš„æŸ¥è¯¢åŠŸèƒ½ï¼Œä»¥è¿›è¡Œæœ‰æ•ˆçš„å®¡è®¡å’Œäº‰è®®è§£å†³ã€‚</p></li><li><p><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/fabric_model.html#privacy">Privacy</a> â€” Channels and private data collections enable private and confidential multi-lateral transactions that are usually required by competing businesses and regulated industries that exchange assets on a common network.</p><p>é€šé“å’Œéšç§æ•°æ®æ”¶é›†å¯å®ç°ç§äººå’Œæœºå¯†çš„å¤šè¾¹äº¤æ˜“ï¼Œé€šå¸¸æ˜¯åœ¨ç«äº‰ä¼ä¸šå’Œå—ç®¡åˆ¶çš„è¡Œä¸šï¼ˆåœ¨åŒä¸€ç½‘ç»œä¸Šäº¤æ¢èµ„äº§ï¼‰æ‰€éœ€è¦ã€‚</p></li><li><p><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/fabric_model.html#security-membership-services">Security &amp; Membership Services</a> â€” Permissioned membership provides a trusted blockchain network, where participants know that all transactions can be detected and traced by authorized regulators and auditors.</p><p>è·å¾—è®¸å¯çš„æˆå‘˜èµ„æ ¼æä¾›äº†ä¸€ä¸ªå—ä¿¡ä»»çš„åŒºå—é“¾ç½‘ç»œï¼Œå‚ä¸è€…çŸ¥é“æ‰€æœ‰äº¤æ˜“éƒ½å¯ä»¥ç”±æˆæƒçš„ç›‘ç®¡æœºæ„å’Œå®¡è®¡å¸ˆæ£€æµ‹å’Œè¿½è¸ªã€‚</p></li><li><p><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/fabric_model.html#consensus">Consensus</a> â€” A unique approach to consensus enables the flexibility and scalability needed for the enterprise.</p><p>ä¸€ç§å”¯ä¸€çš„å…±è¯†æ–¹æ³•å¯ä»¥å®ç°ä¼ä¸šæ‰€éœ€çš„çµæ´»æ€§å’Œå¯ä¼¸ç¼©æ€§ã€‚</p></li></ul><h2 id="Assets">Assets</h2><p>Assets can range from the tangible (real estate and hardware) to the intangible (contracts and intellectual property). Hyperledger Fabric provides the ability to modify assets using chaincode transactions.</p><p>èµ„äº§èŒƒå›´ä»æœ‰å½¢èµ„äº§ï¼ˆæˆ¿åœ°äº§å’Œç¡¬ä»¶ï¼‰åˆ°æ— å½¢èµ„äº§ï¼ˆåˆåŒå’ŒçŸ¥è¯†äº§æƒï¼‰ã€‚Hyperledger Fabricæä¾›äº†ä½¿ç”¨é“¾ç äº¤æ˜“ä¿®æ”¹èµ„äº§çš„åŠŸèƒ½ã€‚</p><p>Assets are represented in Hyperledger Fabric as a collection of key-value pairs, with state changes recorded as transactions on a <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/glossary.html#channel">Channel</a> ledger. Assets can be represented in binary and/or JSON form.</p><p>èµ„äº§åœ¨Hyperledger Fabricä¸­è¡¨ç¤ºä¸ºé”®å€¼å¯¹çš„é›†åˆï¼ŒçŠ¶æ€æ›´æ”¹è®°å½•ä¸ºé€šé“è´¦æœ¬ä¸­çš„äº¤æ˜“ã€‚èµ„äº§å¯ä»¥äºŒè¿›åˆ¶å’Œ/æˆ–JSONå½¢å¼è¡¨ç¤ºã€‚</p><h2 id="Chaincode">Chaincode</h2><p>Chaincode is software defining an asset or assets, and the transaction instructions for modifying the asset(s); in other words, itâ€™s the business logic. Chaincode enforces the rules for reading or altering key-value pairs or other state database information. Chaincode functions execute against the ledgerâ€™s current state database and are initiated through a transaction proposal. Chaincode execution results in a set of key-value writes (write set) that can be submitted to the network and applied to the ledger on all peers.</p><p>é“¾ç æ˜¯å®šä¹‰äº†ä¸€ä¸ªæˆ–å¤šä¸ªèµ„äº§çš„è½¯ä»¶ï¼Œä»¥åŠç”¨äºä¿®æ”¹èµ„äº§çš„äº¤æ˜“æŒ‡ä»¤ï¼›Chaincodeå¼ºåˆ¶æ‰§è¡Œç”¨äºè¯»å–æˆ–æ›´æ”¹é”®å€¼å¯¹æˆ–å…¶ä»–çŠ¶æ€æ•°æ®åº“ä¿¡æ¯çš„è§„åˆ™ã€‚é“¾ç åŠŸèƒ½é’ˆå¯¹è´¦æœ¬çš„å½“å‰çŠ¶æ€æ•°æ®åº“æ‰§è¡Œï¼Œå¹¶é€šè¿‡äº¤æ˜“æè®®å¯åŠ¨ã€‚é“¾ç æ‰§è¡Œäº§ç”Ÿçš„ä¸€ç»„é”®å€¼å†™æ“ä½œï¼ˆå†™é›†ï¼‰ï¼Œè¿™äº›é”®å€¼å†™æ“ä½œå¯ä»¥æäº¤ç»™ç½‘ç»œï¼Œå¹¶åº”ç”¨äºæ‰€æœ‰peerçš„è´¦æœ¬ä¸­ã€‚</p><h2 id="Ledger-Features">Ledger Features</h2><p>The ledger is the sequenced, tamper-resistant record of all state transitions in the fabric. State transitions are a result of chaincode invocations (â€˜transactionsâ€™) submitted by participating parties. Each transaction results in a set of asset key-value pairs that are committed to the ledger as creates, updates, or deletes.</p><p>è´¦æœ¬æ˜¯Fabricä¸­æ‰€æœ‰æœ‰åºçš„ã€é˜²ç¯¡æ”¹çš„çŠ¶æ€è½¬æ¢ã€‚çŠ¶æ€è½¬æ¢æ˜¯å‚ä¸æ–¹æäº¤çš„é“¾ç è°ƒç”¨ï¼ˆâ€œäº¤æ˜“â€ï¼‰çš„ç»“æœã€‚æ¯ä¸ªäº¤æ˜“éƒ½ä¼šäº§ç”Ÿä¸€ç»„èµ„äº§é”®å€¼å¯¹ï¼Œè¿™äº›é”®å€¼å¯¹ä¼šåœ¨åˆ›å»ºï¼Œæ›´æ–°æˆ–åˆ é™¤æ—¶æäº¤åˆ°è´¦æœ¬ä¸­ã€‚</p><p>The ledger is comprised of a blockchain (â€˜chainâ€™) to store the immutable, sequenced record in blocks, as well as a state database to maintain current fabric state. There is one ledger per channel. Each peer maintains a copy of the ledger for each channel of which they are a member.</p><p>è´¦æœ¬ç”±åŒºå—é“¾ç»„æˆï¼Œä»¥åŒºå—å½¢å¼å­˜å‚¨ä¸å¯å˜çš„ã€æœ‰åºçš„è®°å½•ï¼Œä»¥åŠç”¨äºç»´æŠ¤å½“å‰ç»“æ„çŠ¶æ€çš„çŠ¶æ€æ•°æ®åº“ã€‚æ¯ä¸ªé€šé“æœ‰ä¸€ä¸ªè´¦æœ¬ã€‚æ¯ä¸ªpeeréƒ½ä¸ºå…¶æ‰€å±çš„æ¯ä¸ªé€šé“ç»´æŠ¤ä¸€ä¸ªè´¦æœ¬çš„å‰¯æœ¬ã€‚</p><p>Some features of a Fabric ledgerï¼ˆFabricè´¦æœ¬çš„ä¸€äº›åŠŸèƒ½ï¼‰:</p><ul><li><p>Query and update ledger using key-based lookups, range queries, and composite key queries</p><p>ä½¿ç”¨åŸºäºé”®çš„æŸ¥æ‰¾ï¼ŒèŒƒå›´æŸ¥è¯¢å’Œç»„åˆé”®æŸ¥è¯¢æ¥æŸ¥è¯¢å’Œæ›´æ–°åˆ†ç±»å¸</p></li><li><p>Read-only queries using a rich query language (if using CouchDB as state database)</p><p>ä½¿ç”¨ä¸°å¯ŒæŸ¥è¯¢è¯­è¨€çš„åªè¯»æŸ¥è¯¢ï¼ˆå¦‚æœä½¿ç”¨CouchDBä½œä¸ºçŠ¶æ€æ•°æ®åº“ï¼‰</p></li><li><p>Read-only history queries â€” Query ledger history for a key, enabling data provenance scenarios</p><p>åªè¯»å†å²è®°å½•æŸ¥è¯¢â€”ä¸ºä¸€ä¸ªkeyæŸ¥è¯¢å²è®°å½•ï¼Œä»è€Œå¯ç”¨æ•°æ®å‡ºå¤„åœºæ™¯</p></li><li><p>Transactions consist of the versions of keys/values that were read in chaincode (read set) and keys/values that were written in chaincode (write set)</p><p>äº¤æ˜“ç”±é“¾ç ä¸­è¯»å–çš„é”®/å€¼çš„ç‰ˆæœ¬ (è¯»å–é›†)å’Œç”¨é“¾ç ç¼–å†™çš„é”®/å€¼ï¼ˆå†™å…¥é›†ï¼‰æ‰€ç»„æˆã€‚</p></li><li><p>Transactions contain signatures of every endorsing peer and are submitted to ordering service</p><p>äº¤æ˜“åŒ…å«æ¯ä¸ªèƒŒä¹¦peerçš„ç­¾åï¼Œå¹¶æäº¤ç»™æ’åºæœåŠ¡</p></li><li><p>Transactions are ordered into blocks and are â€œdeliveredâ€ from an ordering service to peers on a channel</p><p>äº¤æ˜“è¢«æ’åºå¹¶æ‰“åŒ…æˆåŒºå—ï¼Œå¹¶ä»æ’åºæœåŠ¡â€œäº¤ä»˜â€åˆ°é€šé“ä¸Šçš„peerèŠ‚ç‚¹</p></li><li><p>Peers validate transactions against endorsement policies and enforce the policies</p><p>Peeræ ¹æ®èƒŒä¹¦ç­–ç•¥éªŒè¯äº¤æ˜“å¹¶æ‰§è¡Œæ”¿ç­–</p></li><li><p>Prior to appending a block, a versioning check is performed to ensure that states for assets that were read have not changed since chaincode execution time</p><p>åœ¨è¿½åŠ åŒºå—ä¹‹å‰ï¼Œæ‰§è¡Œç‰ˆæœ¬æ£€æŸ¥ï¼Œä»¥ç¡®ä¿è‡ªé“¾ç æ‰§è¡Œä»¥æ¥ï¼Œå·²è¯»å–èµ„äº§çš„çŠ¶æ€æœªå‘ç”Ÿå˜åŒ–</p></li><li><p>There is immutability once a transaction is validated and committed</p><p>äº¤æ˜“ä¸€æ—¦ç»è¿‡éªŒè¯å¹¶æäº¤ï¼Œä¾¿å…·æœ‰ä¸å˜æ€§</p></li><li><p>A channelâ€™s ledger contains a configuration block defining policies, access control lists, and other pertinent information</p><p>é€šé“çš„è´¦æœ¬åŒ…å«ä¸€ä¸ªé…ç½®å—ï¼Œç”¨äºå®šä¹‰ç­–ç•¥ã€è®¿é—®æ§åˆ¶åˆ—è¡¨å’Œå…¶ä»–ç›¸å…³ä¿¡æ¯</p></li><li><p>Channels contain <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/glossary.html#msp">Membership Service Provider</a> instances allowing for crypto materials to be derived from different certificate authorities</p><p>é€šé“åŒ…å«MSPå®ä¾‹ï¼Œå…è®¸ä»ä¸åŒçš„è¯ä¹¦é¢å‘æœºæ„ç”ŸæˆåŠ å¯†ææ–™</p></li></ul><p>See the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/ledger.html">Ledger</a> topic for a deeper dive on the databases, storage structure, and â€œquery-ability.â€</p><p>æœ‰å…³æ•°æ®åº“ï¼Œå­˜å‚¨ç»“æ„å’Œâ€œæŸ¥è¯¢èƒ½åŠ›â€çš„æ›´æ·±å…¥äº†è§£ï¼Œè¯·å‚é˜…<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/ledger.html">è´¦æœ¬</a>ä¸»é¢˜ã€‚</p><h2 id="Privacy">Privacy</h2><p>Hyperledger Fabric employs an immutable ledger on a per-channel basis, as well as chaincode that can manipulate and modify the current state of assets (i.e. update key-value pairs). A ledger exists in the scope of a channel â€” it can be shared across the entire network (assuming every participant is operating on one common channel) â€” or it can be privatized to include only a specific set of participants.</p><p>Hyperledger Fabricåœ¨æ¯ä¸ªé€šé“çš„åŸºç¡€ä¸Šä½¿ç”¨ä¸å˜çš„è´¦æœ¬ï¼Œä»¥åŠå¯ä»¥æ“çºµå’Œä¿®æ”¹èµ„äº§å½“å‰çŠ¶æ€çš„é“¾ç ã€‚è´¦æœ¬å­˜åœ¨äºé€šé“èŒƒå›´å†…-å¯ä»¥åœ¨æ•´ä¸ªç½‘ç»œä¸­å…±äº«ï¼ˆå‡è®¾æ¯ä¸ªå‚ä¸è€…éƒ½åœ¨ä¸€ä¸ªå…¬å…±é¢‘é“ä¸Šè¿›è¡Œæ“ä½œï¼‰ä¹Ÿå¯ä»¥ä»…åŒ…æ‹¬ä¸€ç»„ç‰¹å®šçš„å‚ä¸è€…ä»¥å°†å…¶ç§æœ‰åŒ–ã€‚</p><p>In the latter scenario, these participants would create a separate channel and thereby isolate/segregate their transactions and ledger. In order to solve scenarios that want to bridge the gap between total transparency and privacy, chaincode can be installed only on peers that need to access the asset states to perform reads and writes (in other words, if a chaincode is not installed on a peer, it will not be able to properly interface with the ledger).</p><p>åœ¨åä¸€ç§æƒ…å†µä¸‹ï¼Œè¿™äº›å‚ä¸è€…å°†åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„é€šé“ï¼Œä»è€Œéš”ç¦»/åˆ†ç¦»ä»–ä»¬çš„äº¤æ˜“å’Œè´¦æœ¬ã€‚ä¸ºäº†è§£å†³æ€»ä½“é€æ˜åº¦å’Œéšç§ä¹‹é—´å­˜åœ¨é—´éš™çš„åœºæ™¯ï¼Œé“¾ç åªèƒ½å®‰è£…åœ¨éœ€è¦è®¿é—®èµ„äº§çŠ¶æ€ä»¥æ‰§è¡Œè¯»å†™çš„peerèŠ‚ç‚¹ä¸Šï¼ˆæ¢å¥è¯è¯´ï¼Œå¦‚æœæœªåœ¨peerèŠ‚ç‚¹ä¸Šå®‰è£…é“¾ç ï¼Œåˆ™å®ƒå°†æ— æ³•ä¸è´¦æœ¬æ­£ç¡®è¿æ¥ï¼‰ã€‚</p><p>When a subset of organizations on that channel need to keep their transaction data confidential, a private data collection (collection) is used to segregate this data in a private database, logically separate from the channel ledger, accessible only to the authorized subset of organizations.</p><p>å½“è¯¥æ¸ é“ä¸Šçš„éƒ¨åˆ†ç»„ç»‡éœ€è¦å¯¹å…¶äº¤æ˜“æ•°æ®ä¿å¯†æ—¶ï¼Œç§æœ‰æ•°æ®é›†åˆç”¨äºå°†è¿™äº›æ•°æ®éš”ç¦»åœ¨ç§æœ‰æ•°æ®åº“ä¸­ï¼Œä»é€»è¾‘ä¸Šä¸é€šé“è´¦æœ¬éš”ç¦»ï¼Œå¹¶ä»…å…è®¸ç»„ç»‡çš„æˆæƒå­é›†è®¿é—®ã€‚</p><p>Thus, channels keep transactions private from the broader network whereas collections keep data private between subsets of organizations on the channel.</p><p>å› æ­¤ï¼Œé€šé“ä½¿äº¤æ˜“å¯¹äºæ›´å¹¿æ³›çš„ç½‘ç»œè€Œè¨€æ˜¯ä¸å…¬å¼€çš„ï¼Œè€Œé›†åˆåˆ™å¯¹é€šé“ä¸Šçš„ç»„ç»‡å­é›†ä¹‹é—´çš„æ•°æ®ä¸å…¬å¼€ã€‚</p><p>To further obfuscate the data, values within chaincode can be encrypted (in part or in total) using common cryptographic algorithms such as AES before sending transactions to the ordering service and appending blocks to the ledger. Once encrypted data has been written to the ledger, it can be decrypted only by a user in possession of the corresponding key that was used to generate the cipher text.</p><p>ä¸ºäº†è¿›ä¸€æ­¥æ··æ·†æ•°æ®ï¼Œåœ¨å°†chaincodeä¸­çš„æ•°æ®å‘é€ç»™æ’åºæœåŠ¡å’Œè¿½åŠ åˆ°è´¦æœ¬åŒºå—ä¸Šä¹‹å‰å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„åŠ å¯†ç®—æ³•ï¼ˆå¦‚AESï¼‰è¿›è¡ŒåŠ å¯†ã€‚åŠ å¯†æ•°æ®ä¸€æ—¦å†™å…¥åˆ†ç±»å¸ï¼Œåˆ™åªæœ‰æ‹¥æœ‰ç”¨äºç”Ÿæˆå¯†æ–‡çš„å¯†é’¥çš„ç”¨æˆ·æ‰èƒ½å¯¹å…¶è§£å¯†ã€‚</p><p>See the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/private-data-arch.html">Private Data</a> topic for more details on how to achieve privacy on your blockchain network.</p><p>æœ‰å…³å¦‚ä½•åœ¨åŒºå—é“¾ç½‘ç»œä¸Šå®ç°éšç§çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/private-data-arch.html">ç§æœ‰æ•°æ®</a>ä¸»é¢˜ã€‚</p><h2 id="Security-Membership-Services">Security &amp; Membership Services</h2><p>Hyperledger Fabric underpins a transactional network where all participants have known identities. Public Key Infrastructure is used to generate cryptographic certificates which are tied to organizations, network components, and end users or client applications. As a result, data access control can be manipulated and governed on the broader network and on channel levels. This â€œpermissionedâ€ notion of Hyperledger Fabric, coupled with the existence and capabilities of channels, helps address scenarios where privacy and confidentiality are paramount concerns.</p><p>Hyperledger Fabricæ”¯æŒæ‰€æœ‰å‚ä¸è€…éƒ½å…·æœ‰å·²çŸ¥èº«ä»½çš„äº¤æ˜“ç½‘ç»œã€‚å…¬é’¥åŸºç¡€ç»“æ„ç”¨äºç”Ÿæˆä¸ç»„ç»‡ï¼Œç½‘ç»œç»„ä»¶ä»¥åŠæœ€ç»ˆç”¨æˆ·æˆ–å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºç»‘å®šçš„åŠ å¯†è¯ä¹¦ã€‚ç»“æœï¼Œå¯ä»¥åœ¨æ›´å¹¿æ³›çš„ç½‘ç»œå’Œé€šé“çº§åˆ«ä¸Šæ“çºµå’Œæ§åˆ¶æ•°æ®è®¿é—®æ§åˆ¶ã€‚Hyperledger Fabricçš„â€œè®¸å¯â€æ¦‚å¿µä»¥åŠé€šé“çš„å­˜åœ¨å’ŒåŠŸèƒ½ï¼Œå¸®åŠ©è§£å†³éšç§å’Œæœºå¯†è‡³å…³é‡è¦çš„æƒ…å†µã€‚</p><p>See the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/msp.html">Membership Service Providers (MSP)</a> topic to better understand cryptographic implementations, and the sign, verify, authenticate approach used in Hyperledger Fabric.</p><h2 id="Consensus">Consensus</h2><p>In distributed ledger technology, consensus has recently become synonymous with a specific algorithm, within a single function. However, consensus encompasses more than simply agreeing upon the order of transactions, and this differentiation is highlighted in Hyperledger Fabric through its fundamental role in the entire transaction flow, from proposal and endorsement, to ordering, validation and commitment. In a nutshell, consensus is defined as the full-circle verification of the correctness of a set of transactions comprising a block.</p><p>åœ¨åˆ†å¸ƒå¼åˆ†ç±»å¸æŠ€æœ¯ä¸­ï¼Œå…±è¯†æœ€è¿‘å·²æˆä¸ºå•ä¸€åŠŸèƒ½å†…ç‰¹å®šç®—æ³•çš„åŒä¹‰è¯ã€‚ä½†æ˜¯ï¼Œå…±è¯†ä¸åªæ˜¯ç®€å•åœ°çº¦å®šäº¤æ˜“é¡ºåºï¼ŒHyperledger Fabricé€šè¿‡åœ¨æ•´ä¸ªäº¤æ˜“æµç¨‹ï¼ˆä»ææ¡ˆå’Œè®¤å¯ï¼Œåˆ°æ’åºï¼ŒéªŒè¯å’Œæäº¤ï¼‰ä¸­çš„åŸºæœ¬ä½œç”¨ï¼Œçªæ˜¾äº†è¿™ç§å·®å¼‚ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå…±è¯†è¢«å®šä¹‰ä¸ºå¯¹åŒ…å«ä¸€ä¸ªåŒºå—çš„ä¸€ç»„äº¤æ˜“çš„æ­£ç¡®æ€§çš„å…¨é¢éªŒè¯ã€‚</p><p>Consensus is achieved ultimately when the order and results of a blockâ€™s transactions have met the explicit policy criteria checks. These checks and balances take place during the lifecycle of a transaction, and include the usage of endorsement policies to dictate which specific members must endorse a certain transaction class, as well as system chaincodes to ensure that these policies are enforced and upheld. Prior to commitment, the peers will employ these system chaincodes to make sure that enough endorsements are present, and that they were derived from the appropriate entities. Moreover, a versioning check will take place during which the current state of the ledger is agreed or consented upon, before any blocks containing transactions are appended to the ledger. This final check provides protection against double spend operations and other threats that might compromise data integrity, and allows for functions to be executed against non-static variables.</p><p>åŒºå—äº¤æ˜“çš„é¡ºåºå’Œç»“æœæ»¡è¶³æ˜ç¡®çš„ç­–ç•¥æ ‡å‡†æ£€æŸ¥åï¼Œæ‰èƒ½æœ€ç»ˆè¾¾æˆå…±è¯†ã€‚è¿™äº›æ£€æŸ¥å’Œå¹³è¡¡å‘ç”Ÿåœ¨äº¤æ˜“çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå¹¶åŒ…æ‹¬ä½¿ç”¨èƒŒä¹¦ç­–ç•¥è§„å®šå“ªäº›ç‰¹å®šæˆå‘˜å¿…é¡»èƒŒä¹¦æŸä¸ªäº¤æ˜“ç±»åˆ«ï¼Œä»¥åŠç³»ç»Ÿé“¾ç ç¡®ä¿è¿™äº›ç­–ç•¥å¾—åˆ°å®æ–½å’Œç»´æŠ¤ã€‚åœ¨ä½œå‡ºæ‰¿è¯ºä¹‹å‰ï¼Œpeerå°†ä½¿ç”¨è¿™äº›ç³»ç»Ÿé“¾ç æ¥ç¡®ä¿å­˜åœ¨è¶³å¤Ÿçš„èƒŒä¹¦ï¼Œå¹¶ä¸”èƒŒä¹¦æ¥è‡ªé€‚å½“çš„å®ä½“ã€‚æ­¤å¤–ï¼Œåœ¨å°†åŒ…å«äº¤æ˜“çš„ä»»ä½•å—è¿½åŠ åˆ°è´¦æœ¬ä¹‹å‰ï¼Œå°†è¿›è¡Œç‰ˆæœ¬æ§åˆ¶æ£€æŸ¥ï¼Œåœ¨æ­¤æœŸé—´å°†å¯¹è´¦æœ¬çš„å½“å‰çŠ¶æ€è¿›è¡Œè¢«åŒæ„æˆ–åŒæ„ã€‚æœ€ç»ˆæ£€æŸ¥å¯ä»¥é˜²æ­¢é‡å¤ä½¿ç”¨æ“ä½œå’Œå…¶ä»–å¯èƒ½å±å®³æ•°æ®å®Œæ•´æ€§çš„å¨èƒï¼Œå¹¶å…è®¸é’ˆå¯¹éé™æ€å˜é‡æ‰§è¡ŒåŠŸèƒ½ã€‚</p><p>In addition to the multitude of endorsement, validity and versioning checks that take place, there are also ongoing identity verifications happening in all directions of the transaction flow. Access control lists are implemented on hierarchical layers of the network (ordering service down to channels), and payloads are repeatedly signed, verified and authenticated as a transaction proposal passes through the different architectural components. To conclude, consensus is not merely limited to the agreed upon order of a batch of transactions; rather, it is an overarching characterization that is achieved as a byproduct of the ongoing verifications that take place during a transactionâ€™s journey from proposal to commitment.</p><p>é™¤äº†è¿›è¡Œå¤§é‡çš„èƒŒä¹¦ï¼Œæœ‰æ•ˆæ€§å’Œç‰ˆæœ¬æ£€æŸ¥å¤–ï¼Œè¿˜åœ¨äº¤æ˜“æµç¨‹çš„å„ä¸ªæ–¹å‘ä¸Šéƒ½åœ¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚è®¿é—®æ§åˆ¶åˆ—è¡¨æ˜¯åœ¨ç½‘ç»œçš„åˆ†å±‚çš„å±‚é¢å®ç°çš„ï¼Œå½“äº¤æ˜“æè®®é€šè¿‡ä¸åŒçš„æ¶æ„ç»„ä»¶æ—¶ï¼Œæœ‰æ•ˆè½½è·å°†è¢«åå¤ç­¾åï¼ŒéªŒè¯å’Œè®¤è¯ã€‚æ€»è€Œè¨€ä¹‹ï¼Œå…±è¯†ä¸ä»…é™äºä¸€æ‰¹äº¤æ˜“çš„å•†å®šé¡ºåºï¼›å®ƒæ›´æ˜¯ä¸€é¡¹æ€»ä½“ç‰¹å¾ï¼Œå®ƒæ˜¯äº¤æ˜“ä»ææ¡ˆåˆ°æ‰¿è¯ºè¿‡ç¨‹ä¸­ä¸æ–­è¿›è¡Œçš„éªŒè¯çš„å‰¯äº§å“ã€‚</p><p>Check out the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/txflow.html">Transaction Flow</a> diagram for a visual representation of consensus.</p><p>æŸ¥çœ‹<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/txflow.html">äº¤æ˜“æµç¨‹</a>å›¾ä»¥ç›´è§‚è¡¨ç¤ºå…±è¯†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> Key Concepts </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> Model </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabricçš„ç½‘ç»œ</title>
      <link href="2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Fabric%E7%9A%84%E7%BD%91%E7%BB%9C/"/>
      <url>2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Fabric%E7%9A%84%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<h2 id="Blockchain-network-Fabricçš„ç½‘ç»œ">Blockchain network(Fabricçš„ç½‘ç»œ)</h2><p>åŸå§‹å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/network/network.html">https://hyperledger-fabric.readthedocs.io/en/release-2.2/network/network.html</a></p><h3 id="Creating-the-Network">Creating the Network</h3><p>ä»åˆ›å»ºåŸºç¡€ç½‘ç»œå¼€å§‹ï¼š<br><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/network.diagram.2.png" alt="network.diagram.2."><br><em>åœ¨ordererå¯åŠ¨ä¹‹åç½‘ç»œå°±å½¢æˆäº†ï¼Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ç½‘ç»œNä¸­ï¼ŒåŒ…æ‹¬å•ä¸ªèŠ‚ç‚¹O4çš„ordered serviceæ˜¯æ ¹æ®ç½‘ç»œé…ç½®NC4é…ç½®çš„ï¼Œè¯¥ç½‘ç»œé…ç½®å‘ç»„ç»‡R4æä¾›ç®¡ç†æƒé™ã€‚åœ¨ç½‘ç»œçº§åˆ«ï¼Œè¯ä¹¦é¢å‘æœºæ„CA4ç”¨äºå‘R4ç»„ç»‡çš„ç®¡ç†å‘˜å’Œç½‘ç»œèŠ‚ç‚¹åˆ†é…èº«ä»½ã€‚</em></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®šä¹‰ç½‘ç»œNçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯ordering service ï¼ŒO4ã€‚å°†è®¢è´­æœåŠ¡è§†ä¸ºç½‘ç»œçš„åˆå§‹ç®¡ç†ç‚¹å¾ˆæœ‰å¸®åŠ©ã€‚å°†ordering serviceè§†ä¸ºç½‘ç»œçš„åˆå§‹ç®¡ç†ç‚¹å¾ˆæœ‰å¸®åŠ©ã€‚æŒ‰ç…§äº‹å…ˆçº¦å®šï¼ŒO4æœ€åˆç”±ç»„ç»‡R4ä¸­çš„ç®¡ç†å‘˜é…ç½®å’Œå¯åŠ¨ï¼Œå¹¶æ‰˜ç®¡åœ¨R4ä¸­ã€‚é…ç½®NC4åŒ…å«æè¿°ç½‘ç»œç®¡ç†åŠŸèƒ½çš„åˆå§‹çš„ç­–ç•¥é›†åˆã€‚æœ€åˆï¼Œå°†å…¶è®¾ç½®ä¸ºä»…é€šè¿‡ç½‘ç»œæˆäºˆR4æƒé™ã€‚è¿™å°†æ”¹å˜ï¼Œæˆ‘ä»¬å°†åœ¨åé¢çœ‹åˆ°ï¼Œä½†ç›®å‰R4æ˜¯ç½‘ç»œçš„å”¯ä¸€æˆå‘˜ã€‚</p><h3 id="Certificate-Authoritiesï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰">Certificate Authoritiesï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰</h3><p>æ‚¨è¿˜å¯ä»¥çœ‹åˆ°è¯ä¹¦é¢å‘æœºæ„CA4ï¼Œç”¨äºå‘ç®¡ç†å‘˜å’Œç½‘ç»œèŠ‚ç‚¹é¢å‘è¯ä¹¦ã€‚CA4åœ¨æˆ‘ä»¬çš„ç½‘ç»œä¸­èµ·ç€å…³é”®ä½œç”¨ï¼Œå› ä¸ºå®ƒé¢å‘X.509è¯ä¹¦ï¼Œè¯¥è¯ä¹¦å¯ç”¨äºå°†ç»„ä»¶æ ‡è¯†ä¸ºå±äºç»„ç»‡R4ã€‚ç”±CAé¢å‘çš„è¯ä¹¦ä¹Ÿå¯ä»¥ç”¨äºç­¾ç½²äº¤æ˜“ï¼Œä»¥è¡¨æ˜ç»„ç»‡è®¤å¯äº¤æ˜“ç»“æœâ€“è¿™æ˜¯å…è®¸äº¤æ˜“æäº¤åˆ°åˆ†ç±»å¸çš„å‰æã€‚è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°ç ”ç©¶CAçš„è¿™ä¸¤ä¸ªæ–¹é¢ã€‚</p><p>é¦–å…ˆï¼ŒåŒºå—é“¾ç½‘ç»œçš„ä¸åŒç»„ä»¶ä½¿ç”¨è¯ä¹¦å°†è‡ªå·±æ ‡è¯†ä¸ºæ¥è‡ªç‰¹å®šç»„ç»‡ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆé€šå¸¸æœ‰ä¸æ­¢ä¸€ä¸ªCAæ”¯æŒä¸€ä¸ªåŒºå—é“¾ç½‘ç»œ-ä¸åŒçš„ç»„ç»‡ç»å¸¸ä½¿ç”¨ä¸åŒçš„CAã€‚<br>è¯ä¹¦åˆ°æˆå‘˜ç»„ç»‡çš„æ˜ å°„æ˜¯é€šè¿‡ç§°ä¸ºMembership Services Provider (MSP)çš„ç»“æ„å®ç°çš„ã€‚ç½‘ç»œé…ç½®NC4ä½¿ç”¨MSPæ¥æ ‡è¯†ç”±CA4åˆ†é…çš„è¯ä¹¦çš„å±æ€§ï¼Œè¯¥è¯ä¹¦å°†è¯ä¹¦æŒæœ‰è€…ä¸ç»„ç»‡R4ç›¸å…³è”ã€‚ç„¶åï¼ŒNC4å¯ä»¥åœ¨ç­–ç•¥ä¸­ä½¿ç”¨æ­¤MSPå‘R4çš„å‚ä¸è€…æˆäºˆå¯¹ç½‘ç»œèµ„æºçš„ç‰¹å®šæƒé™ã€‚è¿™ç§ç­–ç•¥çš„ä¸€ä¸ªç¤ºä¾‹æ˜¯R4ä¸­çš„ç®¡ç†å‘˜å¯ä»¥å‘ç½‘ç»œæ·»åŠ çš„æ–°æˆå‘˜ã€‚</p><p>å…¶æ¬¡ï¼Œç¨åæˆ‘ä»¬å°†çœ‹åˆ°CAé¢å‘çš„è¯ä¹¦å¦‚ä½•æˆä¸ºäº¤æ˜“ç”Ÿæˆå’ŒéªŒè¯è¿‡ç¨‹çš„æ ¸å¿ƒã€‚å…·ä½“æ¥è¯´ï¼ŒX.509è¯ä¹¦ç”¨äºå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºäº¤æ˜“å»ºè®®å’Œæ™ºèƒ½åˆçº¦äº¤æ˜“å“åº”ä¸­ä»¥è¿›è¡Œæ•°å­—ç­¾åäº¤æ˜“ã€‚éšåï¼Œæ‰˜ç®¡è´¦æœ¬çš„ç½‘ç»œèŠ‚ç‚¹åœ¨æ¥å—äº¤æ˜“è®°å½•åˆ°è´¦æœ¬ä¹‹å‰ä¼šéªŒè¯äº¤æ˜“çš„ç­¾åæ˜¯å¦æœ‰æ•ˆã€‚</p><p>è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ç¤ºä¾‹åŒºå—é“¾ç½‘ç»œçš„åŸºæœ¬ç»“æ„ï¼šè¯ä¹¦é¢å‘æœºæ„CA4å®šä¹‰äº†ä¸€ç»„ç”¨æˆ·ï¼Œå¯ä»¥è®¿é—®ç½‘ç»œNï¼›è¿™äº›ç”¨æˆ·å¯¹ç½‘ç»œNä¸­èµ„æºçš„æƒé™è¢«ç½‘ç»œé…ç½®NC4ä¸­åŒ…å«çš„ç­–ç•¥æ‰€æè¿°ã€‚åœ¨æˆ‘ä»¬é…ç½®å¹¶å¯åŠ¨ordering serviceèŠ‚ç‚¹O4æ—¶ï¼Œæ‰€æœ‰è¿™äº›éƒ½å˜ä¸ºç°å®ã€‚</p><h3 id="Adding-Network-Administratorsï¼ˆæ·»åŠ ç½‘ç»œç®¡ç†å‘˜ï¼‰">Adding Network Administratorsï¼ˆæ·»åŠ ç½‘ç»œç®¡ç†å‘˜ï¼‰</h3><p>NC4åªé…ç½®äº†R4çš„ç”¨æˆ·åœ¨ç½‘ç»œä¸Šçš„æƒé™ã€‚åœ¨ä¸‹ä¸€ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬å°†å…è®¸ç»„ç»‡R1ç”¨æˆ·ç®¡ç†ç½‘ç»œã€‚è®©æˆ‘ä»¬çœ‹çœ‹ç½‘ç»œå¦‚ä½•å‘å±•ï¼š<br><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/network.diagram.2.1.png" alt="network.diagram.2.1"><br><em>ç»„ç»‡R4æ›´æ–°ç½‘ç»œé…ç½®ä»¥ä½¿ç»„ç»‡R1ä¹Ÿæˆä¸ºç®¡ç†å‘˜ã€‚æ­¤åï¼ŒR1å’ŒR4åœ¨ç½‘ç»œé…ç½®ä¸Šäº«æœ‰åŒç­‰çš„æƒåˆ©ã€‚</em></p><p>å°½ç®¡è®¢è´­è€…èŠ‚ç‚¹O4åœ¨R4çš„åŸºç¡€ç»“æ„ä¸Šè¿è¡Œï¼Œä½†R1æ‹¥æœ‰å…±äº«çš„ç®¡ç†æƒé™ï¼Œåªè¦å®ƒå¯ä»¥è®¿é—®ç½‘ç»œå³å¯ã€‚è¿™æ„å‘³ç€R1æˆ–R4å¯ä»¥æ›´æ–°ç½‘ç»œé…ç½®NC4ï¼Œä»¥å…è®¸R2ç»„ç»‡è¿›è¡Œç½‘ç»œæ“ä½œçš„å­é›†ã€‚è¿™æ ·ï¼Œå³ä½¿R4åœ¨è¿è¡Œè®¢è´­æœåŠ¡ï¼ŒR1ä¹Ÿå¯¹å…¶æ‹¥æœ‰å®Œå…¨çš„ç®¡ç†æƒé™ï¼Œå¹¶ä¸”R2å…·æœ‰åˆ›å»ºæ–°è”åˆä½“çš„éƒ¨åˆ†æƒé™ã€‚</p><p>ä½ åœ¨ç¤ºä¾‹ä¸­çœ‹åˆ°çš„ordering serviceæ˜¯ç½‘ç»œä¸­çš„å•ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ˜¯æœ€ç®€å•çš„å½¢å¼ã€‚ordering serviceé€šå¸¸æ˜¯å¤šèŠ‚ç‚¹çš„ï¼Œå¯ä»¥é…ç½®ä¸ºåœ¨ä¸åŒç»„ç»‡çš„ä¸åŒèŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½åœ¨R4ä¸­è¿è¡ŒO4å¹¶å°†å…¶è¿æ¥åˆ°ç»„ç»‡R1ä¸­å•ç‹¬çš„è®¢è´­è€…èŠ‚ç‚¹O2ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°†æ‹¥æœ‰ä¸€ä¸ªå¤šç«™ç‚¹ï¼Œå¤šç»„ç»‡çš„ç®¡ç†ç»“æ„ã€‚</p><p>æˆ‘ä»¬å°†åœ¨æœ¬ä¸»é¢˜çš„ç¨åéƒ¨åˆ†è®¨è®ºordering serviceï¼Œä½†æ˜¯ç°åœ¨ï¼Œä»…å°†ordering serviceè§†ä¸ºä¸€ä¸ªå¯ä¸ºä¸åŒç»„ç»‡æä¾›å¯¹ç½‘ç»œå—æ§è®¿é—®çš„ç®¡ç†ç‚¹ã€‚</p><h3 id="Defining-a-Consortium-å®šä¹‰ä¸€ä¸ªè”ç›Ÿ">Defining a Consortium(å®šä¹‰ä¸€ä¸ªè”ç›Ÿ)</h3><p>å°½ç®¡ç°åœ¨å¯ä»¥é€šè¿‡R1å’ŒR4ç®¡ç†ç½‘ç»œï¼Œä½†æ˜¯å‡ ä¹æ²¡æœ‰ä»€ä¹ˆäº‹æƒ…å¯åšã€‚æˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å®šä¹‰ä¸€ä¸ªè”ç›Ÿã€‚è¿™ä¸ªè¯çš„å­—é¢æ„æ€æ˜¯â€œæ‹¥æœ‰å…±åŒå‘½è¿çš„å›¢ä½“â€ï¼Œå› æ­¤å¯¹äºåŒºå—é“¾ç½‘ç»œä¸­çš„ä¸€ç»„ç»„ç»‡æ¥è¯´æ˜¯ä¸€ä¸ªåˆé€‚çš„é€‰æ‹©ã€‚</p><p>è®©æˆ‘ä»¬çœ‹çœ‹è”ç›Ÿçš„å®šä¹‰ï¼š<br><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/network.diagram.3.png" alt="network.diagram.3"><br><em>ç½‘ç»œç®¡ç†å‘˜å®šä¹‰äº†ä¸€ä¸ªè”ç›ŸX1ï¼Œè¯¥è”ç›ŸåŒ…å«ä¸¤ä¸ªæˆå‘˜ï¼Œç»„ç»‡R1å’ŒR2ã€‚è¯¥è”ç›Ÿçš„å®šä¹‰å­˜å‚¨åœ¨ç½‘ç»œé…ç½®NC4ä¸­ï¼Œå¹¶å°†åœ¨ç½‘ç»œå¼€å‘çš„ä¸‹ä¸€é˜¶æ®µä½¿ç”¨ã€‚CA1å’ŒCA2æ˜¯è¿™äº›ç»„ç»‡çš„å„è‡ªçš„è¯ä¹¦é¢å‘æœºæ„ã€‚</em></p><p>å› ä¸ºNC4é…ç½®çš„æ˜¯åªå…è®¸R1æˆ–R4å¯ä»¥åˆ›å»ºæ–°çš„è”ç›Ÿã€‚è¯¥å›¾æ˜¾ç¤ºäº†æ·»åŠ çš„æ–°è”ç›ŸX1ï¼Œè¯¥è”ç›Ÿå°†R1å’ŒR2å®šä¹‰ä¸ºå…¶ç»„æˆç»„ç»‡ã€‚æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°å·²ç»æ·»åŠ äº†CA2ç”¨ä»¥è®¤è¯R2çš„ç”¨æˆ·ã€‚è¯·æ³¨æ„ï¼Œä¸€ä¸ªè”ç›Ÿå¯ä»¥æœ‰ä»»æ„æ•°é‡çš„ç»„ç»‡æˆå‘˜â€“æˆ‘ä»¬åˆšåˆšæ˜¾ç¤ºäº†ä¸¤ä¸ªï¼Œå› ä¸ºå®ƒæ˜¯æœ€ç®€å•çš„é…ç½®ã€‚</p><p>ä¸ºä»€ä¹ˆè”ç›Ÿå¦‚æ­¤é‡è¦ï¼Ÿæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªè”ç›Ÿå®šä¹‰äº†ç½‘ç»œä¸­å½¼æ­¤éœ€è¦å…±äº«äº¤æ˜“çš„ç»„ç»‡é›†åˆï¼Œåœ¨æœ¬ä¾‹ä¸­R1å’Œ R2ã€‚å¦‚æœç»„ç»‡æœ‰å…±åŒçš„ç›®æ ‡ï¼Œå°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·çœŸçš„å¾ˆæœ‰æ„ä¹‰ï¼Œè€Œè¿™æ­£ä¸Šé¢çš„è”ç›Ÿå®šä¹‰ã€‚</p><p>è¯¥ç½‘ç»œè™½ç„¶ç”±å•ä¸ªç»„ç»‡å¯åŠ¨ï¼Œä½†ç°åœ¨ç”±è¾ƒå¤§çš„ä¸€ç»„ç»„ç»‡æ§åˆ¶ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è”ç›ŸX1åˆ›å»ºHyperledger FabricåŒºå—é“¾çš„ä¸€ä¸ªéå¸¸é‡è¦çš„éƒ¨åˆ†-ä¸€ä¸ªé€šé“ã€‚</p><h3 id="Creating-a-channel-for-a-consortium-ä¸ºè”ç›Ÿåˆ›å»ºä¸€ä¸ªé€šé“">Creating a channel for a consortium(ä¸ºè”ç›Ÿåˆ›å»ºä¸€ä¸ªé€šé“)</h3><p>channelæ˜¯ä¸»è¦çš„é€šä¿¡æœºåˆ¶ï¼Œè”ç›Ÿçš„æˆå‘˜å¯ä»¥é€šè¿‡channelç›¸äº’é€šä¿¡ã€‚ç½‘ç»œä¸­å¯ä»¥æœ‰å¤šä¸ªé€šé“ï¼Œæˆ‘ä»¬å…ˆä»ä¸€ä¸ªæ¸ é“å¼€å§‹ã€‚<br>è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å°†ç¬¬ä¸€ä¸ªchannelæ·»åŠ åˆ°ç½‘ç»œä¸­ï¼š<br><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/network.diagram.4.png" alt="network.diagram.4"><br><em>ä½¿ç”¨è”ç›Ÿå®šä¹‰X1ä¸ºR1å’ŒR2åˆ›å»ºäº†é€šé“C1ã€‚é€šé“ç”±é€šé“é…ç½®CC1è¿›è¡Œæ²»ç†ï¼Œå®Œå…¨ç‹¬ç«‹äºç½‘ç»œé…ç½®ã€‚CC1ç”±å¯¹C1æ‹¥æœ‰åŒç­‰æƒåˆ©çš„R1å’ŒR2ç®¡ç†ã€‚ R4åœ¨CC1ä¸­æ²¡æœ‰ä»»ä½•æƒåˆ©ã€‚</em></p><p>é€šé“C1ä¸ºè´¢å›¢X1æä¾›äº†ä¸“ç”¨çš„é€šä¿¡æœºåˆ¶ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é€šé“C1å·²è¿æ¥åˆ°ordersing service(O4)ï¼Œä½†æ²¡æœ‰é™„åŠ ä»»ä½•å†…å®¹ã€‚åœ¨ç½‘ç»œå¼€å‘çš„ä¸‹ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬å°†è¿æ¥ç»„ä»¶ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå’ŒpeerèŠ‚ç‚¹ã€‚ä½†æ˜¯ï¼Œæ¸ é“ä»£è¡¨ç€æœªæ¥è¿æ¥çš„æ½œåŠ›ã€‚</p><p>å³ä½¿é€šé“C1æ˜¯ç½‘ç»œNçš„ä¸€éƒ¨åˆ†ï¼Œä½†ä¹Ÿå¯ä»¥ä¸å®ƒå®Œå…¨åŒºåˆ†å¼€ã€‚æ³¨æ„ç»„ç»‡R3å’ŒR4ä¸åœ¨æ­¤é€šé“ä¸­ï¼ŒC1åªç”¨äºR1å’ŒR2ä¹‹é—´çš„äº¤æ˜“å¤„ç†ã€‚åœ¨ä¸Šä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†R4å¦‚ä½•æˆäºˆR1åˆ›å»ºæ–°è”ç›Ÿçš„æƒé™ã€‚å€¼å¾—ä¸€æçš„æ˜¯R4è¿˜å…è®¸R1åˆ›å»ºchannelï¼åœ¨æ­¤å›¾ä¸­ï¼Œå¯èƒ½æ˜¯ç»„ç»‡R1æˆ–R4åˆ›å»ºäº†é€šé“C1ã€‚</p><p>å†æ¬¡æ³¨æ„é€šé“C1å¯¹äºç½‘ç»œé…ç½®NC4å¦‚ä½•å…·æœ‰å®Œå…¨ç‹¬ç«‹çš„é…ç½®CC1ã€‚CC1åŒ…å«ç”¨äºæ§åˆ¶R1å’ŒR2åœ¨é€šé“C1ä¸Šçš„æƒé™çš„ç­–ç•¥-æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼ŒR3å’ŒR4åœ¨æ­¤é€šé“ä¸Šæ²¡æœ‰æƒé™ã€‚R3å’ŒR4åªèƒ½åœ¨R1æˆ–R2å°†å…¶æ·»åŠ é€‚å½“ç­–ç•¥åˆ°é€šé“é…ç½®CC1ä¸­ï¼Œæ‰å¯ä»¥ä¸C1äº¤äº’ã€‚ä¸€ä¸ªç¤ºä¾‹æ˜¯å®šä¹‰è°å¯ä»¥å‘channelæ·»åŠ æ–°ç»„ç»‡ã€‚ç‰¹åˆ«è¦æ³¨æ„çš„æ˜¯ï¼ŒR4ä¸èƒ½å°†è‡ªèº«æ·»åŠ åˆ°é€šé“C1ä¸­-å®ƒå¿…é¡»å¹¶ä¸”åªèƒ½ç”±R1æˆ–R2æˆæƒã€‚</p><p>ä¸ºä»€ä¹ˆchannelå¦‚æ­¤é‡è¦ï¼Ÿchannelsä¹‹æ‰€ä»¥æœ‰ç”¨ï¼Œæ˜¯å› ä¸ºå®ƒä»¬ä¸ºè”ç›Ÿæˆå‘˜ä¹‹é—´çš„ç§æœ‰é€šä¿¡å’Œç§æœ‰æ•°æ®æä¾›äº†ä¸€ç§æœºåˆ¶ã€‚channelæä¾›äº†éšç§æ€§ä¿æŠ¤ï¼Œå¯¹äºå…¶ä»–çš„channelså’Œæ•´ä¸ªç½‘ç»œã€‚Hyperledger Fabricåœ¨è¿™æ–¹é¢å¾ˆå¼ºå¤§ï¼Œå› ä¸ºå®ƒå…è®¸ç»„ç»‡å…±äº«åŸºç¡€ç»“æ„å¹¶åŒæ—¶ä¿æŒç§æœ‰çŠ¶æ€ã€‚è¿™é‡Œæ²¡æœ‰çŸ›ç›¾-ç½‘ç»œä¸­çš„ä¸åŒè”ç›Ÿéœ€è¦é€‚å½“å…±äº«ä¸åŒçš„ä¿¡æ¯å’Œæµç¨‹ï¼Œè€Œæ¸ é“åˆ™æä¾›äº†ä¸€ç§æœ‰æ•ˆçš„æœºåˆ¶æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚é€šé“å¯æœ‰æ•ˆå…±äº«åŸºç¡€æ¶æ„ï¼ŒåŒæ—¶ä¿æŒæ•°æ®å’Œé€šä¿¡çš„éšç§ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ï¼Œä¸€æ—¦åˆ›å»ºäº†ä¸€ä¸ªchannelï¼Œå®ƒå®é™…ä¸Šå°±æ˜¯â€œè„±ç¦»ç½‘ç»œâ€ã€‚ä»åˆ›å»ºå¼€å§‹åˆ°æœªæ¥ï¼Œåªæœ‰åœ¨channelé…ç½®ä¸­æ˜ç¡®æŒ‡å®šçš„ç»„ç»‡æ‰èƒ½å¯¹å…¶è¿›è¡Œæ§åˆ¶ã€‚åŒæ ·ï¼Œä»æ­¤æ—¶å¼€å§‹å¯¹ç½‘ç»œé…ç½®NC4çš„ä»»ä½•æ›´æ–°éƒ½ä¸ä¼šç›´æ¥å½±å“channelé…ç½®CC1ï¼›ä¾‹å¦‚ï¼Œå¦‚æœè”ç›Ÿå®šä¹‰X1æ›´æ”¹ï¼Œå®ƒå°†ä¸ä¼šå½±å“é€šé“C1çš„æˆå‘˜ã€‚é€šé“ä¹‹æ‰€ä»¥æœ‰ç”¨ï¼Œæ˜¯å› ä¸ºå®ƒä»¬å…è®¸æ„æˆé€šé“çš„ç»„ç»‡ä¹‹é—´è¿›è¡Œç§äººé€šä¿¡ã€‚æ­¤å¤–ï¼Œé€šé“ä¸­çš„æ•°æ®ä¸ç½‘ç»œçš„å…¶ä½™éƒ¨åˆ†ï¼ˆåŒ…æ‹¬å…¶ä»–é€šé“ï¼‰å®Œå…¨éš”ç¦»ã€‚</p><p>é¡ºä¾¿è¯´ä¸€å¥ï¼Œè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç³»ç»Ÿé€šé“ï¼ˆ<strong>system channel</strong>ï¼‰çš„å®šä¹‰ï¼Œæ˜¯ä¸ºäº†ç»™æ’åºæœåŠ¡ï¼ˆordering serviceï¼‰ä½¿ç”¨çš„ã€‚å®ƒçš„è¡Œä¸ºä¸å¸¸è§„channelå®Œå…¨ç›¸åŒï¼Œå› æ­¤ï¼Œæœ‰æ—¶ä¹Ÿç§°ä¸ºåº”ç”¨ç¨‹åºé€šé“ï¼ˆ<strong>application channels</strong>ï¼‰ã€‚</p><h3 id="Peers-and-Ledgersï¼ˆèŠ‚ç‚¹ä¸è´¦å•ï¼‰">Peers and Ledgersï¼ˆèŠ‚ç‚¹ä¸è´¦å•ï¼‰</h3><p>ç°åœ¨å¼€å§‹ä½¿ç”¨æ¸ é“å°†åŒºå—é“¾ç½‘ç»œå’Œç»„ç»‡ç»„ä»¶è¿æ¥åœ¨ä¸€èµ·ã€‚åœ¨ç½‘ç»œå¼€å‘çš„ä¸‹ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ç½‘ç»œNåˆšåˆšè·å¾—äº†ä¸¤ä¸ªæ–°ç»„ä»¶ï¼Œå³peerèŠ‚ç‚¹P1å’Œè´¦æœ¬å®ä¾‹L1ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/network.diagram.5.png" alt="network.diagram.5"><br><em>peerèŠ‚ç‚¹P1å·²åŠ å…¥é€šé“C1ã€‚ P1ç‰©ç†ä¸Šå­˜å‚¨è´¦æœ¬L1çš„å‰¯æœ¬ã€‚ P1å’ŒO4å¯ä»¥ä½¿ç”¨é€šé“C1ç›¸äº’é€šä¿¡ã€‚</em></p><p>peerèŠ‚ç‚¹æ˜¯æ‰˜ç®¡åŒºå—é“¾è´¦æœ¬å‰¯æœ¬çš„ç½‘ç»œç»„ä»¶ï¼Œæœ€åï¼Œæˆ‘ä»¬å¼€å§‹çœ‹åˆ°ä¸€äº›å¯è¯†åˆ«çš„åŒºå—é“¾ç»„ä»¶ã€‚P1åœ¨ç½‘ç»œä¸­çš„ç›®çš„çº¯ç²¹æ˜¯æ‰˜ç®¡è´¦æœ¬L1çš„å‰¯æœ¬ï¼Œä»¥ä¾›å…¶ä»–äººè®¿é—®ã€‚æˆ‘ä»¬å¯ä»¥è®¤ä¸ºL1ç‰©ç†ä¸Šæ‰˜ç®¡åœ¨P1ä¸Šï¼Œä½†é€»è¾‘ä¸Šæ‰˜ç®¡åœ¨é€šé“C1ä¸Šã€‚å½“æˆ‘ä»¬å‘channelæ·»åŠ æ›´å¤špeeræ—¶ï¼Œæˆ‘ä»¬ä¼šæ›´æ¸…æ¥šåœ°çœ‹åˆ°è¿™ä¸ªæƒ³æ³•ã€‚</p><p>P1é…ç½®çš„å…³é”®éƒ¨åˆ†æ˜¯CA1å‘å‡ºçš„X.509èº«ä»½ï¼Œè¯¥èº«ä»½å°†P1ä¸ç»„ç»‡R1ç›¸å…³è”ã€‚å½“R1ç»„ç»‡çš„ç®¡ç†å‘˜å°†peerèŠ‚ç‚¹P1åŠ å…¥é€šé“C1å¹¶ä¸”P1å¼€å§‹ä»æ’åºèŠ‚ç‚¹O4æ‹‰å–æ•°æ®å—çš„æ—¶å€™ï¼ŒO4ä½¿ç”¨é€šé“é…ç½®CC1æ¥ç¡®å®šP1åœ¨è¯¥é€šé“ä¸Šçš„æƒé™ã€‚ä¾‹å¦‚ï¼ŒCC1ä¸­çš„ç­–ç•¥ç¡®å®šP1ï¼ˆæˆ–ç»„ç»‡R1ï¼‰æ˜¯å¦å¯ä»¥åœ¨é€šé“C1ä¸Šè¯»å–ï¼ˆå’Œ/æˆ–ï¼‰å†™å…¥ã€‚</p><p>æ³¨æ„æ‹¥æœ‰peerçš„ç»„ç»‡æ˜¯å¦‚ä½•å°†peeråŠ å…¥æ¸ é“çš„ï¼Œå°½ç®¡æˆ‘ä»¬ä»…æ·»åŠ äº†ä¸€ä¸ªpeerï¼Œä½†æˆ‘ä»¬å°†çœ‹åˆ°ç½‘ç»œä¸­çš„å¤šä¸ªæ¸ é“ä¸Šå¦‚ä½•æœ‰å¤šä¸ªpeerèŠ‚ç‚¹ã€‚ç¨åæˆ‘ä»¬å°†çœ‹åˆ°peerå¯ä»¥æ‰®æ¼”çš„ä¸åŒè§’è‰²ã€‚</p><h3 id="Applications-and-Smart-Contract-chaincodeï¼ˆåº”ç”¨ç¨‹åºå’Œæ™ºèƒ½åˆçº¦è”é“¾ç ï¼‰">Applications and Smart Contract chaincodeï¼ˆåº”ç”¨ç¨‹åºå’Œæ™ºèƒ½åˆçº¦è”é“¾ç ï¼‰</h3><p>ç°åœ¨ï¼Œé€šé“C1ä¸Šæœ‰ä¸€ä¸ªè´¦æœ¬L1ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹è¿æ¥å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œä»¥ä½¿ç”¨ä¸ºæ“ä½œè´¦æœ¬æä¾›æœåŠ¡çš„peerã€‚</p><p>è¯·æ³¨æ„ç½‘ç»œå·²ç»å¢é•¿äº†ï¼š<br><img src="https://gitee.com/guozhe001/images/raw/master/network.diagram.6.png" alt="network.diagram.6"><br><em>å·²ç»æ™ºèƒ½åˆçº¦S5å·²ç»è¢«éƒ¨ç½²åˆ°äº†P1ï¼Œå±äºç»„ç»‡R1çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA1å¯ä»¥ä½¿ç”¨S5é€šè¿‡P1æ¥è®¿é—®è´¦æœ¬L1ã€‚A1ã€P1å’ŒO4éƒ½åŠ å…¥äº†é€šé“C1ï¼Œå¦‚å›¾æ‰€ç¤ºï¼ŒA1ã€P1å’ŒO4éƒ½åŠ å…¥äº†é€šé“C1ï¼Œå³å®ƒä»¬éƒ½å¯ä»¥åˆ©ç”¨è¯¥é€šé“æä¾›çš„é€šä¿¡è®¾æ–½ã€‚</em></p><p>åœ¨ç½‘ç»œå¼€å‘çš„ä¸‹ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA1å¯ä»¥ä½¿ç”¨é€šé“C1è¿æ¥åˆ°ç‰¹å®šçš„ç½‘ç»œèµ„æºâ€“åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒA1å¯ä»¥åŒæ—¶è¿æ¥åˆ°peerèŠ‚ç‚¹P1å’ŒorderedèŠ‚ç‚¹O4ã€‚è®©æˆ‘ä»¬åœ¨æ­¤ä¹‹å‰æŸ¥çœ‹æ¸ é“æ˜¯å¦‚ä½•æˆä¸ºç½‘ç»œå’Œç»„ç»‡ç»„ä»¶ä¹‹é—´é€šä¿¡æ ¸å¿ƒçš„ã€‚å°±åƒå¯¹peerèŠ‚ç‚¹å’ŒorderedèŠ‚ç‚¹ä¸€æ ·ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¹Ÿå…·æœ‰ä¸€ä¸ªå¯ä»¥å°†å…¶ä¸ç»„ç»‡å…³è”èµ·æ¥çš„èº«ä»½ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA1ä¸ç»„ç»‡R1å…³è”ï¼Œå°½ç®¡å®ƒåœ¨FabricåŒºå—é“¾ç½‘ç»œä¹‹å¤–ï¼Œä½†ä»ç„¶å¯ä»¥é€šè¿‡æ¸ é“C1è®¿é—®åˆ°åŒºå—é“¾ã€‚</p><p>ç°åœ¨çœ‹æ¥ï¼ŒA1å¯ä»¥ç›´æ¥é€šè¿‡P1è®¿é—®åˆ†ç±»å¸L1ï¼Œä½†å®é™…ä¸Šï¼Œæ‰€æœ‰è®¿é—®éƒ½æ˜¯é€šè¿‡ç§°ä¸ºæ™ºèƒ½åˆçº¦é“¾ç S5çš„ç‰¹æ®Šç¨‹åºè¿›è¡Œç®¡ç†çš„ã€‚å°†S5å®šä¹‰ä¸ºè´¦æœ¬çš„æ‰€æœ‰å¸¸è§è®¿é—®æ¨¡å¼ï¼› S5æä¾›äº†ä¸€å¥—æ˜ç¡®å®šä¹‰çš„æ–¹å¼ï¼Œå¯ç”¨æ¥æŸ¥è¯¢æˆ–æ›´æ–°è´¦æœ¬L1ã€‚</p><p>æ¯ä¸ªç»„ç»‡çš„å¼€å‘äººå‘˜éƒ½å¯ä»¥åˆ›å»ºæ™ºèƒ½åˆçº¦ï¼Œç„¶åå‘èµ·åœ¨è”ç›Ÿä¹‹é—´å…±äº«çš„ä¸šåŠ¡æµç¨‹ã€‚æ™ºèƒ½åˆçº¦ç”¨äºç”Ÿæˆå¯ä»¥åˆ†é…åˆ°ç½‘ç»œä¸­æ¯ä¸ªèŠ‚ç‚¹çš„äº¤æ˜“ã€‚æˆ‘ä»¬ç¨åå†è®¨è®ºè¿™ä¸ªæƒ³æ³•ï¼›å½“ç½‘ç»œæ›´å¤§æ—¶ï¼Œå°†æ›´å®¹æ˜“ç†è§£ã€‚ç°åœ¨ï¼Œéœ€è¦äº†è§£çš„é‡è¦ä¸€ç‚¹æ˜¯ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œå¿…é¡»åœ¨æ™ºèƒ½åˆçº¦ä¸Šæ‰§è¡Œä¸¤æ¬¡æ“ä½œã€‚ç›®å‰ä¸ºæ­¢ï¼Œéœ€è¦äº†è§£çš„é‡è¦ä¸€ç‚¹æ˜¯å¿…é¡»åœ¨æ™ºèƒ½åˆçº¦ä¸Šæ‰§è¡Œä¸¤æ¬¡æ“ä½œï¼š</p><ol><li>å®ƒå¿…é¡»å·²ç»å®‰è£…ï¼ˆ<strong>installed</strong>ï¼‰åœ¨peerä¸Š</li><li>ç„¶åå·²ç»åœ¨é€šé“ä¸Šå®šä¹‰ï¼ˆ<strong>defined</strong>ï¼‰</li></ol><p>Hyperledger Fabricç”¨æˆ·ç»å¸¸æŠŠæœ¯<strong>è¯­æ™ºèƒ½åˆçº¦ï¼ˆsmart contractï¼‰<strong>å’Œ</strong>é“¾ç ï¼ˆchaincodeï¼‰<strong>è¿›è¡Œäº’æ¢ä½¿ç”¨ã€‚é€šå¸¸ï¼Œæ™ºèƒ½åˆçº¦å®šä¹‰äº†</strong>äº¤æ˜“é€»è¾‘ï¼ˆ transaction logic ï¼‰</strong>ï¼Œè¿™ä¸ªäº¤æ˜“é€»è¾‘æ§åˆ¶äº†ç°å®ä¸–ç•ŒçŠ¶æ€ä¸­åŒ…å«ä¸šåŠ¡å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚ç„¶åå°†å…¶æ‰“åŒ…æˆé“¾ç ï¼Œç„¶åå°†å…¶éƒ¨ç½²åˆ°åŒºå—é“¾ç½‘ç»œã€‚å¯ä»¥å°†æ™ºèƒ½åˆçº¦è§†ä¸ºæ”¯é…äº¤æ˜“ï¼Œè€Œé“¾ç åˆ™æ˜¯æ§åˆ¶å¦‚ä½•æ‰“åŒ…æ™ºèƒ½åˆçº¦ä»¥è¿›è¡Œéƒ¨ç½²ã€‚</p><h3 id="Installing-a-chaincode-packageï¼ˆå®‰è£…é“¾ç åŒ…ï¼‰">Installing a chaincode packageï¼ˆå®‰è£…é“¾ç åŒ…ï¼‰</h3><p>å¼€å‘äº†æ™ºèƒ½åˆçº¦S5ä¹‹åï¼Œç»„ç»‡R1ä¸­çš„ç®¡ç†å‘˜å¿…é¡»åˆ›å»ºä¸€ä¸ªé“¾ç åŒ…å¹¶å°†å…¶å®‰è£…åˆ°peerèŠ‚ç‚¹P1ä¸Šã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ“ä½œï¼›ä¸€æ—¦å®Œæˆï¼ŒP1å°±å®Œå…¨äº†è§£S5ã€‚å…·ä½“æ¥è¯´ï¼ŒP1å¯ä»¥çœ‹åˆ°S5çš„**å®ç°ï¼ˆimplementationï¼‰<strong>é€»è¾‘-å°±æ˜¯ç”¨äºè®¿é—®è´¦æœ¬L1çš„ä»£ç ã€‚æˆ‘ä»¬å°†æ­¤ä¸S5çš„</strong>æ¥å£ï¼ˆinterfaceï¼‰**è¿›è¡Œå¯¹æ¯”ï¼Œåè€…ä»…æè¿°S5çš„è¾“å…¥å’Œè¾“å‡ºï¼Œè€Œä¸å®ƒçš„å®ç°æ— å…³ã€‚</p><p>å½“ä¸€ä¸ªç»„ç»‡åœ¨ä¸€ä¸ªæ¸ é“ä¸­æœ‰å¤šä¸ªpeeræ—¶ï¼Œå®ƒå¯ä»¥é€‰æ‹©åœ¨å“ªäº›peerèŠ‚ç‚¹å®‰è£…æ™ºèƒ½åˆçº¦ã€‚å®ƒä¸éœ€è¦åœ¨æ¯ä¸ªpeerèŠ‚ç‚¹ä¸Šå®‰è£…æ™ºèƒ½åˆçº¦ã€‚</p><h3 id="Defining-a-chaincodeï¼ˆå®šä¹‰é“¾ç ï¼‰">Defining a chaincodeï¼ˆå®šä¹‰é“¾ç ï¼‰</h3><p>å°½ç®¡é“¾ç å·²å®‰è£…åœ¨å„ä¸ªç»„ç»‡çš„peerä¸Šï¼Œä½†å®ƒæ˜¯åœ¨channelèŒƒå›´å†…ç®¡ç†å’Œæ“ä½œçš„ã€‚æ¯ä¸ªç»„ç»‡éƒ½éœ€è¦æ‰¹å‡†<strong>é“¾ç å®šä¹‰ï¼ˆchaincode definitionï¼‰</strong>ï¼Œè¿™æ˜¯ä¸€ç»„å‚æ•°ï¼Œç”¨äºç¡®å®šå¦‚ä½•åœ¨æ¸ é“ä¸Šä½¿ç”¨é“¾ç ã€‚ç»„ç»‡å¿…é¡»æ‰¹å‡†é“¾ç å®šä¹‰ï¼Œæ‰èƒ½ä½¿ç”¨å·²å®‰è£…çš„æ™ºèƒ½åˆçº¦æ¥æŸ¥è¯¢è´¦æœ¬å¹¶è®¤å¯äº¤æ˜“ã€‚åœ¨æˆ‘ä»¬çš„åªæœ‰ä¸€ä¸ªpeerèŠ‚ç‚¹P1çš„ä¾‹å­ä¸­ï¼Œç»„ç»‡R1ä¸­çš„ç®¡ç†å‘˜å¿…é¡»æ‰¹å‡†S5çš„<strong>é“¾ç å®šä¹‰ï¼ˆchaincode definitionï¼‰</strong>ã€‚</p><p>éœ€è¦è¶³å¤Ÿæ•°é‡çš„ç»„ç»‡æ‰¹å‡†<strong>é“¾ç å®šä¹‰ï¼ˆchaincode definitionï¼‰</strong>ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¸ºæ‰¹å‡†ï¼‰ï¼Œç„¶åæ‰èƒ½å°†<strong>é“¾ç å®šä¹‰</strong>æäº¤ç»™æ¸ é“å¹¶ç”¨äºä¸æ¸ é“è´¦æœ¬è¿›è¡Œäº¤äº’ã€‚ç”±äºä¾‹å­ä¸­çš„é€šé“C1åªæœ‰ä¸€ä¸ªæˆå‘˜ï¼Œå› æ­¤R1çš„ç®¡ç†å‘˜å¯ä»¥å°†S5çš„<strong>é“¾ç å®šä¹‰</strong>æäº¤ç»™é€šé“C1ã€‚æäº¤é“¾ç çš„å®šä¹‰åï¼Œä¾¿å¯ä»¥ç”±å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA1è°ƒç”¨S5ï¼</p><p>è¯·æ³¨æ„ï¼Œå°½ç®¡é€šé“ä¸Šçš„æ¯ä¸ªç»„ä»¶ç°åœ¨éƒ½å¯ä»¥è®¿é—®S5ï¼Œä½†å®ƒä»¬æ— æ³•çœ‹åˆ°å…¶ç¨‹åºé€»è¾‘ã€‚å¯¹äºå®‰è£…å®ƒçš„é‚£äº›èŠ‚ç‚¹ï¼ˆæˆ‘ä»¬çš„ç¤ºä¾‹ä¸­æ˜¯P1ï¼‰ï¼Œå®ƒä»ç„¶æ˜¯ç§æœ‰çš„ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œè¿™æ„å‘³ç€å·²å®šä¹‰å¹¶æäº¤ç»™æ¸ é“çš„æ™ºèƒ½åˆçº¦æ¥å£ä¸å·²å®‰è£…çš„æ™ºèƒ½åˆçº¦å®ç°ç›¸åã€‚åŠ å¼ºè¿™ä¸ªæƒ³æ³•ï¼›å®‰è£…æ™ºèƒ½åˆçº¦æˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä¸ºç‰©ç†æ‰˜ç®¡ï¼ˆ<strong>physically hosted</strong>ï¼‰åœ¨peerä¸Šï¼Œè€Œå·²åœ¨é€šé“ä¸Šå®šä¹‰çš„æ™ºèƒ½åˆçº¦æˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä¸ºé€»è¾‘æ‰˜ç®¡ï¼ˆ <strong>logically hosted</strong>ï¼‰åœ¨é€šé“ä¸Šã€‚</p><h3 id="Endorsement-policyï¼ˆèƒŒä¹¦ç­–ç•¥ï¼‰">Endorsement policyï¼ˆèƒŒä¹¦ç­–ç•¥ï¼‰</h3><p>é“¾ç å®šä¹‰ä¸­æä¾›çš„æœ€é‡è¦çš„ä¿¡æ¯æ˜¯èƒŒä¹¦ç­–ç•¥ã€‚å®ƒæè¿°äº†å“ªäº›ç»„ç»‡å¿…é¡»æ‰¹å‡†äº¤æ˜“ç„¶åå…¶ä»–ç»„ç»‡æ‰èƒ½å°†å…¶æ¥å—åˆ°å…¶è´¦æœ¬å‰¯æœ¬ä¸Šã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ç½‘ç»œä¸­ï¼Œåªæœ‰R1æˆ–R2è®¤å¯äº¤æ˜“ï¼Œæ‰èƒ½å°†äº¤æ˜“æ¥å—åˆ°è´¦æœ¬L1ä¸Šã€‚</p><p>å°†é“¾ç å®šä¹‰æäº¤ç»™æ¸ é“ä¼šå°†èƒŒä¹¦ç­–ç•¥æ”¾åœ¨æ¸ é“çš„è´¦æœ¬ä¸Šï¼›å®ƒä½¿é€šé“çš„ä»»ä½•æˆå‘˜éƒ½å¯ä»¥è®¿é—®å®ƒã€‚æ‚¨å¯ä»¥åœ¨<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/txflow.html">äº¤æ˜“æµ</a>ä¸»é¢˜ä¸­é˜…è¯»æœ‰å…³èƒŒä¹¦ç­–ç•¥çš„æ›´å¤šä¿¡æ¯ã€‚</p><h3 id="Invoking-a-smart-contractï¼ˆè°ƒç”¨æ™ºèƒ½åˆçº¦ï¼‰">Invoking a smart contractï¼ˆè°ƒç”¨æ™ºèƒ½åˆçº¦ï¼‰</h3><p>å°†æ™ºèƒ½åˆçº¦å®‰è£…åœ¨peerèŠ‚ç‚¹ä¸Šå¹¶åœ¨channelä¸Šå®šä¹‰åï¼Œå³å¯ç”±å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºè°ƒç”¨ã€‚</p><p>å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºé€šè¿‡å‘ç”±æ™ºèƒ½åˆçº¦èƒŒä¹¦ç­–ç•¥æŒ‡å®šçš„ç»„ç»‡æ‰€æ‹¥æœ‰çš„èŠ‚ç‚¹å‘èµ·äº¤æ˜“ææ¡ˆï¼›æ™ºèƒ½åˆçº¦ä½¿ç”¨äº¤æ˜“ææ¡ˆä½œä¸ºå®ƒçš„è¾“å…¥æ¥ç”Ÿæˆè®¤å¯çš„äº¤æ˜“å“åº”ï¼Œè¯¥å“åº”ç”±peerèŠ‚ç‚¹è¿”å›åˆ°å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚</p><p>è¿™äº›äº¤æ˜“å“åº”ä¸äº¤æ˜“æè®®æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå®Œå…¨è®¤å¯çš„äº¤æ˜“ï¼Œå¯ä»¥åˆ†æ•£åˆ°æ•´ä¸ªç½‘ç»œã€‚ç°åœ¨äº†è§£åº”ç”¨ç¨‹åºå¦‚ä½•è°ƒç”¨æ™ºèƒ½åˆçº¦ä»¥ç”Ÿæˆè®¤å¯çš„äº¤æ˜“å³å¯ï¼Œç¨åæˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œæ›´è¯¦ç»†çš„ä»‹ç»ã€‚</p><p>åœ¨ç½‘ç»œå¼€å‘çš„è¿™ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»„ç»‡R1æ­£åœ¨å®Œå…¨å‚ä¸ç½‘ç»œã€‚å®ƒçš„åº”ç”¨ç¨‹åº-ä»A1å¼€å§‹-å¯ä»¥é€šè¿‡æ™ºèƒ½åˆçº¦S5è®¿é—®è´¦æœ¬L1ï¼Œä»¥ç”Ÿæˆå°†ç”±R1è®¤å¯çš„äº¤æ˜“ï¼Œç”±äºå®ƒä»¬ç¬¦åˆè®¤å¯ç­–ç•¥å› æ­¤è¢«æ¥å—åˆ°è´¦æœ¬ä¸­ã€‚</p><h3 id="Network-completedï¼ˆç½‘ç»œå®Œæˆï¼‰">Network completedï¼ˆç½‘ç»œå®Œæˆï¼‰</h3><p>å›æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä¸ºè”ç›ŸX1ï¼ˆç»„ç»‡R1å’ŒR2ï¼‰åˆ›å»ºæ¸ é“ã€‚ç½‘ç»œå¼€å‘çš„ä¸‹ä¸€é˜¶æ®µå°†çœ‹åˆ°ç»„ç»‡R2å°†å…¶åŸºç¡€ç»“æ„æ·»åŠ åˆ°ç½‘ç»œä¸­ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹ç½‘ç»œè¿›åŒ–æˆä»€ä¹ˆæ ·äº†ï¼š<br><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/network.diagram.7.png" alt="network.diagram.7"><br><em>é€šè¿‡å¢åŠ ç»„ç»‡R2çš„åŸºç¡€ç»“æ„ï¼Œç½‘ç»œå¾—åˆ°äº†å‘å±•ã€‚å…·ä½“æ¥è¯´ï¼ŒR2æ·»åŠ äº†peerèŠ‚ç‚¹P2ï¼Œè¯¥peerèŠ‚ç‚¹æ‰˜ç®¡è´¦æœ¬L1çš„å‰¯æœ¬å’Œé“¾ç S5ã€‚R2æ‰¹å‡†ä¸R1ç›¸åŒçš„é“¾ç å®šä¹‰ã€‚P2ä¹Ÿä¸åº”ç”¨ç¨‹åºA2ä¸€æ ·åŠ å…¥äº†é€šé“C1ï¼ŒA2å’ŒP2é€šè¿‡CA2è¿›è¡Œèº«ä»½è®¤è¯ã€‚æ‰€æœ‰è¿™äº›æ„å‘³ç€åº”ç”¨ç¨‹åºA1å’ŒA2éƒ½å¯ä»¥ä½¿ç”¨peerèŠ‚ç‚¹P1æˆ–P2åœ¨C1ä¸Šè°ƒç”¨S5ã€‚</em></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»„ç»‡R2åœ¨é€šé“C1ä¸Šæ·»åŠ äº†ä¸€ä¸ªpeerèŠ‚ç‚¹P2ã€‚ P2è¿˜æ‰˜ç®¡è´¦æœ¬L1çš„å‰¯æœ¬å’Œæ™ºèƒ½åˆçº¦S5ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°R2è¿˜æ·»åŠ äº†å¯ä»¥é€šè¿‡é€šé“C1è¿æ¥åˆ°ç½‘ç»œçš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA2ã€‚ä¸ºæ­¤ï¼Œç»„ç»‡R2ä¸­çš„ç®¡ç†å‘˜å·²åˆ›å»ºpeerèŠ‚ç‚¹P2ï¼Œå¹¶å°†å…¶ç”¨ä¸R1ä¸­çš„ç®¡ç†å‘˜ç›¸åŒçš„æ–¹å¼åŠ å…¥åˆ°é€šé“C1ã€‚ç®¡ç†å‘˜è¿˜å¿…é¡»æ‰¹å‡†ä¸R1ç›¸åŒçš„é“¾ç å®šä¹‰ã€‚</p><p>æˆ‘ä»¬å·²ç»å»ºç«‹äº†ç¬¬ä¸€ä¸ªè¿è¥ç½‘ç»œï¼åœ¨ç½‘ç»œå¼€å‘çš„ç°é˜¶æ®µï¼Œæˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªæ¸ é“ï¼Œåœ¨æ­¤é€šé“ä¸Šç»„ç»‡R1å’ŒR2å¯ä»¥å½¼æ­¤è¿›è¡Œäº¤æ˜“ã€‚å…·ä½“æ¥è¯´ï¼Œè¿™æ„å‘³ç€åº”ç”¨ç¨‹åºA1å’ŒA2å¯ä»¥ä½¿ç”¨æ™ºèƒ½åˆçº¦S5å’Œé€šé“C1ä¸Šçš„è´¦æœ¬L1ç”Ÿæˆäº¤æ˜“ã€‚</p><h3 id="Generating-and-accepting-transactionsï¼ˆç”Ÿæˆå’Œæ¥å—äº¤æ˜“ï¼‰">Generating and accepting transactionsï¼ˆç”Ÿæˆå’Œæ¥å—äº¤æ˜“ï¼‰</h3><p>ä¸å§‹ç»ˆæ‰˜ç®¡ç€è´¦æœ¬å‰¯æœ¬çš„peerèŠ‚ç‚¹ç›¸åï¼Œæˆ‘ä»¬çœ‹åˆ°æœ‰ä¸¤ç§ä¸åŒçš„peerèŠ‚ç‚¹ï¼šæ‹¥æœ‰æ™ºèƒ½åˆçº¦çš„peerå’Œæ²¡æœ‰æ™ºèƒ½åˆçº¦çš„peerã€‚åœ¨æˆ‘ä»¬çš„ç½‘ç»œä¸­ï¼Œæ¯ä¸ªpeeréƒ½æ‰˜ç®¡ç€æ™ºèƒ½åˆçº¦çš„å‰¯æœ¬ï¼Œä½†æ˜¯åœ¨è¾ƒå¤§çš„ç½‘ç»œä¸­ï¼Œå°†æœ‰æ›´å¤šçš„peerèŠ‚ç‚¹ä¸æ‰˜ç®¡æ™ºèƒ½åˆçº¦çš„å‰¯æœ¬ã€‚peerèŠ‚ç‚¹åªèƒ½è¿è¡Œå®‰è£…åœ¨å…¶ä¸Šçš„æ™ºèƒ½åˆçº¦ï¼Œä½†æ˜¯å®ƒå¯ä»¥é€šè¿‡è¿æ¥åˆ°é€šé“æ¥çŸ¥é“æ™ºèƒ½åˆçº¦çš„æ¥å£ã€‚</p><p>æ‚¨ä¸åº”è¯¥å°†æ²¡æœ‰å®‰è£…æ™ºèƒ½åˆçº¦çš„peerèŠ‚ç‚¹è§†ä¸ºåŠ£ç­‰èŠ‚ç‚¹ã€‚å…·æœ‰æ™ºèƒ½åˆçº¦çš„peerèŠ‚ç‚¹æ›´å…·æœ‰ç‰¹æ®Šçš„åŠŸèƒ½-æœ‰åŠ©äº**ç”Ÿæˆï¼ˆgenerate ï¼‰<strong>äº¤æ˜“ã€‚è¯·æ³¨æ„ï¼Œæ‰€æœ‰peerèŠ‚ç‚¹éƒ½å¯ä»¥</strong>éªŒè¯ï¼ˆvalidateï¼‰<strong>å¹¶éšå</strong>æ¥å—ï¼ˆacceptï¼‰<strong>æˆ–</strong>æ‹’ç»ï¼ˆrejectï¼‰<strong>äº¤æ˜“åˆ°å…¶è´¦æœ¬L1çš„å‰¯æœ¬ä¸Šã€‚ä½†æ˜¯ï¼Œåªæœ‰å®‰è£…äº†æ™ºèƒ½åˆçº¦çš„peerèŠ‚ç‚¹æ‰èƒ½å‚ä¸äº¤æ˜“</strong>è®¤å¯ï¼ˆendorsementï¼‰**çš„è¿‡ç¨‹ï¼Œè¿™å¯¹ç”Ÿæˆåˆæ³•äº¤æ˜“è‡³å…³é‡è¦ã€‚</p><p>æˆ‘ä»¬æ— éœ€æ‹…å¿ƒæœ¬ä¸»é¢˜ä¸­å¦‚ä½•ç”Ÿæˆï¼Œåˆ†é…å’Œæ¥å—äº¤æ˜“çš„ç¡®åˆ‡ç»†èŠ‚â€“èƒ½å¤Ÿç†è§£æˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªåŒºå—é“¾ç½‘ç»œï¼Œç»„ç»‡R1å’ŒR2å¯ä»¥å…±äº«ä¿¡æ¯å’Œæµç¨‹ä½œä¸ºè´¦æœ¬æ¥å—ï¼ˆledger-capturedï¼‰çš„äº¤æ˜“ã€‚æˆ‘ä»¬å°†åœ¨å…¶ä»–ä¸»é¢˜ä¸­å­¦ä¹ æœ‰å…³äº¤æ˜“ï¼Œè´¦æœ¬ï¼Œæ™ºèƒ½åˆçº¦çš„æ›´å¤šä¿¡æ¯ã€‚</p><h3 id="Types-of-peersï¼ˆpeerèŠ‚ç‚¹çš„ç±»å‹ï¼‰">Types of peersï¼ˆpeerèŠ‚ç‚¹çš„ç±»å‹ï¼‰</h3><p>åœ¨Hyperledger Fabricä¸­ï¼Œå°½ç®¡æ‰€æœ‰peeréƒ½ç›¸åŒï¼Œä½†å®ƒä»¬å¯ä»¥æ ¹æ®ç½‘ç»œçš„é…ç½®æ–¹å¼æ‰¿æ‹…å¤šä¸ªè§’è‰²ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯¹å…¸å‹çš„ç½‘ç»œæ‹“æ‰‘æœ‰äº†è¶³å¤Ÿçš„äº†è§£ï¼Œå¯ä»¥æè¿°è¿™äº›è§’è‰²ã€‚</p><ul><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/glossary.html#commitment">Committing peer</a>ï¼šæäº¤peerèŠ‚ç‚¹ï¼Œé€šé“ä¸­çš„æ¯ä¸ªpeerèŠ‚ç‚¹éƒ½æ˜¯æäº¤peerèŠ‚ç‚¹ã€‚å®ƒæ¥æ”¶åŒ…å«å·²ç»ç”Ÿæˆçš„äº¤æ˜“çš„å—ï¼Œéšåå°†å…¶éªŒè¯ï¼Œç„¶åå†å°†å®ƒä»¬ä»¥è¿½åŠ çš„æ–¹å¼æäº¤åˆ°peerèŠ‚ç‚¹çš„è´¦æœ¬å‰¯æœ¬ä¸­ã€‚</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/glossary.html#endorsement">Endorsing peer</a>ï¼šèƒŒä¹¦èŠ‚ç‚¹ï¼Œæ¯ä¸€ä¸ªå®‰è£…äº†æ™ºèƒ½åˆçº¦çš„peerèŠ‚ç‚¹éƒ½å¯ä»¥æˆä¸ºèƒŒä¹¦èŠ‚ç‚¹ã€‚ä½†æ˜¯è¦çœŸæ­£æˆä¸ºèƒŒä¹¦èŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¿…é¡»ä½¿ç”¨peerçš„æ™ºèƒ½åˆçº¦æ¥ç”Ÿæˆæ•°å­—ç­¾åçš„äº‹åŠ¡å“åº”ã€‚èƒŒä¹¦å¯¹ç­‰æ–¹ä¸€è¯æ˜¯å¯¹æ­¤äº‹å®çš„æ˜ç¡®å¼•ç”¨ã€‚<br>æ™ºèƒ½åˆçº¦çš„èƒŒä¹¦ç­–ç•¥ç¡®å®šç»„ç»‡çš„peeråº”å…ˆå¯¹ç”Ÿæˆçš„äº¤æ˜“è¿›è¡Œæ•°å­—ç­¾åï¼Œç„¶åæ‰èƒ½å°†å…¶æ¥å—åˆ°æäº¤peerçš„è´¦æœ¬å‰¯æœ¬ä¸­ã€‚</li></ul><p>ä¸Šé¢æ˜¯peerèŠ‚ç‚¹çš„çš„ä¸¤ç§ä¸»è¦ç±»å‹ã€‚peerè¿˜å¯ä»¥é‡‡ç”¨å…¶ä»–ä¸¤ç§è§’è‰²ï¼š</p><ul><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/glossary.html#leading-peer">Leader peer</a>ï¼šé¢†å¯¼èŠ‚ç‚¹ï¼Œå½“ä¸€ä¸ªç»„ç»‡åœ¨åŒä¸€ä¸ªchannelä¸­æœ‰å¤šä¸ªpeerèŠ‚ç‚¹æ—¶ï¼Œé¢†å¯¼èŠ‚ç‚¹è´Ÿè´£å°†äº¤æ˜“ä»æ’åºèŠ‚ç‚¹åˆ†å‘åˆ°ç»„ç»‡å†…çš„å…¶ä»–æäº¤èŠ‚ç‚¹ã€‚ä¸€ä¸ªpeerå¯ä»¥é€‰æ‹©å‚ä¸é™æ€æˆ–åŠ¨æ€é¢†å¯¼é€‰æ‹©ã€‚</li></ul><p>å› æ­¤ï¼Œä»é¢†å¯¼è€…çš„è§’åº¦è€ƒè™‘ä¸¤ç»„peeræ˜¯æœ‰å¸®åŠ©çš„-é‚£äº›å…·æœ‰é™æ€é¢†å¯¼è€…é€‰æ‹©çš„peerå’Œé‚£äº›å…·æœ‰åŠ¨æ€é¢†å¯¼è€…é€‰æ‹©çš„peerã€‚å¯¹äºé™æ€èŠ‚ç‚¹ï¼Œå¯ä»¥å°†é›¶ä¸ªæˆ–å¤šä¸ªpeeré…ç½®ä¸ºé¢†å¯¼èŠ‚ç‚¹ã€‚å¯¹äºåŠ¨æ€èŠ‚ç‚¹é›†åˆï¼Œå°†ç”±è¯¥é›†åˆé€‰å‡ºä¸€ä¸ªpeerä½œä¸ºé¢†å¯¼è€…ã€‚æ­¤å¤–ï¼Œåœ¨åŠ¨æ€é›†åˆä¸­ï¼Œå¦‚æœé¢†å¯¼èŠ‚ç‚¹å¤±è´¥äº†ï¼Œåˆ™å…¶ä½™peerå°†é‡æ–°é€‰ä¸¾é¢†å¯¼èŠ‚ç‚¹ã€‚</p><p>è¿™æ„å‘³ç€åŒä¸€ä¸ªç»„ç»‡çš„peerså¯ä»¥è®©ä¸€ä¸ªæˆ–å¤šä¸ªé¢†å¯¼èŠ‚ç‚¹è¿æ¥åˆ°æ’åºæœåŠ¡ã€‚è¿™å¯ä»¥å¸®åŠ©æé«˜å¤„ç†å¤§é‡äº‹åŠ¡çš„å¤§å‹ç½‘ç»œçš„å¼¹æ€§å’Œå¯ä¼¸ç¼©æ€§ã€‚</p><ul><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/glossary.html#anchor-peer">Anchor peer</a>:é”šèŠ‚ç‚¹ï¼Œå¦‚æœpeeréœ€è¦ä¸å¦ä¸€ä¸ªç»„ç»‡ä¸­çš„peerè¿›è¡Œé€šä¿¡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¯¥ç»„ç»‡åœ¨é€šé“é…ç½®ä¸­å®šä¹‰çš„é”šèŠ‚ç‚¹ã€‚ä¸€ä¸ªç»„ç»‡å¯ä»¥ä¸ºå…¶å®šä¹‰é›¶ä¸ªæˆ–å¤šä¸ªé”šèŠ‚ç‚¹ï¼Œå¹¶ä¸”é”šèŠ‚ç‚¹å¯ä»¥å¸®åŠ©å¤„ç†è®¸å¤šä¸åŒçš„è·¨ç»„ç»‡é€šä¿¡åœºæ™¯ã€‚</li></ul><p>æ³¨æ„ï¼Œä¸€ä¸ªpeerå¯ä»¥åŒæ—¶æ˜¯ä¸€ä¸ªæäº¤èŠ‚ç‚¹ã€èƒŒä¹¦èŠ‚ç‚¹ã€é¢†å¯¼èŠ‚ç‚¹å’Œé”šèŠ‚ç‚¹ï¼åœ¨ä¸€ä¸ªç»„ç»‡ä¸­å‡ºäºæ‰€æœ‰å®é™…ç›®çš„ï¼Œä»…é”šèŠ‚ç‚¹æ˜¯å¯é€‰çš„ï¼Œé¢†å¯¼èŠ‚ç‚¹ï¼ŒèƒŒä¹¦èŠ‚ç‚¹å’Œæäº¤èŠ‚ç‚¹éƒ½è‡³å°‘æœ‰ä¸€ä¸ªã€‚</p><h3 id="Adding-organizations-and-peers-to-the-channelï¼ˆå°†ç»„ç»‡å’ŒèŠ‚ç‚¹æ·»åŠ åˆ°æ¸ é“ï¼‰">Adding organizations and peers to the channelï¼ˆå°†ç»„ç»‡å’ŒèŠ‚ç‚¹æ·»åŠ åˆ°æ¸ é“ï¼‰</h3><p>å½“ç»„ç»‡R2åŠ å…¥é€šé“æ—¶ï¼Œå®ƒå¿…é¡»åœ¨å…¶peerèŠ‚ç‚¹P2ä¸Šå®‰è£…æ™ºèƒ½åˆçº¦S5ã€‚è¿™å¾ˆæ˜æ˜¾â€“å¦‚æœåº”ç”¨ç¨‹åºA1æˆ–A2å¸Œæœ›åœ¨peerèŠ‚ç‚¹P2ä¸Šä½¿ç”¨S5æ¥ç”Ÿæˆäº¤æ˜“ï¼Œé¦–å…ˆS5å¿…é¡»å­˜åœ¨ï¼Œå®‰è£…æ™ºèƒ½åˆçº¦å¯ä»¥åšåˆ°è®©å…¶å­˜åœ¨ã€‚æ­¤æ—¶ï¼ŒpeerèŠ‚ç‚¹P2å…·æœ‰æ™ºèƒ½åˆçº¦å’Œè´¦æœ¬çš„ç‰©ç†å‰¯æœ¬ï¼›åƒP1ä¸€æ ·ï¼Œå®ƒå¯ä»¥åœ¨å…¶è´¦æœ¬L1çš„å‰¯æœ¬ä¸Šç”Ÿæˆå’Œæ¥å—äº¤æ˜“ã€‚</p><p>ä¸ºäº†ä½¿ç”¨æ™ºèƒ½åˆçº¦S5ï¼ŒR2å¿…é¡»æ‰¹å‡†ä¸R1æ‰¹å‡†çš„ç›¸åŒçš„é“¾ç å®šä¹‰ã€‚ç”±äºé“¾ç å®šä¹‰å·²ç”±ç»„ç»‡R1æäº¤ç»™é€šé“ï¼Œå› æ­¤R2ç»„ç»‡æ‰¹å‡†é“¾ç å®šä¹‰å¹¶å®‰è£…é“¾ç è½¯ä»¶åŒ…åä¾¿å¯ä»¥ä½¿ç”¨é“¾ç äº†ã€‚æäº¤äº¤æ˜“åªéœ€å‘ç”Ÿä¸€æ¬¡ã€‚ä¸€ä¸ªæ–°çš„ç»„ç»‡è®¤å¯é“¾ç å‚æ•°çš„è¡Œä¸ºè¢«é€šé“å†…çš„å…¶ä»–ç»„ç»‡ç»Ÿä¸€åä¾¿å¯ä»¥ä½¿ç”¨é“¾ç ã€‚ç”±äºé“¾ç å®šä¹‰çš„è®¤å¯æ˜¯åœ¨ç»„ç»‡çº§åˆ«è¿›è¡Œçš„ï¼Œå› æ­¤R2è®¤å¯é“¾ç å®šä¹‰ä¸€æ¬¡ï¼Œç„¶åå°†å¤šä¸ªpeerèŠ‚ç‚¹åŠ å…¥å®‰è£…äº†é“¾ç åŒ…çš„æ¸ é“ã€‚ç„¶è€Œï¼Œå¦‚æœR2æƒ³è¦å¯¹é“¾ç å®šä¹‰è¿›è¡Œä¿®æ”¹çš„è¯ï¼Œåˆ™R1å’ŒR2éƒ½éœ€è¦åœ¨ç»„ç»‡å±‚é¢è®¤å¯è¿™ä¸ªæ–°çš„é“¾ç å®šä¹‰ï¼Œç„¶åéœ€è¦å…¶ä¸­ä¸€ä¸ªç»„ç»‡å°†å®šä¹‰æäº¤ç»™æ¸ é“ã€‚</p><p>åœ¨æˆ‘ä»¬çš„ç½‘ç»œä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é€šé“C1é“¾æ¥äº†ä¸¤ä¸ªå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œä¸¤ä¸ªpeerèŠ‚ç‚¹å’Œä¸€ä¸ªæ’åºæœåŠ¡ã€‚ç”±äºåªæœ‰ä¸€ä¸ªé€šé“ï¼Œå› æ­¤ä¹Ÿåªæœ‰ä¸€ä¸ªé€»è¾‘è´¦æœ¬å¯ä»¥ä¸è¿™äº›ç»„ä»¶è¿›è¡Œäº¤äº’ã€‚èŠ‚ç‚¹P1å’ŒP2æœ‰ç›¸åŒçš„è´¦æœ¬L1çš„å‰¯æœ¬ã€‚æ™ºèƒ½åˆçº¦S5çš„å‰¯æœ¬é€šå¸¸ä½¿ç”¨ç›¸åŒçš„ç¼–ç¨‹è¯­è¨€æ¥å®ç°ï¼Œä½†å¦‚æœä¸åŒï¼Œåˆ™ä»–ä»¬åœ¨è¯­ä¹‰ä¸Šå¿…é¡»ç­‰æ•ˆã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå°†å¯¹peerå°å¿ƒåœ°æ·»åŠ åˆ°ç½‘ç»œå¯ä»¥å¸®åŠ©æ”¯æŒå¢åŠ çš„ååé‡ï¼Œç¨³å®šæ€§å’Œå¼¹æ€§ã€‚ä¾‹å¦‚ï¼Œç½‘ç»œä¸­æ›´å¤šçš„peerèŠ‚ç‚¹å°†å…è®¸æ›´å¤šçš„åº”ç”¨ç¨‹åºè¿æ¥åˆ°å®ƒï¼›åœ¨é‡åˆ°è®¡åˆ’å†…æˆ–è®¡åˆ’å¤–çš„åœæœºæ—¶ç»„ç»‡ä¸­çš„å¤šä¸ªpeerå°†æä¾›é¢å¤–çš„å¼¹æ€§ã€‚</p><p>è¿™ä¸€åˆ‡éƒ½æ„å‘³ç€å¯ä»¥é…ç½®æ”¯æŒå„ç§æ“ä½œç›®æ ‡çš„å¤æ‚çš„æ‹“æ‰‘ç½‘ç»œï¼Œç½‘ç»œå¯ä»¥è¾¾åˆ°çš„è§„æ¨¡ä¸å­˜åœ¨ç†è®ºä¸Šçš„é™åˆ¶ã€‚æ­¤å¤–ï¼Œå•ä¸ªç»„ç»‡ä¸­çš„peerå¯ä»¥æœ‰æ•ˆåœ°å‘ç°å¹¶å½¼æ­¤é€šä¿¡çš„æŠ€æœ¯æœºåˆ¶-<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/gossip.html#gossip-protocol">gossip protocol</a>-å°†å®¹çº³å¤§é‡peerèŠ‚ç‚¹ä»¥æ”¯æŒæ­¤ç±»æ‹“æ‰‘ã€‚</p><p>ä»”ç»†ä½¿ç”¨ç½‘ç»œå’Œé€šé“ç­–ç•¥å¯ä»¥ä½¿å¤§å‹ç½‘ç»œå¾—åˆ°è‰¯å¥½ç®¡ç†ã€‚ç»„ç»‡å¯ä»¥è‡ªç”±åœ°å°†peerèŠ‚ç‚¹æ·»åŠ åˆ°ç½‘ç»œï¼Œåªè¦å®ƒä»¬ç¬¦åˆç½‘ç»œçº¦å®šçš„ç­–ç•¥å³å¯ã€‚ç½‘ç»œå’Œæ¸ é“ç­–ç•¥åœ¨è‡ªæ²»å’Œæ§åˆ¶ä¹‹é—´å»ºç«‹äº†å¹³è¡¡ï¼Œè¿™æ˜¯å»ä¸­å¿ƒåŒ–ç½‘ç»œçš„ç‰¹å¾ã€‚</p><h2 id="Simplifying-the-visual-vocabularyï¼ˆç®€åŒ–è§†è§‰è¯æ±‡ï¼‰">Simplifying the visual vocabularyï¼ˆç®€åŒ–è§†è§‰è¯æ±‡ï¼‰</h2><p>Weâ€™re now going to simplify the visual vocabulary used to represent our sample blockchain network. As the size of the network grows, the lines initially used to help us understand channels will become cumbersome. Imagine how complicated our diagram would be if we added another peer or client application, or another channel?</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†ç®€åŒ–ç”¨äºè¡¨ç¤ºç¤ºä¾‹åŒºå—é“¾ç½‘ç»œçš„è§†è§‰è¯æ±‡ã€‚éšç€ç½‘ç»œè§„æ¨¡çš„æ‰©å¤§ï¼Œæœ€åˆç”¨äºå¸®åŠ©æˆ‘ä»¬äº†è§£æ¸ é“çš„çº¿è·¯å°†å˜å¾—å¾ˆç¹çã€‚æƒ³æƒ³ä¸€äº›å¦‚æœæˆ‘ä»¬æ·»åŠ å¦ä¸€ä¸ªpeerèŠ‚ç‚¹æˆ–è€…ä¸€ä¸ªå®¢æˆ·ç«¯æˆ–è€…å¦ä¸€ä¸ªchannelæˆ‘ä»¬çš„å›¾ç‰‡æœ‰å¤šå¤æ‚ï¼Ÿ</p><p>Thatâ€™s what weâ€™re going to do in a minute, so before we do, letâ€™s simplify the visual vocabulary. Hereâ€™s a simplified representation of the network weâ€™ve developed so far:</p><p>è¿™å°±æ˜¯æˆ‘ä»¬ç´§æ¥ç€è¦åšçš„äº‹æƒ…ï¼Œå› æ­¤åœ¨æˆ‘ä»¬è¿™æ ·åšä¹‹å‰ï¼Œè®©æˆ‘ä»¬ç®€åŒ–è§†è§‰è¯æ±‡ã€‚è¿™æ˜¯åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å¼€å‘çš„ç½‘ç»œçš„ç®€åŒ–è¡¨ç¤ºï¼š</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/network.diagram.8.png" alt="network.diagram.8"></p><p><em>The diagram shows the facts relating to channel C1 in the network N as follows: Client applications A1 and A2 can use channel C1 for communication with peers P1 and P2, and orderer O4. Peer nodes P1 and P2 can use the communication services of channel C1. Ordering service O4 can make use of the communication services of channel C1. Channel configuration CC1 applies to channel C1.</em></p><p><em>è¯¥å›¾æ˜¾ç¤ºäº†ä¸ç½‘ç»œNä¸­çš„é€šé“C1æœ‰å…³çš„äº‹å®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šå®¢æˆ·ç«¯ç¨‹åºA1å’ŒA2å¯ä»¥ä½¿ç”¨é€šé“C1æ¥ä¸peerèŠ‚ç‚¹P1å’ŒP2å’Œæ’åºèŠ‚ç‚¹O4è¿›è¡Œé€šä¿¡ã€‚peerèŠ‚ç‚¹P1å’ŒP2å¯ä»¥ä½¿ç”¨é€šé“C1çš„é€šä¿¡æœåŠ¡ã€‚æ’åºæœåŠ¡O4å¯ä»¥åˆ©ç”¨é€šé“C1çš„é€šä¿¡æœåŠ¡ã€‚é€šé“é…ç½®CC1é€‚ç”¨äºé€šé“C1ã€‚</em></p><p>Note that the network diagram has been simplified by replacing channel lines with connection points, shown as blue circles which include the channel number. No information has been lost. This representation is more scalable because it eliminates crossing lines. This allows us to more clearly represent larger networks. Weâ€™ve achieved this simplification by focusing on the connection points between components and a channel, rather than the channel itself.</p><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªç½‘ç»œå›¾å·²ç»é€šè¿‡ç”¨è¿æ¥ç‚¹æ›¿æ¢é€šé“çº¿æ¥ç®€åŒ–äº†ï¼Œæ˜¾ç¤ºä¸ºå¸¦æœ‰é€šé“ç¼–å·çš„è“è‰²åœ†åœˆã€‚æ²¡æœ‰ä¿¡æ¯ä¸¢å¤±ã€‚æ­¤è¡¨ç¤ºå½¢å¼æ›´å…·ä¼¸ç¼©æ€§ï¼Œå› ä¸ºå®ƒæ¶ˆé™¤äº†äº¤å‰çº¿ã€‚è¿™ä½¿æˆ‘ä»¬å¯ä»¥æ›´æ¸…æ¥šåœ°è¡¨ç¤ºæ›´å¤§çš„ç½‘ç»œã€‚é€šè¿‡ä¸“æ³¨äºç»„ä»¶å’Œé€šé“ä¹‹é—´çš„è¿æ¥ç‚¹ï¼Œè€Œä¸æ˜¯é€šé“æœ¬èº«ï¼Œæˆ‘ä»¬å®ç°äº†è¿™ç§ç®€åŒ–ã€‚</p><h2 id="Adding-another-consortium-definitionï¼ˆæ·»åŠ å¦ä¸€ä¸ªè”ç›Ÿå®šä¹‰ï¼‰">Adding another consortium definitionï¼ˆæ·»åŠ å¦ä¸€ä¸ªè”ç›Ÿå®šä¹‰ï¼‰</h2><p>In this next phase of network development, we introduce organization R3. Weâ€™re going to give organizations R2 and R3 a separate application channel which allows them to transact with each other. This application channel will be completely separate to that previously defined, so that R2 and R3 transactions can be kept private to them.</p><p>åœ¨ç½‘ç»œå¼€å‘çš„ä¸‹ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬ä»‹ç»ç»„ç»‡R3ã€‚æˆ‘ä»¬å°†ä¸ºç»„ç»‡R2å’ŒR3æä¾›ä¸€ä¸ªå•ç‹¬çš„åº”ç”¨ç¨‹åºæ¸ é“ï¼Œä½¿ä»–ä»¬å¯ä»¥å½¼æ­¤è¿›è¡Œäº¤æ˜“ã€‚è¯¥åº”ç”¨ç¨‹åºé€šé“å°†ä¸å…ˆå‰å®šä¹‰çš„é€šé“å®Œå…¨åˆ†å¼€ï¼Œå› æ­¤å¯ä»¥ä½¿R2å’ŒR3çš„äº¤æ˜“ä¿æŒç§æœ‰ã€‚</p><p>Letâ€™s return to the network level and define a new consortium, X2, for R2 and R3:</p><p>è®©æˆ‘ä»¬å›åˆ°ç½‘ç»œçº§åˆ«å¹¶ä¸”ä¸ºR2å’ŒR3å®šä¹‰ä¸€ä¸ªæ–°çš„è”ç›ŸX2ï¼š</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/network.diagram.9.png" alt="network.diagram.9"></p><p><em>A network administrator from organization R1 or R4 has added a new consortium definition, X2, which includes organizations R2 and R3. This will be used to define a new channel for X2.</em></p><p><em>R1æˆ–è€…R4çš„ç½‘ç»œç®¡ç†å‘˜å·²ç»æ·»åŠ äº†ä¸€ä¸ªæ–°çš„è”ç›Ÿå®šä¹‰X2ï¼Œè¿™ä¸ªè”ç›Ÿå®šä¹‰åŒ…å«äº†R2å’ŒR3ä¸¤ä¸ªç»„ç»‡ã€‚è¿™å°†è¢«ç”¨äºä¸ºX2å®šä¹‰ä¸€ä¸ªæ–°çš„é€šé“ã€‚</em></p><p>Notice that the network now has two consortia defined: X1 for organizations R1 and R2 and X2 for organizations R2 and R3. Consortium X2 has been introduced in order to be able to create a new channel for R2 and R3.</p><p>æ³¨æ„ç½‘ç»œä¸­ç°åœ¨å·²ç»æœ‰ä¸¤ä¸ªè”ç›Ÿå®šä¹‰ï¼Œç»„ç»‡R1ä¸R2çš„è”ç›ŸX1å’Œç»„ç»‡R2ä¸R3çš„è”ç›ŸX2ã€‚è”ç›ŸX2å·²ç»è¢«å¼•è¿›ä»¥ä¾¿ä¸ºR2å’ŒR3åˆ›å»ºæ–°çš„é€šé“ã€‚</p><p>A new channel can only be created by those organizations specifically identified in the network configuration policy, NC4, as having the appropriate rights to do so, i.e. R1 or R4. This is an example of a policy which separates organizations that can manage resources at the network level versus those who can manage resources at the channel level. Seeing these policies at work helps us understand why Hyperledger Fabric has a sophisticated <strong>tiered</strong> policy structure.</p><p>æ–°æ¸ é“åªèƒ½ç”±ç½‘ç»œé…ç½®ç­–ç•¥ä¸­æ˜ç¡®æ ‡è¯†çš„ç»„ç»‡åˆ›å»ºï¼Œç½‘ç»œä¸­NC4å…·æœ‰é€‚å½“æƒé™çš„ï¼Œå³R1æˆ–R4ã€‚è¿™æ˜¯ç­–ç•¥çš„ç¤ºä¾‹ï¼Œè¯¥ç­–ç•¥å°†å¯ä»¥åœ¨ç½‘ç»œçº§åˆ«ç®¡ç†èµ„æºçš„ç»„ç»‡ä¸å¯ä»¥åœ¨é€šé“çº§åˆ«ç®¡ç†èµ„æºçš„ç»„ç»‡åŒºåˆ†å¼€æ¥ã€‚çœ‹åˆ°è¿™äº›ç­–ç•¥åœ¨èµ·ä½œç”¨ï¼Œæœ‰åŠ©äºæˆ‘ä»¬ç†è§£ä¸ºä»€ä¹ˆHyperledger Fabricå…·æœ‰å¤æ‚çš„åˆ†å±‚ç­–ç•¥ç»“æ„ã€‚</p><p>In practice, consortium definition X2 has been added to the network configuration NC4. We discuss the exact mechanics of this operation elsewhere in the documentation.</p><p>å®é™…ä¸Šï¼Œè”ç›Ÿå®šä¹‰X2å·²æ·»åŠ åˆ°ç½‘ç»œé…ç½®NC4ã€‚æˆ‘ä»¬å°†åœ¨æ–‡æ¡£çš„å…¶ä»–åœ°æ–¹è®¨è®ºæ­¤æ“ä½œçš„ç¡®åˆ‡æœºåˆ¶ã€‚</p><h2 id="Adding-a-new-channelï¼ˆæ·»åŠ ä¸€ä¸ªæ–°çš„é€šé“ï¼‰">Adding a new channelï¼ˆæ·»åŠ ä¸€ä¸ªæ–°çš„é€šé“ï¼‰</h2><p>Letâ€™s now use this new consortium definition, X2, to create a new channel, C2. To help reinforce your understanding of the simpler channel notation, weâ€™ve used both visual styles â€“ channel C1 is represented with blue circular end points, whereas channel C2 is represented with red connecting lines:</p><p>è®©æˆ‘ä»¬ä½¿ç”¨æ–°çš„X2è”ç›Ÿå®šä¹‰æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„é€šé“C2ã€‚ä¸ºäº†å¸®åŠ©æ‚¨è¿›ä¸€æ­¥ç†è§£æ›´ç®€å•çš„é€šé“ç¬¦å·ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸¤ç§è§†è§‰æ ·å¼-é€šé“C1ç”¨è“è‰²åœ†å½¢ç«¯ç‚¹è¡¨ç¤ºï¼Œè€Œé€šé“C2ç”¨çº¢è‰²è¿æ¥çº¿è¡¨ç¤ºï¼š</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/network.diagram.10.png" alt="network.diagram.10"></p><p><em>A new channel C2 has been created for R2 and R3 using consortium definition X2. The channel has a channel configuration CC2, completely separate to the network configuration NC4, and the channel configuration CC1. Channel C2 is managed by R2 and R3 who have equal rights over C2 as defined by a policy in CC2. R1 and R4 have no rights defined in CC2 whatsoever.</em></p><p><em>ä½¿ç”¨è”ç›Ÿå®šä¹‰X2ä¸ºR2å’ŒR3åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„é€šé“C2ã€‚è¿™ä¸ªé€šé“æœ‰ä¸€ä¸ªé€šé“é…ç½®CC2ï¼Œå®Œå…¨ç‹¬ç«‹äºç½‘ç»œé…ç½®NC4å’Œé€šé“é…ç½®CC1ã€‚é€šé“C2ç”±R2å’ŒR3ç®¡ç†ï¼Œå®ƒä»¬å…·æœ‰CC2ä¸­çš„ç­–ç•¥æ‰€å®šä¹‰çš„å¯¹C2ç›¸åŒçš„æƒé™ã€‚ R1å’ŒR4åœ¨CC2ä¸­å‡æœªå®šä¹‰ä»»ä½•æƒé™ã€‚</em></p><p>The channel C2 provides a private communications mechanism for the consortium X2. Again, notice how organizations united in a consortium are what form channels. The channel configuration CC2 now contains the policies that govern channel resources, assigning management rights to organizations R2 and R3 over channel C2. It is managed exclusively by R2 and R3; R1 and R4 have no power in channel C2. For example, channel configuration CC2 can subsequently be updated to add organizations to support network growth, but this can only be done by R2 or R3.</p><p>é€šé“C2ä¸ºè”ç›ŸX2æä¾›äº†ä¸“ç”¨é€šä¿¡æœºåˆ¶ã€‚å†æ¬¡æ³¨æ„ï¼Œç»„ç»‡æ˜¯å¦‚ä½•é€šè¿‡é€šé“è¢«è”åˆèµ·æ¥çš„ã€‚é€šé“é…ç½®CC2ç°åœ¨åŒ…å«æ§åˆ¶é€šé“èµ„æºçš„ç­–ç•¥ï¼Œé€šè¿‡é€šé“C2å‘ç»„ç»‡R2å’ŒR3åˆ†é…ç®¡ç†æƒé™ã€‚å®ƒä»…ç”±R2å’ŒR3ç®¡ç†ï¼› R1å’ŒR4åœ¨é€šé“C2ä¸­æ²¡æœ‰æƒé™ã€‚ä¾‹å¦‚ï¼Œé€šé“é…ç½®CC2éšåå¯ä»¥æ›´æ–°ä»¥æ·»åŠ ç»„ç»‡æ¥æ”¯æŒç½‘ç»œå¢é•¿ï¼Œä½†è¿™åªèƒ½ç”±R2æˆ–R3å®Œæˆã€‚</p><p>Note how the channel configurations CC1 and CC2 remain completely separate from each other, and completely separate from the network configuration, NC4. Again weâ€™re seeing the de-centralized nature of a Hyperledger Fabric network; once channel C2 has been created, it is managed by organizations R2 and R3 independently to other network elements. Channel policies always remain separate from each other and can only be changed by the organizations authorized to do so in the channel.</p><p>è¯·æ³¨æ„ï¼Œé€šé“é…ç½®CC1å’ŒCC2å¦‚ä½•ä¿æŒå½¼æ­¤å®Œå…¨ç‹¬ç«‹ï¼Œå¹¶ä¸ç½‘ç»œé…ç½®NC4å®Œå…¨ç‹¬ç«‹ã€‚å†æ¬¡ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†Hyperledger Fabricç½‘ç»œçš„å»ä¸­å¿ƒåŒ–æ€§è´¨ï¼›åˆ›å»ºé€šé“C2åï¼Œç»„ç»‡R2å’ŒR3ä¼šç‹¬ç«‹äºå…¶ä»–ç½‘ç»œå…ƒç´ æ¥ç®¡ç†å®ƒã€‚æ¸ é“ç­–ç•¥å§‹ç»ˆä¿æŒå½¼æ­¤ç‹¬ç«‹ï¼Œå¹¶ä¸”åªèƒ½ç”±æœ‰æƒåœ¨é€šé“ä¸­æ›´æ”¹çš„ç»„ç»‡è¿›è¡Œæ›´æ”¹ã€‚</p><p>As the network and channels evolve, so will the network and channel configurations. There is a process by which this is accomplished in a controlled manner â€“ involving configuration transactions which capture the change to these configurations. Every configuration change results in a new configuration block transaction being generated, and <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/network/network.html#the-ordering-serivce">later in this topic</a>, weâ€™ll see how these blocks are validated and accepted to create updated network and channel configurations respectively.</p><p>éšç€ç½‘ç»œå’Œé€šé“çš„å‘å±•ï¼Œç½‘ç»œå’Œé€šé“çš„é…ç½®ä¹Ÿå°†éšä¹‹å‘å±•ã€‚æœ‰ä¸€ä¸ªè¿‡ç¨‹å¯ä»¥é€šè¿‡å—æ§çš„æ–¹å¼å®Œæˆæ­¤è¿‡ç¨‹-æ¶‰åŠé…ç½®äº‹åŠ¡ï¼Œè¿™äº›äº‹åŠ¡æ•è·å¯¹è¿™äº›é…ç½®çš„æ›´æ”¹ã€‚æ¯æ¬¡é…ç½®æ›´æ”¹éƒ½ä¼šå¯¼è‡´ç”Ÿæˆæ–°çš„é…ç½®å—äº‹åŠ¡ï¼Œæœ¬ä¸»é¢˜åé¢çš„å†…å®¹ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•éªŒè¯å’Œæ¥å—è¿™äº›åŒºå—ï¼Œä»¥åˆ†åˆ«åˆ›å»ºæ›´æ–°çš„ç½‘ç»œå’Œé€šé“é…ç½®ã€‚</p><h3 id="Network-and-channel-configurationsï¼ˆç½‘ç»œä¸é€šé“é…ç½®ï¼‰">Network and channel configurationsï¼ˆç½‘ç»œä¸é€šé“é…ç½®ï¼‰</h3><p>Throughout our sample network, we see the importance of network and channel configurations. These configurations are important because they encapsulate the <strong>policies</strong> agreed by the network members, which provide a shared reference for controlling access to network resources. Network and channel configurations also contain <strong>facts</strong> about the network and channel composition, such as the name of consortia and its organizations.</p><p>é€šè¿‡æˆ‘ä»¬ç®€å•çš„ç½‘ç»œï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ç½‘ç»œå’Œé€šé“é…ç½®çš„é‡è¦æ€§ã€‚è¿™äº›é…ç½®ä¹‹æ‰€ä»¥å¦‚æ­¤é‡è¦æ˜¯å› ä¸ºä»–ä»¬å°è£…äº†ç½‘ç»œæˆå‘˜çš„è®¤å¯ç­–ç•¥ï¼Œè¿™äº›ç­–ç•¥æä¾›äº†å¯¹ç½‘ç»œèµ„æºçš„å…±äº«çš„æ§åˆ¶ã€‚ç½‘ç»œå’Œé€šé“é…ç½®è¿˜åŒ…å«æœ‰å…³ç½‘ç»œå’Œé€šé“ç»„æˆçš„äº‹å®ï¼Œæ¯”å¦‚è”ç›Ÿä»¥åŠç»„æˆè”ç›Ÿçš„ç»„ç»‡ã€‚</p><p>For example, when the network is first formed using the ordering service node O4, its behaviour is governed by the network configuration NC4. The initial configuration of NC4 only contains policies that permit organization R4 to manage network resources. NC4 is subsequently updated to also allow R1 to manage network resources. Once this change is made, any administrator from organization R1 or R4 that connects to O4 will have network management rights because that is what the policy in the network configuration NC4 permits. Internally, each node in the ordering service records each channel in the network configuration, so that there is a record of each channel created, at the network level.</p><p>ä¾‹å¦‚ï¼Œå½“é¦–å…ˆä½¿ç”¨æ’åºæœåŠ¡èŠ‚ç‚¹O4å½¢æˆç½‘ç»œæ—¶ï¼Œå…¶è¡Œä¸ºç”±ç½‘ç»œé…ç½®NC4æ§åˆ¶ã€‚NC4çš„åˆå§‹é…ç½®ä»…åŒ…å«å…è®¸ç»„ç»‡R4ç®¡ç†ç½‘ç»œèµ„æºçš„ç­–ç•¥ã€‚éšåå°†NC4æ›´æ–°ä¸ºè¿˜å…è®¸R1ç®¡ç†ç½‘ç»œèµ„æºã€‚ä¸€æ—¦åšäº†è¿™ä¸ªæ›´æ–°ï¼Œç»„ç»‡R1å’ŒR4çš„ç®¡ç†å‘˜éƒ½æ‹¥æœ‰äº†ç½‘ç»œç®¡ç†æƒé™äº†ï¼Œå› ä¸ºè¿™æ˜¯åœ¨ç½‘ç»œé…ç½®NC2çš„ç­–ç•¥ä¸­æŒ‡å®šçš„ã€‚åœ¨å†…éƒ¨ï¼Œæ’åºæœåŠ¡ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šè®°å½•ç½‘ç»œé…ç½®ä¸­çš„æ¯ä¸ªé€šé“ï¼Œä»¥ä¾¿åœ¨ç½‘ç»œçº§åˆ«ä¸Šè®°å½•æ¯ä¸ªåˆ›å»ºçš„é€šé“ã€‚</p><p>It means that although ordering service node O4 is the actor that created consortia X1 and X2 and channels C1 and C2, the <strong>intelligence</strong> of the network is contained in the network configuration NC4 that O4 is obeying. As long as O4 behaves as a good actor, and correctly implements the policies defined in NC4 whenever it is dealing with network resources, our network will behave as all organizations have agreed. In many ways NC4 can be considered more important than O4 because, ultimately, it controls network access.</p><p>è¿™æ„å‘³ç€å°½ç®¡æ’åºæœåŠ¡èŠ‚ç‚¹O4æ˜¯åˆ›å»ºè”ç›ŸX1å’ŒX2ä»¥åŠæ¸ é“C1å’ŒC2çš„å‚ä¸è€…ï¼Œç½‘ç»œçš„æ™ºèƒ½åŒ…å«åœ¨O4éµå¾ªçš„ç½‘ç»œé…ç½®NC4ä¸­ã€‚åªè¦O4è¡¨ç°å‡ºè‰²ï¼Œå¹¶ä¸”åœ¨å¤„ç†ç½‘ç»œèµ„æºæ—¶æ­£ç¡®æ‰§è¡ŒNC4ä¸­å®šä¹‰çš„ç­–ç•¥ï¼Œæˆ‘ä»¬çš„ç½‘ç»œå°†æŒ‰ç…§æ‰€æœ‰ç»„ç»‡çš„åŒæ„è¡Œäº‹ã€‚åœ¨è®¸å¤šæ–¹é¢ï¼ŒNC4æ¯”O4æ›´é‡è¦ï¼Œå› ä¸ºå®ƒæœ€ç»ˆæ§åˆ¶äº†ç½‘ç»œè®¿é—®ã€‚</p><p>The same principles apply for channel configurations with respect to peers. In our network, P1 and P2 are likewise good actors. When peer nodes P1 and P2 are interacting with client applications A1 or A2 they are each using the policies defined within channel configuration CC1 to control access to the channel C1 resources.</p><p>ç›¸åŒçš„åŸåˆ™é€‚ç”¨äºæœ‰å…³peerèŠ‚ç‚¹çš„é€šé“é…ç½®ã€‚åœ¨æˆ‘ä»¬çš„ç½‘ç»œä¸­ï¼ŒP1å’ŒP2åŒæ ·æ˜¯å¥½è§’è‰²ã€‚å½“peerèŠ‚ç‚¹P1å’ŒP2ä¸å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA1æˆ–A2äº¤äº’æ—¶ï¼Œå®ƒä»¬æ¯ä¸ªéƒ½ä½¿ç”¨åœ¨é€šé“é…ç½®CC1ä¸­å®šä¹‰çš„ç­–ç•¥æ¥æ§åˆ¶å¯¹é€šé“C1èµ„æºçš„è®¿é—®ã€‚</p><p>For example, if A1 wants to access the smart contract chaincode S5 on peer nodes P1 or P2, each peer node uses its copy of CC1 to determine the operations that A1 can perform. For example, A1 may be permitted to read or write data from the ledger L1 according to policies defined in CC1. Weâ€™ll see later the same pattern for actors in channel and its channel configuration CC2. Again, we can see that while the peers and applications are critical actors in the network, their behaviour in a channel is dictated more by the channel configuration policy than any other factor.</p><p>ä¾‹å¦‚ï¼Œå¦‚æœA1æƒ³è¦åœ¨peerèŠ‚ç‚¹P1æˆ–P2ä¸Šè®¿é—®æ™ºèƒ½åˆçº¦S5ï¼Œæ¯ä¸ªå¯¹ç­‰èŠ‚ç‚¹ä½¿ç”¨å…¶CC1å‰¯æœ¬ç¡®å®šA1å¯ä»¥æ‰§è¡Œçš„æ“ä½œã€‚æ¯”å¦‚ï¼Œæ ¹æ®CC1ä¸­çš„ç­–ç•¥å®šä¹‰A1å¯ä»¥å¯èƒ½å¯ä»¥è¯»å†™è´¦æœ¬L1ã€‚ç¨åæˆ‘ä»¬å°†åœ¨é€šé“åŠå…¶é€šé“é…ç½®CC2ä¸­çœ‹åˆ°é’ˆå¯¹è§’è‰²çš„ç›¸åŒæ¨¡å¼ã€‚åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå°½ç®¡peerèŠ‚ç‚¹å’Œåº”ç”¨ç¨‹åºæ˜¯ç½‘ç»œä¸­çš„å…³é”®è§’è‰²ï¼Œå®ƒä»¬åœ¨é€šé“ä¸­çš„è¡Œä¸ºå—é€šé“é…ç½®ç­–ç•¥çš„æ”¯é…ï¼Œè€Œä¸æ˜¯å…¶ä»–ä»»ä½•å› ç´ ã€‚</p><p>Finally, it is helpful to understand how network and channel configurations are physically realized. We can see that network and channel configurations are logically singular â€“ there is one for the network, and one for each channel. This is important; every component that accesses the network or the channel must have a shared understanding of the permissions granted to different organizations.</p><p>æœ€åï¼Œäº†è§£ç‰©ç†ä¸Šå¦‚ä½•å®ç°ç½‘ç»œå’Œé€šé“é…ç½®å°†å¾ˆæœ‰å¸®åŠ©ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç½‘ç»œå’Œé€šé“é…ç½®åœ¨é€»è¾‘ä¸Šæ˜¯å”¯ä¸€çš„ï¼Œç½‘ç»œæœ‰ä¸€ä¸ªé…ç½®ï¼Œæ¯ä¸ªé€šé“ä¹Ÿéƒ½æœ‰ä¸€ä¸ªé…ç½®ã€‚è¿™ä¸ªå¾ˆé‡è¦ï¼Œè®¿é—®ç½‘ç»œæˆ–é€šé“çš„æ¯ä¸ªç»„ä»¶éƒ½å¿…é¡»å¯¹æˆäºˆä¸åŒç»„ç»‡çš„æƒé™æœ‰å…±åŒçš„äº†è§£ã€‚</p><p>Even though there is logically a single configuration, it is actually replicated and kept consistent by every node that forms the network or channel. For example, in our network peer nodes P1 and P2 both have a copy of channel configuration CC1, and by the time the network is fully complete, peer nodes P2 and P3 will both have a copy of channel configuration CC2. Similarly ordering service node O4 has a copy of the network configuration, but in a <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/network/network.html#the-ordering-service">multi-node configuration</a>, every ordering service node will have its own copy of the network configuration.</p><p>å³ä½¿ä»é€»è¾‘ä¸Šè®²åªæœ‰ä¸€ä¸ªé…ç½®ï¼Œä½†å®é™…ä¸Šå®ƒè¢«æ„æˆç½‘ç»œæˆ–é€šé“çš„æ¯ä¸ªèŠ‚ç‚¹å¤åˆ¶å¹¶ä¿æŒä¸€è‡´ã€‚ä¾‹å¦‚ï¼Œåœ¨æˆ‘ä»¬çš„ç½‘ç»œpeerèŠ‚ç‚¹P1å’ŒP2ä¸­éƒ½æœ‰ä¸€ä¸ªé€šé“é…ç½®CC1çš„å‰¯æœ¬ï¼Œåˆ°ç½‘ç»œå®Œå…¨å®Œæˆæ—¶ï¼ŒpeerèŠ‚ç‚¹P2å’ŒP3éƒ½å°†æ‹¥æœ‰é€šé“é…ç½®CC2çš„å‰¯æœ¬ã€‚ç±»ä¼¼çš„æ’åºæœåŠ¡èŠ‚ç‚¹O4æœ‰ä¸€ä¸ªç½‘ç»œé…ç½®çš„å‰¯æœ¬ï¼Œä½†æ˜¯åœ¨å¤šèŠ‚ç‚¹é…ç½®ä¸­ï¼Œæ¯ä¸ªè®¢è´­æœåŠ¡èŠ‚ç‚¹éƒ½å°†æ‹¥æœ‰è‡ªå·±çš„ç½‘ç»œé…ç½®å‰¯æœ¬ã€‚</p><p>Both network and channel configurations are kept consistent using the same blockchain technology that is used for user transactions â€“ but for <strong>configuration</strong> transactions. To change a network or channel configuration, an administrator must submit a configuration transaction to change the network or channel configuration. It must be signed by the organizations identified in the appropriate policy as being responsible for configuration change. This policy is called the <strong>mod_policy</strong> and weâ€™ll <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/network/network.html#changing-policy">discuss it later</a>.</p><p>ç½‘ç»œå’Œé€šé“é…ç½®ä½¿ç”¨ä¸ç”¨æˆ·äº¤æ˜“ç›¸åŒçš„åŒºå—é“¾æŠ€æœ¯ä¿æŒä¸å¯ç¯¡æ”¹ï¼Œä½†æ˜¯è¿™é‡Œæ˜¯ç”¨çš„æ˜¯<strong>é…ç½®</strong>äº¤æ˜“ã€‚è¦ä¿®æ”¹ä¸€ä¸ªç½‘ç»œæˆ–è€…é€šé“çš„é…ç½®ï¼Œç®¡ç†å‘˜å¿…é¡»æäº¤ä¸€ä¸ªé…ç½®äº¤æ˜“æ¥æ›´æ”¹ç½‘ç»œæˆ–è€…é€šé“çš„é…ç½®ã€‚å¿…é¡»ç”±é€‚å½“ç­–ç•¥ä¸­ç¡®å®šè´Ÿè´£é…ç½®æ›´æ”¹çš„ç»„ç»‡ç­¾åã€‚è¿™é¡¹æ”¿ç­–ç§°ä¸º<strong>mod_policy</strong>ï¼Œæˆ‘ä»¬å°†åœ¨åé¢è®¨è®ºã€‚</p><p>Indeed, the ordering service nodes operate a mini-blockchain, connected via the <strong>system channel</strong> we mentioned earlier. Using the system channel ordering service nodes distribute network configuration transactions. These transactions are used to co-operatively maintain a consistent copy of the network configuration at each ordering service node. In a similar way, peer nodes in an <strong>application channel</strong> can distribute channel configuration transactions. Likewise, these transactions are used to maintain a consistent copy of the channel configuration at each peer node.</p><p>çš„ç¡®ï¼Œæ’åºæœåŠ¡èŠ‚ç‚¹è¿è¡Œç€ä¸€ä¸ªå¾®å‹åŒºå—é“¾ï¼Œé€šè¿‡æˆ‘ä»¬å‰é¢æåˆ°çš„ç³»ç»Ÿé€šé“è¿æ¥ã€‚æ’åºæœåŠ¡èŠ‚ç‚¹ä½¿ç”¨ç³»ç»Ÿé€šé“æ¥åˆ†å‘ç½‘ç»œé…ç½®äº¤æ˜“ã€‚è¿™äº›äº¤æ˜“ç”¨äºä¿æŒæ¯ä¸ªæ’åºæœåŠ¡èŠ‚ç‚¹åˆä½œç»´æŠ¤ç½‘ç»œé…ç½®æœ‰ä¸€è‡´çš„å‰¯æœ¬ã€‚ä»¥ç±»ä¼¼çš„æ–¹å¼ï¼Œåº”ç”¨ç¨‹åºé€šé“ä¸­çš„peerèŠ‚ç‚¹å¯ä»¥åˆ†å‘é€šé“é…ç½®äº¤æ˜“ã€‚åŒæ ·ï¼Œè¿™äº›äº¤æ˜“ç”¨äºä¿æŒåœ¨æ¯ä¸ªpeerèŠ‚ç‚¹ä¸Šç»´æŠ¤çš„é€šé“é…ç½®çš„å‰¯æœ¬ä¸€è‡´ã€‚</p><p>This balance between objects that are logically singular, by being physically distributed is a common pattern in Hyperledger Fabric. Objects like network configurations, that are logically single, turn out to be physically replicated among a set of ordering services nodes for example. We also see it with channel configurations, ledgers, and to some extent smart contracts which are installed in multiple places but whose interfaces exist logically at the channel level. Itâ€™s a pattern you see repeated time and again in Hyperledger Fabric, and enables Hyperledger Fabric to be both de-centralized and yet manageable at the same time.</p><p>ç‰©ç†æ˜¯åˆ†å¸ƒå¼çš„ï¼Œé€»è¾‘ä¸Šæ˜¯å•ä¸€çš„è¿™ç§å¯¹è±¡ä¹‹é—´çš„å¹³è¡¡æ˜¯Hyperledger Fabricä¸­çš„å¸¸è§æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œé€»è¾‘ä¸Šå•ä¸€çš„å¯¹è±¡ï¼ˆå¦‚ç½‘ç»œé…ç½®ï¼‰å®é™…ä¸Šæ˜¯åœ¨ä¸€ç»„æ’åºæœåŠ¡èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œç‰©ç†å¤åˆ¶çš„ã€‚æˆ‘ä»¬ä¼šåœ¨é€šé“é…ç½®ã€è´¦æœ¬å’Œåœ¨æŸç§ç¨‹åº¦ä¸Šå®‰è£…åœ¨å¤šä¸ªä½ç½®ä½†é€»è¾‘ä¸Šå­˜åœ¨äºé€šé“çº§åˆ«çš„æ™ºèƒ½åˆçº¦ä¸Šçœ‹åˆ°ç›¸åŒçš„æƒ…å†µã€‚æ‚¨åœ¨Hyperledger Fabricä¸­ä¸€æ¬¡åˆä¸€æ¬¡åœ°çœ‹åˆ°è¿™ç§æ¨¡å¼ï¼Œå¹¶ä½¿Hyperledger Fabricæ—¢å¯ä»¥åˆ†æ•£ç®¡ç†ï¼Œåˆå¯ä»¥åŒæ—¶è¿›è¡Œç®¡ç†ã€‚</p><h2 id="Adding-another-peerï¼ˆæ·»åŠ å¦ä¸€ä¸ªpeerèŠ‚ç‚¹ï¼‰">Adding another peerï¼ˆæ·»åŠ å¦ä¸€ä¸ªpeerèŠ‚ç‚¹ï¼‰</h2><p>Now that organization R3 is able to fully participate in channel C2, letâ€™s add its infrastructure components to the channel. Rather than do this one component at a time, weâ€™re going to add a peer, its local copy of a ledger, a smart contract and a client application all at once!</p><p>ç°åœ¨ç»„ç»‡R3å¯ä»¥å®Œå…¨å‚ä¸æ¸ é“C2äº†ï¼Œè®©æˆ‘ä»¬å°†å…¶åŸºç¡€ç»“æ„ç»„ä»¶æ·»åŠ åˆ°æ¸ é“ä¸­ã€‚æˆ‘ä»¬ä¸ä¼šä¸€æ¬¡æ·»åŠ ä¸€ä¸ªç»„ä»¶ï¼Œè€Œæ˜¯ä¸€æ¬¡æ·»åŠ ä¸€ä¸ªpeerä»¥åŠå…¶è´¦æœ¬çš„æœ¬åœ°å‰¯æœ¬ã€æ™ºèƒ½åˆçº¦å’Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼</p><p>Letâ€™s see the network with organization R3â€™s components added:</p><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ·»åŠ äº†ç»„ç»‡R3ç»„ä»¶çš„ç½‘ç»œï¼š</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/network.diagram.11.png" alt="network.diagram.11"></p><p><em>The diagram shows the facts relating to channels C1 and C2 in the network N as follows: Client applications A1 and A2 can use channel C1 for communication with peers P1 and P2, and ordering service O4; client applications A3 can use channel C2 for communication with peer P3 and ordering service O4. Ordering service O4 can make use of the communication services of channels C1 and C2. Channel configuration CC1 applies to channel C1, CC2 applies to channel C2.</em></p><p><em>è¯¥å›¾æ˜¾ç¤ºäº†ä¸ç½‘ç»œNä¸­çš„é€šé“C1å’ŒC2æœ‰å…³çš„äº‹å®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA1å’ŒA2å¯ä»¥ä½¿ç”¨é€šé“C1æ¥ä¸peerèŠ‚ç‚¹P1å’ŒP2ä»¥åŠæ’åºæœåŠ¡O4è¿›è¡Œé€šä¿¡ï¼›å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA3å¯ä»¥ä½¿ç”¨é€šé“æ¥ä¸peerèŠ‚ç‚¹P3å’Œæ’åºæœåŠ¡O4è¿›è¡Œé€šä¿¡ã€‚æ’åºæœåŠ¡O4å¯ä»¥åˆ©ç”¨é€šé“C1å’ŒC2çš„é€šä¿¡æœåŠ¡ã€‚é€šé“é…ç½®CC1é€‚ç”¨äºé€šé“C1ï¼ŒCC2é€‚ç”¨äºé€šé“C2ã€‚</em></p><p>First of all, notice that because peer node P3 is connected to channel C2, it has a <strong>different</strong> ledger â€“ L2 â€“ to those peer nodes using channel C1. The ledger L2 is effectively scoped to channel C2. The ledger L1 is completely separate; it is scoped to channel C1. This makes sense â€“ the purpose of the channel C2 is to provide private communications between the members of the consortium X2, and the ledger L2 is the private store for their transactions.</p><p>é¦–å…ˆï¼Œè¯·æ³¨æ„ï¼Œç”±äºpeerèŠ‚ç‚¹P3è¿æ¥åˆ°é€šé“C2ï¼Œä»–æ‹¥æœ‰ä¸€ä¸ªä¸é€šé“C1ä¸Šçš„èŠ‚ç‚¹ä¸ä¸€æ ·çš„è´¦æœ¬L2ã€‚è´¦æœ¬L2çš„æœ‰æ•ˆèŒƒå›´ä¸ºé€šé“C2ã€‚åˆ†ç±»å¸L1æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼›å®ƒçš„ä½œç”¨åŸŸæ˜¯é€šé“C1ã€‚è¿™æ˜¯æœ‰é“ç†çš„-é€šé“C2çš„ç›®çš„æ˜¯åœ¨è´¢å›¢X2çš„æˆå‘˜ä¹‹é—´æä¾›ç§äººé€šä¿¡ï¼Œè€Œåˆ†ç±»å¸L2æ˜¯å…¶äº¤æ˜“çš„ç§äººå•†åº—ã€‚</p><p>In a similar way, the smart contract S6, installed on peer node P3, and defined on channel C2, is used to provide controlled access to ledger L2. Application A3 can now use channel C2 to invoke the services provided by smart contract S6 to generate transactions that can be accepted onto every copy of the ledger L2 in the network.</p><p>ä»¥ç±»ä¼¼çš„æ–¹å¼ï¼Œå®‰è£…åœ¨peerèŠ‚ç‚¹P3ä¸Šå¹¶å®šä¹‰åœ¨é€šé“C2ä¸Šçš„æ™ºèƒ½åˆçº¦S6ç”¨äºæä¾›å¯¹è´¦æœ¬L2çš„å—æ§è®¿é—®ã€‚åº”ç”¨ç¨‹åºA3ç°åœ¨å¯ä»¥ä½¿ç”¨é€šé“C2æ¥è°ƒç”¨æ™ºèƒ½åˆçº¦S6æä¾›çš„æœåŠ¡æ¥ç”Ÿæˆäº¤æ˜“ï¼Œä»¥ç”Ÿæˆå¯ä»¥è¢«æ¥å—åˆ°ç½‘ç»œä¸­è´¦æœ¬L2çš„æ¯ä¸ªå‰¯æœ¬ä¸Šçš„äº¤æ˜“ã€‚</p><p>At this point in time, we have a single network that has two completely separate channels defined within it. These channels provide independently managed facilities for organizations to transact with each other. Again, this is de-centralization at work; we have a balance between control and autonomy. This is achieved through policies which are applied to channels which are controlled by, and affect, different organizations.</p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªç½‘ç»œï¼Œå…¶ä¸­å®šä¹‰äº†ä¸¤ä¸ªå®Œå…¨ç‹¬ç«‹çš„é€šé“ã€‚è¿™äº›é€šé“ä¸ºç»„ç»‡æä¾›äº†ç›¸äº’ç‹¬ç«‹ç®¡ç†çš„è®¾æ–½ï¼Œä»¥ä¾¿å½¼æ­¤è¿›è¡Œäº¤æ˜“ã€‚åŒæ ·ï¼Œè¿™æ˜¯å·¥ä½œä¸­çš„åˆ†æƒï¼›æˆ‘ä»¬åœ¨æ§åˆ¶å’Œè‡ªæ²»ä¹‹é—´å–å¾—å¹³è¡¡ã€‚è¿™æ˜¯é€šè¿‡å°†ç­–ç•¥åº”ç”¨åˆ°å—ä¸åŒç»„ç»‡æ§åˆ¶å¹¶å½±å“ä¸åŒç»„ç»‡çš„æ¸ é“æ¥å®ç°çš„ã€‚</p><h2 id="Joining-a-peer-to-multiple-channelsï¼ˆæŠŠä¸€ä¸ªpeerèŠ‚ç‚¹åŠ å…¥åˆ°ä¸åŒé€šé“ï¼‰">Joining a peer to multiple channelsï¼ˆæŠŠä¸€ä¸ªpeerèŠ‚ç‚¹åŠ å…¥åˆ°ä¸åŒé€šé“ï¼‰</h2><p>In this final stage of network development, letâ€™s return our focus to organization R2. We can exploit the fact that R2 is a member of both consortia X1 and X2 by joining it to multiple channels:</p><p>åœ¨ç½‘ç»œå¼€å‘çš„æœ€åé˜¶æ®µï¼Œè®©æˆ‘ä»¬æŠŠé‡ç‚¹æ”¾å›åˆ°ç»„ç»‡R2ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨R2æ˜¯X1å’ŒX2è”ç›Ÿçš„æˆå‘˜è¿™ä¸€äº‹å®æ¥å°†R2åŠ å…¥å¤šä¸ªæ¸ é“ï¼š</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/network.diagram.12.png" alt="network.diagram.12"></p><p><em>The diagram shows the facts relating to channels C1 and C2 in the network N as follows: Client applications A1 can use channel C1 for communication with peers P1 and P2, and ordering service O4; client application A2 can use channel C1 for communication with peers P1 and P2 and channel C2 for communication with peers P2 and P3 and ordering service O4; client application A3 can use channel C2 for communication with peer P3 and P2 and ordering service O4. Ordering service O4 can make use of the communication services of channels C1 and C2. Channel configuration CC1 applies to channel C1, CC2 applies to channel C2.</em></p><p><em>è¯¥å›¾æ˜¾ç¤ºäº†ä¸ç½‘ç»œNä¸­çš„é€šé“C1å’ŒC2æœ‰å…³çš„ä¸‹é¢çš„äº‹å®ï¼šå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA1å¯ä»¥ä½¿ç”¨é€šé“C1æ¥ä¸peerèŠ‚ç‚¹P1å’ŒP2ä»¥åŠæ’åºæœåŠ¡O4è¿›è¡Œé€šä¿¡ï¼›å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA2å¯ä»¥ä½¿ç”¨é€šé“C1æ¥å’ŒpeerèŠ‚ç‚¹P1å’ŒP2é€šä¿¡ï¼Œå¹¶ä¸”ä½¿ç”¨C2æ¥ä¸peerèŠ‚ç‚¹P2å’ŒP3ä»¥åŠæ’åºæœåŠ¡O4è¿›è¡Œé€šä¿¡ï¼›å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA3å¯ä»¥ä½¿ç”¨é€šé“C2æ¥ä¸peerèŠ‚ç‚¹P3å’ŒP2ä»¥åŠæ’åºæœåŠ¡O4è¿›è¡Œé€šä¿¡ã€‚æ’åºæœåŠ¡O4å¯ä»¥ä½¿ç”¨é€šé“C1å’ŒC2ä¸Šçš„é€šä¿¡æœåŠ¡ã€‚é€šé“é…ç½®CC1æœåŠ¡äºé€šé“C1ã€CC2æœåŠ¡ä¸é€šé“C2ã€‚</em></p><p>We can see that R2 is a special organization in the network, because it is the only organization that is a member of two application channels! It is able to transact with organization R1 on channel C1, while at the same time it can also transact with organization R3 on a different channel, C2.</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°R2æ˜¯ç½‘ç»œä¸Šçš„ä¸€ä¸ªç‰¹æ®Šçš„ç»„ç»‡ï¼Œå› ä¸ºå®ƒæ˜¯ä¸¤ä¸ªåº”ç”¨ç¨‹åºé€šé“çš„æˆå‘˜çš„å”¯ä¸€ç»„ç»‡ï¼ä»–å¯ä»¥åœ¨é€šé“C1ä¸Šä¸ç»„ç»‡R1è¿›è¡Œäº¤æ˜“ï¼ŒåŒæ—¶å®ƒä¹Ÿå¯ä»¥åœ¨å¦ä¸€ä¸ªä¸åŒçš„é€šé“C2ä¸Šä¸ç»„ç»‡R3è¿›è¡Œäº¤æ˜“ã€‚</p><p>Notice how peer node P2 has smart contract S5 installed for channel C1 and smart contract S6 installed for channel C2. Peer node P2 is a full member of both channels at the same time via different smart contracts for different ledgers.</p><p>è¯·æ³¨æ„ï¼ŒpeerèŠ‚ç‚¹P2å¦‚ä½•ä¸ºé€šé“C1å®‰è£…äº†æ™ºèƒ½åˆçº¦S5ï¼Œå¹¶ä¸ºé€šé“C2å®‰è£…äº†æ™ºèƒ½åˆçº¦S6ã€‚peerèŠ‚ç‚¹P2é€šè¿‡ä¸åŒè´¦æœ¬çš„ä¸åŒæ™ºèƒ½åˆçº¦åŒæ—¶æ˜¯ä¸¤ä¸ªæ¸ é“çš„æ­£å¼æˆå‘˜ã€‚</p><p>This is a very powerful concept â€“ channels provide both a mechanism for the separation of organizations, and a mechanism for collaboration between organizations. All the while, this infrastructure is provided by, and shared between, a set of independent organizations.</p><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æ¦‚å¿µ-æ¸ é“æ—¢æä¾›äº†ç»„ç»‡åˆ†ç¦»çš„æœºåˆ¶ï¼Œä¹Ÿæä¾›äº†ç»„ç»‡ä¹‹é—´åä½œçš„æœºåˆ¶ã€‚ä¸€ç›´ä»¥æ¥ï¼Œæ­¤åŸºç¡€ç»“æ„ï¼ˆå³é€šé“ï¼‰ç”±ä¸€ç»„ç‹¬ç«‹çš„ç»„ç»‡æä¾›å¹¶åœ¨å®ƒä»¬ä¹‹é—´å…±äº«ã€‚</p><p>It is also important to note that peer node P2â€™s behaviour is controlled very differently depending upon the channel in which it is transacting. Specifically, the policies contained in channel configuration CC1 dictate the operations available to P2 when it is transacting in channel C1, whereas it is the policies in channel configuration CC2 that control P2â€™s behaviour in channel C2.</p><p>åŒæ ·é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼ŒpeerèŠ‚ç‚¹P2çš„è¡Œä¸ºå—å…¶è¿›è¡Œäº¤æ˜“çš„é€šé“çš„æ§åˆ¶éå¸¸ä¸åŒã€‚å…·ä½“è€Œè¨€ï¼Œé€šé“é…ç½®CC1ä¸­åŒ…å«çš„ç­–ç•¥è§„å®šäº†P2åœ¨é€šé“C1ä¸­è¿›è¡Œäº¤æ˜“æ—¶å¯ä½¿ç”¨çš„æ“ä½œï¼Œè€Œé€šé“é…ç½®CC2ä¸­çš„ç­–ç•¥æ§åˆ¶æ¸ é“P2åœ¨æ¸ é“C2ä¸­çš„è¡Œä¸ºã€‚</p><p>Again, this is desirable â€“ R2 and R1 agreed the rules for channel C1, whereas R2 and R3 agreed the rules for channel C2. These rules were captured in the respective channel policies â€“ they can and must be used by every component in a channel to enforce correct behaviour, as agreed.</p><p>åŒæ ·ï¼ŒR2å’ŒR1åŒæ„é€šé“C1çš„è§„åˆ™ï¼Œè€ŒR2å’ŒR3åŒæ„äº†é€šé“C2çš„è§„åˆ™æ˜¯å¯å–çš„ã€‚è¿™äº›è§„åˆ™æ˜¯åœ¨å„è‡ªçš„é€šé“çš„æ”¿ç­–ä¸­è·å–çš„-æ¸ é“ä¸­çš„æ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥å¹¶ä¸”å¿…é¡»ä½¿ç”¨å®ƒä»¬æ¥å¼ºåˆ¶æ‰§è¡Œæ­£ç¡®çš„è¡Œä¸ºï¼Œè¿™å·²ç»è¾¾æˆå…±è¯†ã€‚</p><p>Similarly, we can see that client application A2 is now able to transact on channels C1 and C2. And likewise, it too will be governed by the policies in the appropriate channel configurations. As an aside, note that client application A2 and peer node P2 are using a mixed visual vocabulary â€“ both lines and connections. You can see that they are equivalent; they are visual synonyms.</p><p>åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA2ç°åœ¨èƒ½å¤Ÿåœ¨é€šé“C1å’ŒC2ä¸Šè¿›è¡Œäº¤æ˜“ã€‚åŒæ ·ï¼Œå®ƒä¹Ÿå°†ç”±é€‚å½“çš„é€šé“é…ç½®ä¸­çš„ç­–ç•¥æ§åˆ¶ã€‚é¡ºä¾¿æä¸€å¥ï¼Œè¯·æ³¨æ„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA2å’ŒpeerèŠ‚ç‚¹P2æ­£åœ¨ä½¿ç”¨æ··åˆçš„å¯è§†è¯æ±‡è¡¨ï¼ˆåŒ…æ‹¬è¡Œå’Œè¿æ¥ï¼‰ã€‚æ‚¨å¯ä»¥çœ‹åˆ°å®ƒä»¬æ˜¯ç­‰æ•ˆçš„ã€‚å®ƒä»¬æ˜¯è§†è§‰åŒä¹‰è¯ã€‚</p><h3 id="The-ordering-serviceï¼ˆæ’åºæœåŠ¡ï¼‰">The ordering serviceï¼ˆæ’åºæœåŠ¡ï¼‰</h3><p>The observant reader may notice that the ordering service node appears to be a centralized component; it was used to create the network initially, and connects to every channel in the network. Even though we added R1 and R4 to the network configuration policy NC4 which controls the orderer, the node was running on R4â€™s infrastructure. In a world of de-centralization, this looks wrong!</p><p>ç»†å¿ƒçš„è¯»è€…å¯èƒ½ä¼šæ³¨æ„åˆ°æ’åºæœåŠ¡èŠ‚ç‚¹ä¼¼ä¹æ˜¯ä¸€ä¸ªé›†ä¸­å¼ç»„ä»¶ï¼Œä»–è¢«ç”¨äºåˆ›å»ºåˆå§‹åŒ–ç½‘ç»œï¼Œå¹¶ä¸”é“¾æ¥ç½‘ç»œä¸­çš„æ‰€æœ‰çš„é€šé“ã€‚å³ä½¿æˆ‘ä»¬åœ¨æ§åˆ¶æ’åºè€…çš„ç½‘ç»œé…ç½®ç­–ç•¥NC4ä¸­æ·»åŠ äº†R1å’ŒR4ï¼Œè¯¥èŠ‚ç‚¹ä»åœ¨R4çš„åŸºç¡€æ¶æ„ä¸Šè¿è¡Œã€‚åœ¨å»ä¸­å¿ƒåŒ–çš„ä¸–ç•Œä¸­ï¼Œè¿™çœ‹èµ·æ¥æ˜¯é”™è¯¯çš„ï¼</p><p>Donâ€™t worry! Our example network showed the simplest ordering service configuration to help you understand the idea of a network administration point. In fact, the ordering service can itself too be completely de-centralized! We mentioned earlier that an ordering service could be comprised of many individual nodes owned by different organizations, so letâ€™s see how that would be done in our sample network.</p><p>ä¸è¦æ‹…å¿ƒï¼æˆ‘ä»¬çš„ç¤ºä¾‹ç½‘ç»œæ˜¾ç¤ºäº†æœ€ç®€å•çš„æ’åºæœåŠ¡é…ç½®ï¼Œä»¥å¸®åŠ©æ‚¨äº†è§£ç½‘ç»œç®¡ç†ç‚¹çš„æ¦‚å¿µã€‚äº‹å®ä¸Šï¼Œæ’åºæœåŠ¡è‡ªå·±ä¹Ÿæ˜¯å®Œå…¨å»ä¸­å¿ƒåŒ–çš„ã€‚å‰é¢æˆ‘ä»¬æåˆ°è¿‡ï¼Œæ’åºæœåŠ¡å¯ä»¥ç”±ä¸åŒç»„ç»‡æ‹¥æœ‰çš„è®¸å¤šå•ä¸ªèŠ‚ç‚¹ç»„æˆï¼Œå› æ­¤è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨ç¤ºä¾‹ç½‘ç»œä¸­å®Œæˆè¯¥å·¥ä½œã€‚</p><p>Letâ€™s have a look at a more realistic ordering service node configuration:</p><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªæ›´æ¥è¿‘ç°å®çš„æ’åºæœåŠ¡èŠ‚ç‚¹é…ç½®ï¼š</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/network.diagram.15.png" alt="network.diagram.15"></p><p><em>A multi-organization ordering service. The ordering service comprises ordering service nodes O1 and O4. O1 is provided by organization R1 and node O4 is provided by organization R4. The network configuration NC4 defines network resource permissions for actors from both organizations R1 and R4.</em></p><p><em>å¤šç»„ç»‡çš„æ’åºæœåŠ¡ã€‚æ’åºæœåŠ¡åŒ…å«æ’åºèŠ‚ç‚¹O1å’ŒO4ã€‚O1æ˜¯ç”±ç»„ç»‡R1æä¾›è€ŒèŠ‚ç‚¹O4æ˜¯ç”±ç»„ç»‡R4æä¾›ã€‚ç½‘ç»œé…ç½®NC4ä¸ºç»„ç»‡R1å’ŒR4çš„å‚ä¸è€…å®šä¹‰äº†ç½‘ç»œèµ„æºæƒé™ã€‚</em></p><p>We can see that this ordering service completely de-centralized â€“ it runs in organization R1 and it runs in organization R4. The network configuration policy, NC4, permits R1 and R4 equal rights over network resources. Client applications and peer nodes from organizations R1 and R4 can manage network resources by connecting to either node O1 or node O4, because both nodes behave the same way, as defined by the policies in network configuration NC4. In practice, actors from a particular organization <em>tend</em> to use infrastructure provided by their home organization, but thatâ€™s certainly not always the case.</p><p>æˆ‘ä»¬çœ‹åˆ°æ’åºæœåŠ¡å·²ç»æ˜¯å®Œå…¨çš„å»ä¸­å¿ƒåŒ–äº†ï¼Œä»–è¿è¡Œåœ¨ç»„ç»‡R1å’ŒR4ä¸Šã€‚ç½‘ç»œé…ç½®ç­–ç•¥NC4ï¼Œå…è®¸R1å’ŒR4åœ¨ç½‘ç»œèµ„æºä¸Šäº«æœ‰åŒç­‰çš„æƒåˆ©ã€‚ç»„ç»‡R1å’ŒR4çš„å®¢æˆ·ç«¯ç¨‹åºå’ŒpeerèŠ‚ç‚¹å¯ä»¥é€šè¿‡O1å’ŒO4çš„ä»»æ„ä¸€ä¸ªæ¥ç®¡ç†ç½‘ç»œä¸Šçš„èµ„æºï¼Œå› ä¸ºä¸¤ä¸ªèŠ‚ç‚¹çš„è¡Œä¸ºæ–¹å¼å‡ä¸ç½‘ç»œé…ç½®NC4ä¸­çš„ç­–ç•¥æ‰€å®šä¹‰çš„æ–¹å¼ç›¸åŒã€‚å®é™…ä¸Šï¼Œæ¥è‡ªç‰¹å®šç»„ç»‡çš„å‚ä¸è€…å¾€å¾€ä¼šä½¿ç”¨å…¶ä¸Šçº§ç»„ç»‡æä¾›çš„åŸºç¡€æ¶æ„ï¼Œä½†è¿™å¹¶éæ€»æ˜¯å¦‚æ­¤ã€‚</p><h3 id="De-centralized-transaction-distributionï¼ˆå»ä¸­å¿ƒåŒ–çš„äº¤æ˜“åˆ†å‘ï¼‰">De-centralized transaction distributionï¼ˆå»ä¸­å¿ƒåŒ–çš„äº¤æ˜“åˆ†å‘ï¼‰</h3><p>As well as being the management point for the network, the ordering service also provides another key facility â€“ it is the distribution point for transactions. The ordering service is the component which gathers endorsed transactions from applications and orders them into transaction blocks, which are subsequently distributed to every peer node in the channel. At each of these committing peers, transactions are recorded, whether valid or invalid, and their local copy of the ledger updated appropriately.</p><p>æ’åºæœåŠ¡ä¸ä»…æ˜¯ç½‘ç»œçš„ç®¡ç†ç‚¹ï¼Œè¿˜æä¾›äº†å¦ä¸€ä¸ªå…³é”®åŠŸèƒ½â€“å®ƒæ˜¯äº¤æ˜“çš„åˆ†å‘ç‚¹ã€‚æ’åºæœåŠ¡æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶ä»åº”ç”¨ç¨‹åºä¸­æ”¶é›†è®¤å¯äº¤æ˜“å¹¶å°†å…¶æ’åºåˆ°äº¤æ˜“å—ä¸­ï¼Œéšååˆ†å‘ç»™é€šé“ä¸­çš„æ¯ä¸ªpeerèŠ‚ç‚¹ã€‚åœ¨æ¯ä¸ªæäº¤èŠ‚ç‚¹ä¸­ï¼Œäº¤æ˜“ä¼šè¢«è®°å½•ï¼ˆä¸è®ºæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼‰ï¼Œå¹¶åœ¨æœ¬åœ°æ›´æ–°è´¦æœ¬ã€‚</p><p>Notice how the ordering service node O4 performs a very different role for the channel C1 than it does for the network N. When acting at the channel level, O4â€™s role is to gather transactions and distribute blocks inside channel C1. It does this according to the policies defined in channel configuration CC1. In contrast, when acting at the network level, O4â€™s role is to provide a management point for network resources according to the policies defined in network configuration NC4. Notice again how these roles are defined by different policies within the channel and network configurations respectively. This should reinforce to you the importance of declarative policy based configuration in Hyperledger Fabric. Policies both define, and are used to control, the agreed behaviours by each and every member of a consortium.</p><p>è¯·æ³¨æ„ï¼Œæ’åºæœåŠ¡èŠ‚ç‚¹O4å¦‚ä½•å¯¹é€šé“C1èµ·åˆ°ä¸å¯¹ç½‘ç»œNå®Œå…¨ä¸åŒçš„ä½œç”¨ã€‚åœ¨ä½œç”¨äºé€šé“çº§åˆ«æ—¶ï¼ŒO4çš„ä½œç”¨æ˜¯åœ¨é€šé“C1é‡Œé¢æ”¶é›†å’Œåˆ†å‘åŒºå—çš„ã€‚å®ƒæ ¹æ®é€šé“é…ç½®CC1ä¸­å®šä¹‰çš„ç­–ç•¥æ‰§è¡Œæ­¤æ“ä½œã€‚ä½œä¸ºå¯¹æ¯”ï¼Œåœ¨ç½‘ç»œçº§åˆ«æ‰§è¡Œæ“ä½œæ—¶ï¼ŒO4çš„ä½œç”¨æ˜¯æ ¹æ®ç½‘ç»œé…ç½®NC4ä¸­å®šä¹‰çš„ç­–ç•¥ä¸ºç½‘ç»œèµ„æºæä¾›ç®¡ç†ç‚¹ã€‚å†æ¬¡æ³¨æ„ï¼Œè¿™äº›è§’è‰²æ˜¯å¦‚ä½•åˆ†åˆ«ç”±é€šé“å’Œç½‘ç»œé…ç½®ä¸­çš„ä¸åŒç­–ç•¥å®šä¹‰çš„ã€‚è¿™åº”è¯¥å‘æ‚¨å¼ºè°ƒHyperledger Fabricä¸­åŸºäºå£°æ˜ç­–ç•¥çš„é…ç½®çš„é‡è¦æ€§ã€‚ç­–ç•¥æ—¢å®šä¹‰äº†è”ç›Ÿçš„æ¯ä¸ªæˆå‘˜ï¼Œåˆç”¨äºæ§åˆ¶è”ç›Ÿçš„æ¯ä¸ªæˆå‘˜çš„è¡Œä¸ºã€‚</p><p>We can see that the ordering service, like the other components in Hyperledger Fabric, is a fully de-centralized component. Whether acting as a network management point, or as a distributor of blocks in a channel, its nodes can be distributed as required throughout the multiple organizations in a network.</p><p>æˆ‘ä»¬çœ‹åˆ°åƒHyperledger Fabricä¸­çš„å…¶ä»–ç»„ä»¶ä¸€æ ·ï¼Œæ’åºæœåŠ¡æ˜¯ä¸€ä¸ªå®Œå…¨çš„å»ä¸­å¿ƒåŒ–çš„ç»„ä»¶ã€‚æ— è®ºæ˜¯å……å½“ç½‘ç»œç®¡ç†ç‚¹ï¼Œè¿˜æ˜¯å……å½“é€šé“ä¸­çš„åŒºå—åˆ†é…å™¨ï¼Œå®ƒçš„èŠ‚ç‚¹å¯ä»¥æ ¹æ®éœ€è¦åˆ†å¸ƒåœ¨ç½‘ç»œä¸­çš„å¤šä¸ªç»„ç»‡ä¸­ã€‚</p><h3 id="Changing-policyï¼ˆä¿®æ”¹ç­–ç•¥ï¼‰">Changing policyï¼ˆä¿®æ”¹ç­–ç•¥ï¼‰</h3><p>Throughout our exploration of the sample network, weâ€™ve seen the importance of the policies to control the behaviour of the actors in the system. Weâ€™ve only discussed a few of the available policies, but there are many that can be declaratively defined to control every aspect of behaviour. These individual policies are discussed elsewhere in the documentation.</p><p>åœ¨æ•´ä¸ªç¤ºä¾‹ç½‘ç»œçš„æ¢ç´¢è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†æ§åˆ¶ç³»ç»Ÿä¸­å‚ä¸è€…è¡Œä¸ºçš„ç­–ç•¥çš„é‡è¦æ€§ã€‚æˆ‘ä»¬ä»…è®¨è®ºäº†ä¸€äº›å¯ç”¨çš„ç­–ç•¥ï¼Œä½†æ˜¯å¯ä»¥å£°æ˜æ€§åœ°å®šä¹‰è®¸å¤šç­–ç•¥æ¥æ§åˆ¶è¡Œä¸ºçš„å„ä¸ªæ–¹é¢ã€‚è¿™äº›å•ç‹¬çš„ç­–ç•¥åœ¨æ–‡æ¡£çš„å…¶ä»–åœ°æ–¹è¿›è¡Œäº†è®¨è®ºã€‚</p><p>Most importantly of all, Hyperledger Fabric provides a uniquely powerful policy that allows network and channel administrators to manage policy change itself! The underlying philosophy is that policy change is a constant, whether it occurs within or between organizations, or whether it is imposed by external regulators. For example, new organizations may join a channel, or existing organizations may have their permissions increased or decreased. Letâ€™s investigate a little more how change policy is implemented in Hyperledger Fabric.</p><p>æœ€é‡è¦çš„æ˜¯ï¼ŒHyperledger Fabric æä¾›äº†ç‹¬ç‰¹è€Œå¼ºå¤§çš„ç­–ç•¥ï¼Œå…è®¸ç½‘ç»œå’Œé€šé“ç®¡ç†å‘˜è‡ªè¡Œç®¡ç†ç­–ç•¥æ›´æ”¹ï¼åŸºæœ¬ç†å¿µæ˜¯æ”¿ç­–å˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­ä¸æ–­çš„è¿‡ç¨‹ï¼Œä¸è®ºå®ƒæ˜¯åœ¨ç»„ç»‡å†…éƒ¨è¿˜æ˜¯ç»„ç»‡ä¹‹é—´å‘ç”Ÿï¼Œè¿˜æ˜¯ç”±å¤–éƒ¨ç›‘ç®¡æœºæ„å¼ºåŠ ã€‚ä¾‹å¦‚ï¼Œæ–°ç»„ç»‡å¯ä»¥åŠ å…¥é€šé“ï¼Œæˆ–è€…ç°æœ‰ç»„ç»‡çš„æƒé™å¯ä»¥å¢åŠ æˆ–å‡å°‘ã€‚è®©æˆ‘ä»¬ç ”ç©¶ä¸€ä¸‹Hyperledger Fabricä¸­æ›´æ”¹ç­–ç•¥çš„å®ç°æ–¹å¼ã€‚</p><p>The key point of understanding is that policy change is managed by a policy within the policy itself. The <strong>modification policy</strong>, or <strong>mod_policy</strong> for short, is a first class policy within a network or channel configuration that manages change. Letâ€™s give two brief examples of how weâ€™ve <strong>already</strong> used mod_policy to manage change in our network!</p><p>ç†è§£çš„å…³é”®ç‚¹æ˜¯ï¼Œç­–ç•¥æ›´æ”¹ç”±ç­–ç•¥æœ¬èº«å†…çš„ç­–ç•¥æ¥ç®¡ç†ã€‚<strong>modification policyï¼ˆä¿®æ”¹ç­–ç•¥ï¼‰<strong>æˆ–è€…ç®€ç§°ä¸º</strong>mod_policy</strong>ï¼Œæ˜¯ä¸€ä¸ªåœ¨ç½‘ç»œæˆ–æ¸ é“é…ç½®ä¸­ç®¡ç†å˜æ›´çš„å¤´ç­‰ä»“çš„ç­–ç•¥ã€‚è®©æˆ‘ä»¬ä¸¾ä¸¤ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¯´æ˜æˆ‘ä»¬æ˜¯å¦‚ä½•ä½¿ç”¨mod_policyæ¥ç®¡ç†ç½‘ç»œä¸­çš„æ›´æ”¹çš„ï¼</p><p>The first example was when the network was initially set up. At this time, only organization R4 was allowed to manage the network. In practice, this was achieved by making R4 the only organization defined in the network configuration NC4 with permissions to network resources. Moreover, the mod_policy for NC4 only mentioned organization R4 â€“ only R4 was allowed to change this configuration.</p><p>ç¬¬ä¸€ä¸ªç¤ºä¾‹æ˜¯æœ€åˆå»ºç«‹ç½‘ç»œæ—¶ã€‚æ­¤æ—¶ï¼Œåªæœ‰ç»„ç»‡R4å…è®¸ç®¡ç†ç½‘ç»œã€‚åœ¨å®è·µä¸­ï¼Œè¿™æ˜¯é€šè¿‡ä½¿R4æˆä¸ºç½‘ç»œé…ç½®NC4ä¸­å®šä¹‰çš„å”¯ä¸€æ‹¥æœ‰ç½‘ç»œèµ„æºæƒé™çš„ç»„ç»‡æ¥å®ç°çš„ã€‚æ­¤å¤–ï¼ŒNC4çš„mod_policyä»…æåŠç»„ç»‡R4 â€“ä»…å…è®¸R4æ›´æ”¹æ­¤é…ç½®ã€‚</p><p>We then evolved the network N to also allow organization R1 to administer the network. R4 did this by adding R1 to the policies for channel creation and consortium creation. Because of this change, R1 was able to define the consortia X1 and X2, and create the channels C1 and C2. R1 had equal administrative rights over the channel and consortium policies in the network configuration.</p><p>ç„¶åï¼Œæˆ‘ä»¬å¯¹ç½‘ç»œNè¿›è¡Œäº†æ¼”è¿›ï¼Œä»¥ä¹Ÿå…è®¸ç»„ç»‡R1ç®¡ç†ç½‘ç»œã€‚R4é€šè¿‡å°†R1æ·»åŠ åˆ°ç”¨äºé€šé“åˆ›å»ºå’Œè”ç›Ÿåˆ›å»ºçš„ç­–ç•¥ä¸­æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚å› ä¸ºè¿™ä¸ªå˜æ›´ï¼ŒR1å¯ä»¥å®šä¹‰è”ç›ŸX1å’ŒX2ï¼Œå¹¶ä¸”åˆ›å»ºäº†é€šé“C1å’ŒC2ã€‚ç½‘ç»œé…ç½®ä¸­ç­–ç•¥æŒ‡æ˜R1å¯¹é€šé“å’Œè”ç›Ÿå…·æœ‰åŒç­‰çš„ç®¡ç†æƒé™ã€‚</p><p>R4 however, could grant even more power over the network configuration to R1! R4 could add R1 to the mod_policy such that R1 would be able to manage change of the network policy too.</p><p>ä½†æ˜¯ï¼ŒR4å¯ä»¥é€šè¿‡ç½‘ç»œé…ç½®å‘R1æˆäºˆæ›´å¤šæƒåˆ©ã€‚R4å¯ä»¥å°†R1æ·»åŠ åˆ°mod_policyä¸­ï¼Œä»¥ä¾¿R1ä¹Ÿèƒ½å¤Ÿç®¡ç†ç½‘ç»œç­–ç•¥çš„æ›´æ”¹ã€‚</p><p>This second power is much more powerful than the first, because R1 now has <strong>full control</strong> over the network configuration NC4! This means that R1 can, in principle remove R4â€™s management rights from the network. In practice, R4 would configure the mod_policy such that R4 would need to also approve the change, or that all organizations in the mod_policy would have to approve the change. Thereâ€™s lots of flexibility to make the mod_policy as sophisticated as it needs to be to support whatever change process is required.</p><p>ç¬¬äºŒä¸ªæƒåˆ©ç›¸æ¯”äºç¬¬ä¸€ä¸ªæ¥è¯´å¼ºå¤§çš„å¤šï¼Œå› ä¸ºR1ç°åœ¨å¯ä»¥å®Œå…¨æ§åˆ¶ç½‘ç»œé…ç½®NC4ï¼è¿™æ„å‘³ç€R1åŸåˆ™ä¸Šå¯ä»¥ä»ç½‘ç»œä¸­åˆ é™¤R4çš„ç®¡ç†æƒé™ã€‚åœ¨å®è·µä¸­ï¼ŒR4å°†æŠŠmod_policyé…ç½®æˆä¸ºR4éœ€è¦æ‰¹å‡†é…ç½®æ›´æ”¹ï¼Œæˆ–è€…mod_policyä¸­çš„æ‰€æœ‰ç»„ç»‡éƒ½å¿…é¡»æ‰¹å‡†æ›´æ”¹ã€‚æœ‰è¶³å¤Ÿçš„çµæ´»æ€§å¯ä»¥ä½¿mod_policyå¤æ‚åˆ°å¯ä»¥æ”¯æŒæ‰€éœ€çš„ä»»ä½•æ›´æ”¹è¿‡ç¨‹ã€‚</p><p>This is mod_policy at work â€“ it has allowed the graceful evolution of a basic configuration into a sophisticated one. All the time this has occurred with the agreement of all organization involved. The mod_policy behaves like every other policy inside a network or channel configuration; it defines a set of organizations that are allowed to change the mod_policy itself.</p><p>è¿™å°±æ˜¯mod_policyçš„ä½œç”¨ï¼Œå®ƒä½¿åŸºæœ¬é…ç½®å¯ä»¥ä¼˜é›…åœ°æ¼”å˜ä¸ºå¤æ‚çš„é…ç½®ã€‚åœ¨æ‰€æœ‰ç›¸å…³ç»„ç»‡è¾¾æˆä¸€è‡´ä¹‹åï¼Œè¿™ç§æƒ…å†µä¸€ç›´å­˜åœ¨ã€‚mod_policyçš„è¡Œä¸ºä¸ç½‘ç»œæˆ–é€šé“é…ç½®ä¸­çš„æ‰€æœ‰å…¶ä»–ç­–ç•¥ç›¸åŒï¼›å®ƒå®šä¹‰äº†ä¸€ç»„å…è®¸æ›´æ”¹mod_policyæœ¬èº«çš„ç»„ç»‡ã€‚</p><p>Weâ€™ve only scratched the surface of the power of policies and mod_policy in particular in this subsection. It is discussed at much more length in the policy topic, but for now letâ€™s return to our finished network!</p><p>åœ¨æœ¬å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»…ä»‹ç»äº†ç­–ç•¥å’Œmod_policyçš„åŠŸèƒ½ã€‚åœ¨ç­–ç•¥ä¸»é¢˜ä¸­å°†å¯¹å®ƒè¿›è¡Œæ›´è¯¦ç»†çš„è®¨è®ºï¼Œä½†ç°åœ¨è®©æˆ‘ä»¬å›åˆ°å®Œæˆçš„ç½‘ç»œä¸­ï¼</p><h2 id="Network-fully-formedï¼ˆç½‘ç»œå…¨é¢å½¢æˆï¼‰">Network fully formedï¼ˆç½‘ç»œå…¨é¢å½¢æˆï¼‰</h2><p>Letâ€™s recap what our network looks like using a consistent visual vocabulary. Weâ€™ve re-organized it slightly using our more compact visual syntax, because it better accommodates larger topologies:</p><p>è®©æˆ‘ä»¬ä½¿ç”¨ä¸€è‡´çš„è§†è§‰è¯æ±‡æ¥å›é¡¾ä¸€ä¸‹æˆ‘ä»¬çš„ç½‘ç»œã€‚æˆ‘ä»¬ä½¿ç”¨æ›´ç´§å‡‘çš„è§†è§‰è¯­æ³•å¯¹å…¶è¿›è¡Œäº†ç¨å¾®çš„é‡ç»„ï¼Œå› ä¸ºå®ƒå¯ä»¥æ›´å¥½åœ°é€‚åº”æ›´å¤§çš„æ‹“æ‰‘ï¼š</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/network.diagram.14.png" alt="network.diagram.14"></p><p><em>In this diagram we see that the Fabric blockchain network consists of two application channels and one ordering channel. The organizations R1 and R4 are responsible for the ordering channel, R1 and R2 are responsible for the blue application channel while R2 and R3 are responsible for the red application channel. Client applications A1 is an element of organization R1, and CA1 is itâ€™s certificate authority. Note that peer P2 of organization R2 can use the communication facilities of the blue and the red application channel. Each application channel has its own channel configuration, in this case CC1 and CC2. The channel configuration of the system channel is part of the network configuration, NC4.</em></p><p><em>åœ¨æˆ‘ä»¬çœ‹åˆ°çš„è¿™ä¸ªå›¾ç‰‡ä¸­ï¼ŒFabircåŒºå—é“¾ç½‘ç»œåŒ…å«ä¸¤ä¸ªåº”ç”¨ç¨‹åºé€šé“å’Œä¸€ä¸ªæ’åºé€šé“ã€‚ç»„ç»‡R1å’ŒR4è´Ÿè´£æ’åºé€šé“ï¼ŒR1å’ŒR2è´Ÿè´£è“è‰²åº”ç”¨ç¨‹åºé€šé“ï¼Œè€ŒR2å’ŒR3è´Ÿè´£çº¢è‰²åº”ç”¨ç¨‹åºé€šé“ã€‚å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA1æ˜¯ç»„ç»‡R1çš„å…ƒç´ ï¼Œè€ŒCA1æ˜¯ç»„ç»‡çš„è¯ä¹¦é¢å‘æœºæ„ã€‚æ³¨æ„å±äºç»„ç»‡R2çš„PeerèŠ‚ç‚¹P2å¯ä»¥åŒæ—¶ä½¿ç”¨çº¢è‰²å’Œè“è‰²çš„åº”ç”¨ç¨‹åºé€šé“çš„é€šä¿¡è®¾æ–½ã€‚æ¯ä¸ªåº”ç”¨ç¨‹åºé€šé“éƒ½æœ‰è‡ªå·±çš„é€šé“é…ç½®ï¼Œä¾‹å¦‚CC1å’ŒCC2ã€‚ç³»ç»Ÿé€šé“çš„é€šé“é…ç½®æ˜¯ç½‘ç»œé…ç½®ï¼ˆNC4ï¼‰çš„ä¸€éƒ¨åˆ†ã€‚</em></p><p>Weâ€™re at the end of our conceptual journey to build a sample Hyperledger Fabric blockchain network. Weâ€™ve created a four organization network with two channels and three peer nodes, with two smart contracts and an ordering service. It is supported by four certificate authorities. It provides ledger and smart contract services to three client applications, who can interact with it via the two channels. Take a moment to look through the details of the network in the diagram, and feel free to read back through the topic to reinforce your knowledge, or go to a more detailed topic.</p><p>æˆ‘ä»¬æ„å»ºç®€å•çš„Hyperledger FabricåŒºå—é“¾ç½‘ç»œçš„æ¦‚å¿µä¹‹æ—…å·²ç»“æŸã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªé€šé“å’Œä¸‰ä¸ªpeerèŠ‚ç‚¹ï¼Œä¸¤ä¸ªæ™ºèƒ½åˆçº¦å’Œä¸€ä¸ªæ’åºæœåŠ¡çš„å››ä¸ªç»„ç»‡çš„ç½‘ç»œã€‚è¿™ä¸ªç½‘ç»œç”±å››ä¸ªè¯ä¹¦é¢å‘æœºæ„æ”¯æŒã€‚è¿™ä¸ªç½‘ç»œå¯¹ä¸‰ä¸ªå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæä¾›è´¦æœ¬å’Œæ™ºèƒ½åˆçº¦æœåŠ¡ï¼Œä»–ä»¬å¯ä»¥é€šè¿‡ä¸¤ä¸ªé€šé“ä¸ä¹‹äº¤äº’ã€‚èŠ±ä¸€ç‚¹æ—¶é—´æµè§ˆå›¾ä¸­çš„ç½‘ç»œè¯¦ç»†ä¿¡æ¯ï¼Œå¹¶éšæ—¶é˜…è¯»æœ¬ä¸»é¢˜ä»¥å¢å¼ºæ‚¨çš„çŸ¥è¯†ï¼Œæˆ–è€…è½¬åˆ°æ›´è¯¦ç»†çš„ä¸»é¢˜ã€‚</p><h3 id="Summary-of-network-componentsï¼ˆç½‘ç»œç»„ä»¶çš„æ‘˜è¦ï¼‰">Summary of network componentsï¼ˆç½‘ç»œç»„ä»¶çš„æ‘˜è¦ï¼‰</h3><p>Hereâ€™s a quick summary of the network components weâ€™ve discussedï¼ˆä»¥ä¸‹æ˜¯æˆ‘ä»¬è®¨è®ºè¿‡çš„ç½‘ç»œç»„ä»¶çš„ç®€è¦æ‘˜è¦ï¼‰ï¼š</p><ul><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/glossary.html#ledger">Ledger</a>. One per channel. Comprised of the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/glossary.html#block">Blockchain</a> and the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/glossary.html#world-state">World state</a>ï¼ˆæ¯ä¸ªé€šé“ä¸€ä¸ªã€‚ç”±åŒºå—é“¾å’Œä¸–ç•ŒçŠ¶æ€ç»„æˆï¼‰</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/glossary.html#smart-contract">Smart contract</a> (aka chaincode)ï¼ˆAlso Known Asæ™ºèƒ½åˆçº¦ï¼‰</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/glossary.html#peer">Peer nodes</a>ï¼ˆpeerèŠ‚ç‚¹ï¼‰</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/glossary.html#ordering-service">Ordering service</a>ï¼ˆæ’åºæœåŠ¡ï¼‰</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/glossary.html#channel">Channel</a>ï¼ˆé€šé“ï¼‰</li><li><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/glossary.html#hyperledger-fabric-ca">Certificate Authority</a>ï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰</li></ul><h2 id="Network-summaryï¼ˆç½‘ç»œæ€»ç»“ï¼‰">Network summaryï¼ˆç½‘ç»œæ€»ç»“ï¼‰</h2><p>In this topic, weâ€™ve seen how different organizations share their infrastructure to provide an integrated Hyperledger Fabric blockchain network. Weâ€™ve seen how the collective infrastructure can be organized into channels that provide private communications mechanisms that are independently managed. Weâ€™ve seen how actors such as client applications, administrators, peers and orderers are identified as being from different organizations by their use of certificates from their respective certificate authorities. And in turn, weâ€™ve seen the importance of policy to define the agreed permissions that these organizational actors have over network and channel resources.</p><p>åœ¨æœ¬ä¸»é¢˜ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä¸åŒçš„ç»„ç»‡å¦‚ä½•å…±äº«å…¶åŸºç¡€æ¶æ„ä»¥æä¾›é›†æˆHyperledger FabricåŒºå—é“¾ç½‘ç»œã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•å°†é›†ä½“åŸºç¡€ç»“æ„ç»„ç»‡ä¸ºæä¾›ç‹¬ç«‹ç®¡ç†çš„ç§æœ‰é€šä¿¡æœºåˆ¶çš„é€šé“ã€‚æˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä½•é€šè¿‡ä½¿ç”¨æ¥è‡ªå„è‡ªè¯ä¹¦é¢å‘æœºæ„çš„è¯ä¹¦å°†è¯¸å¦‚å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œç®¡ç†å‘˜ï¼ŒpeerèŠ‚ç‚¹å’Œæ’åºè€…ä¹‹ç±»çš„å‚ä¸è€…è¯†åˆ«ä¸ºæ¥è‡ªä¸åŒç»„ç»‡ã€‚åè¿‡æ¥ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å®šä¹‰è¿™äº›ç»„ç»‡å‚ä¸è€…å¯¹ç½‘ç»œå’Œé€šé“èµ„æºæ‹¥æœ‰çš„åŒæ„æƒé™çš„æ”¿ç­–çš„é‡è¦æ€§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> Key Concepts </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> network </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hyperledger-Fabricå¼€å‘ç¯å¢ƒå‡†å¤‡</title>
      <link href="2021/04/01/blockchain/fabric/Hyperledger-Fabric%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/"/>
      <url>2021/04/01/blockchain/fabric/Hyperledger-Fabric%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/</url>
      
        <content type="html"><![CDATA[<h3 id="å®‰è£…homebrew">å®‰è£…homebrew</h3><p>æŸ¥çœ‹<a href="https://mirror.tuna.tsinghua.edu.cn/help/homebrew">æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™</a>é…ç½®å›½å†…é•œåƒåŠ å¿«å®‰è£…è½¯ä»¶çš„é€Ÿåº¦ã€‚</p><h3 id="å®‰è£…Fabricçš„ç¯å¢ƒä¾èµ–">å®‰è£…Fabricçš„ç¯å¢ƒä¾èµ–</h3><p>ä½¿ç”¨<code>brew</code>å®‰è£…<code>git</code>ã€<code>go</code>ã€<code>jq</code>ã€<code>softhsm</code>ã€<code>docker</code>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install git go jq softhsm</span><br><span class="line">brew cask install --appdir=&quot;/Applications&quot; docker</span><br></pre></td></tr></table></figure><p>æˆ‘åœ¨å®‰è£…çš„æ—¶å€™å› ä¸ºGreat Wallçš„åŸå› æœ‰ä¸ªgoçš„å·¥å…·æ²¡æœ‰ä¸‹è½½ä¸‹æ¥ï¼Œè®°å½•ä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Failure while executing; `git clone --branch release-branch.go1.15 -c advice.detachedHead=false https://go.googlesource.com/tools.git /Users/apple/Library/Caches/Homebrew/go--gotools--git` exited with 128. Here&#x27;s the output:</span><br><span class="line">Cloning into &#x27;/Users/apple/Library/Caches/Homebrew/go--gotools--git&#x27;...</span><br><span class="line">fatal: unable to access &#x27;https://go.googlesource.com/tools.git/&#x27;: Failed to connect to go.googlesource.com port 443: Operation timed out</span><br></pre></td></tr></table></figure><h3 id="fabricæºç ä¸‹è½½">fabricæºç ä¸‹è½½</h3><p>ä¸ºäº†åŠ é€Ÿï¼Œåœ¨<a href="https://gitee.com/">gitee</a>ä¸Šå¯¼å…¥é¡¹ç›®ï¼š<a href="https://github.com/hyperledger/fabric%E7%84%B6%E5%90%8Eclone%E5%88%B0%E6%9C%AC%E5%9C%B0%E3%80%82">https://github.com/hyperledger/fabricç„¶åcloneåˆ°æœ¬åœ°ã€‚</a></p><h3 id="å®‰è£…å¼€å‘å·¥å…·">å®‰è£…å¼€å‘å·¥å…·</h3><p>1ã€åœ¨fabricç›®å½•ä¸‹ï¼Œè¿è¡Œå‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make gotools</span><br></pre></td></tr></table></figure><p>2ã€å®‰è£…å®Œæˆå·¥å…·ä¹‹åï¼ŒéªŒè¯ç¯å¢ƒæ˜¯å¦æ­£å¸¸</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make basic-checks integration-test-prereqs</span><br><span class="line">ginkgo -r ./integration/nwo</span><br></pre></td></tr></table></figure><p>æˆ‘çš„ç¬¬äºŒéƒ¨æµ‹è¯•æ²¡æœ‰é€šè¿‡ï¼Œè®°å½•å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(base) apple@WHOAMIdeMacBook-Pro:~/code/open-source/blockchain/hyperledger/fabric$     ginkgo -r ./integration/nwo</span><br><span class="line">Running Suite: New World Order Suite</span><br><span class="line">====================================</span><br><span class="line">Random Seed: 1607936946</span><br><span class="line">Will run 4 of 4 specs</span><br><span class="line"></span><br><span class="line">Failure [0.011 seconds]</span><br><span class="line">[BeforeSuite] BeforeSuite</span><br><span class="line">/Users/apple/code/open-source/blockchain/hyperledger/fabric/integration/nwo/nwo_suite_test.go:29</span><br><span class="line"></span><br><span class="line">  missing required image: hyperledger/fabric-ccenv:latest</span><br><span class="line"></span><br><span class="line">  /Users/apple/code/open-source/blockchain/hyperledger/fabric/integration/nwo/buildserver.go:56</span><br><span class="line">------------------------------</span><br><span class="line"></span><br><span class="line">Ran 4 of 0 Specs in 0.512 seconds</span><br><span class="line">FAIL! -- 0 Passed | 4 Failed | 0 Pending | 0 Skipped</span><br><span class="line">--- FAIL: TestNewWorldOrder (0.51s)</span><br><span class="line">FAIL</span><br><span class="line"></span><br><span class="line">Ginkgo ran 1 suite in 3.561084735s</span><br><span class="line">Test Suite Failed</span><br></pre></td></tr></table></figure><p>3ã€ä»è„šæœ¬è¿è¡Œä¸­çš„ä¿¡æ¯å¯ä»¥ç›´åˆ°ä¾èµ–äº†å“ªäº›è½¯ä»¶ï¼š</p><ul><li><a href="https://github.com/docker-library/official-images/blob/master/library/alpine">library/alpine:3.12</a></li><li><a href="https://hub.docker.com/r/hyperledger/fabric-baseos">hyperledger/fabric-baseos</a></li><li><a href="https://github.com/docker-library/golang">golang:1.14.12-alpine3.12</a></li><li><a href="https://hub.docker.com/r/hyperledger/fabric-ccenv">hyperledger/fabric-ccenv</a></li><li><a href="https://hub.docker.com/r/confluentinc/cp-zookeeper">confluentinc/cp-zookeeper:5.3.1</a></li><li><a href="https://hub.docker.com/r/confluentinc/cp-kafka">confluentinc/cp-kafka:5.3.1</a></li><li><a href="https://github.com/docker-library/official-images/blob/master/library/couchdb">library/couchdb:3.1.1</a></li></ul><p>5.æ·»åŠ æ›´å¤šçš„ä¾èµ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ·»åŠ  gnu-tar</span></span><br><span class="line">brew install gnu-tar --with-default-names</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ·»åŠ  libtool</span></span><br><span class="line">brew install libtool</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç¼–è¯‘ configtxgen</span></span><br><span class="line">make configtxgen</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabric chaincode lifecycle</title>
      <link href="2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Fabric%20chaincode%20lifecycle/"/>
      <url>2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Fabric%20chaincode%20lifecycle/</url>
      
        <content type="html"><![CDATA[<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/chaincode_lifecycle.html#what-is-chaincode">Fabric chaincode lifecycle</a></p><h2 id="Install-and-define-a-chaincode">Install and define a chaincode</h2><ol><li><strong>Package the chaincode:</strong> This step can be completed by one organization or by each organization.</li><li><strong>Install the chaincode on your peers:</strong> Every organization that will use the chaincode to endorse a transaction or query the ledger needs to complete this step.</li><li><strong>Approve a chaincode definition for your organization:</strong> Every organization that will use the chaincode needs to complete this step. The chaincode definition needs to be approved by a sufficient number of organizations to satisfy the channelâ€™s LifecycleEndorsment policy (a majority, by default) before the chaincode can be started on the channel.</li><li><strong>Commit the chaincode definition to the channel:</strong> The commit transaction needs to be submitted by one organization once the required number of organizations on the channel have approved. The submitter first collects endorsements from enough peers of the organizations that have approved, and then submits the transaction to commit the chaincode definition.</li></ol><h2 id="Upgrade-a-chaincode">Upgrade a chaincode</h2><ol><li><p><strong>Repackage the chaincode:</strong> You only need to complete this step if you are upgrading the chaincode binaries.</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/Lifecycle-upgrade-package.png" alt="Re-package the chaincode package"></p><p><em>Org1 and Org2 upgrade the chaincode binaries and repackage the chaincode. Both organizations use a different package label.</em></p></li><li><p><strong>Install the new chaincode package on your peers:</strong> Once again, you only need to complete this step if you are upgrading the chaincode binaries. Installing the new chaincode package will generate a package ID, which you will need to pass to the new chaincode definition. You also need to change the chaincode version, which is used by the lifecycle process to track if the chaincode binaries have been upgraded.</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/Lifecycle-upgrade-install.png" alt="Re-install the chaincode package"></p><p><em>Org1 and Org2 install the new package on their peers. The installation creates a new packageID.</em></p></li><li><p><strong>Approve a new chaincode definition:</strong> If you are upgrading the chaincode binaries, you need to update the chaincode version and the package ID in the chaincode definition. You can also update your chaincode endorsement policy without having to repackage your chaincode binaries. Channel members simply need to approve a definition with the new policy. The new definition needs to increment the <strong>sequence</strong> variable in the definition by one.</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/Lifecycle-upgrade-approve.png" alt="Approve a new chaincode definition"></p><p><em>Organization administrators from Org1 and Org2 approve the new chaincode definition for their respective organizations. The new definition references the new packageID and changes the chaincode version. Since this is the first update of the chaincode, the sequence is incremented from one to two.</em></p></li><li><p><strong>Commit the definition to the channel:</strong> When a sufficient number of channel members have approved the new chaincode definition, one organization can commit the new definition to upgrade the chaincode definition to the channel. There is no separate upgrade command as part of the lifecycle process.</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/Lifecycle-upgrade-commit.png" alt="Commit the new definition to the channel"></p><p><em>An organization administrator from Org1 or Org2 commits the new chaincode definition to the channel.</em></p></li></ol><h3 id="Organizations-install-different-chaincode-packages">Organizations install different chaincode packages</h3><p>Each organization can use a different packageID when they approve a chaincode definition. This allows channel members to install different chaincode binaries that use the same endorsement policy and read and write to data in the same chaincode namespace.</p><p>æ¯ä¸ªç»„ç»‡åœ¨æ‰¹å‡†é“¾ç å®šä¹‰æ—¶éƒ½å¯ä»¥ä½¿ç”¨ä¸åŒçš„packageIDã€‚è¿™å…è®¸é€šé“æˆå‘˜å®‰è£…ä½¿ç”¨ç›¸åŒèƒŒä¹¦ç­–ç•¥çš„ä¸åŒé“¾ä»£ç äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶åœ¨åŒä¸€é“¾ç åç§°ç©ºé—´ä¸­è¯»å–å’Œå†™å…¥æ•°æ®ã€‚</p><p>Organizations can use this capability to install smart contracts that contain business logic that is specific to their organization. Each organizationâ€™s smart contract could contain additional validation that the organization requires before their peers endorse a transaction. Each organization can also write code that helps integrate the smart contract with data from their existing systems.</p><p>ç»„ç»‡å¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½æ¥å®‰è£…åŒ…å«å…¶ç»„ç»‡çš„ç‰¹æ®Šçš„ä¸šåŠ¡é€»è¾‘çš„æ™ºèƒ½åˆçº¦ã€‚æ¯ä¸ªç»„ç»‡çš„æ™ºèƒ½åˆçº¦éƒ½å¯ä»¥åŒ…å«ç»„ç»‡åœ¨å…¶peerè®¤å¯äº¤æ˜“ä¹‹å‰æ‰€éœ€çš„å…¶ä»–éªŒè¯ã€‚æ¯ä¸ªç»„ç»‡è¿˜å¯ä»¥ç¼–å†™ä»£ç å°†æ™ºèƒ½åˆçº¦ä¸ä»–ä»¬ç°æœ‰ç³»ç»Ÿä¸­çš„æ•°æ®é›†æˆåœ¨ä¸€èµ·ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/Lifecycle-binaries.png" alt="Using different chaincode binaries"></p><p><em>Org1 and Org2 each install versions of the MYCC chaincode containing business logic that is specific to their organization.</em></p><h3 id="Creating-multiple-chaincodes-using-one-package">Creating multiple chaincodes using one package</h3><p>You can use one chaincode package to create multiple chaincode instances on a channel by approving and committing multiple chaincode definitions. Each definition needs to specify a different chaincode name. This allows you to run multiple instances of a smart contract on a channel, but have the contract be subject to different endorsement policies.</p><p>æ‚¨å¯ä»¥é€šè¿‡æ‰¹å‡†å¹¶æäº¤å¤šä¸ªé“¾ç å®šä¹‰ï¼Œä½¿ç”¨ä¸€ä¸ªé“¾ç åŒ…åœ¨ä¸€ä¸ªé€šé“ä¸Šåˆ›å»ºå¤šä¸ªé“¾ç å®ä¾‹ã€‚æ¯ä¸ªå®šä¹‰éƒ½éœ€è¦æŒ‡å®šä¸€ä¸ªä¸åŒçš„é“¾ç åç§°ã€‚è¿™ä½¿æ‚¨å¯ä»¥åœ¨ä¸€ä¸ªé€šé“ä¸Šè¿è¡Œæ™ºèƒ½åˆçº¦çš„å¤šä¸ªå®ä¾‹ï¼Œä½†æ˜¯è¦è®©åˆçº¦éµå¾ªä¸åŒçš„èƒŒä¹¦ç­–ç•¥ã€‚</p><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/Lifecycle-multiple.png" alt="Starting multiple chaincodes"></p><p><em>Org1 and Org2 use the MYCC_1 chaincode package to approve and commit two different chaincode definitions. As a result, both peers have two chaincode containers running on their peers. MYCC1 has an endorsement policy of 1 out of 2, while MYCC2 has an endorsement policy of 2 out of 2.</em></p><p><em>ä¸ªäººç–‘é—®ï¼šéƒ¨ç½²ç›¸çš„é“¾ç ï¼Œä½¿ç”¨ä¸åŒçš„èƒŒä¹¦ç­–ç•¥ï¼Œè¿™ä¹ˆåšæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</em></p><h2 id="Migrate-to-the-new-Fabric-lifecycle">Migrate to the new Fabric lifecycle</h2><p>For information about migrating to the new lifecycle, check out <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/upgrade_to_newest_version.html#chaincode-lifecycle">Considerations for getting to v2.0</a>.</p><p>If you need to update your channel configurations to enable the new lifecycle, check out <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/enable_cc_lifecycle.html">Enabling the new chaincode lifecycle</a>.</p><h2 id="More-information">More information</h2><p>You can watch video below to learn more about the motivation of the new Fabric chaincode lifecycle and how it is implemented.</p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
          <category> Key Concepts </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> Fabric chaincode lifecycle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hyberledger-Fabricå­¦ä¹ æ€»ç»“</title>
      <link href="2021/04/01/blockchain/fabric/Hyberledger-Fabric%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/"/>
      <url>2021/04/01/blockchain/fabric/Hyberledger-Fabric%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p><a href="https://guozhe001.github.io/2021/04/01/blockchain/fabric/Hyperledger-Fabric%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/">Hyperledger-Fabricå¼€å‘ç¯å¢ƒå‡†å¤‡</a></p><p><a href="https://guozhe001.github.io/2021/04/01/blockchain/fabric/Fabric%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%E4%BD%BF%E7%94%A8/">Fabricæµ‹è¯•ç½‘ç»œä½¿ç”¨</a></p><p><a href="https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E5%B0%86%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E9%83%A8%E7%BD%B2%E5%88%B0%E9%80%9A%E9%81%93/">å°†æ™ºèƒ½åˆçº¦éƒ¨ç½²åˆ°é€šé“</a></p><p><a href="https://guozhe001.github.io/2021/04/01/blockchain/fabric/Frbirc%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/">Frbircæµ‹è¯•ç¯å¢ƒé”™è¯¯è®°å½•</a></p><p><a href="https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E7%BC%96%E5%86%99%E6%82%A8%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AAChaincode/">ç¼–å†™æ‚¨çš„ç¬¬ä¸€ä¸ªChaincode</a></p><p>[é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric](file://é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric/summary.md)</p><p>[åœ¨Fabricä¸­äº¤æ˜“å—ä¿æŠ¤çš„èµ„äº§](file://åœ¨Fabricä¸­äº¤æ˜“å—ä¿æŠ¤çš„èµ„äº§.md)</p><p><a href="https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E5%9C%A8Fabric%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%A7%81%E6%9C%89%E6%95%B0%E6%8D%AE/">åœ¨Fabricä¸­ä½¿ç”¨ç§æœ‰æ•°æ®</a></p><p>[èƒŒä¹¦ç­–ç•¥](file://Endorsement <a href="http://xn--policies-gs0mk433a9wnjop.md">policiesèƒŒä¹¦ç­–ç•¥.md</a>)</p><p><a href="https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6API%E5%AD%A6%E4%B9%A0/Fabric%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6API%E5%AD%A6%E4%B9%A0/">Fabricæ™ºèƒ½åˆçº¦APIå­¦ä¹ </a></p><h3 id="èµ„æ–™æ•´ç†">èµ„æ–™æ•´ç†</h3><ul><li><p><a href="https://www.hyperledger.org/">hyperledgerå®˜ç½‘</a></p></li><li><p><a href="https://hyperledgercn.github.io/hyperledgerDocs/">hyperledgerä¸­æ–‡æ–‡æ¡£</a></p></li><li><p><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/">hyperladgerè‹±æ–‡æ–‡æ¡£</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hyperledger-Frbircæµ‹è¯•ç¯å¢ƒé”™è¯¯è®°å½•</title>
      <link href="2021/04/01/blockchain/fabric/Frbirc%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/"/>
      <url>2021/04/01/blockchain/fabric/Frbirc%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h2 id="ç½‘ç»œ">ç½‘ç»œ</h2><h3 id="æµ‹è¯•ç½‘ç»œå…¶ä¸­ä¸€ä¸ªç»„ç»‡çš„peeræ— æ³•å¯åŠ¨">æµ‹è¯•ç½‘ç»œå…¶ä¸­ä¸€ä¸ªç»„ç»‡çš„peeræ— æ³•å¯åŠ¨</h3><h4 id="é”™è¯¯æè¿°">é”™è¯¯æè¿°</h4><p>åœ¨è¿è¡Œ<code>./network.sh up</code>æ—¶ï¼Œåªå¯åŠ¨äº†ä¸€ä¸ªç»„ç»‡çš„peerï¼Œå¦ä¸€ä¸ªæ— æ³•å¯åŠ¨ã€‚å¯¼è‡´åœ¨æ–°å»ºchannelæ—¶æŠ¥é”™å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2021-01-04 10:49:22.575 CST [comm.tls] ClientHandshake -&gt; ERRO 001 Client TLS handshake failed after 2.157125ms with error: EOF remoteaddress=[::1]:7051</span><br><span class="line">2021-01-04 10:49:23.582 CST [comm.tls] ClientHandshake -&gt; ERRO 002 Client TLS handshake failed after 3.12316ms with error: EOF remoteaddress=[::1]:7051</span><br><span class="line">2021-01-04 10:49:25.157 CST [comm.tls] ClientHandshake -&gt; ERRO 003 Client TLS handshake failed after 4.29759ms with error: EOF remoteaddress=[::1]:7051</span><br><span class="line">Error: error getting endorser client for channel: endorser client failed to connect to localhost:7051: failed to create new connection: context deadline exceeded</span><br><span class="line">After 5 attempts, peer0.org1 has failed to join channel &#x27;mychannel&#x27;</span><br><span class="line">Create channel failed</span><br></pre></td></tr></table></figure><p>å› ä¸ºè¿™ä¸ªé—®é¢˜å¯¼è‡´çš„é“¾ç æ— æ³•éƒ¨ç½²ï¼š</p><h3 id></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">(base) apple@WHOAMIdeMacBook-Pro:~/code/open-source/blockchain/hyperledger/fabric-samples/test-network$     ./network.sh deployCC</span><br><span class="line">deploying chaincode on channel &#x27;mychannel&#x27;</span><br><span class="line">executing with the following</span><br><span class="line">- CHANNEL_NAME: mychannel</span><br><span class="line">- CC_NAME: basic</span><br><span class="line">- CC_SRC_PATH: NA</span><br><span class="line">- CC_SRC_LANGUAGE: go</span><br><span class="line">- CC_VERSION: 1.0</span><br><span class="line">- CC_SEQUENCE: 1</span><br><span class="line">- CC_END_POLICY: NA</span><br><span class="line">- CC_COLL_CONFIG: NA</span><br><span class="line">- CC_INIT_FCN: NA</span><br><span class="line">- DELAY: 3</span><br><span class="line">- MAX_RETRY: 5</span><br><span class="line">- VERBOSE: false</span><br><span class="line">Determining the path to the chaincode</span><br><span class="line">asset-transfer-basic</span><br><span class="line">Vendoring Go dependencies at ../asset-transfer-basic/chaincode-go/</span><br><span class="line">~/code/open-source/blockchain/hyperledger/fabric-samples/asset-transfer-basic/chaincode-go ~/code/open-source/blockchain/hyperledger/fabric-samples/test-network</span><br><span class="line">~/code/open-source/blockchain/hyperledger/fabric-samples/test-network</span><br><span class="line">Finished vendoring Go dependencies</span><br><span class="line">+ peer lifecycle chaincode package basic.tar.gz --path ../asset-transfer-basic/chaincode-go/ --lang golang --label basic_1.0</span><br><span class="line">+ res=0</span><br><span class="line">Chaincode is packaged</span><br><span class="line">Installing chaincode on peer0.org1...</span><br><span class="line">Using organization 1</span><br><span class="line">+ peer lifecycle chaincode install basic.tar.gz</span><br><span class="line">+ res=1</span><br><span class="line">Error: failed to retrieve endorser client for install: endorser client failed to connect to localhost:7051: failed to create new connection: context deadline exceeded</span><br><span class="line">Usage:</span><br><span class="line">  peer lifecycle chaincode install [flags]</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">      --connectionProfile string       The fully qualified path to the connection profile that provides the necessary connection information for the network. Note: currently only supported for providing peer connection information</span><br><span class="line">  -h, --help                           help for install</span><br><span class="line">      --peerAddresses stringArray      The addresses of the peers to connect to</span><br><span class="line">      --tlsRootCertFiles stringArray   If TLS is enabled, the paths to the TLS root cert files of the peers to connect to. The order and number of certs specified should match the --peerAddresses flag</span><br><span class="line"></span><br><span class="line">Global Flags:</span><br><span class="line">      --cafile string                       Path to file containing PEM-encoded trusted certificate(s) for the ordering endpoint</span><br><span class="line">      --certfile string                     Path to file containing PEM-encoded X509 public key to use for mutual TLS communication with the orderer endpoint</span><br><span class="line">      --clientauth                          Use mutual TLS when communicating with the orderer endpoint</span><br><span class="line">      --connTimeout duration                Timeout for client to connect (default 3s)</span><br><span class="line">      --keyfile string                      Path to file containing PEM-encoded private key to use for mutual TLS communication with the orderer endpoint</span><br><span class="line">  -o, --orderer string                      Ordering service endpoint</span><br><span class="line">      --ordererTLSHostnameOverride string   The hostname override to use when validating the TLS connection to the orderer</span><br><span class="line">      --tls                                 Use TLS when communicating with the orderer endpoint</span><br><span class="line">      --tlsHandshakeTimeShift duration      The amount of time to shift backwards for certificate expiration checks during TLS handshakes with the orderer endpoint</span><br><span class="line"></span><br><span class="line">Chaincode installation on peer0.org1 has failed</span><br><span class="line">Deploying chaincode failed</span><br></pre></td></tr></table></figure><h4 id="é”™è¯¯åŸå› å’Œè§£å†³æ–¹æ¡ˆ">é”™è¯¯åŸå› å’Œè§£å†³æ–¹æ¡ˆ</h4><p>å¯èƒ½æ˜¯å› ä¸º<code>bin</code>å’Œ<code>config</code>ç›®å½•ä¸­çš„ç‰ˆæœ¬ä¸å¯åŠ¨æ—¶æŒ‡å®šçš„ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œ<code>./network.sh up</code>å‘½ä»¤ä½¿ç”¨çš„åº”è¯¥æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼Œç¡®è®¤<code>bin</code>å’Œ<code>config</code>ç›®å½•ä¸‹çš„ä¹Ÿåº”è¯¥æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ã€‚å¯ä»¥é‡æ–°æ›¿æ¢è¿™ä¸¤ä¸ªç›®å½•çš„ä»£ç ã€‚</p><h2 id="é“¾ç ">é“¾ç </h2><h3 id="è°ƒç”¨é“¾ç ">è°ƒç”¨é“¾ç </h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C coreandfirstchannel -n supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;IssueVoucher&quot;,&quot;Args&quot;:[&quot;asset001&quot;, &quot;100&quot;, &quot;ä¸€çº§ä¾›åº”å•†&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2020-12-28 18:37:54.285 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200</span><br></pre></td></tr></table></figure><p><strong>é”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: could not assemble transaction: proposal response was not successful, error code 500, msg Incorrect number of params. Expected 2, received 1 - proposal response: version:1 response:&lt;status:200 &gt; payload:&quot;\n \177\017\350[\344G6\010V\331\332\377\354\216&amp;\035\317&amp;\251[N`\023\036\033\237\237A\005\3670\260\022\266\002\n\237\002\0227\n\n_lifecycle\022)\n&#x27;\n!namespaces/fields/supply/Sequence\022\002\010\016\022\343\001\n\006supply\022\330\001\n\003\n\0011\032\320\001\n\0011\032\312\001&#123;\&quot;ID\&quot;:\&quot;1\&quot;,\&quot;issuer\&quot;:\&quot;\346\240\270\345\277\203\344\274\201\344\270\232\&quot;,\&quot;owner\&quot;:\&quot;\346\240\270\345\277\203\344\274\201\344\270\232\&quot;,\&quot;amount\&quot;:100,\&quot;createDate\&quot;:\&quot;2020-12-28T10:02:30.578872398Z\&quot;,\&quot;endDate\&quot;:\&quot;2021-06-28T10:02:30.578872527Z\&quot;,\&quot;contractHash\&quot;:\&quot;test\&quot;,\&quot;invoiceHash\&quot;:\&quot;test\&quot;&#125;\032\003\010\310\001\&quot;\r\022\006supply\032\0033.0&quot; endorsement:&lt;endorser:&quot;\n\016GylCoreOrg1MSP\022\222\006-----BEGIN CERTIFICATE-----\nMIICFjCCAbygAwIBAgIQU43L5gjtXO+uCpRP2jG2AjAKBggqhkjOPQQDAjBxMQsw\nCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMNU2FuIEZy\nYW5jaXNjbzEYMBYGA1UEChMPY29yZS5zdXBwbHkuY29tMRswGQYDVQQDExJjYS5j\nb3JlLnN1cHBseS5jb20wHhcNMjAxMjI1MDkxNzAwWhcNMzAxMjIzMDkxNzAwWjBa\nMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMNU2Fu\nIEZyYW5jaXNjbzEeMBwGA1UEAxMVcGVlcjAuY29yZS5zdXBwbHkuY29tMFkwEwYH\nKoZIzj0CAQYIKoZIzj0DAQcDQgAErf3R+7XpNQpmTsMO+iM4WS7IrOoafiPbAS7Q\nbuFFR3Qs4riIczgSmjh9rOA6I1q2q0CstLhfWDbqpf+8fXPUlKNNMEswDgYDVR0P\nAQH/BAQDAgeAMAwGA1UdEwEB/wQCMAAwKwYDVR0jBCQwIoAguznqsTisa64dNvOR\nvPwP0KGklWohNpbSe7VgIghx4L8wCgYIKoZIzj0EAwIDSAAwRQIhALIw1VMzezCg\n9LONbO4+V+weY42HQLbShkTP/gCFnGRYAiARyLLSDJIC2wwzSvOHNdm+aDRtbqGC\nNJenP9hmEbYsTw==\n-----END CERTIFICATE-----\n&quot; signature:&quot;0E\002!\000\251\370K6S\020\373\242\321\000\211\312\0001\333\365&gt;\314\324\231\020&gt;u;+\243\303dD\023\221\237\002 z \224\236R\355Z\251\202\363\035\304\365\212\277\235\375?\376\030\371\236\220\354iG6\244\334M\315\331&quot; &gt;</span><br></pre></td></tr></table></figure><p>åŸå› æ˜¯å› ä¸ºä¸‹å›¾ï¼Œåªæœ‰ä¸€ä¸ªç»„ç»‡çš„é“¾ç æ›´æ–°åˆ°äº†æœ€æ–°çš„ç‰ˆæœ¬ã€‚</p><p>![æˆªå±2020-12-28 18.03.06](/Users/apple/Desktop/æˆªå±2020-12-28 18.03.06.png)</p><p>**è§£å†³æ–¹æ¡ˆï¼š**åŸå› æ˜¯å› ä¸ºè®¾ç½®ç¯å¢ƒå˜é‡<code>CC_PACKAGE_ID</code>æ—¶åªè®¾ç½®äº†ä¸€ä¸ªç»„ç»‡çš„peerï¼Œå¯¼è‡´æ—§çš„ç¯å¢ƒå˜é‡è¿˜åœ¨ç”Ÿæ•ˆï¼Œé‡æ–°æ“ä½œä¸€éé—®é¢˜è§£å†³ã€‚</p><h3 id="è°ƒç”¨chaincodeæ—¶æŠ¥é”™VSCC-errorå¦‚ä¸‹ï¼š">è°ƒç”¨chaincodeæ—¶æŠ¥é”™VSCC errorå¦‚ä¸‹ï¼š</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2021-01-07 06:44:40.479 UTC [vscc] Validate -&gt; ERRO 62f VSCC error: stateBasedValidator.Validate failed, err validation of endorsement policy for chaincode secured_supply in tx 12:0 failed: implicit policy evaluation failed - 1 sub-policies were satisfied, but this policy requires 3 of the &#x27;Endorsement&#x27; sub-policies to be satisfied</span><br><span class="line">2021-01-07 06:44:40.479 UTC [committer.txvalidator] validateTx -&gt; ERRO 630 Dispatch for transaction txId = 101fe5e0aaaafbabcf31a5ce66fa48b92ab834456ba73cdb29730679bd637847 returned error: validation of endorsement policy for chaincode secured_supply in tx 12:0 failed: implicit policy evaluation failed - 1 sub-policies were satisfied, but this policy requires 3 of the &#x27;Endorsement&#x27; sub-policies to be satisfied</span><br><span class="line">2021-01-07 06:44:40.479 UTC [committer.txvalidator] Validate -&gt; INFO 631 [alljoinchannel] Validated block [12] in 2ms</span><br></pre></td></tr></table></figure><p>é”™è¯¯åŸå› ï¼š</p><p>èƒŒæ™¯æ˜¯æˆ‘çš„æµ‹è¯•ç¯å¢ƒæœ‰å››ä¸ªç»„ç»‡å®‰è£…äº†ç›¸åŒçš„é“¾ç ï¼Œé“¾ç çš„èƒŒä¹¦ç­–ç•¥æ˜¯é»˜è®¤çš„<code> /Channel/Application/Endorsement</code>æ‰€ä»¥è¦æ±‚å¤§å¤šæ•°èƒŒä¹¦ï¼Œè€Œæˆ‘åªè®©ä¸€ä¸ªç»„ç»‡ç­¾åï¼Œæ‰€ä»¥å¯¼è‡´é”™è¯¯ã€‚</p><h3 id="æŸ¥è¯¢chaincodeæ˜¯å¦å¯ä»¥è¢«æäº¤æ—¶æŠ¥é”™">æŸ¥è¯¢chaincodeæ˜¯å¦å¯ä»¥è¢«æäº¤æ—¶æŠ¥é”™</h3><p>å†æ‰€æœ‰çš„ç»„ç»‡éƒ½æ‰¹å‡†äº†é“¾ç ä¹‹åï¼ŒæŸ¥è¯¢æ‰¹å‡†ç»“æœè¿”å›çš„å…¨éƒ¨æ˜¯falseã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(base) w:supply-finance apple$ peer lifecycle chaincode checkcommitreadiness --channelID alljoinchannel --name secured_supply --version 2.0 --sequence 2 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json</span><br><span class="line">&#123;</span><br><span class="line">&quot;approvals&quot;: &#123;</span><br><span class="line">&quot;GylCoreOrg1MSP&quot;: false,</span><br><span class="line">&quot;GylFOrg1MSP&quot;: false,</span><br><span class="line">&quot;GylSOrg1MSP&quot;: false,</span><br><span class="line">&quot;GylSOrg2MSP&quot;: false</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é”™è¯¯åŸå› åŠè§£å†³æ–¹æ¡ˆï¼š</strong></p><p>å› ä¸ºæ‰¹å‡†çš„æ—¶å€™åˆ¶å®šäº†ç­¾åç­–ç•¥ï¼Œä½†æ˜¯æŸ¥è¯¢çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šï¼›åœ¨æŸ¥è¯¢æ—¶æŒ‡å®šèƒŒä¹¦ç­–ç•¥å³å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(base) w:supply-finance apple$ peer lifecycle chaincode checkcommitreadiness --channelID alljoinchannel --name secured_supply --version 2.0 --sequence 2 --signature-policy &quot;OR(&#x27;GylCoreOrg1MSP.peer&#x27;,&#x27;GylFOrg1MSP.peer&#x27;,&#x27;GylSOrg1MSP.peer&#x27;,&#x27;GylSOrg2MSP.peer&#x27;)&quot; --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json</span><br><span class="line">&#123;</span><br><span class="line">&quot;approvals&quot;: &#123;</span><br><span class="line">&quot;GylCoreOrg1MSP&quot;: true,</span><br><span class="line">&quot;GylFOrg1MSP&quot;: true,</span><br><span class="line">&quot;GylSOrg1MSP&quot;: true,</span><br><span class="line">&quot;GylSOrg2MSP&quot;: true</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="signature-set-did-not-satisfy-policy-ç­¾åé›†åˆä¸ç­–ç•¥ä¸ä¸€è‡´">signature set did not satisfy policy ç­¾åé›†åˆä¸ç­–ç•¥ä¸ä¸€è‡´</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2021-01-05 09:40:29.461 UTC [vscc] Validate -&gt; ERRO 3212 VSCC error: stateBasedValidator.Validate failed, err validation of key asset001 (coll&#x27;&#x27;:ns&#x27;secured_supply&#x27;) in tx 59:0 failed: signature set did not satisfy policy</span><br><span class="line">2021-01-05 09:40:29.461 UTC [committer.txvalidator] validateTx -&gt; ERRO 3213 Dispatch for transaction txId = 7d13143d4a24fe370528b0e47e6e8a71d7a8b660798c424769a57b67a9cb69ae returned error: validation of key asset001 (coll&#x27;&#x27;:ns&#x27;secured_supply&#x27;) in tx 59:0 failed: signature set did not satisfy policy</span><br></pre></td></tr></table></figure><p>åˆé‡åˆ°äº†ç­¾åå’ŒèƒŒä¹¦ç­–ç•¥ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><p><a href="https://cloud.ibm.com/docs/blockchain-sw?topic=blockchain-sw-ibp-v2-troubleshooting">Troubleshooting</a>ç½‘ç«™</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Why are my transactions returning an endorsement policy error: signature set did not satisfy policy?</span><br><span class="line">é—®é¢˜æƒ…å†µ</span><br><span class="line">When I invoke a smart contract to submit a transaction, the transaction returns the following endorsement policy failure:</span><br><span class="line"></span><br><span class="line">returned error: VSCC error: endorsement policy failure, err: signature set did not satisfy policy</span><br><span class="line">é—®é¢˜åŸå› </span><br><span class="line">If you have recently joined a channel and installed the smart contract, this error occurs if you have not added your organization to the endorsement policy. Because your organization is not on the list of organizations who can endorse a transaction from the smart contract, the endorsement from your peers is rejected by the channel. If you encounter this problem, you can change the endorsement policy by upgrading the smart contract. For more information, see Specifying an endorsement policy and Upgrading a smart contract.</span><br></pre></td></tr></table></figure><h4 id="é”™è¯¯åŸå› ä¸€çº§è§£å†³æ–¹æ¡ˆ">é”™è¯¯åŸå› ä¸€çº§è§£å†³æ–¹æ¡ˆ</h4><p>è¿™ä¸ªé”™è¯¯çš„èƒŒæ™¯æ˜¯channelã€chaincodeå’Œkeyçš„èƒŒä¹¦ç­–ç•¥éƒ½ä¸ä¸€æ ·ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><ul><li>channelï¼šé»˜è®¤çš„ï¼Œéœ€è¦å¤§å¤šæ•°ç­¾å</li><li>chaincodeï¼šæŒ‡å®šäº†OR(â€˜GylCoreOrg1MSP.memberâ€™,â€˜GylFOrg1MSP.memberâ€™,â€˜GylSOrg1MSP.memberâ€™,â€˜GylSOrg2MSP.memberâ€™)</li><li>keyï¼šè®¾ç½®äº†SetStateValidationParameterï¼Œåªéœ€è¦æ‹¥æœ‰è€…çš„ç­¾å</li></ul><p>å…·ä½“çš„è§£å†³æ–¹æ¡ˆéœ€è¦ç¡®è®¤é“¾ç çš„ç¼–å†™æ˜¯å¦æœ‰é—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabricæµ‹è¯•ç½‘ç»œä½¿ç”¨</title>
      <link href="2021/04/01/blockchain/fabric/Fabric%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%E4%BD%BF%E7%94%A8/"/>
      <url>2021/04/01/blockchain/fabric/Fabric%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="Fabricæµ‹è¯•ç½‘ç»œä½¿ç”¨">Fabricæµ‹è¯•ç½‘ç»œä½¿ç”¨</h2><h3 id="æµ‹è¯•ç½‘ç»œè®¾ç½®ç¯å¢ƒå˜é‡è®°å½•">æµ‹è¯•ç½‘ç»œè®¾ç½®ç¯å¢ƒå˜é‡è®°å½•</h3><p>Org1ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$&#123;PWD&#125;/../bin:$&#123;PWD&#125;:$PATH</span><br><span class="line">export FABRIC_CFG_PATH=$PWD/../config/</span><br><span class="line">export CORE_PEER_TLS_ENABLED=true</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:7051</span><br></pre></td></tr></table></figure><p>Org2ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$&#123;PWD&#125;/../bin:$&#123;PWD&#125;:$PATH</span><br><span class="line">export FABRIC_CFG_PATH=$PWD/../config/</span><br><span class="line">export CORE_PEER_TLS_ENABLED=true</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:9051</span><br></pre></td></tr></table></figure><h3 id="2-2-1ä¸‹è½½æ ·ä¾‹æºç ">2.2.1ä¸‹è½½æ ·ä¾‹æºç </h3><p>è¿è¡Œå‘½ä»¤ä¸‹è½½æœ€æ–°ç‰ˆçš„<strong>Fabric</strong>å’Œ<strong>Fabric CA</strong>ä»¥åŠ <a href="https://github.com/hyperledger/fabric-samples">hyperledger/fabric-samples</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://bit.ly/2ysbOFE | bash -s</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„å‘½ä»¤å¹²äº†è¿™äº›äº‹æƒ…ï¼š</p><ul><li>ä¸‹è½½ <a href="https://github.com/hyperledger/fabric-samples">hyperledger/fabric-samples</a></li><li>ç­¾å‡ºé€‚å½“çš„ç‰ˆæœ¬æ ‡ç­¾</li><li>å°†Hyperledger Fabricå¹³å°ç‰¹å®šçš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶å®‰è£…åˆ°Fabric-samplesçš„/ binå’Œ/ configç›®å½•ä¸­æŒ‡å®šçš„ç‰ˆæœ¬</li><li>ä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„Hyperledger Fabric dockeré•œåƒï¼ŒåŒ…æ‹¬ï¼š<ul><li>hyperledger/fabric-peer</li><li>hyperledger/fabric-orderer</li><li>hyperledger/fabric-ccenv</li><li>hyperledger/fabric-tools</li><li>hyperledger/fabric-baseos</li><li>hyperledger/fabric-ca</li></ul></li></ul><h3 id="2-2-2ä½¿ç”¨Fabricæµ‹è¯•ç½‘ç»œ">2.2.2ä½¿ç”¨Fabricæµ‹è¯•ç½‘ç»œ</h3><h4 id="å¯åŠ¨Fabricæµ‹è¯•ç½‘ç»œ">å¯åŠ¨Fabricæµ‹è¯•ç½‘ç»œ</h4><p>1.è¿›å…¥fabric-samples/test-networkï¼Œå¯ä»¥çœ‹åˆ°network.shæ–‡ä»¶,å¯ä»¥è¿è¡Œ<code>./network.sh -h</code>æ¥æ˜¾ç¤ºå¸®åŠ©</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd fabric-samples/test-network</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(base) apple@WHOAMIdeMacBook-Pro:~/code/open-source/blockchain/hyperledger/fabric-samples/test-network$     ll</span><br><span class="line">total 72</span><br><span class="line">-rw-r--r--   1 apple  staff    777 Dec 14 18:36 README.md</span><br><span class="line">drwxr-xr-x  12 apple  staff    384 Dec 14 18:36 addOrg3</span><br><span class="line">drwxr-xr-x   3 apple  staff     96 Dec 14 18:36 configtx</span><br><span class="line">drwxr-xr-x   5 apple  staff    160 Dec 14 18:36 docker</span><br><span class="line">-rwxr-xr-x   1 apple  staff  18645 Dec 14 18:36 network.sh</span><br><span class="line">drwxr-xr-x   7 apple  staff    224 Dec 14 18:36 organizations</span><br><span class="line">-rwxr-xr-x   1 apple  staff   8202 Dec 14 18:36 scriptUtils.sh</span><br><span class="line">drwxr-xr-x   6 apple  staff    192 Dec 14 18:36 scripts</span><br><span class="line">drwxr-xr-x   3 apple  staff     96 Dec 14 18:36 system-genesis-block</span><br></pre></td></tr></table></figure><p>2.åœæ­¢åŸæ¥æ­£åœ¨è¿è¡Œçš„dockerå®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./network.sh down</span><br></pre></td></tr></table></figure><p>3.å¯åŠ¨ç½‘ç»œ</p><p>**æ³¨æ„äº‹é¡¹ï¼š**å¿…é¡»åœ¨<code>$USER/fabric-samples/test-network</code>ç›®å½•ä¸‹æ‰§è¡Œæ­¤è„šæœ¬ï¼Œå¦åˆ™ä¼šæŠ¥é”™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./network.sh up</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè„šæœ¬å¯åŠ¨ä¸¤ä¸ªpeerèŠ‚ç‚¹ï¼Œä¸€ä¸ªorderingèŠ‚ç‚¹ã€‚è¿™ä¸ªè„šæœ¬ä¸ä¼šåˆ›å»ºchannelï¼Œæˆ‘çš„è„šæœ¬è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Creating network &quot;net_test&quot; with the default driver</span><br><span class="line">Creating volume &quot;net_orderer.example.com&quot; with default driver</span><br><span class="line">Creating volume &quot;net_peer0.org1.example.com&quot; with default driver</span><br><span class="line">Creating volume &quot;net_peer0.org2.example.com&quot; with default driver</span><br><span class="line">Creating orderer.example.com    ... done</span><br><span class="line">Creating peer0.org1.example.com ... done</span><br><span class="line">Creating peer0.org2.example.com ... done</span><br><span class="line">CONTAINER ID   IMAGE                               COMMAND                  CREATED        STATUS                    PORTS                              NAMES</span><br><span class="line">31c36a007eb0   hyperledger/fabric-peer:latest      &quot;peer node start&quot;        1 second ago   Up Less than a second     7051/tcp, 0.0.0.0:9051-&gt;9051/tcp   peer0.org2.example.com</span><br><span class="line">42f314195c64   hyperledger/fabric-orderer:latest   &quot;orderer&quot;                1 second ago   Up Less than a second     0.0.0.0:7050-&gt;7050/tcp             orderer.example.com</span><br><span class="line">de62f2f44a03   hyperledger/fabric-peer:latest      &quot;peer node start&quot;        1 second ago   Up Less than a second     0.0.0.0:7051-&gt;7051/tcp             peer0.org1.example.com</span><br><span class="line">e9af4c11538c   cordite/network-map:latest          &quot;/usr/bin/java -cp /â€¦&quot;   5 days ago     Exited (143) 3 days ago                                      network-map</span><br><span class="line">5128423bb8d7   redis:5.0                           &quot;docker-entrypoint.sâ€¦&quot;   5 months ago   Exited (0) 7 weeks ago                                       redis</span><br><span class="line">6796aadc5173   mysql                               &quot;docker-entrypoint.sâ€¦&quot;   7 months ago   Exited (0) 7 weeks ago                                       mysql</span><br><span class="line">66c3ac55f920   neo4j                               &quot;/sbin/tini -g -- /dâ€¦&quot;   7 months ago   Exited (0) 7 months ago</span><br></pre></td></tr></table></figure><p>dockeré¢æ¿æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/guozhe001/images/raw/master/image-20201214185835819.png" alt="image-20201214185835819"></p><p><a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/peers/peers.html">Peers</a>æ˜¯Fabric networkçš„ç»„æˆéƒ¨åˆ†ï¼ŒPeerså­˜å‚¨åŒºå—é“¾è´¦æœ¬å¹¶åœ¨æäº¤ä¹‹å‰éªŒè¯äº¤æ˜“ã€‚Peersè¿è¡ŒåŒ…å«ä¸šåŠ¡é€»è¾‘çš„æ™ºèƒ½åˆçº¦ï¼Œæ™ºèƒ½åˆçº¦ç”¨äºç®¡ç†åŒºå—é“¾ä¸Šçš„è´¦æœ¬ã€‚</p><p>åœ¨ç½‘ç»œä¸Šçš„æ¯ä¸ªPeeréƒ½å±äºä¸€ä¸ªå›¢ä½“ï¼Œä¸Šå›¾æ˜¾ç¤ºçš„æµ‹è¯•ç½‘ç»œä¸­çš„ä¸¤ä¸ªpeeråˆ†åˆ«å±äºç»„ç»‡<code>peer0.org1.example.com</code>å’Œç»„ç»‡<code>peer0.org2.example.com</code>ã€‚</p><p>æ¯ä¸ªFabric networkåŒæ ·åŒ…å«<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/orderer/ordering_service.html">ordering service</a>ï¼ŒPeersåœ¨éªŒè¯äº¤æ˜“å’Œæäº¤äº¤æ˜“åˆ°åŒºå—é“¾çš„æ—¶å€™ï¼Œä»–ä»¬ä¸è‡ªå·±å†³å®šäº¤æ˜“çš„é¡ºåºå’ŒåŒºå—ä¸­åŒ…å«å“ªäº›äº¤æ˜“ã€‚åœ¨åˆ†å¸ƒå¼ç½‘ç»œä¸­ï¼Œpeerså¯èƒ½åˆ†å¸ƒçš„ç‰¹åˆ«è¿œï¼Œæ‰€ä»¥è®©peerså¯¹äº¤æ˜“é¡ºåºè¾¾æˆå…±è¯†çš„æˆæœ¬æ˜¯å¾ˆé«˜çš„ã€‚</p><p>ordering serviceçš„å­˜åœ¨æ˜¯ä¸ºäº†è®©peersä¸“æ³¨äºäº¤æ˜“éªŒè¯å’Œæäº¤åˆ°è´¦æœ¬ä¸­ã€‚åœ¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯æäº¤çš„äº¤æ˜“æ—¶ï¼Œordering serviceä¼šå¯¹å…¶è¿›è¡Œæ’åºï¼Œç„¶åæŠŠè¿™äº›äº¤æ˜“æ·»åŠ åˆ°åŒºå—ä¸­ã€‚ç„¶åå°†è¿™äº›åŒºå—åˆ†å‘ç»™peerèŠ‚ç‚¹ï¼ŒpeerèŠ‚ç‚¹å†æŠŠåŒºå—å†™å…¥åŒºå—é“¾ã€‚OrderingèŠ‚ç‚¹è¿˜è¿è¡Œç³»ç»Ÿé€šé“ï¼Œè¯¥é€šé“å®šä¹‰äº†Fabric networkçš„èƒ½åŠ›ï¼Œåƒå¦‚ä½•åˆ¶ä½œåŒºå—ä»¥åŠèŠ‚ç‚¹å¯ä»¥ä½¿ç”¨å“ªäº›ç‰ˆæœ¬çš„Fabricã€‚ç³»ç»Ÿé€šé“è¿˜å®šä¹‰äº†å“ªäº›ç»„ç»‡æ˜¯å±äºè¯¥è”ç›Ÿçš„ã€‚</p><p>ä¸Šé¢çš„æµ‹è¯•ç½‘ç»œåªè¿è¡Œäº†ä¸€ä¸ªOrderingèŠ‚ç‚¹ï¼Œåœ¨å®é™…çš„ç½‘ç»œä¸­å¯èƒ½å­˜åœ¨å¤šä¸ªOrderingèŠ‚ç‚¹ï¼Œç”±ä¸€ä¸ªæˆ–å¤šä¸ªç»„ç»‡è¿›è¡Œæ“ä½œã€‚ä¸åŒçš„OrderingèŠ‚ç‚¹ä½¿ç”¨Raftå…±è¯†ç®—æ³•æ¥å°±ç½‘ç»œä¸Šçš„äº¤æ˜“é¡ºåºè¾¾æˆä¸€è‡´ã€‚</p><h4 id="åˆ›å»ºchannel">åˆ›å»ºchannel</h4><p>é€šé“æ˜¯ç‰¹å®šç½‘ç»œæˆå‘˜ä¹‹é—´çš„ä¸“ç”¨é€šä¿¡å±‚ã€‚é€šé“åªèƒ½ç”±è¢«é‚€è¯·åŠ å…¥é€šé“çš„çš„ç»„ç»‡ä½¿ç”¨ï¼Œå¹¶ä¸”å¯¹ç½‘ç»œä¸Šçš„å…¶ä»–æˆå‘˜ä¸å¯è§ã€‚æ¯ä¸ªé€šé“éƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„åŒºå—é“¾è´¦å•ï¼Œè¢«é‚€è¯·çš„ç»„ç»‡åŠ å…¥é€šé“ä¸Šçš„å…¶ä»–peerä»¥å­˜å‚¨channelè´¦æœ¬å’ŒéªŒè¯é€šé“ä¸Šçš„äº¤æ˜“ã€‚</p><p>åœ¨org2å’Œorg2ä¹‹é—´åˆ›å»ºé€šé“ï¼Œé»˜è®¤çš„channelåç§°ä¸ºmychannelã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./network.sh createChannel</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿è¡ŒæˆåŠŸï¼Œåˆ™ä¼šçœ‹åˆ°å¦‚ä¸‹æ—¥å¿—</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Channel successfully joined</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æŒ‡å®šchannelçš„åç§°ï¼Œå¹¶ä¸”ä½ å¯ä»¥åˆ›å»ºå¤šä¸ªchannelã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./network.sh createChannel -c channel1</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ æƒ³ä¸€æ­¥å¯åŠ¨æµ‹è¯•ç½‘ç»œå¹¶åˆ›å»ºchannelï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./network.sh up createChannel</span><br></pre></td></tr></table></figure><h4 id="åœ¨channelä¸Šå¯åŠ¨chaincode">åœ¨channelä¸Šå¯åŠ¨chaincode</h4><p>å¯åŠ¨æˆåŠŸä¹‹åï¼Œå°±å¯ä»¥å¼€å§‹ä½¿ç”¨æ™ºèƒ½åˆçº¦æ¥æ“ä½œchannelè´¦æœ¬äº†ã€‚æ™ºèƒ½åˆçº¦åŒ…å«äº†ç®¡ç†åŒºå—é“¾è´¦æœ¬ä¸Šèµ„äº§çš„ä¸šåŠ¡é€»è¾‘ã€‚è¿è¡Œåœ¨ç½‘ç»œä¸Šçš„ç¨‹åºå¯ä»¥è°ƒç”¨æ™ºèƒ½åˆçº¦åœ¨è´¦æœ¬ä¸Šåˆ›å»ºã€ä¿®æ”¹ã€äº¤æ˜“èµ„äº§ï¼Œè¿™äº›ç¨‹åºä¹ŸæŸ¥è¯¢æ™ºèƒ½åˆçº¦ä»¥è¯»å–è´¦æœ¬ä¸Šçš„æ•°æ®ã€‚</p><p>ä¸ºäº†ç¡®ä¿äº¤æ˜“çš„æœ‰æ•ˆæ€§ï¼Œä½¿ç”¨æ™ºèƒ½åˆçº¦åˆ›å»ºçš„äº¤æ˜“é€šå¸¸éœ€è¦é€šé“ä¸Šçš„å¤šä¸ªç»„ç»‡ç­¾åæ‰èƒ½è¢«æäº¤åˆ°channelè´¦æœ¬ã€‚äº¤æ˜“ä¹Ÿéœ€è¦å¤šæ¬¡èƒŒä¹¦ï¼Œæ¥é˜²æ­¢æ¸ é“ä¸Šçš„æŸä¸ªç»„ç»‡ç¯¡æ”¹è´¦æœ¬æˆ–ä½¿ç”¨æœªç»è¿‡åŒæ„çš„é€»è¾‘ã€‚è¦ç­¾ç½²äº¤æ˜“ï¼Œæ¯ä¸ªç»„ç»‡éƒ½éœ€è¦åœ¨å…¶peerä¸Šè°ƒç”¨å¹¶æ‰§è¡Œæ™ºèƒ½åˆçº¦ï¼Œç„¶åå†ç­¾ç½²äº¤æ˜“çš„outputã€‚å¦‚æœoutputä¸€è‡´å¹¶ä¸”æ”¶é›†åˆ°äº†è¶³å¤Ÿçš„ç­¾åï¼Œäº¤æ˜“å°±å¯ä»¥è¢«æäº¤åˆ°è´¦æœ¬ã€‚æŒ‡å®šéœ€è¦å“ªäº›ç»„ç»‡æ‰§è¡Œæ™ºèƒ½åˆçº¦çš„ç­–ç•¥å«åšèƒŒä¹¦ç­–ç•¥ï¼Œè¯¥ç­–ç•¥æ˜¯ä¸ºæ¯ä¸ªchaincodeè®¾ç½®çš„ï¼Œä½œä¸ºchaincodeå®šä¹‰çš„ä¸€éƒ¨åˆ†ã€‚</p><p>åœ¨Fabricä¸­ï¼Œæ™ºèƒ½åˆçº¦ä»¥ç§°ä¸ºchaincodeçš„è½¯ä»¶åŒ…éƒ¨ç½²åœ¨ç½‘ç»œä¸Šã€‚chaincodeå®‰è£…åœ¨ç»„ç»‡çš„peersä¸Šï¼Œç„¶åéƒ¨ç½²åˆ°channelï¼Œç„¶åå°±å¯ä»¥åœ¨è¯¥æ¸ é“ä¸­ç”¨äºè®¤å¯äº¤æ˜“å¹¶ä¸åŒºå—é“¾è´¦æœ¬è¿›è¡Œäº¤äº’ã€‚åœ¨è®²chaincodeéƒ¨ç½²åˆ°channelä¸Šä¹‹å‰ï¼Œchannelä¸Šçš„ç»„ç»‡éœ€è¦å¯¹chaincodeçš„å†…å®¹è¾¾æˆå…±è¯†ã€‚å½“æ‰€éœ€æ•°é‡çš„ç»„ç»‡è¾¾æˆå…±è¯†ä¹‹åï¼Œchaincodeå°±å¯ä»¥è¢«æäº¤åˆ°channelä¸Šï¼Œç„¶åchaincodeå°±å‡†å¤‡å¥½å¯ä»¥ä½¿ç”¨äº†ã€‚</p><p>æ­å»ºå®Œæˆæµ‹è¯•ç¯å¢ƒä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥å¯åŠ¨chaincodeï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./network.sh deployCC</span><br></pre></td></tr></table></figure><p>æˆ‘æœ¬åœ°çš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Chaincode definition committed on channel &#x27;mychannel&#x27;</span><br><span class="line">Using organization 1</span><br><span class="line">Querying chaincode definition on peer0.org1 on channel &#x27;mychannel&#x27;...</span><br><span class="line">Attempting to Query committed status on peer0.org1, Retry after 3 seconds.</span><br><span class="line">+ peer lifecycle chaincode querycommitted --channelID mychannel --name basic</span><br><span class="line">+ res=0</span><br><span class="line">Committed chaincode definition for chaincode &#x27;basic&#x27; on channel &#x27;mychannel&#x27;:</span><br><span class="line">Version: 1.0, Sequence: 1, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [Org1MSP: true, Org2MSP: true]</span><br><span class="line">Query chaincode definition successful on peer0.org1 on channel &#x27;mychannel&#x27;</span><br><span class="line">Using organization 2</span><br><span class="line">Querying chaincode definition on peer0.org2 on channel &#x27;mychannel&#x27;...</span><br><span class="line">Attempting to Query committed status on peer0.org2, Retry after 3 seconds.</span><br><span class="line">+ peer lifecycle chaincode querycommitted --channelID mychannel --name basic</span><br><span class="line">+ res=0</span><br><span class="line">Committed chaincode definition for chaincode &#x27;basic&#x27; on channel &#x27;mychannel&#x27;:</span><br><span class="line">Version: 1.0, Sequence: 1, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [Org1MSP: true, Org2MSP: true]</span><br><span class="line">Query chaincode definition successful on peer0.org2 on channel &#x27;mychannel&#x27;</span><br><span class="line">Chaincode initialization is not required</span><br></pre></td></tr></table></figure><h4 id="ä¸ç½‘ç»œäº’åŠ¨">ä¸ç½‘ç»œäº’åŠ¨</h4><p>åœ¨å¯ç”¨æµ‹è¯•ç½‘ç»œä¹‹åï¼Œä½ å¯ä»¥ä½¿ç”¨peerCLIä¸æµ‹è¯•ç½‘ç»œè¿›è¡Œäº’åŠ¨ã€‚peerCLIå…è®¸ä½ è°ƒç”¨å·²ç»éƒ¨ç½²çš„æ™ºèƒ½åˆçº¦ã€æ›´æ–°channelsï¼›ä¹Ÿå¯ä»¥é€šè¿‡CLIæ›´æ–°æˆ–è€…éƒ¨ç½²æ–°çš„æ™ºèƒ½åˆçº¦ã€‚</p><p>è¯·ç¡®ä¿ä½ çš„æ“ä½œåœ¨test-networkç›®å½•ä¸‹è¿›è¡Œã€‚</p><p>1ã€æŠŠ<code>fabric-samples</code>çš„<code>bin</code>ç›®å½•ä¸‹çš„äºŒè¿›åˆ¶å‘½ä»¤å®‰è£…åˆ°ä½ çš„å®¢æˆ·ç«¯ç¯å¢ƒï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$&#123;PWD&#125;/../bin:$PATH</span><br></pre></td></tr></table></figure><p>2ã€è¿˜éœ€è¦å°†FABRIC_CFG_PATHè®¾ç½®ä¸ºæŒ‡å‘fabric-sampleså­˜å‚¨åº“ä¸­çš„core.yamlæ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export FABRIC_CFG_PATH=$PWD/../config/</span><br></pre></td></tr></table></figure><p>3ã€ç°åœ¨è®¾ç½®ç¯å¢ƒå˜é‡å…è®¸ä½ ä½¿ç”¨Org1çš„èº«ä»½æ“ä½œpeerCLIã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export CORE_PEER_TLS_ENABLED=true</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:7051</span><br></pre></td></tr></table></figure><p>4ã€ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ç”¨èµ„äº§åˆå§‹åŒ–è´¦æœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n basic --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;InitLedger&quot;,&quot;Args&quot;:[]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆåŠŸä½ ä¼šçœ‹åˆ°åƒä¸‹é¢çš„ç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2020-12-16 15:35:41.511 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200</span><br></pre></td></tr></table></figure><p>5ã€ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥è¯¢è´¦æœ¬ä¸Šçš„èµ„äº§</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode query -C mychannel -n basic -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆåŠŸä½ ä¼šçœ‹åˆ°ä¸‹é¢çš„ç»“æœï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;<span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset1&quot;</span>, <span class="attr">&quot;color&quot;</span>: <span class="string">&quot;blue&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">5</span>, <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;Tomoko&quot;</span>, <span class="attr">&quot;appraisedValue&quot;</span>: <span class="number">300</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset2&quot;</span>, <span class="attr">&quot;color&quot;</span>: <span class="string">&quot;red&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">5</span>, <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;Brad&quot;</span>, <span class="attr">&quot;appraisedValue&quot;</span>: <span class="number">400</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset3&quot;</span>, <span class="attr">&quot;color&quot;</span>: <span class="string">&quot;green&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">10</span>, <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;Jin Soo&quot;</span>, <span class="attr">&quot;appraisedValue&quot;</span>: <span class="number">500</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset4&quot;</span>, <span class="attr">&quot;color&quot;</span>: <span class="string">&quot;yellow&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">10</span>, <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;Max&quot;</span>, <span class="attr">&quot;appraisedValue&quot;</span>: <span class="number">600</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset5&quot;</span>, <span class="attr">&quot;color&quot;</span>: <span class="string">&quot;black&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">15</span>, <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;Adriana&quot;</span>, <span class="attr">&quot;appraisedValue&quot;</span>: <span class="number">700</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">&quot;ID&quot;</span>: <span class="string">&quot;asset6&quot;</span>, <span class="attr">&quot;color&quot;</span>: <span class="string">&quot;white&quot;</span>, <span class="attr">&quot;size&quot;</span>: <span class="number">15</span>, <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;Michel&quot;</span>, <span class="attr">&quot;appraisedValue&quot;</span>: <span class="number">800</span>&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>6ã€ç½‘ç»œä¸Šçš„æˆå‘˜æƒ³è¦äº¤æ˜“èµ„äº§æˆ–è€…æ›´æ–°èµ„äº§æ—¶å°±ä¼šè°ƒç”¨chaincodeï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥è°ƒç”¨èµ„äº§è½¬ç§»chaincodeæ¥æ›´æ”¹èµ„äº§çš„ownerã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n basic --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAsset&quot;,&quot;Args&quot;:[&quot;asset6&quot;,&quot;Christopher&quot;]&#125;&#x27;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆåŠŸç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2020-12-16 15:43:18.062 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200</span><br></pre></td></tr></table></figure><p>é‡æ–°æŸ¥è¯¢å¯ä»¥å‘ç°asset6çš„ownerå·²ç»æ›´æ”¹ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">&#123;<span class="attr">&quot;ID&quot;</span>:<span class="string">&quot;asset1&quot;</span>,<span class="attr">&quot;color&quot;</span>:<span class="string">&quot;blue&quot;</span>,<span class="attr">&quot;size&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;owner&quot;</span>:<span class="string">&quot;Tomoko&quot;</span>,<span class="attr">&quot;appraisedValue&quot;</span>:<span class="number">300</span>&#125;,</span><br><span class="line">&#123;<span class="attr">&quot;ID&quot;</span>:<span class="string">&quot;asset2&quot;</span>,<span class="attr">&quot;color&quot;</span>:<span class="string">&quot;red&quot;</span>,<span class="attr">&quot;size&quot;</span>:<span class="number">5</span>,<span class="attr">&quot;owner&quot;</span>:<span class="string">&quot;Brad&quot;</span>,<span class="attr">&quot;appraisedValue&quot;</span>:<span class="number">400</span>&#125;,&#123;<span class="attr">&quot;ID&quot;</span>:<span class="string">&quot;asset3&quot;</span>,<span class="attr">&quot;color&quot;</span>:<span class="string">&quot;green&quot;</span>,<span class="attr">&quot;size&quot;</span>:<span class="number">10</span>,<span class="attr">&quot;owner&quot;</span>:<span class="string">&quot;Jin Soo&quot;</span>,<span class="attr">&quot;appraisedValue&quot;</span>:<span class="number">500</span>&#125;,</span><br><span class="line">&#123;<span class="attr">&quot;ID&quot;</span>:<span class="string">&quot;asset4&quot;</span>,<span class="attr">&quot;color&quot;</span>:<span class="string">&quot;yellow&quot;</span>,<span class="attr">&quot;size&quot;</span>:<span class="number">10</span>,<span class="attr">&quot;owner&quot;</span>:<span class="string">&quot;Max&quot;</span>,<span class="attr">&quot;appraisedValue&quot;</span>:<span class="number">600</span>&#125;,</span><br><span class="line">&#123;<span class="attr">&quot;ID&quot;</span>:<span class="string">&quot;asset5&quot;</span>,<span class="attr">&quot;color&quot;</span>:<span class="string">&quot;black&quot;</span>,<span class="attr">&quot;size&quot;</span>:<span class="number">15</span>,<span class="attr">&quot;owner&quot;</span>:<span class="string">&quot;Adriana&quot;</span>,<span class="attr">&quot;appraisedValue&quot;</span>:<span class="number">700</span>&#125;,</span><br><span class="line">&#123;<span class="attr">&quot;ID&quot;</span>:<span class="string">&quot;asset6&quot;</span>,<span class="attr">&quot;color&quot;</span>:<span class="string">&quot;white&quot;</span>,<span class="attr">&quot;size&quot;</span>:<span class="number">15</span>,<span class="attr">&quot;owner&quot;</span>:<span class="string">&quot;Christopher&quot;</span>,<span class="attr">&quot;appraisedValue&quot;</span>:<span class="number">800</span>&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>7ã€æˆ‘ä»¬åœ¨è°ƒç”¨chaincodeä¹‹åï¼Œæˆ‘ä»¬æ¥æŸ¥ä¸€ä¸‹è¿™ä¸ªè°ƒç”¨æ˜¯å¦‚ä½•æ”¹å˜èµ„äº§çš„ã€‚æˆ‘ä»¬ä½¿ç”¨Org2æ¥æ“ä½œï¼Œé…ç½®ç¯å¢ƒå˜é‡å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export CORE_PEER_TLS_ENABLED=true</span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp</span><br><span class="line">export CORE_PEER_ADDRESS=localhost:9051</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>peer chaincode query -C mychannel -n basic -c '&#123;&quot;Args&quot;:[&quot;ReadAsset&quot;,&quot;asset6&quot;]&#125;'</code>å‘½ä»¤ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;ID&quot;</span>:<span class="string">&quot;asset6&quot;</span>,<span class="attr">&quot;color&quot;</span>:<span class="string">&quot;white&quot;</span>,<span class="attr">&quot;size&quot;</span>:<span class="number">15</span>,<span class="attr">&quot;owner&quot;</span>:<span class="string">&quot;Christopher&quot;</span>,<span class="attr">&quot;appraisedValue&quot;</span>:<span class="number">800</span>&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸­æ–­ç½‘ç»œ">ä¸­æ–­ç½‘ç»œ</h4><p>é€šè¿‡æ‰§è¡Œ<code>./network.sh down</code>æ¥ä¸­æ–­ç½‘ç»œï¼Œè¯¥å‘½ä»¤ä¼šåœæ­¢å¹¶åˆ é™¤peeræ²³chaincodeçš„å®¹å™¨ï¼›åˆ é™¤orgçš„å¯†é’¥ç­‰æ•°æ®å¹¶ä»Dockerä¸­removeæ‰chaincodeçš„é•œåƒã€‚è¯¥å‘½ä»¤è¿˜ä¼šåˆ é™¤ç½‘è·¯ä¸Šçš„channelï¼Œå¦‚æœæœ‰ä»»ä½•é—®é¢˜å¯ä»¥ç»§ç»­è¿è¡Œ<code>./network.sh up</code>ã€‚</p><h2 id="é—®é¢˜å¤„ç†">é—®é¢˜å¤„ç†</h2><p>åˆ›å»ºchannelå¤±è´¥ï¼Œæ—¥å¿—å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Channel &#x27;mychannel&#x27; created</span><br><span class="line">Join Org1 peers to the channel...</span><br><span class="line">Using organization 1</span><br><span class="line">+ peer channel join -b ./channel-artifacts/mychannel.block</span><br><span class="line">+ res=1</span><br><span class="line">+ peer channel join -b ./channel-artifacts/mychannel.block</span><br><span class="line">+ res=1</span><br><span class="line">+ peer channel join -b ./channel-artifacts/mychannel.block</span><br><span class="line">+ res=1</span><br><span class="line">+ peer channel join -b ./channel-artifacts/mychannel.block</span><br><span class="line">+ res=1</span><br><span class="line">2020-12-21 11:22:02.781 CST [comm.tls] ClientHandshake -&gt; ERRO 001 Client TLS handshake failed after 1.769196ms with error: EOF remoteaddress=[::1]:7051</span><br><span class="line">2020-12-21 11:22:03.785 CST [comm.tls] ClientHandshake -&gt; ERRO 002 Client TLS handshake failed after 2.054333ms with error: EOF remoteaddress=[::1]:7051</span><br><span class="line">2020-12-21 11:22:05.113 CST [comm.tls] ClientHandshake -&gt; ERRO 003 Client TLS handshake failed after 2.849348ms with error: EOF remoteaddress=[::1]:7051</span><br><span class="line">Error: error getting endorser client for channel: endorser client failed to connect to localhost:7051: failed to create new connection: context deadline exceeded</span><br><span class="line">After 5 attempts, peer0.org1 has failed to join channel &#x27;mychannel&#x27;</span><br><span class="line">Create channel failed</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>åˆ é™¤æ‰€æœ‰çš„æµ‹è¯•ç½‘ç»œç›¸å…³çš„å®¹å™¨</li><li>è¿è¡Œ<code>./network.sh down</code></li><li>åˆ é™¤dockeræœ¬åœ°æœªä½¿ç”¨çš„volume</li><li>é‡è¯•</li></ul>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fabricå…³é”®é—®é¢˜20é—®</title>
      <link href="2021/04/01/blockchain/fabric/Fabric%E5%85%B3%E9%94%AE%E9%97%AE%E9%A2%9820%E9%97%AE/"/>
      <url>2021/04/01/blockchain/fabric/Fabric%E5%85%B3%E9%94%AE%E9%97%AE%E9%A2%9820%E9%97%AE/</url>
      
        <content type="html"><![CDATA[<h2 id="1ã€æ˜¯å¦æ‰€æœ‰çš„èƒŒä¹¦èŠ‚ç‚¹éƒ½æœ‰ç›¸åŒçš„åŠŸèƒ½ï¼Ÿä¸€ç¬”äº¤æ˜“æ˜¯ä¸æ˜¯ä»»æ„çš„èƒŒä¹¦èŠ‚ç‚¹éƒ½å¯ä»¥éªŒè¯ï¼Œè¿˜æ˜¯åªèƒ½ç”±æ”¯æŒæ­¤äº¤æ˜“çš„èƒŒä¹¦èŠ‚ç‚¹éªŒè¯ï¼Ÿ">1ã€æ˜¯å¦æ‰€æœ‰çš„èƒŒä¹¦èŠ‚ç‚¹éƒ½æœ‰ç›¸åŒçš„åŠŸèƒ½ï¼Ÿä¸€ç¬”äº¤æ˜“æ˜¯ä¸æ˜¯ä»»æ„çš„èƒŒä¹¦èŠ‚ç‚¹éƒ½å¯ä»¥éªŒè¯ï¼Œè¿˜æ˜¯åªèƒ½ç”±æ”¯æŒæ­¤äº¤æ˜“çš„èƒŒä¹¦èŠ‚ç‚¹éªŒè¯ï¼Ÿ</h2><p>ç­”ï¼šåªæœ‰å®‰è£…äº†ç›¸åŒçš„chaincodeçš„peerèŠ‚ç‚¹æ‰å…·æœ‰èƒŒä¹¦çš„åŠŸèƒ½ã€‚æ‰€ä»¥ä¸€ä¸ªpeerèŠ‚ç‚¹æƒ³è¦æˆä¸ºèƒŒä¹¦èŠ‚ç‚¹ï¼Œå¿…é¡»å®‰è£…å¯¹åº”çš„chaincodeã€‚<br>ä¸€ç¬”äº¤æ˜“è‚¯å®šæ˜¯ç”±äºè°ƒç”¨äº†é“¾ç è€Œäº§ç”Ÿçš„ï¼Œæ‰€ä»¥è¿™ç¬”äº¤æ˜“å¿…é¡»ç”±å…¶ä»–çš„å®‰è£…äº†ç›¸åŒé“¾ç çš„èƒŒä¹¦èŠ‚ç‚¹è¿›è¡ŒéªŒè¯ã€‚</p><h2 id="2ã€èƒŒä¹¦èŠ‚ç‚¹åœ¨éªŒè¯çš„æ—¶å€™æ˜¯å¦çŸ¥é“äº†äº¤æ˜“çš„å…¨éƒ¨å†…å®¹ï¼Œå¦‚ä½•ä¿è¯æ•°æ®çš„éšç§çš„ï¼Ÿ">2ã€èƒŒä¹¦èŠ‚ç‚¹åœ¨éªŒè¯çš„æ—¶å€™æ˜¯å¦çŸ¥é“äº†äº¤æ˜“çš„å…¨éƒ¨å†…å®¹ï¼Œå¦‚ä½•ä¿è¯æ•°æ®çš„éšç§çš„ï¼Ÿ</h2><p>ç­”ï¼šèƒŒä¹¦èŠ‚ç‚¹åœ¨éªŒè¯çš„æ—¶å€™å¯èƒ½å¹¶ä¸çŸ¥é“äº¤æ˜“çš„å…¨éƒ¨å†…å®¹ï¼ŒFabricæœ‰ä¸€ä¸ªåä¸ºâ€œtransientâ€çš„å­˜å‚¨ï¼Œè¿™ä¸ªå­˜å‚¨åªåœ¨å½“å‰peerèŠ‚ç‚¹ï¼›å¦‚æœæœ‰äº¤æ˜“çš„è¯â€œtransientâ€å­˜å‚¨çš„æ•°æ®ä¼šé€šè¿‡Gossipåè®®éšç§˜çš„ä¼ è¾“ç»™å¦ä¸€ä¸ªpeerèŠ‚ç‚¹ã€‚ç„¶åè¿™ä¸¤ä¸ªpeerèŠ‚ç‚¹éƒ½å¯ä»¥æŸ¥è¯¢åˆ°â€œtransientâ€å­˜å‚¨çš„æ•°æ®ã€‚è€Œchannelä¸Šçš„å…¶ä»–æˆå‘˜æ˜¯æ— æ³•çœ‹åˆ°è¿™äº›æ•°æ®çš„ï¼Œå› æ­¤å¹¶ä¸æ˜¯æ‰€æœ‰çš„èƒŒä¹¦èŠ‚ç‚¹éƒ½å¯ä»¥ç›´åˆ°äº¤æ˜“çš„å…¨éƒ¨å†…å®¹ã€‚</p><h3 id="2-1-è¿™ä¸ªé—®é¢˜ä¼šå¼•å‡ºå¦ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼ŒèƒŒä¹¦èŠ‚ç‚¹åœ¨ç¼ºå°‘æ•°æ®çš„æƒ…å†µä¸‹å¦‚ä½•è¿›è¡ŒèƒŒä¹¦å‘¢ï¼Ÿè¿™ä¸å°±å¯¼è‡´èƒŒä¹¦å¤±è´¥äº†å—ï¼Ÿ">2.1 è¿™ä¸ªé—®é¢˜ä¼šå¼•å‡ºå¦ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼ŒèƒŒä¹¦èŠ‚ç‚¹åœ¨ç¼ºå°‘æ•°æ®çš„æƒ…å†µä¸‹å¦‚ä½•è¿›è¡ŒèƒŒä¹¦å‘¢ï¼Ÿè¿™ä¸å°±å¯¼è‡´èƒŒä¹¦å¤±è´¥äº†å—ï¼Ÿ</h3><p>ç­”ï¼šæ˜¯çš„ï¼Œæ‹¿ä¸åˆ°â€œtransientâ€å­˜å‚¨çš„æ•°æ®çš„èƒŒä¹¦èŠ‚ç‚¹ä¼šèƒŒä¹¦å¤±è´¥ã€‚ä½†æ˜¯ç”±äºæˆ‘ä»¬å¯ä»¥è®¾ç½®chaincodeå’Œkeyçš„åŸºäºçŠ¶æ€çš„èƒŒä¹¦ç­–ç•¥ï¼Œå› æ­¤å°±ç®—æœ‰éƒ¨åˆ†èƒŒä¹¦èŠ‚ç‚¹èƒŒä¹¦å¤±è´¥äº†ï¼Œåªè¦èƒ½çœ‹åˆ°æ•°æ®çš„èƒŒä¹¦èŠ‚ç‚¹åšäº†èƒŒä¹¦å¹¶ç¬¦åˆèƒŒä¹¦ç­–ç•¥å³å¯è¾¾æˆå…±è¯†ã€‚</p><p>è¿™ä¸ªé—®é¢˜å¯ä»¥æŸ¥çœ‹<a href="https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/">åœ¨Fabricä¸­äº¤æ˜“å—ä¿æŠ¤çš„èµ„äº§</a></p><h2 id="3ã€åŒºå—æ•°æ®çš„æ•°æ®ç»“æ„å¦‚æœæ˜¯æ•°ç»„çš„è¯ï¼Œå¦‚ä½•åšåˆ°é˜²ç¯¡æ”¹ï¼Ÿ">3ã€åŒºå—æ•°æ®çš„æ•°æ®ç»“æ„å¦‚æœæ˜¯æ•°ç»„çš„è¯ï¼Œå¦‚ä½•åšåˆ°é˜²ç¯¡æ”¹ï¼Ÿ</h2><p>ç­”ï¼šæš‚æ—¶æ— æ³•å›ç­”æ­¤é—®é¢˜ï¼Œå¾…å®Œæˆã€‚</p><h2 id="4ã€ä¸»èŠ‚ç‚¹æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿä¸»èŠ‚ç‚¹å¯ä»¥äº¤æ˜“å—ï¼Ÿä¸»èŠ‚ç‚¹å’Œæ™®é€šçš„peerèŠ‚ç‚¹æœ‰ä»€ä¹ˆä¸ä¸€æ ·ï¼Ÿ">4ã€ä¸»èŠ‚ç‚¹æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿä¸»èŠ‚ç‚¹å¯ä»¥äº¤æ˜“å—ï¼Ÿä¸»èŠ‚ç‚¹å’Œæ™®é€šçš„peerèŠ‚ç‚¹æœ‰ä»€ä¹ˆä¸ä¸€æ ·ï¼Ÿ</h2><p>ç­”ï¼šæ‰€è°“çš„ä¸»èŠ‚ç‚¹åº”è¯¥æ˜¯Orderï¼Œç›®å‰äº†è§£åˆ°çš„åªæ˜¯è´Ÿè´£äº¤æ˜“çš„æ’åºä»¥åŠä¿¡æ¯çš„è½¬å‘ã€‚æ›´å¤šå†…å®¹å¾…å­¦ä¹ ã€‚</p><h2 id="5ã€é“¾ç æ˜¯ä¸æ˜¯å°±æ˜¯æ™ºèƒ½åˆçº¦ï¼Ÿ">5ã€é“¾ç æ˜¯ä¸æ˜¯å°±æ˜¯æ™ºèƒ½åˆçº¦ï¼Ÿ</h2><p>ç­”ï¼šé“¾ç å°±æ˜¯æ™ºèƒ½åˆçº¦ï¼Œåªæœ‰è°ƒç”¨æ™ºèƒ½åˆçº¦æ‰å¯ä»¥æ›´æ”¹channelä¸Šçš„è´¦æœ¬ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>èƒŒä¹¦ç­–ç•¥ï¼ˆEndorsement policiesï¼‰</title>
      <link href="2021/04/01/blockchain/fabric/Endorsement%20policies%E8%83%8C%E4%B9%A6%E7%AD%96%E7%95%A5/"/>
      <url>2021/04/01/blockchain/fabric/Endorsement%20policies%E8%83%8C%E4%B9%A6%E7%AD%96%E7%95%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="èƒŒä¹¦ç­–ç•¥">èƒŒä¹¦ç­–ç•¥</h1><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://hyperledger-fabric.readthedocs.io/en/latest/endorsement-policies.html#endorsement-policy-syntax">Endorsement policies</a></p><p>ã€‚ã€‚ã€‚çœç•¥éƒ¨åˆ†</p><h2 id="Setting-chaincode-level-endorsement-policies-è®¾ç½®é“¾ç çº§åˆ«çš„èƒŒä¹¦ç­–ç•¥">Setting chaincode-level endorsement policies(è®¾ç½®é“¾ç çº§åˆ«çš„èƒŒä¹¦ç­–ç•¥)</h2><p>Chaincode-level endorsement policies are agreed to by channel members when they approve a chaincode definition for their organization. A sufficient number of channel members need to approve a chaincode definition to meet the <code>Channel/Application/LifecycleEndorsement</code> policy, which by default is set to a majority of channel members, before the definition can be committed to the channel. Once the definition has been committed, the chaincode is ready to use. Any invoke of the chaincode that writes data to the ledger will need to be validated by enough channel members to meet the endorsement policy.</p><p>é€šé“æˆå‘˜åœ¨ä¸ºå…¶ç»„ç»‡æ‰¹å‡†é“¾ç å®šä¹‰æ—¶ï¼Œä¼šåŒæ„é“¾ç çº§è®¤å¯ç­–ç•¥ã€‚éœ€è¦è¶³å¤Ÿæ•°é‡çš„é€šé“æˆå‘˜æ‰¹å‡†é“¾ç å®šä¹‰æ‰èƒ½æ»¡è¶³Channel / Application / LifecycleEndorsementç­–ç•¥ï¼Œè¯¥ç­–ç•¥é»˜è®¤æƒ…å†µä¸‹è®¾ç½®ä¸ºå¤§å¤šæ•°é€šé“æˆå‘˜ï¼Œç„¶åæ‰èƒ½å°†é“¾ç å®šä¹‰æäº¤ç»™é€šé“ã€‚æäº¤å®šä¹‰åï¼Œä¾¿å¯ä»¥ä½¿ç”¨é“¾ç äº†ã€‚ä»»ä½•å°†æ•°æ®å†™å…¥è´¦æœ¬çš„é“¾ç çš„è°ƒç”¨éƒ½éœ€è¦ç”±è¶³å¤Ÿçš„é€šé“æˆå‘˜æ¥éªŒè¯ï¼Œä»¥æ»¡è¶³èƒŒä¹¦ç­–ç•¥ã€‚</p><p>You can specify an endorsement policy for a chaincode using the Fabric SDKs. For an example, visit the <a href="https://hyperledger.github.io/fabric-sdk-node/master/tutorial-chaincode-lifecycle.html">How to install and start your chaincode</a> in the Node.js SDK documentation. You can also create an endorsement policy from your CLI when you approve and commit a chaincode definition with the Fabric peer binaries by using the <code>--signature-policy</code> flag.</p><p>ä½ å¯ä»¥ä½¿ç”¨Fabric SDKsæ¥ä¸ºé“¾ç æŒ‡å®šèƒŒä¹¦ç­–ç•¥ï¼Œè®¿é—®<a href="https://hyperledger.github.io/fabric-sdk-node/master/tutorial-chaincode-lifecycle.html">How to install and start your chaincode</a>æ¥æŸ¥çœ‹ä½¿ç”¨Node.js SDKçš„æ–‡æ¡£ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡CLIåœ¨æ‰¹å‡†å’Œæäº¤é“¾ç å®šä¹‰æ—¶æ¥åˆ›å»ºèƒŒä¹¦ç­–ç•¥ï¼Œä½¿ç”¨Fabricçš„peerå¯æ‰§è¡Œç¨‹åºæ—¶ä½¿ç”¨ <code>--signature-policy</code> æ ‡å¿—æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>For exampleï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode approveformyorg --channelID mychannel --signature-policy &quot;AND(&#x27;Org1.member&#x27;, &#x27;Org2.member&#x27;)&quot; --name mycc --version 1.0 --package-id mycc_1:3a8c52d70c36313cfebbaf09d8616e7a6318ababa01c7cbe40603c373bcfe173 --sequence 1 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem --waitForEvent</span><br></pre></td></tr></table></figure><p>The above command approves the chaincode definition of <code>mycc</code> with the policy <code>AND('Org1.member', 'Org2.member')</code> which would require that a member of both Org1 and Org2 sign the transaction. After a sufficient number of channel members approve a chaincode definition for <code>mycc</code>, the definition and endorsement policy can be committed to the channel using the command below:</p><p>ä¸Šé¢çš„å‘½ä»¤ä½¿ç”¨ <code>AND('Org1.member', 'Org2.member')</code> ç­–ç•¥æ¥æ‰¹å‡†<code>mycc</code>çš„é“¾ç å®šä¹‰ï¼Œè¿™ä¸ªç­–ç•¥è¦æ±‚Org1å’ŒOrg2çš„æˆå‘˜éƒ½éœ€è¦å¯¹ä¸€ç¬”äº¤æ˜“è¿›è¡Œç­¾åã€‚åœ¨æœ‰è¶³å¤Ÿçš„é€šé“æˆå‘˜æ‰¹å‡†äº†<code>mycc</code>çš„é“¾ç å®šä¹‰ä¹‹åï¼Œè¿™ä¸ªå®šä¹‰å’ŒèƒŒä¹¦ç­–ç•¥å°±å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¢«æäº¤åˆ°é€šé“äº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode commit -o orderer.example.com:7050 --channelID mychannel --signature-policy &quot;AND(&#x27;Org1.member&#x27;, &#x27;Org2.member&#x27;)&quot; --name mycc --version 1.0 --sequence 1 --init-required --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem --waitForEvent --peerAddresses peer0.org1.example.com:7051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses peer0.org2.example.com:9051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt</span><br></pre></td></tr></table></figure><p>Notice that, if the identity classification is enabled (see <a href="https://hyperledger-fabric.readthedocs.io/en/latest/msp.html">Membership Service Providers (MSP)</a>), one can use the <code>PEER</code> role to restrict endorsement to only peers.</p><p>è¯·æ³¨æ„ï¼Œå¦‚æœå¯ç”¨äº†èº«ä»½åˆ†ç±»ï¼ˆè¯·å‚é˜… <a href="https://hyperledger-fabric.readthedocs.io/en/latest/msp.html">Membership Service Providers (MSP)</a>ï¼‰ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>PEER</code>è§’è‰²å°†èƒŒä¹¦é™åˆ¶ä¸ºä»…peerèŠ‚ç‚¹ã€‚</p><p>For example:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode approveformyorg --channelID mychannel --signature-policy &quot;AND(&#x27;Org1.peer&#x27;, &#x27;Org2.peer&#x27;)&quot; --name mycc --version 1.0 --package-id mycc_1:3a8c52d70c36313cfebbaf09d8616e7a6318ababa01c7cbe40603c373bcfe173 --sequence 1 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem --waitForEvent</span><br></pre></td></tr></table></figure><p>In addition to the specifying an endorsement policy from the CLI or SDK, a chaincode can also use policies in the channel configuration as endorsement policies. You can use the <code>--channel-config-policy</code> flag to select a channel policy with format used by the channel configuration and by ACLs.</p><p>é™¤äº†ä»CLIæˆ–SDKä¸­æŒ‡å®šèƒŒä¹¦ç­–ç•¥ä»¥å¤–ï¼Œé“¾ç è¿˜å¯ä»¥ä½¿ç”¨é€šé“é…ç½®ä¸­çš„ç­–ç•¥ä½œä¸ºèƒŒä¹¦ç­–ç•¥ã€‚ä½ å¯ä»¥ä½¿ç”¨<code>--channel-config-policy</code>æ ‡å¿—æ¥é€‰æ‹©ä¸€ä¸ªé€šé“ç­–ç•¥ï¼Œå…¶æ ¼å¼ç”±é€šé“é…ç½®å’ŒACLä½¿ç”¨ã€‚</p><p>For example:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peer lifecycle chaincode approveformyorg --channelID mychannel --channel-config-policy Channel/Application/Admins --name mycc --version 1.0 --package-id mycc_1:3a8c52d70c36313cfebbaf09d8616e7a6318ababa01c7cbe40603c373bcfe173 --sequence 1 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem --waitForEvent</span><br></pre></td></tr></table></figure><p>If you do not specify a policy, the chaincode definition will use the <code>Channel/Application/Endorsement</code> policy by default, which requires that a transaction be validated by a majority of channel members. This policy depends on the membership of the channel, so it will be updated automatically when organizations are added or removed from a channel. One advantage of using channel policies is that they can be written to be updated automatically with channel membership.</p><p>å¦‚æœä½ ä¸æŒ‡å®šèƒŒä¹¦ç­–ç•¥ï¼Œé“¾ç å®šä¹‰ä¼šä½¿ç”¨é»˜è®¤çš„ <code>Channel/Application/Endorsement</code>ç­–ç•¥ï¼Œè¿™ä¸ªç­–ç•¥è¦æ±‚äº¤æ˜“å¿…é¡»ç»è¿‡å¤§å¤šæ•°é€šé“æˆå‘˜çš„éªŒè¯ã€‚è¯¥ç­–ç•¥å–å†³äºé€šé“æˆå‘˜ï¼Œå› æ­¤ä»é€šé“ä¸­æ·»åŠ æˆ–åˆ é™¤ç»„ç»‡æ—¶ï¼Œå®ƒå°†è‡ªåŠ¨æ›´æ–°ã€‚ä½¿ç”¨é€šé“ç­–ç•¥çš„ä¸€ä¸ªä¼˜åŠ¿æ˜¯ï¼Œå¯ä»¥å°†å…¶ç¼–å†™ä¸ºæ ¹æ®é€šé“æˆå‘˜æ•°é‡è‡ªåŠ¨æ›´æ–°ã€‚</p><p>If you specify an endorsement policy using the <code>--signature-policy</code> flag or the SDK, you will need to update the policy when organizations join or leave the channel. A new organization added to the channel after the chaincode has been defined will be able to query a chaincode (provided the query has appropriate authorization as defined by channel policies and any application level checks enforced by the chaincode) but will not be able to execute or endorse the chaincode. Only organizations listed in the endorsement policy syntax will be able sign transactions.</p><p>å¦‚æœä½ ä½¿ç”¨ <code>--signature-policy</code> æ ‡å¿—æˆ–è€…SDKæŒ‡å®šäº†èƒŒä¹¦ç­–ç•¥ï¼Œä½ éœ€è¦åœ¨ç»„ç»‡åŠ å…¥æˆ–è€…ç¦»å¼€é€šé“æ—¶æ›´æ–°è¿™ä¸ªç­–ç•¥ã€‚ä¸€ä¸ªæ–°çš„ç»„ç»‡åœ¨é“¾ç è¢«å®šä¹‰å¥½ä¹‹ååŠ å…¥è¿™ä¸ªé€šé“ï¼Œè¿™ä¸ªç»„ç»‡å¯ä»¥æŸ¥è¯¢è¿™ä¸ªé“¾ç ï¼ˆæä¾›æŸ¥è¯¢å…·æœ‰é€šé“ç­–ç•¥å’Œé“¾ç å¼ºåˆ¶æ‰§è¡Œçš„ä»»ä½•åº”ç”¨ç¨‹åºçº§åˆ«æ£€æŸ¥æ‰€å®šä¹‰çš„é€‚å½“æˆæƒï¼‰ï¼Œä½†æ˜¯ä¸èƒ½å¤Ÿæ‰§è¡Œæˆ–è®¤å¯é“¾ç ã€‚åªæœ‰ç»„ç»‡åœ¨è®¤å¯ç­–ç•¥è¯­æ³•çš„åˆ—è¡¨ä¸­ä¹‹åï¼Œç»„ç»‡æ‰èƒ½ç­¾ç½²äº¤æ˜“ã€‚</p><h3 id="ä¸ªäººéªŒè¯">ä¸ªäººéªŒè¯</h3><p>chaincodeå¦‚æœä¸è®¾ç½®èƒŒä¹¦ç­–ç•¥ï¼Œåˆ™é»˜è®¤çš„èƒŒä¹¦ç­–ç•¥æ˜¯ï¼š<code> /Channel/Application/Endorsement</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">apple$</span><span class="bash"> peer lifecycle chaincode querycommitted --channelID alljoinchannel --name secured_supply --output json</span></span><br><span class="line">&#123;</span><br><span class="line">&quot;sequence&quot;: 6,</span><br><span class="line">&quot;version&quot;: &quot;3.0&quot;,</span><br><span class="line">&quot;endorsement_plugin&quot;: &quot;escc&quot;,</span><br><span class="line">&quot;validation_plugin&quot;: &quot;vscc&quot;,</span><br><span class="line">&quot;validation_parameter&quot;: &quot;EiAvQ2hhbm5lbC9BcHBsaWNhdGlvbi9FbmRvcnNlbWVudA==&quot;,</span><br><span class="line">&quot;collections&quot;: &#123;&#125;,</span><br><span class="line">&quot;approvals&quot;: &#123;</span><br><span class="line">&quot;GylCoreOrg1MSP&quot;: true,</span><br><span class="line">&quot;GylFOrg1MSP&quot;: true,</span><br><span class="line">&quot;GylSOrg1MSP&quot;: true,</span><br><span class="line">&quot;GylSOrg2MSP&quot;: true</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¾ç½®èƒŒä¹¦ç­–ç•¥ä¸º<code>--signature-policy &quot;OR('GylCoreOrg1MSP.peer','GylFOrg1MSP.peer','GylSOrg1MSP.peer','GylSOrg2MSP.peer')&quot;</code>ï¼Œå†æ¬¡æŸ¥è¯¢é“¾ç å®šä¹‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">apple$</span><span class="bash"> peer lifecycle chaincode querycommitted --channelID alljoinchannel --name secured_supply --output json</span></span><br><span class="line">&#123;</span><br><span class="line">&quot;sequence&quot;: 7,</span><br><span class="line">&quot;version&quot;: &quot;3.0&quot;,</span><br><span class="line">&quot;endorsement_plugin&quot;: &quot;escc&quot;,</span><br><span class="line">&quot;validation_plugin&quot;: &quot;vscc&quot;,</span><br><span class="line">&quot;validation_parameter&quot;: &quot;CmUSFBISCAESAggAEgIIARICCAISAggDGhQSEgoOR3lsQ29yZU9yZzFNU1AQAxoREg8KC0d5bEZPcmcxTVNQEAMaERIPCgtHeWxTT3JnMU1TUBADGhESDwoLR3lsU09yZzJNU1AQAw==&quot;,</span><br><span class="line">&quot;collections&quot;: &#123;&#125;,</span><br><span class="line">&quot;approvals&quot;: &#123;</span><br><span class="line">&quot;GylCoreOrg1MSP&quot;: true,</span><br><span class="line">&quot;GylFOrg1MSP&quot;: true,</span><br><span class="line">&quot;GylSOrg1MSP&quot;: true,</span><br><span class="line">&quot;GylSOrg2MSP&quot;: true</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£ç ä¹‹åï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">e</span><br><span class="line">GylCoreOrg1MSP</span><br><span class="line">GylFOrg1MSP</span><br><span class="line">GylSOrg1MSP</span><br><span class="line">GylSOrg2MSP</span><br></pre></td></tr></table></figure><h3 id="Endorsement-policy-syntaxï¼ˆèƒŒä¹¦ç­–ç•¥çš„è¯­æ³•ï¼‰">Endorsement policy syntaxï¼ˆèƒŒä¹¦ç­–ç•¥çš„è¯­æ³•ï¼‰</h3><p>As you can see above, policies are expressed in terms of principals (â€œprincipalsâ€ are identities matched to a role). Principals are described as <code>'MSP.ROLE'</code>, where <code>MSP</code> represents the required MSP ID and <code>ROLE</code> represents one of the four accepted roles: <code>member</code>, <code>admin</code>, <code>client</code>, and <code>peer</code>.</p><p>æ­£å¦‚æ‚¨åœ¨ä¸Šé¢çœ‹åˆ°çš„é‚£æ ·ï¼Œç­–ç•¥æ˜¯æ ¹æ®ä¸»ä½“è¡¨è¾¾çš„ï¼ˆâ€œä¸»ä½“â€æ˜¯ä¸è§’è‰²åŒ¹é…çš„èº«ä»½ï¼‰ã€‚ä¸»ä½“è¢«æè¿°ä¸º<code>'MSP.ROLE'</code>ï¼Œå…¶ä¸­<code>MSP</code>ä»£è¡¨æ‰€éœ€çš„MSP ID,<code>ROLE</code> ä»£è¡¨å››ä¸ªå…¬è®¤çš„è§’è‰²ä¹‹ä¸€ï¼š<code>member</code>, <code>admin</code>, <code>client</code>ï¼Œå’Œ <code>peer</code>ã€‚</p><p>Here are a few examples of valid principals:</p><ul><li><code>'Org0.admin'</code>: any administrator of the <code>Org0</code> MSP</li><li><code>'Org1.member'</code>: any member of the <code>Org1</code> MSP</li><li><code>'Org1.client'</code>: any client of the <code>Org1</code> MSP</li><li><code>'Org1.peer'</code>: any peer of the <code>Org1</code> MSP</li></ul><p>The syntax of the language is:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPR(E[, E...])</span><br></pre></td></tr></table></figure><p>Where <code>EXPR</code> is either <code>AND</code>, <code>OR</code>, or <code>OutOf</code>, and <code>E</code> is either a principal (with the syntax described above) or another nested call to <code>EXPR</code>.</p><p><code>EXPR</code> å¯ä»¥ä¸º<code>AND</code>, <code>OR</code>, or <code>OutOf</code>ï¼Œ<code>E</code>å¯ä»¥æ˜¯ä¸€ä¸ªå…·æœ‰ä¸Šé¢è¯­æ³•çš„ä¸»ä½“ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹å¦ä¸€ä¸ª<code>EXPR</code>çš„åµŒå¥—è°ƒç”¨ã€‚</p><p>For example:</p><ul><li><p><code>AND('Org1.member', 'Org2.member', 'Org3.member')</code> requests one signature from each of the three principals.</p></li><li><p><code>OR('Org1.member', 'Org2.member')</code> requests one signature from either one of the two principals.</p></li><li><p><code>OR('Org1.member', AND('Org2.member', 'Org3.member'))</code> requests either one signature from a member of the <code>Org1</code> MSP or one signature from a member of the <code>Org2</code> MSP and one signature from a member of the <code>Org3</code> MSP.</p></li><li><p><code>OutOf(1, 'Org1.member', 'Org2.member')</code>, which resolves to the same thing as <code>OR('Org1.member', 'Org2.member')</code>.</p></li><li><p>Similarly, <code>OutOf(2, 'Org1.member', 'Org2.member')</code> is equivalent to <code>AND('Org1.member', 'Org2.member')</code>, and <code>OutOf(2, 'Org1.member', 'Org2.member', 'Org3.member')</code> is equivalent to <code>OR(AND('Org1.member', 'Org2.member'), AND('Org1.member', 'Org3.member'), AND('Org2.member', 'Org3.member'))</code>.</p></li></ul><p>ä¾‹å¦‚ï¼š</p><ul><li><p><code>AND('Org1.member', 'Org2.member', 'Org3.member')</code> ä¸‰ä¸ªä¸»ä½“éƒ½éœ€è¦è¿›è¡Œç­¾åã€‚</p></li><li><p><code>OR('Org1.member', 'Org2.member')</code> åªéœ€è¦ä¸¤ä¸ªä¸»ä½“çš„å…¶ä¸­ä¸€ä¸ªæä¾›ç­¾åã€‚</p></li><li><p><code>OR('Org1.member', AND('Org2.member', 'Org3.member'))</code> éœ€è¦Org1æä¾›ç­¾åï¼Œæˆ–è€…éœ€è¦Org2å’ŒOrg3åŒæ—¶æä¾›ç­¾åã€‚</p></li><li><p><code>OutOf(1, 'Org1.member', 'Org2.member')</code>, å’Œ <code>OR('Org1.member', 'Org2.member')</code>åšçš„äº‹æƒ…ä¸€æ ·ã€‚</p></li><li><p>ç›¸ä¼¼çš„, <code>OutOf(2, 'Org1.member', 'Org2.member')</code> ä¸ <code>AND('Org1.member', 'Org2.member')</code>ç›¸åŒ</p></li><li><p><code>OutOf(2, 'Org1.member', 'Org2.member', 'Org3.member')</code> ä¸ <code>OR(AND('Org1.member', 'Org2.member'), AND('Org1.member', 'Org3.member'), AND('Org2.member', 'Org3.member'))</code>ç›¸åŒã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> Endorsement policies </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Application</title>
      <link href="2021/04/01/blockchain/fabric/Application/"/>
      <url>2021/04/01/blockchain/fabric/Application/</url>
      
        <content type="html"><![CDATA[<p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/developapps/application.html">Application</a></p><h2 id="Basic-Flow">Basic Flow</h2><p><img src="https://hyperledger-fabric.readthedocs.io/en/release-2.2/_images/develop.diagram.3.png" alt="develop.diagram.3"><em>A PaperNet application invokes the commercial paper smart contract to submit an issue transaction request.</em></p><p>An application has to follow six basic steps to submit a transaction:</p><ul><li>Select an identity from a wallet</li><li>Connect to a gateway</li><li>Access the desired network</li><li>Construct a transaction request for a smart contract</li><li>Submit the transaction to the network</li><li>Process the response</li></ul><h2 id="Wallet">Wallet</h2><p>Think of a <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/developapps/wallet.html">wallet</a> holding the digital equivalents of your government ID, driving license or ATM card. The X.509 digital certificates within it will associate the holder with a organization, thereby entitling them to rights in a network channel. For example, <code>Isabella</code> might be an administrator in MagnetoCorp, and this could give her more privileges than a different user â€“ <code>Balaji</code> from DigiBank. Moreover, a smart contract can retrieve this identity during smart contract processing using the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/developapps/transactioncontext.html">transaction context</a>.</p><p>é’±åŒ…æ˜¯ä¿ç®¡äº†å¾ˆå¤šèº«ä»½ä¿¡æ¯çš„é’±åŒ…ã€‚</p><p>ï¼ˆ<em>ä¸ªäººç†è§£ï¼šå°±å¥½åƒè°æˆ˜ç”µå½±é‡Œé¢çš„é—´è°ï¼Œæ‰“å¼€ä¸€ä¸ªæŠ½å±‰é‡Œé¢æœ‰è¿™ä¸ªé—´è°çš„ä¸åŒèº«ä»½çš„æŠ¤ç…§ã€‚</em>ï¼‰</p><h2 id="Gateway">Gateway</h2><p>The second key class is a Fabric <strong>Gateway</strong>. Most importantly, a <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/developapps/gateway.html">gateway</a> identifies one or more peers that provide access to a networkã€‚ in our case, PaperNet. See how <code>issue.js</code> connects to its gateway:</p><p>ç½‘å…³æ ‡è¯†ä¸€ä¸ªæˆ–å¤šä¸ªæä¾›å¯¹ç½‘ç»œè®¿é—®çš„èŠ‚ç‚¹ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> gateway.connect(connectionProfile, connectionOptions);</span><br></pre></td></tr></table></figure><p><code>gateway.connect()</code> has two important parameters:</p><ul><li><p><strong>connectionProfile</strong>: the file system location of a <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/developapps/connectionprofile.html">connection profile</a> that identifies a set of peers as a gateway to PaperNet</p><p>è¿æ¥é…ç½®æ–‡ä»¶çš„æ–‡ä»¶ç³»ç»Ÿä½ç½®ï¼Œè¯¥æ–‡ä»¶å°†ä¸€ç»„peeræ ‡è¯†ä¸ºPaperNetçš„gateway</p></li><li><p><strong>connectionOptions</strong>: a set of options used to control how <code>issue.js</code> interacts with PaperNet</p></li></ul><p>See how the client application uses a gateway to insulate itself from the network topology, which might change. The gateway takes care of sending the transaction proposal to the right peer nodes in the network using the <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/developapps/connectionprofile.html">connection profile</a> and <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.2/developapps/connectionoptions.html">connection options</a>.</p><h2 id="Network-channel">Network channel</h2><p>The peers defined in the gateway <code>connectionProfile.yaml</code> provide <code>issue.js</code> with access to PaperNet. Because these peers can be joined to multiple network channels, the gateway actually provides the application with access to multiple network channels!</p><p>We can see here a powerful feature of Hyperledger Fabric â€“ applications can participate in a <strong>network of networks</strong>, by connecting to multiple gateway peers, each of which is joined to multiple network channels. Applications will have different rights in different channels according to their wallet identity provided in <code>gateway.connect()</code>.</p><h2 id="Construct-request">Construct request</h2><p>The application is now ready to <strong>issue</strong> a commercial paper. To do this, itâ€™s going to use <code>CommercialPaperContract</code> and again, its fairly straightforward to access this smart contract:</p><h2 id="Submit-transaction">Submit transaction</h2><p>Note that the <code>submitTransaction</code> API includes a process for listening for transaction commits. Listening for commits is required because without it, you will not know whether your transaction has successfully been orderered, validated, and committed to the ledger.</p><h2 id="Process-response">Process response</h2>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Hyperledger-Fabric </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Hyperledger-Fabric </tag>
            
            <tag> Application </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»¥å¤ªåŠå­¦ä¹ ä¸å®è·µ</title>
      <link href="2021/04/01/blockchain/eth/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%AD%A6%E4%B9%A0%E4%B8%8E%E5%AE%9E%E8%B7%B5/"/>
      <url>2021/04/01/blockchain/eth/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%AD%A6%E4%B9%A0%E4%B8%8E%E5%AE%9E%E8%B7%B5/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€äº›èµ„æ–™">ä¸€äº›èµ„æ–™</h2>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> ethereum </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> ethereum </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»¥å¤ªåŠå¦‚ä½•ä½¿ç”¨solidityå¼€å‘æ™ºèƒ½åˆçº¦</title>
      <link href="2021/04/01/blockchain/eth/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/"/>
      <url>2021/04/01/blockchain/eth/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€äº›å¼€å‘åˆçº¦ç›¸å…³èµ„æ–™">ä¸€äº›å¼€å‘åˆçº¦ç›¸å…³èµ„æ–™</h2><ul><li>åˆçº¦å¼€å‘è¯­è¨€ï¼š<a href="https://docs.soliditylang.org/en/v0.7.0/">soliditylang</a>ï¼›<a href="https://learnblockchain.cn/docs/solidity/">ä¸­æ–‡ç‰ˆ</a></li><li>å¼€å‘å·¥å…·ï¼š<a href="https://github.com/ethereum/remix-project">remix-project</a></li><li>å¼€å‘ç½‘ç»œï¼š<a href="https://www.trufflesuite.com/ganache">ganache</a>ï¼Œ<a href="https://hardhat.org/">hardhat</a>ï¼Œ<a href="https://github.com/austintgriffith/scaffold-eth">scaffold-eth:ä»¥å¤ªåŠå¼€å‘all in one</a></li><li><a href="http://solc-bin.ethereum.org/bin/list.json">solcç‰ˆæœ¬åˆ—è¡¨</a></li></ul><h3 id="ç¯å¢ƒæ­å»ºï¼ˆMACï¼‰">ç¯å¢ƒæ­å»ºï¼ˆMACï¼‰</h3><h4 id="å®‰è£…solidity">å®‰è£…solidity</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install solidity</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…truffle">å®‰è£…truffle</h4><p>truffleæ˜¯é›†æˆå®‰è£…ã€éƒ¨ç½²ã€æµ‹è¯•åˆçº¦ä¸ºä¸€ä½“çš„å¼€å‘æ¡†æ¶ï¼›å¦‚æœæ²¡æœ‰nodeç¯å¢ƒéœ€è¦å…ˆå®‰è£…node:<code>brew install node</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install truffle -g</span><br></pre></td></tr></table></figure><h3 id="åˆçº¦å¼€å‘">åˆçº¦å¼€å‘</h3><h4 id="åˆå§‹åŒ–é¡¹ç›®è·¯å¾„">åˆå§‹åŒ–é¡¹ç›®è·¯å¾„</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle init</span><br></pre></td></tr></table></figure><h4 id="åˆå§‹åŒ–npmç¯å¢ƒ">åˆå§‹åŒ–npmç¯å¢ƒ</h4><p>åœ¨åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ä¼šè®©ä½ è¾“å…¥ä¸€äº›å‚æ•°çš„å€¼ï¼Œå¯ä»¥ä¸€è·¯æŒ‰å›è½¦å…¨éƒ¨ä½¿ç”¨é»˜è®¤å€¼å³å¯</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…npmä¾èµ–åº“">å®‰è£…npmä¾èµ–åº“</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install dotenv truffle-wallet-provider ethereumjs-wallet</span><br></pre></td></tr></table></figure><h4 id="é…ç½®ç½‘ç»œ">é…ç½®ç½‘ç»œ</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  networks: &#123;</span><br><span class="line">    localnode: &#123;</span><br><span class="line">      network_id: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">      host: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">      port: <span class="string">&quot;8545&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  mocha: &#123;</span><br><span class="line">    <span class="comment">// timeout: 100000</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  compilers: &#123;</span><br><span class="line">    solc: &#123;</span><br><span class="line">      version: <span class="string">&quot;0.8.0+commit.c7dfd78e&quot;</span>,    <span class="comment">// Fetch exact version from solc-bin (default: truffle&#x27;s version)</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  db: &#123;</span><br><span class="line">    enabled: <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="å¼€å‘åˆçº¦">å¼€å‘åˆçº¦</h4><p>æŒ‰ç…§ã€Šç²¾é€šä»¥å¤ªåŠã€‹ä¹¦æœ¬çš„ä¾‹å­å†™äº†ä¸€ä¸ªâ€œæ°´é¾™å¤´â€çš„åˆçº¦ï¼Œåªæœ‰ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªæå–ä»¥å¤ªå¸ï¼ˆwithdrawï¼‰ï¼Œä¸€ä¸ªæ¥æ”¶ä»¥å¤ªå¸ï¼ˆreceiveï¼‰ã€‚åˆçº¦çš„ä»£ç æ”¾åœ¨é¡¹ç›®çš„<code>contracts</code>ç›®å½•ä¸‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0</span><br><span class="line"></span><br><span class="line">pragma solidity &gt;&#x3D;0.7.0 &lt;0.8.0;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; my first contract</span><br><span class="line">contract Faucet &#123;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; Give out ether to anyone who asks</span><br><span class="line">    function withdraw(uint withdraw_amount) public &#123;</span><br><span class="line">        &#x2F;&#x2F; limit withdrawal amount</span><br><span class="line">        require(withdraw_amount &lt;&#x3D; 1 * 1000 * 1000 * 1000 * 1000);</span><br><span class="line">        </span><br><span class="line">        msg.sender.transfer(withdraw_amount);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; Accept any incoming amount ä¸€ä¸ªé»˜è®¤çš„å‡½æ•°</span><br><span class="line">    &#x2F;&#x2F; fallback () external payable &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; æ¨èä½¿ç”¨receive()å‡½æ•°æ¥æ¥æ”¶ä»¥å¤ªå¸</span><br><span class="line">    receive() external payable&#123;&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¼–è¯‘åˆçº¦">ç¼–è¯‘åˆçº¦</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle compile</span><br></pre></td></tr></table></figure><h4 id="éƒ¨ç½²åˆçº¦">éƒ¨ç½²åˆçº¦</h4><p>å‚è€ƒ<code>migrations/1_initial_migration.js</code>æ–‡ä»¶ï¼Œæ–°å»ºä¸€ä¸ª``migrations/2_initial_migration.js<code>ï¼›(*æ³¨æ„ï¼š2_initial_migration.jsè¿™ä¸ªåå­—ä¸èƒ½ä»¥</code>0`å¼€å¤´ï¼Œå¦åˆ™éƒ¨ç½²çš„æ—¶å€™ä¼šå¿½ç•¥ã€‚ã€‚ã€‚*)ä¿®æ”¹æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Faucet = artifacts.require(<span class="string">&quot;Faucet&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">deployer</span>) </span>&#123;</span><br><span class="line">  deployer.deploy(Faucet);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åéƒ¨ç½²åˆ°æœ¬åœ°çš„æµ‹è¯•ç½‘ç»œï¼ˆè¦åœ¨æœ¬åœ°å¯åŠ¨truffleçš„ethereumæµ‹è¯•ç½‘ç»œï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle migrate --network localnode</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæˆä¹‹åçš„æ—¥å¿—å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">(base) w:Faucet apple$ truffle migrate --network localnode</span><br><span class="line"></span><br><span class="line">Compiling your contracts...</span><br><span class="line">===========================</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiling ./contracts/Faucet.sol</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Artifacts written to /Users/apple/code/open-source/my-projects/etherum/Faucet/build/contracts</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiled successfully using:</span></span><br><span class="line">   - solc: 0.8.0+commit.c7dfd78e.Emscripten.clang</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Starting migrations...</span><br><span class="line">======================</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Network name:    <span class="string">&#x27;localnode&#x27;</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Network id:      1337</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Block gas <span class="built_in">limit</span>: 6721975 (0x6691b7)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1_initial_migration.js</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line">   Replacing &#x27;Migrations&#x27;</span><br><span class="line">   ----------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> transaction <span class="built_in">hash</span>:    0xaf813946c7470d83c7fb1e8b535efebcfdd90540c72ee9092ae9e04775bf56bc</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Blocks: 0            Seconds: 0</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> contract address:    0x4445151f84Fd5E71aB93f0d9A1AC93fd7a454c10</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block number:        1</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block timestamp:     1615445677</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> account:             0xc0F680767D4Ae17C7adaF8C6d0b4805Bc207805e</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> balance:             99.99511424</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas used:            244288 (0x3ba40)</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas price:           20 gwei</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> value sent:          0 ETH</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> total cost:          0.00488576 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving migration to chain.</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving artifacts</span></span><br><span class="line">   -------------------------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Total cost:          0.00488576 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2_initial_migration.js</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line">   Replacing &#x27;Faucet&#x27;</span><br><span class="line">   ------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> transaction <span class="built_in">hash</span>:    0xcb451bc9f9347fa9983e5182ccc4453f1a3c7ac74b5c7785679913a7325f7715</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Blocks: 0            Seconds: 0</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> contract address:    0x6B7d6480BC95EF2C51d2Ae247bDd2aC3bBA5690c</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block number:        3</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block timestamp:     1615445677</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> account:             0xc0F680767D4Ae17C7adaF8C6d0b4805Bc207805e</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> balance:             99.9888339</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas used:            271504 (0x42490)</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas price:           20 gwei</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> value sent:          0 ETH</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> total cost:          0.00543008 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving migration to chain.</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving artifacts</span></span><br><span class="line">   -------------------------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Total cost:          0.00543008 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Summary</span><br><span class="line">=======</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Total deployments:   2</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Final cost:          0.01031584 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨truffleéƒ¨ç½²æ™ºèƒ½åˆçº¦åˆ°ropstenæµ‹è¯•ç½‘ç»œ">ä½¿ç”¨truffleéƒ¨ç½²æ™ºèƒ½åˆçº¦åˆ°ropstenæµ‹è¯•ç½‘ç»œ</h3><p>å¯ä»¥åœ¨https://infura.io/ç½‘ç«™å»ºç«‹è´¦å·ï¼Œå¯ä»¥æŠŠå®ƒçœ‹æˆä¸€ä¸ªgethèŠ‚ç‚¹ï¼Œç„¶åä»–æä¾›äº†rpcæ¥å£ã€‚</p><p>é¦–æ¬¡æ‰§è¡Œéƒ¨ç½²ï¼ŒæŠ¥é”™è¯´HDWalletProvideræ²¡æœ‰å®šä¹‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> truffle migrate --network ropsten</span></span><br><span class="line"></span><br><span class="line">Compiling your contracts...</span><br><span class="line">===========================</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiling ./contracts/GZToken.sol</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiling ./contracts/Token2.sol</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiling ./contracts/Token3.sol</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Artifacts written to /Users/apple/code/open-source/my-projects/etherum/Faucet/build/contracts</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiled successfully using:</span></span><br><span class="line">   - solc: 0.8.0+commit.c7dfd78e.Emscripten.clang</span><br><span class="line"></span><br><span class="line">ReferenceError: HDWalletProvider is not defined</span><br><span class="line">    at Object.provider (/Users/apple/code/open-source/my-projects/etherum/Faucet/truffle-config.js:62:21)</span><br><span class="line">    at Object.getProvider (/usr/local/lib/node_modules/truffle/build/webpack:/packages/provider/index.js:20:1)</span><br><span class="line">    at Object.create (/usr/local/lib/node_modules/truffle/build/webpack:/packages/provider/index.js:13:1)</span><br><span class="line">    at TruffleConfig.get [as provider] (/usr/local/lib/node_modules/truffle/build/webpack:/packages/config/dist/configDefaults.js:204:1)</span><br><span class="line">    at Object.detect (/usr/local/lib/node_modules/truffle/build/webpack:/packages/environment/environment.js:19:1)</span><br><span class="line">    at Object.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/core/lib/commands/migrate.js:206:1)</span><br><span class="line">    at Command.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/core/lib/command.js:136:1)</span><br><span class="line">Truffle v5.2.3 (core: 5.2.3)</span><br><span class="line">Node v14.16.0</span><br></pre></td></tr></table></figure><h4 id="è§£å†³æ–¹æ¡ˆï¼š">è§£å†³æ–¹æ¡ˆï¼š</h4><h5 id="æ·»åŠ ä¾èµ–ï¼š">æ·»åŠ ä¾èµ–ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install truffle-hdwallet-provider</span><br><span class="line">npm install dotenv</span><br></pre></td></tr></table></figure><h5 id="åœ¨ä¸truffle-config-jsç›¸åŒçš„ç›®å½•ä¸‹æ·»åŠ -evnæ–‡ä»¶ï¼Œç„¶åå†™å…¥ä½ çš„åŠ©è®°è¯ï¼Œå¦‚ï¼š">åœ¨ä¸truffle-config.jsç›¸åŒçš„ç›®å½•ä¸‹æ·»åŠ <code>.evn</code>æ–‡ä»¶ï¼Œç„¶åå†™å…¥ä½ çš„åŠ©è®°è¯ï¼Œå¦‚ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mnemonic&#x3D;topic foster find apple famous have bonus month remain middle funny smart</span><br></pre></td></tr></table></figure><p><em>æ³¨æ„åœ¨gitignoreæ–‡ä»¶ä¸­æŠŠè¿™ä¸ªæ–‡ä»¶ï¼ˆ<code>.evn</code>ï¼‰å¿½ç•¥ï¼Œé¿å…ä¸Šä¼ åˆ°github</em></p><h5 id="ä¿®æ”¹truffle-config-jsï¼šåœ¨æœ€ä¸Šé¢æ·»åŠ ï¼š">ä¿®æ”¹truffle-config.jsï¼šåœ¨æœ€ä¸Šé¢æ·»åŠ ï¼š</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ä½¿ç”¨infuraä½œä¸ºrpc-apiçš„æä¾›æ–¹æ—¶ï¼Œå› ä¸ºinfuraä¸ç®¡ç†æˆ‘ä»¬çš„ç§é’¥æ‰€ä»¥è¦åœ¨æœ¬åœ°æœ‰ä¸€ä¸ªé’±åŒ…ç”¨äºç­¾å</span></span><br><span class="line"><span class="keyword">var</span> HDWalletProvider = <span class="built_in">require</span>(<span class="string">&quot;truffle-hdwallet-provider&quot;</span>);</span><br><span class="line"><span class="comment">// é»˜è®¤è¯»å–é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„.envæ–‡ä»¶,ç”¨process.env.è°ƒç”¨</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="built_in">require</span>(<span class="string">&#x27;dotenv&#x27;</span>).config(); </span><br><span class="line"><span class="keyword">if</span> (result.error) &#123;</span><br><span class="line">  <span class="keyword">throw</span> result.error;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="ä¿®æ”¹ropstençš„é…ç½®å¦‚ä¸‹ï¼š">ä¿®æ”¹ropstençš„é…ç½®å¦‚ä¸‹ï¼š</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ropsten: &#123;</span><br><span class="line">      provider: <span class="function">() =&gt;</span> <span class="keyword">new</span> HDWalletProvider(process.env.mnemonic, <span class="string">`https://ropsten.infura.io/v3/your-id`</span>),</span><br><span class="line">      network_id: <span class="number">3</span>,       <span class="comment">// Ropsten&#x27;s id</span></span><br><span class="line">      gas: <span class="number">5500000</span>,        <span class="comment">// Ropsten has a lower block limit than mainnet</span></span><br><span class="line">      confirmations: <span class="number">2</span>,    <span class="comment">// # of confs to wait between deployments. (default: 0)</span></span><br><span class="line">      timeoutBlocks: <span class="number">200</span>,  <span class="comment">// # of blocks before a deployment times out  (minimum/default: 50)</span></span><br><span class="line">      skipDryRun: <span class="literal">true</span>     <span class="comment">// Skip dry run before migrations? (default: false for public nets )</span></span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure><h4 id="é‡æ–°éƒ¨ç½²ï¼š">é‡æ–°éƒ¨ç½²ï¼š</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">truffle migrate --network ropsten</span></span><br><span class="line"></span><br><span class="line">Compiling your contracts...</span><br><span class="line">===========================</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiling ./contracts/GZToken.sol</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiling ./contracts/Token3.sol</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Artifacts written to /Users/apple/code/open-source/my-projects/etherum/Faucet/build/contracts</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiled successfully using:</span></span><br><span class="line">   - solc: 0.8.0+commit.c7dfd78e.Emscripten.clang</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Starting migrations...</span><br><span class="line">======================</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Network name:    <span class="string">&#x27;ropsten&#x27;</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Network id:      3</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Block gas <span class="built_in">limit</span>: 8000000 (0x7a1200)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1_initial_migration.js</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line">   Deploying &#x27;Migrations&#x27;</span><br><span class="line">   ----------------------</span><br><span class="line"></span><br><span class="line">Error:  *** Deployment Failed ***</span><br><span class="line"></span><br><span class="line">&quot;Migrations&quot; -- insufficient funds for gas * price + value.</span><br><span class="line"></span><br><span class="line">    at /usr/local/lib/node_modules/truffle/build/webpack:/packages/deployer/src/deployment.js:365:1</span><br><span class="line">    at processTicksAndRejections (internal/process/task_queues.js:93:5)</span><br><span class="line">    at Migration._deploy (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/Migration.js:74:1)</span><br><span class="line">    at Migration._load (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/Migration.js:61:1)</span><br><span class="line">    at Migration.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/Migration.js:212:1)</span><br><span class="line">    at Object.runMigrations (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/index.js:150:1)</span><br><span class="line">    at Object.runFrom (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/index.js:110:1)</span><br><span class="line">    at Object.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/index.js:87:1)</span><br><span class="line">    at runMigrations (/usr/local/lib/node_modules/truffle/build/webpack:/packages/core/lib/commands/migrate.js:263:1)</span><br><span class="line">    at Object.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/core/lib/commands/migrate.js:228:1)</span><br><span class="line">    at Command.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/core/lib/command.js:136:1)</span><br><span class="line">Truffle v5.2.3 (core: 5.2.3)</span><br><span class="line">Node v14.16.0</span><br></pre></td></tr></table></figure><p>åŸå› æ˜¯æ²¡æœ‰è¶³å¤Ÿçš„æ±½æ²¹è´¹ï¼Œå»https://faucet.ropsten.be/è·å–å³å¯ã€‚</p><p>åœ¨æ­¤é‡æ–°éƒ¨ç½²ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> truffle migrate --network ropsten</span></span><br><span class="line"></span><br><span class="line">Compiling your contracts...</span><br><span class="line">===========================</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiling ./contracts/Token3.sol</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Artifacts written to /Users/apple/code/open-source/my-projects/etherum/Faucet/build/contracts</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Compiled successfully using:</span></span><br><span class="line">   - solc: 0.8.0+commit.c7dfd78e.Emscripten.clang</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Starting migrations...</span><br><span class="line">======================</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Network name:    <span class="string">&#x27;ropsten&#x27;</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Network id:      3</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Block gas <span class="built_in">limit</span>: 8000000 (0x7a1200)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1_initial_migration.js</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line">   Deploying &#x27;Migrations&#x27;</span><br><span class="line">   ----------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> transaction <span class="built_in">hash</span>:    0x212e4eee81d5fc3024db8d6787b36a51f070f832b94961605de18675d8f597d3</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Blocks: 2            Seconds: 13</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> contract address:    0x0d4f7ff83b66e1E3377aacE5EFA70d9E036890c2</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block number:        9941219</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block timestamp:     1617088554</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> account:             0x2560be5793F9AA00963e163A1287807Feb897e2F</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> balance:             0.99508824</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas used:            245588 (0x3bf54)</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas price:           20 gwei</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> value sent:          0 ETH</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> total cost:          0.00491176 ETH</span></span><br><span class="line"></span><br><span class="line">   Pausing for 2 confirmations...</span><br><span class="line">   ------------------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> confirmation number: 2 (block: 9941221)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving migration to chain.</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving artifacts</span></span><br><span class="line">   -------------------------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Total cost:          0.00491176 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2_initial_migration.js</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line">   Deploying &#x27;Faucet&#x27;</span><br><span class="line">   ------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> transaction <span class="built_in">hash</span>:    0x40ead4c9b0fa1efb90d551e43587c10457e0c99deeaf4f804222645395435090</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Blocks: 2            Seconds: 21</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> contract address:    0xE18C40cEf01bEedA140033892b4638CFBc464BbD</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block number:        9941227</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block timestamp:     1617088603</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> account:             0x2560be5793F9AA00963e163A1287807Feb897e2F</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> balance:             0.9887139</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas used:            272804 (0x429a4)</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas price:           20 gwei</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> value sent:          0 ETH</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> total cost:          0.00545608 ETH</span></span><br><span class="line"></span><br><span class="line">   Pausing for 2 confirmations...</span><br><span class="line">   ------------------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> confirmation number: 1 (block: 9941229)</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> confirmation number: 2 (block: 9941230)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving migration to chain.</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving artifacts</span></span><br><span class="line">   -------------------------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Total cost:          0.00545608 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3_initial_migration.js</span><br><span class="line">======================</span><br><span class="line"></span><br><span class="line">   Deploying &#x27;GZToken&#x27;</span><br><span class="line">   -------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> transaction <span class="built_in">hash</span>:    0xf28b9b32e6cbf0b12a44249dd4c6eb914706820daafc671e43cabb4541d5396b</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Blocks: 2            Seconds: 25</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> contract address:    0xB8DfEe0D9aC703E75EE3D031148227B3BbB26524</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block number:        9941234</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> block timestamp:     1617088662</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> account:             0x2560be5793F9AA00963e163A1287807Feb897e2F</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> balance:             0.9713052</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas used:            841622 (0xcd796)</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> gas price:           20 gwei</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> value sent:          0 ETH</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> total cost:          0.01683244 ETH</span></span><br><span class="line"></span><br><span class="line">   Pausing for 2 confirmations...</span><br><span class="line">   ------------------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> confirmation number: 1 (block: 9941235)</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> confirmation number: 2 (block: 9941236)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving migration to chain.</span></span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Saving artifacts</span></span><br><span class="line">   -------------------------------------</span><br><span class="line"><span class="meta">   &gt;</span><span class="bash"> Total cost:          0.01683244 ETH</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Summary</span><br><span class="line">=======</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Total deployments:   3</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Final cost:          0.02720028 ETH</span></span><br></pre></td></tr></table></figure><p>è°ƒç”¨åˆçº¦çš„æŠ¥é”™æ±‡æ€»ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Received unexpected error:</span><br><span class="line">                    out of gas</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">intrinsic gas too low: have 0, want 21420 (supplied gas 0)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™äº›å…¨éƒ¨éƒ½æ˜¯å› ä¸ºgasè´¹è®¾ç½®çš„å¤ªå°‘å¯¼è‡´çš„ã€‚</p><h3 id="ä¸åˆçº¦äº¤äº’">ä¸åˆçº¦äº¤äº’</h3><h4 id="åœ¨remixä¸­è°ƒç”¨åˆçº¦">åœ¨<a href="https://remix.ethereum.org/">remix</a>ä¸­è°ƒç”¨åˆçº¦</h4><p>åœ¨<a href="https://remix.ethereum.org/">remix</a>ç½‘é¡µä¸­éƒ¨ç½²å®Œæˆåˆçº¦ä¹‹åï¼Œåœ¨ä¸‹é¢å¯ä»¥çœ‹åˆ°withdrawå‡½æ•°ï¼Œè¾“å…¥æç°çš„é‡‘é¢ç„¶åç‚¹å‡»transactæŒ‰é’®ï¼Œå°±å¯ä»¥è°ƒèµ·MetaMaskè°ƒç”¨æ™ºèƒ½åˆçº¦ã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master/image-20210309173249673.png" alt="image-20210309173249673"></p><h4 id="ä½¿ç”¨truffleçš„å‘½ä»¤è°ƒç”¨åˆçº¦">ä½¿ç”¨truffleçš„å‘½ä»¤è°ƒç”¨åˆçº¦</h4><h5 id="å¯åŠ¨truffleçš„consoleæ§åˆ¶å°ï¼š">å¯åŠ¨truffleçš„consoleæ§åˆ¶å°ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truffle console --network localnode</span><br></pre></td></tr></table></figure><h5 id="æ‰“å¼€ä¹‹ååŒå‡»ä¸¤æ¬¡tabé”®ä¼šæœ‰å‘½ä»¤æç¤ºï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹éƒ¨ç½²çš„Faucetåˆçº¦çš„åœ°å€ï¼š">æ‰“å¼€ä¹‹ååŒå‡»ä¸¤æ¬¡<code>tab</code>é”®ä¼šæœ‰å‘½ä»¤æç¤ºï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹éƒ¨ç½²çš„<code>Faucet</code>åˆçº¦çš„åœ°å€ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">truffle(localnode)&gt;</span><span class="bash"> Faucet.address</span></span><br><span class="line">&#x27;0x6B7d6480BC95EF2C51d2Ae247bDd2aC3bBA5690c&#x27;</span><br></pre></td></tr></table></figure><h5 id="æŸ¥çœ‹æˆ‘ä»¬åˆçº¦çš„è´¦æˆ·ä½™é¢ï¼š">æŸ¥çœ‹æˆ‘ä»¬åˆçº¦çš„è´¦æˆ·ä½™é¢ï¼š</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">truffle(localnode)&gt;</span><span class="bash"> web3.eth.getBalance(Faucet.address)</span></span><br><span class="line">&#x27;0&#x27;</span><br></pre></td></tr></table></figure><h4 id="truffle-develop">truffle develop</h4><p>develop   Open a console with a local development blockchain</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">truffle(develop)&gt;</span><span class="bash"> Faucet.deployed().<span class="keyword">then</span>(i =&gt; &#123;FaucetDeployed = i&#125;)</span></span><br><span class="line">// å‘é€ç»™åˆçº¦1ä¸ªeth</span><br><span class="line"><span class="meta">truffle(develop)&gt;</span><span class="bash"> FaucetDeployed.send(web3.utils.toWei(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;ether&quot;</span>)).<span class="keyword">then</span>(res =&gt; &#123; console.log(res.logs[0].event, res.logs[0].args) &#125;)</span></span><br><span class="line">Deposit Result &#123;</span><br><span class="line">  &#x27;0&#x27;: &#x27;0xAC3509D2d2746B6fEC873087AAB9394d03472131&#x27;,</span><br><span class="line">  &#x27;1&#x27;: BN &#123;</span><br><span class="line">    negative: 0,</span><br><span class="line">    words: [ 56885248, 2993385, 222, &lt;1 empty item&gt; ],</span><br><span class="line">    length: 3,</span><br><span class="line">    red: null</span><br><span class="line">  &#125;,</span><br><span class="line">  __length__: 2,</span><br><span class="line">  to: &#x27;0xAC3509D2d2746B6fEC873087AAB9394d03472131&#x27;,</span><br><span class="line">  amount: BN &#123;</span><br><span class="line">    negative: 0,</span><br><span class="line">    words: [ 56885248, 2993385, 222, &lt;1 empty item&gt; ],</span><br><span class="line">    length: 3,</span><br><span class="line">    red: null</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// ä»åˆçº¦æå–0.1eth</span><br><span class="line"><span class="meta">truffle(develop)&gt;</span><span class="bash"> FaucetDeployed.withdraw(web3.utils.toWei(<span class="string">&quot;0.1&quot;</span>, <span class="string">&quot;ether&quot;</span>)).<span class="keyword">then</span>(res =&gt; &#123; console.log(res.logs[0].event, res.logs[0].args) &#125;)</span></span><br><span class="line">Withdrawal Result &#123;</span><br><span class="line">  &#x27;0&#x27;: &#x27;0xAC3509D2d2746B6fEC873087AAB9394d03472131&#x27;,</span><br><span class="line">  &#x27;1&#x27;: BN &#123;</span><br><span class="line">    negative: 0,</span><br><span class="line">    words: [ 25821184, 13721111, 22, &lt;1 empty item&gt; ],</span><br><span class="line">    length: 3,</span><br><span class="line">    red: null</span><br><span class="line">  &#125;,</span><br><span class="line">  __length__: 2,</span><br><span class="line">  to: &#x27;0xAC3509D2d2746B6fEC873087AAB9394d03472131&#x27;,</span><br><span class="line">  amount: BN &#123;</span><br><span class="line">    negative: 0,</span><br><span class="line">    words: [ 25821184, 13721111, 22, &lt;1 empty item&gt; ],</span><br><span class="line">    length: 3,</span><br><span class="line">    red: null</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸Gasè´¹ç›¸å…³çš„æ³¨æ„äº‹é¡¹">ä¸Gasè´¹ç›¸å…³çš„æ³¨æ„äº‹é¡¹</h3><p>å¦‚æœåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­gasè´¹è€—å°½ï¼Œä¼šè§¦å‘å¦‚ä¸‹ä¸€ç³»åˆ—äº‹ä»¶ï¼š</p><ul><li>æŠ›å‡ºâ€œout of gasâ€å¼‚å¸¸</li><li>çŠ¶æ€è¢«æ¢å¤åˆ°æ‰§è¡Œå¼€å§‹ä¹‹å‰</li><li>æ‰€æœ‰åœ¨è¿™æ¬¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„gaså¼€é”€éƒ½ä¼šè¢«ä½œä¸ºäº¤æ˜“è´¹ç”¨ï¼Œä»¥å¤ªåŠä¸ä¼šå› ä¸ºäº¤æ˜“ä¸­æ­¢è€Œé€€å›gasæˆ–ä»¥å¤ªå¸ã€‚</li></ul><h4 id="å¦‚ä½•æŠŠåˆçº¦å‡½æ•°è°ƒç”¨çš„gasè´¹æ¶ˆè€—æœ€å°åŒ–">å¦‚ä½•æŠŠåˆçº¦å‡½æ•°è°ƒç”¨çš„gasè´¹æ¶ˆè€—æœ€å°åŒ–</h4><h5 id="é¿å…åŠ¨æ€å°ºå¯¸çš„æ•°ç»„">é¿å…åŠ¨æ€å°ºå¯¸çš„æ•°ç»„</h5><p>ä¾‹å¦‚å¯¹æ•°ç»„çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œæ“ä½œï¼Œæˆ–è€…é€šè¿‡éå†çš„æ–¹å¼æŸ¥æ‰¾æ•°ç»„ä¸­çš„æŸä¸ªå€¼ã€‚</p><h5 id="é¿å…è°ƒç”¨å…¶ä»–åˆçº¦">é¿å…è°ƒç”¨å…¶ä»–åˆçº¦</h5><p>è°ƒç”¨å…¶ä»–åˆçº¦ï¼Œç‰¹åˆ«æ˜¯é‚£äº›gasæ¶ˆè€—æœªçŸ¥çš„åˆçº¦ï¼Œå¯èƒ½ä¼šäº§ç”Ÿé«˜æ˜‚çš„gaså¼€é”€ã€‚</p><h5 id="ä¼°è®¡gaså¼€é”€">ä¼°è®¡gaså¼€é”€</h5>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> ethereum </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> ethereum </tag>
            
            <tag> æ™ºèƒ½åˆçº¦ </tag>
            
            <tag> solidity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»¥å¤ªåŠåˆçº¦å¼€å‘æœ€ä½³å®‰å…¨æŒ‡å—ä¸åæ¨¡å¼</title>
      <link href="2021/04/01/blockchain/eth/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91%E6%9C%80%E4%BD%B3%E5%AE%89%E5%85%A8%E6%8C%87%E5%8D%97%E4%B8%8E%E5%8F%8D%E6%A8%A1%E5%BC%8F/"/>
      <url>2021/04/01/blockchain/eth/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91%E6%9C%80%E4%BD%B3%E5%AE%89%E5%85%A8%E6%8C%87%E5%8D%97%E4%B8%8E%E5%8F%8D%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰å…¨">å®‰å…¨</h2><h3 id="ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦-â€”â€”-æœ€ä½³å®‰å…¨å¼€å‘æŒ‡å—ï¼š"><a href="https://github.com/ConsenSys/smart-contract-best-practices/blob/master/README-zh.md">ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦ â€”â€” æœ€ä½³å®‰å…¨å¼€å‘æŒ‡å—</a>ï¼š</h3><p>æœ€ä½³å®è·µä¸­æ‰€ä½“ç°å‡ºçš„è¿™äº›ç‰¹æ€§ï¼Œå…¶å®æ˜¯æ‰€æœ‰è½¯ä»¶å¼€å‘ä¸­éƒ½éœ€è¦çš„ï¼›è€Œåœ¨æ™ºèƒ½åˆçº¦ä»£ç ä¸­å°¤å…¶é‡è¦æ˜¯å› ä¸ºåˆçº¦ä¸€æ—¦éƒ¨ç½²æ— æ³•å†åšä»»ä½•æ›´æ”¹ã€‚</p><ul><li>æœ€å°åŒ–/ç®€å•åŒ–</li><li>ä»£ç é‡ç”¨</li><li>ä»£ç è´¨é‡</li><li>å¯è¯»æ€§å’Œå¯å®¡è®¡æ€§</li><li>æµ‹è¯•è¦†ç›–ç‡</li></ul><h3 id="å®‰å…¨é£é™©å’Œåæ¨¡å¼">å®‰å…¨é£é™©å’Œåæ¨¡å¼</h3><h4 id="æœ‰æ¼æ´åˆçº¦çš„ä¾‹å­"><a href="https://github.com/Arachnid/uscc">æœ‰æ¼æ´åˆçº¦çš„ä¾‹å­</a></h4><h4 id="é‡å…¥">é‡å…¥</h4><p>æœ€æœ‰åçš„ä¾‹å­å°±æ˜¯The DAOï¼Œcodeï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function getBalance(address user) constant returns(uint) &#123;</span><br><span class="line">  return userBalances[user];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function addToBalance() &#123;</span><br><span class="line">  userBalances[msg.sender] +&#x3D; msg.amount;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function withdrawBalance() &#123;</span><br><span class="line">  amountToWithdraw &#x3D; userBalances[msg.sender];</span><br><span class="line">  if (!(msg.sender.call.value(amountToWithdraw)())) &#123; throw; &#125;</span><br><span class="line">  userBalances[msg.sender] &#x3D; 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="é˜²èŒƒæŠ€æœ¯">é˜²èŒƒæŠ€æœ¯</h5><ol><li>ä½¿ç”¨transferæ–¹æ³•è½¬è´¦ï¼Œå› ä¸ºtransferæ–¹æ³•è½¬è´¦æ—¶åªä¼šå¸¦2300gasï¼Œè¿™äº›gasä¸è¶³ä»¥è®©å…¶ä»–åˆçº¦å†åšå…¶ä»–çš„æ“ä½œ</li><li>åœ¨è½¬è´¦ä¹‹å‰å…ˆä¿®æ”¹çŠ¶æ€ï¼ˆæ£€æŸ¥-ä¿®æ”¹-äº¤äº’ï¼‰</li></ol><h3 id="ç®—æ•°æº¢å‡º">ç®—æ•°æº¢å‡º</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0</span><br><span class="line"></span><br><span class="line">pragma solidity&#x3D;0.8.0;</span><br><span class="line"></span><br><span class="line">contract TimeLock &#123;</span><br><span class="line">    mapping(address &#x3D;&gt; uint) public balances;</span><br><span class="line">    </span><br><span class="line">    mapping(address &#x3D;&gt; uint) public lockTime;</span><br><span class="line">    </span><br><span class="line">    function deposit() public payable &#123;</span><br><span class="line">        balances[msg.sender] +&#x3D; msg.value;</span><br><span class="line">        lockTime[msg.sender] &#x3D; block.timestamp + 1 weeks;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function increaseLockTime(uint _secondsToIncrease) public &#123;</span><br><span class="line">        lockTime[msg.sender] +&#x3D; _secondsToIncrease; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function withdraw() public &#123;</span><br><span class="line">        require(lockTime[msg.sender] &lt; block.timestamp);</span><br><span class="line">        require(balances[msg.sender] &gt; 0);</span><br><span class="line">        balances[msg.sender] &#x3D; 0;</span><br><span class="line">        payable(msg.sender).transfer(balances[msg.sender]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="é˜²èŒƒæŠ€æœ¯-v2">é˜²èŒƒæŠ€æœ¯</h5><p>ä½¿ç”¨SafeMathåº“</p><h4 id="æ„å¤–çš„ä»¥å¤ªå¸">æ„å¤–çš„ä»¥å¤ªå¸</h4><p>æœ‰ä¸¤ç§æ–¹å¼åœ¨åˆçº¦æ²¡æœ‰payableæ–¹æ³•æ—¶ä¹Ÿèƒ½å¤Ÿå¼ºåˆ¶ç»™åˆçº¦è½¬å…¥ä»¥å¤ªå¸ï¼š</p><ul><li>self-destructï¼šåœ¨ä¸€ä¸ªåˆçº¦ä½¿ç”¨selfdestructå‡½æ•°å°†ä»£ç æ¸…é™¤æ—¶ï¼Œå¯ä»¥æŠŠéœ€è¦è‡ªæ¯çš„åˆçº¦ä¸­çš„ä»¥å¤ªå¸è½¬å…¥åˆ°æŒ‡å®šçš„åœ°å€</li><li>é¢„å…ˆå‘é€çš„ä»¥å¤ªå¸ï¼šåˆçº¦çš„åœ°å€æ˜¯æ ¹æ®åˆ›å»ºè¿™ä¸ªåˆçº¦çš„è´¦æˆ·åœ°å€å’Œäº¤æ˜“nonceé€šè¿‡Keccak256è®¡ç®—å‡ºæ¥çš„ï¼Œæ‰€ä»¥å…¶å®æ˜¯å¯ä»¥é¢„å…ˆç»™ä¸€ä¸ªåˆçº¦å‘é€ä»¥å¤ªå¸çš„</li></ul><h5 id="è¿™ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ">è¿™ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</h5><p>å¥½åƒæœ‰äººç»™æˆ‘çš„åˆçº¦å‘é€ä»¥å¤ªå¸å¹¶ä¸æ˜¯ä»€ä¹ˆåäº‹ï¼Œä¸æ˜¯å—ï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0</span><br><span class="line"></span><br><span class="line">pragma solidity&#x3D;0.8.0;</span><br><span class="line"></span><br><span class="line">contract EtherGame &#123;</span><br><span class="line">    uint public constant three &#x3D; 3;</span><br><span class="line">    uint public constant six &#x3D; 6;</span><br><span class="line">    uint public constant nine &#x3D; 9;</span><br><span class="line">    </span><br><span class="line">    uint public constant finalAmount &#x3D; 10;</span><br><span class="line">    </span><br><span class="line">    mapping(address &#x3D;&gt; uint) public redeemableEther;</span><br><span class="line">    </span><br><span class="line">    function play() public payable &#123;</span><br><span class="line">        require(msg.value &#x3D;&#x3D; 0.5 ether);</span><br><span class="line">        uint currentBalance &#x3D; address(this).balance + msg.value;</span><br><span class="line">        require(currentBalance &lt;&#x3D; finalAmount);</span><br><span class="line">        if (currentBalance &#x3D;&#x3D; three || currentBalance &#x3D;&#x3D; six || currentBalance &#x3D;&#x3D; nine) &#123;</span><br><span class="line">            redeemableEther[msg.sender] +&#x3D; currentBalance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function getRedeem() public &#123;</span><br><span class="line">    </span><br><span class="line">        require(address(this).balance &#x3D;&#x3D; finalAmount);</span><br><span class="line">        uint transferValue &#x3D; redeemableEther[msg.sender];</span><br><span class="line">        require(transferValue &gt; 0);</span><br><span class="line">        redeemableEther[msg.sender] &#x3D; 0;</span><br><span class="line">        payable(msg.sender).transfer(transferValue);</span><br><span class="line">    &#125;</span><br><span class="line">       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="é˜²èŒƒæŠ€æœ¯-v3">é˜²èŒƒæŠ€æœ¯</h5><p>æ…ç”¨<code>this.balance</code>;å¦‚ä¸Šé¢çš„åˆçº¦å¯ä»¥æ”¹ä¸ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0</span><br><span class="line"></span><br><span class="line">pragma solidity&#x3D;0.8.0;</span><br><span class="line"></span><br><span class="line">contract EtherGame &#123;</span><br><span class="line">    uint public constant three &#x3D; 3;</span><br><span class="line">    uint public constant six &#x3D; 6;</span><br><span class="line">    uint public constant nine &#x3D; 9;</span><br><span class="line">    </span><br><span class="line">    uint public constant finalAmount &#x3D; 10;</span><br><span class="line">    </span><br><span class="line">    uint public depositedWei;</span><br><span class="line">    </span><br><span class="line">    mapping(address &#x3D;&gt; uint) public redeemableEther;</span><br><span class="line">    </span><br><span class="line">    function play() public payable &#123;</span><br><span class="line">        require(msg.value &#x3D;&#x3D; 0.5 ether);</span><br><span class="line">        uint currentBalance &#x3D; depositedWei + msg.value;</span><br><span class="line">        require(currentBalance &lt;&#x3D; finalAmount);</span><br><span class="line">        if (currentBalance &#x3D;&#x3D; three || currentBalance &#x3D;&#x3D; six || currentBalance &#x3D;&#x3D; nine) &#123;</span><br><span class="line">            redeemableEther[msg.sender] +&#x3D; currentBalance;</span><br><span class="line">        &#125;</span><br><span class="line">        depositedWei +&#x3D; msg.value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function getRedeem() public &#123;</span><br><span class="line">        require(depositedWei &#x3D;&#x3D; finalAmount);</span><br><span class="line">        uint transferValue &#x3D; redeemableEther[msg.sender];</span><br><span class="line">        require(transferValue &gt; 0);</span><br><span class="line">        redeemableEther[msg.sender] &#x3D; 0;</span><br><span class="line">        payable(msg.sender).transfer(transferValue);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="DELEGATECALL">DELEGATECALL</h4><p>DELEGATECALLè°ƒç”¨æ˜¯ä½¿ç”¨å½“å‰çš„ä¸Šä¸‹æ–‡è°ƒç”¨ç›®æ ‡åˆçº¦ï¼Œå¹¶ä¸”ä¼šä»¥ä¸»è°ƒç”¨åˆçº¦çš„çŠ¶æ€æ¥è¿è¡Œã€‚ä¹Ÿå°±æ˜¯ç›®æ ‡åˆçº¦çš„çŠ¶æ€å­˜å‚¨æ§½çš„æ•°æ®ä¼šå˜æˆä¸»è°ƒç”¨åˆçº¦çš„çŠ¶æ€å­˜å‚¨æ§½çš„æ•°æ®ã€‚</p><h5 id="é˜²èŒƒæŠ€æœ¯-v4">é˜²èŒƒæŠ€æœ¯</h5><p>DELEGATECALLè°ƒç”¨æ—¶è¦éå¸¸ä»”ç»†çš„æ³¨æ„è°ƒç”¨çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”å°½å¯èƒ½çš„æ„å»ºæ— çŠ¶æ€çš„åº“åˆçº¦</p><h4 id="é»˜è®¤çš„å¯è§æ€§">é»˜è®¤çš„å¯è§æ€§</h4><ul><li>å‡½æ•°çš„é»˜è®¤å¯è§æ€§æ˜¯<code>public</code></li><li>çŠ¶æ€å˜é‡é»˜è®¤å¯è§æ€§æ˜¯<code>internal</code></li></ul><p>æ‰€ä»¥å¦‚æœä¸€ä¸ªå‡½æ•°å¿˜è®°äº†å†™å¯è§æ€§å…³é”®å­—ï¼Œåˆ™æ‰€æœ‰äººï¼ˆåŒ…æ‹¬å¤–éƒ¨è´¦æˆ·å’Œåˆçº¦è´¦æˆ·ï¼‰éƒ½å¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚</p><h5 id="é˜²èŒƒæŠ€æœ¯-v5">é˜²èŒƒæŠ€æœ¯</h5><p>ä¸ºåˆçº¦ä¸­çš„æ‰€æœ‰å‡½æ•°éƒ½æ˜ç¡®æŒ‡å®šå¯è§æ€§æ—¶æœ€ä½³å®è·µã€‚</p><h4 id="æ— åºé”™è§‰">æ— åºé”™è§‰</h4><p>ä»¥å¤ªåŠå†…éƒ¨å‡ ä¹æ²¡æœ‰éšæœºæ€§ï¼Œå¦‚æœåˆçº¦é€šè¿‡åˆ¤æ–­æœªæ¥çš„åŒºå—å¤§å°ã€hashã€gasä¸Šé™ã€æ—¶é—´æˆ³ç­‰æ¥è¿›è¡ŒçŠ¶æ€çš„å˜æ›´ï¼›è¿™äº›å˜é‡éƒ½å¯èƒ½è¢«çŸ¿å·¥æ‰€æ§åˆ¶ã€‚</p><h5 id="é˜²èŒƒæŠ€æœ¯-v6">é˜²èŒƒæŠ€æœ¯</h5><p>ä½¿ç”¨å¤–éƒ¨çš„oracleæœ€ä¸ºéšæœºæºæ¥ä¿è¯éšæœºæ€§ã€‚å¦‚<a href="https://github.com/randao/randao">RANDAO</a></p><h4 id="å¤–éƒ¨åˆçº¦å¼•ç”¨">å¤–éƒ¨åˆçº¦å¼•ç”¨</h4><p>å¦‚æœä¸€ä¸ªåˆçº¦è¦å¼•ç”¨å…¶ä»–çš„å¤–éƒ¨åˆçº¦ï¼Œå¦‚ä½•å¼•ç”¨æ˜¯ä¸€ä¸ªé—®é¢˜ï¼›å¦‚æœåœ¨æ„é€ æ–¹æ³•ä¸­é€šè¿‡è¾“å…¥åœ°å€æ¥å¼•ç”¨ï¼Œåˆ™ä¼šæœ‰å¯èƒ½å› ä¸ºè¾“é”™åœ°å€è€Œå¯¼è‡´å¼•ç”¨é”™è¯¯ã€‚</p><p>èœœç½åˆçº¦ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> *Submitted for verification at Etherscan.io on 2018-02-09</span><br><span class="line">*&#x2F;</span><br><span class="line"></span><br><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">contract Private_Bank</span><br><span class="line">&#123;</span><br><span class="line">    mapping (address &#x3D;&gt; uint) public balances;</span><br><span class="line">    </span><br><span class="line">    uint public MinDeposit &#x3D; 1 ether;</span><br><span class="line">    </span><br><span class="line">    Log TransferLog;</span><br><span class="line">    </span><br><span class="line">    function Private_Bank(address _log)</span><br><span class="line">    &#123;</span><br><span class="line">        TransferLog &#x3D; Log(_log);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function Deposit()</span><br><span class="line">    public</span><br><span class="line">    payable</span><br><span class="line">    &#123;</span><br><span class="line">        if(msg.value &gt;&#x3D; MinDeposit)</span><br><span class="line">        &#123;</span><br><span class="line">            balances[msg.sender]+&#x3D;msg.value;</span><br><span class="line">            TransferLog.AddMessage(msg.sender,msg.value,&quot;Deposit&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function CashOut(uint _am)</span><br><span class="line">    &#123;</span><br><span class="line">        if(_am&lt;&#x3D;balances[msg.sender])</span><br><span class="line">        &#123;</span><br><span class="line">            </span><br><span class="line">            if(msg.sender.call.value(_am)())</span><br><span class="line">            &#123;</span><br><span class="line">                balances[msg.sender]-&#x3D;_am;</span><br><span class="line">                TransferLog.AddMessage(msg.sender,_am,&quot;CashOut&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function() public payable&#123;&#125;    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Log </span><br><span class="line">&#123;</span><br><span class="line">   </span><br><span class="line">    struct Message</span><br><span class="line">    &#123;</span><br><span class="line">        address Sender;</span><br><span class="line">        string  Data;</span><br><span class="line">        uint Val;</span><br><span class="line">        uint  Time;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Message[] public History;</span><br><span class="line">    </span><br><span class="line">    Message LastMsg;</span><br><span class="line">    </span><br><span class="line">    function AddMessage(address _adr,uint _val,string _data)</span><br><span class="line">    public</span><br><span class="line">    &#123;</span><br><span class="line">        LastMsg.Sender &#x3D; _adr;</span><br><span class="line">        LastMsg.Time &#x3D; now;</span><br><span class="line">        LastMsg.Val &#x3D; _val;</span><br><span class="line">        LastMsg.Data &#x3D; _data;</span><br><span class="line">        History.push(LastMsg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="é˜²èŒƒæŠ€æœ¯-v7">é˜²èŒƒæŠ€æœ¯</h5><ol><li>åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨newçš„æ–¹æ³•æ¥å¼•ç”¨å…¶ä»–åˆçº¦</li><li>åœ¨å¼•ç”¨å…¶ä»–åˆçº¦æ—¶å¯¹å¤–éƒ¨åˆçº¦åœ°å€è¿›è¡Œç¡¬ç¼–ç ï¼ˆå°±ç®—ç¡¬ç¼–ç ä¹Ÿä¸èƒ½100%å®Œå…¨çš„ä¸è¾“é”™ï¼Œä½†æ˜¯è¿™å¾ˆå®¹æ˜“å®¡æŸ¥ï¼‰</li></ol><h4 id="çŸ­åœ°å€-å‚æ•°æ”»å‡»">çŸ­åœ°å€/å‚æ•°æ”»å‡»</h4><h5 id="æ¼æ´çš„ç»†èŠ‚">æ¼æ´çš„ç»†èŠ‚</h5><p>å½“æˆ‘ä»¬å‘æ™ºèƒ½åˆçº¦ä¼ é€’å‚æ•°æ—¶ï¼Œè¿™äº›å‚æ•°éœ€è¦ä¾ç…§ABIè§„èŒƒè¿›è¡Œç¼–ç ã€‚ä¸è¿‡å‘é€çš„å®é™…æ•°æ®é•¿åº¦å°äºæ ‡å‡†çš„å‚æ•°ç¼–ç é•¿åº¦ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒEVMä¼šåœ¨æ•°æ®çš„æœ«å°¾è¡¥0æ¥ä½¿æ•°æ®é•¿åº¦è¾¾åˆ°è¦æ±‚ã€‚</p><h5 id="é˜²èŒƒæŠ€æœ¯-v8">é˜²èŒƒæŠ€æœ¯</h5><p>æ‰€æœ‰çš„å¤–éƒ¨åº”ç”¨åœ¨æŠŠè¾“å…¥å‚æ•°å‘é€åˆ°åŒºå—é“¾ä¹‹å‰éƒ½åº”è¯¥å¯¹ä»–ä»¬è¿›è¡Œæ ¡éªŒã€‚</p><h4 id="æœªæ£€æŸ¥çš„è°ƒç”¨è¿”å›å€¼">æœªæ£€æŸ¥çš„è°ƒç”¨è¿”å›å€¼</h4><p>åœ¨ä½¿ç”¨<code>call</code>æˆ–è€…<code>send</code>è¿›è¡Œå¤–éƒ¨è°ƒç”¨æ—¶ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª<code>bool</code>ç±»å‹çš„ç»“æœï¼Œå¦‚æœä¸æ£€æŸ¥è¿™ä¸ªç»“æœå°±ç»§ç»­å¾€ä¸‹è¿›è¡Œï¼Œæœ‰å¯èƒ½å¯¼è‡´<code>call</code>æˆ–<code>send</code>çš„è°ƒç”¨å¤±è´¥ï¼Œè€Œä¹‹åçš„ä»£ç æ‰§è¡ŒæˆåŠŸã€‚ï¼ˆå¾ˆåƒæœ¬åº”è¯¥åœ¨åŒä¸€ä¸ªäº‹ç‰©ä¸­æ‰§è¡Œçš„ä¸¤ä¸ªæ“ä½œï¼Œç¬¬ä¸€ä¸ªæ“ä½œå¤±è´¥äº†ï¼Œç¬¬äºŒä¸ªæ“ä½œå´æˆåŠŸäº†ï¼Œæœ€ç»ˆå¯¼è‡´æœ‰é—®é¢˜ã€‚ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0</span><br><span class="line"></span><br><span class="line">pragma solidity&#x3D;0.8.0;</span><br><span class="line"></span><br><span class="line">contract Lotto &#123;</span><br><span class="line">    </span><br><span class="line">    address public winner;</span><br><span class="line">    </span><br><span class="line">    bool public payedOut &#x3D; false;</span><br><span class="line">    </span><br><span class="line">    uint public winAmount;</span><br><span class="line">    </span><br><span class="line">    function play() public payable &#123;</span><br><span class="line">        winAmount +&#x3D; msg.value;</span><br><span class="line">        if(msg.sender &#x3D;&#x3D; address(0x2560be5793F9AA00963e163A1287807Feb897e2F)) &#123;</span><br><span class="line">            winner &#x3D; msg.sender;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function sendToWinner() public &#123;</span><br><span class="line">        require(!payedOut);</span><br><span class="line">        payable(winner).send(winAmount);</span><br><span class="line">        payedOut &#x3D; true;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function withdrawLeftOver() public &#123;</span><br><span class="line">        require(payedOut);</span><br><span class="line">        payable(msg.sender).transfer(winAmount);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="é˜²èŒƒæŠ€æœ¯-v9">é˜²èŒƒæŠ€æœ¯</h5><p>å°½å¯èƒ½çš„ä½¿ç”¨<code>transfer</code>å‡½æ•°è€Œä¸æ˜¯<code>send</code>ï¼Œå› ä¸º<code>transfer</code>å‡½æ•°ä¼šåœ¨å¤–éƒ¨è°ƒç”¨å¤±è´¥æ—¶revertã€‚</p><h4 id="ç«äº‰æ¡ä»¶-é¢„å…ˆäº¤æ˜“">ç«äº‰æ¡ä»¶/é¢„å…ˆäº¤æ˜“</h4><p>åœ¨ç›®å‰Powçš„å…±è¯†æ–¹å¼ä¸‹ï¼Œä»¥å¤ªåŠç½‘ç»œä¸Šçš„æ‰€æœ‰çš„äº¤æ˜“éƒ½æ˜¯ç”±çŸ¿å·¥ä»äº¤æ˜“æ± ä¸­é€‰æ‹©éƒ¨åˆ†äº¤æ˜“æ‰“åŒ…æˆåŒºå—çš„ï¼Œè€ŒçŸ¿å·¥åœ¨æ‰“åŒ…åŒºå—çš„æ—¶å€™ä¼šä¼˜å…ˆæ‰“åŒ…gasè´¹å¤šçš„äº¤æ˜“ã€‚å› æ­¤å¦‚æœä¸€ä¸ªäººç›‘å¬äº†äº¤æ˜“æ± ä¸­æŸä¸ªåˆçº¦ï¼ˆå¦‚çŒœè°œè¯­ï¼‰çš„äº¤æ˜“ï¼Œé‚£ä¹ˆä»–åœ¨çœ‹åˆ°åˆ«äººçŒœä¸­çš„ç­”æ¡ˆæ—¶é©¬ä¸Šå‘å¸ƒä¸€ä¸ªgasè´¹æ›´é«˜çš„åŒæ ·ç­”æ¡ˆçš„äº¤æ˜“å°±å¾ˆæœ‰å¯èƒ½ä¼šæå‰è¢«ç¡®è®¤ã€‚</p><h5 id="é˜²èŒƒæŠ€æœ¯-v10">é˜²èŒƒæŠ€æœ¯</h5><p>èƒ½å¤Ÿå‘èµ·è¿™ç§æ”»å‡»çš„äººæœ‰ä¸¤ç§ï¼š</p><ol><li>æ™®é€šç”¨æˆ·é€šè¿‡æé«˜äº¤æ˜“è´¹çš„æ–¹å¼è¿›è¡Œæ”»å‡»</li><li>çŸ¿å·¥è‡ªå·±å¯¹äº¤æ˜“è¿›è¡Œæ”»å‡»</li></ol><p>ç¬¬ä¸€ç§é˜²èŒƒæ–¹æ³•æ˜¯è®¾ç½®gasè´¹çš„ä¸Šé™ï¼Œè¿™æ ·å°±èƒ½ä¸€å®šç¨‹åº¦çš„é¿å…ç”¨æˆ·é€šè¿‡æäº¤äº¤æ˜“è´¹æ¥è¿›è¡Œæå‰ç¡®è®¤ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼æ— æ³•é˜²èŒƒçŸ¿å·¥ã€‚</p><p>ç¬¬äºŒç§é˜²èŒƒæ–¹æ³•æ˜¯ï¼ˆæäº¤-æ­ç¤ºï¼‰ï¼Œå³å…ˆæäº¤ä¸€ä¸ªç­”æ¡ˆçš„hashï¼Œç„¶åå†æäº¤ç­”æ¡ˆã€‚</p><h4 id="æ‹’ç»æœåŠ¡">æ‹’ç»æœåŠ¡</h4><h5 id="åŸºäºå¯è¢«å¤–éƒ¨æ“çºµçš„æ˜ å°„æˆ–æ•°ç»„çš„å¾ªç¯">åŸºäºå¯è¢«å¤–éƒ¨æ“çºµçš„æ˜ å°„æˆ–æ•°ç»„çš„å¾ªç¯</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0</span><br><span class="line"></span><br><span class="line">contract DistributeTokens &#123;</span><br><span class="line">    </span><br><span class="line">    address public owner;</span><br><span class="line">    </span><br><span class="line">    address[] investors;</span><br><span class="line">    </span><br><span class="line">    uint[] investorTokens;</span><br><span class="line">    </span><br><span class="line">    function inverst() public payable &#123;</span><br><span class="line">        investors.push(msg.sender);</span><br><span class="line">        investorTokens.push(msg.value * 5);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier onlyOwner() &#123;</span><br><span class="line">        require(address(msg.sender) &#x3D;&#x3D; owner);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function distribute() public onlyOwner &#123;</span><br><span class="line">        for (uint i &#x3D; 0; i &lt; investors.length; i++) &#123;</span><br><span class="line">            transferToken(investors[i], investorTokens[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="ä¸»äººçš„æ“ä½œ">ä¸»äººçš„æ“ä½œ</h5><p>å¦‚æœä¸€ä¸ªåˆçº¦åªèƒ½ç”±åˆçº¦çš„ä¸»äººåšä¸€äº›æ“ä½œæ‰èƒ½è¿›å…¥ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œé‚£ä¹ˆå¦‚æœåˆçº¦çš„ä¸»äººå¤±å»äº†è¡Œä¸ºèƒ½åŠ›æˆ–è€…ä¸¢å¤±äº†ç§é’¥é‚£ä¹ˆè¿™ä¸ªåˆçº¦å°±æ°¸è¿œæ— æ³•è¿›å…¥ä¸‹ä¸€ä¸ªçŠ¶æ€äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0</span><br><span class="line"></span><br><span class="line">pragma solidity&#x3D;0.8.0;</span><br><span class="line"></span><br><span class="line">contract ICO &#123;</span><br><span class="line">    </span><br><span class="line">    bool public isFinalized &#x3D; false;</span><br><span class="line">    </span><br><span class="line">    address public owner;</span><br><span class="line">    </span><br><span class="line">    constructor () &#123;</span><br><span class="line">        owner&#x3D; msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    mapping(address &#x3D;&gt; uint) public monery;</span><br><span class="line">    </span><br><span class="line">    function giveMe() public payable &#123;</span><br><span class="line">        monery[msg.sender] +&#x3D; msg.value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function finalize() public &#123;</span><br><span class="line">        require(msg.sender &#x3D;&#x3D; owner);</span><br><span class="line">        isFinalized &#x3D; true;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function withdraw() public &#123;</span><br><span class="line">        require(isFinalized);</span><br><span class="line">        payable(msg.sender).transfer(monery[msg.sender]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="åŸºäºå¤–éƒ¨è°ƒç”¨æ¥ä¿®æ”¹çŠ¶æ€">åŸºäºå¤–éƒ¨è°ƒç”¨æ¥ä¿®æ”¹çŠ¶æ€</h5><p>å¦‚æœä¸€ä¸ªåˆçº¦åªæœ‰æŠŠä½™é¢è½¬ç§»åˆ°å¤–éƒ¨çš„æŸä¸ªè´¦æˆ·æ—¶æ‰èƒ½å¤Ÿæ›´æ”¹çŠ¶æ€ï¼Œé‚£ä¹ˆå¤–éƒ¨çš„é‚£ä¸ªè´¦æˆ·å¦‚æœæ²¡æœ‰fallbackä¹‹ç±»çš„ç”¨äºæ¥æ”¶ä»¥å¤ªå¸çš„å‡½æ•°çš„è¯ï¼Œå½“å‰çš„å‡½æ•°æ°¸è¿œéƒ½æ— æ³•è¿›å…¥ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚</p><h5 id="é˜²èŒƒæŠ€æœ¯-v11">é˜²èŒƒæŠ€æœ¯</h5><p>ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œåˆçº¦ä¸åº”è¯¥åŸºäºä¸€ä¸ªå¯ä»¥è¢«å¤–éƒ¨ç”¨æˆ·äººä¸ºæ“çºµçš„æ•°æ®ç»“æ„æ¥æ‰§è¡Œå¾ªç¯ã€‚æ¨èä½¿ç”¨å–å›æ¨¡å¼ï¼Œè®©æ¯ä¸ªå–æ¬¾äººå•ç‹¬çš„è°ƒç”¨withdrawå‡½æ•°æ¥å–å›ä»–ä»¬å„è‡ªçš„ä»£å¸ã€‚</p><p>ç¬¬äºŒä¸ªä¾‹å­ï¼Œå°†ä¸»äººè®¾å®šä¸ºå¤šé‡ç­¾ååˆçº¦ï¼›æˆ–è€…æ˜¯ä½¿ç”¨æ—¶é—´é”ï¼ˆrequire(msg.sender ==owner || block.timestamp &gt; unlockTime)ï¼‰ã€‚</p><h4 id="åŒºå—æ—¶é—´æˆ³æ“çºµ">åŒºå—æ—¶é—´æˆ³æ“çºµ</h4><p>ä¸‹é¢çš„ä»£ç ï¼Œå¦‚æœæ—¶é—´æˆ³æ˜¯15çš„å€æ•°åˆ™èƒ½å–èµ°å½“å‰åˆçº¦çš„æ‰€æœ‰ä½™é¢ã€‚ä½†æ˜¯æ—¶é—´æˆ³æ˜¯å¯ä»¥è¢«çŸ¿å·¥è½»å¾®çš„è°ƒæ•´çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0</span><br><span class="line"></span><br><span class="line">pragma solidity&#x3D;0.8.0;</span><br><span class="line"></span><br><span class="line">contract Roulette &#123;</span><br><span class="line">    uint public pastBlockTime;</span><br><span class="line">    </span><br><span class="line">    constructor() payable &#123;</span><br><span class="line">        </span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    fallback() external payable &#123;</span><br><span class="line">        require(msg.value &#x3D;&#x3D; 10 ether);</span><br><span class="line">        require(block.timestamp !&#x3D; pastBlockTime);</span><br><span class="line">        pastBlockTime &#x3D; block.timestamp;</span><br><span class="line">        if (pastBlockTime % 15 &#x3D;&#x3D; 0) &#123;</span><br><span class="line">            payable(msg.sender).transfer(address(this).balance);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="é˜²èŒƒæŠ€æœ¯-v12">é˜²èŒƒæŠ€æœ¯</h5><p>åŒºå—çš„æ—¶é—´æˆ³ä¸åº”è¯¥è¢«ç”¨æ¥ä½œä¸ºæ— åºæ•°æ®æˆ–ç”Ÿæˆéšæœºæ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»–ä»¬ä¸åº”è¯¥ç”¨æ¥ä½œä¸ºæ¸¸æˆçš„è·èƒœæ¡ä»¶æˆ–è€…ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªé‡è¦çš„çŠ¶æ€å˜åŠ¨ã€‚</p><p>å¦‚æœåˆçº¦éœ€è¦æ„ŸçŸ¥æ—¶é—´çš„é€»è¾‘ï¼Œå¦‚è§£é”åˆçº¦ï¼ˆåŸºäºæ—¶é—´é”ï¼‰ï¼Œåœ¨ICOå¼€å§‹å‡ å‘¨ä¹‹åæ¥ç»“æŸå®ƒæˆ–è€…å¼ºåˆ¶æŒ‡å®šä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚æœ‰äº›æƒ…å†µæ¨èä½¿ç”¨block.numberå’Œå¹³å‡åŒºå—æ—¶é—´æ¥ä¼°ç®—æ—¶é—´æ¡ä»¶ã€‚</p><h4 id="å°å¿ƒä½¿ç”¨æ„é€ å‡½æ•°">å°å¿ƒä½¿ç”¨æ„é€ å‡½æ•°</h4><p>åœ¨Solidity v0.4.22ä¹‹å‰ï¼Œå’Œåˆçº¦åç§°ç›¸åŒçš„å‡½æ•°å°±æ˜¯æ„é€ å‡½æ•°ã€‚å¦‚æœåˆçº¦ä¿®æ”¹äº†åç§°ä½†æ˜¯å¿˜äº†æ”¹æ„é€ å‡½æ•°çš„åç§°ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±å˜æˆäº†ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0</span><br><span class="line"></span><br><span class="line">pragma solidity&#x3D;0.4.1;</span><br><span class="line"></span><br><span class="line">contract OwnerWallet &#123;</span><br><span class="line">    address public owner;</span><br><span class="line">    </span><br><span class="line">    function ownerWallet() &#123;</span><br><span class="line">        owner &#x3D; msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function () public payable &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function withdraw() public &#123;</span><br><span class="line">        require(msg.sender &#x3D;&#x3D; owner);</span><br><span class="line">        msg.sender.transfer(this.balance);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="é˜²èŒƒæŠ€æœ¯-v13">é˜²èŒƒæŠ€æœ¯</h5><p>Solidity v0.4.22ä¹‹åçš„ç‰ˆæœ¬çš„æ„é€ å‡½æ•°æ˜¯é€šè¿‡<code>constructor</code>å…³é”®å­—ç”Ÿå‘½ï¼ŒSolidityçš„ç‰ˆæœ¬å˜åŒ–è¾ƒå¿«ï¼Œå°½é‡é€‰æ‹©è¾ƒæ–°çš„ç¨³å®šç‰ˆæœ¬ã€‚</p><h4 id="æœªåˆå§‹åŒ–çš„å­˜å‚¨æŒ‡é’ˆ">æœªåˆå§‹åŒ–çš„å­˜å‚¨æŒ‡é’ˆ</h4><p>EVMæ˜¯ç”¨å­˜å‚¨ï¼ˆstoraegeï¼‰æˆ–å†…å­˜ï¼ˆmemoryï¼‰æ¥ä¿å­˜æ•°æ®çš„ã€‚å‡½æ•°ä¸­è½­å±€éƒ¨å˜é‡é»˜è®¤åœ¨å­˜å‚¨ä¸­è¿˜æ˜¯åœ¨å†…å­˜ä¸­ï¼Œå–å†³äºä»–ä»¬çš„ç±»å‹ã€‚</p><p>// TODO å­˜å‚¨æŒ‡é’ˆè¿™ä¸€å—è¿˜æ²¡æœ‰ææ‡‚ï¼Œåç»­å†è¡¥å……ã€‚</p><h4 id="æµ®ç‚¹æ•°å’Œç²¾åº¦">æµ®ç‚¹æ•°å’Œç²¾åº¦</h4><p>ä¸‹é¢çš„åˆçº¦<code>buyTokens</code>æ–¹æ³•åœ¨æ”¯ä»˜çš„ä»¥å¤ªå¸å°äº1etheræ—¶ï¼Œå¾—åˆ°çš„tokenä¼šæ˜¯0ï¼›æˆ–è€…è¯´ä¼šæŠŠå°äº1etherçš„éƒ¨åˆ†å…¨éƒ¨èˆå»å¯¼è‡´å‡ºé”™ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0</span><br><span class="line"></span><br><span class="line">pragma solidity&#x3D;0.8.0;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract FunWithNumbers &#123;</span><br><span class="line">    </span><br><span class="line">    uint constant public tokensPerEth &#x3D; 10;</span><br><span class="line">    </span><br><span class="line">    uint constant public weiPerEth &#x3D; 1e18;</span><br><span class="line">    </span><br><span class="line">    mapping(address &#x3D;&gt; uint) public balances;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    function buyTokens() public payable &#123;</span><br><span class="line">        uint tokens &#x3D; msg.value &#x2F; weiPerEth * tokensPerEth;</span><br><span class="line">        balances[msg.sender] &#x3D; tokens;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function sellTokens(uint tokens) public &#123;</span><br><span class="line">        require(tokens &lt; balances[msg.sender]);</span><br><span class="line">        balances[msg.sender] -&#x3D;  tokens;</span><br><span class="line">        payable(msg.sender).transfer(tokens &#x2F; tokensPerEth * weiPerEth);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Tx-Origin">Tx.Origin</h4><p>é€šè¿‡<code>tx.origin</code>å˜é‡æ¥åˆ¤æ–­ç”¨æˆ·æˆæƒçš„åˆçº¦ä¸€èˆ¬æ˜¯æ˜“å—é’“é±¼æ”»å‡»çš„ï¼Œè¿™ç§æ”»å‡»æ˜¯é€šè¿‡æ¬ºéª—ç”¨æˆ·å‘æœ‰æ¼æ´çš„åˆçº¦å‘é€éœ€è¦æˆæƒçš„æ“ä½œæ¥å®ç°çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0</span><br><span class="line"></span><br><span class="line">pragma solidity &#x3D; 0.8.0;</span><br><span class="line"></span><br><span class="line">contract Phishable &#123;</span><br><span class="line">    </span><br><span class="line">    address public owner;</span><br><span class="line">    </span><br><span class="line">    constructor () &#123;</span><br><span class="line">        owner &#x3D; msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    receive() external payable&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function withdrawAll(address _recipient) public &#123;</span><br><span class="line">        require(tx.origin &#x3D;&#x3D; owner);</span><br><span class="line">        payable(_recipient).transfer(address(this).balance);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”»å‡»åˆçº¦å¦‚ä¸‹,å¦‚æœæœ‰äººé€šè¿‡åšæ¸¸æˆç­‰æ–¹å¼è®©<code>Phishable</code>åˆçº¦çš„ownerç»™<code>AccackContract</code>åˆçº¦è½¬ä¸€å°éƒ¨åˆ†ä»¥å¤ªå¸ï¼Œé‚£ä¹ˆè¿™ä¸ªownerä¼šæŸå¤±<code>Phishable</code>åˆçº¦ä¸­çš„æ‰€æœ‰ä»¥å¤ªå¸ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0</span><br><span class="line"></span><br><span class="line">pragma solidity &#x3D; 0.8.0;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import &quot;Phishable.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract AccackContract &#123;</span><br><span class="line"></span><br><span class="line">    Phishable phishableContract;</span><br><span class="line">    </span><br><span class="line">    address attacker;</span><br><span class="line">    </span><br><span class="line">    constructor(Phishable _phishableContract, address _attackerAddress) &#123;</span><br><span class="line">        phishableContract &#x3D; _phishableContract;</span><br><span class="line">        attacker &#x3D; _attackerAddress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    fallback() external payable &#123;</span><br><span class="line">        phishableContract.withdrawAll(_attackerAddress);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="é˜²èŒƒæŠ€æœ¯-v14">é˜²èŒƒæŠ€æœ¯</h5><p>æ™ºèƒ½åˆçº¦ä¸­ä¸åº”è¯¥ä½¿ç”¨<code>tx.origin</code>æ¥è¿›è¡ŒéªŒè¯æˆæƒã€‚</p><p><code>tx.origin</code>çš„ä½¿ç”¨åœºæ™¯ï¼šå¦‚æœæŸäººæƒ³è¦æ‹’ç»å¤–éƒ¨åˆçº¦è°ƒç”¨å½“å‰åˆçº¦ï¼Œä»–ä»¬å¯ä»¥å®ç°ä¸€ä¸ªç±»ä¼¼<code>require(tx.origin == msg.sender);</code>è¿™æ ·çš„æ£€æŸ¥ï¼›è¿™æ ·å¯ä»¥é˜²æ­¢å½“å‰åˆçº¦è¢«å…¶ä»–ä¸­é—´åˆçº¦è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯ä»…å…è®¸å¤–éƒ¨è´¦æˆ·è°ƒç”¨å½“å‰åˆçº¦ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> ethereum </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> ethereum </tag>
            
            <tag> æ™ºèƒ½åˆçº¦ </tag>
            
            <tag> solidity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»¥å¤ªåŠä½¿ç”¨MetaMaské’±åŒ…å‘èµ·äº¤æ˜“</title>
      <link href="2021/04/01/blockchain/eth/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%BD%BF%E7%94%A8MetaMask%E9%92%B1%E5%8C%85%E5%8F%91%E8%B5%B7%E4%BA%A4%E6%98%93/"/>
      <url>2021/04/01/blockchain/eth/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%BD%BF%E7%94%A8MetaMask%E9%92%B1%E5%8C%85%E5%8F%91%E8%B5%B7%E4%BA%A4%E6%98%93/</url>
      
        <content type="html"><![CDATA[<h3 id="é’±åŒ…è½¯ä»¶">é’±åŒ…è½¯ä»¶</h3><p><a href="https://chrome.google.com/webstore/detail/metamask/nkbihfbeogaeaoehlefnkodbefgpgknn">MetaMask</a>ï¼šå¯ä»¥é“¾æ¥æµ‹è¯•ç½‘ç»œrinkebyï¼Œç„¶ååœ¨<a href="https://faucet.ropsten.be/">ropsten</a>ï¼Œ<a href="https://www.rinkeby.io/#stats">rinkeby</a>è·å–ç›¸åº”çš„æµ‹è¯•ä»¥å¤ªå¸ã€‚</p><h3 id="å‘èµ·äº¤æ˜“">å‘èµ·äº¤æ˜“</h3><p>å‘èµ·äº¤æ˜“å’Œæ™®é€šçš„é“¶è¡Œè½¬å¸ä¸€æ ·ï¼Œéœ€è¦æŒ‡å®šåœ°å€ï¼ˆé“¶è¡Œè´¦æˆ·ï¼‰å’Œè½¬è´¦æ•°é¢ï¼›äº¤æ˜“æ—¶ä¼šæœ‰æ‰‹ç»­è´¹ï¼ˆGas Feeï¼‰ï¼Œé’±åŒ…ä¼šæ˜¾ç¤ºå½“å‰çš„ä»·æ ¼ï¼Œè‡ªå·±å¯ä»¥è®¾ç½®Gas Feeçš„ä¸Šé™ã€‚</p><img src="https://gitee.com/guozhe001/images/raw/master/image-20210309144213914.png" alt="image-20210309144213914" style="zoom: 33%;"><h3 id="äº¤æ˜“çš„ç»“æ„">äº¤æ˜“çš„ç»“æ„</h3><p>å¯ä»¥åœ¨https://ropsten.etherscan.io/æˆ–è€…https://www.rinkeby.io/#exploreræŸ¥çœ‹äº¤æ˜“è¯¦æƒ…ã€‚</p><p>å¥½ç©çš„æ˜¯ï¼Œå¯ä»¥è‡ªå·±ç»™è‡ªå·±è½¬è´¦ï¼Œå¦‚ä¸‹æ˜¯æˆ‘è‡ªå·±çš„æµ‹è¯•è´¦æˆ·ç»™è‡ªå·±è½¬è´¦çš„äº¤æ˜“æˆªå›¾ã€‚ï¼ˆ<em>WARNï¼šè¯·å‹¿ç»™æˆªå›¾ä¸­çš„åœ°å€è½¬è´¦ï¼Œè¿™æ˜¯æµ‹è¯•è´¦å·</em>ï¼‰ï¼š</p><img src="https://gitee.com/guozhe001/images/raw/master/image-20210309145016136.png" alt="image-20210309145016136" style="zoom: 33%;"><p>éœ€è¦è¯´æ˜çš„åªæœ‰Nonceé‚£ä¸€è¡Œï¼š</p><ul><li>Nonceï¼š è¡¨ç¤ºçš„æ˜¯å½“å‰çš„è´¦æˆ·çš„ç¬¬ä¸€æ¬¡äº¤æ˜“ï¼Œæˆªå›¾çš„1è¡¨ç¤ºæ˜¯ç¬¬äºŒä¸ªäº¤æ˜“ï¼ˆäº¤æ˜“åºå·ä»0å¼€å§‹ï¼‰</li><li>Positionï¼šè¡¨ç¤ºå½“å‰çš„äº¤æ˜“åœ¨åŒºå—ä¸­çš„åºå·ã€‚</li></ul><h3 id="åŒºå—ä¸­çš„äº¤æ˜“åˆ—è¡¨">åŒºå—ä¸­çš„äº¤æ˜“åˆ—è¡¨</h3><img src="https://gitee.com/guozhe001/images/raw/master/image-20210309145647419.png" alt="image-20210309145647419" style="zoom:33%;"><h3 id="åŒºå—çš„ç»“æ„">åŒºå—çš„ç»“æ„</h3><p><img src="https://gitee.com/guozhe001/images/raw/master/image-20210309145918512.png" alt="image-20210309145918512"></p><h2 id></h2>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> ethereum </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> ethereum </tag>
            
            <tag> MetaMask </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»¥å¤ªåŠå­¦ä¹ ä¸å®è·µ</title>
      <link href="2021/04/01/blockchain/eth/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%B8%AD%E7%9A%84token/"/>
      <url>2021/04/01/blockchain/eth/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%B8%AD%E7%9A%84token/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯TOKENï¼ˆä»£å¸ï¼‰">ä»€ä¹ˆæ˜¯TOKENï¼ˆä»£å¸ï¼‰</h2><ul><li>é€šå¸¸æ˜¯æŒ‡ç§äººå‘è¡Œçš„ï¼Œç±»ä¼¼ç¡¬å¸å½¢çŠ¶çš„ç‰©ä½“ï¼Œå…·å¤‡å°‘é‡ä»·å€¼ï¼›å¦‚æ¸¸æˆå¸</li><li>ä»¥å¤ªåŠä¸Šçš„ä»£å¸æ˜¯æŒ‡åŸºäºåŒºå—é“¾çš„ä¸€ç§æŠ½è±¡çš„èµ„äº§ï¼Œå¯ä»¥è¢«æŒæœ‰å¹¶ä¸”ç”¨æ¥ä»£è¡¨èµ„äº§ã€ç°é‡‘ç­‰</li></ul><h2 id="ä»£å¸æœ‰å“ªäº›ä½¿ç”¨æ–¹å¼">ä»£å¸æœ‰å“ªäº›ä½¿ç”¨æ–¹å¼</h2><ul><li>è´§å¸</li><li>èµ„äº§</li><li>è®¿é—®æƒé™</li><li>æƒç›Šï¼ˆè‚¡ä¸œæƒç›Šï¼‰</li><li>æŠ•ç¥¨æƒ</li><li>æ”¶è—å“</li><li>èº«ä»½</li><li>ã€‚ã€‚ã€‚</li></ul><h2 id="ä»£å¸æ ‡å‡†">ä»£å¸æ ‡å‡†</h2><h3 id="ERC20">ERC20</h3><ul><li><a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md">ERC20</a>æ¥å£å®šä¹‰</li><li>ERC20-<a href="https://github.com/OpenZeppelin/openzeppelin-solidity/blob/9b3710465583284b8c4c5d2245749246bb2e0094/contracts/token/ERC20/ERC20.sol">OpenZeppelin implementation</a></li><li>ERC20-<a href="https://github.com/ConsenSys/Tokens/blob/fdf687c69d998266a95f15216b1955a4965a0a6d/contracts/eip20/EIP20.sol">ConsenSys implementation</a></li></ul><p>ERC20æ˜¯ä¸€ä¸ªtokenæ ‡å‡†ï¼Œä½“ç°åˆ°åˆçº¦ä¸Šæ˜¯ä¸€ä¸ªæ¥å£è§„èŒƒã€‚æ¥å£å¦‚ä¸‹ï¼ˆä¸åŒç¼–è¯‘ç‰ˆæœ¬çš„solidityçš„æ¥å£å¯èƒ½è¯­æ³•ä¸ä¸€æ ·ï¼Œä½†æ˜¯æè¿°çš„æ˜¯ä¸€æ ·çš„ï¼‰ï¼š</p><h4 id="æˆ‘çš„0-8-0ç‰ˆæœ¬æ¥å£å®šä¹‰ï¼š">æˆ‘çš„0.8.0ç‰ˆæœ¬æ¥å£å®šä¹‰ï¼š</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0</span><br><span class="line"></span><br><span class="line">pragma solidity&#x3D;0.8.0;</span><br><span class="line"></span><br><span class="line">interface ERC20Interface &#123;</span><br><span class="line"></span><br><span class="line">    function balanceOf(address _owner) external view returns (uint256 balance);</span><br><span class="line"></span><br><span class="line">    function transfer(address _to, uint256 _value) external returns (bool success);</span><br><span class="line"></span><br><span class="line">    function transferFrom(address _from, address _to, uint256 _value) external returns (bool success);</span><br><span class="line"></span><br><span class="line">    function approve(address _spender, uint256 _value) external returns (bool success);</span><br><span class="line"></span><br><span class="line">    function allowance(address _owner, address _spender) external view returns (uint256 remaining);</span><br><span class="line"></span><br><span class="line">    event Transfer(address indexed _from, address indexed _to, uint256 _value);</span><br><span class="line"></span><br><span class="line">    event Approval(address indexed _owner, address indexed _spender, uint256 _value);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ERC20-ConsenSyså®šä¹‰">ERC20-[ConsenSyså®šä¹‰]</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Abstract contract for the full ERC 20 Token standard</span><br><span class="line">&#x2F;&#x2F; https:&#x2F;&#x2F;github.com&#x2F;ethereum&#x2F;EIPs&#x2F;blob&#x2F;master&#x2F;EIPS&#x2F;eip-20.md</span><br><span class="line">pragma solidity ^0.4.21;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract EIP20Interface &#123;</span><br><span class="line">    &#x2F;* This is a slight change to the ERC20 base standard.</span><br><span class="line">    function totalSupply() constant returns (uint256 supply);</span><br><span class="line">    is replaced with:</span><br><span class="line">    uint256 public totalSupply;</span><br><span class="line">    This automatically creates a getter function for the totalSupply.</span><br><span class="line">    This is moved to the base contract since public getter functions are not</span><br><span class="line">    currently recognised as an implementation of the matching abstract</span><br><span class="line">    function by the compiler.</span><br><span class="line">    *&#x2F;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; total amount of tokens</span><br><span class="line">    uint256 public totalSupply;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;&#x2F; @param _owner The address from which the balance will be retrieved</span><br><span class="line">    &#x2F;&#x2F;&#x2F; @return The balance</span><br><span class="line">    function balanceOf(address _owner) public view returns (uint256 balance);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;&#x2F; @notice send &#96;_value&#96; token to &#96;_to&#96; from &#96;msg.sender&#96;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; @param _to The address of the recipient</span><br><span class="line">    &#x2F;&#x2F;&#x2F; @param _value The amount of token to be transferred</span><br><span class="line">    &#x2F;&#x2F;&#x2F; @return Whether the transfer was successful or not</span><br><span class="line">    function transfer(address _to, uint256 _value) public returns (bool success);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;&#x2F; @notice send &#96;_value&#96; token to &#96;_to&#96; from &#96;_from&#96; on the condition it is approved by &#96;_from&#96;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; @param _from The address of the sender</span><br><span class="line">    &#x2F;&#x2F;&#x2F; @param _to The address of the recipient</span><br><span class="line">    &#x2F;&#x2F;&#x2F; @param _value The amount of token to be transferred</span><br><span class="line">    &#x2F;&#x2F;&#x2F; @return Whether the transfer was successful or not</span><br><span class="line">    function transferFrom(address _from, address _to, uint256 _value) public returns (bool success);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;&#x2F; @notice &#96;msg.sender&#96; approves &#96;_spender&#96; to spend &#96;_value&#96; tokens</span><br><span class="line">    &#x2F;&#x2F;&#x2F; @param _spender The address of the account able to transfer the tokens</span><br><span class="line">    &#x2F;&#x2F;&#x2F; @param _value The amount of tokens to be approved for transfer</span><br><span class="line">    &#x2F;&#x2F;&#x2F; @return Whether the approval was successful or not</span><br><span class="line">    function approve(address _spender, uint256 _value) public returns (bool success);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;&#x2F; @param _owner The address of the account owning tokens</span><br><span class="line">    &#x2F;&#x2F;&#x2F; @param _spender The address of the account able to transfer the tokens</span><br><span class="line">    &#x2F;&#x2F;&#x2F; @return Amount of remaining tokens allowed to spent</span><br><span class="line">    function allowance(address _owner, address _spender) public view returns (uint256 remaining);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; solhint-disable-next-line no-simple-event-func-name</span><br><span class="line">    event Transfer(address indexed _from, address indexed _to, uint256 _value);</span><br><span class="line">    event Approval(address indexed _owner, address indexed _spender, uint256 _value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ERC721"><a href="https://eips.ethereum.org/EIPS/eip-721">ERC721</a></h3><p>ERC721æ˜¯NFTï¼ˆNon-Fungible Tokenï¼‰çš„æ ‡å‡†ã€‚ç›´æ¥çœ‹å®˜æ–¹æ¥å£å®šä¹‰<a href="https://eips.ethereum.org/EIPS/eip-721">ERC721</a>å’Œ<a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC721/ERC721.sol">openzeppelinçš„å®ç°</a></p><h3 id="ERC777"><a href="https://eips.ethereum.org/EIPS/eip-777">ERC777</a></h3><pre><code>ä¸€ç§å…¼å®¹ERC20çš„ä»£å¸æ ‡å‡†ï¼Œè¿™ä¸ªæ ‡å‡†åœ¨è½¬è´¦çš„æ—¶å€™ä¼šæ£€æŸ¥æ¥æ”¶æ–¹æ”¯ä¸æ”¯æŒæ¥æ”¶å½“å‰ä»£å¸ï¼ˆå³æœ‰æ²¡æœ‰å®ç°æŸä¸ªæ¥å£ï¼‰ï¼›å¦‚æœæ²¡æœ‰å®ç°è½¬è´¦ä¼šå¤±è´¥ï¼Œè¿™å¯ä»¥é˜²æ­¢ä»£å¸è½¬å…¥ä¸€ä¸ªä¸æ”¯æŒçš„åˆçº¦ä¸­</code></pre>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> ethereum </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> ethereum </tag>
            
            <tag> token </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NFTåˆçº¦HashMaskæ™ºèƒ½åˆçº¦ä»£ç å­¦ä¹ </title>
      <link href="2021/04/01/blockchain/eth/NFT%E5%90%88%E7%BA%A6HashMask%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E4%BB%A3%E7%A0%81%E5%AD%A6%E4%B9%A0/"/>
      <url>2021/04/01/blockchain/eth/NFT%E5%90%88%E7%BA%A6HashMask%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E4%BB%A3%E7%A0%81%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="HashMask"><a href="https://www.thehashmasks.com/">HashMask</a></h1><h2 id="Verified-Smart-Contracts">Verified Smart Contracts</h2><p><strong>Hashmasks Contract:</strong> <a href="https://etherscan.io/address/0xc2c747e0f7004f9e8817db2ca4997657a7746928">0xc2c747e0f7004f9e8817db2ca4997657a7746928</a></p><p><strong>NameChangeToken Contract:</strong> <a href="https://etherscan.io/address/0x8a9c4dfe8b9d8962b31e4e16f8321c44d48e246e">0x8a9c4dfe8b9d8962b31e4e16f8321c44d48e246e</a></p><p><strong>Hashmasks Registry Contract:</strong> <a href="https://etherscan.io/address/0x185c8078285a3de3ec9a2c203ad12853f03c462d">0x185c8078285a3de3ec9a2c203ad12853f03c462d</a></p><p><strong>Hashmasks Datastore Contract:</strong> <a href="https://etherscan.io/address/0x7327DbF06b1FcB0D190533fDD244B52361f0d241">0x7327DbF06b1FcB0D190533fDD244B52361f0d241</a></p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> ethereum </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> ethereum </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•å¼€å‘ä¸€ä¸ªCorDapp</title>
      <link href="2021/04/01/blockchain/3%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AACorDapp/"/>
      <url>2021/04/01/blockchain/3%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AACorDapp/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡</h1><ul><li>JDKï¼ˆ8u131ä»¥ä¸Šï¼‰</li></ul><h2 id="cordaè®­ç»ƒè¥">cordaè®­ç»ƒè¥</h2><h3 id="ä»£ç åœ°å€ï¼š">ä»£ç åœ°å€ï¼š</h3><p><a href="https://github.com/corda/bootcamp-cordapp">https://github.com/corda/bootcamp-cordapp</a></p><p>ä¸ªäººgiteeé¡¹ç›®ï¼š<a href="https://gitee.com/zheshiyigegexingwangzhan/bootcamp-cordapp.git">https://gitee.com/zheshiyigegexingwangzhan/bootcamp-cordapp.git</a></p><h3 id="æ·»åŠ å›½å†…é•œåƒ">æ·»åŠ å›½å†…é•œåƒ</h3><h4 id="å½“å‰é¡¹ç›®ä¿®æ”¹">å½“å‰é¡¹ç›®ä¿®æ”¹</h4><p>ä¸‹è½½ä»£ç ä¹‹åä¸ºäº†æ›´å¿«çš„ä¸‹è½½ä¾èµ–ï¼Œæ·»åŠ å›½å†…çš„é•œåƒï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maven &#123; url &#39;http:&#x2F;&#x2F;maven.aliyun.com&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&#x2F;&#39;&#125;</span><br></pre></td></tr></table></figure><h4 id="ç›´æ¥ä¿®æ”¹å…¨å±€çš„gradleé…ç½®">ç›´æ¥ä¿®æ”¹å…¨å±€çš„gradleé…ç½®</h4><p>åœ¨**~/.gradle<strong>ç›®å½•ä¸‹æ–°å»º</strong>init.gradle**æ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">allprojects&#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        def ALIYUN_REPOSITORY_URL &#x3D; &#39;http:&#x2F;&#x2F;maven.aliyun.com&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&#39;</span><br><span class="line">        def ALIYUN_JCENTER_URL &#x3D; &#39;http:&#x2F;&#x2F;maven.aliyun.com&#x2F;nexus&#x2F;content&#x2F;repositories&#x2F;jcenter&#39;</span><br><span class="line">        all &#123; ArtifactRepository repo -&gt;</span><br><span class="line">            if(repo instanceof MavenArtifactRepository)&#123;</span><br><span class="line">                def url &#x3D; repo.url.toString()</span><br><span class="line">                if (url.startsWith(&#39;https:&#x2F;&#x2F;repo1.maven.org&#x2F;maven2&#39;)) &#123;</span><br><span class="line">                    project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_REPOSITORY_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">                if (url.startsWith(&#39;https:&#x2F;&#x2F;jcenter.bintray.com&#x2F;&#39;)) &#123;</span><br><span class="line">                    project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_JCENTER_URL.&quot;</span><br><span class="line">                    remove repo</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        maven &#123;</span><br><span class="line">            url ALIYUN_REPOSITORY_URL</span><br><span class="line">            url ALIYUN_JCENTER_URL</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•ä»£ç ">æµ‹è¯•ä»£ç </h3><p>è¿è¡ŒProjectImportedOKTestå•æµ‹ï¼Œå¦‚æœé€šè¿‡è¯´æ˜ç¯å¢ƒæ²¡æœ‰é—®é¢˜</p><p>æˆ‘çš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; Configure project :</span><br><span class="line">Repository https:&#x2F;&#x2F;jcenter.bintray.com&#x2F; replaced by http:&#x2F;&#x2F;maven.aliyun.com&#x2F;nexus&#x2F;content&#x2F;repositories&#x2F;jcenter.</span><br><span class="line">&gt; Task :compileJava</span><br><span class="line">&gt; Task :processResources NO-SOURCE</span><br><span class="line">&gt; Task :classes</span><br><span class="line">&gt; Task :compileTestJava</span><br><span class="line">&gt; Task :processTestResources NO-SOURCE</span><br><span class="line">&gt; Task :testClasses</span><br><span class="line">&gt; Task :test</span><br></pre></td></tr></table></figure><h1 id="ä»£ç å¼€å‘">ä»£ç å¼€å‘</h1><h2 id="Stateå¼€å‘">Stateå¼€å‘</h2><p>ä¸€ä¸ªstateéœ€è¦å®ç°ContractStateï¼ŒContractStateä¸­æœ‰ä¸€ä¸ªæ–¹æ³•<code>getParticipants()</code>ï¼Œè¿”å›çš„æ˜¯<code>List&lt;AbstractParty&gt;</code>,è¡¨ç¤ºåœ¨è¿™ä¸ªstateå‘ç”Ÿäº†äº¤æ˜“æ—¶éœ€è¦é€šçŸ¥è°ï¼Œè®©è°çŸ¥é“ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bootcamp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.ImmutableList;</span><br><span class="line"><span class="keyword">import</span> net.corda.core.contracts.ContractState;</span><br><span class="line"><span class="keyword">import</span> net.corda.core.identity.AbstractParty;</span><br><span class="line"><span class="keyword">import</span> net.corda.core.identity.Party;</span><br><span class="line"><span class="keyword">import</span> org.jetbrains.annotations.NotNull;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IouState</span> <span class="keyword">implements</span> <span class="title">ContractState</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘è¡Œäºº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Party issuer;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‹¥æœ‰è€…</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Party owner;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‡‘é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> amount;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">IouState</span><span class="params">(Party issuer, Party owner, <span class="keyword">int</span> amount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.issuer = issuer;</span><br><span class="line">        <span class="keyword">this</span>.owner = owner;</span><br><span class="line">        <span class="keyword">this</span>.amount = amount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;AbstractParty&gt; <span class="title">getParticipants</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ImmutableList.of(issuer, owner);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Party <span class="title">getIssuer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> issuer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Party <span class="title">getOwner</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> owner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAmount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> amount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Contractå¼€å‘">Contractå¼€å‘</h2><p>ä¸€ä¸ªcontractç®€å•çš„ç†è§£å°±æ˜¯ä¸€äº›æ ¡éªŒçš„è§„åˆ™ï¼Œéœ€è¦å®ç°<code>Contract</code>ç±»ï¼Œ<code>Contract</code>ç±»å¦‚ä¸‹ï¼Œåªæœ‰ä¸€ä¸ª<code>verify</code>æ–¹æ³•ï¼ŒéªŒè¯<code>LedgerTransaction</code>æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœä¸æ­£ç¡®å°±æŠ›<code>IllegalArgumentException</code>å¼‚å¸¸ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Contract</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Takes an object that represents a state transition, and ensures the inputs/outputs/commands make sense.</span></span><br><span class="line"><span class="comment">     * Must throw an exception if there&#x27;s a problem that should prevent state transition. Takes a single object</span></span><br><span class="line"><span class="comment">     * rather than an argument so that additional data can be added without breaking binary compatibility with</span></span><br><span class="line"><span class="comment">     * existing contract code.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Throws(IllegalArgumentException::class)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">verify</span><span class="params">(tx: <span class="type">LedgerTransaction</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å¼€å‘ä¸€ä¸ªcontractæ—¶ï¼ŒCordaæè®®çš„ä¸‰ä¸ªéªŒè¯çš„ç±»å‹ï¼š</p><ul><li>è¾“å…¥ä¸è¾“å‡ºä¸ªæ•°çš„æ ¡éªŒï¼ˆShape Constraintï¼ŒNo. input states, No. output states, commandï¼‰</li><li>è¾“å…¥ä¸è¾“å‡ºçš„å†…å®¹çš„æ ¡éªŒï¼ˆContext Constraintï¼‰ï¼Œä¸šåŠ¡æ ¡éªŒ</li><li>éœ€è¦çš„ç­¾åçš„æ ¡éªŒï¼ˆRequired Singer Constraintï¼‰</li></ul><p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/image-20201202115747238.png" alt="image-20201202115747238"></p><p>æŒ‰ç…§ä¸Šå›¾çš„è§„åˆ™IouContractçš„å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bootcamp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> net.corda.core.contracts.Command;</span><br><span class="line"><span class="keyword">import</span> net.corda.core.contracts.CommandData;</span><br><span class="line"><span class="keyword">import</span> net.corda.core.contracts.Contract;</span><br><span class="line"><span class="keyword">import</span> net.corda.core.contracts.ContractState;</span><br><span class="line"><span class="keyword">import</span> net.corda.core.transactions.LedgerTransaction;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.CollectionUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IouContract</span> <span class="keyword">implements</span> <span class="title">Contract</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String ID = <span class="string">&quot;bootcamp.IouContract&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">verify</span><span class="params">(LedgerTransaction tx)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1ã€Shape Constraintï¼ŒNo. input states, No. output states, command</span></span><br><span class="line">        <span class="keyword">if</span> (tx.getCommands().size() != <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;command size must be one&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Command&lt;CommandData&gt; command = tx.getCommand(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> (!(command.getValue() <span class="keyword">instanceof</span> Commands.Issue)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;command must be Issue&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isNotEmpty(tx.getInputs())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Issue must be not inputs&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (tx.getOutputs().size() != <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Issue outputs must be one&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ContractState output = tx.getOutput(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 2ã€Context Constraint</span></span><br><span class="line">        <span class="keyword">if</span> (!(output <span class="keyword">instanceof</span> IouState)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;state must be IouState&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        IouState iouState = (IouState) output;</span><br><span class="line">        <span class="keyword">if</span> (iouState.getAmount() &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;issue amount must big than zero&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3ã€Required Singer Constraint</span></span><br><span class="line">        <span class="keyword">if</span> (!command.getSigners().contains(iouState.getIssuer().getOwningKey())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;issue business must be sing by issuer&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Commands</span> <span class="keyword">extends</span> <span class="title">CommandData</span> </span>&#123;</span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Issue</span> <span class="keyword">implements</span> <span class="title">Commands</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Flowå¼€å‘">Flowå¼€å‘</h2><p>flowæœ‰ä¸¤ç§</p><ul><li>å¯ä»¥åœ¨æœ¬åœ°ä¸»åŠ¨å¯åŠ¨çš„flow</li><li>åªèƒ½é€šè¿‡å…¶ä»–çš„flowå¯åŠ¨çš„flow</li></ul><p>å‘èµ·ä¸€ä¸ªäº¤æ˜“çš„flowéƒ½æ˜¯å¯ä»¥åœ¨æœ¬åœ°ä¸»åŠ¨å¯åŠ¨çš„flowï¼Œæœ‰ä»¥ä¸‹ç‰¹ç‚¹</p><ul><li>éœ€è¦æ·»åŠ æ³¨è§£<code>@InitiatingFlow</code>æ¥è¡¨ç¤ºä»–æ˜¯ä¸€ä¸ªå¯ä»¥åˆå§‹åŒ–çš„flow</li><li>éœ€è¦æ·»åŠ æ³¨<code>@StartableByRPC</code>æˆ–è€…<code>@StartableByService</code>æ¥è¯´æ˜å¯åŠ¨çš„æ–¹å¼</li><li>flowéœ€è¦ç»§æ‰¿è‡ª<code>FlowLogic</code>ï¼Œä¸šåŠ¡é€»è¾‘åœ¨callæ–¹æ³•ä¸­å®ç°</li><li>callæ–¹æ³•éœ€è¦æ·»åŠ <code>@Suspendable</code>æ³¨è§£</li><li>æŒ‡å®šnotaryï¼Œæ ¡éªŒæ˜¯å¦åŒèŠ±</li><li>åˆ›å»ºäº¤æ˜“ï¼Œäº¤æ˜“ä¸­å¿…é¡»åŒ…å«commandï¼Œå¦‚æœæœ‰outputå¿…é¡»æŒ‡å®šcontractæ¥è¿›è¡ŒéªŒè¯ï¼›å¯ä»¥æ²¡æœ‰input</li><li>ç„¶åå°±æ˜¯é€šç”¨çš„æµç¨‹ï¼ŒéªŒè¯äº¤æ˜“ã€æ”¶é›†ç­¾åã€äº¤æ˜“å…¥åº“</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bootcamp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> co.paralleluniverse.fibers.Suspendable;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.ImmutableList;</span><br><span class="line"><span class="keyword">import</span> net.corda.core.contracts.StateAndRef;</span><br><span class="line"><span class="keyword">import</span> net.corda.core.flows.*;</span><br><span class="line"><span class="keyword">import</span> net.corda.core.identity.Party;</span><br><span class="line"><span class="keyword">import</span> net.corda.core.transactions.SignedTransaction;</span><br><span class="line"><span class="keyword">import</span> net.corda.core.transactions.TransactionBuilder;</span><br><span class="line"><span class="keyword">import</span> net.corda.core.utilities.ProgressTracker;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.util.Collections.singletonList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> nicai</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@InitiatingFlow</span></span><br><span class="line"><span class="meta">@StartableByRPC</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IouIssueFlowInitiator</span> <span class="keyword">extends</span> <span class="title">FlowLogic</span>&lt;<span class="title">SignedTransaction</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Party owner;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> amount;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">IouIssueFlowInitiator</span><span class="params">(Party owner, <span class="keyword">int</span> amount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.owner = owner;</span><br><span class="line">        <span class="keyword">this</span>.amount = amount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ProgressTracker progressTracker = <span class="keyword">new</span> ProgressTracker();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ProgressTracker <span class="title">getProgressTracker</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> progressTracker;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Suspendable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SignedTransaction <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> FlowException </span>&#123;</span><br><span class="line">        <span class="comment">// We choose our transaction&#x27;s notary (the notary prevents double-spends).</span></span><br><span class="line">        Party notary = getServiceHub().getNetworkMapCache().getNotaryIdentities().get(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// We get a reference to our own identity.</span></span><br><span class="line">        Party issuer = getOurIdentity();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// We create our new IouState.</span></span><br><span class="line">        IouState iouState = <span class="keyword">new</span> IouState(issuer, owner, amount);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// We build our transaction.</span></span><br><span class="line">        TransactionBuilder transactionBuilder = <span class="keyword">new</span> TransactionBuilder(notary)</span><br><span class="line"><span class="comment">//                .addInputState()</span></span><br><span class="line">                .addOutputState(iouState, IouContract.ID)</span><br><span class="line">                .addCommand(<span class="keyword">new</span> IouContract.Commands.Issue(), ImmutableList.of(issuer.getOwningKey(), owner.getOwningKey()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// We check our transaction is valid based on its contracts.</span></span><br><span class="line">        transactionBuilder.verify(getServiceHub());</span><br><span class="line"></span><br><span class="line">        FlowSession session = initiateFlow(owner);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// We sign the transaction with our private key, making it immutable.</span></span><br><span class="line">        SignedTransaction signedTransaction = getServiceHub().signInitialTransaction(transactionBuilder);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The counterparty signs the transaction</span></span><br><span class="line">        SignedTransaction fullySignedTransaction = subFlow(<span class="keyword">new</span> CollectSignaturesFlow(signedTransaction, singletonList(session)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// We get the transaction notarised and recorded automatically by the platform.</span></span><br><span class="line">        <span class="keyword">return</span> subFlow(<span class="keyword">new</span> FinalityFlow(fullySignedTransaction, singletonList(session)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¢«åŠ¨å¯åŠ¨çš„flowæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>éœ€è¦æ³¨è§£<code>@InitiatedBy(IouIssueFlowInitiator.class)</code>æŒ‡å®šè°èƒ½å¯åŠ¨è¿™ä¸ªflow</li><li>flowéœ€è¦ç»§æ‰¿è‡ª<code>FlowLogic</code>ï¼Œä¸šåŠ¡é€»è¾‘åœ¨callæ–¹æ³•ä¸­å®ç°</li><li>callæ–¹æ³•éœ€è¦æ·»åŠ <code>@Suspendable</code>æ³¨è§£</li><li>éœ€è¦æœ‰å®ä¾‹å˜é‡FlowSessionï¼Œä¿å­˜è°ƒç”¨è€…çš„FlowSession</li><li>callæ–¹æ³•éœ€è¦éªŒè¯äº¤æ˜“ï¼Œç„¶åæ‰§è¡Œæ¥æ”¶äº¤æ˜“çš„æ ‡å‡†æµç¨‹<code>ReceiveFinalityFlow</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bootcamp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> co.paralleluniverse.fibers.Suspendable;</span><br><span class="line"><span class="keyword">import</span> net.corda.core.flows.*;</span><br><span class="line"><span class="keyword">import</span> net.corda.core.transactions.SignedTransaction;</span><br><span class="line"></span><br><span class="line"><span class="meta">@InitiatedBy(IouIssueFlowInitiator.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IouIssueFlowResponder</span> <span class="keyword">extends</span> <span class="title">FlowLogic</span>&lt;<span class="title">Void</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> FlowSession otherSide;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">IouIssueFlowResponder</span><span class="params">(FlowSession otherSide)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.otherSide = otherSide;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Suspendable</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Void <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> FlowException </span>&#123;</span><br><span class="line">        SignedTransaction signedTransaction = subFlow(<span class="keyword">new</span> SignTransactionFlow(otherSide) &#123;</span><br><span class="line">            <span class="meta">@Suspendable</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">checkTransaction</span><span class="params">(SignedTransaction stx)</span> <span class="keyword">throws</span> FlowException </span>&#123;</span><br><span class="line">                <span class="comment">// Implement responder flow transaction checks here</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        subFlow(<span class="keyword">new</span> ReceiveFinalityFlow(otherSide, signedTransaction.getId()));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¿è¡Œ">è¿è¡Œ</h2><h3 id="æ‰“åŒ…">æ‰“åŒ…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew deployNodes</span><br></pre></td></tr></table></figure><h3 id="è¿è¡Œæ‰€æœ‰çš„èŠ‚ç‚¹">è¿è¡Œæ‰€æœ‰çš„èŠ‚ç‚¹</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./build/nodes/runnodes</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨ä¸€ä¸ªæµç¨‹">å¯åŠ¨ä¸€ä¸ªæµç¨‹</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flow start IouIssueFlow owner: PartyB, amount: 99</span><br></pre></td></tr></table></figure><p>æˆ‘æœ¬åœ°æ—¥å¿—å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> âœ…   Starting</span><br><span class="line">          Requesting signature by notary service</span><br><span class="line">              Requesting signature by Notary service</span><br><span class="line">              Validating response from Notary service</span><br><span class="line">     âœ…   Broadcasting transaction to participants</span><br><span class="line">â¡ï¸   Done</span><br><span class="line">Flow completed with result: SignedTransaction(id=14D268667D208D26BF92ADC1F58003DFC9EAF7E036ACB2C2CABC153E627500C0)</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢ç”Ÿæˆçš„æ•°æ®">æŸ¥è¯¢ç”Ÿæˆçš„æ•°æ®</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run vaultQuery contractStateType: bootcamp.IouState</span><br></pre></td></tr></table></figure><p>æˆ‘æœ¬åœ°çš„ç»“æœå¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">states:</span><br><span class="line">- state:</span><br><span class="line">    data: !&lt;bootcamp.IouState&gt;</span><br><span class="line">      issuer: &quot;O=PartyA, L=London, C=GB&quot;</span><br><span class="line">      owner: &quot;O=PartyB, L=New York, C=US&quot;</span><br><span class="line">      amount: 99</span><br><span class="line">    contract: &quot;bootcamp.IouContract&quot;</span><br><span class="line">    notary: &quot;O=Notary, L=London, C=GB&quot;</span><br><span class="line">    encumbrance: null</span><br><span class="line">    constraint: !&lt;net.corda.core.contracts.SignatureAttachmentConstraint&gt;</span><br><span class="line">      key: &quot;aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTEw3G5d2maAq8vtLE4kZHgCs5jcB1N31cx1hpsLeqG2ngSysVHqcXhbNts6SkRWDaV7xNcr6MtcbufGUchxredBb6&quot;</span><br><span class="line">  ref:</span><br><span class="line">    txhash: &quot;14D268667D208D26BF92ADC1F58003DFC9EAF7E036ACB2C2CABC153E627500C0&quot;</span><br><span class="line">    index: 0</span><br><span class="line">statesMetadata:</span><br><span class="line">- ref:</span><br><span class="line">    txhash: &quot;14D268667D208D26BF92ADC1F58003DFC9EAF7E036ACB2C2CABC153E627500C0&quot;</span><br><span class="line">    index: 0</span><br><span class="line">  contractStateClassName: &quot;bootcamp.IouState&quot;</span><br><span class="line">  recordedTime: &quot;2020-12-03T09:49:48.373Z&quot;</span><br><span class="line">  consumedTime: null</span><br><span class="line">  status: &quot;UNCONSUMED&quot;</span><br><span class="line">  notary: &quot;O=Notary, L=London, C=GB&quot;</span><br><span class="line">  lockId: null</span><br><span class="line">  lockUpdateTime: null</span><br><span class="line">  relevancyStatus: &quot;RELEVANT&quot;</span><br><span class="line">  constraintInfo:</span><br><span class="line">    constraint:</span><br><span class="line">      key: &quot;aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTEw3G5d2maAq8vtLE4kZHgCs5jcB1N31cx1hpsLeqG2ngSysVHqcXhbNts6SkRWDaV7xNcr6MtcbufGUchxredBb6&quot;</span><br><span class="line">totalStatesAvailable: -1</span><br><span class="line">stateTypes: &quot;UNCONSUMED&quot;</span><br><span class="line">otherResults: []</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="èŠ‚ç‚¹å¯è§†åŒ–å·¥å…·">èŠ‚ç‚¹å¯è§†åŒ–å·¥å…·</h1><p>å‚è€ƒç½‘ç«™ï¼š<a href="https://docs.corda.net/docs/corda-os/4.6/node-explorer.html">https://docs.corda.net/docs/corda-os/4.6/node-explorer.html</a></p><p>å¯ä»¥ä¸‹è½½<a href="https://github.com/corda/node-explorer/releases">node-explorer</a>æ¥æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ã€‚</p><p>ç¬¬ä¸€æ¬¡æ‰“å¼€ç•Œé¢</p><p><img src="https://docs.corda.net/docs/corda-os/4.6/resources/node-explorer/node-explorer-ssh-login.png" alt="login"></p><ul><li>Node Hostnameï¼šlocalhost</li><li>Node Portï¼š<strong>RPC connection address</strong>å¯ä»¥åœ¨å¯åŠ¨çš„çª—å£æŸ¥çœ‹ï¼Œæˆ–è€…é…ç½®æ–‡ä»¶æŸ¥çœ‹</li><li>RPC Usernameï¼šåœ¨é…ç½®æ–‡ä»¶</li><li>RPC Password:åœ¨é…ç½®æ–‡ä»¶æŸ¥çœ‹</li></ul><p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/node-explorer-cl.png" alt="RPC connection address"></p><p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/image-20201207165759379.png" alt="image-20201207165759379"></p><p>ä½¿ç”¨springå¼€å‘cordaï¼š</p><p><a href="https://manosbatsis.github.io/corbeans/">https://manosbatsis.github.io/corbeans/</a></p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Corda </category>
          
          <category> CorDapp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Corda </tag>
            
            <tag> CorDapp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•æ­å»ºä¸€ä¸ªCordaç½‘ç»œ</title>
      <link href="2021/04/01/blockchain/4%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AACorda%E7%BD%91%E7%BB%9C/"/>
      <url>2021/04/01/blockchain/4%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AACorda%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<p>åœ¨æŸ¥çœ‹æ­¤æ–‡æ¡£ä¹‹å‰ï¼Œå…ˆæŸ¥çœ‹<a href="%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AACorDapp.md">å¦‚ä½•å¼€å‘ä¸€ä¸ªCorDapp</a></p><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://gitlab.com/cordite/network-map-service">NMS</a>çš„FAQ.mdæ–‡ä»¶</p><h3 id="1ã€ç½‘ç»œæœåŠ¡å¯åŠ¨ï¼Œdockerç‰ˆçš„ç½‘ç»œæœåŠ¡å¯åŠ¨ï¼š">1ã€ç½‘ç»œæœåŠ¡å¯åŠ¨ï¼Œdockerç‰ˆçš„ç½‘ç»œæœåŠ¡å¯åŠ¨ï¼š</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name=network-map -e NMS_ROOT_CA_FILE_PATH=&quot;&quot; -p 8080:8080 cordite/network-map:latest</span><br></pre></td></tr></table></figure><h3 id="2ã€å¯åŠ¨åæ‰“å¼€æ¥å£æ–‡æ¡£ç”¨äºéªŒè¯å¯åŠ¨æ˜¯å¦æˆåŠŸ">2ã€å¯åŠ¨åæ‰“å¼€æ¥å£æ–‡æ¡£ç”¨äºéªŒè¯å¯åŠ¨æ˜¯å¦æˆåŠŸ</h3><p><a href="http://localhost:8080/swagger/#/">http://localhost:8080/swagger/#/</a></p><p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/image-20201207175926945.png" alt="image-20201207175926945"></p><h3 id="3ã€buildå’Œé…ç½®CorDapp">3ã€buildå’Œé…ç½®CorDapp</h3><h4 id="buildä¹‹å‰ä¿®æ”¹build-gradleçš„é…ç½®ï¼Œä¿®æ”¹cordappèŠ‚ç‚¹ä¸ç»™cordappç­¾å">buildä¹‹å‰ä¿®æ”¹build.gradleçš„é…ç½®ï¼Œä¿®æ”¹cordappèŠ‚ç‚¹ä¸ç»™cordappç­¾å</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cordapp &#123;</span><br><span class="line">    signing &#123;</span><br><span class="line">        enabled <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å…¶ä»–é…ç½®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¿è¡Œbuildå‘½ä»¤">è¿è¡Œbuildå‘½ä»¤</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew clean deployNodes</span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹é…ç½®åˆ é™¤è‡ªåŠ¨ç”Ÿæˆçš„keyç­‰æ–‡ä»¶">ä¿®æ”¹é…ç½®åˆ é™¤è‡ªåŠ¨ç”Ÿæˆçš„keyç­‰æ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pushd build/nodes</span><br><span class="line">for N in */; do</span><br><span class="line">      echo &#x27;compatibilityZoneURL=&quot;http://localhost:8080&quot;&#x27; &gt;&gt; $N/node.conf</span><br><span class="line">      echo &#x27;devModeOptions.allowCompatibilityZone=true&#x27; &gt;&gt; $N/node.conf</span><br><span class="line">      pushd $N</span><br><span class="line">      rm -rf network-parameters nodeInfo-* persistence.mv.db certificates additional-node-infos</span><br><span class="line">      popd</span><br><span class="line">done</span><br><span class="line">popd</span><br></pre></td></tr></table></figure><h3 id="4ã€æŠŠèŠ‚ç‚¹æ³¨å†Œåˆ°ç½‘ç»œ">4ã€æŠŠèŠ‚ç‚¹æ³¨å†Œåˆ°ç½‘ç»œ</h3><p>ä¸‹è½½ç½‘ç»œçš„truststore</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://localhost:8080/network-map/truststore -o ~/tmp/network-truststore.jks</span><br></pre></td></tr></table></figure><p>æ¯ä¸ªèŠ‚ç‚¹éƒ½åˆå§‹åŒ–æ³¨å†Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pushd build/nodes</span><br><span class="line">for N in */; do</span><br><span class="line">      pushd $N</span><br><span class="line">      java -jar corda.jar --initial-registration --network-root-truststore ~/tmp/network-truststore.jks --network-root-truststore-password trustpass</span><br><span class="line">      popd</span><br><span class="line">done</span><br><span class="line">popd</span><br></pre></td></tr></table></figure><h3 id="5ã€æŒ‡å®šNotaryèŠ‚ç‚¹">5ã€æŒ‡å®šNotaryèŠ‚ç‚¹</h3><h4 id="å¯åŠ¨NotaryèŠ‚ç‚¹">å¯åŠ¨NotaryèŠ‚ç‚¹</h4><p>è¿›åˆ°NotaryèŠ‚ç‚¹çš„ç›®å½•ä¸‹æ‰§è¡Œ,å¦‚æœæ²¡æœ‰æƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar corda.jar</span><br></pre></td></tr></table></figure><p><em>æ³¨æ„ï¼šå¦‚æœæŠ¥é”™ï¼šUnable to create logging directory /Users/apple/code/open-source/blockchain/my-corda/logs. Node will now shutdown.è¯´æ˜æ²¡æœ‰æƒé™ï¼Œåœ¨å‘½ä»¤å‰åŠ sudoå³å¯</em></p><h4 id="æŒ‡å®šNotaryèŠ‚ç‚¹">æŒ‡å®šNotaryèŠ‚ç‚¹</h4><p>1ã€ç™»é™†NMSï¼ˆnetwork-map-serviceï¼‰å¹¶è·å–tokenä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TOKEN=`curl -X POST &quot;http://localhost:8080//admin/api/login&quot; -H  &quot;accept: text/plain&quot; -H  &quot;Content-Type: application/json&quot; -d &quot;&#123;  \&quot;user\&quot;: \&quot;sa\&quot;,  \&quot;password\&quot;: \&quot;admin\&quot;&#125;&quot;`</span><br></pre></td></tr></table></figure><p>2ã€ä¸Šä¼ notary</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pushd build/nodes/Notary</span><br><span class="line">NODEINFO=`ls nodeInfo*`</span><br><span class="line">curl -X POST -H &quot;Authorization: Bearer $TOKEN&quot; -H &quot;accept: text/plain&quot; -H &quot;Content-Type: application/octet-stream&quot; --data-binary @$NODEINFO http://localhost:8080//admin/api/notaries/validating</span><br><span class="line">popd</span><br></pre></td></tr></table></figure><p>åœ¨æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤æ—¶ï¼Œæ³¨æ„è‡ªå·±å½“å‰çš„æ‰€åœ¨çš„ç›®å½•ï¼Œå¦‚æœå·²ç»åœ¨build/nodes/Notaryç›®å½•ä¸‹éœ€è¦é€€å‡ºåˆ°bootcamp-cordappç›®å½•</p><h3 id="6ã€åœæ­¢NotaryèŠ‚ç‚¹">6ã€åœæ­¢NotaryèŠ‚ç‚¹</h3><p>åœ¨notaryèŠ‚ç‚¹çš„shellå‘½ä»¤è¡Œæ‰§è¡Œ <code>bye</code></p><h3 id="7ã€ä¿®æ”¹notaryèŠ‚ç‚¹çš„validating">7ã€ä¿®æ”¹notaryèŠ‚ç‚¹çš„validating</h3><p>å› ä¸ºåœ¨ç¬¬5æ­¥æŒ‡å®šNotaryçš„æ—¶å€™è°ƒç”¨çš„æ˜¯validatingæ¥å£ï¼Œæ‰€ä»¥ç¡®è®¤ä¸€ä¸‹notaryçš„é…ç½®æ˜¯çš„validatingæ˜¯å¦ä¸ºtrueï¼Œå¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">notary &#123;</span><br><span class="line">    validating&#x3D;true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœé…ç½®çš„æ˜¯<code>validating=false</code>åˆ™ä¼šæŠ¥å¼‚å¸¸ï¼š<br><code>[ERROR] 16:25:22+0800 [main] internal.NodeStartupLogging. - Exception during node startup: There is a discrepancy in the configured notary type and the one advertised in the network parameters - shutting down. Configured as validating: false. Advertised as validating: true [errorCode=r8le54, moreInformationAt=https://errors.corda.net/OS/4.3/r8le54]</code></p><h3 id="8ã€åˆ é™¤NotaryèŠ‚ç‚¹çš„network-parametersæ–‡ä»¶">8ã€åˆ é™¤NotaryèŠ‚ç‚¹çš„network-parametersæ–‡ä»¶</h3><p>è¿›å…¥åˆ°notaryèŠ‚ç‚¹çš„ç›®å½•ï¼Œåˆ é™¤<code>network-parameters</code>æ–‡ä»¶</p><h3 id="9ã€å¯åŠ¨notaryèŠ‚ç‚¹å’Œå…¶ä»–èŠ‚ç‚¹">9ã€å¯åŠ¨notaryèŠ‚ç‚¹å’Œå…¶ä»–èŠ‚ç‚¹</h3><p>è¿›å…¥åˆ°å„ä¸ªèŠ‚ç‚¹çš„ç›®å½•ï¼Œå¯åŠ¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar corda.jar</span><br></pre></td></tr></table></figure><h3 id="10ã€å‘èµ·äº¤æ˜“æµ‹è¯•">10ã€å‘èµ·äº¤æ˜“æµ‹è¯•</h3><p>å¯ä»¥ä¸‹è½½<a href="https://github.com/corda/node-explorer/releases">node-explorer</a>æ¥æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯å¹¶å‘èµ·äº¤æ˜“ï¼Œæˆ‘çš„æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/image-20201209165525748.png" alt="image-20201209165525748"></p><h3 id="æ‰©å±•">æ‰©å±•</h3><p>å› ä¸ºä¸Šé¢çš„æ–‡æ¡£æ˜¯æŒ‰ç…§</p>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Corda </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Corda </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cordaèµ„æ–™æ•´ç†</title>
      <link href="2021/04/01/blockchain/2%E5%8C%BA%E5%9D%97%E9%93%BE%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6-Corda%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/"/>
      <url>2021/04/01/blockchain/2%E5%8C%BA%E5%9D%97%E9%93%BE%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6-Corda%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="0-Cordaèµ„æ–™æ•´ç†">0. Cordaèµ„æ–™æ•´ç†</h1><p><a href="https://www.corda.net/">å®˜ç½‘</a><br><a href="https://www.youtube.com/channel/UCoOuUZatvIC1U65OisCrIKg">æ²¹ç®¡é¢‘é“</a><br><a href="https://cncorda.readthedocs.io/zh_CN/latest/">Cordaä¸­æ–‡æ–‡æ¡£</a><br><a href="https://docs.corda.net/">å¼€å‘æ–‡æ¡£</a><br><a href="https://cncorda.com/">Cordaä¸­æ–‡ç¤¾åŒº</a><br><a href="https://stackoverflow.com/questions/tagged/corda">Stack Overflowè®¨è®ºåŒº, cordaæ ‡ç­¾</a><br><a href="https://training.corda.net/">Corda Training</a></p><h1 id="1-Cordaæ˜¯ä»€ä¹ˆï¼Ÿ">1. Cordaæ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>Cordaæ˜¯ä¸ºä¼ä¸šæ„å»ºçš„å¼€æºåŒºå—é“¾/åˆ†å¸ƒå¼è´¦æœ¬å¸å¹³å°ï¼›Cordaä½¿ä¼ä¸šå¯ä»¥ä½¿ç”¨æ™ºèƒ½åˆçº¦åœ¨ä¸¥æ ¼çš„éšç§ä¸‹ç›´æ¥è¿›è¡Œäº¤æ˜“ï¼Œä»è€Œé™ä½äº¤æ˜“å’Œè®°å½•ä¿å­˜æˆæœ¬ï¼Œå¹¶ç®€åŒ–ä¸šåŠ¡è¿è¥ã€‚<br>Cordaä¸ä¼šå®šæœŸå°†éœ€è¦ç¡®è®¤çš„äº¤æ˜“åˆ†æ‰¹å¤„ç†å†åˆ†æˆå—ä¹‹åä¸€æ¬¡æ€§ç¡®è®¤ã€‚ç›¸åï¼ŒCordaä¼šå®æ—¶ç¡®è®¤æ¯ç¬”äº¤æ˜“ã€‚</p><h2 id="1-0-Cordaæœ‰å“ªäº›æ¦‚å¿µ">1.0 Cordaæœ‰å“ªäº›æ¦‚å¿µ</h2><h3 id="1-0-1-ç½‘ç»œ">1.0.1 ç½‘ç»œ</h3><ul><li>ä¸€ä¸ªCordaç½‘ç»œç”±è¿è¡Œç€Cordaå’ŒCorDappsçš„èŠ‚ç‚¹æ„æˆçš„</li><li>ä¸åŒçš„èŠ‚ç‚¹é—´çš„æ²Ÿé€šæ˜¯ç‚¹å¯¹ç‚¹çš„ï¼Œä¸ä¾èµ–äºå…¨å±€å¹¿æ’­</li><li>æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ•°å­—è¯ä¹¦æ¥å°†çœŸå®ä¸–ç•Œä¸­çš„æ³•å¾‹èº«ä»½å’Œç½‘ç»œèº«ä»½ç›¸å…³è”</li><li>è¿™ä¸ªç½‘ç»œæ˜¯ä¸€ä¸ªéœ€è¦è®¸å¯çš„ç½‘ç»œï¼Œéœ€è¦ä»ç½‘ç»œç»´æŠ¤è€…é‚£é‡Œç”³è¯·ä¸€ä¸ªæ•°å­—è¯ä¹¦æ¥è·å¾—è®¿é—®æƒé™</li></ul><h3 id="1-0-2-è´¦æœ¬">1.0.2 è´¦æœ¬</h3><ul><li>æ¯ä¸ªè´¦æœ¬æ˜¯é’ˆå¯¹äºæ¯ä¸€ä¸ªèŠ‚ç‚¹çš„</li><li>å¯¹äºè´¦æœ¬ä¸Šçš„å…±äº«äº‹å®ï¼Œå…±äº«çš„ä¸¤æ–¹ï¼ˆæˆ–å¤šæ–¹ï¼‰æ€»æ˜¯èƒ½å¤Ÿä¿è¯å­˜åœ¨ä»–ä»¬è‡ªå·±çš„è´¦æœ¬ä¸­çš„äº‹å®æ˜¯å®Œå…¨ä¸€è‡´çš„</li><li>åœ¨ Corda ä¸­æ˜¯ <strong>æ²¡æœ‰å”¯ä¸€çš„ä¸­å¿ƒåŒ–å­˜å‚¨çš„æ•°æ®</strong> çš„ã€‚æ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤ç€ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®åº“ï¼Œå…¶ä¸­åŒ…å«äº†æ‰€çŸ¥é“çš„äº‹å®ã€‚æ‰€ä»¥æ¯ä¸ª peer åªèƒ½å¤Ÿçœ‹åˆ°è´¦æœ¬ä¸­çš„äº‹å®ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œæ²¡æœ‰èŠ‚ç‚¹èƒ½å¤ŸçŸ¥é“æ‰€æœ‰çš„å†…å®¹ã€‚</li></ul><p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/ledger-venn.png" alt="img"></p><h3 id="1-0-3-States">1.0.3 States</h3><ul><li><em>State ä»£è¡¨çš„æ˜¯å­˜åœ¨è´¦æœ¬ä¸Šçš„äº‹å®</em></li><li><em>State é€šè¿‡å°†åŸæ¥çš„ State å˜ä¸ºå†å²è®°å½•ç„¶åæ·»åŠ ä¸€æ¡æ–°ç‰ˆæœ¬çš„ state çš„æ–¹å¼æ¥å¯¹ state è¿›è¡Œæ›´æ–°</em></li><li><em>æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ª vault æ¥å­˜å‚¨è¯¥èŠ‚ç‚¹æ‰€æœ‰ç›¸å…³çš„ States</em></li></ul><h4 id="1-0-3-0-State-é¡ºåº">1.0.3.0 State é¡ºåº</h4><p>ä¸ªå…±äº«çš„äº‹å®çš„ç”Ÿå‘½å‘¨æœŸæ˜¯å¯ä»¥é€šè¿‡ <strong>state é¡ºåº</strong> æ¥ä½“ç°ã€‚å½“ä¸€ä¸ª state éœ€è¦æ›´æ–°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ªä»£è¡¨æ–°çš„ state çš„æ–°ç‰ˆæœ¬çš„ stateï¼Œç„¶åå°†åŸæ¥çš„é‚£ä¸ª state æ ‡æ³¨ä¸ºå†å²ç‰ˆæœ¬ã€‚</p><h4 id="1-0-3-1-Vault">1.0.3.1 Vault</h4><p>Corda ç½‘ç»œä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½ç»´æŠ¤ç€ä¸€ä¸ª <em>vault</em> - å®ƒæ˜¯ä¸€ä¸ªæ•°æ®åº“ï¼Œå…¶ä¸­è·Ÿè¸ªäº†æ‰€æœ‰ states çš„å½“å‰ä»¥åŠå†å²çš„ states æ•°æ®ï¼Œä»¥åŠè·Ÿå®ƒæœ‰å…³çš„æ•°æ®ï¼š</p><p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/vault-simple.png" alt="_images/vault-simple.png"></p><h4 id="1-0-3-2-å‚è€ƒ-states">1.0.3.2 å‚è€ƒ states</h4><p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„ states éƒ½éœ€è¦è¢«ä½¿ç”¨ä»–ä»¬çš„èŠ‚ç‚¹æ¥æ›´æ–°çš„ã€‚å¯¹äºå‚æ•°æ•°æ®çš„æƒ…å†µï¼Œæœ‰ä¸€ç§å¸¸è§çš„æ¨¡å¼ï¼Œä¸€æ–¹åˆ›å»ºäº†å‚è€ƒæ•°æ®ï¼Œè¿™äº›æ•°æ®ä¼šè¢«å…¶ä»–æ–¹ä½¿ç”¨ï¼ˆä½†æ˜¯ä¸ä¼šè¢«æ›´æ–°ï¼‰ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œstates ä¸­åŒ…å«çš„å‚è€ƒæ•°æ®è¢«ç§°ä¸º â€œå‚è€ƒ statesâ€ã€‚</p><h3 id="1-0-4-Transactions">1.0.4 Transactions</h3><ul><li>Transaction æ˜¯å…³äºæ›´æ–°è´¦æœ¬çš„æè®®ï¼›ï¼ˆ<strong>ä¸ªäººç†è§£</strong>ï¼š<em>æ›´å‡†ç¡®çš„è¯´åº”è¯¥æ˜¯æ›´æ–°è´¦æœ¬ä¸Šçš„æŸäº›statesçš„æè®®</em>ï¼‰</li><li>ä¸€ä¸ª transaction æè®®åªèƒ½åœ¨æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„æ—¶å€™æ‰ä¼šè¢«æäº¤ï¼š<ul><li>å®ƒä¸åŒ…å«â€œåŒèŠ±â€</li><li>å®ƒæ˜¯åˆçº¦æœ‰æ•ˆçš„</li><li>å®ƒéœ€è¦è¢«æ‰€æœ‰ç›¸å…³æ–¹æä¾›ç­¾å</li></ul></li></ul><p>Corda ä½¿ç”¨ UTXO (æœªæ¶ˆè´¹çš„ transaction output) æ¨¡å‹æ¥ä½¿è´¦æœ¬ä¸Šçš„æ¯æ¡ state éƒ½ä¸å¯æ›´æ”¹ã€‚å¯¹äºè´¦æœ¬ä¸Šæ•°æ®çš„å˜æ›´éƒ½æ˜¯é€šè¿‡ä½¿ç”¨ transaction çš„æ–¹å¼æ¥åšçš„ï¼Œå°±æ˜¯å°† 0 æ¡æˆ–å¤šæ¡å·²ç»å­˜åœ¨çš„è´¦æœ¬ states å˜ä¸ºå†å²è®°å½•ï¼ˆinputsï¼‰ï¼Œç„¶åå†æ–°å¢0æ¡æˆ–å¤šæ¡æ–°çš„è´¦æœ¬ states ï¼ˆoutputsï¼‰ã€‚äº¤æ˜“ä»£è¡¨äº† state é¡ºåºä¸­çš„ä¸€ä¸ªå•ç‹¬çš„é“¾æ¥ã€‚</p><p>**ä¸ªäººç†è§£ï¼š**<em>è¿™ä¸€ç‚¹å’Œæ¯”ç‰¹å¸å¾ˆåƒï¼Œä¸åŒç‚¹æ˜¯æ¯”ç‰¹å¸çš„äº¤æ˜“åªéœ€è¦æ”¯ä»˜çš„äººçš„ç­¾åï¼Œè€Œè¿™é‡Œçš„transactionéœ€è¦æ‰€æœ‰äººç›¸å…³äººçš„ç­¾å</em></p><p>ä¸€ä¸ª transaction ä¸­å¯ä»¥åŒ…å«ä»»ä½•æ•°é‡ä»»ä½•ç±»å‹çš„ inputs å’Œ outputsï¼š</p><ul><li>å¯ä»¥åŒ…å«å¤šç§ç±»å‹çš„ stateï¼ˆcash, bondsï¼‰</li><li>å¯ä»¥æ˜¯ issuances ç±»å‹ï¼ˆæœ‰0ä¸ªinputï¼‰æˆ–è€… exists ç±»å‹ï¼ˆæœ‰0ä¸ª outputï¼‰</li><li>å¯ä»¥åˆå¹¶æˆ–æ‹†åˆ†å¯æ›¿æ¢çš„èµ„äº§ï¼ˆæ¯”å¦‚æŠŠä¸€ä¸ª $2 çš„ state å’Œ $5 çš„ state åˆå¹¶ä¸º $7 çš„ cash stateï¼‰</li></ul><p>Transaction æ˜¯ åŸå­æ€§æ“ä½œï¼Œä¸€ä¸ª transaction é‡Œè¾¹çš„æ‰€æœ‰ changes å¿…é¡»è¦å…¨éƒ¨æ‰§è¡Œï¼Œæˆ–è€…ä¸€ä¸ªä¹Ÿä¸ä¼šæ‰§è¡Œã€‚</p><p>æœ‰ä¸¤ç§åŸºæœ¬ç±»å‹çš„ transactionsï¼š</p><ul><li>Notary-change transactionsï¼ˆç”¨æ¥å˜æ›´ state çš„ notary - æŸ¥çœ‹ Notariesï¼‰</li><li>General transactionsï¼ˆå…¶ä»–ä»»ä½•ç±»å‹çš„ transactionï¼‰</li></ul><h4 id="1-0-4-1-äº¤æ˜“é“¾">1.0.4.1 äº¤æ˜“é“¾</h4><p>ä¸€ä¸ªæ–°çš„ transaction çš„ output state åœ¨è´¦æœ¬ä¸­åº”è¯¥æ˜¯è¿˜ä¸å­˜åœ¨çš„ï¼Œæ‰€ä»¥éœ€è¦æå‡º transaction çš„ä¸€æ–¹æ¥åˆ›å»ºã€‚ä½†æ˜¯ transaction ä¸­åŒ…å«çš„ input åº”è¯¥æ˜¯åœ¨è´¦æœ¬ä¸­å·²ç»å­˜åœ¨çš„ï¼Œåº”è¯¥æ˜¯å‰ä¸€ä¸ª transaction æ·»åŠ è¿›å»çš„ outputã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æ–°çš„ transaction ä¸­å¼•ç”¨è¿™äº›å·²ç»å­˜åœ¨çš„è®°å½•ã€‚</p><p>è¿™äº› Input state çš„å¼•ç”¨åŒ…å«ä¸¤éƒ¨åˆ†(<strong>ä¸ªäººç†è§£</strong>ï¼šä¸æ¯”ç‰¹å¸çš„äº¤æ˜“é“¾ä¸€æ ·)ï¼š</p><ul><li>åˆ›å»ºè¿™ä¸ª input çš„ transaction çš„ hash</li><li>è¿™ä¸ª input æ‰€æŒ‡çš„å‰ä¸€ä¸ª transaction å¸¦æ¥çš„ output state åœ¨ output list ä¸­çš„ä½ç½®æˆ–è€…ç´¢å¼•å€¼</li></ul><p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/tx-chain1.png" alt="_images/tx-chain1.png"></p><h4 id="1-0-4-2-æäº¤äº¤æ˜“">1.0.4.2 æäº¤äº¤æ˜“</h4><p>åˆå§‹çš„æ—¶å€™ï¼Œä¸€ä¸ª transaction ä»…ä»…æ˜¯ä¸€ä¸ªæ›´æ–°è´¦æœ¬çš„ æè®®ã€‚å®ƒè¡¨ç¤ºäº†ç»è¿‡è¿™æ¬¡æ›´æ–°åè´¦æœ¬çš„æ–°çš„çŠ¶æ€ï¼š</p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/uncommitted_tx.png" alt="_images/uncommitted_tx.png" style="zoom:30%;"><p>ä¸ºäº†æˆä¸ºçœŸæ­£çš„ä¸€ç¬”äº¤æ˜“ï¼Œtransaction å¿…é¡»è¦è·å¾—æ‰€æœ‰ è¦æ±‚çš„ç­¾å*ï¼ˆæŸ¥çœ‹ä¸‹è¾¹çš„ *<em>command</em>ï¼‰ã€‚æ¯ä¸€ä¸ªè¦æ±‚çš„ç­¾åè€…ä¼šå°†ç­¾åé™„åŠ åœ¨ transaction ä¸Šæ¥è¡¨ç¤ºä»–ä»¬å·²ç»åŒæ„äº†è¿™æ¬¡æ›´æ–°ï¼š</p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/tx_with_sigs.png" alt="_images/tx_with_sigs.png" style="zoom:30%;"><p>å¦‚æœå¾—åˆ°äº†æ‰€æœ‰éœ€è¦çš„ç­¾åï¼Œè¿™ä¸ª transaction å°±ä¼šè¢«æäº¤äº†ï¼š</p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/committed_tx.png" alt="_images/committed_tx.png" style="zoom:30%;"><p>ä¸€æ—¦æäº¤å°±æ„å‘³ç€ï¼š</p><ul><li>Transaction çš„ input è¢«æ ‡æ³¨ä¸ºå†å²è®°å½•ï¼Œå¹¶ä¸”ä¸èƒ½å†è¢«ä¹‹åçš„ transactions ä½¿ç”¨äº†</li><li>Transaction çš„ output å˜ä¸ºè´¦æœ¬ä¸Šçš„å½“å‰çŠ¶æ€çš„ä¸€éƒ¨åˆ†</li></ul><h4 id="1-0-4-3-äº¤æ˜“çš„æœ‰æ•ˆæ€§">1.0.4.3 äº¤æ˜“çš„æœ‰æ•ˆæ€§</h4><p>æ¯ä¸€ä¸ªè¢«è¦æ±‚çš„ç­¾åæ–¹åº”è¯¥åªæœ‰åœ¨æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶çš„æ—¶å€™æ‰åº”è¯¥æä¾›ç­¾åï¼š</p><ul><li><strong>Transaction æ˜¯æœ‰æ•ˆçš„</strong>ï¼šå¯¹äºå½“å‰çš„ transaction ææ¡ˆä»¥åŠäº§ç”Ÿå½“å‰ææ¡ˆçš„ Input ç›¸å…³çš„æ‰€æœ‰ä»¥å‰çš„æ‰€æœ‰ transactions çš„é“¾æ¡ä¸­ï¼š<ul><li>Transaction åº”è¯¥è·å¾—æ‰€æœ‰ç›¸å…³æ–¹çš„æ•°å­—ç­¾å</li><li>Transaction æ˜¯ <em>åˆçº¦æœ‰æ•ˆ</em> çš„</li></ul></li><li><strong>Transaction å”¯ä¸€æ€§</strong>ï¼šæœ¬æ¬¡ transaction ææ¡ˆè¦æ¶ˆè´¹çš„ inputs æ²¡æœ‰è¢«ä»»ä½•å·²ç»å­˜åœ¨çš„å…¶ä»–çš„å·²æäº¤çš„ transaction æ¶ˆè´¹è¿‡</li></ul><h4 id="1-0-4-4-å‚è€ƒ-states">1.0.4.4 å‚è€ƒ states</h4><p>æ­£å¦‚ States æ‰€æè¿°çš„ï¼Œä¸€äº› states éœ€è¦è¢«å…¶ä»–çš„ input æˆ–è€… output states çš„åˆçº¦ä»£ç æ‰€å¼•ç”¨ï¼Œä½†æ˜¯ä¸éœ€è¦è¢«ä¿®æ”¹/æ¶ˆè´¹ã€‚è¿™å°±éœ€è¦å‚è€ƒ statesã€‚å½“ä¸€ä¸ª state è¢«æ·»åŠ åˆ°ä¸€ç¬”äº¤æ˜“çš„å‚è€ƒ states åˆ—è¡¨ä¸­ï¼Œè€Œä¸æ˜¯ inputs æˆ–è€… outputs åˆ—è¡¨çš„æ—¶å€™ï¼Œé‚£ä¹ˆå®ƒå°±è¢«ä½œä¸º å‚è€ƒ stateã€‚åœ¨å¸¸è§„çš„ states å’Œå‚è€ƒ states é—´æœ‰ä¸¤ç‚¹åŒºåˆ«ï¼š</p><ul><li>äº¤æ˜“çš„èŠ‚ç‚¹æŒ‡å®šçš„ notary ä¼šæ£€æŸ¥å‚è€ƒ state æ˜¯ä¸æ˜¯å½“å‰çš„ã€‚ç„¶è€Œï¼Œå½“åŒ…å«ä»–ä»¬çš„äº¤æ˜“è¢«æäº¤åˆ°è´¦æœ¬çš„æ—¶å€™ï¼Œå‚è€ƒ states æ˜¯ä¸ä¼šè¢«æ¶ˆè´¹çš„ã€‚</li><li>å¯¹äºå‚è€ƒ states çš„åˆçº¦ä»£ç ä¹Ÿä¸ä¼šè¢«åŒ…å«ä»–ä»¬çš„äº¤æ˜“æ‰€æ‰§è¡Œã€‚</li></ul><h4 id="1-0-4-5-å…¶ä»–çš„äº¤æ˜“ç»„ä»¶">1.0.4.5 å…¶ä»–çš„äº¤æ˜“ç»„ä»¶</h4><p>å°±åƒ input states å’Œ output states ä¸€æ ·ï¼Œtransactions è¿˜å¯èƒ½ä¼šåŒ…å«ä¸‹è¾¹çš„ç»„ä»¶ï¼š</p><ul><li>Commands</li><li>Attachments</li><li>Timestamps</li><li>Notary</li></ul><p>æ¯”å¦‚ä¸€ä¸ªäº¤æ˜“ä¸­ï¼ŒAlice ä½¿ç”¨ Â£5 çš„ç°é‡‘å‘ Bob æ”¯ä»˜äº†ä¸€ä¸ª IOU çš„ Â£5ã€‚è¯¥ç¬”äº¤æ˜“åŒ…å«äº†ä¸¤ä¸ªé™„ä»¶ï¼Œå¹¶ä¸”åªèƒ½å¤Ÿåœ¨ notary pool åœ¨æŒ‡å®šçš„æ—¶é—´çª—å†…æ”¶åˆ°è¯¥ç¬”äº¤æ˜“çš„æ—¶å€™è¢« NotaryClusterA è¿›è¡Œå…¬è¯ï¼Œçœ‹èµ·æ¥åƒä¸‹è¾¹è¿™æ ·ï¼š</p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/full-tx.png" alt="_images/full-tx.png" style="zoom:30%;"><h4 id="1-0-4-5-1-Commands">1.0.4.5.1 Commands</h4><p><a href="https://zhuanlan.zhihu.com/p/33792878">ç¿»è¯‘è§†é¢‘è®²è§£Corda æ ¸å¿ƒæ¦‚å¿µ - Commands</a></p><p>Commandsæ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>Commands æ˜¯ä¸€äº›åŠ¨è¯ï¼ˆverbsï¼‰</li><li>Commands å°† transaction è¿›è¡Œå‚æ•°åŒ–ï¼ˆparameteriseï¼‰ï¼Œè¿™æ ·é™¤äº†ä» State ä¸­èƒ½å¤Ÿè·å–çš„ä¿¡æ¯å¤–ï¼Œcommands åˆèƒ½æä¾›äº†æ›´å¤šçš„ä¸€äº›ä¿¡æ¯</li><li>Commands ä¹Ÿæç¤ºï¼ˆhintï¼‰äº† transaction çš„æ„å›¾ï¼ˆintentï¼‰</li><li>Commands ä¹Ÿå¯èƒ½åŒ…å«é€šè¿‡ Oracle Service æä¾›çš„æ•°æ®ï¼ˆoff-ledger dataï¼‰</li></ul><p>ä¸€äº› Commands å…¸å‹çš„ä¾‹å­ï¼š</p><ul><li>å‘å¸ƒï¼ˆissueï¼‰æ–°çš„ State åˆ°è´¦æœ¬ä¸Š</li><li>äº¤æ¢ï¼ˆtransferï¼‰èµ„äº§åˆ°è´¦æœ¬ä¸­çš„å¦ä¸€æ–¹</li><li>ä»˜é’±ï¼ˆpayï¼‰ç»™è´¦æœ¬ä¸­çš„å¦ä¸€æ–¹</li><li>å¿è¿˜ï¼ˆredeemï¼‰ä¸€ç¬”èµ„äº§å¹¶ç»“æŸ/æ¸…é™¤ä»£è¡¨è¯¥èµ„äº§çš„state</li><li>å°è¯•ï¼ˆexerciseï¼‰ä¸€ä¸ªé€‰é¡¹ option</li><li>å±¥è¡Œï¼ˆsettleï¼‰ä¸€ä¸ªä¹‰åŠ¡æ¥é€’äº¤ä¸€ä¸ªèµ„äº§</li></ul><p>å¦‚ä½•çŸ¥é“ä¸€ä¸ª transaction éƒ½éœ€è¦è°æ¥æä¾›ç­¾åå‘¢ï¼Ÿæˆ‘ä»¬ä¼šæŠŠä¸€ä¸ªå…¬é’¥åˆ—è¡¨å…³è”è‡³ä¸€ä¸ª commandï¼Œæ¥è¯´æ˜éƒ½è°éœ€è¦å¯¹è¿™ä¸ª command æä¾›ç­¾åã€‚</p><ul><li>ä¸€ä¸ª commandä¸­ä¼šåŒ…å«ä¸€ä¸ªå…¬é’¥åˆ—è¡¨ï¼ˆpublic key listï¼‰ï¼Œé€šè¿‡è¿™ä¸ªåˆ—è¡¨å°±çŸ¥é“äº†éƒ½ä¼šæ¶‰åŠå“ªäº›äººæ¥ç¡®è®¤/ç­¾åè¯¥ state transaction</li><li>åœ¨ transactionä¸­ï¼Œinput å’Œ output states ç»å¸¸ä¼šè¢«æŒ‰ç…§ç±»åˆ«åˆ†ç»„ï¼ˆè¿˜å¯èƒ½æ ¹æ®å…¶ä»–çš„æ¡ä»¶è¿›è¡Œåˆ†ç»„ï¼‰</li><li>æ¯ä¸€ç»„ state éƒ½éœ€è¦æœ‰ä¸€ä¸ª command</li></ul><h4 id="1-0-4-5-2-Attachments">1.0.4.5.2 Attachments</h4><p>æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸€äº›æ•°æ®å¯ä»¥åœ¨ä¸åŒçš„ transactions ä¸­è¢«é‡ç”¨ã€‚æ¯”å¦‚ï¼š</p><ul><li>ä¸€ä¸ªå…¬å…±å‡æœŸçš„ calendar</li><li>æ”¯æŒçš„æ³•å¾‹æ–‡æ¡£</li><li>ä¸€ä¸ªè´§å¸ä»£ç çš„è¡¨æ ¼</li></ul><p>é’ˆå¯¹è¿™äº›æƒ…å†µï¼Œæˆ‘ä»¬ä½¿ç”¨é™„ä»¶ã€‚ä¸€ä¸ª transaction å¯ä»¥é€šè¿‡ hash å¼•ç”¨ 0 ä¸ªæˆ–è€…å¤šä¸ªé™„ä»¶ã€‚è¿™äº›é™„ä»¶æ˜¯ ZIP/JAR æ–‡ä»¶ï¼Œå¯ä»¥åŒ…å«ä»»ä½•å†…å®¹ã€‚è¿™äº›é™„ä»¶ä¸­ä¿¡æ¯å¯ä»¥ç”¨æ¥éªŒè¯ transaction çš„æœ‰æ•ˆæ€§ã€‚</p><h4 id="1-0-4-5-3-Time-window">1.0.4.5.3 Time-window</h4><p>ä¸€äº›æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªäº¤æ˜“ä»…ä»…åœ¨ä¸€ä¸ªæŒ‡å®šçš„æ—¶é—´ç‚¹è¢«æ‰¹å‡†æ‰§è¡Œã€‚ä¾‹å¦‚ï¼š</p><ul><li>åœ¨ä¸€ä¸ªæŒ‡å®šçš„æ—¥æœŸä¹‹åæ‰§è¡Œä¸€ä¸ªé€‰é¡¹</li><li>ä¸€ä¸ªå€ºåˆ¸åªèƒ½åœ¨å®ƒçš„è¿‡æœŸæ—¥æœŸå‰è¢«èµå›</li></ul><p>åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç»™ transaction æ·»åŠ ä¸€ä¸ª time-windowã€‚time-windows åˆ¶å®šäº†äº¤æ˜“ä¼šåœ¨å“ªä¸ªæ—¶é—´ç‚¹è¢«æäº¤ã€‚</p><h4 id="1-0-4-5-4-Notary">1.0.4.5.4 Notary</h4><p>**ä¸ªäººç†è§£ï¼š**ä¸ºäº†åœ¨issuance/genesis äº¤æ˜“ä¸­æä¾›å…¬è¯è¯æ˜çš„ï¼Œè¯æ˜æ­¤äº¤æ˜“çš„åˆæ³•æ€§ã€‚</p><h3 id="1-0-5-Contracts">1.0.5 Contracts</h3><p>**ä¸ªäººç†è§£ï¼š**ä¸ä»¥å¤ªåŠçš„æ™ºèƒ½åˆçº¦ç±»ä¼¼</p><ul><li>ä¸€ä¸ªæœ‰æ•ˆçš„ transaction å¿…é¡»è¦è¢«å®ƒçš„æ‰€æœ‰ input å’Œ output statesä¸­çš„ contract æ¥å—</li><li>Contracts éœ€è¦ä½¿ç”¨ JVM ç¼–ç¨‹è¯­è¨€ç¼–å†™ï¼ˆjava æˆ–è€… kotlinï¼‰</li><li>Contract çš„æ‰§è¡Œæ˜¯ä¸€å®šè¦æœ‰ä¸€ä¸ªç¡®å®šæ€§ç»“æœçš„ï¼Œå¹¶ä¸”å®ƒå¯¹äºä¸€ä¸ª transaction çš„æ¥å—æ˜¯ä»…ä»…åŸºäº transaction çš„å†…å®¹</li></ul><h4 id="1-0-5-1-Transaction-éªŒè¯">1.0.5.1 Transaction éªŒè¯</h4><p>ä¸€ä¸ª transaction ä»…ä»…å½“è¢«æ‰€æœ‰è¦æ±‚çš„ç­¾åæ–¹æä¾›äº†ç­¾åä¹‹åæ‰ä¼šè¢«è®¤ä¸ºæ˜¯æœ‰æ•ˆçš„ã€‚ä½†æ˜¯ï¼Œé™¤äº†è·å¾—åˆ°æ‰€æœ‰äººçš„ç­¾åä¹‹åï¼Œè¿˜å¿…é¡»è¦æ»¡è¶³ åˆçº¦æœ‰æ•ˆ æ‰ä¼šè¢«æœ€ç»ˆè®¤ä¸ºæœ‰æ•ˆã€‚</p><p>åˆçº¦æœ‰æ•ˆ çš„å®šä¹‰åŒ…å«ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>æ¯ä¸ª state éƒ½æŒ‡å®šäº†ä¸€ä¸ª åˆçº¦ ç±»åˆ«</li><li>åˆçº¦å°†äº¤æ˜“(transaction)ä½œä¸ºè¾“å…¥ï¼Œå¹¶æ ¹æ®åˆçº¦è§„åˆ™è¯´æ˜è¯¥äº¤æ˜“æ˜¯å¦æœ‰æ•ˆ</li><li>ä»…å½“<strong>every input state</strong>å’Œ** every output state **çš„åˆçº¦éƒ½è®¤ä¸ºå…¶æœ‰æ•ˆæ—¶ï¼Œäº¤æ˜“(transaction)æ‰æœ‰æ•ˆ</li></ul><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹å›¾æ¥æè¿°è¿™ä¸ªå…³ç³»ï¼š</p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/tx-validation.png" alt="_images/tx-validation.png" style="zoom:30%;"><p>åˆçº¦ä»£ç å¯ä»¥ç”¨ä»»ä½•JVMè¯­è¨€ç¼–å†™ï¼Œå¹¶å¯ä»¥ä½¿ç”¨è¯¥è¯­è¨€çš„å…¨éƒ¨åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>æ£€æŸ¥ inputsï¼Œoutputsï¼Œcommands çš„æ•°é‡ï¼Œæ—¶é—´ï¼Œé™„ä»¶</li><li>æ£€æŸ¥è¿™äº›ç»„ä»¶ä¸­çš„ä»»ä½•ä¸€ä¸ªçš„å†…å®¹</li><li>å¾ªç¯æ„é€ ï¼Œå˜é‡åˆ†é…ï¼Œå‡½æ•°è°ƒç”¨ï¼Œè¾…åŠ©æ–¹æ³•ç­‰</li><li>å°†ä¸€äº›ç±»ä¼¼çš„ states åˆ†ç»„æ¥éªŒè¯ï¼ˆæ¯”å¦‚å¯¹äºæ‰€æœ‰çš„ç°é‡‘ state çš„ç»„åˆå®šä¹‰ä¸€ä¸ªè§„åˆ™ï¼‰</li></ul><p>ä¸€ä¸ª transaction å¦‚æœä¸æ˜¯åˆçº¦æœ‰æ•ˆçš„è¯ï¼Œæ˜¯ä¸ä¼šè¢«è§†ä¸ºä¸€ä¸ªå¯¹è´¦æœ¬çš„æœ‰æ•ˆæ›´æ–°ï¼Œä¹Ÿå°±ä¸å¯èƒ½è¢«æäº¤è‡³è´¦æœ¬ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒåˆåŒå¯¹stateéšæ—¶é—´çš„å˜åŒ–æ–½åŠ äº†è§„åˆ™ï¼Œè¿™äº›è§„åˆ™ä¸æ‰€éœ€ç­¾åè€…ç­¾ç½²ç»™å®šäº¤æ˜“çš„æ„æ„¿æ— å…³ã€‚</p><h4 id="1-0-5-2-The-contract-sandbox">1.0.5.2 The contract sandbox</h4><p>**ä¸ªäººç†è§£ï¼š**ä¸ºäº†ä¿è¯éªŒè¯çš„ç»“æœä¸æ ¹æ®å¤–éƒ¨çš„æ¡ä»¶è€Œæ”¹å˜ï¼ŒCordaæä¾›äº†ä¸€ä¸ªæ²™ç®±ï¼Œä»¥é˜²æ­¢ä»£ç å¼•å…¥å¯èƒ½ä¼šé€ æˆä¸ç¡®å®šæ€§ç»“æœçš„å¤–éƒ¨åº“</p><p><a href="https://cncorda.readthedocs.io/zh_CN/latest/deterministic-modules.html">Deterministic Corda Modules</a></p><p>Transaction éªŒè¯å¿…é¡»æ˜¯ ä¸€ä¸ªç¡®å®šæ€§çš„ç»“æœï¼š åœ¨ä¸€ä¸ªç¡®å®šçš„transactionæè®®ä¸­ï¼Œä¸€ä¸ª contract å¿…é¡»æ€»æ˜¯æ¥å— æˆ–è€… æ€»æ˜¯æ‹’ç»ã€‚æ¯”å¦‚ transaction æ˜¯å¦æœ‰æ•ˆä¸èƒ½å¤Ÿå–å†³äºä½ åœ¨ä»€ä¹ˆæ—¶é—´åšçš„ verify æˆ–è€…æ˜¯åŸºäºæŸä¸€æ–¹å…·æœ‰çš„ä¿¡æ¯é‡çš„å¤šå°‘æ¥å†³å®šæ˜¯æœ‰æ•ˆçš„è¿˜æ˜¯æ— æ•ˆçš„ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ¡ä»¶æ¥ç¡®ä¿ç½‘ç»œä¸Šçš„ç›¸å…³èŠ‚ç‚¹èƒ½å¤Ÿåœ¨è¿™ä¸ªå¯¹è´¦æœ¬çš„æ›´æ–°çš„æ“ä½œè¾¾æˆå…±è¯†ã€‚</p><h4 id="1-0-5-3-Contract-çš„å±€é™æ€§">1.0.5.3 Contract çš„å±€é™æ€§</h4><p>å› ä¸º contract æ²¡æœ‰åŠæ³•è®¿é—®åˆ°å¤–éƒ¨çš„ä¿¡æ¯ï¼Œå®ƒåªèƒ½æ£€æŸ¥ transaction å†…éƒ¨çš„æœ‰æ•ˆæ€§ï¼Œæ¯”å¦‚å®ƒä¸èƒ½å¤Ÿæ£€æŸ¥ç¡®è®¤å½“å‰è¿™ä¸ª transaction æ˜¯ä¸æ˜¯å·²ç»åŒå…¶ä»–ç›¸å…³æ–¹è¾¾æˆäº†å…±è¯†å–å¾—äº†å…¶ä»–æ–¹çš„ç¡®è®¤ã€‚</p><p>æ‰€ä»¥åœ¨å„æ–¹æä¾›æœ€ç»ˆçš„ç­¾åç¡®è®¤ä¹‹å‰ï¼Œå„æ–¹åº”è¯¥å¯¹transaction çš„å†…å®¹è¿›è¡Œæ£€æŸ¥æ¥ç¡®å®šä»–ä»¬æ˜¯å¦åŒæ„è¿™ä¸ªå¯¹è´¦æœ¬çš„æ›´æ–°ï¼Œå³ä½¿è¿™ä¸ª transaction æ˜¯åˆçº¦æœ‰æ•ˆçš„ã€‚ä»»ä½•ä¸€æ–¹éƒ½æ²¡æœ‰ä¹‰åŠ¡å› ä¸ºtransactionæ˜¯æ˜¯åˆçº¦æœ‰æ•ˆè€Œæä¾›ç­¾åã€‚æ¯”å¦‚ä»–ä»¬å¯èƒ½ä¸æ„¿æ„å»æä¾›ä¸€ä¸ªå·¨é¢çš„å€Ÿæ¬¾ï¼Œæˆ–è€…å¯èƒ½ä¸ä¼šåŒæ„è´­ä¹°ä¸€ä¸ªèµ„äº§èŠ±è´¹çš„é’±çš„é‡‘é¢ã€‚</p><h4 id="1-0-5-4-Oracles">1.0.5.4 Oracles</h4><p>æœ‰æ—¶ï¼Œäº¤æ˜“æœ‰æ•ˆæ€§å°†å–å†³äºæŸäº›å¤–éƒ¨ä¿¡æ¯ï¼Œä¾‹å¦‚æ±‡ç‡ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œéœ€è¦ä¸€ä¸ªoracleã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§Oracleã€‚</p><h4 id="1-0-5-5-Legal-prose">1.0.5.5 Legal prose</h4><p>æ¯ä¸€ä¸ªåˆçº¦ä¹Ÿä¼šå¼•ç”¨ä¸€ä¸ª legal prose æ–‡æ¡£ï¼Œè¿™ä¸ªæ–‡æ¡£ä¸­å®šä¹‰äº†åˆçº¦ä¸­è§„å®šçš„å†…å®¹ï¼Œlegal prose ä¹Ÿä¼šè¢«ä¼ ç»Ÿçš„æ³•å¾‹ç³»ç»Ÿæ‰€æ¥å—ã€‚è¿™ä¸ªæ–‡æ¡£ä¼šåœ¨å‘ç”Ÿæ³•å¾‹çº çº·çš„æ—¶å€™è¢«ç”¨æ¥è¿›è¡Œåˆ¤å®šä¾æ®ã€‚</p><h3 id="1-0-6-Flows">1.0.6 Flows</h3><ul><li>Flows ä½¿åŒæ„æ›´æ–°è´¦æœ¬çš„æµç¨‹å˜å¾—è‡ªåŠ¨åŒ–</li><li>èŠ‚ç‚¹ä¹‹é—´çš„æ²Ÿé€šåªèƒ½å¤Ÿåœ¨è¿™äº› Flows çš„ä¸Šä¸‹æ–‡ä¸­å‘ç”Ÿï¼Œå¹¶ä¸”æ˜¯ç‚¹å¯¹ç‚¹çš„</li><li>å†…ç½®çš„ flows æä¾›äº†å¸¸ç”¨çš„ä¸€äº›ä»»åŠ¡</li></ul><p>Corda ç½‘ç»œä½¿ç”¨ç‚¹å¯¹ç‚¹çš„æ¶ˆæ¯ä¼ è¾“è€Œä¸æ˜¯å…¨å±€å¹¿æ’­ã€‚ä¹Ÿå°±æ˜¯è¯´åè°ƒä¸€ä¸ªå…³äºè´¦æœ¬çš„æ›´æ–°éœ€è¦ç½‘ç»œä¸Šçš„å‚ä¸è€…æ˜ç¡®çš„æŒ‡å®šéœ€è¦å‘é€ä»€ä¹ˆä¿¡æ¯ï¼Œå‘é€ç»™è°ï¼ŒæŒ‰ç…§ä»€ä¹ˆé¡ºåºå‘é€ã€‚</p><h4 id="1-0-6-1-Flow-æ¡†æ¶">1.0.6.1 Flow æ¡†æ¶</h4><p>ä¸€ä¸ª flow æ˜¯ä¸€ç³»åˆ—æœ‰é¡ºåºçš„æ­¥éª¤æ¥å‘Šè¯‰ä¸€ä¸ªèŠ‚ç‚¹åº”è¯¥å¦‚ä½•å®ç°ä¸€ä¸ªæŒ‡å®šçš„è´¦æœ¬æ›´æ–°ï¼Œæ¯”å¦‚å‘è¡Œä¸€ä¸ªèµ„äº§æˆ–è€…ç»“ç®—ä¸€ç¬”äº¤æ˜“ã€‚<br>ä¸‹è¾¹æ˜¯ä¸€ä¸ªä¸Šè¾¹å›¾ç‰‡æ‰€æè¿°çš„ç®€å•è´¦æœ¬æ›´æ–°æ‰€æ¶‰åŠåˆ°çš„é¡ºåºçš„æµç¨‹ï¼š</p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/flow-sequence.png" alt="_images/flow-sequence.png" style="zoom:30%;"><h4 id="1-0-6-2-è¿è¡Œ-flows">1.0.6.2 è¿è¡Œ flows</h4><p>ä¸€æ—¦ä¸€ä¸ªä¸šåŠ¡æµç¨‹è¢«å°è£…åœ¨äº†ä¸€ä¸ª flow ä¸­å¹¶ä¸”åœ¨èŠ‚ç‚¹ä¸­ä½œä¸º CorDapp çš„ä¸€éƒ¨åˆ†è¢«å®‰è£…å¥½ä¹‹åï¼ŒèŠ‚ç‚¹çš„æ‰€æœ‰è€…å¯ä»¥åœ¨ä»»ä½•æ—¶é—´é€šè¿‡ä½¿ç”¨ä¸€ä¸ª RPC call æ¥å‘Šè¯‰èŠ‚ç‚¹å¼€å§‹è¿™ä¸ªä¸šåŠ¡æµç¨‹ã€‚Flow å°†æ‰€æœ‰çš„ç½‘ç»œï¼ŒI/O å’Œå¹¶å‘é—®é¢˜éƒ½æŠ½è±¡äº†å‡ºæ¥ï¼Œè¿™ä¸ªèŠ‚ç‚¹ owner å°±ä¸éœ€è¦å…³æ³¨è¿™äº›äº†ã€‚</p><p>èŠ‚ç‚¹ä¸Šæ‰€æœ‰çš„åŠ¨ä½œéƒ½æ˜¯å‘ç”Ÿåœ¨è¿™äº› flows çš„ä¸Šä¸‹æ–‡ä¸Šçš„ã€‚ä¸ contract ä¸åŒï¼Œflows ä¸æ˜¯åœ¨ sandbox é‡Œæ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´èŠ‚ç‚¹å¯ä»¥åœ¨æ‰§è¡Œä¸€ä¸ª flow çš„è¿‡ç¨‹ä¸­æ¥è¿›è¡Œä¸€äº›åŠ¨ä½œæ¯”å¦‚ networkingï¼ŒI/O æˆ–è€…éšæœºåœ°ä½¿ç”¨ä¸€äº›èµ„æºã€‚</p><h4 id="1-0-6-3-èŠ‚ç‚¹å†…éƒ¨é€šä¿¡">1.0.6.3 èŠ‚ç‚¹å†…éƒ¨é€šä¿¡</h4><p>èŠ‚ç‚¹é—´æ˜¯é€šè¿‡åœ¨ä¸åŒçš„ flowsé—´ä¼ é€’æ¶ˆæ¯æ¥è¿›è¡Œæ²Ÿé€šçš„ã€‚æ¯ä¸ªèŠ‚ç‚¹æœ‰0ä¸ªæˆ–è€…å¤šä¸ªæ³¨å†Œçš„ flow classes æ¥å›å¤å¦å¤–ä¸ªä¸€ä¸ªå•ç‹¬çš„ flow çš„æ¶ˆæ¯ã€‚</p><p>å‡è®¾ Alice æ˜¯ç½‘ç»œä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”å¥¹å¸Œæœ›åŒ Bobï¼ˆç½‘ç»œä¸­çš„å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ ä¸€èµ·åŒæ„ä¸€æ¬¡è´¦æœ¬çš„æ›´æ–°ã€‚ä¸ºäº†è·Ÿ Bob è¿›è¡Œæ²Ÿé€šï¼Œ Alice å¿…é¡»ï¼š</p><ul><li>å¼€å§‹ä¸€ä¸ª Bob å·²ç»æ³¨å†Œè¿‡çš„ flow</li><li>Alice åœ¨è¿™ä¸ª flow çš„ä¸Šä¸‹æ–‡ä¸­ç»™ Bob å‘é€ä¸€ä¸ªæ¶ˆæ¯</li><li>Bob ä¼šå¯åŠ¨å®ƒæ³¨å†Œçš„è¿™ä¸ª conterparty flow</li></ul><p>è¿æ¥å·²ç»å»ºç«‹èµ·æ¥äº†ï¼ŒAlice å’Œ Bob å°±å¯ä»¥åƒ flow æ­¥éª¤ä¸­æè¿°çš„é‚£æ ·æ¥å›åœ°æ²Ÿé€šå…³äºä¸€ä¸ªæ›´æ–°è´¦æœ¬çš„æ”¹åŠ¨å¹¶ä¸”æœ€ç»ˆè¾¾æˆä¸€è‡´ã€‚</p><h4 id="1-0-6-4-Subflows">1.0.6.4 Subflows</h4><p>Flows å¯ä»¥é€šè¿‡åœ¨å¦å¤–ä¸€ä¸ª flow çš„ä¸Šä¸‹æ–‡ä¸­å¼€å§‹ä¸€ä¸ªæ–°çš„ flow ä½œä¸ºä¸€ä¸ªå­æµç¨‹çš„æ–¹å¼è¢«ç»„æˆã€‚ä½œä¸ºå­æµç¨‹è¢«å¯åŠ¨çš„ Flow è¢«ç§°ä¸º subflowã€‚çˆ¶ flow éœ€è¦ç­‰å¾…æ‰€æœ‰çš„ subflow å®Œæˆåæ‰ä¼šç»§ç»­è¿è¡Œã€‚</p><h4 id="1-0-6-5-Flow-ç±»åº“">1.0.6.5 Flow ç±»åº“</h4><p>Corda å¯¹äºä¸€äº›å¸¸è§„çš„ä»»åŠ¡éƒ½æä¾›äº†ä¸€å¥—ä»£ç åº“ï¼ˆ<a href="https://cncorda.readthedocs.io/zh_CN/latest/api-flows.html">API: Flows</a>ï¼‰ï¼Œæ‰€ä»¥å¼€å‘è€…å°±ä¸éœ€è¦è‡ªå·±å»å®šä¹‰è¿™äº›å¸¸è§æµç¨‹èƒŒåçš„é€»è¾‘äº†ï¼Œæ¯”å¦‚ï¼š</p><ul><li>å…¬æ­£å’Œè®°å½•ä¸€ä¸ª transaction</li><li>ä»ç›¸å…³èŠ‚ç‚¹æœé›†ç­¾å</li><li>éªŒè¯äº¤æ˜“é“¾</li></ul><h4 id="1-0-6-6-å¹¶å‘">1.0.6.6  å¹¶å‘</h4><p>Flow æ¡†æ¶å…è®¸èŠ‚ç‚¹å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ª flowsã€‚è¿™äº› flows å¯èƒ½ç”±äºèŠ‚ç‚¹çš„é‡å¯ç”šè‡³å‡çº§ä¼šæŒç»­å‡ å¤©ã€‚<br>è¿™ä¸ªå¯ä»¥é€šè¿‡åœ¨ flow å˜æˆé˜»å¡çš„çŠ¶æ€çš„æ—¶å€™ï¼Œå°† flows åºåˆ—åŒ–åˆ°ç¡¬ç›˜ä¸­çš„æ–¹å¼æ¥å®ç°ï¼ˆæ¯”å¦‚ä»–ä»¬åœ¨ç­‰å¾… I/O æˆ–è€…æ˜¯ç½‘ç»œçš„è°ƒç”¨ï¼‰ã€‚å‡ºç°è¿™ç§æƒ…å†µçš„æ—¶å€™ï¼ŒèŠ‚ç‚¹ä¸ä¼šç­‰å¾…è¿™ä¸ªé˜»å¡çŠ¶æ€çš„ flowå˜æˆéé˜»å¡çš„çŠ¶æ€ï¼Œè€Œä¼šç«‹å³è¿è¡Œå…¶ä»–çš„ flowï¼Œåªä¼šåœ¨ç¨åè¿”å›åˆ°åŸæ¥è¿™ä¸ªé˜»å¡çš„flowã€‚</p><h3 id="1-0-7-consensus-å…±è¯†">1.0.7 consensus(å…±è¯†)</h3><ul><li>ä¸ºäº†äº¤æ˜“èƒ½å¤Ÿè¢«æäº¤ï¼Œtransaction å¿…é¡»è¦åŒæ—¶æ»¡è¶³æœ‰æ•ˆæ€§å’Œ å”¯ä¸€æ€§çš„å…±è¯†</li><li>æœ‰æ•ˆæ€§å…±è¯†éœ€è¦ transaction å’Œ å®ƒçš„æ‰€æœ‰ä¾èµ–éƒ½æ˜¯åˆçº¦æœ‰æ•ˆçš„</li><li>å”¯ä¸€æ€§å…±è¯†å¯ä»¥é¿å…â€œåŒèŠ±â€</li></ul><h4 id="1-0-7-1-ä¸¤ç§ç±»å‹çš„å…±è¯†">1.0.7.1 ä¸¤ç§ç±»å‹çš„å…±è¯†</h4><p>åˆ¤æ–­ä¸€ä¸ªäº¤æ˜“çš„ææ¡ˆæ˜¯å¦æ˜¯ä¸€æ¬¡æœ‰æ•ˆçš„è´¦æœ¬æ›´æ–°è¦è¾¾åˆ°ä¸¤ç§ç±»å‹çš„å…±è¯†ï¼š</p><ul><li>æœ‰æ•ˆæ€§å…±è¯†ï¼šè¿™ç»™æ˜¯äº¤æ˜“æ‰€è¦æ±‚çš„ç­¾åè€…åœ¨æä¾›ä»–ä»¬ç­¾åä¹‹å‰å»æ ¡éªŒçš„</li><li>å”¯ä¸€æ€§å…±è¯†ï¼šè¿™ä¸ªåªä¼šè¢« notary service å»éªŒè¯</li></ul><h5 id="1-0-7-1-1-æœ‰æ•ˆæ€§å…±è¯†">1.0.7.1.1 æœ‰æ•ˆæ€§å…±è¯†</h5><p>æœ‰æ•ˆæ€§å…±è¯†æ˜¯å…³äºéªŒè¯ä¸‹è¾¹æ‰€æè¿°çš„æ¡ä»¶å¯¹äºæäº¤çš„ transaction å’Œç”Ÿæˆè¯¥è¯¥ transaction çš„ inputs çš„äº¤æ˜“é“¾ä¸­çš„æ¯æ¬¡ transaction éƒ½å¿…é¡»è¦æ»¡è¶³ï¼š</p><ul><li>Transaction ä¸­çš„æ¯ä¸ª input å’Œ output çš„ contracts æ‰€æ¥å—</li><li>Transaction å¾—åˆ°äº†æ‰€æœ‰è¦æ±‚çš„ç­¾å</li></ul><p>ä»…ä»…æ£€æŸ¥äº¤æ˜“ææ¡ˆæœ¬èº«ä¿¡æ¯æ˜¯ä¸å¤Ÿçš„ã€‚æˆ‘ä»¬è¿˜éœ€è¦æ£€æŸ¥è·Ÿäº§ç”Ÿå½“å‰è¿™ä¸ª transaction çš„ inputs æœ‰å…³çš„æ‰€æœ‰ä»¥å‰çš„ transaction é“¾ã€‚<br>è¿™ä¸ªè¢«ç§°ä½œ walking the chainã€‚å‡è®¾ï¼Œä¾‹å¦‚ç½‘ç»œä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹æäº¤äº†ä¸€ä¸ªäº¤æ¢å€ºåˆ¸çš„ä¸€ç¬”äº¤æ˜“ã€‚æˆ‘ä»¬åªæœ‰äº†è§£ä¸‹è¾¹çš„æƒ…å†µæ‰èƒ½ç¡®ä¿è¿™ä¸ªå€ºåˆ¸çš„äº¤æ¢æ˜¯æœ‰æ•ˆçš„ï¼š</p><ul><li>è¿™ä¸ªå€ºåˆ¸åº”è¯¥æ˜¯ç”±ä¸­å¿ƒé“¶è¡Œå‘è¡Œçš„ï¼Œè€Œä¸”åº”è¯¥æ˜¯åœ¨ä¸€æ¬¡æœ‰æ•ˆçš„å‘è¡Œäº¤æ˜“ä¸­</li><li>å…³äºè¿™ä¸ªå€ºåˆ¸çš„åç»­äº¤æ˜“è®°å½•ä¹Ÿåº”è¯¥éƒ½æ˜¯æœ‰æ•ˆçš„</li></ul><p>ç¡®ä¿ä¸¤ç‚¹éƒ½æ»¡è¶³çš„å”¯ä¸€æ–¹å¼å°±æ˜¯æŸ¥çœ‹æ•´ä¸ªäº¤æ˜“é“¾ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š</p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/validation-consensus.png" alt="_images/validation-consensus.png" style="zoom:30%;"><p>å½“ç¡®è®¤ä¸€ä¸ªäº¤æ˜“ææ¡ˆçš„æ—¶å€™ï¼Œç»™å®šçš„ä¸€æ–¹å¯èƒ½æ²¡æœ‰å®ƒéœ€è¦éªŒè¯çš„äº¤æ˜“é“¾ä¸Šçš„æ‰€æœ‰äº¤æ˜“ä¿¡æ¯ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä»–å¯ä»¥å‘äº¤æ˜“çš„æå‡ºæ–¹ç´¢è¦ç¼ºå°‘çš„é‚£éƒ¨åˆ†äº¤æ˜“ã€‚äº¤æ˜“çš„æå‡ºæ–¹åº”è¯¥æ°¸è¿œä¼šæœ‰æ•´ä¸ªçš„äº¤æ˜“é“¾ä¿¡æ¯ï¼Œå› ä¸ºä»–ä»¬åº”è¯¥åœ¨éªŒè¯ä¹‹å‰çš„äº¤æ˜“ä¸­å·²ç»è·å–äº†ç›¸å…³çš„äº¤æ˜“é“¾ä¿¡æ¯ã€‚</p><h5 id="1-0-7-1-2-å”¯ä¸€æ€§å…±è¯†">1.0.7.1.2 å”¯ä¸€æ€§å…±è¯†</h5><p>è®¾æƒ³ä¸€ä¸‹ Bob æŒæœ‰æœ‰æ•ˆçš„ç”±ä¸­å¤®é“¶è¡Œå‘è¡Œçš„ $1,000,000 ç°é‡‘ stateã€‚Bob å¯ä»¥åˆ›å»ºä¸¤ä¸ªäº¤æ˜“ææ¡ˆï¼š</p><ul><li>ä¸€ç¬”äº¤æ˜“è¦è·Ÿ Charlie ç”¨è¿™ $1,000,000 äº¤æ¢ Â£800,000</li><li>ä¸€ç¬”äº¤æ˜“è¦è·Ÿ Dan ç”¨è¿™ $1,000,000 äº¤æ¢ â‚¬900,000</li></ul><p>è¿™ä¼šæ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºå°½ç®¡è¿™ä¸¤ç¬”äº¤æ˜“éƒ½å¯ä»¥é€šè¿‡æœ‰æ•ˆæ€§å…±è¯†ï¼Œä½†æ˜¯ Bob ç¡®å®ç°äº†ä¸€æ¬¡â€œåŒèŠ± double spendâ€ ä»–çš„ç¾å…ƒæ¥è·å¾—äº†ä¸¤å€ä»·å€¼çš„ GBP å’Œ EURã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºè¿™ä¸ªæµç¨‹ï¼š</p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/uniqueness-consensus.png" alt="_images/uniqueness-consensus.png" style="zoom:30%;"><p>ä¸ºäº†é¿å…è¿™æ ·çš„é—®é¢˜å‘ç”Ÿï¼Œä¸€ä¸ªæœ‰æ•ˆçš„äº¤æ˜“ææ¡ˆåŒæ—¶ä¹Ÿè¦æ»¡è¶³å”¯ä¸€æ€§å…±è¯†ã€‚å”¯ä¸€æ€§å…±è¯†è¦æ±‚ä¸€ä¸ª transaction çš„ input ä¸èƒ½è¢«ä»»ä½•å…¶ä»–çš„ transaction æ¶ˆè´¹æ‰è¿‡ã€‚</p><p>å½“ä¸€ä¸ªäº¤æ˜“ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ª inputs å·²ç»è¢«å…¶ä»–çš„äº¤æ˜“æ¶ˆè´¹æ‰çš„æƒ…å†µï¼Œé€šå¸¸è¢«ç§°ä¸º åŒèŠ±ï¼Œé‚£ä¹ˆç›¸å…³çš„äº¤æ˜“åº”è¯¥è¢«è§†ä¸ºæ— æ•ˆçš„äº¤æ˜“ã€‚</p><p>å”¯ä¸€æ€§å…±è¯†æ˜¯ç”± notaries æä¾›çš„ã€‚æŸ¥çœ‹ Notaries äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p><h3 id="1-0-8-Notaries">1.0.8 Notaries</h3><ul><li>Notary é›†ç¾¤é¿å… â€œåŒèŠ±â€</li><li>Notary é›†ç¾¤ä¹Ÿå¯ä»¥æ˜¯æ—¶é—´æˆ³æˆæƒã€‚å¦‚æœä¸€ç¬”äº¤æ˜“åŒ…å«ä¸€ä¸ª time-windowï¼Œé‚£ä¹ˆå®ƒåªèƒ½åœ¨è¿™ä¸ª time-window å†…è¢«å…¬è¯</li><li>Notary é›†ç¾¤ä¹Ÿå¯ä»¥å¯é€‰åœ°ç”¨æ¥éªŒè¯äº¤æ˜“ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä»–ä»¬è¢«ç§°ä¸º â€œç”¨äºéªŒè¯â€ çš„ notariesï¼Œç›¸å¯¹äº â€œééªŒè¯â€ çš„ notaries</li><li>ä¸€ä¸ªç½‘ç»œä¸­å¯ä»¥æœ‰å¤šä¸ª notariesï¼Œæ¯ä¸€ä¸ª notary è¿è¡Œä¸€ä¸ªä¸åŒçš„å…±è¯†ç®—æ³•</li></ul><h4 id="1-0-8-1-æ¦‚è§ˆ">1.0.8.1 æ¦‚è§ˆ</h4><p>ä¸€ä¸ª notary é›†ç¾¤ æ˜¯ä¸€ä¸ªç½‘ç»œæœåŠ¡ï¼Œé€šè¿‡è¯æ˜ä¸€ä¸ªç»™å®šçš„äº¤æ˜“çš„ input æ˜¯æ²¡æœ‰è¢«å…¶ä»–çš„äº¤æ˜“æ¶ˆè´¹è¿‡çš„æ–¹å¼æä¾›äº† å”¯ä¸€æ€§å…±è¯†ã€‚</p><p>å½“è¢«è¦æ±‚ä¸ºä¸€ç¬”äº¤æ˜“è¿›è¡Œå…¬è¯çš„æ—¶å€™ï¼Œä¸€ä¸ª notary é›†ç¾¤ä¼šè¿›è¡Œä¸‹è¾¹ä¸¤ç§æ“ä½œä¸­çš„ä¸€ç§ï¼š</p><ul><li>å¦‚æœå¯¹äºç»™å®šçš„äº¤æ˜“ä¸­çš„ inputï¼Œæ²¡æœ‰ä»»ä½•å…¶ä»–çš„äº¤æ˜“å·²ç»æ¶ˆè´¹è¯¥ input çš„æ—¶å€™ï¼Œä¼šæä¾›ç­¾å</li><li>æ‹’ç»è¿™ç¬”äº¤æ˜“å¹¶ä¸”æ ‡æ˜äº§ç”Ÿäº†åŒèŠ±çš„æƒ…å†µ</li></ul><p>é€šè¿‡è¿™æ ·åšï¼Œnotary é›†ç¾¤å°±åœ¨ç³»ç»Ÿä¸­æä¾›äº†ä¸€ä¸ªç»ˆç»“ç‚¹ã€‚åœ¨æœ€ç»ˆè·å¾— notary é›†ç¾¤çš„ç­¾åä¹‹å‰ï¼Œäº¤æ˜“å„æ–¹å¹¶ä¸èƒ½ç¡®å®šäº¤æ˜“çš„æœ‰æ•ˆæ€§ã€‚ä½†æ˜¯å½“æ”¶åˆ°äº† notary é›†ç¾¤çš„ç­¾åä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤çš„æ˜¯ï¼Œäº¤æ˜“ä¸­çš„ Input æ˜¯æ²¡æœ‰è¢«å…¶ä»–ä»»ä½•çš„äº¤æ˜“æ‰€æ¶ˆè´¹è¿‡çš„ã€‚å› æ­¤å…¬è¯ï¼ˆnotarisationï¼‰åœ¨ç³»ç»Ÿé‡Œæ˜¯æœ€åçš„ä¸€æ­¥ã€‚</p><p>æ¯ä¸ª state éƒ½ä¼šæœ‰ä¸€ä¸ªæŒ‡å®šçš„ notary é›†ç¾¤ï¼Œè€Œä¸”ä¸€ä¸ª notary é›†ç¾¤ä¹Ÿåªä¼šå»å…¬æ­£é‚£äº› input æŒ‡å®šå®ƒä¸º notary é›†ç¾¤çš„ transactionã€‚</p><h4 id="1-0-8-2-å…±è¯†ç®—æ³•">1.0.8.2 å…±è¯†ç®—æ³•</h4><p>Corda æ‹¥æœ‰ä¸€å¥— â€œå¯æ’æ‹”â€ çš„å…±è¯†ï¼Œå…è®¸ notary é›†ç¾¤æ ¹æ®ä¸åŒçš„éœ€æ±‚ï¼ˆç§æœ‰åŒ–ã€æ‰©å±•æ€§ã€æ³•å¾‹ç³»ç»Ÿçš„å…¼å®¹æ€§å’Œç®—æ³•çš„ä¾¿æ·æ€§ï¼‰æ¥é€‰æ‹©ä¸€ç§å…±è¯†ç®—æ³•ã€‚</p><p>ç‰¹åˆ«çš„ï¼Œnotary é›†ç¾¤å¯èƒ½å«æœ‰ä¸‹è¾¹çš„ä¸åŒï¼š</p><ul><li>ç»“æ„ï¼š ä¸€ä¸ª notary é›†ç¾¤å¯èƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç½‘ç»œèŠ‚ç‚¹ï¼Œæˆ–è€…æ˜¯äº’ç›¸ä¿¡ä»»çš„èŠ‚ç‚¹é›†ç¾¤ï¼Œæˆ–è€…æ˜¯äº’ä¸ä¿¡ä»»çš„èŠ‚ç‚¹é›†ç¾¤</li><li>å…±è¯†ç®—æ³•ï¼š ä¸€ä¸ª notary é›†ç¾¤å¯èƒ½ä¼šé€‰æ‹©è¿è¡Œä¸€ä¸ªé«˜é€Ÿï¼Œé«˜ä¿¡ä»»çš„ç®—æ³•ï¼ˆæ¯”å¦‚ RAFTï¼‰ï¼Œæˆ–è€…ä¸€ä¸ªä½é€Ÿä½ä¿¡ä»»çš„ç®—æ³•ï¼ˆæ¯”å¦‚ BFTï¼‰ï¼Œåˆæˆ–è€…æ˜¯ä»»ä½•å…¶ä»–çš„é€‰æ‹©çš„å…±è¯†ç®—æ³•</li></ul><h4 id="1-0-8-3-éªŒè¯">1.0.8.3 éªŒè¯</h4><p>ä¸€ä¸ª notary é›†ç¾¤è¿˜éœ€è¦é€‰æ‹©æ˜¯å¦åœ¨æäº¤ä¹‹å‰é€šè¿‡éªŒè¯æ¯ä¸ª transaction çš„æœ‰æ•ˆæ€§æ¥æä¾›è¿™ç§ æœ‰æ•ˆæ€§å…±è¯† æœåŠ¡ã€‚ä¸ºäº†åšå‡ºè¿™ä¸ªé€‰æ‹©ï¼Œä»–ä»¬éœ€è¦é¢å¯¹ä¸‹è¾¹çš„å–èˆé—®é¢˜ï¼š</p><ul><li>å¦‚æœä¸€ä¸ª transaction æ²¡æœ‰ è¢«éªŒè¯äº†æ­£ç¡®ä¸å¦ï¼ˆééªŒè¯ notaryï¼‰ï¼Œé‚£ä¹ˆè¿™å°±å¢åŠ äº† â€œdenial of stateâ€ è¢­å‡»çš„é£é™©ï¼ŒæŒ‡çš„å°±æ˜¯æŸä¸ªèŠ‚ç‚¹çŸ¥é“è¿™æ˜¯ä¸€ä¸ªä¸æ­£ç¡®çš„ transaction ä¼šæ¶ˆè´¹åˆ°ä¸€äº› statesï¼Œç„¶åè¯¥èŠ‚ç‚¹è¿˜æ˜¯æŠŠè¿™ä¸ª transaction å‘é€ç»™ notary é›†ç¾¤ï¼Œä½†æ˜¯ notary å¦‚æœä¸è¿›è¡Œæ­£ç¡®æ€§éªŒè¯çš„è¯ï¼Œä¼šæŠŠè¿™ä¸ª state å˜ä¸ºå†å²è®°å½•è¢«æ¶ˆè´¹æ‰ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸æ­£ç¡®çš„</li><li>å¦‚æœ transaction å·²ç» è¢«éªŒè¯äº†æ­£ç¡®ä¸å¦ï¼ˆéªŒè¯ notaryï¼‰ï¼Œnotary éœ€è¦æŸ¥çœ‹è¯¥ transaction çš„å…¨éƒ¨å†…å®¹ä»¥åŠå®ƒçš„æ‰€æœ‰ä¾èµ–ã€‚è¿™å°±å‘ notary æš´éœ²äº†ä¸€äº›æ½œåœ¨çš„éšç§æ•°æ®ã€‚</li></ul><p>å½“æˆ‘ä»¬è€ƒé‡è¿™äº›å–èˆçš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªåç»­è§‚ç‚¹éœ€è¦å§‹ç»ˆè¦è€ƒè™‘çš„ã€‚å¯¹äºééªŒè¯æ¨¡å¼ï¼ŒCorda çš„æ§åˆ¶çš„æ•°æ®åˆ†å¸ƒæ¨¡å‹æ„å‘³ç€æœªè¢«æ¶ˆè´¹çš„ states ä¸ä¼šè¢«å¤§é¢ç§¯çš„å…±äº«ã€‚å¦å¤–ï¼Œ Corda çš„ permissioned network ä¹Ÿæ„å‘³ç€ notary èƒ½å¤Ÿå­˜å‚¨é€ æˆ â€œdenial of stateâ€ transaction çš„ä¸€æ–¹çš„èº«ä»½ä¿¡æ¯ï¼Œè¿™å°±å…è®¸èƒ½å¤Ÿåœ¨è´¦æœ¬å¤–å»è§£å†³æ‰è¿™ä¸ªè¢­å‡»ã€‚</p><p>å¯¹äºéªŒè¯æ¨¡å¼ï¼Œå¯¹äºåŒ¿åçš„ä½¿ç”¨ï¼Œä½¿ç”¨æ–°ç”Ÿæˆçš„å…¬é’¥è€Œä¸æ˜¯ä½¿ç”¨æ³•å¾‹çš„æ ‡è¯†æ¥æ ‡è®°ä¸€ç¬”äº¤æ˜“çš„å„æ–¹ä¹Ÿé™åˆ¶äº† notary é›†ç¾¤èƒ½å¤Ÿçœ‹åˆ°çš„ä¿¡æ¯ã€‚</p><h4 id="1-0-8-4-æ•°æ®çš„å¯è§†æ€§">1.0.8.4 æ•°æ®çš„å¯è§†æ€§</h4><p>ä¸‹è¾¹æ˜¯å…³äºå“ªäº›ç‰¹æ®Šçš„äº¤æ˜“ç»„ä»¶å¿…é¡»è¦æš´éœ²ç»™æ¯ç§ç±»å‹çš„ notary çš„ä¸€ä¸ªæ€»ç»“ï¼š</p><table><thead><tr><th><strong>Transaction components</strong></th><th><strong>Validating</strong></th><th><strong>Non-validating</strong></th></tr></thead><tbody><tr><td>Input states</td><td>Fully visible</td><td>References only [1]</td></tr><tr><td>Output states</td><td>Fully visible</td><td>Hidden</td></tr><tr><td>Commands (with signer identities)</td><td>Fully visible</td><td>Hidden</td></tr><tr><td>Attachments</td><td>Fully visible</td><td>Hidden</td></tr><tr><td>Time window</td><td>Fully visible</td><td>Fully visible</td></tr><tr><td>Notary identity</td><td>Fully visible</td><td>Fully visible</td></tr><tr><td>Signatures</td><td>Fully visible</td><td>Hidden</td></tr></tbody></table><p>ä¸¤ç§ç±»å‹çš„ notaries éƒ½ä¼šè®°å½•è°ƒç”¨æ–¹çš„èº«ä»½ä¿¡æ¯ï¼šå…¬é’¥ä»¥åŠ X.500 å”¯ä¸€çš„åå­—ã€‚</p><h4 id="1-0-8-5-å¤šä¸ª-Notaries">1.0.8.5 å¤šä¸ª Notaries</h4><p>æ¯ä¸ª Corda ç½‘ç»œå¯ä»¥å­˜åœ¨å¤šä¸ª notary é›†ç¾¤ï¼Œæ¯ä¸ª notary é›†ç¾¤å¯èƒ½ä¼šè¿è¡Œä¸€å¥—ä¸åŒçš„å…±è¯†ç®—æ³•ã€‚è¿™ä¼šå¸¦æ¥ä»¥ä¸‹çš„å¥½å¤„ï¼š</p><ul><li><strong>éšç§æ€§</strong> - æˆ‘ä»¬å¯ä»¥åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­åŒæ—¶æ‹¥æœ‰éªŒè¯å’ŒééªŒè¯çš„ notary é›†ç¾¤ï¼Œæ¯ä¸ªé›†ç¾¤è¿è¡Œç€ä¸åŒçš„ç®—æ³•ã€‚è¿™å°±å…è®¸èŠ‚ç‚¹é’ˆå¯¹æ¯ä¸ª transaction æ¥é€‰æ‹©æ›´å–œæ¬¢çš„ä¸åŒçš„ notaryã€‚</li><li><strong>è´Ÿè½½å¹³è¡¡</strong> - å°† transaction çš„å·¥ä½œåˆ†å‘ç»™å¤šä¸ª notary é›†ç¾¤å¯ä»¥æé«˜å¹³å°æ•´ä½“çš„äº¤æ˜“ååé‡</li><li><strong>ä½å»¶è¿Ÿ</strong> - é€šè¿‡é€‰æ‹©ç‰©ç†ä¸Šç¦»äº¤æ˜“æ–¹æœ€è¿‘çš„ notary é›†ç¾¤æ¥è·å¾—æœ€å°åŒ–çš„å»¶è¿Ÿ</li></ul><h4 id="1-0-8-6-æ›´æ¢-notaries">1.0.8.6 æ›´æ¢ notaries</h4><p>ä¸€ä¸ª notary é›†ç¾¤åªæœ‰å½“å®ƒæ˜¯è¿™ä¸ª transaction é‡Œçš„æ‰€æœ‰ input states æŒ‡å®šçš„ notary çš„æƒ…å†µä¸‹æ‰å¯ä»¥æä¾›ç­¾åã€‚ç„¶è€Œä¸‹è¾¹çš„æƒ…å†µå¯èƒ½éœ€è¦æ¢ä¸€ä¸ª state çš„æŒ‡å®šçš„ notary é›†ç¾¤ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>å½“ä¸€ä¸ª transaction éœ€è¦æ¶ˆè´¹çš„ states ä¸­æŒ‡å®šäº†ä¸åŒçš„ notary é›†ç¾¤</li><li>å½“ä¸€ä¸ªèŠ‚ç‚¹å› ä¸ºéšç§å’Œæ•ˆç‡çš„è€ƒè™‘å¸Œæœ›é€‰æ‹©ä¸€ä¸ªä¸åŒçš„ notary é›†ç¾¤</li></ul><p>å½“è¿™æ ·çš„ transactions è¢«åˆ›å»ºä¹‹å‰ï¼Œstates å¿…é¡»é¦–å…ˆè¢«æŒ‡å®šåˆ°åŒä¸€ä¸ª notary é›†ç¾¤ã€‚è¿™å¯ä»¥é€šè¿‡ä¸€ä¸ªæ”¹å˜ notary çš„ transaction æ¥å®ç°:</p><ul><li>ä¸€ä¸ª input state</li><li>output stateä¸input stateç›¸åŒï¼Œä½†æŒ‡å®šçš„notaryç¾¤é›†å·²æ›´æ”¹</li></ul><p>å¦‚æœè¯¥ transaction ä¸ä¼šé€ æˆâ€œåŒèŠ±â€ï¼Œè¿™ä¸ª input state æŒ‡å®šçš„ notary ä¼šä¸ºè¯¥ transaction æä¾›ç­¾åï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ–°çš„ state ä¼šäº§ç”Ÿï¼Œå®ƒçš„æ‰€æœ‰å±æ€§å’Œæ—§çš„ stateç›¸åŒï¼Œä½†æ˜¯ä¼šæŒ‡å‘ä¸€ä¸ªä¸åŒçš„ notary é›†ç¾¤ã€‚</p><h3 id="1-0-9-Vault">1.0.9  Vault</h3><p>Vault ä¸­å­˜å‚¨çš„æ˜¯è·ŸèŠ‚ç‚¹çš„æ‰€æœ‰è€…ç›¸å…³çš„ä»è´¦æœ¬ä¸Šå¾—åˆ°çš„æ•°æ®ï¼Œä»¥å…³ç³»æ¨¡å‹å­˜å‚¨ä»¥æ–¹ä¾¿æŸ¥è¯¢å’Œä½¿ç”¨ã€‚</p><p>Vault åŒæ—¶ä¼šè¿½è¸ªæœªæ¶ˆè´¹æ‰çš„å’Œå·²æ¶ˆè´¹æ‰çš„ statesï¼š</p><ul><li><strong>Unconsumed</strong>ï¼šæœªæ¶ˆè´¹æ‰çš„ ï¼ˆæˆ–è€…æœªä½¿ç”¨çš„ï¼‰ states ä»£è¡¨äº†å¯ä»¥ç”¨æ¥èŠ±è´¹çš„ fungible states ï¼ˆåŒ…æ‹¬ spend-to-self äº¤æ˜“ï¼‰ä»¥åŠå¯ä»¥ç”¨æ¥æ›´æ–°çš„ linear states ï¼ˆæ¯”å¦‚å¯¹äºä¸€ç¬”äº¤æ˜“çš„ç”Ÿå‘½å‘¨æœŸï¼‰æˆ–è€…ä»ä¸€æ–¹è½¬æ¢ç»™å¦ä¸€æ–¹ã€‚</li><li><strong>Consumed</strong>ï¼šå·²æ¶ˆè´¹æ‰çš„ ï¼ˆæˆ–è€…å·²ä½¿ç”¨çš„ï¼‰ states ä»£è¡¨äº†ä¸ºäº†äº¤æ˜“æŠ¥è¡¨ã€å®¡è®¡å’Œå½’æ¡£çš„ç›®çš„è€Œåœ¨è´¦æœ¬ä¸Šå­˜å‚¨çš„ä¸å¯æ›´æ”¹çš„ stateï¼ŒåŒ…æ‹¬è¿›è¡ŒåŒ app-private æ•°æ®è¿›è¡Œå…³è”çš„èƒ½åŠ›ï¼ˆæ¯”å¦‚å®¢æˆ·çš„ notesï¼‰ã€‚</li></ul><p>ä¸€ä¸ªç§°ä¸º soft locking çš„åŠŸèƒ½æä¾›äº†è‡ªåŠ¨æˆ–è€…æ˜¾å¼åœ°é¢„å®š states è€Œé¿å…åŒä¸€ä¸ªèŠ‚ç‚¹å°è¯•åŒæ—¶åœ¨å¤šç¬”äº¤æ˜“ä¸­ä½¿ç”¨ç›¸åŒçš„ output çš„èƒ½åŠ›ã€‚è¿™ç§æƒ…å†µæœ€ç»ˆä¼šè¢«ä¸€ä¸ª notary å‘ç°ï¼Œsoft locking æä¾›äº†ä¸€ç§èƒ½å¤Ÿåœ¨æ—©æœŸå°±å‘ç°è¿™ç§æ— æ ¹æ®å’Œä¸æ­£ç¡®çš„æƒ…å†µçš„æœºåˆ¶ã€‚Soft Locking æä¾›äº†æ›´è¯¦ç»†çš„çš„å…³äºè¿™ä¸ªåŠŸèƒ½çš„æè¿°ã€‚</p><p>Vault æ”¯æŒç®¡ç†éœ€æˆæƒçš„ï¼ˆâ€œon-ledgerâ€ï¼‰çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥ç®¡ç† shadowï¼ˆâ€œoff-ledgerâ€ï¼‰å½¢å¼çš„æ•°æ®ï¼š</p><ul><li>â€œOn-ledgerâ€ æ•°æ®æŒ‡çš„æ˜¯æŒ‡å…¬å¸å‚ä¸çš„åˆ†å¸ƒå¼è´¦æœ¬çš„state ï¼ˆç°é‡‘ã€äº¤æ˜“ã€ï¼‰ã€‚</li><li>â€œOff-ledgerâ€ æ•°æ®æŒ‡çš„æ˜¯å…¬å¸å†…éƒ¨çš„å‚è€ƒæ•°æ®ã€é™æ€æˆ–è€…ç³»ç»Ÿæ•°æ®ã€‚</li></ul><p>ä¸‹è¾¹çš„å›¾è¡¨å±•ç¤ºäº†å°† vault æ‹†åˆ†ä¸ºå­ç³»ç»Ÿç»„ä»¶ï¼š</p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/vault.png" alt="_images/vault.png" style="zoom:80%;"><p>æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>Vault â€œOn Ledgerâ€ å­˜å‚¨å¹¶è¿½è¸ªæœªæ¶ˆè´¹æ‰çš„ stateï¼Œå¹¶ä¸”åœ¨å°†ä¸€ç¬”äº¤æ˜“è®°å½•åˆ°è´¦æœ¬çš„æ—¶å€™ç”±èŠ‚ç‚¹å†…éƒ¨è¿›è¡Œæ›´æ–°ï¼ˆä¼šæŒ‰ç…§æˆåŠŸæ‰§è¡Œäº†æ™ºèƒ½åˆçº¦éªŒè¯ä»¥åŠå—åˆ°æ‰€æœ‰å‚ä¸æ–¹çš„ç­¾åï¼‰</li><li>Vault â€œOff Ledgerâ€ å­˜å‚¨äº†äº¤æ˜“è®°å½•ä»¥å¤–èŠ‚ç‚¹çš„æ‰€æœ‰è€…æ·»åŠ çš„é¢å¤–çš„æ•°æ®</li><li>Vault å¯¹ fungible state è¿›è¡Œäº†èŠ±è´¹ï¼ˆå¹¶ä¸”åœ¨å°†æ¥ï¼Œfungible state çš„ä¼˜åŒ–ç®¡ç†åŒ…æ‹¬åˆå¹¶ã€æ‹†åˆ†ä»¥åŠå†å‘è¡Œï¼‰ã€‚</li><li>Vault æ‰©å±•ä»£è¡¨äº†å¼€å‘è€…å¯ä»¥ç¼–å†™çš„é¢å¤–çš„è‡ªå®šä¹‰ plugin ä»£ç ï¼Œç”¨æ¥æŸ¥è¯¢æŒ‡å®šçš„è‡ªå®šä¹‰ contract state å±æ€§ã€‚</li><li>å®¢æˆ·çš„ â€œOff Ledgerâ€ï¼ˆç§æœ‰çš„å­˜å‚¨ï¼‰ä»£è¡¨äº†å†…éƒ¨çš„ç»„ç»‡å‹æ•°æ®ï¼Œå¯èƒ½è¢«ç”¨æ¥è·Ÿ vault æ•°æ®è¿›è¡Œå…³è”æ¥è¿›è¡Œé¢å¤–çš„æŠ¥è¡¨æˆ–è€…å¤„ç†ã€‚</li><li><a href="https://cncorda.readthedocs.io/zh_CN/latest/api-vault-query.html">Vault Query API</a> å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ Corda RPC å’Œ CorDapp plugin æœºåˆ¶æš´éœ²ç»™å¼€å‘è€…ã€‚</li><li>Vault æ›´æ–° API å¯ä»¥è¢«äº¤æ˜“è®°å½•çš„ flows å†…éƒ¨ä½¿ç”¨ã€‚</li><li>Vault æ•°æ®åº“ schemas å¯ä»¥é€šè¿‡ JDBC å’Œè‡ªå®šä¹‰çš„ joins å’ŒæŸ¥è¯¢è¿›è¡Œç›´æ¥åœ°è®¿é—®ã€‚</li></ul><h3 id="1-0-10-Time-windows">1.0.10 Time-windows</h3><ul><li>å¦‚æœä¸€ä¸ª transaction åŒ…å«äº†ä¸€ä¸ª time-windowï¼Œé‚£ä¹ˆè¿™ä¸ª transaction åªèƒ½åœ¨è¿™ä¸ª time-window é‡Œè¢«æäº¤</li><li>Notary å…·æœ‰æ§åˆ¶å‘ç”Ÿçš„æ—¶é—´çš„æƒåˆ©ï¼Œå½“åœ¨ time-window ä¹‹å¤–çš„æ—¶å€™ï¼Œnotary å¯ä»¥æ‹’ç»æäº¤ transaction</li><li>Time-window å¯ä»¥æœ‰å¼€å§‹å’Œç»“æŸæ—¶é—´ï¼Œæˆ–è€…åªæœ‰ä¸¤è€…ä¹‹ä¸­çš„ä¸€ä¸ª</li></ul><h4 id="1-0-10-1-åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ—¶é—´">1.0.10.1 åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ—¶é—´</h4><p>Notary ä¹Ÿå¯ä»¥ä½œä¸º æ—¶é—´æˆ³çš„éªŒè¯è€…ï¼Œåœ¨å®ƒç¡®è®¤ä¸€ç¬”äº¤æ˜“å‰ï¼Œéœ€è¦ç¡®ä¿è¿™ç¬”äº¤æ˜“æ˜¯å‘ç”Ÿåœ¨æŒ‡å®šçš„æ—¶é—´çª—é‡Œã€‚</p><p>ä¸ºäº†è®©ä¸€ä¸ªæ—¶é—´çª—æœ‰æ„ä¹‰ï¼Œå®ƒå¿…é¡»è¦åœ¨ä¸€æ–¹è¯·æ±‚å®ƒçš„æ—¶å€™è¢«ç»‘å®šã€‚ä¸€æ–¹å¯ä»¥è·å¾—ä¸€ä¸ª time-window çš„ç­¾åï¼Œä»¥æ­¤æ¥è¯æ˜æœ‰äº›äº‹ä»¶æ˜¯åœ¨ç‰¹å®šæ—¶é—´ç‚¹ ä¹‹å‰ã€å½“æ—¶ æˆ–è€… ä¹‹å å‘ç”Ÿçš„ã€‚ç„¶è€Œï¼Œå¦‚æœäº¤æ˜“å‚ä¸è€…ä¸èƒ½å¤Ÿåœ¨æŒ‡å®šçš„ time-window å†…æäº¤åˆ°ç›¸å…³çš„äº¤æ˜“ï¼Œå®ƒå¯ä»¥é€‰æ‹©æ˜¯å¦åœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´ç‚¹å°†è¿™ä¸ªäº‹å®æš´éœ²å‡ºå»ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿ notary æˆ–è€…èƒ½å¤Ÿåœ¨ä¸€äº›å¯å®¹é”™çš„æ—¶é—´èŒƒå›´å†…å¯¹äº¤æ˜“è¿›è¡Œç­¾åï¼Œæˆ–è€…åŒæ—¶è¿›è¡Œæ‰“æ—¶é—´æˆ³ å’Œ å¯¹äº¤æ˜“è¿›è¡Œå…¬è¯ã€‚åè¾¹çš„è¿™ç§æ–¹å¼æ˜¯è¿™ä¸ªæ¨¡å‹ä¸­ä½¿ç”¨çš„æ–¹å¼ã€‚</p><p>åœ¨åˆ›å»ºäº¤æ˜“çš„ä¸€æ–¹å’Œ notary ä¹‹é—´æ˜¯æ— æ³•å®ç°æ—¶é—´çš„åŒæ­¥çš„ã€‚è¿™å¹¶ä¸ä»…ä»…æ˜¯å› ä¸ºç‰©ç†æˆ–è€…ç½‘ç»œçš„å»¶è¿Ÿï¼Œè¿˜ä¼šå› ä¸ºåœ¨æ’å…¥å‘½ä»¤å’Œè·å¾— notary ç­¾åä¹‹é—´å¯èƒ½ä¼šå‘ç”Ÿå¾ˆå¤šå…¶ä»–çš„æ­¥éª¤ï¼ˆæ¯”å¦‚å‘é€äº¤æ˜“åˆ°æ¶‰åŠåˆ°çš„å…¶ä»–èŠ‚ç‚¹ï¼Œè¯·æ±‚äººå·¥çš„å®¡æ‰¹ç­‰ï¼‰ã€‚æ‰€ä»¥äº¤æ˜“è¢«å‘é€åˆ° notary çš„æ—¶é—´å’Œäº¤æ˜“åˆ›å»ºçš„æ—¶é—´å¯èƒ½ä¼šä¸åŒã€‚</p><h4 id="1-0-10-2-Time-windows">1.0.10.2 Time-windows</h4><p>å› ä¸ºä¸Šé¢çš„åŸå› ï¼Œäº¤æ˜“ä¸­æ¶‰åŠåˆ°çš„æ—¶é—´ä¼šè¢«åˆ¶å®šä¸ºä¸€ä¸ªæ—¶é—´çª—ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç»å¯¹çš„æ—¶é—´ã€‚åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ˜¯æ°¸è¿œä¸ä¼šæœ‰ â€œçœŸå®çš„æ—¶é—´â€ çš„ï¼Œåªæœ‰ä¸€ä¸ªå¤§æ¦‚çš„æ—¶é—´ã€‚æ—¶é—´çª—å¯ä»¥æ˜¯å¼€æ”¾çš„ï¼ˆæ¯”å¦‚åœ¨æŸä¸ªæ—¶é—´ç‚¹åï¼Œæˆ–è€…æŸä¸ªæ—¶é—´ç‚¹ä¹‹å‰ï¼‰æˆ–è€…æ˜¯ä¸€ä¸ªé—­åˆçš„èŒƒå›´ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬è¡¨è¾¾äº†æˆ‘ä»¬çš„æƒ³æ³•ï¼Œå°±æ˜¯ â€œå½“å‰çš„æ—¶é—´â€ æ°¸è¿œéƒ½æ˜¯æœªçŸ¥çš„ã€‚ç”šè‡³å½“åœ¨æŸä¸ªæ—¶é—´ä¹‹å‰å’Œä¹‹åéƒ½è¢«åŒ…å«çš„æ—¶å€™ï¼Œäº¤æ˜“ä¹Ÿå¯èƒ½ä¼šåœ¨é‚£ä¸ªæ—¶é—´çª—ä¸­çš„ä»»ä½•æ—¶é—´å‘ç”Ÿã€‚</p><p>é€šè¿‡åœ¨ä¸€ç«¯åˆ›å»ºä¸€ä¸ªå…³é—­æˆ–è€…å¼€æ”¾çš„èŒƒå›´ï¼Œæˆ‘ä»¬å…è®¸ç”¨ä»¥ä¸‹çš„æ–¹å¼ç”Ÿæˆæ—¶é—´çª—æ¨¡å‹ï¼š</p><ul><li>ä¸€ç¬”äº¤æ˜“åœ¨æŒ‡å®šæ—¶é—´ä¹‹åçš„æŸä¸ªæ—¶é—´å‘ç”Ÿï¼ˆæ¯”å¦‚åœ¨ä¸€ä¸ªç»ˆæ­¢äº‹ä»¶ä¹‹åï¼‰</li><li>ä¸€ç¬”äº¤æ˜“åœ¨æŒ‡å®šæ—¶é—´ä¹‹å‰çš„ä»»ä½•æ—¶é—´å‘ç”Ÿï¼ˆæ¯”å¦‚ç ´äº§äº‹ä»¶ä¹‹å‰ï¼‰</li><li>ä¸€ç¬”äº¤æ˜“åœ¨æŒ‡å®šæ—¶é—´åŒºé—´çš„æŸä¸ªæ—¶é—´å‘ç”Ÿï¼ˆæ¯”å¦‚åœ¨æŒ‡å®šçš„æŸä¸€å¤©ï¼‰</li></ul><h3 id="1-0-11-Oracles">1.0.11 Oracles</h3><ul><li>ä¸€ä¸ªäº‹å®ï¼ˆfactï¼‰å¯ä»¥ä½œä¸º command çš„ä¸€éƒ¨åˆ†è¢«æ·»åŠ åˆ°ä¸€ä¸ª transaction ä¸­</li><li>ä¸€ä¸ª oracle æ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œå®ƒåªä¼šä¸ºé‚£äº›åŒ…å«æ­£ç¡®äº‹å®çš„ transaction æä¾›ç­¾å</li></ul><p>å¾ˆå¤šæ—¶å€™ transaction çš„åˆçº¦æœ‰æ•ˆæ€§éœ€è¦ä¾èµ–ä¸€äº›å¤–éƒ¨çš„æ•°æ®ï¼Œæ¯”å¦‚å½“å‰çš„æ±‡ç‡æ˜¯å¤šå°‘ã€‚å¦‚æœè®©æ¯ä¸ªå‚ä¸æ–¹ç»™äºˆä»–ä»¬å¯¹äºæ±‡ç‡çš„è§‚ç‚¹æ¥éªŒè¯ transaction çš„æœ‰æ•ˆæ€§çš„è¯ï¼Œåˆçº¦çš„æ‰§è¡Œå°±ä¼šå˜å¾—æ²¡æœ‰ç¡®å®šæ€§äº†ï¼šä¸€äº›å‚ä¸è€…å¯èƒ½ä¼šè®¤ä¸º transaction æ˜¯æœ‰æ•ˆçš„ï¼Œè€Œå…¶ä»–çš„å‚ä¸è€…å¯èƒ½è®¤ä¸ºæ— æ•ˆã€‚å› æ­¤ï¼Œåœ¨çœŸæ­£è´¦æœ¬ä¸­çš„ state ä¹‹ä¸Šå°±ä¼šæå‡ºä¸€äº›ä¸åŒçš„æ„è§ã€‚</p><p>Corda é€šè¿‡ä½¿ç”¨ Oracle æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚Oracle æ˜¯ä¸€ä¸ªç½‘ç»œæœåŠ¡ï¼Œå¯ä»¥æ ¹æ®è¦æ±‚æä¾›åŒ…å«æŸä¸€äº‹å®çš„å‘½ä»¤ï¼ˆæ¯”å¦‚åœ¨æŸä¸ªæ—¶é—´çš„æ±‡ç‡ï¼‰å¹¶ä¸”å°† Oracle åˆ—ä¸ºè¦æ±‚ç­¾åçš„ä¸€æ–¹ã€‚</p><p>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å¸Œæœ›åœ¨ä¸€ä¸ª transaction ä¸­ä½¿ç”¨æŸä¸€ä¸ªäº‹å®ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥æå‡ºä» Oracle æ¥è·å–è¯¥äº‹å®çš„ä¸€ä¸ªå‘½ä»¤ã€‚å¦‚æœ Orale è®¤ä¸ºè¿™ä¸ªäº‹å®æ˜¯æ­£ç¡®çš„ï¼Œå®ƒä¼šè¿”å›è¿™ä¸ªè¦æ±‚çš„å‘½ä»¤ã€‚ç„¶åè¿™ä¸ªèŠ‚ç‚¹å°±å¯ä»¥æŠŠè¿™ä¸ªå‘½ä»¤æ·»åŠ åˆ° transaction ä¸­äº†ï¼Œç„¶å oracle ä¼šä¸ºè¿™ä¸ªäº‹å®æ˜¯çœŸçš„æä¾›ç­¾åã€‚</p><p>ä¸ºäº†éšç§æ€§çš„ç›®çš„ï¼ŒOracle ä¸éœ€è¦èƒ½å¤Ÿè®¿é—®äº¤æ˜“çš„æ¯ä¸ªéƒ¨åˆ†ï¼Œä»–ä»¬å”¯ä¸€éœ€è¦çš„ä¿¡æ¯å°±æ˜¯çœ‹åˆ°ä»–ä»¬å†…ç½®çš„ã€è·Ÿè¿™ä¸ª Oracle ç›¸å…³çš„ command(s)ã€‚æˆ‘ä»¬ä¹Ÿåº”è¯¥æä¾›è®©è¿™äº›éœ€è¦æä¾›ç­¾åçš„ Oracle å®ä½“èƒ½å¤Ÿçœ‹åˆ°è¿™äº› commands çš„ä¿è¯ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬å…¶ä»–çš„éƒ¨åˆ†ã€‚ä¸ºäº†å®ç°è¿™ä¸ªï¼Œæˆ‘ä»¬ä½¿ç”¨è¿‡æ»¤è¿‡çš„äº¤æ˜“ï¼Œæ˜¯æŒ‡äº¤æ˜“çš„ææ¡ˆæ–¹ä½¿ç”¨ä¸€ä¸ªå†…åµŒçš„é»˜å…‹å°”æ ‘çš„æ–¹å¼æ¥å°†ä¸€äº›éç›¸å…³çš„äº¤æ˜“çš„éƒ¨åˆ†éšè—æ‰ã€‚æŸ¥çœ‹ Transaction tear-offs äº†è§£å…³äºäº¤æ˜“å¦‚ä½•æ‹¿æ‰å·¥ä½œçš„è¯¦ç»†ä¿¡æ¯ã€‚</p><p>å¦‚æœä»–ä»¬æƒ³ä¸ºä»–ä»¬çš„æœåŠ¡å®šä»·ï¼ŒOracles å¯ä»¥é€‰æ‹©åªä¸ºé‚£äº›åŒ…å«æœåŠ¡è´¹çš„äº¤æ˜“æä¾›ç­¾åå¹¶è¯æ˜å®ƒåŒ…å«çš„äº‹å®çš„æœ‰æ•ˆæ€§ã€‚</p><h3 id="1-0-12-nodeï¼ˆèŠ‚ç‚¹ï¼‰">1.0.12 nodeï¼ˆèŠ‚ç‚¹ï¼‰</h3><ul><li>Corda ä¸­çš„èŠ‚ç‚¹æŒ‡çš„æ˜¯åœ¨ç½‘ç»œä¸­å…·æœ‰å”¯ä¸€æ ‡è¯†çš„è¿è¡Œç€ Corda æœåŠ¡å’Œ CorDapps çš„ JVM è¿è¡Œæ—¶ç¯å¢ƒã€‚</li><li>èŠ‚ç‚¹å¯¹äºå¤–éƒ¨ä¸–ç•ŒåŒ…å«ä¸¤ä¸ªæ¥å£ï¼š<ul><li>ç½‘ç»œå±‚ï¼Œç”¨æ¥åŒå…¶ä»–çš„èŠ‚ç‚¹é€šä¿¡</li><li>RPCï¼Œä¸ºäº†è·ŸèŠ‚ç‚¹çš„æ‰€æœ‰è€…é€šä¿¡</li></ul></li><li>èŠ‚ç‚¹çš„åŠŸèƒ½æ˜¯é€šè¿‡åœ¨ plugin registry é‡Œå®‰è£… CorDapps æ–¹å¼æ¥æ‰©å±•çš„</li></ul><h4 id="1-0-12-1-èŠ‚ç‚¹æ¶æ„">1.0.12.1 èŠ‚ç‚¹æ¶æ„</h4><p>ä¸‹è¾¹æ˜¯èŠ‚ç‚¹çš„å†…éƒ¨æ¶æ„å›¾ï¼š</p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/node-architecture.png" alt="_images/node-architecture.png" style="zoom:40%;"><p>æ¶æ„ä¸­çš„æ ¸å¿ƒå…ƒç´ åŒ…æ‹¬ï¼š</p><ul><li>å­˜å‚¨æ•°æ®çš„æŒä¹…åŒ–å±‚</li><li>åŒå…¶ä»–èŠ‚ç‚¹æ²Ÿé€šçš„ç½‘ç»œæ¥å£</li><li>åŒèŠ‚ç‚¹çš„æ‰€æœ‰è€…è¿›è¡Œæ²Ÿé€šçš„ RPC æ¥å£</li><li>å…è®¸èŠ‚ç‚¹çš„ flows æ¥è°ƒç”¨èŠ‚ç‚¹å…¶ä»–æœåŠ¡çš„ service hub</li><li>plugin registry ç”¨æ¥é€šè¿‡å®‰è£… CorDapps æ¥æ‰©å±•èŠ‚ç‚¹</li></ul><h4 id="1-0-12-2-æŒä¹…å±‚">1.0.12.2 æŒä¹…å±‚</h4><p>æŒä¹…å±‚åŒ…å«ä¸¤éƒ¨åˆ†ï¼š</p><ul><li>Vaultï¼ŒèŠ‚ç‚¹ç”¨æ¥å­˜å‚¨ç›¸å…³çš„å½“å‰å’Œå†å²çš„ states æ•°æ®</li><li>å­˜å‚¨æœåŠ¡ï¼Œç”¨æ¥å­˜å‚¨ transaction, attachment å’Œ flow checkpoints<br>èŠ‚ç‚¹çš„æ‰€æœ‰è€…å¯ä»¥é€šè¿‡ä½¿ç”¨ RPC æ¥å£æ¥æŸ¥è¯¢èŠ‚ç‚¹çš„ storageã€‚</li></ul><h4 id="1-0-12-3-ç½‘ç»œæ¥å£">1.0.12.3 ç½‘ç»œæ¥å£</h4><p>åŒç½‘ç»œä¸­çš„å…¶ä»–èŠ‚ç‚¹è¿›è¡Œæ²Ÿé€šæ˜¯èŠ‚ç‚¹è‡ªå·±æ¥å¤„ç†çš„ï¼Œä½œä¸ºè¿è¡Œä¸€ä¸ª flow çš„ä¸€éƒ¨åˆ†ã€‚èŠ‚ç‚¹çš„æ‰€æœ‰è€…ä¸ä¼šç›´æ¥åœ°åŒç½‘ç»œä¸­å…¶ä»–çš„èŠ‚ç‚¹è¿›è¡Œäº¤äº’ã€‚</p><h4 id="1-0-12-4-RPC-æ¥å£">1.0.12.4 RPC æ¥å£</h4><p>èŠ‚ç‚¹çš„æ‰€æœ‰è€…æ˜¯é€šè¿‡ä½¿ç”¨ Remote Procedure Calls(RPC) æ¥è·ŸèŠ‚ç‚¹è¿›è¡Œäº¤äº’çš„ã€‚å…³é”®çš„èŠ‚ç‚¹æš´éœ²çš„ RPC æ“ä½œå¯ä»¥æŸ¥çœ‹ <a href="https://cncorda.readthedocs.io/zh_CN/latest/api-rpc.html">API: RPC æ“ä½œ</a>ã€‚</p><h4 id="1-0-12-4-The-service-hub">1.0.12.4 The service hub</h4><p>åœ¨èŠ‚ç‚¹å†…éƒ¨ï¼ŒèŠ‚ç‚¹å¯ä»¥åœ¨ flow çš„æ‰§è¡Œè¿‡ç¨‹ä¸­è®¿é—®ä¸°å¯Œçš„æœåŠ¡æ¥ååŠ©æ›´æ–°è´¦æœ¬ã€‚ä¸»è¦çš„æœåŠ¡åŒ…æ‹¬ï¼š</p><ul><li>æœ‰å…³ç½‘ç»œä¸Šå…¶ä»–èŠ‚ç‚¹åŠå…¶æä¾›çš„æœåŠ¡çš„ä¿¡æ¯</li><li>è®¿é—® vault å’Œå­˜å‚¨æœåŠ¡çš„å†…å®¹</li><li>è®¿é—®å’Œç”ŸæˆèŠ‚ç‚¹çš„å…¬é’¥ç§é’¥å¯¹</li><li>èŠ‚ç‚¹æœ¬èº«çš„ä¿¡æ¯</li><li>èŠ‚ç‚¹è·Ÿè¸ªçš„å½“å‰æ—¶é—´</li></ul><h4 id="1-0-12-5-CorDapp-æä¾›è€…">1.0.12.5 CorDapp æä¾›è€…</h4><p>CorDapp æä¾›è€…æ˜¯æ–°çš„ CorDapps è¢«å®‰è£…çš„åœ°æ–¹ï¼Œæ¥æ‰©å±•èŠ‚ç‚¹çš„è¡Œä¸ºã€‚</p><p>èŠ‚ç‚¹é»˜è®¤ä¼šå®‰è£…ä¸€äº› CorDapps æ¥å¤„ç†ä¸€äº›å¸¸è§çš„ä»»åŠ¡ï¼Œæ¯”å¦‚ï¼š</p><ul><li>ä»åˆä½œæ–¹é‚£è¾¹è·å¾—äº¤æ˜“å’Œé™„ä»¶ä¿¡æ¯</li><li>æ›´æ–°åˆçº¦</li><li>å‘äº¤æ˜“å…¶ä»–æ–¹å¹¿æ’­åŒæ„çš„è´¦æœ¬æ›´æ–°ä¿¡æ¯</li></ul><h4 id="1-0-12-6-æ’ç©ºèŠ‚ç‚¹æ¨¡å¼">1.0.12.6 æ’ç©ºèŠ‚ç‚¹æ¨¡å¼</h4><p>ä¸ºäº†æ‰§è¡Œä¸€æ¬¡å¹²å‡€çš„å…³é—­èŠ‚ç‚¹æ“ä½œï¼Œæ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„ flows éå¸¸é‡è¦ï¼Œä¹Ÿå°±æ˜¯è¯´åº”è¯¥æ²¡æœ‰ä»»ä½•çš„ checkpoints è¢«æŒä¹…åŒ–ã€‚èŠ‚ç‚¹èƒ½å¤Ÿè¢«è®¾ç½®ä¸ºæ’ç©ºçŠ¶æ€ï¼Œåœ¨è¿™ä¸ªçŠ¶æ€ä¸­ï¼š</p><ul><li>é€šè¿‡ RPC è¦æ±‚çš„å¯åŠ¨æ–°çš„ flows çš„å‘½ä»¤ä¼šè¢«æ‹’ç»</li><li>é¢„çº¦çš„ flows ä¼šè¢«å¿½ç•¥</li><li>åˆå§‹åŒ– P2P çš„ä¼šè¯æ¶ˆæ¯å°†ä¸ä¼šè¢«å¤„ç†ï¼Œæ„å‘³ç€ peers å°†ä¸èƒ½å¤Ÿåˆå§‹åŒ–æ–°çš„ flows</li><li>å…¶ä»–æ‰€æœ‰çš„æ´»åŠ¨è¿˜ä¼šç…§å¸¸è¿›è¡Œï¼Œæ¥ç¡®ä¿æ­£åœ¨æ‰§è¡Œçš„ flows çš„æ•°é‡åœ¨ä¸æ–­å‡å°‘ã€‚</li></ul><p>å¯¹äºä»–ä»¬çš„æ•°é‡ - å¯ä»¥é€šè¿‡ RPC æ¥è¿›è¡Œç›‘æ§ - è¾¾åˆ°0ï¼Œé‚£ä¹ˆå°±æ˜¯å®‰å…¨çš„äº†ï¼Œå¯ä»¥è¿›è¡Œå…³é—­èŠ‚ç‚¹çš„æ“ä½œäº†ã€‚è¿™ä¸ªå±æ€§æ˜¯æŒä¹…çš„ï¼Œä¹Ÿå°±æ˜¯è¯´é‡æ–°å¯åŠ¨è¿™ä¸ªèŠ‚ç‚¹ä¹Ÿä¸ä¼šé‡ç½®è¿™ä¸ªå€¼åˆ°é»˜è®¤å’Œå€¼ï¼Œå¹¶ä¸”éœ€è¦ä¸€ä¸ª RPC å‘½ä»¤ã€‚</p><p>èŠ‚ç‚¹å¯ä»¥ä½¿ç”¨ shell æ¥è¢«æ’ç©ºç„¶åå®‰å…¨åœ°å…³é—­ã€‚</p><h3 id="1-0-13-Transaction-tear-offsï¼ˆäº¤æ˜“å‰¥ç¦»ï¼‰">1.0.13 Transaction tear-offsï¼ˆäº¤æ˜“å‰¥ç¦»ï¼‰</h3><ul><li>éšè—äº¤æ˜“ç»„ä»¶å‡ºäºéšç§ç›®çš„</li><li>Oracleå’ŒééªŒè¯å…¬è¯äººåªèƒ½çœ‹åˆ°å…¶â€œç›¸å…³â€äº¤æ˜“ç»„ä»¶ï¼Œè€Œä¸èƒ½çœ‹åˆ°å®Œæ•´çš„äº¤æ˜“è¯¦ç»†ä¿¡æ¯</li></ul><h3 id="1-0-13-1-æ€»è§ˆ">1.0.13.1 æ€»è§ˆ</h3><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œäº¤æ˜“ä¸­æ¶‰åŠçš„æŸäº›å®ä½“å¯èƒ½åªå¯¹äº¤æ˜“éƒ¨åˆ†å…·æœ‰éƒ¨åˆ†å¯è§æ€§ã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªç”²éª¨æ–‡åº”è¯¥ç­¾ç½²ä¸€ä¸ªäº¤æ˜“æ—¶ï¼Œå®ƒå”¯ä¸€éœ€è¦æŸ¥çœ‹çš„ä¿¡æ¯å°±æ˜¯ä¸è¯¥ç”²éª¨æ–‡å‘½ä»¤ç›¸å…³çš„åµŒå…¥å¼ä¿¡æ¯ã€‚åŒæ ·ï¼ŒééªŒè¯å…¬è¯äººåªéœ€è¦æŸ¥çœ‹äº¤æ˜“çš„è¾“å…¥çŠ¶æ€å³å¯ã€‚å‘Oracleæä¾›ä»»ä½•å…¶ä»–äº¤æ˜“æ•°æ®å°†æ„æˆéšç§æ³„æ¼ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿‡æ»¤äº¤æ˜“çš„æ¦‚å¿µï¼Œå…¶ä¸­äº¤æ˜“æè®®è€…ä½¿ç”¨åµŒå¥—çš„é»˜å…‹å°”æ ‘æ–¹æ³•â€œå‰¥ç¦»â€Oracles/Notrariesä¸éœ€è¦çš„äº¤æ˜“ä»»ä½•éƒ¨åˆ†ï¼Œç„¶åå†æäº¤ç»™ä»–ä»¬è¿›è¡Œç­¾åã€‚é»˜å…‹å°”æ ‘æ˜¯ä¸€ç§ä¼—æ‰€å‘¨çŸ¥çš„åŠ å¯†æ–¹æ¡ˆï¼Œé€šå¸¸ç”¨äºæä¾›åŒ…å«å’Œæ•°æ®å®Œæ•´æ€§çš„è¯æ˜ã€‚ Merkleæ ‘è¢«å¹¿æ³›ç”¨äºå¯¹ç­‰ç½‘ç»œï¼ŒåŒºå—é“¾ç³»ç»Ÿå’Œgitã€‚</p><p>é»˜å…‹å°”æ ‘çš„ä¼˜ç‚¹æ˜¯ï¼Œåœ¨å‘Oracleæäº¤äº¤æ˜“æ—¶è¢«å‰¥ç¦»çš„äº¤æ˜“éƒ¨åˆ†ä»¥åå°±æ— æ³•æ›´æ”¹ï¼Œè€Œåˆä¸ä¼šä½¿Oracleçš„æ•°å­—ç­¾åæ— æ•ˆã€‚</p><h3 id="1-0-13-2-Transaction-Merkle-trees">1.0.13.2 Transaction Merkle trees</h3><p>é€šè¿‡å°†transactionæ‹†åˆ†ä¸ºå¶å­ï¼Œä»transactionä¸­æ„é€ Merkleæ ‘ï¼Œå…¶ä¸­æ¯ä¸ªå¶å­åŒ…å«è¾“å…¥ï¼Œè¾“å‡ºï¼Œå‘½ä»¤æˆ–é™„ä»¶ã€‚æœ€ç»ˆçš„åµŒå¥—æ ‘ç»“æ„è¿˜åŒ…å«äº‹åŠ¡çš„å…¶ä»–å­—æ®µï¼Œä¾‹å¦‚æ—¶é—´çª—å£ï¼Œå…¬è¯äººå’Œå¿…éœ€çš„ç­¾åè€…ã€‚<br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå”¯ä¸€éœ€è¦ä¸¤æ£µæ ‘è€Œä¸æ˜¯ä¸€æ£µæ ‘çš„ç»„ä»¶ç±»å‹æ˜¯commandï¼Œä¸ºäº†å¯è§†æ€§ç›®çš„ï¼Œè¯¥å‘½ä»¤åˆ†ä¸ºå‘½ä»¤æ•°æ®å’Œå¿…éœ€çš„ç­¾åè€…ã€‚</p><p>Cordaä½¿ç”¨æ¯ç§ç»„ä»¶ç±»å‹çš„åµŒå¥—Merkleæ ‘ã€‚ç®€è€Œè¨€ä¹‹ï¼Œé’ˆå¯¹æ¯ç§ç»„ä»¶ç±»å‹ï¼ˆå³è¾“å…¥ï¼Œè¾“å‡ºï¼Œé™„ä»¶ï¼‰ç”Ÿæˆä¸€ä¸ªç»„ä»¶å­æ ‘ã€‚ç„¶åï¼Œè¿™äº›å­æ ‘çš„æ ¹å½¢æˆé¡¶éƒ¨çš„Merkleæ ‘çš„å¶å­ï¼Œæœ€åï¼Œè¯¥æ ‘çš„æ ¹ä»£è¡¨äº¤æ˜“IDã€‚</p><p>å¦ä¸€ä¸ªé‡è¦ç‰¹å¾æ˜¯ï¼Œä»¥æ¯ä¸ªéšæœºæ•°ç‹¬ç«‹çš„æ–¹å¼ä¸ºæ¯ä¸ªç»„ä»¶ç¡®å®šæ€§åœ°ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨éšæœºæ•°åŠå…¶å¯¹åº”çš„ç»„ä»¶æ¥è®¡ç®—ç»„ä»¶å“ˆå¸Œï¼Œå³å®é™…çš„Merkleæ ‘å¶ã€‚éœ€è¦ä½¿ç”¨éšæœºæ•°æ¥é˜²æ­¢æš´åŠ›æ”»å‡»ï¼Œå¦åˆ™å¯èƒ½ä¼šæ³„éœ²ä½ç†µæ•£åˆ—å€¼ï¼ˆå³å•ä¸ªå•è¯çš„æ–‡æœ¬é™„ä»¶ï¼‰çš„å†…å®¹ã€‚</p><p>è®¡ç®—å®Œå¶å­åï¼Œé€šè¿‡æ•£åˆ—å½“å‰èŠ‚ç‚¹ä¸‹é¢çš„å“ˆå¸Œå€¼çš„è¿æ¥ï¼Œä»¥æ­£å¸¸æ–¹å¼æ„å»ºæ¯æ£µMerkleæ ‘ã€‚</p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/merkleTreeFull.png" alt="img" style="zoom:60%;"><p>ä¸Šå›¾ä¸­çš„äº¤æ˜“æœ‰ä¸‰ä¸ªinputï¼Œä¸¤ä¸ªoutputï¼Œä¸¤ä¸ªcommandï¼Œä¸€ä¸ªattachmentï¼Œä¸€ä¸ªnotaryå’Œä¸€ä¸ª time-windowã€‚è¯·æ³¨æ„ï¼Œå¦‚æœæ ‘ä¸æ˜¯å®Œæ•´çš„äºŒå‰æ ‘ï¼Œåˆ™å°†å¶å­å¡«å……ä¸ºå…·æœ‰é›¶å“ˆå¸Œå€¼çš„æœ€æ¥è¿‘çš„2çš„å¹‚ï¼ˆå› ä¸ºæ‰¾åˆ°sha256ï¼ˆxï¼‰== 0çš„åŸåƒæ˜¯å›°éš¾çš„è®¡ç®—ä»»åŠ¡ï¼‰-ä¸Šé¢æ ‡è®°ä¸ºæµ…ç»¿è‰²ã€‚æœ€åï¼Œæ ¹çš„å“ˆå¸Œæ˜¯äº¤æ˜“çš„æ ‡è¯†ç¬¦ï¼Œå®ƒä¹Ÿç”¨äºç­¾åå’ŒéªŒè¯æ•°æ®å®Œæ•´æ€§ã€‚å¶å­çº§åˆ«ä¸Šçš„æ¯æ¬¡äº¤æ˜“æ›´æ”¹éƒ½ä¼šæ›´æ”¹å…¶æ ‡è¯†ç¬¦ã€‚</p><h3 id="1-0-13-3-Hiding-data">1.0.13.3 Hiding data</h3><p>éšè—æ•°æ®å¹¶æä¾›è¯æ˜å®ƒæ„æˆäº‹åŠ¡ä¸€éƒ¨åˆ†çš„è¯æ®æ˜¯é€šè¿‡æ„é€ éƒ¨åˆ†Merkleæ ‘ï¼ˆæˆ–Merkleåˆ†æ”¯ï¼‰æ¥å®Œæˆçš„ã€‚ Merkleåˆ†æ”¯æ˜¯ä¸€ç»„æ•£åˆ—ï¼Œæ ¹æ®å¶çš„æ•°æ®ï¼Œè¿™äº›æ•£åˆ—ç”¨äºè®¡ç®—æ ¹çš„æ•£åˆ—ã€‚ç„¶åï¼Œå°†è¯¥å“ˆå¸Œä¸æ•´ä¸ªäº¤æ˜“çš„å“ˆå¸Œè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå®ƒä»¬åŒ¹é…ï¼Œåˆ™æ„å‘³ç€æˆ‘ä»¬è·å¾—çš„æ•°æ®å±äºè¯¥ç‰¹å®šäº¤æ˜“ã€‚</p><p>å‡è®¾åªæœ‰ç¬¬ä¸€ä¸ªå‘½ä»¤å¯¹Oracleæ˜¯å¯è§çš„ã€‚æˆ‘ä»¬è¿˜åº”è¯¥ä¿è¯æ‰€æœ‰éœ€è¦è¯¥Oracleç­¾åçš„å‘½ä»¤å¯¹äºOracleå®ä½“éƒ½åº”è¯¥æ˜¯å¯è§çš„ï¼Œè€Œå…¶ä½™éƒ¨åˆ†åˆ™ä¸å¯è§ã€‚è¿™æ˜¯æ­¤è¿‡æ»¤åçš„äº¤æ˜“å°†å¦‚ä½•åœ¨Merkleæ ‘ç»“æ„ä¸­è¡¨ç¤ºçš„æ–¹å¼ã€‚</p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/SubMerkleTree_Oracle.png" alt="_images/SubMerkleTree_Oracle.png" style="zoom:30%;"><p>å‘OracleæœåŠ¡æä¾›äº†è“è‰²èŠ‚ç‚¹å’ŒH(c2)ï¼Œè€Œçœç•¥äº†é»‘è‰²èŠ‚ç‚¹ã€‚ HH(c2)æ˜¯å¿…éœ€çš„ï¼Œè¿™æ ·Oracleå¯ä»¥è®¡ç®—H(commandData)è€Œä¸å¿…çœ‹åˆ°ç¬¬äºŒæ¡å‘½ä»¤ï¼Œä½†åŒæ—¶ç¡®ä¿CommandData1æ˜¯äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ã€‚çªå‡ºæ˜¾ç¤ºæ‰€æœ‰ç­¾åè€…éƒ½æ˜¯å¯è§çš„ï¼Œä»¥è¯æ˜æ²¡æœ‰æ¶æ„åˆ é™¤ä»»ä½•ç›¸å…³å‘½ä»¤ï¼ˆOracleåº”è¯¥çœ‹åˆ°ï¼‰ã€‚æ­¤å¤–ï¼Œå½“å‰çš„Cordaåè®®ä¸­è¿˜æä¾›äº†å­æ ‘çš„å“ˆå¸Œï¼ˆç´«è‰²èŠ‚ç‚¹ï¼‰ã€‚åœ¨ç‰¹æ®Šæƒ…å†µä¸‹éœ€è¦çŸ¥é“ä»–ä»¬ä¸‹é¢çš„æ•°æ®ï¼Œä¾‹å¦‚éœ€è¦çŸ¥é“ç»„ä»¶ç»„æ˜¯å¦ä¸ºç©ºæ—¶ã€‚</p><p>åŒæ ·ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å°†åŒä¸€äº¤æ˜“å‘é€ç»™ééªŒè¯notaryï¼Œåˆ™åº”éšè—é™¤è¾“å…¥çŠ¶æ€ï¼Œæ—¶é—´çª—å£å’Œå…¬è¯äººä¿¡æ¯ä¹‹å¤–çš„æ‰€æœ‰ç»„ä»¶ã€‚è¯¥æ•°æ®è¶³ä»¥ä½¿å…¬è¯äººçŸ¥é“åº”æ£€æŸ¥å“ªäº›input statuesè¿›è¡ŒåŒèŠ±ï¼Œæ—¶é—´çª—å£æ˜¯å¦æœ‰æ•ˆä»¥åŠæ­¤äº‹åŠ¡æ˜¯å¦åº”ç”±è¯¥notaryå…¬è¯ã€‚</p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/SubMerkleTree_Notary.png" alt="_images/SubMerkleTree_Notary.png" style="zoom:30%;"><h3 id="1-0-14-æƒè¡¡">1.0.14 æƒè¡¡</h3><ul><li><em>è®¸å¯çš„ç½‘ç»œä¼šæ›´å¥½çš„é€‚åˆé‡‘èçš„ user-cases</em></li><li><em>ç‚¹å¯¹ç‚¹çš„é€šä¿¡å…è®¸ä¿¡æ¯æ˜¯åŸºäºéœ€è¦çŸ¥é“çš„åŸåˆ™è¢«å…±äº«</em></li><li><em>UTXO model å…è®¸æ¯ç§’é’Ÿèƒ½å¤Ÿå¤„ç†æ›´å¤šçš„ transactions</em></li></ul><h4 id="1-0-14-1-éœ€è¦è®¸å¯-vs-å’Œä¸éœ€è¦è®¸å¯çš„">1.0.14.1 éœ€è¦è®¸å¯ vs å’Œä¸éœ€è¦è®¸å¯çš„</h4><p>ä¼ ç»Ÿçš„ blockchain æ˜¯ ä¸éœ€è¦è®¸å¯ çš„ã€‚ç½‘ç»œä¸­çš„å„æ–¹éƒ½æ˜¯åŒ¿åçš„ï¼Œè€Œä¸”å¯ä»¥éšæ—¶åŠ å…¥æˆ–ç¦»å¼€ã€‚</p><p>ä¸åŒçš„æ˜¯ï¼Œ Corda ç½‘ç»œæ˜¯ éœ€è¦è®¸å¯ çš„ã€‚ç½‘ç»œä¸­çš„æ¯ä¸€æ–¹éƒ½æœ‰ä¸€ä¸ªå¤§å®¶éƒ½çŸ¥é“çš„æ ‡è¯†ï¼Œè¿™ä¸ªä¼šåœ¨åŒå…¶ä»–èŠ‚ç‚¹è¿›è¡Œæ²Ÿé€šçš„æ—¶å€™ä½¿ç”¨ï¼Œå¹¶ä¸”è®¿é—®ç½‘ç»œæ˜¯ç”±ä¸€ä¸ª doorman æ¥æ§åˆ¶çš„ã€‚è¿™æœ‰ä¸€ä¸‹çš„å¥½å¤„ï¼š</p><ul><li>åŒ¿åçš„ç”¨æˆ·å¯¹äºå¤§å¤šæ•°è·Ÿé‡‘èæœ‰å…³çš„æƒ…å†µéƒ½æ˜¯ä¸é€‚ç”¨çš„</li><li>çŸ¥é“ä½ çš„åˆä½œæ–¹çš„èº«ä»½å¯ä»¥å…è®¸å½“å‡ºç°å†²çªçš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨å·²ç»å­˜åœ¨çš„æ³•å¾‹ç³»ç»Ÿåœ¨è´¦æœ¬å¤–è¿›è¡Œè§£å†³</li><li>å¯ä»¥ä¸é€šè¿‡ä½¿ç”¨æ˜‚è´µçš„æœºåˆ¶ï¼ˆæ¯”å¦‚å·¥ä½œé‡è¯æ˜ proof-of-workï¼‰æ¥é¿å…å¥³å·«æ”»å‡»ï¼ˆSybil attacksï¼‰</li></ul><h4 id="1-0-14-2-ç‚¹å¯¹ç‚¹-vs-å…¨å±€å¹¿æ’­">1.0.14.2 ç‚¹å¯¹ç‚¹ vs å…¨å±€å¹¿æ’­</h4><p>ä¼ ç»Ÿçš„ blockchain networks å°†æ¯ä¸€æ¡ä¿¡æ¯å¹¿æ’­ç»™ç½‘ç»œä¸Šçš„æ‰€æœ‰å‚ä¸è€…ã€‚åŸå› æ˜¯ï¼š</p><ul><li>åˆä½œæ–¹çš„èº«ä»½æ˜¯ä¸çŸ¥é“çš„ï¼Œæ‰€ä»¥ä¸€æ¡æ¶ˆæ¯éœ€è¦å‘ç»™ç½‘ç»œä¸Šçš„æ‰€æœ‰äººæ¥ç¡®ä¿åŸæœ¬éœ€è¦æ”¶åˆ°è¿™æ¡æ¶ˆæ¯çš„æ¥å—è€…èƒ½å¤Ÿæ¥æ”¶åˆ°</li><li>è®©æ‰€æœ‰å‚ä¸è€…çŸ¥é“æ¯ä¸€ä¸ª transaction èƒ½å¤Ÿå…è®¸ç½‘ç»œé˜²æ­¢â€œåŒèŠ±â€<br>ä¸å¥½çš„åœ°æ–¹æ˜¯æ‰€æœ‰çš„å‚ä¸è€…éƒ½èƒ½çœ‹åˆ°æ‰€æœ‰å…¶ä»–äººçš„æ•°æ®ã€‚è¿™åœ¨å¾ˆå¤šçš„ use-cases æ˜¯æ— æ³•æ¥å—çš„ã€‚</li></ul><p>åœ¨ Corda ä¸­ï¼Œæ¯æ¡æ¶ˆæ¯éƒ½ä¼šæŒ‡å®šä¸€ä¸ªå…·ä½“çš„åˆä½œæ–¹ï¼Œè€Œä¸”æ˜¯ä¸ä¼šè¢«ä»»ä½•å…¶ä»–æ— å…³æ–¹çœ‹åˆ°çš„ã€‚å¼€å‘è€…èƒ½å¤Ÿå®Œå…¨æŒæ§ä»€ä¹ˆæ¶ˆæ¯è¢«å‘é€äº†ï¼Œå‘é€ç»™äº†è°ï¼Œåº”è¯¥æŒ‰ç…§ä»€ä¹ˆé¡ºåºå‘é€ã€‚æ‰€ä»¥ æ•°æ®æ˜¯æ ¹æ®éœ€è¦çŸ¥é“çš„åŸåˆ™æ¥å…±äº«çš„ã€‚ä¸ºäº†é¿å…â€œåŒèŠ±â€ï¼Œæˆ‘ä»¬å¼•å…¥äº† notaries æ¥æ›¿æ¢æ‰å·¥ä½œé‡è¯æ˜ï¼ˆproof-of-workï¼‰ã€‚</p><p>Corda ä¹Ÿæ˜¯ç”¨äº†å…¶ä»–çš„ä¸€äº›æŠ€æœ¯æ¥æœ€å¤§åŒ–çš„åŒ…æ‹¬ç½‘ç»œä¸Šçš„éšç§ï¼š</p><ul><li><strong>Transaction éšè—</strong>ï¼šTransactions è¢«ç»“æ„åŒ–æˆä¸æš´éœ² transaction çš„å†…å®¹å°±å¯ä»¥è¢«æ•°å­—åŒ–åœ°ç­¾åã€‚è¿™ä¸ªæ˜¯é€šè¿‡ä½¿ç”¨ä¸€ç§å«é»˜å…‹å°”æ ‘çš„æ•°æ®ç»“æ„æ¥å®ç°çš„ã€‚</li><li><strong>éšæœºåŒ–ç§˜é’¥</strong>ï¼šä¸€ä¸ª transaction çš„æ‰€æœ‰å‚ä¸æ–¹æ˜¯é€šè¿‡ä»–ä»¬çš„å…¬é’¥è¿›è¡Œè¯†åˆ«çš„ï¼Œå¹¶ä¸”é’ˆå¯¹æ¯ä¸€ä¸ª transaction éƒ½ä¼šç”Ÿæˆ ä¸€ä¸ªæ–°çš„ keypairsã€‚æ‰€ä»¥ä¸€ä¸ªç›‘è§†è€…æ— æ³•è¯†åˆ«å‡ºæ¥å¯¹äºä¸€ä¸ªç»™å®š transaction éƒ½å“ªäº›æ–¹å‚ä¸äº†ã€‚</li></ul><h4 id="1-0-14-3-UTXO-vs-è´¦æˆ·æ¨¡å‹">1.0.14.3 UTXO vs. è´¦æˆ·æ¨¡å‹</h4><p>Corda ä½¿ç”¨ <em>UTXO</em>ï¼ˆUnspent Transaction Outputï¼‰modelã€‚æ¯ä¸ª transaction éƒ½ä¼šæ¶ˆè´¹ä¸€ç³»åˆ—çš„å·²ç»å­˜åœ¨çš„ states ç„¶åå†ç”Ÿæˆä¸€äº›æ–°çš„ statesã€‚</p><p>ç›¸åçš„ä¸€ç§æ–¹å¼æ˜¯ è´¦æˆ· æ¨¡å‹ã€‚åœ¨è´¦æˆ·æ¨¡å‹ä¸­ï¼Œstateful å¯¹è±¡è¢«å­˜åœ¨è´¦æœ¬ä¸Šï¼Œtransaction ä¼šé€šè¿‡è¯·æ±‚çš„æ–¹å¼æ¥å¯¹è¿™äº›å¯¹è±¡çš„å½“å‰çš„ state è¿›è¡Œæ›´æ–°ã€‚</p><p>UTXO æ¨¡å‹çš„ä¸»è¦ä¼˜ç‚¹åœ¨äºå«æœ‰ä¸åŒçš„ inputs çš„ transactions èƒ½å¤Ÿå¹¶è¡Œåœ°è¢«æ‰§è¡Œï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šåœ°å¢åŠ äº†ç½‘ç»œä¸­æ¯ç§’èƒ½å¤Ÿå¤„ç†çš„ transactionsã€‚åœ¨è´¦æˆ·æ¨¡å‹ä¸­ï¼Œæ¯ç§’é’Ÿèƒ½å¤Ÿå¤„ç†çš„ transactions æ•°é‡æœ‰é™ï¼Œå› ä¸ºå¯¹äºä¸€ä¸ªç»™å®šçš„ object çš„æ›´æ–°éœ€è¦æŒ‰ç…§ç»™å®šçš„é¡ºåºæ¥æ‰§è¡Œã€‚</p><h4 id="1-0-14-4-ä»£ç å³æ³•å¾‹-vs-æ—¢æœ‰çš„æ³•å¾‹ç³»ç»Ÿ">1.0.14.4 ä»£ç å³æ³•å¾‹ vs. æ—¢æœ‰çš„æ³•å¾‹ç³»ç»Ÿ</h4><p>é‡‘èä½“ç³»éœ€è¦åœ¨éœ€è¦çš„æ—¶å€™ä½¿ç”¨ä¼ ç»Ÿçš„æ³•å¾‹ä½“ç³»æ¥è§£å†³å†²çªçš„èƒ½åŠ›ã€‚Corda è¢«è®¾è®¡ç”¨æ¥ä½¿è¿™ä¸ªæˆä¸ºå¯èƒ½ï¼š</p><ul><li>æ‹¥æœ‰éœ€è¦å‡†å…¥çš„ç½‘ç»œï¼Œæ„å‘³ç€æ‰€æœ‰å‚ä¸æ–¹éƒ½èƒ½å¤ŸçŸ¥é“åœ¨æ¯ä¸€ä¸ª transaction ä¸­ä»–ä»¬éƒ½åœ¨è·Ÿè°æ‰“äº¤é“</li><li>æ‰€æœ‰ä»£ç åˆçº¦èƒŒåéƒ½å­˜åœ¨æœ‰æè¿°ç€åˆçº¦æ„å›¾è¡Œä¸ºçš„æ³•å¾‹æ–‡æ¡£ï¼Œè¿™ä¸ªæ–‡æ¡£å¯ä»¥åœ¨è§£å†³å†²çªçš„æ—¶å€™ä½¿ç”¨</li></ul><h4 id="1-0-14-5-æ„å»º-vs-é‡ç”¨">1.0.14.5 æ„å»º vs. é‡ç”¨</h4><p>ä»»ä½•å¯èƒ½çš„æƒ…å†µï¼ŒCorda ä¼šä½¿ç”¨ å·²ç»å­˜åœ¨çš„æŠ€æœ¯æ¥è®©è¿™ä¸ªå¹³å°æ›´åŠ çš„å¥å£®ã€‚æ¯”å¦‚ Corda é‡ç”¨äº†ï¼š</p><ul><li>ç”¨äºå¼€å‘CorDappsçš„æ ‡å‡†JVMç¼–ç¨‹è¯­è¨€</li><li>å·²ç»å­˜åœ¨çš„ SQL database</li><li>å·²ç»å­˜åœ¨çš„ æ¶ˆæ¯é˜Ÿåˆ—å®ç°</li></ul><h3 id="1-0-15-Deterministic-JVM">1.0.15 <a href="https://cncorda.readthedocs.io/zh_CN/latest/key-concepts-djvm.html">Deterministic JVM</a></h3><p><strong>ä¸ªäººç†è§£</strong>ï¼šä¸ºäº†è¾¾æˆå…±è¯†ï¼ŒCordaè¦æ±‚æ‰€æœ‰çš„èŠ‚ç‚¹è¿è¡Œç›¸åŒçš„JVMæ²™ç®±ï¼Œå«åšDJVMï¼›DJVMä¸ºäº†è®©æ™ºèƒ½åˆçº¦çš„ä»£ç æ¯æ¬¡æ‰§è¡Œçš„ç»“æœéƒ½ç›¸åŒè€Œåšäº†ä¸€äº›é™åˆ¶ã€‚</p><h2 id="1-1-å¼€å‘è¯­è¨€è¯­è¨€æ˜¯ä»€ä¹ˆï¼Ÿ">1.1 å¼€å‘è¯­è¨€è¯­è¨€æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul><li>å¼€å‘è¯­è¨€ä¸æ™ºèƒ½åˆçº¦çš„è¯­è¨€éƒ½æ˜¯ä½¿ç”¨ JVM ç¼–ç¨‹è¯­è¨€ç¼–å†™ï¼ˆjava æˆ–è€… kotlinï¼‰</li><li>æºç ä½¿ç”¨kotlinè¯­è¨€ç¼–å†™</li></ul><h2 id="1-2-ç½‘ç»œæ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ">1.2 ç½‘ç»œæ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</h2><p>å¯ä»¥é€‰æ‹©åŠ å…¥<a href="https://corda.network/">corda.network</a>ï¼ŒCorda Networkç”±æ€»éƒ¨ä½äºè·å…°çš„éè¥åˆ©åŸºé‡‘ä¼šç®¡ç†ã€‚ Corda Networkå‚ä¸è€…æœ‰èµ„æ ¼æŠ•ç¥¨å¹¶ä»£è¡¨åŸºé‡‘ä¼šè‘£äº‹ä¼šåšå‡ºé‡è¦å†³å®šï¼ŒåŒ…æ‹¬ç½‘ç»œæ ‡å‡†ï¼Œå‚æ•°å’Œæ”¿ç­–ã€‚</p><p>æˆ–è€…æ­å»ºè‡ªå·±çš„ç§æœ‰ç½‘ç»œï¼Œ<a href="https://www.r3.com/download-corda-enterprise-network-manager/">ä¸‹è½½cordaç½‘ç»œç®¡ç†è½¯ä»¶ï¼Œéœ€è¦å¡«å†™ä¿¡æ¯</a></p><h2 id="1-3-Cordaæ˜¯å¦‚ä½•è¾¾æˆå…±è¯†çš„ï¼Ÿ">1.3 Cordaæ˜¯å¦‚ä½•è¾¾æˆå…±è¯†çš„ï¼Ÿ</h2><p>å‡å¦‚Aå‘èµ·ä¸€ä¸ªäº¤æ˜“ç»™Bè½¬è´¦500å…ƒï¼Œé‚£ä¹ˆAéœ€è¦æäº¤ä¸€ä¸ªäº¤æ˜“ï¼ˆtransactionï¼‰å¹¶ç­¾åï¼›ç„¶åæŠŠäº¤æ˜“å‘é€ç»™Bï¼ˆå¦‚æœéœ€è¦Notaryå’ŒOracleå‚ä¸ä¹Ÿä¼šæŠŠneed-to-knowçš„éƒ¨åˆ†å‘é€ç»™ä»–ä»¬ï¼‰ï¼›BéªŒè¯äº¤æ˜“æ²¡æœ‰é—®é¢˜ï¼ˆåŒ…æ‹¬æ•´ä¸ªäº¤æ˜“é“¾ã€æ™ºèƒ½åˆçº¦æ˜¯å¦éªŒè¯é€šè¿‡ã€æ˜¯å¦åŒæ„å½“å‰çš„äº¤æ˜“ã€Notaryå’ŒOracleæ˜¯å¦ç­¾åç­‰ï¼‰å°±ä¼šæä¾›ç­¾åç„¶åæäº¤è¿™æ¬¡äº¤æ˜“ã€‚å¹¶æŠŠç­¾ååçš„äº¤æ˜“å‘é€ç»™Aï¼ŒAä¹Ÿæ‰§è¡Œç›¸åŒçš„æäº¤äº¤æ˜“åŠ¨ä½œã€‚</p><img src="https://gitee.com/zheshiyigegexingwangzhan/images/raw/master/flow-sequence.png" alt="_images/flow-sequence.png" style="zoom:30%;"><h2 id="1-4-CorDappsæ˜¯ä»€ä¹ˆï¼Ÿ">1.4 CorDappsæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>CorDappsæ˜¯ä»¥pluginçš„å½¢å¼è¿è¡Œåœ¨nodeä¸Šçš„â€œåº”ç”¨â€ï¼›ä¸€ä¸ªnodeå¯ä»¥æœ‰å¤šä¸ªCorDappsï¼Œæ¯”å¦‚ä¸€ä¸ªé“¶è¡Œçš„nodeå¯ä»¥æ—¢æœ‰è´·æ¬¾çš„CorDappï¼Œä¹Ÿæœ‰å­˜æ¬¾çš„CorDappã€‚</p><p>CorDappåŒ…å«state, transaction, contractå’Œflowç±»ã€‚</p><h2 id="1-5-Cordaçš„éšç§ä¿æŠ¤æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ">1.5 Cordaçš„éšç§ä¿æŠ¤æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ</h2><h3 id="1-5-1-åœ¨ç½‘ç»œä¸­çš„å„èŠ‚ç‚¹ä¹‹é—´çš„éšç§ä¿æŠ¤">1.5.1 åœ¨ç½‘ç»œä¸­çš„å„èŠ‚ç‚¹ä¹‹é—´çš„éšç§ä¿æŠ¤</h3><p>Cordaçš„ç½‘ç»œéœ€è¦ç”³è¯·åŠ å…¥å¹¶ä¸”å¯¹åº”äº†ç°å®ä¸–ç•Œä¸­çš„ä¸€ä¸ªåˆæ³•èº«ä»½ï¼Œæ‰€ä»¥ä¸å¯ä»¥æŠŠäº¤æ˜“ä¿¡æ¯å…¬å¼€ã€‚</p><p>Cordaçš„äº¤æ˜“æ˜¯é€šè¿‡ä¸€ä¸ªèŠ‚ç‚¹å‘èµ·çš„ï¼Œé™¤äº†äº¤æ˜“æ¶‰åŠçš„å…¶ä»–èŠ‚ç‚¹çŸ¥é“å…¨éƒ¨çš„äº¤æ˜“å†…å®¹ï¼›å’ŒOracleä»¥åŠNotaryçŸ¥é“äº¤æ˜“çš„éƒ¨åˆ†éœ€è¦éªŒè¯çš„å†…å®¹ä¹‹å¤–ï¼Œå¯¹å…¶ä»–èŠ‚ç‚¹æ¥è¯´æ˜¯ä¸çŸ¥é“è¿™ä¸ªäº¤æ˜“çš„ã€‚æ‰€ä»¥åœ¨éšç§æ€§æ–¹é¢æ˜¯æ¯”è¾ƒå¥½çš„ã€‚</p><p><em>æ¯”ç‰¹å¸å’Œä»¥å¤ªåŠä¸­çš„èº«ä»½ä¿¡æ¯ä¸ç°å®ä¸–ç•Œçš„èº«ä»½æ˜¯æ²¡æœ‰å¯¹åº”å…³ç³»çš„ï¼Œæ‰€ä»¥æŠŠæ‰€æœ‰çš„è´¦æˆ·å’Œäº¤æ˜“ä¿¡æ¯æ”¾åœ¨äº’è”ç½‘ä¸Šä¹Ÿæ˜¯å®‰å…¨çš„ã€‚</em></p><h3 id="1-5-2-åœ¨éªŒè¯åŒèŠ±å’Œä¾èµ–Oracleç­¾åæ—¶çš„éšç§ä¿æŠ¤">1.5.2 åœ¨éªŒè¯åŒèŠ±å’Œä¾èµ–Oracleç­¾åæ—¶çš„éšç§ä¿æŠ¤</h3><p>Cordaé€šè¿‡<strong>Transaction tear-offs</strong>çš„æ–¹å¼åœ¨éœ€è¦Notaryåšå”¯ä¸€æ€§æ ¡éªŒæˆ–éœ€è¦Oracleæä¾›ç­¾åæ—¶ï¼Œæä¾›çš„åªæœ‰need-to-knowçš„éƒ¨åˆ†ï¼Œå¹¶ä¸åŒ…å«äº¤æ˜“çš„æ‰€æœ‰å†…å®¹ï¼Œæ‰€ä»¥éšç§å¾—åˆ°äº†ä¿æŠ¤ã€‚</p><h2 id="1-6-Cordaäº¤æ˜“çš„å®æ—¶æ€§æ€ä¹ˆæ ·ï¼Ÿ">1.6 Cordaäº¤æ˜“çš„å®æ—¶æ€§æ€ä¹ˆæ ·ï¼Ÿ</h2><p>Cordaäº¤æ˜“ç›¸è¾ƒäºæ¯”ç‰¹å¸å’Œä»¥å¤ªåŠæ¥è¯´æ¯”è¾ƒå®æ—¶ï¼Œå› ä¸ºCordaä¸å¿…ç­‰å¾…æŒ–çŸ¿åªè¦äº¤æ˜“è¢«æ ¡éªŒé€šè¿‡ï¼Œæ‰€æœ‰äººéƒ½ç­¾äº†åå°±å†™åœ¨äº†åŒºå—é“¾ä¸Šäº†ã€‚ï¼ˆä»¥å¤ªåŠå’Œæ¯”ç‰¹å¸éœ€è¦åœ¨æŒ–åˆ°çŸ¿ä¹‹åæ‰“åŒ…å¾ˆå¤šä¸ªäº¤æ˜“ï¼Œæ‰€ä»¥å®æ—¶æ€§ä¼šå·®ä¸€äº›ï¼‰</p><h2 id="1-7-Cordaä¸­æ˜¯å¦æœ‰ä»¥å¤ªåŠä¸­çš„è´¦æœ¬çš„æ¦‚å¿µï¼Ÿ">1.7 Cordaä¸­æ˜¯å¦æœ‰ä»¥å¤ªåŠä¸­çš„è´¦æœ¬çš„æ¦‚å¿µï¼Ÿ</h2><p><strong>ä¸ªäººç†è§£</strong>ï¼šCordaä¹Ÿæœ‰è´¦æœ¬çš„æ¦‚å¿µï¼Œä½†æ˜¯Cordaè´¦æœ¬æ‰€åŒ…å«çš„å†…å®¹è¿œæ¯”ä»¥å¤ªåŠçš„è´¦æœ¬ï¼ˆåªæœ‰ä½™é¢ï¼‰è¦å¤šï¼›Cordaçš„è´¦æœ¬æœ‰å¾ˆå¤šä¸åŒç±»å‹çš„stateï¼ŒCordaåªä¿ç®¡äº†å½“å‰çš„stateå’Œå†å²stateï¼Œä½†æ˜¯Cordaæ²¡æœ‰ä¸€ä¸ªæ±‡æ€»çš„æ˜¾ç¤ºä½™é¢çš„â€œè´¦æœ¬â€ï¼›åº”è¯¥å¯ä»¥åœ¨è´¦æœ¬å¤–è®°å½•ã€‚</p><h2 id="1-8-Cordaä¸­è´¦æˆ·ï¼ˆAccountsï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ">1.8 Cordaä¸­è´¦æˆ·ï¼ˆAccountsï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>Cordaä¸­çš„Accountsæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„æ¦‚å¿µï¼Œå€¼å¾—æ˜¯ä¸€ä¸ªèŠ‚ç‚¹çš„Vaultçš„statesæ‰“ä¸Šæ ‡ç­¾æ¥è¡¨ç¤ºå½’å±çš„è´¦æˆ·ï¼›è¿™ä¸ªè´¦æˆ·å’ŒèŠ‚ç‚¹çš„è´¦æˆ·ä¸ä¸€æ ·ï¼ŒAccountå°±åƒä¸ªäººåœ¨é“¶è¡Œï¼ˆèŠ‚ç‚¹ï¼‰å¼€çš„è´¦æˆ·ï¼ˆAccountï¼‰ã€‚</p><h2 id="1-9-Cordaå¯ä»¥å‘å¸ƒå¸å—ï¼Ÿå¯ä»¥æŒ–çŸ¿å—ï¼Ÿ">1.9 Cordaå¯ä»¥å‘å¸ƒå¸å—ï¼Ÿå¯ä»¥æŒ–çŸ¿å—ï¼Ÿ</h2><p>æ²¡æœ‰æ•°å­—è´§å¸ï¼Œå› æ­¤ä¹Ÿä¸èƒ½æŒ–çŸ¿ã€‚å› ä¸ºå…±è¯†åè®®ä¹Ÿå¹¶ä¸æ˜¯é€šè¿‡å·¥ä½œé‡è¯æ˜å®Œæˆï¼Œè€Œæ˜¯é€šè¿‡äº¤æ˜“çš„æ¶‰åŠæ–¹å’Œä¸€äº›å…¬è¯äººå’ŒOracleæ¥è¾¾æˆå…±è¯†çš„ï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦æŒ–çŸ¿ã€‚</p><h2 id="1-10-Cordaçš„Contractå’Œä»¥å¤ªåŠä¸­çš„æ™ºèƒ½åˆçº¦æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">1.10 Cordaçš„Contractå’Œä»¥å¤ªåŠä¸­çš„æ™ºèƒ½åˆçº¦æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><h3 id="ä¸åŒç‚¹ï¼š">ä¸åŒç‚¹ï¼š</h3><p>Cordaçš„Contractä¸»è¦æ˜¯ä¸ºäº†æ¥åšéªŒè¯äº¤æ˜“æ˜¯å¦æ­£ç¡®çš„ï¼Œä¸å¯ä»¥åšä»¥å¤ªåŠæ™ºèƒ½åˆçº¦çš„è½¬è´¦çš„æ“ä½œã€‚</p><p>ä»¥å¤ªåŠä¸­çš„æ™ºèƒ½åˆçº¦æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è´¦æˆ·ï¼Œé‡Œé¢æœ‰ä½™é¢ã€äº¤æ˜“æ¬¡æ•°ã€ä»£ç ã€å­˜å‚¨ç­‰ï¼›ä½†æ˜¯Cordaçš„Contractåªæœ‰ä»£ç ï¼Œåªç”¨æ¥éªŒè¯äº¤æ˜“æ˜¯å¦æ­£ç¡®ã€‚</p><h3 id="ç›¸åŒç‚¹ï¼š">ç›¸åŒç‚¹ï¼š</h3><p>åªè¦æ‰§è¡Œä¸­é‡åˆ°å¼‚å¸¸å°±è¡¨ç¤ºéªŒè¯ä¸é€šè¿‡ï¼›èƒ½å¤Ÿè¯æ˜äº¤æ˜“éæ³•ï¼ˆä¸ç¬¦åˆåˆçº¦å†…å®¹ï¼‰ã€‚</p><h1 id="3ã€å¦‚ä½•åŸºäºCordaæ„å»ºåº”ç”¨">3ã€å¦‚ä½•åŸºäºCordaæ„å»ºåº”ç”¨</h1><p>è¯¦æƒ…æŸ¥çœ‹ï¼š</p><ol><li><p><a href="3%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AACorDapp.md">å¦‚ä½•å¼€å‘ä¸€ä¸ªCorDapp</a></p></li><li><p><a href="4%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AACorda%E7%BD%91%E7%BB%9C.md">å¦‚ä½•æ­å»ºä¸€ä¸ªCordaç½‘ç»œ</a></p></li></ol><h1 id="4ã€Cordaæ±‡æ€»">4ã€Cordaæ±‡æ€»</h1><h2 id="Cordaä¼˜ç‚¹">Cordaä¼˜ç‚¹</h2><ul><li>éšç§ä¿æŠ¤åšçš„å¾ˆå¥½ï¼Œäº¤æ˜“åªæœ‰æ¶‰åŠåˆ°çš„èŠ‚ç‚¹æ‰çŸ¥é“</li><li>æä¾›äº†ä¸€äº›é€šç”¨çš„Stateç±»ï¼Œå¦‚ç°é‡‘ã€å•†å“ã€å•†ä¸šç¥¨æ®ã€åˆ©ç‡äº¤æ¢ã€å€ºåŠ¡ç­‰</li><li>å¼€å‘CorDappç®€å•ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Javaå¼€å‘å¹¶ä¸”æœ‰æ¨¡æ¿å’Œå¥—è·¯å¯å¾ª</li></ul>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
          <category> Corda </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
            <tag> Corda </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŒºå—é“¾çš„å­¦ä¹ è®¡åˆ’</title>
      <link href="2021/04/01/blockchain/0%E5%8C%BA%E5%9D%97%E9%93%BE%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/"/>
      <url>2021/04/01/blockchain/0%E5%8C%BA%E5%9D%97%E9%93%BE%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/</url>
      
        <content type="html"><![CDATA[<p>é™¤äº†è¿™äº›ä½ è¿˜éœ€è¦å­¦ä¹ ä»€ä¹ˆï¼Ÿ</p><ul><li>X.509</li><li>TLS/SSL</li><li>åˆ†ç‰‡ï¼ˆä»¥å¤ªåŠä¸­æœ‰æ­¤æ¦‚å¿µã€å¸ƒæ¯”åŒºå—é“¾ä¹Ÿæœ‰ï¼‰</li><li>è·¨é“¾æ˜¯å¦‚ä½•å®ç°çš„</li><li>å›½å¯†ä»å“ªé‡Œèƒ½æ‰¾åˆ°ï¼Œæœ‰æ²¡æœ‰å¼€æºä¸æ ‡å‡†</li><li>DeFiæ˜¯ä»€ä¹ˆï¼Ÿ</li></ul><p>ä¸€ä¸ªåŒºå—é“¾å…¬å¸éœ€è¦å“ªäº›ï¼š</p><p><img src="https://gitee.com/guozhe001/images/raw/master/%E5%8C%BA%E5%9D%97%E9%93%BE%E5%85%AC%E5%8F%B8%E8%B0%83%E7%A0%94%E5%88%86%E6%9E%90.png" alt="åŒºå—é“¾å…¬å¸è°ƒç ”åˆ†æ"></p><p>ä¸šåŠ¡æŒç»­å­¦ä¹ ï¼š</p><ul><li>ä¿ç†æ¨¡å¼</li><li>æ‰¿å…‘æ±‡ç¥¨</li><li>æ¸…åˆ†</li><li>åº”æ”¶è´¦æ¬¾</li><li>è´´ç°</li><li>æ‹†è½¬è</li><li>ABS</li></ul>]]></content>
      
      
      <categories>
          
          <category> blockchain </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blockchain </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="2021/04/01/blockchain/1%E5%8C%97%E4%BA%AC%E5%A4%A7%E5%AD%A6%E8%82%96%E8%87%BB%E8%80%81%E5%B8%88%E3%80%8A%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/"/>
      <url>2021/04/01/blockchain/1%E5%8C%97%E4%BA%AC%E5%A4%A7%E5%AD%A6%E8%82%96%E8%87%BB%E8%80%81%E5%B8%88%E3%80%8A%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<hr><p>title: åŒ—äº¬å¤§å­¦è‚–è‡»è€å¸ˆã€ŠåŒºå—é“¾æŠ€æœ¯ä¸åº”ç”¨ã€‹å­¦ä¹ æ€»ç»“<br>tags:</p><ul><li>blockchain</li><li>åŒ—äº¬å¤§å­¦</li><li>æ¯”ç‰¹å¸</li><li>ä»¥å¤ªåŠ<br>categories:</li><li>blockchain</li></ul><h1 id="3-æ•°æ®ç»“æ„">3 æ•°æ®ç»“æ„</h1><h2 id="hash-printers-ï¼ˆhashæŒ‡é’ˆï¼‰">hash printers ï¼ˆhashæŒ‡é’ˆï¼‰</h2><p>hashæŒ‡é’ˆæ—¢å¯ä»¥æ‰¾åˆ°å—çš„ä½ç½®ï¼Œä¹Ÿå¯ä»¥éªŒè¯hashçš„æ­£ç¡®æ€§</p><h3 id="Block-chain-is-a-linked-list-using-hash-pointers">Block chain is a linked list using hash pointers</h3><p>æ¯ä¸€ä¸ªåŒºå—éƒ½åŒ…å«å‰ä¸€ä¸ªåŒºå—çš„hashæŒ‡é’ˆ</p><ul><li>åé¢ä¸€ä¸ªåŒºå—çš„hashæŒ‡é’ˆæ˜¯é€šè¿‡å‰ä¸€ä¸ªåŒºå—çš„å€¼ç®—å‡ºæ¥çš„ã€‚</li><li>é€šè¿‡ä¸Šé¢çš„æ•°æ®ç»“æ„å¯ä»¥å®ç°ï¼štamper-evident-log</li></ul><p>åªè¦è®°ä½æœ€åä¸€ä¸ªå—çš„hashå€¼ï¼Œå°±å¯ä»¥ä¿è¯æ•´ä¸ªé“¾çš„å€¼æ— æ³•ç¯¡æ”¹ã€‚</p><ul><li>æˆ‘ä»¬ä¹Ÿå¯ä»¥åªä¿å­˜å…¶ä¸­çš„éƒ¨åˆ†åŒºå—ï¼ŒåŒºå—çš„å‰é¢çš„éƒ¨åˆ†æˆ‘ä»¬ä¸å¿…ä¿å­˜ï¼Œå¦‚æœéœ€è¦çš„æ—¶å€™æ‰¾åˆ«äººè¦ï¼›ç„¶åéªŒè¯è¦çš„åŒºå—çš„hashå€¼æ˜¯å¦æ˜¯å½“å‰åŒºå—çš„hashå€¼å³å¯</li></ul><h2 id="Merkle-tree">Merkle tree</h2><p><img src="/2021/04/01/blockchain/1%E5%8C%97%E4%BA%AC%E5%A4%A7%E5%AD%A6%E8%82%96%E8%87%BB%E8%80%81%E5%B8%88%E3%80%8A%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/apple/code/open-source/python/che168/291.png" alt="291"></p><p>ä¸Šå›¾ï¼š</p><ul><li>æœ€ä¸‹é¢çš„ä¸€å±‚æ˜¯æ•°æ®å—ï¼Œdata blocksï¼›æ¯ä¸ªæ•°æ®å—éƒ½æ˜¯äº¤æ˜“ï¼ˆtxï¼‰</li><li>ä¸Šé¢çš„é‚£äº›éƒ½æ˜¯hash pointers</li><li>æœ€ä¸Šé¢çš„èŠ‚ç‚¹æ˜¯æ ¹hashå€¼ï¼ˆroot hashï¼‰</li></ul><h3 id="Merkle-treeæ•°æ®ç»“æ„çš„å¥½å¤„ï¼š">Merkle treeæ•°æ®ç»“æ„çš„å¥½å¤„ï¼š</h3><p>åªè¦è®°ä½root hashå°±å¯ä»¥æ£€æµ‹å‡ºèŠ‚ç‚¹çš„ä¿®æ”¹</p><p>æ¯ä¸ªåŒºå—åˆ†æˆå—å¤´ï¼ˆblock headerï¼‰å’Œå—èº«ï¼ˆblock bodyï¼‰</p><p><img src="https://gitee.com/guozhe001/images/raw/master/295.png" alt="295"></p><h3 id="é»˜å…‹å°”è¯æ˜ï¼ˆMerkle-proofï¼‰ï¼šæŒ‡ä¸€ç¬”äº¤æ˜“åˆ°è·ŸèŠ‚ç‚¹çš„è·¯å¾„">é»˜å…‹å°”è¯æ˜ï¼ˆMerkle proofï¼‰ï¼šæŒ‡ä¸€ç¬”äº¤æ˜“åˆ°è·ŸèŠ‚ç‚¹çš„è·¯å¾„</h3><p>è¿™ç§è¯æ˜ä¹Ÿå«åšï¼šproof of membershipæˆ–proof of inclusionï¼ˆè¯æ˜èŠ‚ç‚¹å­˜åœ¨äºMerkle treeä¹‹ä¸­ï¼‰</p><h3 id="proof-of-non-membershipï¼ˆè¯æ˜èŠ‚ç‚¹å­˜ä¸åœ¨äºMerkle-treeä¹‹ä¸­ï¼‰">proof of non-membershipï¼ˆè¯æ˜èŠ‚ç‚¹å­˜ä¸åœ¨äºMerkle treeä¹‹ä¸­ï¼‰</h3><p>æ’åºæ‰€æœ‰äº¤æ˜“èŠ‚ç‚¹çš„hashå€¼ï¼ˆSorted Merkle treeï¼‰ï¼Œç„¶åè®¡ç®—éœ€è¦è¯æ˜çš„äº¤æ˜“çš„hashå€¼ï¼Œæ‰¾åˆ°æ­¤hashå€¼åº”è¯¥å‡ºç°çš„ä½ç½®ï¼Œå¦‚æœåº”è¯¥å‡ºç°çš„ä½ç½®çš„ä¸¤è¾¹çš„èŠ‚ç‚¹çš„hashæ»¡è¶³Merkle proofï¼Œåˆ™è¯´æ˜éœ€è¦è¯æ˜çš„èŠ‚ç‚¹ä¸åœ¨æ­¤Merkle treeä¹‹ä¸­ã€‚</p><p><strong>åªè¦ä¸æ˜¯æœ‰ç¯çš„æ•°æ®ç»“æ„ï¼Œéƒ½å¯ä»¥ä½¿ç”¨hashæŒ‡é’ˆ</strong></p><h1 id="4-BTC-åè®®">4 BTC åè®®</h1><h2 id="å¦‚ä½•å‘è¡Œæ•°å­—è´§å¸">å¦‚ä½•å‘è¡Œæ•°å­—è´§å¸</h2><h3 id="å¤®è¡Œå‘è¡Œæ•°å­—è´§å¸ï¼Œå¦‚æœåªä½¿ç”¨ç§é’¥ç­¾åï¼Œå¯ä»¥å—ï¼Ÿ">å¤®è¡Œå‘è¡Œæ•°å­—è´§å¸ï¼Œå¦‚æœåªä½¿ç”¨ç§é’¥ç­¾åï¼Œå¯ä»¥å—ï¼Ÿ</h3><p>æ— æ³•é˜²æ­¢double spending attackï¼šèŠ±ä¸¤æ¬¡æ”»å‡»</p><h3 id="ä¸­å¿ƒåŒ–æ–¹æ¡ˆï¼š">ä¸­å¿ƒåŒ–æ–¹æ¡ˆï¼š</h3><p>å¦‚æœå¤®è¡Œç»™å‘è¡Œçš„è´§å¸æ‰“ä¸Šç¼–å·å¹¶ä¸”è®°å½•è´§å¸å½“å‰å±äºè°ï¼Œé‚£ä¹ˆå¯ä»¥è§£å†³double spending attackï¼›</p><p><strong>ä½†æ˜¯æ¯æ¬¡èŠ±é’±éƒ½è¦å»å¤®è¡ŒéªŒè¯è´§å¸æ˜¯å¦æ˜¯çœŸçš„ï¼Œå¹¶ä¸”å±äºå½“å‰èŠ±é’±çš„äººï¼ŒèŠ±é’±ä¹‹åå†å˜æ›´é’±çš„å½’å±ã€‚</strong></p><h3 id="å»ä¸­å¿ƒåŒ–æ–¹æ¡ˆ">å»ä¸­å¿ƒåŒ–æ–¹æ¡ˆ</h3><h4 id="æ¯ä¸ªäº¤æ˜“ï¼ˆå¦‚Aç»™Bè½¬è´¦ï¼‰ä¸­éƒ½åŒ…å«è¾“å…¥å’Œè¾“å‡ºä¸¤ä¸ªéƒ¨åˆ†">æ¯ä¸ªäº¤æ˜“ï¼ˆå¦‚Aç»™Bè½¬è´¦ï¼‰ä¸­éƒ½åŒ…å«è¾“å…¥å’Œè¾“å‡ºä¸¤ä¸ªéƒ¨åˆ†</h4><ul><li>è¾“å…¥éƒ¨åˆ†éœ€è¦è¯´æ˜å¸çš„æ¥æº</li><li>è¾“å…¥éƒ¨åˆ†éœ€è¦åŒ…å«ä»˜æ¬¾äººçš„å…¬é’¥ï¼ˆå› ä¸ºä»˜æ¬¾æ—¶æœ‰ä»˜æ¬¾äººçš„ç­¾åï¼Œå¸¦ä¸Šå…¬é’¥ä¸ºäº†ä¾›åˆ«äººæ ¡éªŒï¼‰</li><li>è¾“å‡ºéƒ¨åˆ†è¦ç»™å‡ºæ”¶æ¬¾äººå…¬é’¥çš„hash</li></ul><p><strong>é“¸å¸äº¤æ˜“ï¼ˆcoinbase txï¼‰é‡Œé¢æœ‰Açš„å…¬é’¥çš„hashï¼Œè¿™æ ·å°±çŸ¥é“é“¸å¸äº¤æ˜“çš„é’±æ˜¯ç»™è°çš„ã€‚</strong></p><p><img src="https://gitee.com/guozhe001/images/raw/master/471.png" alt="471"></p><p>ä¸Šå›¾ä¸­çš„æ•°æ®ç»“æ„æœ‰ä¸¤ç§hashæŒ‡é’ˆ</p><ul><li>ç¬¬ä¸€ç§æ˜¯é“¾æ¥å—çš„hashæŒ‡é’ˆï¼ˆå³å‰ä¸€ä¸ªåŒºå—çš„hashæŒ‡é’ˆï¼‰</li><li>ç¬¬äºŒç§hashæŒ‡é’ˆæ˜¯è¯´æ˜å¸çš„æ¥æº</li></ul><p><strong>é—®é¢˜ï¼šæ˜¯å¦å¯ä»¥æ£€æµ‹dobule spendingï¼Ÿ</strong></p><p>å¦‚æœå¸çš„æ¥æºæ˜¯ä¸åˆæ³•çš„ï¼ˆéªŒè¯ä¸åˆæ³•çš„æ–¹å¼æ˜¯å¸çš„æ¥æºæ˜¯å¦å­˜åœ¨ä¸UTXOï¼‰ï¼Œæ˜¯ä¸ä¼šæ·»åŠ åˆ°åŒºå—é“¾ä¸­ï¼Œå¯ä»¥æ£€æµ‹dobule spending</p><p><strong>é—®é¢˜ï¼šåœ¨Aç»™Bè½¬è´¦æ—¶ï¼Œæ‰€æœ‰äººéƒ½éœ€è¦çŸ¥é“Açš„å…¬é’¥ï¼Œä¸ºäº†éªŒè¯Açš„ç­¾åï¼›é‚£ä¹ˆæ€ä¹ˆæ‰èƒ½çŸ¥é“Açš„å…¬é’¥å‘¢ï¼Ÿ</strong></p><p>åœ¨äº¤æ˜“çš„è¾“å…¥éƒ¨åˆ†ï¼Œä»˜æ¬¾äººéœ€è¦ç»™å‡ºè‡ªå·±çš„å…¬é’¥</p><p>åœ¨æ¯”ç‰¹å¸çš„ç³»ç»Ÿé‡Œï¼Œåœ°å€æ˜¯é€šè¿‡å…¬é’¥æ¨ç®—å‡ºæ¥çš„ï¼Œåœ°å€ç›¸å½“äºé“¶è¡Œè´¦å·ï¼ŒAéœ€è¦ç»™Bè½¬é’±éœ€è¦Bçš„åœ°å€ï¼›æ¯”ç‰¹å¸ç³»ç»Ÿé‡Œé¢æ˜¯æ²¡æœ‰åŠŸèƒ½æŸ¥è¯¢æŸä¸ªäººçš„åœ°å€</p><p>BitCoin Scriptï¼šäº¤æ˜“è„šæœ¬ï¼ŒæŠŠAçš„è¾“å…¥éƒ¨åˆ†å’Œä¸Šä¸€æ­¥çš„è¾“å‡ºè„šæœ¬æ‹¼åœ¨ä¸€èµ·æ‰§è¡Œï¼Œå¦‚æœä¸æŠ¥é”™è¯´æ˜äº¤æ˜“æ˜¯åˆæ³•çš„ã€‚</p><p>æ¯ä¸€ä¸ªå—åŒ…å«ä¸æ­¢ä¸€ä¸ªäº¤æ˜“ï¼Œæ¯ä¸ªå—åŒ…å«Block headerå’ŒBlock body</p><p>å“ˆå¸ŒæŒ‡é’ˆåŒ…å«çš„hashï¼Œæ˜¯é€šè¿‡Block headeråšhashçš„å€¼</p><p><img src="https://gitee.com/guozhe001/images/raw/master/474.png" alt="474"></p><h3 id="Block-headeråŒ…å«ï¼š">Block headeråŒ…å«ï¼š</h3><ul><li>versionï¼šç”¨çš„å“ªä¸ªæ¯”ç‰¹å¸åè®®çš„ç‰ˆæœ¬</li><li>hash of previous block headerï¼šä¸Šä¸€ä¸ªåŒºå—å¤´çš„hash</li><li>Merkle root hashï¼šæ•´ä¸ªTreeçš„root hashå€¼</li><li>targetï¼šæŒ–çŸ¿çš„ç›®æ ‡targetï¼ˆæ»¡è¶³H(block header + nonce) &lt;= targetï¼‰</li><li>éšæœºæ•°nonce</li></ul><h3 id="Block-bodyåŒ…å«ï¼š">Block bodyåŒ…å«ï¼š</h3><ul><li>transaction list</li></ul><h3 id="ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹åˆ†ä¸ºå…¨èŠ‚ç‚¹å’Œè½»èŠ‚ç‚¹">ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹åˆ†ä¸ºå…¨èŠ‚ç‚¹å’Œè½»èŠ‚ç‚¹</h3><h4 id="full-node">full node</h4><p>å…¨èŠ‚ç‚¹æ˜¯ä¿å­˜åŒºå—é“¾çš„æ‰€æœ‰ä¿¡æ¯çš„ï¼ŒéªŒè¯æ¯ä¸€ä¸ªäº¤æ˜“ï¼Œæ‰€ä»¥å…¨èŠ‚ç‚¹ä¹Ÿå«åšfully validating node</p><h4 id="light-node">light node</h4><p>è½»èŠ‚ç‚¹æ— æ³•ç‹¬ç«‹éªŒè¯äº¤æ˜“çš„åˆæ³•æ€§</p><p><strong>é—®é¢˜ï¼šæ¯ä¸ªè´¦æˆ·éƒ½å¯ä»¥å‘å¸ƒäº¤æ˜“ï¼Œè°æ¥å†³å®šå“ªä¸ªäº¤æ˜“å†™åˆ°åŒºå—ä¸­ï¼Ÿé¡ºåºæ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</strong></p><p>æŒ–çŸ¿å†³å®šè°æœ‰è®°è´¦æƒï¼Œæœ‰è®°è´¦æƒçš„èŠ‚ç‚¹å¯ä»¥ç”³è¯·å†™å…¥åŒºå—ï¼Œé¡ºåºç”±æ‹¥æœ‰è®°è´¦æƒçš„èŠ‚ç‚¹å®š</p><h2 id="è´¦æœ¬çš„å†…å®¹è¦å–å¾—åˆ†å¸ƒå¼çš„å…±è¯†">è´¦æœ¬çš„å†…å®¹è¦å–å¾—åˆ†å¸ƒå¼çš„å…±è¯†</h2><p>distributed consensusï¼ˆåˆ†å¸ƒå¼å…±è¯†ï¼‰</p><p>distributed hash table</p><p>éœ€è¦å–å¾—å…±è¯†çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ</p><h3 id="FLP-impossibility-resultï¼š">FLP impossibility resultï¼š</h3><p>åœ¨ä¸€ä¸ªå¼‚æ­¥çš„ç³»ç»Ÿé‡Œï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªæˆå‘˜æ˜¯æœ‰é—®é¢˜çš„ï¼Œä¹Ÿä¸å¯èƒ½å–å¾—å…±è¯†</p><h3 id="CAP-Theoremï¼ˆå®šç†ï¼‰">CAP Theoremï¼ˆå®šç†ï¼‰</h3><p>CAPï¼š</p><ul><li><a href="https://baike.baidu.com/item/%E4%B8%80%E8%87%B4%E6%80%A7/9840083">ä¸€è‡´æ€§</a>ï¼ˆConsistencyï¼‰</li><li><a href="https://baike.baidu.com/item/%E5%8F%AF%E7%94%A8%E6%80%A7/109628">å¯ç”¨æ€§</a>ï¼ˆAvailabilityï¼‰</li><li><a href="https://baike.baidu.com/item/%E5%88%86%E5%8C%BA%E5%AE%B9%E9%94%99%E6%80%A7/23734073">åˆ†åŒºå®¹é”™æ€§</a>ï¼ˆPartition toleranceï¼‰</li></ul><p>è¿™ä¸‰ä¸ªç‰¹æ€§åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ€å¤šåŒæ—¶æ»¡è¶³ä¸¤ä¸ª</p><p>åˆ†å¸ƒå¼çš„ä¸€ä¸ªåè®®ï¼š<a href="https://zhuanlan.zhihu.com/p/31780743">Paxos</a>ï¼Œèƒ½å¤Ÿä¿è¯Consistency</p><h2 id="æ¯”ç‰¹å¸ä¸­çš„å…±è¯†åè®®Consensus-in-BitCoin">æ¯”ç‰¹å¸ä¸­çš„å…±è¯†åè®®Consensus in BitCoin</h2><p>å‡è®¾ç³»ç»Ÿä¸­å¤§éƒ¨åˆ†çš„èŠ‚ç‚¹æ˜¯å¥½çš„ï¼Œå°éƒ¨åˆ†æœ‰æ¶æ„ã€‚</p><p>ç›´æ¥æŠ•ç¥¨é€‰æ‹©å“ªäº›äº¤æ˜“æ˜¯åˆæ³•çš„ï¼Œå¦‚æœè¶…è¿‡åŠæ•°å°±æ¥å—å¯ä»¥å—ï¼Ÿ</p><p>membershipï¼Œè°æœ‰æŠ•ç¥¨æƒ</p><p>hyperledger fabricï¼ˆè”ç›Ÿé“¾ï¼‰ï¼šå¯ä»¥æŠ•ç¥¨å†³å®š</p><p>sybil attackï¼ˆå¥³å·«æ”»å‡»ï¼‰ï¼šè¶…çº§è®¡ç®—æœºä¸€ç›´åˆ¶é€ è´¦æˆ·ï¼Œå‚ä¸æŠ•ç¥¨ï¼Œç›´åˆ°åˆ¶é€ çš„æ¶æ„è´¦æˆ·è¶…è¿‡åŠæ•°ã€‚</p><h3 id="æ¯”ç‰¹å¸çš„æŠ•ç¥¨ï¼ŒæŒ‰ç…§ç®—åŠ›å€¼">æ¯”ç‰¹å¸çš„æŠ•ç¥¨ï¼ŒæŒ‰ç…§ç®—åŠ›å€¼</h3><p>è°å…ˆè·å¾—ä¸‹é¢å…¬å¼ä¸­çš„nonceï¼Œè°å°±èƒ½è·å¾—è®°è´¦æƒï¼Œå¹¶ä¸”ç»™äºˆåˆå—å¥–åŠ±</p><p>Puzzle friendly: H(block header) &lt;= target</p><p>longest valid chain æœ€é•¿åˆæ³•é“¾</p><p>å¦‚æœä¸åœ¨æœ€é•¿åˆæ³•é“¾ä¸Šï¼Œæ–°çš„åŒºå—ä¹Ÿä¸ä¼šè¢«æ¥å—ï¼›</p><p><img src="https://gitee.com/guozhe001/images/raw/master/476.png" alt="476"></p><p>ä¸Šé¢çš„å›¾ç‰‡æ˜¯åˆ†å‰æ”»å‡»ï¼ˆforking attackï¼‰</p><h3 id="block-reward-åˆå—å¥–åŠ±">block reward åˆå—å¥–åŠ±</h3><h4 id="ä¸€æ¬¡æ€§èƒ½é€ å¤šå°‘å¸ï¼Ÿ">ä¸€æ¬¡æ€§èƒ½é€ å¤šå°‘å¸ï¼Ÿ</h4><p>åˆšå‘å¸ƒçš„æ—¶å€™50 BTCï¼Œ21ä¸‡ä¸ªåŒºå—ä¹‹åå¯ä»¥é“¸é€ 25ä¸ªæ¯”ç‰¹å¸</p><p>50 BTC -&gt; 25 BTC -&gt; 12.5 BTC</p><p>coinbase transaction</p><p>miningï¼ˆæŒ–çŸ¿ï¼‰ï¼šäº‰å¤ºè®°è´¦æƒ</p><p>digital goldï¼šæ•°å­—é»„é‡‘</p><p>minerï¼šçŸ¿å·¥</p><h1 id="BTC-å®ç°">BTC å®ç°</h1><p>transaction-based ledgerï¼šåŸºäºäº¤æ˜“çš„è´¦æœ¬æ¨¡å¼</p><p>æ¯ä¸ªåŒºå—è®°å½•çš„æ˜¯äº¤æ˜“ä¿¡æ¯ï¼ŒåŒ…æ‹¬è½¬è´¦äº¤æ˜“å’Œé“¸å¸äº¤æ˜“</p><p>UTXOï¼šUnspent Transaction Outputï¼ˆè¿˜æ²¡æœ‰è¢«èŠ±å‡ºå»çš„è¾“å‡ºï¼‰</p><p>UTXOæ•°æ®ç»“æ„ï¼Œä»¥ä¾¿å¿«é€Ÿæ£€æµ‹double spendingï¼›å¦‚æœæƒ³èŠ±æ‰çš„å¸ä¸å­˜åœ¨UTXOä¸­ï¼Œè¯´æ˜ä¸å­˜åœ¨æˆ–å·²ç»èŠ±å‡º</p><p>total inputs = total outputs</p><p>æ¯”ç‰¹å¸çš„ç¬¬äºŒä¸ªæ¿€åŠ±æœºåˆ¶ï¼štransaction fee</p><p>å…¶ä»–çš„æ¨¡å¼ï¼šaccount-based ledgerï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œç³»ç»Ÿè¦æ˜¾ç¤ºçš„è®°å½•è´¦æˆ·çš„ä½™é¢ï¼Œä»¥å¤ªåŠæ˜¯åŸºäºæ­¤ç§æ¨¡å¼è®°è´¦ã€‚</p><h2 id="æ¯æ¬¡å°è¯•nonceå¯ä»¥çœ‹ä½œæ˜¯Bernoulli-trialï¼ša-random-experiment-with-binary-outcome">æ¯æ¬¡å°è¯•nonceå¯ä»¥çœ‹ä½œæ˜¯Bernoulli trialï¼ša random experiment with binary outcome</h2><p>æ‰€æœ‰çš„å°è¯•çš„é›†åˆæ„æˆäº†Bernoulli Processï¼ša sequence of independent Bernoulli trials</p><p>å°è¯•è®¡ç®—nonceæ˜¯memorylessçš„ï¼šå³æ— è®ºä»¥å‰å°è¯•è¿‡å¤šå°‘æ¬¡ä¸‹ä¸€æ¬¡çš„æ¦‚ç‡è¿˜æ˜¯ä¸€æ ·</p><p>å¯ä»¥ä½¿ç”¨Poisson Processè¿‘ä¼¼</p><p>å‡ºå—æ—¶é—´æœä»æŒ‡æ•°åˆ†å¸ƒï¼šexponential distribution</p><p>BitCoin is secured by mining</p><h2 id="æ¯”ç‰¹å¸çš„å®‰å…¨æ€§">æ¯”ç‰¹å¸çš„å®‰å…¨æ€§</h2><p><strong>é—®é¢˜ï¼šèƒ½ä¸èƒ½æŠŠåˆ«äººçš„é’±è½¬ç»™è‡ªå·±ï¼Ÿ</strong></p><p>ä¸å¯ä»¥ï¼Œå› ä¸ºä½ æ²¡æœ‰åˆ«äººçš„ç§é’¥ï¼Œæ— æ³•ç­¾åã€‚ï¼ˆ<em>æ¯”ç‰¹å¸åœ¨èŠ±æ¯ä¸€ç¬”é’±çš„æ—¶å€™éƒ½è¦åˆ¶å®šå¸çš„æ¥æºï¼Œå³æŸæ¬¡äº¤æ˜“çš„outputï¼Œè¿™ä¸ªoutputä¸­æœ‰å¸çš„æ‰€æœ‰äººçš„å…¬é’¥ï¼Œåœ¨èŠ±é’±çš„æ—¶å€™å¸çš„æ‰€æœ‰äººéœ€è¦ç”¨è‡ªå·±çš„ç§é’¥åšç­¾åï¼Œç„¶ååˆ«äººé€šè¿‡å½“å‰äº¤æ˜“çš„inputå’Œå¸æ¥æºçš„outputæ¥éªŒè¯è¿™ä¸ªäº¤æ˜“çš„åˆæ³•æ€§ã€‚</em>ï¼‰</p><p><strong>é—®é¢˜ï¼šèƒ½ä¸èƒ½double spendingï¼Ÿ</strong></p><p>ä¸å¯ä»¥ï¼Œå› ä¸ºç¬¬äºŒæ¬¡èŠ±çš„æ—¶å€™åœ¨UTXOé‡Œé¢ä¸å­˜åœ¨ï¼Œä¼šéªŒè¯ä¸é€šè¿‡ã€‚</p><h1 id="6-BTC-ç½‘ç»œ">6-BTC-ç½‘ç»œ</h1><p>application layerï¼šBitCoin Block chain</p><p>network layerï¼šP2P Overlay Network</p><p>è®¾è®¡åŸåˆ™ï¼šsimple, robust, but not efficient</p><h1 id="7-BTC-æŒ–çŸ¿éš¾åº¦">7-BTC-æŒ–çŸ¿éš¾åº¦</h1><p>å¦‚ä½•è°ƒæ•´æŒ–çŸ¿éš¾åº¦ï¼šè°ƒæ•´æŒ–çŸ¿éš¾åº¦å°±æ˜¯è°ƒæ•´ç›®æ ‡ç©ºé—´åœ¨æ•´ä¸ªè¾“å‡ºç©ºé—´ä¸­æ‰€å çš„æ¯”ä¾‹ã€‚</p><p>æŒ–çŸ¿å³æ˜¯ç®—å‡ºæ»¡è¶³ï¼šH(block header) &lt;= targetçš„nonceå€¼</p><p>sha-256: å¯èƒ½çš„å€¼æ˜¯2çš„256æ¬¡æ–¹</p><p>difficulty = difficulty_1_target/target</p><p><strong>é—®é¢˜ï¼šä¸ºä»€ä¹ˆè¦è°ƒæ•´æŒ–çŸ¿éš¾åº¦ï¼Ÿ</strong></p><p>ä¸ºäº†ä¿è¯å‡ºå—æ—¶é—´å¹³å‡10åˆ†é’Ÿ</p><p><strong>é—®é¢˜ï¼šå‡ºå—æ—¶é—´å¤ªçŸ­ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p><p>ä¸¤ä¸ªèŠ‚ç‚¹åŒæ—¶å‘å¸ƒåŒºå—ï¼Œå¯èƒ½ä¼šå‡ºç°åˆ†å‰</p><p><img src="https://gitee.com/guozhe001/images/raw/master/487.png" alt="487"></p><p>å¹³å‡å‡ºå—æ—¶é—´è¿‡çŸ­å¯èƒ½å¯¼è‡´ä¸Šå›¾çš„å¾ˆå¤šåˆ†å‰ï¼Œè¿™ä¼šåˆ†æ•£è¯šå®èŠ‚ç‚¹çš„ç®—åŠ›</p><p>å¹³å‡å‡ºå—æ—¶é—´ä¸è®ºè®¾ç½®çš„å¤šé•¿ï¼Œéƒ½ä¸å¯ä»¥æ— é™çš„å‡å°ä¸‹å»</p><p>å¦‚æœåˆ†å‰è¿‡å¤šå°±æ— æ³•é˜²æ­¢51% attack</p><p>ä»¥å¤ªåŠçš„å…±è¯†åè®®ï¼šghost</p><h3 id="ä»€ä¹ˆæ—¶å€™è°ƒæ•´éš¾åº¦ï¼Ÿ">ä»€ä¹ˆæ—¶å€™è°ƒæ•´éš¾åº¦ï¼Ÿ</h3><p>æ¯2016ä¸ªåŒºå—ä¹‹åè°ƒæ•´ä¸€æ¬¡</p><h3 id="å¦‚ä½•è°ƒæ•´æŒ–çŸ¿éš¾åº¦ï¼š">å¦‚ä½•è°ƒæ•´æŒ–çŸ¿éš¾åº¦ï¼š</h3><h4 id="è°ƒæ•´çš„targetå€¼">è°ƒæ•´çš„targetå€¼</h4><p>**å…¬å¼ï¼š**target = target_current * (actual time)/(expected time)</p><p>å½“actual timeå¤§äºexpected timeï¼Œè¯´æ˜éš¾åº¦å¤ªå¤§ï¼Œ (actual time)/(expected time)å¾—å‡ºçš„å€¼å°±å¤§äº1ï¼Œæœ€ç»ˆç®—å‡ºæ¥çš„targetä¼šæ¯”å½“å‰çš„targetå¤§ï¼Œä¹Ÿå°±æ˜¯å˜å¾—å®¹æ˜“</p><h4 id="è°ƒæ•´éš¾åº¦">è°ƒæ•´éš¾åº¦</h4><p>next_difficulty = previous_diffculty * (2 weeks)/ (time to mine last 2016 blocks)</p><p>è°ƒæ•´éš¾åº¦ä¸ç›®æ ‡åŸŸå€¼ï¼ˆtargetï¼‰æˆåæ¯”</p><p>expected time = 2016 * 10min</p><p>actual time = time spent mining the last 2016 blocks</p><p>ç›®æ ‡åŸŸå€¼è°ƒæ•´æœ€å¤§ä¸ä¼šè¶…è¿‡4å€ï¼Œæœ€å°ä¸ä¼šå°äº1/4</p><h3 id="æ€ä¹ˆè®©æ‰€æœ‰çš„çŸ¿å·¥éƒ½è°ƒæ•´åŸŸå€¼å‘¢ï¼Ÿ">æ€ä¹ˆè®©æ‰€æœ‰çš„çŸ¿å·¥éƒ½è°ƒæ•´åŸŸå€¼å‘¢ï¼Ÿ</h3><p>ä»£ç é‡Œè‡ªåŠ¨è°ƒï¼Œå¦‚æœæ¶æ„èŠ‚ç‚¹ä¿®æ”¹äº†æºç ä¸è°ƒæ•´ï¼Œä»–å‘å¸ƒçš„åŒºå—çš„æ£€æŸ¥åŒºå—åˆæ³•æ€§å°±é€šä¸è¿‡ã€‚</p><h1 id="8-BTC-æŒ–çŸ¿">8-BTC-æŒ–çŸ¿</h1><h2 id="å…¨èŠ‚ç‚¹">å…¨èŠ‚ç‚¹</h2><ul><li>ä¸€ç›´åœ¨çº¿</li><li>åœ¨æœ¬åœ°ç¡¬ç›˜ä¸Šç»´æŠ¤å®Œæ•´çš„åŒºå—é“¾ä¿¡æ¯</li><li>åœ¨å†…å­˜é‡Œç»´æŠ¤UTXOï¼Œä»¥ä¾¿å¿«é€ŸéªŒè¯äº¤æ˜“çš„æ­£ç¡®æ€§</li><li>ç›‘å¬æ¯”ç‰¹å¸ç½‘ç»œä¸Šçš„äº¤æ˜“ä¿¡æ¯ï¼ŒéªŒè¯æ¯ä¸ªäº¤æ˜“çš„åˆæ³•æ€§</li><li>å†³å®šå“ªäº›äº¤æ˜“ä¼šè¢«æ‰“åŒ…åˆ°åŒºå—é‡Œ</li><li>ç›‘å¬åˆ«çš„çŸ¿å·¥æŒ–å‡ºæ¥çš„åŒºå—ï¼ŒéªŒè¯å…¶åˆæ³•æ€§</li><li>æŒ–çŸ¿</li><li>å†³å®šæ²¿ç€å“ªæ¡é“¾æŒ–ä¸‹å»ï¼Ÿ</li><li>å½“å‡ºç°ç­‰é•¿çš„åˆ†å‰çš„æ—¶å€™ï¼Œé€‰æ‹©å“ªä¸ªåˆ†å‰ï¼Ÿ</li><li>ç¼ºçœæƒ…å†µä¸‹æ˜¯æ²¿ç€æœ€å…ˆå¬åˆ°çš„åŒºå—</li></ul><h2 id="è½»èŠ‚ç‚¹">è½»èŠ‚ç‚¹</h2><ul><li>ä¸æ˜¯ä¸€ç›´åœ¨çº¿</li><li>ä¸ç”¨ä¿å­˜æ•´ä¸ªåŒºå—é“¾ï¼Œåªè¦ä¿å­˜æ¯ä¸ªåŒºå—çš„å—å¤´</li><li>ä¸ç”¨ä¿å­˜å…¨éƒ¨äº¤æ˜“ï¼Œåªä¿å­˜ä¸è‡ªå·±ç›¸å…³çš„äº¤æ˜“</li><li>æ— æ³•æ£€éªŒå¤§å¤šæ•°äº¤æ˜“çš„åˆæ³•æ€§ï¼Œåªèƒ½æ£€æµ‹ä¸è‡ªå·±ç›¸å…³çš„é‚£äº›äº¤æ˜“çš„åˆæ³•æ€§</li><li>æ— æ³•æ£€æµ‹ç½‘ä¸Šå‘å¸ƒçš„åŒºå—çš„æ­£ç¡®æ€§</li><li>å¯ä»¥éªŒè¯æŒ–çŸ¿çš„éš¾åº¦</li><li>åªèƒ½æ£€æµ‹å“ªä¸ªæ˜¯æœ€é•¿é“¾ï¼Œä¸çŸ¥é“å“ªä¸ªæ˜¯æœ€é•¿åˆæ³•é“¾</li></ul><p>æŒ–çŸ¿å…·æœ‰ç‰¹æ€§ï¼š</p><p>memorylessæˆ–å«åšprogress free</p><h2 id="æŒ–çŸ¿çš„è®¾å¤‡">æŒ–çŸ¿çš„è®¾å¤‡</h2><ul><li>ç¬¬ä¸€ä»£ï¼ŒCPU</li><li>é—²ç½®çš„cpuã€å†…å­˜ã€ç¡¬ç›˜</li><li>ç¬¬äºŒä»£ï¼ŒGPU</li><li>ä¸ºäº†é€šç”¨å¹¶è¡Œè®¡ç®—è€Œè®¾è®¡çš„</li><li>ä¹Ÿå­˜åœ¨æµªè´¹</li><li>ç¬¬ä¸‰ä»£ï¼ŒASICï¼šApplication Specific Integrated Circuit</li></ul><p>æŒ–çŸ¿çš„è®¾å¤‡çš„è¶‹åŠ¿æ˜¯ä»é€šç”¨åˆ°ä¸“ä¸š</p><h2 id="puzzle">puzzle</h2><p>mining puzzle:æŒ–çŸ¿æ—¶æ±‚è§£çš„puzzle</p><p>merge miningï¼šä½¿ç”¨åˆ«çš„å¸çš„mining puzzle</p><p>Alternative mining puzzle: æŠ—ASICèŠ¯ç‰‡</p><h2 id="çŸ¿æ± ">çŸ¿æ± </h2><p><img src="https://gitee.com/guozhe001/images/raw/master/489.png" alt="489"></p><p>ï¼ˆshare almost valid blockï¼‰</p><h3 id="å‡å¦‚ä¸€ä¸ªçŸ¿æ± å äº†51-çš„æ¯”ä¾‹ï¼Œä»–èƒ½å‘åŠ¨å“ªäº›æ”»å‡»å‘¢ï¼Ÿ">å‡å¦‚ä¸€ä¸ªçŸ¿æ± å äº†51%çš„æ¯”ä¾‹ï¼Œä»–èƒ½å‘åŠ¨å“ªäº›æ”»å‡»å‘¢ï¼Ÿ</h3><ul><li>forking attack</li><li>Boycottï¼ˆå°é”ï¼‰</li></ul><h1 id="9-BTC-æ¯”ç‰¹å¸è„šæœ¬">9-BTC-æ¯”ç‰¹å¸è„šæœ¬</h1><p>æ¯”ç‰¹å¸è„šæœ¬æ˜¯stack-basedçš„è„šæœ¬ï¼ŒåŒ…æ‹¬ä¸‹é¢ä¸‰ç§ç±»å‹</p><ul><li><p>P2PKï¼ˆPay to Public Keyï¼‰</p></li><li><p>P2PHï¼ˆPay to Public Key Hashï¼‰</p></li><li><p>P2SHï¼ˆPay to Script Hashï¼‰å¯¹å¤šé‡ç­¾åçš„æ”¯æŒ</p></li></ul><h3 id="redeemScriptï¼š">redeemScriptï¼š</h3><p>å½“ä¸€ä¸ªéœ€è¦è”åˆç­¾åçš„è´¦å·Bï¼ˆå¦‚éœ€è¦5ä¸ªä¸­çš„ä¸‰ä¸ªç­¾åï¼‰éœ€è¦æ”¯ä»˜æ—¶ï¼Œéœ€è¦è‡³å°‘æœ‰ä¸‰ä¸ªç­¾åæ‰å¯ä»¥ï¼Œé‚£ä¹ˆåœ¨Bæ”¯ä»˜ç»™Cæ—¶éœ€è¦éªŒè¯Bçš„å¸æ¥æ¥æºçš„outputå’Œå½“å‰çš„äº¤æ˜“çš„inputåšéªŒè¯ã€‚å¦‚æœéœ€è¦éªŒè¯æˆåŠŸåˆ™éœ€è¦åœ¨ä¸Šä¸€æ­¥äº¤æ˜“çš„outputä¸­åŒ…å«è¿™äº›å…¬é’¥ä¿¡æ¯ã€‚</p><p>å½“ä¸€ä¸ªè´¦å·Aæ”¯ä»˜ç»™å¦ä¸€ä¸ªéœ€è¦è”åˆç­¾åçš„è´¦å·Bæ—¶ï¼Œå¦‚æœéœ€è¦Aæ”¯ä»˜æ—¶æä¾›Bçš„æ‰€æœ‰çš„è´¦æˆ·çš„å…¬é’¥ä¿¡æ¯ï¼Œä¼šå¯¼è‡´Aæ”¯ä»˜æ—¶ç‰¹åˆ«éº»çƒ¦ã€‚</p><p><strong>redeemScript</strong>å°±æ˜¯è§£å†³ä¸Šé¢çš„é—®é¢˜è€Œå­˜åœ¨çš„ï¼Œè¯¦æƒ…å‚è€ƒ<a href="https://zhuanlan.zhihu.com/p/93823558">æ·±å…¥ç†è§£æ¯”ç‰¹å¸è„šæœ¬</a></p><h2 id="Proof-of-Burn">Proof of Burn</h2><p>ç‡ƒçƒ§è¯æ˜ï¼Œåœ¨è¾“å‡ºè„šæœ¬ä¸­æ·»åŠ returnï¼Œä½¿è¿™ä¸ªoutputåœ¨éªŒè¯æ—¶æ°¸è¿œæŠ¥é”™ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªè¾“å‡ºçš„å¸æ°¸è¿œä¹ŸèŠ±ä¸å‡ºå»ã€‚</p><p><strong>è‡ªé—®ï¼šå¦‚æœAåœ¨ç»™Bä»˜æ¬¾æ—¶ï¼Œoutputä¸­é¢åŒ…å«returnè¯­å¥ï¼Œé‚£ä¹ˆBè™½ç„¶çœŸå®æ”¶åˆ°äº†æ¬¾ï¼Œä½†æ˜¯æ°¸è¿œèŠ±ä¸å‡ºå»ã€‚Bèƒ½å¤Ÿåœ¨æ¥æ”¶æ—¶éªŒè¯å—ï¼Ÿè¿˜æ˜¯åªèƒ½ç­‰åˆ°èŠ±é’±æ—¶æ‰èƒ½å‘ç°è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</strong></p><p>**è‡ªç­”ï¼š**å› ä¸ºBéœ€è¦éªŒè¯è¿™æ¯”äº¤æ˜“æœ‰æ²¡æœ‰å†™å…¥åŒºå—é“¾ä¸­ï¼Œæ‰€ä»¥Aä¼šæŠŠäº¤æ˜“å‘ç»™Bï¼Œæ­¤æ—¶Béœ€è¦æ£€æŸ¥outputæ˜¯å¦åŒ…å«returnï¼Œå¦‚æœåŒ…å«åˆ™è®¤ä¸ºè¿™æ¯”äº¤æ˜“æ— æ•ˆï¼›å‡å¦‚Bæ˜¯å•†å®¶å¹¶åœ¨äº¤æ˜“åˆšå‘ç”Ÿæ—¶ä¸éªŒè¯ï¼ŒæŠŠè´§å‘é€ç»™Aï¼Œé‚£ä¹ˆBå°±æ”¶åˆ°ä¸€ç¬”èŠ±ä¸å‡ºå»çš„é’±ã€‚</p><h3 id="digital-commitment">digital commitment</h3><p>å‘å¸ƒäº¤æ˜“ä¸éœ€è¦è®°è´¦æƒï¼Œå‘å¸ƒåŒºå—æ‰éœ€è¦è®°è´¦æƒ</p><h1 id="10-BTC-åˆ†å‰">10-BTC-åˆ†å‰</h1><p>fork</p><ul><li>state fork</li><li>forking attackï¼ˆdeliberate forkï¼‰</li><li>protocol forkï¼ˆåè®®åˆ†å‰ï¼‰</li><li>hard fork</li><li>soft fork</li></ul><h2 id="hard-fork">hard fork</h2><p>ç³»ç»Ÿä¸­åªæœ‰æœ‰ä¸€éƒ¨åˆ†èŠ‚ç‚¹ä¸æ›´æ–°è½¯ä»¶ï¼Œå°±ä¼šå‡ºç°æ°¸ä¹…æ€§çš„åˆ†å‰</p><p>egï¼šblock size limit</p><p>block sizeä¸è¶…è¿‡1Mï¼Œè®¡ç®—å‡º7tx/secï¼ˆæ¯ç§’7ç¬”äº¤æ˜“ï¼‰ï¼›å¦‚æœnew nodesæŠŠè½¯ä»¶å‡çº§ä¸ºåŒºå—å¤§å°æœ€å¤šå¯ä»¥4Mï¼Œé‚£ä¹ˆæ—§çš„èŠ‚ç‚¹å¦‚æœä¸ä¸€èµ·å‡çº§ç»§ç»­æ²¿ç€æ—§é“¾æŒ–å°±ä¼šå¯¼è‡´ç¡¬åˆ†å‰ï¼›æ—§èŠ‚ç‚¹è®¤ä¸ºè¶…è¿‡1Må¤§å°çš„åŒºå—ä¸ºéæ³•çš„ã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master/image%20(1).png" alt="image (1)"></p><p>åªè¦old nodesä¸æ›´æ–°è½¯ä»¶ï¼Œåˆ†å‰å°±ä¸ä¼šå˜æ›´</p><h2 id="soft-fork">soft fork</h2><p>åªè¦ç³»ç»Ÿä¸­æœ‰åŠæ•°ä¸­çš„èŠ‚ç‚¹æ›´æ–°è½¯ä»¶ï¼Œå°±ä¸ä¼šå‡ºç°æ°¸ä¹…æ€§çš„åˆ†å‰ï¼›åªä¼šå‡ºç°ä¸´æ—¶æ€§çš„åˆ†å‰</p><p>æ¥ç€ä½¿ç”¨è°ƒæ•´åŒºå—å¤§å°çš„ä¾‹å­ï¼Œå¦‚æœè°ƒæ•´ä¸ºé™åˆ¶ä¸è¶…è¿‡0.5Mï¼Œé‚£ä¹ˆæ–°èŠ‚ç‚¹äº§ç”Ÿçš„åŒºå—æ—§èŠ‚ç‚¹ä¹Ÿè®¤å¯ï¼›ä½†æ˜¯æ—§èŠ‚ç‚¹äº§ç”Ÿçš„åŒºå—æ–°èŠ‚ç‚¹ä¸è®¤å¯ï¼Œå¦‚æœæ–°èŠ‚ç‚¹å å¤šæ•°æ—¶å°±ä¼šè¿«ä½¿æ—§èŠ‚ç‚¹å‡çº§ã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master/499.png" alt="499"></p><h3 id="è½¯åˆ†å‰çš„ä¾‹å­ï¼ˆP2SHï¼šPay-to-Script-Hashï¼‰">è½¯åˆ†å‰çš„ä¾‹å­ï¼ˆP2SHï¼šPay to Script Hashï¼‰</h3><h1 id="11-BTC-é—®ç­”">11-BTC-é—®ç­”</h1><h2 id="å¦‚æœè½¬è´¦çš„æ—¶å€™åœ°å€å†™é”™äº†æ€ä¹ˆåŠï¼Ÿ">å¦‚æœè½¬è´¦çš„æ—¶å€™åœ°å€å†™é”™äº†æ€ä¹ˆåŠï¼Ÿ</h2><p>ç­”ï¼šæ²¡æœ‰åŠæ³•å–æ¶ˆä¸€ç»å‘å¸ƒçš„äº¤æ˜“</p><h2 id="Proof-of-Burnï¼Œå¦‚æœOP-RETURNæ— æ¡ä»¶çš„è¿”å›é”™è¯¯ï¼Œè¿™ç¬”äº¤æ˜“æ˜¯å¦‚ä½•å†™å…¥åˆ°åŒºå—é“¾é‡Œçš„å‘¢ï¼Ÿ">Proof of Burnï¼Œå¦‚æœOP_RETURNæ— æ¡ä»¶çš„è¿”å›é”™è¯¯ï¼Œè¿™ç¬”äº¤æ˜“æ˜¯å¦‚ä½•å†™å…¥åˆ°åŒºå—é“¾é‡Œçš„å‘¢ï¼Ÿ</h2><p>ç­”ï¼šå› ä¸ºOP_RETURNæ˜¯å†™åœ¨å½“å‰äº¤æ˜“çš„è¾“å‡ºè„šæœ¬é‡Œï¼Œæ‰€ä»¥å½“å‰äº¤æ˜“çš„éªŒè¯ä¸ä¼šéªŒè¯è¿™ä¸ªè„šæœ¬</p><h2 id="ä½ æ€ä¹ˆçŸ¥é“å“ªä¸ªçŸ¿å·¥æœ€å…ˆæ‰¾åˆ°çš„åŒä¸€ä¸ªnonceï¼Ÿ">ä½ æ€ä¹ˆçŸ¥é“å“ªä¸ªçŸ¿å·¥æœ€å…ˆæ‰¾åˆ°çš„åŒä¸€ä¸ªnonceï¼Ÿ</h2><p>ç­”ï¼šä¸å¯ä»¥å·ç­”æ¡ˆï¼Œå› ä¸ºåŒºå—é‡Œé¢çš„coinbase txæŒ‡å‘çš„æ”¶æ¬¾è´¦æˆ·æ˜¯çœŸæ­£è®¡ç®—å‡ºnonceçš„è´¦æˆ·ï¼Œè¿™ä¸ªä¿¡æ¯å¦‚æœè¢«ä¿®æ”¹äº†ï¼Œäº¤æ˜“å°±ä¸ä¼šéªŒè¯é€šè¿‡ã€‚</p><h2 id="transaction-feeï¼Œå¦‚ä½•ç¡®å®šäº¤æ˜“è´¹ç»™å“ªä¸ªçŸ¿å·¥ï¼Œç»™å¤šå°‘ï¼Ÿ">transaction feeï¼Œå¦‚ä½•ç¡®å®šäº¤æ˜“è´¹ç»™å“ªä¸ªçŸ¿å·¥ï¼Œç»™å¤šå°‘ï¼Ÿ</h2><p>åªè¦total inputs &gt; total outputsï¼Œä¹‹é—´çš„å·®é¢å°±æ˜¯äº¤æ˜“è´¹</p><h1 id="12-BTC-æ¯”ç‰¹å¸ä¸­çš„åŒ¿åæ€§">12-BTC-æ¯”ç‰¹å¸ä¸­çš„åŒ¿åæ€§</h1><p>BitCoin and anonymity</p><p>pseudonymity</p><h2 id="ä»€ä¹ˆæƒ…å†µä¸‹ä¼šç ´ååŒ¿åæ€§ï¼Ÿ">ä»€ä¹ˆæƒ…å†µä¸‹ä¼šç ´ååŒ¿åæ€§ï¼Ÿ</h2><p>åœ¨å¤šä¸ªinputsçš„æ—¶å€™ï¼Œå¤šä¸ªè¾“å…¥å¯èƒ½æ˜¯åŒä¸€ä¸ªäºº</p><h2 id="ä»€ä¹ˆæƒ…å†µä¸‹åˆ«äººèƒ½ç›´åˆ°æ¯”ç‰¹å¸è´¦æˆ·å¯¹åº”ç°å®ä¸­çš„æŸä¸ªäººå‘¢ï¼Ÿ">ä»€ä¹ˆæƒ…å†µä¸‹åˆ«äººèƒ½ç›´åˆ°æ¯”ç‰¹å¸è´¦æˆ·å¯¹åº”ç°å®ä¸­çš„æŸä¸ªäººå‘¢ï¼Ÿ</h2><p>èµ„é‡‘çš„è½¬å…¥è½¬å‡ºï¼Œè´­ä¹°æ¯”ç‰¹å¸æˆ–è€…æ¯”ç‰¹å¸å¥—ç°ï¼›æ¯”ç‰¹å¸æ”¯ä»˜çš„æ—¶å€™ä¹Ÿå¯ä»¥</p><p>silk roadï¼šeBay for illegal drugs</p><h2 id="é‡‡å–ä»€ä¹ˆæ–¹æ³•æé«˜åŒ¿åæ€§ï¼Ÿ">é‡‡å–ä»€ä¹ˆæ–¹æ³•æé«˜åŒ¿åæ€§ï¼Ÿ</h2><h2 id="é›¶çŸ¥è¯†è¯æ˜">é›¶çŸ¥è¯†è¯æ˜</h2><p>é›¶çŸ¥è¯†è¯æ˜æ˜¯æŒ‡ä¸€æ–¹ï¼ˆè¯æ˜è€…ï¼‰å‘å¦ä¸€æ–¹ï¼ˆéªŒè¯ç€ï¼‰è¯æ˜ä¸€ä¸ªé™ˆè¿°æ˜¯æ­£ç¡®çš„ï¼Œè€Œæ— éœ€é€éœ²é™¤è¯¥é™ˆè¿°æ˜¯æ­£ç¡®çš„å¤–çš„ä»»ä½•ä¿¡æ¯ã€‚</p><p>**æˆ‘çš„ç†è§£ï¼š**å¦‚æ¯”ç‰¹å¸çš„è½¬è´¦ï¼ˆAè½¬ç»™Bï¼‰ç­¾åå°±æ˜¯é›¶çŸ¥è¯†è¯æ˜ï¼Œå› ä¸ºè¿™ä¸ªç­¾åè¯æ˜äº†è¿™ä¸ªäº¤æ˜“æ˜¯Aè½¬å‡ºå»çš„ï¼Œå´ä¸éœ€è¦è®©Aæä¾›å…¶ä»–ä¿¡æ¯ã€‚</p><h1 id="13-BTC-æ€è€ƒ">13-BTC-æ€è€ƒ</h1><h2 id="ä¸ºä»€ä¹ˆæ¯”ç‰¹å¸ç³»ç»Ÿèƒ½å¤Ÿç»•è¿‡è¢«è¯æ˜çš„åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸å¯èƒ½çš„ç»“è®ºï¼Ÿ">ä¸ºä»€ä¹ˆæ¯”ç‰¹å¸ç³»ç»Ÿèƒ½å¤Ÿç»•è¿‡è¢«è¯æ˜çš„åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸å¯èƒ½çš„ç»“è®ºï¼Ÿ</h2><p>æ¯”ç‰¹å¸å¹¶æ²¡æœ‰ç»•è¿‡</p><h1 id="14-ETH-ä»¥å¤ªåŠæ¦‚è¿°">14-ETH-ä»¥å¤ªåŠæ¦‚è¿°</h1><ul><li><p>memory hard mining puzzle</p></li><li><p>ASIC resistanceï¼šæŒ–çŸ¿æ—¶éœ€è¦è®¿é—®å†…å­˜</p></li><li><p>proof of work -&gt; proof of stakeï¼šç›®æ ‡æ˜¯ä»å·¥ä½œé‡è¯æ˜è¿‡åº¦åˆ°æƒç›Šè¯æ˜</p></li><li><p>smart contract: æ™ºèƒ½åˆçº¦</p></li><li><p>BitCoin: decentralized currencyï¼ˆå»ä¸­å¿ƒåŒ–çš„è´§å¸ï¼‰</p></li><li><p>Ethereum: decentralized contractï¼ˆå»ä¸­å¿ƒåŒ–çš„åˆåŒï¼‰</p></li></ul><h1 id="15-ETH-è´¦æˆ·">15-ETH-è´¦æˆ·</h1><ul><li><p>ä»¥å¤ªåŠæ˜¯ä¸€ä¸ªaccounting-based ledgerï¼ˆåŸºäºè´¦æˆ·çš„å»ä¸­å¿ƒåŒ–çš„è´¦æœ¬ï¼‰</p></li><li><p>å¤©ç„¶é˜²å¾¡double spending attack</p></li><li><p>è®°å½•äº¤æ˜“æ¬¡æ•°ï¼ˆnonceï¼‰ï¼Œä»¥é˜²å¾¡replay attackï¼ˆé‡æ”¾æ”»å‡»ï¼‰</p></li></ul><h2 id="è´¦æˆ·ç±»å‹">è´¦æˆ·ç±»å‹</h2><h3 id="externally-owned-accountï¼ˆå¤–éƒ¨è´¦æˆ·ï¼‰">externally owned accountï¼ˆå¤–éƒ¨è´¦æˆ·ï¼‰</h3><p>è®°å½•ï¼š</p><ul><li>balance</li><li>nonce</li></ul><h3 id="Smart-contract-accountï¼ˆæ™ºèƒ½åˆçº¦è´¦æˆ·ï¼‰">Smart contract accountï¼ˆæ™ºèƒ½åˆçº¦è´¦æˆ·ï¼‰</h3><p>è®°å½•ï¼š</p><ul><li>balance</li><li>nonce</li><li>code</li><li>storage</li></ul><h4 id="æ™ºèƒ½åˆçº¦è´¦æˆ·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š">æ™ºèƒ½åˆçº¦è´¦æˆ·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</h4><ul><li><p>åˆçº¦è´¦æˆ·æ— æ³•ä¸»åŠ¨å‘èµ·ä¸€ä¸ªäº¤æ˜“</p></li><li><p>åˆ›å»ºåˆçº¦è´¦æˆ·çš„æ—¶å€™ä¼šè¿”å›ä¸€ä¸ªåœ°å€ï¼Œå¯ä»¥è°ƒç”¨è¿™ä¸ªåœ°å€</p></li></ul><h1 id="16-ETH-ä»¥å¤ªåŠä¸­çš„çŠ¶æ€æ ‘">16-ETH-ä»¥å¤ªåŠä¸­çš„çŠ¶æ€æ ‘</h1><p>ç»´æŠ¤çš„åŠŸèƒ½æ˜¯è´¦æˆ·åœ°å€åˆ°è´¦æˆ·çŠ¶æ€çš„æ˜ å°„ï¼šaddr -&gt; state</p><p><strong>é—®é¢˜ï¼šå¦‚æœæŠŠæ‰€æœ‰è´¦æˆ·ç›´æ¥ç»„æˆä¸€ä¸ªmerkle tree å¯ä»¥å—ï¼Ÿ</strong></p><p>ä¸å¯ä»¥ï¼Œå› ä¸ºä¿®æ”¹è´¦æˆ·æ—¶æˆäº†ä¸²è¡Œ</p><p><strong>é—®é¢˜ï¼šä¸ºä»€ä¹ˆæ¯”ç‰¹å¸å¯ä»¥æŠŠæ‰€æœ‰äº¤æ˜“ç»„æˆä¸€ä¸ªmerkle treeå‘¢ï¼Ÿ</strong></p><p>å› ä¸ºæ¯”ç‰¹å¸åªæœ‰ä¸€ä¸ªäººæ‹¥æœ‰è®°è´¦æƒï¼Œæ‰€ä»¥è¿™ä¸ªæœ‰è®°è´¦æƒçš„äººéšæ„è®°å½•å³å¯</p><p>å³ä½¿ä»¥å¤ªåŠä½¿ç”¨sorted merkle treeï¼Œåœ¨æœ‰æ–°çš„è´¦æˆ·å‡ºç°æ—¶ä¹Ÿä¼šå¤§é‡çš„æ›´æ–°merkle treeä¸­çš„hashå€¼ã€‚</p><h2 id="æ•°æ®ç»“æ„ï¼štrieï¼ˆretrieval-æ£€ç´¢ï¼‰">æ•°æ®ç»“æ„ï¼štrieï¼ˆretrieval-æ£€ç´¢ï¼‰</h2><p><img src="https://gitee.com/guozhe001/images/raw/master/628.png" alt="628"></p><h2 id="æ•°æ®ç»“æ„ï¼šPatricia-treeï¼ˆtrieï¼‰">æ•°æ®ç»“æ„ï¼šPatricia treeï¼ˆtrieï¼‰</h2><p><img src="https://gitee.com/guozhe001/images/raw/master/629.png" alt="629"></p><ul><li>æ ‘çš„é«˜åº¦å˜çŸ­</li><li>å¦‚æœæ’å…¥æ–°çš„å•è¯ï¼ŒåŸæ¥å‹ç¼©çš„èŠ‚ç‚¹å¯èƒ½éœ€è¦æ‰©å±•å¼€</li></ul><h2 id="æ•°æ®ç»“æ„ï¼šMPTï¼ˆMerkle-Patricia-treeï¼‰">æ•°æ®ç»“æ„ï¼šMPTï¼ˆMerkle Patricia treeï¼‰</h2><p>æŠŠPatricia treeçš„æŒ‡é’ˆæ”¹ä¸ºHash Pointerå°±æˆäº†MPT</p><h2 id="æ•°æ®ç»“æ„ï¼šModified-MPT">æ•°æ®ç»“æ„ï¼šModified MPT</h2><p>ä¸‹é¢çŠ¶æ€æ ‘çš„ä¾‹å­ä¸­çš„èŠ‚ç‚¹æœ‰ä¸‰ç§ï¼š</p><ul><li>Extention Nodeï¼šå¦‚æœè·¯å¾„å‡ºç°å‹ç¼©ï¼Œå°±ä¼šå‡ºç°æ­¤èŠ‚ç‚¹</li><li>Branch Nodeï¼šåˆ†æ”¯èŠ‚ç‚¹</li><li>Leaf Nodeï¼šæœ€ç»ˆçš„èŠ‚ç‚¹</li></ul><p><img src="https://gitee.com/guozhe001/images/raw/master/image-20201126151730381.png" alt="image-20201126151730381"></p><h1 id="16-ETH-äº¤æ˜“æ ‘å’Œæ”¶æ®æ ‘">16-ETH-äº¤æ˜“æ ‘å’Œæ”¶æ®æ ‘</h1><p>ç”¨å¤„ï¼š</p><ul><li>æä¾›Merkle proof</li></ul><h2 id="æ•°æ®ç»“æ„ï¼šbloom-filter">æ•°æ®ç»“æ„ï¼šbloom filter</h2><p>**ç”¨é€”ï¼š**æ”¯æŒæŸ¥æ‰¾æŸä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªæ¯”è¾ƒå¤§çš„é›†åˆä¸­</p><p>**å®ç°ï¼š**æŠŠé›†åˆä¸­çš„æ‰€æœ‰çš„hashå€¼æ˜ å°„åˆ°ä¸€ä¸ªå°çš„æ•°ç»„ä¸­ï¼Œç„¶åæŠŠæ•°ç»„ä¸­çš„å¯¹åº”ä½ç½®çš„å€¼ç”±0æ”¹ä¸º1ã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master/630.png" alt="630"></p><ul><li><p>æœ‰å¯èƒ½å‡ºç°è¯¯æŠ¥ï¼ˆä¸€ä¸ªå€¼çš„hashæ˜ å°„çš„æ•°ç»„ä¸­çš„ä½ç½®ï¼Œå¦‚æœæ˜¯1åªèƒ½è¯´æ˜å¯èƒ½å­˜åœ¨ï¼Œå› ä¸ºå­˜åœ¨hashç¢°æ’ï¼‰</p></li><li><p>ä¸ä¼šå‡ºç°æ¼æŠ¥ï¼ˆå› ä¸ºåªè¦æŸä¸ªå€¼çš„hashæ˜ å°„çš„æ•°ç»„çš„ä½ç½®çš„å€¼æ˜¯0ï¼Œè¯´æ˜æ­¤å€¼ä¸å­˜åœ¨ï¼‰</p></li></ul><h3 id="ä»¥å¤ªåŠä¸­å¦‚ä½•ä½¿ç”¨bloom-filter">ä»¥å¤ªåŠä¸­å¦‚ä½•ä½¿ç”¨bloom filter</h3><p>åŒ…å«åœ¨å—å¤´é‡Œé¢ï¼Œå¯ä»¥å¿«é€Ÿè¿‡æ»¤æŸäº›èŠ‚ç‚¹ä¸åŒ…å«æŒ‡å®šäº¤æ˜“ï¼›ç„¶åå†åœ¨å¯èƒ½åŒ…å«çš„èŠ‚ç‚¹ä¸­æ£€ç´¢ã€‚</p><p>transaction-driven state machineï¼ˆäº¤æ˜“é©±åŠ¨çš„çŠ¶æ€æœºï¼‰</p><h1 id="18-ETH-GHOSTåè®®">18-ETH-GHOSTåè®®</h1><h2 id="å¦‚æœåªæœ‰å’Œçˆ¶èŠ‚ç‚¹å¹³çº§çš„æ‰æ˜¯uncle-block">å¦‚æœåªæœ‰å’Œçˆ¶èŠ‚ç‚¹å¹³çº§çš„æ‰æ˜¯uncle block</h2><p><img src="https://gitee.com/guozhe001/images/raw/master/633.png" alt="633"></p><h3 id="å­˜åœ¨é—®é¢˜ï¼š">å­˜åœ¨é—®é¢˜ï¼š</h3><p>1ã€uncle blockçš„ä¸ªæ•°åªèƒ½æ˜¯ä¸¤ä¸ªï¼Œå¦‚æœåˆ†å‰è¶…è¿‡3ä¸ªå°±æ— æ³•å…¨éƒ¨åŒ…å«è¿›æ¥ã€‚<br>2ã€æ•…æ„ä¸åŒ…å«æŸä¸ªå”çˆ¶åŒºå—</p><h2 id="åªè¦ä¸å½“å‰èŠ‚ç‚¹æœ‰å…±åŒçš„ä¸»é“¾å°±è®¤ä¸ºæ˜¯uncle-block">åªè¦ä¸å½“å‰èŠ‚ç‚¹æœ‰å…±åŒçš„ä¸»é“¾å°±è®¤ä¸ºæ˜¯uncle block</h2><p><img src="https://gitee.com/guozhe001/images/raw/master/634.png" alt="634"></p><h3 id="å­˜åœ¨é—®é¢˜ï¼š-v2">å­˜åœ¨é—®é¢˜ï¼š</h3><p>æŸä¸ªçŸ¿å·¥åœ¨æŒ–çŸ¿éš¾åº¦ä½çš„æ—¶å€™äº§ç”Ÿå¤šä¸ªåˆ†å‰ï¼ˆå³ä»¥åèŠ‚ç‚¹çš„å”çˆ¶ï¼‰åŒºå—ï¼ŒæœŸå¾…ä»¥åè¢«åŒ…å«è¿›å»ä»¥è·å–åˆå—å¥–åŠ±</p><h2 id="GHOSTåè®®ï¼šä¸å½“å‰åŒºå—åœ¨7ä»£ä»¥å†…ï¼Œæ‰è¢«è®¤ä¸ºæ˜¯uncle-block">GHOSTåè®®ï¼šä¸å½“å‰åŒºå—åœ¨7ä»£ä»¥å†…ï¼Œæ‰è¢«è®¤ä¸ºæ˜¯uncle block</h2><p><img src="https://gitee.com/guozhe001/images/raw/master/637.png" alt="637"></p><p>è·ç¦»å½“å‰åŒºå—è¶Šè¿œçš„uncle blockï¼Œå¾—åˆ°çš„å¥–åŠ±è¶Šå°‘ï¼›ä¸ºäº†é˜²æ­¢åˆ†å‰è¿‡å¤šï¼Œæœ‰åˆ©äºé¼“åŠ±å‡ºç°åˆ†å‰å°½å¿«åˆå¹¶ã€‚å”çˆ¶åŒºå—å¾—ä¸åˆ°gas feeï¼ˆæ±½æ²¹è´¹ï¼‰</p><h1 id="19-ETH-æŒ–çŸ¿ç®—æ³•ï¼ˆethashï¼‰">19-ETH-æŒ–çŸ¿ç®—æ³•ï¼ˆethashï¼‰</h1><p>Block chain is secured by miningã€‚</p><p>bug bountyï¼šbugèµé‡‘</p><p>one cpuï¼Œ one voteï¼ˆä¸€ä¸ªcpuï¼Œä¸€å¼ æŠ•ç¥¨ï¼‰</p><p>è®¾è®¡puzzleçš„åŸåˆ™ï¼šdifficult to solveï¼Œ but easy to verify</p><p>ä»¥å¤ªåŠçš„æŒ–çŸ¿ç®—æ³•çš„ç›®æ ‡æ˜¯åšåˆ°ï¼šAISC resistance</p><p>memory hard mining puzzle</p><p><img src="https://gitee.com/guozhe001/images/raw/master/676.png" alt="676"></p><h1 id="20-ETH-éš¾åº¦è°ƒæ•´">20-ETH-éš¾åº¦è°ƒæ•´</h1><h2 id="è‡ªé€‚åº”éš¾åº¦è°ƒæ•´">è‡ªé€‚åº”éš¾åº¦è°ƒæ•´</h2><p><img src="https://gitee.com/guozhe001/images/raw/master/680.png" alt="680"></p><h3 id="å­å…¬å¼è§£é‡Š">å­å…¬å¼è§£é‡Š</h3><p><img src="https://gitee.com/guozhe001/images/raw/master/681.png" alt="681"></p><h2 id="éš¾åº¦ç‚¸å¼¹ï¼ˆdifficulty-bombï¼‰">éš¾åº¦ç‚¸å¼¹ï¼ˆdifficulty bombï¼‰</h2><p><img src="https://gitee.com/guozhe001/images/raw/master/682.png" alt="682"></p><h2 id="ä»¥å¤ªåŠå‘å±•çš„å››ä¸ªé˜¶æ®µ">ä»¥å¤ªåŠå‘å±•çš„å››ä¸ªé˜¶æ®µ</h2><p><img src="https://gitee.com/guozhe001/images/raw/master//%E4%B8%8B%E8%BD%BD.png" alt=" ä»¥å¤ªåŠå‘å±•çš„å››ä¸ªé˜¶æ®µ"></p><h1 id="21-æƒç›Šè¯æ˜ï¼ˆProof-of-stakeï¼‰">21-æƒç›Šè¯æ˜ï¼ˆProof of stakeï¼‰</h1><p>TWHï¼šTerawatt hours</p><p><strong>é—®é¢˜ï¼šä¸ºä»€ä¹ˆéœ€è¦æƒç›Šè¯æ˜ï¼Ÿ</strong></p><p>å·¥ä½œé‡è¯æ˜å¤ªè´¹ç”µäº†</p><p>åˆå—å¥–åŠ±æ˜¯ä¸ºäº†æ¿€åŠ±çŸ¿å·¥å‚ä¸æ¯”ç‰¹å¸ç³»ç»Ÿçš„ç»´æŠ¤ã€‚</p><p>virtual mining</p><p><strong>æƒç›Šè¯æ˜ï¼š</strong></p><ul><li><p>æ¯ä¸ªäººæŒ‰ç…§æŒæœ‰å¸çš„æ•°é‡æ¥æŠ•ç¥¨ï¼Œçœå»äº†æŒ–çŸ¿çš„è¿‡ç¨‹ï¼›æŒæœ‰çš„å¸è¶Šå¤šï¼Œæƒç›Šè¶Šå¤§ã€‚</p></li><li><p>æŒæœ‰çš„å¸åªèƒ½ä»åŠ å¯†è´§å¸çš„ç³»ç»Ÿä¸­è·å–ï¼Œå¦‚æœæœ‰äººå¤§é‡è´­ä¹°è¿™ä¸ªå¸ä»¥è·å–æƒç›Šç„¶åæå®ä»–ï¼Œä¼šå¯¼è‡´å¸ä»·å¤§æ¶¨ï¼›æ¶¨ä»·ä¼šè®©æå®è¿™ä¸ªå¸æ‰€ä»˜å‡ºçš„ä»£ä»·å¾ˆå¤§ã€‚</p></li></ul><p>AltCoin Infanticideï¼šæŠŠæ–°å¸æ‰¼æ€åœ¨æ‘‡ç¯®é‡Œ</p><p>Proof of Deposit</p><p>å¦‚æœå‡ºç°åˆ†å‰çš„æ—¶å€™ï¼Œä¸€ä¸ªäººä¸¤è¾¹éƒ½æŒ–ï¼Œå¹¶ä¸ä¼šå½±å“ä»–çš„å¸çš„æ•°é‡ã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master/674.png" alt="674"></p><p>Casper the Friendly Finality Gadgetï¼ˆFFGï¼‰</p><p>éªŒè¯è€…æœ‰ä»»æœŸï¼ŒéªŒè¯è€…åœ¨ä»»æœŸå¤–æœ‰ç­‰å¾…æœŸï¼Œå¦‚æœæ²¡æœ‰äººæ£€ä¸¾åˆ™ç»™éªŒè¯è€…ä¿è¯é‡‘å’Œå¥–åŠ±ã€‚</p><p>EOSå¸çš„æƒç›Šè¯æ˜ï¼š</p><p>DPOSï¼šDelegated Proof of Stake</p><h1 id="22-ETH-æ™ºèƒ½åˆçº¦">22-ETH-æ™ºèƒ½åˆçº¦</h1><h2 id="å¤–éƒ¨è´¦æˆ·å¦‚ä½•è°ƒç”¨æ™ºèƒ½åˆçº¦ï¼Ÿ">å¤–éƒ¨è´¦æˆ·å¦‚ä½•è°ƒç”¨æ™ºèƒ½åˆçº¦ï¼Ÿ</h2><p><img src="https://gitee.com/guozhe001/images/raw/master/638.png" alt="638"></p><ul><li><p>SENDER ADDRESSï¼šè°ƒç”¨è€…çš„åœ°å€</p></li><li><p>TO CONTRACT ADDRESSï¼šæ™ºèƒ½åˆçº¦çš„åœ°å€</p></li><li><p>VALUEï¼šè°ƒç”¨æ—¶è½¬å¤šå°‘ETH</p></li><li><p>GAS USEDï¼šæ±½æ²¹è´¹</p></li><li><p>GAS PRICEï¼šæ±½æ²¹è´¹çš„ä»·æ ¼</p></li><li><p>CAS LIMITï¼šæ­¤è°ƒç”¨æ„¿æ„æ”¯ä»˜çš„æ±½æ²¹è´¹ä¸Šé™</p></li><li><p>TX DATAï¼šè°ƒç”¨çš„å‡½æ•°åŠå…¶å‚æ•°çš„ç¼–ç å€¼</p></li></ul><h2 id="ä¸€ä¸ªåˆçº¦å¦‚ä½•è°ƒç”¨å¦ä¸€ä¸ªåˆçº¦ä¸­çš„å‡½æ•°">ä¸€ä¸ªåˆçº¦å¦‚ä½•è°ƒç”¨å¦ä¸€ä¸ªåˆçº¦ä¸­çš„å‡½æ•°</h2><h3 id="1ã€ç›´æ¥è°ƒç”¨">1ã€ç›´æ¥è°ƒç”¨</h3><p><img src="https://gitee.com/guozhe001/images/raw/master/639.png" alt="639"></p><h3 id="2ã€ä½¿ç”¨adressç±»å‹çš„call-å‡½æ•°">2ã€ä½¿ç”¨adressç±»å‹çš„call()å‡½æ•°</h3><p><img src="https://gitee.com/guozhe001/images/raw/master/640.png" alt="640"></p><h3 id="3ã€ä»£ç†è°ƒç”¨delegatecall">3ã€ä»£ç†è°ƒç”¨delegatecall()</h3><h3 id="é”™è¯¯å¤„ç†">é”™è¯¯å¤„ç†</h3><ul><li><p>assertï¼šä¸€èˆ¬ç”¨æ¥åˆ¤æ–­å†…éƒ¨æ¡ä»¶</p></li><li><p>requiredï¼šä¸€èˆ¬ç”¨äºåˆ¤æ–­å¤–éƒ¨æ¡ä»¶</p></li><li><p>revertï¼šæ— æ¡ä»¶çš„æŠ›å‡ºå¼‚å¸¸</p></li></ul><h2 id="åµŒå¥—è°ƒç”¨">åµŒå¥—è°ƒç”¨</h2><p><img src="https://gitee.com/guozhe001/images/raw/master/641.png" alt="641"></p><p><img src="https://gitee.com/guozhe001/images/raw/master/642.png" alt="642"></p><p>å…ˆæ‰§è¡Œäº¤æ˜“å†æŒ–çŸ¿,å› ä¸ºæŒ–çŸ¿ä¹‹åå‘å¸ƒçš„è´¦æˆ·çŠ¶æ€éœ€è¦å…ˆæ‰§è¡Œäº¤æ˜“ã€‚</p><p>å°±ç®—è´¦æˆ·çš„ä»£ç æ‰§è¡Œé”™è¯¯ï¼Œä¹Ÿä¼šè¢«å‘å¸ƒï¼›ç„¶åæ”¶å–æ±½æ²¹è´¹ï¼Œä¸ºäº†é˜²æ­¢æœ‰æ¶æ„èŠ‚ç‚¹å‘é€å¤§é‡çš„ä¸èƒ½éªŒè¯é€šè¿‡çš„äº¤æ˜“ã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master/658.png" alt="658"></p><p><strong>é—®é¢˜ï¼šæ™ºèƒ½åˆçº¦çš„ä»£ç æ”¯æŒå¤šçº¿ç¨‹æ‰§è¡Œå—ï¼Ÿ</strong></p><p>ä¸æ”¯æŒå¤šçº¿ç¨‹,å¤šçº¿ç¨‹å¯èƒ½é€ æˆæ‰§è¡Œç»“æœçš„ä¸ä¸€è‡´ã€‚</p><h2 id="æ™ºèƒ½åˆçº¦å¯ä»¥è·å¾—çš„åŒºå—ä¿¡æ¯">æ™ºèƒ½åˆçº¦å¯ä»¥è·å¾—çš„åŒºå—ä¿¡æ¯</h2><p><img src="https://gitee.com/guozhe001/images/raw/master/659.png" alt="659"></p><h2 id="æ™ºèƒ½åˆçº¦å¯ä»¥è·å¾—çš„è°ƒç”¨ä¿¡æ¯">æ™ºèƒ½åˆçº¦å¯ä»¥è·å¾—çš„è°ƒç”¨ä¿¡æ¯</h2><p><img src="https://gitee.com/guozhe001/images/raw/master/660.png" alt="660"></p><h2 id="åœ°å€ç±»å‹">åœ°å€ç±»å‹</h2><p><img src="https://gitee.com/guozhe001/images/raw/master/661.png" alt="661"></p><p>åœ°å€ç±»å‹ä¸­çš„ä¸åŒæ–¹æ³•è½¬è´¦æ—¶çš„ç‰¹ç‚¹ï¼š</p><ul><li>transferï¼šä¼šå¯¼è‡´è¿é”æ€§å›æ»š</li><li>sendï¼šä¸ä¼šå¯¼è‡´è¿é”æ€§å›æ»š</li><li>callï¼šä¸ä¼šå¯¼è‡´è¿é”å¼å›æ»šï¼Œcallçš„æ–¹å¼è½¬è´¦ä¼šæŠŠå‰©ä½™çš„æ±½æ²¹å…¨éƒ¨å‘é€è¿‡å»</li></ul><h2 id="ä¸€ä¸ªä¾‹å­ï¼šç®€å•æ‹å–">ä¸€ä¸ªä¾‹å­ï¼šç®€å•æ‹å–</h2><h3 id="æ„é€ æ–¹æ³•">æ„é€ æ–¹æ³•</h3><p><img src="https://gitee.com/guozhe001/images/raw/master/662.png" alt="662"></p><h3 id="å‡ºä»·å’Œç»“æŸæ‹å–çš„æ–¹æ³•">å‡ºä»·å’Œç»“æŸæ‹å–çš„æ–¹æ³•</h3><p><img src="https://gitee.com/guozhe001/images/raw/master/663.png" alt="663"></p><h3 id="å¦‚æœé»‘å®¢çš„æ™ºèƒ½åˆçº¦ä¸­æ²¡æœ‰callbackæ–¹æ³•æ€ä¹ˆåŠï¼Ÿ">å¦‚æœé»‘å®¢çš„æ™ºèƒ½åˆçº¦ä¸­æ²¡æœ‰callbackæ–¹æ³•æ€ä¹ˆåŠï¼Ÿ</h3><p><img src="https://gitee.com/guozhe001/images/raw/master/664.png" alt="664"></p><p>æ²¡æœ‰åŠæ³•ã€‚ã€‚ã€‚</p><h2 id="Code-is-lowï¼š">Code is lowï¼š</h2><p>ä¼˜ç‚¹ï¼šæ²¡æœ‰äººèƒ½å¤Ÿä¿®æ”¹è§„åˆ™</p><p>ç¼ºç‚¹ï¼šå¦‚æœè§„åˆ™æœ‰é—®é¢˜ï¼Œä¹Ÿæ— æ³•ä¿®æ­£ï¼Œå¯¼è‡´ä¸Šé¢çš„é—®é¢˜æˆä¸ºæ‰€æœ‰äººçš„é’±éƒ½å–ä¸å‡ºæ¥</p><h2 id="ä¼˜åŒ–åçš„æ‹å–ä»£ç ">ä¼˜åŒ–åçš„æ‹å–ä»£ç </h2><p><img src="https://gitee.com/guozhe001/images/raw/master/665.png" alt="665"></p><h3 id="æ— æ³•é˜²æ­¢é‡å…¥æ”»å‡»ï¼ˆRe-entrancy-Attackï¼‰">æ— æ³•é˜²æ­¢é‡å…¥æ”»å‡»ï¼ˆRe-entrancy Attackï¼‰</h3><p><img src="https://gitee.com/guozhe001/images/raw/master/666.png" alt="666"></p><p>è§£å†³çš„æ–¹æ³•æ˜¯ï¼Œå…ˆæŠŠé‡‘é¢ä¿®æ”¹ä¸º0ï¼Œå†å‘èµ·è½¬è´¦ã€‚</p><p>è½¬è´¦äº¤æ˜“æ—¶éœ€è¦ä½¿ç”¨è¿™ä¸ªæ­¥éª¤ï¼šå…ˆåˆ¤æ–­æ¡ä»¶ï¼Œå†æ”¹å˜æ¡ä»¶ï¼Œå†å‘ç”Ÿäº¤äº’</p><p>better safe by sorry</p><h3 id="ä¸è¦ä½¿ç”¨callæ–¹æ³•è½¬è´¦ï¼Œå› ä¸ºcallæ”¯ä»˜çš„æ±½æ²¹è´¹å¤ªå¤š">ä¸è¦ä½¿ç”¨callæ–¹æ³•è½¬è´¦ï¼Œå› ä¸ºcallæ”¯ä»˜çš„æ±½æ²¹è´¹å¤ªå¤š</h3><p><img src="https://gitee.com/guozhe001/images/raw/master/667.png" alt="667"></p><h1 id="23-ETH-TheDAO">23-ETH-TheDAO</h1><p>DAOï¼šDecentralized Autonomous Organizationï¼ˆå»ä¸­å¿ƒåŒ–çš„è‡ªæ²»çš„ç»„ç»‡ï¼‰</p><p>DACï¼šDecentralized Autonomous Corporationï¼ˆå»ä¸­å¿ƒåŒ–çš„è‡ªæ²»çš„å…¬å¸ï¼‰</p><p>å› ä¸ºå…ˆè½¬è´¦å†æ›´æ”¹ä½™é¢å¯¼è‡´è¢«å‘èµ·äº†é‡å…¥æ”»å‡»ï¼š</p><p><img src="https://gitee.com/guozhe001/images/raw/master/image-20201126161738940.png" alt="image-20201126161738940"></p><p>too big to fail</p><p>å‡çº§åäº§ç”Ÿä¸¤ä¸ªåˆ†å‰ï¼šé€šè¿‡åœ¨é“¾ä¸Šå¢åŠ ChainIDï¼ˆä¸ºäº†é˜²æ­¢å›æ”¾ï¼‰ï¼Œä»¥åŒºåˆ†ETC(Ethereum Classic)å’ŒETH</p><h2 id="ä¸ºä»€ä¹ˆä¸èƒ½åªé’ˆå¯¹é»‘å®¢çš„è´¦æˆ·ï¼Ÿ">ä¸ºä»€ä¹ˆä¸èƒ½åªé’ˆå¯¹é»‘å®¢çš„è´¦æˆ·ï¼Ÿ</h2><p>å› ä¸ºæ™ºèƒ½åˆçº¦æœ‰bugï¼Œæ‰€ä»¥å°±ç®—åªé’ˆå¯¹é»‘å®¢çš„è´¦æˆ·å…¶ä»–äººä¹Ÿå¯ä»¥é’ˆå¯¹è¿™ä¸ªbugè¿›è¡Œæ”»å‡»ã€‚</p><h1 id="24-ETH-æ€è€ƒ">24-ETH-æ€è€ƒ</h1><h2 id="Is-smart-contract-really-smartï¼Ÿï¼ˆæ™ºèƒ½åˆçº¦çœŸçš„æ™ºèƒ½å—ï¼‰">Is smart contract really smartï¼Ÿï¼ˆæ™ºèƒ½åˆçº¦çœŸçš„æ™ºèƒ½å—ï¼‰</h2><p>smart contract is anything but smart</p><h2 id="Nothing-is-irrevocableï¼ˆæ²¡æœ‰ä»€ä¹ˆæ˜¯ä¸å¯ç¯¡æ”¹çš„ï¼‰">Nothing is irrevocableï¼ˆæ²¡æœ‰ä»€ä¹ˆæ˜¯ä¸å¯ç¯¡æ”¹çš„ï¼‰</h2><p>å¦‚TheDAOçš„ä¾‹å­ï¼›æ‰€ä»¥ä¸èƒ½è¿·ä¿¡â€œä¸å¯ç¯¡æ”¹â€</p><h2 id="Is-solidity-the-right-programming-languageï¼Ÿ">Is solidity the right programming languageï¼Ÿ</h2><p>solidityå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œä½†æ˜¯æ²¡æœ‰ä»€ä¹ˆä¸œè¥¿æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚æ‰€ä»¥éšç€æ—¶é—´çš„æ£€éªŒå¯èƒ½ä¼šå‡ºç°</p><ul><li><p>æ™ºèƒ½åˆçº¦æ¨¡æ¿</p></li><li><p>ç¼–å†™æ™ºèƒ½åˆçº¦çš„å…¬å¸</p></li></ul><p>è™½ç„¶æ™ºèƒ½åˆçº¦çš„å†…å®¹æ˜¯å¼€æºçš„ï¼Œä½†æ˜¯Many eyeball fallacyï¼›åœ¨æ¶‰åŠåˆ°è‡ªå·±çš„åˆ©ç›Šæ—¶è¿˜æ˜¯éœ€è¦è‡ªå·±æ£€æŸ¥ä»£ç ã€‚</p><h2 id="What-does-decentralizationï¼ˆæƒåˆ©ä¸‹æ”¾ï¼‰-meanï¼Ÿ">What does decentralizationï¼ˆæƒåˆ©ä¸‹æ”¾ï¼‰ meanï¼Ÿ</h2><p>åˆ†å‰æ˜¯å»ä¸­å¿ƒåŒ–å’Œæ°‘ä¸»çš„ä½“ç°</p><h2 id="decentralized-distributed-å»ä¸­å¿ƒåŒ–ä¸ç­‰äºåˆ†å¸ƒå¼">decentralized != distributed(å»ä¸­å¿ƒåŒ–ä¸ç­‰äºåˆ†å¸ƒå¼)</h2><p>state machineçš„åº”ç”¨åœºæ™¯ï¼š</p><ul><li>mission critical applicationï¼ˆå…³é”®ä»»åŠ¡åº”ç”¨ç¨‹åºï¼‰</li><li>air traffic controlï¼ˆç©ºä¸­äº¤é€šç®¡åˆ¶ï¼‰</li><li>stock exchangeï¼ˆè¯åˆ¸äº¤æ˜“ï¼‰</li><li>space shuttleï¼ˆèˆªå¤©é£æœºï¼‰</li></ul><p>æ™ºèƒ½åˆçº¦æ˜¯ç”¨æ¥ç¼–å†™æ§åˆ¶ç¨‹åºçš„ï¼Œåªæœ‰åœ¨äº’ä¸ä¿¡ä»»çš„å®ä½“ä¹‹é—´å»ºç«‹å…±è¯†çš„æ“ä½œæ‰éœ€è¦å†™åœ¨æ™ºèƒ½åˆçº¦é‡Œ</p><h1 id="25-ETH-Beauty-Chainï¼ˆç¾é“¾ï¼‰">25-ETH-Beauty Chainï¼ˆç¾é“¾ï¼‰</h1><p>IPOï¼šInitial Public Offering</p><p>ICOï¼šInitial Coin Offering</p><h2 id="ç¾é“¾èƒŒæ™¯ä»‹ç»">ç¾é“¾èƒŒæ™¯ä»‹ç»</h2><p>ä¸‹å›¾ä¸­å‡ºç°çš„ERCä¸ºEthereum Request for Commentsï¼ˆä»¥å¤ªåŠå¾æ±‚æ„è§ï¼‰</p><p><img src="https://gitee.com/guozhe001/images/raw/master/683.png" alt="683"></p><h2 id="å› ä¸ºä¸‹é¢çš„ä»£ç åœ¨è®¡ç®—æ—¶å‡ºç°äº†æº¢å‡ºï¼Œä»è€Œå¯¼è‡´è¢«æ”»å‡»ï¼Œå‡­ç©ºå‡ºç°äº†å¾ˆå¤šçš„ä»£å¸BEC">å› ä¸ºä¸‹é¢çš„ä»£ç åœ¨è®¡ç®—æ—¶å‡ºç°äº†æº¢å‡ºï¼Œä»è€Œå¯¼è‡´è¢«æ”»å‡»ï¼Œå‡­ç©ºå‡ºç°äº†å¾ˆå¤šçš„ä»£å¸BEC</h2><p><img src="https://gitee.com/guozhe001/images/raw/master/image-20201126163601352.png" alt="image-20201126163601352"></p><h2 id="å¦‚ä½•é¢„é˜²æ­¤ç±»ï¼ˆè®¡ç®—æº¢å‡ºï¼‰é—®é¢˜ï¼Ÿ">å¦‚ä½•é¢„é˜²æ­¤ç±»ï¼ˆè®¡ç®—æº¢å‡ºï¼‰é—®é¢˜ï¼Ÿ</h2><p><img src="https://gitee.com/guozhe001/images/raw/master/image-20201126163925215.png" alt="image-20201126163925215"></p><h1 id="26-æ€»ç»“">26-æ€»ç»“</h1><ul><li><p>åŠ å¯†è´§å¸åº”è¯¥ç”¨åœ¨æ³•å¸æ”¯æŒçš„ä¸å¤ªå¥½çš„åœ°æ–¹ï¼Œè€Œä¸æ˜¯ç”¨åœ¨æ³•å¸å·²ç»æ”¯æŒçš„å¾ˆå¥½çš„åœ°æ–¹ã€‚</p></li><li><p>ä¸‹ä¸€ä»£çš„çš„äº’è”ç½‘æ˜¯ä»·å€¼äº¤æ¢ç½‘ç»œ</p></li><li><p>Democracy is the worst from of Government except for all those other forms that have bean tried from time to time</p></li><li><p>Is decentralized aways right thing?</p></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>è¯»ä¹¦ç¬”è®°-ã€Šæˆ‘çš„ç¬¬ä¸€æœ¬ç®—æ³•ä¹¦ã€‹</title>
      <link href="2021/04/01/algorithms/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-%E3%80%8A%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E6%9C%AC%E7%AE%97%E6%B3%95%E4%B9%A6%E3%80%8B/"/>
      <url>2021/04/01/algorithms/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-%E3%80%8A%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E6%9C%AC%E7%AE%97%E6%B3%95%E4%B9%A6%E3%80%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¬¬ä¸€ç« ï¼šæ•°æ®ç»“æ„">ç¬¬ä¸€ç« ï¼šæ•°æ®ç»“æ„</h1><h2 id="é“¾è¡¨">é“¾è¡¨</h2><h3 id="ç‰¹æ€§">ç‰¹æ€§</h3><ul><li>å‘ˆçº¿æ€§æ’åˆ—çš„æ•°æ®ç»“æ„ï¼Œå…ƒç´ ä¸­æœ‰å­—æ®µæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ </li></ul><h3 id="å†…å­˜">å†…å­˜</h3><ul><li>å†…å­˜ç©ºé—´ä¸è¿ç»­</li></ul><h3 id="æ—¶é—´å¤æ‚åº¦">æ—¶é—´å¤æ‚åº¦</h3><ul><li><p>åˆ é™¤ï¼š</p><ul><li><p>ç›´æ¥åœ¨æœ€åæŠŠæŒ‡å‘è¢«åˆ é™¤çš„å…ƒç´ æ”¹ä¸ºæŒ‡å‘è¢«åˆ é™¤çš„ä¸‹ä¸€ä¸ªå…ƒç´ ä¿®æ”¹å³å¯</p></li><li><p>æ—¶é—´å¤æ‚åº¦ï¼šO(1)</p></li></ul></li><li><p>æ·»åŠ ï¼š</p><ul><li><p>ç›´æ¥åœ¨å½“å‰åˆ—è¡¨çš„æœ€åçš„å…ƒç´ çš„æŒ‡å‘å¦ä¸€ä¸ªå…ƒç´ å³å¯</p></li><li><p>æ—¶é—´å¤æ‚åº¦ï¼šO(1)</p></li></ul></li><li><p>æŸ¥è¯¢ï¼š</p><ul><li><p>éœ€è¦ä»æœ€å¼€å§‹çš„å…ƒç´ æŸ¥è¯¢</p></li><li><p>æ—¶é—´å¤æ‚åº¦ï¼šO(n)</p></li></ul></li></ul><h3 id="æ‰©å±•">æ‰©å±•</h3><ul><li>å¾ªç¯é“¾è¡¨ï¼Œæœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ æŒ‡å‘å¼€å¤´çš„å…ƒç´ </li><li>æ¯ä¸ªå…ƒç´ æœ‰ä¸¤ä¸ªæŒ‡å‘ï¼Œåˆ†åˆ«æŒ‡å‘å‰ä¸€ä¸ªå…ƒç´ å’Œåä¸€ä¸ªå…ƒç´ </li></ul><h2 id="æ•°ç»„">æ•°ç»„</h2><h3 id="ç‰¹æ€§-v2">ç‰¹æ€§</h3><ul><li>å‘ˆçº¿æ€§æ’åˆ—çš„æ•°æ®ç»“æ„ï¼Œå…ƒç´ æœ‰ä¸‹æ ‡</li></ul><h3 id="å†…å­˜-v2">å†…å­˜</h3><ul><li>å…ƒç´ åœ¨å†…å­˜ä¸­æ˜¯è¿ç»­çš„</li></ul><h3 id="æ—¶é—´å¤æ‚åº¦-v2">æ—¶é—´å¤æ‚åº¦</h3><ul><li><p>æ·»åŠ ï¼š</p><ul><li><p>é¦–å…ˆéœ€è¦åœ¨æœ«å°¾å¢åŠ éœ€è¦çš„å­˜å‚¨ç©ºé—´ï¼ŒæŠŠéœ€è¦æ·»åŠ çš„ä½ç½®ä»¥åŠä»¥åçš„å…ƒç´ çš„ä¸‹æ ‡å…¨éƒ¨+1ï¼ŒæŠŠéœ€è¦æ·»åŠ çš„ä½ç½®æ”¾è¿›æ–°çš„å…ƒç´ </p></li><li><p>æ—¶é—´å¤æ‚åº¦ï¼šO(n)</p></li></ul></li><li><p>åˆ é™¤ï¼š</p><ul><li><p>ä¾æ­¤æŠŠéœ€è¦åˆ é™¤çš„ä½ç½®çš„ä»¥åçš„å…ƒç´ çš„ä¸‹æ ‡-1</p></li><li><p>æ—¶é—´å¤æ‚åº¦ï¼šO(n)</p></li></ul></li><li><p>æŸ¥è¯¢ï¼š</p><ul><li><p>æ ¹æ®ä¸‹æ ‡ç›´æ¥éšæœºè®¿é—®</p></li><li><p>æ—¶é—´å¤æ‚åº¦ï¼šO(1)</p></li></ul></li></ul><h2 id="æ ˆ">æ ˆ</h2><h3 id="ç‰¹æ€§-v3">ç‰¹æ€§</h3><ul><li><p>å‘ˆçº¿æ€§æ’åˆ—çš„æ•°æ®ç»“æ„ï¼›åè¿›å…ˆå‡ºLast In First Outï¼Œç®€ç§° LIFO</p></li><li><p>pushï¼ˆå…¥æ ˆï¼‰ï¼Œpopï¼ˆå‡ºæ ˆï¼‰</p></li></ul><h3 id="æ—¶é—´å¤æ‚åº¦-v3">æ—¶é—´å¤æ‚åº¦</h3><ul><li>å…¥æ ˆå’Œå‡ºæ ˆï¼Œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ï¼šO(1)</li></ul><h2 id="é˜Ÿåˆ—">é˜Ÿåˆ—</h2><h3 id="ç‰¹æ€§-v4">ç‰¹æ€§</h3><ul><li>å‘ˆçº¿æ€§æ’åˆ—çš„æ•°æ®ç»“æ„ï¼›å…ˆè¿›å…ˆå‡ºFirst In First Outï¼Œç®€ç§°FIFO</li><li>å…¥é˜Ÿï¼Œå‡ºé˜Ÿ</li></ul><h3 id="æ—¶é—´å¤æ‚åº¦-v4">æ—¶é—´å¤æ‚åº¦</h3><ul><li>å…¥é˜Ÿå’Œå‡ºé˜Ÿçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ï¼šO(1)</li></ul><h2 id="å“ˆå¸Œè¡¨">å“ˆå¸Œè¡¨</h2><h3 id="ç‰¹æ€§-v5">ç‰¹æ€§</h3><ul><li>å“ˆå¸Œè¡¨å­˜å‚¨çš„æ˜¯ç”±é”®ï¼ˆkeyï¼‰å’Œå€¼ï¼ˆvalueï¼‰ç»„ æˆçš„æ•°æ®</li><li>å¦‚æœåœ¨hashå€¼ä¸å†²çªæ—¶ï¼Œå“ˆå¸Œè¡¨çš„æ¯ä¸ªæ¡¶éƒ½åªä¿å­˜ä¸€ä¸ªkeyï¼›å¦‚æœhashå€¼å†²çªäº†ï¼Œåˆ™ä¼šå˜æˆé“¾è¡¨å­˜å‚¨</li><li>å…ˆç”¨keyè®¡ç®—hashå€¼ï¼Œå°†å¾—åˆ°çš„å“ˆå¸Œå€¼é™¤ä»¥æ•°ç»„çš„é•¿åº¦ï¼Œæ±‚å¾—å…¶ä½™æ•°ã€å°±æ‰¾åˆ°äº†å­˜å‚¨ä½ç½®ã€‚è¿™æ ·çš„æ±‚ä½™è¿ç®—å«ä½œâ€œmod è¿ç®—â€</li><li>å¦‚æœä¸¤ä¸ªkeyçš„hashå€¼æ±‚ä½™åæ‰¾åˆ°çš„å­˜å‚¨ä½ç½®å·²ç»æœ‰å€¼ï¼Œè¿™ç§å­˜å‚¨ä½ç½®é‡å¤äº†çš„æƒ…å†µä¾¿å«ä½œâ€œå†²çªâ€ã€‚é‡åˆ°è¿™ç§æƒ…å†µï¼Œå¯ä½¿ç”¨é“¾è¡¨åœ¨å·²æœ‰æ•°æ®çš„åé¢ ç»§ç»­å­˜å‚¨æ–°çš„æ•°æ®</li></ul><h3 id="æ—¶é—´å¤æ‚åº¦-v5">æ—¶é—´å¤æ‚åº¦</h3><ul><li>å“ˆå¸Œè¡¨çš„æ—¶é—´å¤æ‚åº¦ä¸hashç®—æ³•æœ‰å…³<ul><li>å¦‚æœhashå€¼ä¸ä¼šå†²çªï¼ˆç†æƒ³æƒ…å†µï¼‰ï¼Œåˆ™æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤ã€æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ï¼šO(1)</li><li>å¦‚æœhashå€¼å…¨éƒ¨ä¸€è‡´ï¼Œåˆ™hashè¡¨å…¶å®å°±æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿä¸é“¾è¡¨ä¸€è‡´</li></ul></li></ul><h3 id="è¡¥å……è¯´æ˜">è¡¥å……è¯´æ˜</h3><p>åœ¨å­˜å‚¨æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘ç”Ÿå†²çªï¼Œå¯ä»¥åˆ©ç”¨é“¾è¡¨åœ¨å·²æœ‰æ•°æ®çš„åé¢æ’å…¥æ–°æ•°æ® æ¥è§£å†³å†²çªï¼›è¿™ç§æ–¹æ³•è¢«ç§°ä¸ºâ€œé“¾åœ°å€æ³•â€ã€‚</p><p>é™¤äº†é“¾åœ°å€æ³•ä»¥å¤–ï¼Œè¿˜æœ‰å‡ ç§è§£å†³å†²çªçš„æ–¹æ³•ã€‚</p><p>å…¶ä¸­ï¼Œåº”ç”¨è¾ƒä¸ºå¹¿æ³›çš„æ˜¯â€œå¼€æ”¾åœ°å€æ³•â€ã€‚è¿™ç§æ–¹æ³•æ˜¯æŒ‡å½“å†²çªå‘ç”Ÿæ—¶ï¼Œç«‹åˆ»è®¡ç®—å‡ºä¸€ä¸ªå€™è¡¥åœ°å€ï¼ˆæ•°ç»„ä¸Šçš„ä½ç½®ï¼‰å¹¶å°†æ•° æ®å­˜è¿›å»ã€‚å¦‚æœä»ç„¶æœ‰å†²çªï¼Œä¾¿ç»§ç»­è®¡ç®—ä¸‹ä¸€ä¸ªå€™è¡¥åœ°å€ï¼Œç›´åˆ°æœ‰ç©ºåœ°å€ä¸ºæ­¢ã€‚å¯ä»¥é€šè¿‡å¤šæ¬¡ä½¿ç”¨å“ˆå¸Œå‡½æ•°æˆ–â€œçº¿æ€§æ¢æµ‹æ³•â€ç­‰æ–¹æ³•è®¡ç®—å€™è¡¥åœ°å€ã€‚</p><h2 id="å †">å †</h2><h3 id="ç‰¹æ€§-v6">ç‰¹æ€§</h3><ul><li><p>å †æ˜¯ä¸€ç§å›¾çš„æ ‘å½¢ç»“æ„ï¼Œè¢«ç”¨äºå®ç°â€œä¼˜å…ˆé˜Ÿåˆ—â€ï¼ˆpriority queuesï¼‰ã€‚</p></li><li><p>ä¼˜å…ˆé˜Ÿåˆ—æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå¯ä»¥è‡ªç”±æ·»åŠ æ•°æ®ï¼Œä½†å–å‡ºæ•°æ®æ—¶è¦ä»æœ€å°å€¼å¼€å§‹æŒ‰é¡º åºå–å‡ºã€‚</p></li><li><p>åœ¨å †çš„æ ‘å½¢ç»“æ„ä¸­ï¼Œå„ä¸ªé¡¶ç‚¹è¢«ç§°ä¸ºâ€œç»“ç‚¹â€ï¼ˆnodeï¼‰ï¼Œæ•°æ®å°±å­˜å‚¨åœ¨è¿™äº›ç»“ç‚¹ä¸­ã€‚</p></li><li><p>å †ä¸­çš„èŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹çš„æ’åºä¸ºä»ä¸Šåˆ°ä¸‹ï¼ŒåŒä¸€è¡Œåˆ™ä»å·¦åˆ°å³ã€‚</p></li><li><p>å †ä¸­å­˜å‚¨æ•°æ®çš„è§„åˆ™ï¼šå­èŠ‚ç‚¹å¿…é¡»å¤§äºçˆ¶èŠ‚ç‚¹</p></li></ul><h3 id="æ—¶é—´å¤æ‚åº¦-v6">æ—¶é—´å¤æ‚åº¦</h3><ul><li><p>æ·»åŠ æ•°æ®</p><ul><li>å¢åŠ èŠ‚ç‚¹æ—¶åœ¨æœ€ä¸‹é¢ä¸€è¡Œçš„æœ€å·¦è¾¹å¢åŠ ï¼Œå¦‚æœæœ€ä¸‹é¢çš„ä¸€è¡Œæ²¡æœ‰ä½ç½®åˆ™å¢åŠ æ–°çš„ä¸€è¡Œ</li><li>å¦‚æœå¢åŠ çš„æ•°æ®æ¯”çˆ¶èŠ‚ç‚¹çš„æ•°å­—å°ï¼Œåˆ™ä¸çˆ¶èŠ‚ç‚¹äº¤æ¢ä½ç½®ï¼Œé‡å¤æ­¤æ­¥éª¤ç›´åˆ°æ¯”çˆ¶èŠ‚ç‚¹å¤§æˆ–è€…æ²¡æœ‰çˆ¶èŠ‚ç‚¹ä¸ºæ­¢</li><li>æ—¶é—´å¤æ‚åº¦ï¼šO(logn)</li></ul></li><li><p>å–å‡ºæ•°æ®</p><ul><li>å–å‡ºæ•°æ®æ°¸è¿œæ˜¯å–æœ€ä¸Šé¢èŠ‚ç‚¹çš„æ•°æ®</li><li>æœ€ä¸Šé¢èŠ‚ç‚¹çš„æ•°æ®è¢«å–èµ°ä¹‹åï¼Œéœ€è¦é‡æ–°è°ƒæ•´</li><li>é‡æ–°è°ƒæ•´æ—¶ï¼Œéœ€è¦æŠŠæœ€åçš„æ•°æ®ï¼ˆå³æœ€ä¸‹é¢ä¸€è¡Œæœ€å³è¾¹çš„èŠ‚ç‚¹ï¼‰ç§»åŠ¨åˆ°æœ€ä¸Šé¢</li><li>ç„¶åä¸æœ€ä¸Šé¢çš„ä¸¤ä¸ªå­èŠ‚ç‚¹åšæ¯”è¾ƒï¼Œå¦‚æœæ•°å­—å°äºä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ™è°ƒæ•´å®Œæˆ</li><li>å¦‚æœæœ€ä¸Šé¢çš„æ•°æ®å¤§äºå­èŠ‚ç‚¹çš„æ•°æ®ï¼Œåˆ™ä¸è¾ƒå°çš„å­èŠ‚ç‚¹çš„ä½ç½®è¿›è¡Œäº¤æ¢ï¼Œé‡å¤æ­¤æ“ä½œç›´åˆ°æ‰€æœ‰çˆ¶èŠ‚ç‚¹å°äºå­èŠ‚ç‚¹ä¸ºæ­¢</li><li>æ—¶é—´å¤æ‚åº¦:O(logn)</li></ul></li></ul><h2 id="äºŒå‰æŸ¥æ‰¾æ ‘">äºŒå‰æŸ¥æ‰¾æ ‘</h2><h3 id="ç‰¹æ€§-v7">ç‰¹æ€§</h3><ul><li><p>äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆåˆå«ä½œäºŒå‰æœç´¢æ ‘æˆ–äºŒå‰æ’åºæ ‘ï¼‰æ˜¯ä¸€ç§é‡‡ç”¨äº†å›¾çš„æ ‘å½¢ç»“æ„çš„æ•°æ®ç»“æ„</p></li><li><p>æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹</p></li><li><p><strong>æ¯ä¸ªèŠ‚ç‚¹çš„å€¼å¤§äºå…¶å·¦å­æ ‘çš„ä»»æ„èŠ‚ç‚¹çš„å€¼</strong></p></li><li><p><strong>æ¯ä¸ªèŠ‚ç‚¹çš„å€¼å°äºå…¶å³å­æ ‘çš„ä»»æ„èŠ‚ç‚¹çš„å€¼</strong></p></li><li><p>æ ¹æ®ä¸Šé¢çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“å¦‚æœæƒ³è¦æŸ¥æ‰¾æœ€å°å€¼ï¼Œåˆ™åœ¨å·¦è¾¹çš„æœ€æœ«ç«¯</p></li></ul><h3 id="æ—¶é—´å¤æ‚åº¦-v7">æ—¶é—´å¤æ‚åº¦</h3><ul><li><p>æ·»åŠ æ•°æ®</p><ul><li>ä»é¡¶ç«¯å¼€å§‹æŸ¥æ‰¾æ·»åŠ ä½ç½®</li><li>å¦‚æœæ·»åŠ çš„å€¼å¤§äºé¡¶ç«¯çš„å€¼ï¼Œåˆ™å¾€å³ç§»ï¼›å°äºå®ƒåˆ™å¾€å·¦ç§»</li><li>æ—¶é—´å¤æ‚åº¦ï¼šO(logn)</li></ul></li><li><p>åˆ é™¤æ•°æ®</p><ul><li>å¦‚æœåˆ é™¤çš„èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥åˆ é™¤æ­¤èŠ‚ç‚¹</li><li>å¦‚æœåˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ™åˆ é™¤æ­¤èŠ‚ç‚¹åæŠŠå­èŠ‚ç‚¹ç§»åˆ°å½“å‰çš„èŠ‚ç‚¹</li><li>å¦‚æœåˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ™åˆ é™¤æ­¤èŠ‚ç‚¹åæŠŠå·¦è¾¹å­èŠ‚ç‚¹çš„æœ€å³ç«¯ç§»åˆ°å½“å‰èŠ‚ç‚¹ï¼ˆä¹Ÿå¯ä»¥æŠŠå³è¾¹å­èŠ‚ç‚¹çš„æœ€å·¦ç«¯ç§»åˆ°å½“å‰èŠ‚ç‚¹ï¼‰</li><li>ä¸Šé¢çš„ä¸€å¥å¯ä»¥ç†è§£ä¸ºï¼šæŠŠå°äºè¢«åˆ é™¤çš„èŠ‚ç‚¹çš„æœ€å¤§å€¼ç§»åˆ°åˆ é™¤çš„èŠ‚ç‚¹ï¼›æˆ–è€…æŠŠå¤§äºè¢«åˆ é™¤èŠ‚ç‚¹çš„æœ€å°å€¼ç§»åˆ°åˆ é™¤èŠ‚ç‚¹</li><li>å¦‚æœç§»åŠ¨çš„èŠ‚ç‚¹è¿˜æœ‰å­èŠ‚ç‚¹ï¼Œä¹ŸæŒ‰ç…§åŒæ ·çš„æ–¹å¼ç§»åŠ¨</li><li>æ—¶é—´å¤æ‚åº¦ï¼šO(logn)</li></ul></li><li><p>æŸ¥æ‰¾æ•°æ®</p><ul><li>ä»é¡¶ç«¯å¼€å§‹æŸ¥æ‰¾</li><li>å¦‚æœå¤§äºæŸ¥æ‰¾èŠ‚ç‚¹çš„å€¼ï¼Œåˆ™å‘å³ç§»ï¼›å¦‚æœå°äºæŸ¥æ‰¾èŠ‚ç‚¹çš„å€¼ï¼Œåˆ™å‘å·¦ç§»ï¼›å¾ªç¯æ­¤æ“ä½œ</li><li>æ—¶é—´å¤æ‚åº¦ï¼šO(logn)</li></ul></li></ul><h3 id="æ‰©å±•-v2">æ‰©å±•</h3><h4 id="å…³äºæ—¶é—´å¤æ‚åº¦">å…³äºæ—¶é—´å¤æ‚åº¦</h4><ul><li>å¦‚æœæ•°çš„å½¢çŠ¶æ¯”è¾ƒå‡è¡¡ï¼ŒæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(logn)</li><li>å¦‚æœä¸å‡è¡¡æç«¯æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼ŒæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n)</li></ul><h4 id="ä»¥äºŒå‰æŸ¥æ‰¾æ ‘ä¸ºåŸºç¡€æ‰©å±•çš„æ•°æ®ç»“æ„">ä»¥äºŒå‰æŸ¥æ‰¾æ ‘ä¸ºåŸºç¡€æ‰©å±•çš„æ•°æ®ç»“æ„</h4><ul><li>â€œå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘â€ï¼šè¿™ç§æ•°æ®ç»“æ„å¯ä»¥ä¿®æ­£å½¢çŠ¶ä¸å‡è¡¡çš„æ ‘ï¼Œè®©å…¶å§‹ç»ˆä¿æŒå‡è¡¡å½¢æ€ï¼Œä»¥æé«˜æŸ¥æ‰¾æ•ˆç‡</li><li>â€œB æ ‘â€ï¼šäºŒå‰æŸ¥æ‰¾æ ‘ä¸­ä¸€ä¸ªç»“ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå­ç»“ç‚¹ï¼Œå¦‚æœæˆ‘ä»¬æŠŠå­ç»“ç‚¹æ•°æ‰©å±•ä¸º mï¼ˆm ä¸ºé¢„å…ˆè®¾å®šå¥½çš„å¸¸æ•°ï¼‰ã€‚åƒè¿™ç§å­ç»“ç‚¹æ•°å¯ä»¥è‡ªç”±è®¾å®šï¼Œå¹¶ä¸”å½¢çŠ¶å‡è¡¡çš„æ ‘ä¾¿æ˜¯ B æ ‘</li></ul><h1 id="ç¬¬äºŒç« ï¼šæ’åº">ç¬¬äºŒç« ï¼šæ’åº</h1><h2 id="å†’æ³¡æ’åº">å†’æ³¡æ’åº</h2><h3 id="ç®—æ³•é‡Šä¹‰">ç®—æ³•é‡Šä¹‰</h3><p>å†’æ³¡æ’åºå°±æ˜¯é‡å¤â€œä»åºåˆ—å³è¾¹å¼€å§‹æ¯”è¾ƒç›¸é‚»ä¸¤ä¸ªæ•°å­—çš„å¤§å°ï¼Œå†æ ¹æ®ç»“æœäº¤æ¢ä¸¤ä¸ªæ•°å­— çš„ä½ç½®â€è¿™ä¸€æ“ä½œçš„ç®—æ³•ã€‚</p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ•°å­—ä¼šåƒæ³¡æ³¡ä¸€æ ·ï¼Œæ…¢æ…¢ä»å³å¾€å·¦â€œæµ®â€åˆ°åºåˆ—çš„ é¡¶ç«¯ï¼Œæ‰€ä»¥è¿™ä¸ªç®—æ³•æ‰è¢«ç§°ä¸ºâ€œå†’æ³¡æ’åºâ€ã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦ï¼šO-nÂ²">æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²)</h3><p>åœ¨å†’æ³¡æ’åºä¸­ï¼š</p><ul><li><p>ç¬¬ 1 è½®éœ€è¦æ¯”è¾ƒ n -1 æ¬¡</p></li><li><p>ç¬¬ 2 è½®éœ€è¦æ¯”è¾ƒ n -2 æ¬¡</p></li><li><p>ç¬¬ n -1 è½®éœ€ è¦æ¯”è¾ƒ 1 æ¬¡</p></li></ul><p>å› æ­¤ï¼Œæ€»çš„æ¯”è¾ƒæ¬¡æ•°ä¸º (n -1) +(n -2) +â€¦+1 â‰ˆ nÂ² /2ã€‚è¿™ä¸ªæ¯”è¾ƒæ¬¡æ•°æ’å®šä¸º è¯¥æ•°å€¼ï¼Œå’Œè¾“å…¥æ•°æ®çš„æ’åˆ—é¡ºåºæ— å…³ã€‚</p><h3 id="Javaä»£ç å®ç°">Javaä»£ç å®ç°</h3><p><a href="https://github.com/guozhe001/my-tools/blob/master/my-learn/my-algorithm/src/main/java/com/nicai/algorithm/sort/BubbleSortStartFromLeft.java">å†’æ³¡æ’åº</a></p><h2 id="é€‰æ‹©æ’åº">é€‰æ‹©æ’åº</h2><h3 id="ç®—æ³•é‡Šä¹‰-v2">ç®—æ³•é‡Šä¹‰</h3><ul><li>é€‰æ‹©æ’åºå°±æ˜¯é‡å¤â€œä»å¾…æ’åºçš„æ•°æ®ä¸­å¯»æ‰¾æœ€å°å€¼ï¼Œå°†å…¶ä¸åºåˆ—æœ€å·¦è¾¹çš„æ•°å­—è¿›è¡Œäº¤æ¢â€ è¿™ä¸€æ“ä½œçš„ç®—æ³•ã€‚</li><li>åœ¨åºåˆ—ä¸­å¯»æ‰¾æœ€å°å€¼æ—¶ä½¿ç”¨çš„æ˜¯çº¿æ€§æŸ¥æ‰¾ã€‚</li></ul><h3 id="æ—¶é—´å¤æ‚åº¦ï¼šO-nÂ²-v2">æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²)</h3><p>é€‰æ‹©æ’åºä½¿ç”¨äº†çº¿æ€§æŸ¥æ‰¾æ¥å¯»æ‰¾æœ€å°å€¼ï¼Œå› æ­¤åœ¨</p><ul><li>ç¬¬ 1 è½®ä¸­éœ€è¦æ¯”è¾ƒ <em>n</em> - 1 ä¸ªæ•°å­—</li><li>ç¬¬ 2 è½®éœ€è¦æ¯”è¾ƒ <em>n</em> - 2 ä¸ªæ•°å­—</li><li>åˆ°ç¬¬ <em>n</em> - 1 è½®çš„æ—¶å€™å°±åªéœ€æ¯”è¾ƒ 1 ä¸ªæ•°å­—</li><li>å› æ­¤ï¼Œæ€»çš„æ¯”è¾ƒæ¬¡æ•°ä¸å†’æ³¡æ’åºçš„ç›¸åŒï¼Œéƒ½æ˜¯(<em>n</em>-1)+(<em>n</em>-2)+â€¦+1 â‰ˆ <em>n</em>2/2 æ¬¡ã€‚</li></ul><h3 id="Javaä»£ç å®ç°-v2">Javaä»£ç å®ç°</h3><p><a href="https://github.com/guozhe001/my-tools/blob/master/my-learn/my-algorithm/src/main/java/com/nicai/algorithm/sort/SelectSort.java">é€‰æ‹©æ’åº</a></p><h2 id="æ’å…¥æ’åº">æ’å…¥æ’åº</h2><h3 id="ç®—æ³•é‡Šä¹‰-v3">ç®—æ³•é‡Šä¹‰</h3><p>æ’å…¥æ’åºæ˜¯ä¸€ç§ä»åºåˆ—å·¦ç«¯å¼€å§‹ä¾æ¬¡å¯¹æ•°æ®è¿›è¡Œæ’åºçš„ç®—æ³•ã€‚</p><p>åœ¨æ’åºè¿‡ç¨‹ä¸­ï¼Œå·¦ä¾§çš„æ•°æ®é™†ç»­å½’ä½ï¼Œè€Œå³ä¾§ç•™ä¸‹çš„å°±æ˜¯è¿˜æœªè¢«æ’åºçš„æ•°æ®ã€‚</p><p>æ’å…¥æ’åºçš„æ€è·¯å°±æ˜¯ä»å³ä¾§çš„æœªæ’åºåŒºåŸŸå†…å–å‡ºä¸€ä¸ªæ•°æ®ï¼Œç„¶åå°†å®ƒæ’å…¥åˆ°å·²æ’åºåŒºåŸŸå†…åˆé€‚çš„ä½ç½®ä¸Šã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦ï¼šO-nÂ²-v3">æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²)</h3><h3 id="Javaä»£ç å®ç°-v3">Javaä»£ç å®ç°</h3><p><a href="https://github.com/guozhe001/my-tools/blob/master/my-learn/my-algorithm/src/main/java/com/nicai/algorithm/sort/InsertSort.java">æ’å…¥æ’åº</a></p><h2 id="å †æ’åº">å †æ’åº</h2><h3 id="ç®—æ³•é‡Šä¹‰-v4">ç®—æ³•é‡Šä¹‰</h3><p>å †æ’åºçš„ç‰¹ç‚¹æ˜¯åˆ©ç”¨äº†æ•°æ®ç»“æ„ä¸­çš„å †</p><ul><li>é¦–å…ˆï¼Œåœ¨å †ä¸­å­˜å‚¨æ‰€æœ‰çš„æ•°æ®ï¼Œå¹¶æŒ‰é™åºæ¥æ„å»ºå †</li><li>ç„¶åä»å †ä¸­å–å‡ºæ•°æ®ï¼Œå¹¶æŠŠå–å‡ºçš„æ•°æ®æ”¾åœ¨æœ€å³è¾¹çš„ç©ºä½ç½®</li></ul><h3 id="æ—¶é—´å¤æ‚åº¦ï¼šO-nlogn">æ—¶é—´å¤æ‚åº¦ï¼š<em>O</em>(<em>n</em>log<em>n</em>)</h3><p>å †æ’åºä¸€å¼€å§‹éœ€è¦å°† <em>n</em> ä¸ªæ•°æ®å­˜è¿›å †é‡Œï¼Œæ‰€éœ€æ—¶é—´ä¸º <em>O</em>(<em>n</em>log<em>n</em>)</p><p>æ¯è½®å–å‡ºæœ€å¤§çš„æ•°æ®å¹¶é‡æ„å †æ‰€éœ€è¦çš„æ—¶é—´ä¸º <em>O</em>(log<em>n</em>)</p><p>ç”±äºæ€»å…±æœ‰ <em>n</em> è½®ï¼Œæ‰€ä»¥é‡æ„åæ’åºçš„æ—¶é—´ä¹Ÿæ˜¯ <em>O</em>(<em>n</em>log<em>n</em>)</p><p>å› æ­¤ï¼Œæ•´ä½“æ¥çœ‹å †æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸º <em>O</em>(<em>n</em>log<em>n</em>)</p><h3 id="Javaä»£ç å®ç°-v4">Javaä»£ç å®ç°</h3><p>æš‚æ— </p><h2 id="å½’å¹¶æ’åº">å½’å¹¶æ’åº</h2><h3 id="ç®—æ³•é‡Šä¹‰-v5">ç®—æ³•é‡Šä¹‰</h3><p>å½’å¹¶æ’åºç®—æ³•ä¼šæŠŠåºåˆ—åˆ†æˆé•¿åº¦ç›¸åŒçš„ä¸¤ä¸ªå­åºåˆ—ï¼Œå½“æ— æ³•ç»§ç»­å¾€ä¸‹åˆ†æ—¶(ä¹Ÿå°±æ˜¯æ¯ä¸ªå­åºåˆ—ä¸­åªæœ‰ä¸€ä¸ªæ•°æ®æ—¶)ï¼Œå°±å¯¹å­åºåˆ—è¿›è¡Œå½’å¹¶ã€‚</p><p>å½’å¹¶æŒ‡çš„æ˜¯æŠŠä¸¤ä¸ªæ’å¥½åºçš„å­åºåˆ—åˆå¹¶æˆä¸€ä¸ªæœ‰åºåºåˆ—ã€‚</p><p>è¯¥æ“ä½œä¼šä¸€ç›´é‡å¤æ‰§è¡Œï¼Œç›´åˆ°æ‰€æœ‰å­åºåˆ—éƒ½å½’å¹¶ä¸ºä¸€ä¸ªæ•´ä½“ä¸ºæ­¢ã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦-O-nlogn">æ—¶é—´å¤æ‚åº¦:O(nlogn)</h3><ul><li>æŠŠæ•°ç»„æ‹†åˆ†æˆä¸å¯åˆ†å‰²çš„æœ€å°å•å…ƒçš„æ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦O(n)</li><li>ä¾æ¬¡æŠŠæ‰€æœ‰æ•°ç»„è¿›è¡Œåˆå¹¶æ’åºï¼Œæ¯ä¸€è½®çš„æ¯”è¾ƒæ¬¡æ•°ä¸ºO(n)ï¼›éœ€è¦è¿›è¡Œlognè½®</li><li>æœ€ç»ˆçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(nlogn)</li></ul><h3 id="Javaä»£ç å®ç°-v5">Javaä»£ç å®ç°</h3><p><a href="https://github.com/guozhe001/my-tools/blob/master/my-learn/my-algorithm/src/main/java/com/nicai/algorithm/sort/MergeSort.java">å½’å¹¶æ’åº</a></p><h2 id="å¿«é€Ÿæ’åº">å¿«é€Ÿæ’åº</h2><h3 id="ç®—æ³•é‡Šä¹‰-v6">ç®—æ³•é‡Šä¹‰</h3><ul><li><p>å¿«é€Ÿæ’åºç®—æ³•é¦–å…ˆä¼šåœ¨åºåˆ—ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªåŸºå‡†å€¼ï¼ˆpivotï¼‰</p></li><li><p>ç„¶åå°†é™¤äº†åŸºå‡†å€¼ä»¥å¤–çš„æ•°åˆ†ä¸ºâ€œæ¯”åŸºå‡†å€¼å°çš„æ•°â€å’Œâ€œæ¯”åŸºå‡†å€¼å¤§çš„æ•°â€è¿™ä¸¤ä¸ªç±»åˆ«ï¼Œå†å°†å…¶æ’åˆ—æˆä»¥ä¸‹å½¢å¼ã€‚</p><ul><li>[ æ¯”åŸºå‡†å€¼å°çš„æ•° ] åŸºå‡†å€¼ [ æ¯”åŸºå‡†å€¼å¤§çš„æ•° ]</li></ul></li><li><p>æ¥ç€ï¼Œå¯¹ä¸¤ä¸ªâ€œ[ ]â€ä¸­çš„æ•°æ®è¿›è¡Œæ’åºä¹‹åï¼Œæ•´ä½“çš„æ’åºä¾¿å®Œæˆäº†ã€‚å¯¹â€œ[ ]â€é‡Œé¢çš„æ•°æ®è¿›è¡Œæ’åºæ—¶åŒæ ·ä¹Ÿä¼šä½¿ç”¨å¿«é€Ÿæ’åºã€‚</p></li></ul><h3 id="æ—¶é—´å¤æ‚åº¦ï¼šO-nlogn-v2">æ—¶é—´å¤æ‚åº¦ï¼šO(nlogn)</h3><ul><li>æ¯ä¸€è½®æ¯”è¾ƒçš„æ¬¡æ•°ä¸ºnæ¬¡ï¼Œæ—¶é—´å¤æ‚åº¦O(n)</li><li>éœ€è¦è¿›è¡Œlognè½®çš„æ¯”è¾ƒ</li><li>æœ€ç»ˆçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(nlogn)</li></ul><h3 id="Javaä»£ç å®ç°-v6">Javaä»£ç å®ç°</h3><p><a href="https://github.com/guozhe001/my-tools/blob/master/my-learn/my-algorithm/src/main/java/com/nicai/algorithm/sort/FastSort.java">å¿«é€Ÿæ’åº</a></p><h3 id="æ‰©å±•-v3">æ‰©å±•</h3><p>åŸºå‡†å€¼çº¦æ¥è¿‘æ•°ç»„çš„å¹³å‡å€¼ï¼Œæ’åºçš„é€Ÿåº¦è¶Šå¿«ï¼›åŸºå‡†å€¼ä¸€èˆ¬éƒ½ä½¿ç”¨ç¬¬ä¸€ä¸ªæ•°å­—</p><h1 id="ç¬¬ä¸‰ç« ï¼šæ•°ç»„çš„æŸ¥æ‰¾">ç¬¬ä¸‰ç« ï¼šæ•°ç»„çš„æŸ¥æ‰¾</h1><h2 id="çº¿æ€§æŸ¥æ‰¾">çº¿æ€§æŸ¥æ‰¾</h2><h3 id="ç‰¹æ€§-v8">ç‰¹æ€§</h3><ul><li>éå†æ•´ä¸ªæ•°ç»„ï¼Œé€ä¸ªè¿›è¡Œæ¯”è¾ƒï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢</li></ul><h3 id="æ—¶é—´å¤æ‚åº¦ï¼šO-n">æ—¶é—´å¤æ‚åº¦ï¼šO(n)</h3><h3 id="Javaä»£ç å®ç°-v7">Javaä»£ç å®ç°</h3><p><a href="https://github.com/guozhe001/my-tools/blob/master/my-learn/my-algorithm/src/main/java/com/nicai/algorithm/search/LinearSearch.java">çº¿æ€§æŸ¥æ‰¾</a></p><h2 id="äºŒåˆ†æŸ¥æ‰¾">äºŒåˆ†æŸ¥æ‰¾</h2><h3 id="ç‰¹æ€§-v9">ç‰¹æ€§</h3><ul><li>åªèƒ½æŸ¥æ‰¾å·²ç»æ’å¥½åºçš„æ•°ç»„</li><li>æ¯æ¬¡æŸ¥æ‰¾å–ä¸­é—´ä½ç½®çš„å€¼ä¸éœ€è¦æŸ¥æ‰¾çš„æ•°å­—æ¯”è¾ƒï¼Œå¦‚æœä¸­é—´å€¼å¤§äºå¾…æŸ¥æ‰¾æ•°æ®ï¼Œåˆ™ç»§ç»­åœ¨ä¸­é—´å€¼å·¦è¾¹çš„æ•°ç»„è¿›è¡ŒæŸ¥æ‰¾ï¼›åä¹‹äº¦ç„¶</li></ul><h3 id="æ—¶é—´å¤æ‚åº¦-O-logn">æ—¶é—´å¤æ‚åº¦ O(logn)</h3><ul><li>æ¯ä¸€æ¬¡æŸ¥æ‰¾éƒ½ä¼šæŠŠå¾…æŸ¥æ‰¾çš„èŒƒå›´ç¼©å°ä¸€åŠï¼Œç›´åˆ°ç»“æŸä¸ºæ­¢</li><li>æŸ¥æ‰¾éœ€è¦lognè½®ï¼Œæ¯ä¸€è½®æ¯”è¾ƒ1æ¬¡ï¼›æ‰€ä»¥æ—¶é—´å¤æ‚åº¦ä¸ºO(logn)</li></ul><h3 id="Javaä»£ç å®ç°-v8">Javaä»£ç å®ç°</h3><p><a href="https://github.com/guozhe001/my-tools/blob/master/my-learn/my-algorithm/src/main/java/com/nicai/algorithm/search/BinarySearch.java">äºŒåˆ†æŸ¥æ‰¾</a></p><h1 id="ç¬¬å››ç« ï¼šå›¾çš„æœç´¢">ç¬¬å››ç« ï¼šå›¾çš„æœç´¢</h1><h2 id="å›¾çš„å®šä¹‰">å›¾çš„å®šä¹‰</h2><p>è®¡ç®—æœºç§‘å­¦æˆ–ç¦»æ•£æ•°å­¦ä¸­è¯´çš„â€œå›¾â€æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><p><img src="https://gitee.com/guozhe001/images/raw/master/null/image-20200822163332465.png" alt="image-20200822163332465"></p><p>ä¸Šå›¾ä¸­çš„åœ†åœˆå«ä½œâ€œé¡¶ç‚¹â€(ä¹Ÿå«â€œç»“ç‚¹â€)ï¼Œè¿æ¥é¡¶ç‚¹çš„çº¿å«ä½œâ€œè¾¹â€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ç”±é¡¶ç‚¹å’Œè¿æ¥æ¯å¯¹é¡¶ç‚¹çš„è¾¹æ‰€æ„æˆçš„å›¾å½¢å°±æ˜¯å›¾</strong>ã€‚<em>å›¾å¯ä»¥è¡¨ç¤ºå„ç§å…³ç³»</em></p><h3 id="åŠ æƒå›¾">åŠ æƒå›¾</h3><p>æˆ‘ä»¬å¯ä»¥ç»™è¾¹åŠ ä¸Šä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼å«ä½œè¾¹çš„â€œæƒé‡â€æˆ–è€…â€œæƒâ€ï¼ŒåŠ äº†æƒçš„å›¾è¢«ç§°ä¸ºâ€œåŠ æƒå›¾â€ã€‚</p><p>æ²¡æœ‰æƒçš„è¾¹åªèƒ½è¡¨ç¤ºä¸¤ä¸ª é¡¶ç‚¹çš„è¿æ¥çŠ¶æ€ï¼Œè€Œæœ‰æƒçš„è¾¹å°±å¯ä»¥è¡¨ç¤ºé¡¶ç‚¹ä¹‹é—´çš„â€œè¿æ¥ç¨‹åº¦â€ã€‚</p><p>æ‰€è°“â€œç¨‹åº¦â€åœ¨ä¸åŒçš„åœºæ™¯æ„æ€ä¹Ÿä¸ä¸€æ ·ï¼š</p><ul><li>åœ°é“çº¿è·¯å›¾ä¸¤ç«™ä¹‹é—´çš„æƒæ˜¯ä¸¤ç«™ä¹‹é—´çš„è·ç¦»</li><li>åŒæ ·æ˜¯åœ°é“çº¿è·¯å›¾ï¼Œä¸¤ç«™ä¹‹å‰çš„æƒä¹Ÿå¯ä»¥æ˜¯ä¸¤ç«™ä¹‹é—´çš„æ—¶é—´</li><li>å¦‚æœæ˜¯é«˜é“ç«™çº¿è·¯å›¾ï¼Œä¸¤ç«™ä¹‹é—´çš„æƒä¹Ÿå¯ä»¥è¡¨ç¤ºä¸¤ç«™ä¹‹é—´çš„ä¹˜è½¦è´¹</li></ul><h3 id="æœ‰å‘å›¾">æœ‰å‘å›¾</h3><p>å½“æˆ‘ä»¬æƒ³åœ¨è·¯çº¿å›¾ä¸­è¡¨ç¤ºè¯¥è·¯çº¿åªèƒ½å•å‘è¡Œé©¶æ—¶ï¼Œå°±å¯ä»¥ç»™è¾¹åŠ ä¸Šç®­å¤´ï¼Œè€Œè¿™æ ·çš„å›¾å°±å« ä½œâ€œæœ‰å‘å›¾â€ã€‚</p><p>å’Œæ— å‘å›¾ä¸€æ ·ï¼Œæœ‰å‘å›¾ä¹Ÿå¯ä»¥åœ¨è¾¹ä¸Šæ·»åŠ æƒé‡ï¼Œè€Œä¸”æ ¹æ®æ–¹å‘çš„ä¸åŒï¼Œæƒé‡ä¹Ÿä¸ä¸€æ ·ã€‚</p><p>å¦‚ä¸‹å›¾ä¸­ï¼Œå¦‚æœæƒé‡è¡¨ç¤ºèŠ±è´¹æ—¶é—´ï¼Œåˆ™Bç‚¹åˆ°Cç‚¹æ˜¯ä¸‹å¡è·¯ï¼Œåè¿‡æ¥Cåˆ°Bå°±æ˜¯ä¸Šå¡è·¯ã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master/null/image-20200822164224711.png" alt="image-20200822164224711"></p><h3 id="å›¾èƒ½ç»™æˆ‘ä»¬å¸¦æ¥å“ªäº›ä¾¿åˆ©">å›¾èƒ½ç»™æˆ‘ä»¬å¸¦æ¥å“ªäº›ä¾¿åˆ©</h3><p>å‡è®¾å›¾ä¸­æœ‰ä¸¤ä¸ªé¡¶ç‚¹ <em>s</em> å’Œ <em>t</em>ï¼Œè€Œæˆ‘ä»¬è®¾è®¡å‡ºäº†ä¸€ç§ç®—æ³•ï¼Œ å¯ä»¥æ‰¾åˆ°â€œä» <em>s</em> åˆ° <em>t</em> çš„æƒé‡ä¹‹å’Œæœ€å°â€çš„é‚£æ¡è·¯å¾„ï¼Œå¦‚ï¼š</p><ul><li>å¯»æ‰¾è®¡ç®—æœºç½‘ç»œä¸­é€šä¿¡æ—¶é—´æœ€çŸ­çš„è·¯å¾„</li><li>å¯»æ‰¾è·¯çº¿å›¾ä¸­è€—æ—¶æœ€çŸ­çš„è·¯å¾„</li><li>å¯»æ‰¾è·¯çº¿å›¾ä¸­æœ€çœä¹˜è½¦è´¹çš„è·¯å¾„</li></ul><h3 id="å›¾åœ¨ä»£ç ä¸­å¦‚ä½•å®ç°">å›¾åœ¨ä»£ç ä¸­å¦‚ä½•å®ç°</h3><ul><li>å›¾æ˜¯ç”¨æ¥è¡¨ç¤ºèŠ‚ç‚¹ä¸èŠ‚ç‚¹çš„å…³ç³»çš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨Mapæ¥å®ç°å›¾</li><li>æœ‰å‘å›¾ï¼Œå¦‚ä¸Šé¢å›¾ä¸¤ä¸ªèŠ‚ç‚¹Aå’ŒBã€mapä¸­keyä¸ºAçš„å€¼æœ‰Bï¼Œè€Œkeyä¸ºBçš„å€¼æ²¡æœ‰Aï¼Œå°±å¯ä»¥è¡¨ç¤ºæ–¹å‘</li><li>åŠ æƒå›¾ï¼ŒåŒæ ·é€‚ç”¨Mapå®ç°ï¼ŒåŒºåˆ«æ˜¯åœ¨valueä¸­æ—¢åŒ…å«ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒåˆåŒ…å«æƒé‡ä¿¡æ¯<a href="https://github.com/guozhe001/my-tools/blob/master/my-learn/my-algorithm/src/main/java/com/nicai/algorithm/map/AssignWeightsNode.java">åŠ æƒå›¾Javaå®ç°</a></li></ul><h2 id="å›¾çš„æœç´¢">å›¾çš„æœç´¢</h2><h3 id="å¹¿åº¦ä¼˜å…ˆæœç´¢">å¹¿åº¦ä¼˜å…ˆæœç´¢</h3><p>å‡è®¾æˆ‘ä»¬ä¸€å¼€å§‹ä½äºæŸä¸ªé¡¶ç‚¹(å³èµ·ç‚¹)ï¼Œæ­¤æ—¶å¹¶ä¸çŸ¥é“å›¾çš„æ•´ä½“ç»“æ„ï¼Œè€Œæˆ‘ä»¬çš„ç›®çš„æ˜¯ä»èµ·ç‚¹å¼€å§‹é¡ºç€è¾¹æœç´¢ï¼Œç›´åˆ°åˆ°è¾¾æŒ‡å®šé¡¶ç‚¹(å³ç»ˆç‚¹)ã€‚</p><p>åœ¨æ­¤è¿‡ç¨‹ä¸­æ¯èµ°åˆ°ä¸€ä¸ªé¡¶ç‚¹ï¼Œå°±ä¼šåˆ¤æ–­ä¸€æ¬¡å®ƒæ˜¯å¦ä¸ºç»ˆç‚¹ã€‚å¹¿åº¦ä¼˜å…ˆæœç´¢ä¼šä¼˜å…ˆä»ç¦»èµ·ç‚¹è¿‘çš„é¡¶ç‚¹å¼€å§‹æœç´¢ã€‚</p><h4 id="Javaä»£ç å®ç°-v9">Javaä»£ç å®ç°</h4><p><a href="https://github.com/guozhe001/my-tools/blob/master/my-learn/my-algorithm/src/main/java/com/nicai/algorithm/map/BreadthFirstSearch.java">å¹¿åº¦ä¼˜å…ˆæœç´¢</a></p><h3 id="æ·±åº¦ä¼˜å…ˆæœç´¢">æ·±åº¦ä¼˜å…ˆæœç´¢</h3><p>æ·±åº¦ä¼˜å…ˆæœç´¢ä¼šæ²¿ç€ä¸€æ¡è·¯å¾„ä¸æ–­å¾€ä¸‹æœç´¢ç›´åˆ°ä¸èƒ½å†ç»§ç»­ä¸ºæ­¢ï¼Œç„¶åå†æŠ˜è¿”ï¼Œå¼€å§‹æœç´¢ä¸‹ä¸€æ¡å€™è¡¥è·¯å¾„ã€‚</p><h4 id="Javaä»£ç å®ç°-v10">Javaä»£ç å®ç°</h4><p><a href="https://github.com/guozhe001/my-tools/blob/master/my-learn/my-algorithm/src/main/java/com/nicai/algorithm/map/DepthFirstSearch.java">æ·±åº¦ä¼˜å…ˆæœç´¢</a></p><h3 id="å¹¿åº¦ä¼˜å…ˆæœç´¢å’Œæ·±åº¦ä¼˜å…ˆæœç´¢å¯¹æ¯”">å¹¿åº¦ä¼˜å…ˆæœç´¢å’Œæ·±åº¦ä¼˜å…ˆæœç´¢å¯¹æ¯”</h3><p>å¹¿åº¦ä¼˜å…ˆæœç´¢é€‰æ‹©çš„æ˜¯æœ€æ—©æˆä¸ºå€™è¡¥çš„é¡¶ç‚¹ï¼Œå› ä¸ºé¡¶ç‚¹ç¦»èµ·ç‚¹è¶Šè¿‘å°±è¶Šæ—©æˆä¸ºå€™è¡¥ï¼Œæ‰€ä»¥ä¼šä»ç¦»èµ·ç‚¹è¿‘çš„åœ°æ–¹å¼€å§‹æŒ‰é¡ºåºæœç´¢;</p><p>è€Œæ·±åº¦ä¼˜å…ˆæœç´¢é€‰æ‹©çš„åˆ™æ˜¯æœ€æ–°æˆä¸ºå€™è¡¥çš„é¡¶ç‚¹ï¼Œæ‰€ä»¥ä¼šä¸€è·¯å¾€ä¸‹ï¼Œæ²¿ç€æ–°å‘ç°çš„è·¯å¾„ä¸æ–­æ·±å…¥æœç´¢ã€‚</p><h3 id="è´å°”æ›¼-ç¦ç‰¹ç®—æ³•">è´å°”æ›¼ - ç¦ç‰¹ç®—æ³•</h3><h4 id="è§£å†³çš„é—®é¢˜">è§£å†³çš„é—®é¢˜</h4><ul><li><p>è´å°”æ›¼ - ç¦ç‰¹(Bellman-Ford)ç®—æ³•æ˜¯ä¸€ç§åœ¨å›¾ä¸­æ±‚è§£æœ€çŸ­è·¯å¾„é—®é¢˜çš„ç®—æ³•ã€‚</p></li><li><p>æœ€çŸ­è·¯å¾„é—®é¢˜å°±æ˜¯åœ¨åŠ æƒå›¾æŒ‡å®šäº†èµ·ç‚¹å’Œç»ˆç‚¹çš„å‰æä¸‹ï¼Œå¯»æ‰¾ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„è·¯å¾„ä¸­æƒé‡æ€»å’Œæœ€å°çš„é‚£æ¡è·¯å¾„ã€‚</p></li></ul><h4 id="æ±‚è§£çš„æ­¥éª¤">æ±‚è§£çš„æ­¥éª¤</h4><ul><li>é¦–å…ˆè®¾ç½®å„ä¸ªé¡¶ç‚¹çš„åˆå§‹æƒé‡ :èµ·ç‚¹ä¸º 0ï¼Œå…¶ä»–é¡¶ç‚¹ä¸ºæ— ç©·å¤§(âˆ)ï¼›è¿™ä¸ªæƒé‡çš„æ„æ€æ˜¯ä»èµ·ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„æš‚å®šå€¼ã€‚</li><li>ä»èµ·ç‚¹ï¼ˆAï¼‰å¼€å§‹éå†ï¼Œæ‰¾åˆ°å­èŠ‚ç‚¹ï¼ˆBï¼‰ï¼Œæ›´æ–°å­èŠ‚ç‚¹çš„æƒé‡ï¼šmin(Açš„æƒé‡+Aåˆ°Bè¾¹çš„æƒé‡,BèŠ‚ç‚¹æƒé‡)</li><li>å¾ªç¯ä¸Šé¢çš„æ­¥éª¤ä¸€ç›´æ›´æ–°æ‰€æœ‰èŠ‚ç‚¹</li></ul><h4 id="æ—¶é—´å¤æ‚åº¦O-nm">æ—¶é—´å¤æ‚åº¦<em>O</em>(<em>nm</em>)</h4><ul><li>å°†å›¾çš„é¡¶ç‚¹æ•°è®¾ä¸º <em>n</em>ã€è¾¹æ•°è®¾ä¸º <em>m</em>ã€‚</li><li>è¯¥ç®—æ³•ç»è¿‡ <em>n</em> è½®æ›´æ–°æ“ä½œåå°±ä¼šåœæ­¢ï¼Œè€Œåœ¨æ¯è½®æ›´æ–°æ“ä½œä¸­éƒ½éœ€è¦å¯¹å„ä¸ªè¾¹è¿›è¡Œ 1 æ¬¡ç¡®è®¤</li><li>å› æ­¤ 1 è½®æ›´æ–°æ‰€èŠ±è´¹çš„æ—¶é—´å°±æ˜¯ <em>O</em>(<em>m</em>)ï¼Œæ•´ä½“çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ <em>O</em>(<em>nm</em>)</li></ul><h4 id="Javaä»£ç å®ç°-v11">Javaä»£ç å®ç°</h4><p><a href="https://github.com/guozhe001/my-tools/blob/7629245129fcdb4422e45fe37a8c332b1244140f/my-learn/my-algorithm/src/main/java/com/nicai/algorithm/map/BellmanFord.java">è´å°”æ›¼-ç¦ç‰¹ç®—æ³•</a></p><h3 id="ç‹„å…‹æ–¯ç‰¹æ‹‰ç®—æ³•">ç‹„å…‹æ–¯ç‰¹æ‹‰ç®—æ³•</h3><h4 id="è§£å†³çš„é—®é¢˜-v2">è§£å†³çš„é—®é¢˜</h4><p>ç‹„å…‹æ–¯ç‰¹æ‹‰(Dijkstra)ç®—æ³•ä¹Ÿæ˜¯æ±‚è§£æœ€çŸ­è·¯å¾„é—®é¢˜ çš„ç®—æ³•ï¼Œä½¿ç”¨å®ƒå¯ä»¥æ±‚å¾—ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„è·¯å¾„ä¸­æƒé‡æ€»å’Œæœ€å°çš„é‚£æ¡è·¯å¾„ã€‚</p><h4 id="æ±‚è§£çš„æ­¥éª¤-v2">æ±‚è§£çš„æ­¥éª¤</h4><ul><li>é¦–å…ˆè®¾ç½®å„ä¸ªé¡¶ç‚¹çš„åˆå§‹æƒé‡ :èµ·ç‚¹ä¸º 0ï¼Œå…¶ä»–é¡¶ç‚¹ä¸ºæ— ç©·å¤§(âˆ)ï¼›è¿™ä¸ªæƒé‡çš„æ„æ€æ˜¯ä»èµ·ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„æš‚å®šå€¼ã€‚</li><li>ä»èµ·ç‚¹å‡ºå‘ï¼Œå¯»æ‰¾å¯ä»¥ä»ç›®å‰æ‰€åœ¨çš„é¡¶ç‚¹ç›´è¾¾ä¸”å°šæœªè¢«æœç´¢è¿‡çš„é¡¶ç‚¹ã€‚</li><li>è®¡ç®—å„ä¸ªå€™è¡¥é¡¶ç‚¹çš„æƒé‡ã€‚è®¡ç®—æ–¹æ³•æ˜¯â€œç›®å‰æ‰€åœ¨é¡¶ç‚¹çš„æƒé‡+ç›®å‰æ‰€åœ¨é¡¶ç‚¹åˆ°å€™è¡¥é¡¶ç‚¹çš„æƒé‡â€ã€‚</li><li>å¦‚æœè®¡ç®—ç»“æœå°äºå€™è¡¥é¡¶ç‚¹çš„å€¼ï¼Œå°±æ›´æ–°è¿™ä¸ªå€¼ã€‚</li><li><strong>ä»å€™è¡¥é¡¶ç‚¹ä¸­é€‰å‡ºæƒé‡æœ€å°çš„é¡¶ç‚¹ï¼Œä½œä¸ºä¸‹ä¸€ä¸ªè¢«æœç´¢çš„ç‚¹</strong>ï¼Œè¿™ä¸€ç‚¹ä¸è´å°”æ›¼-ç¦ç‰¹ç®—æ³•ä¸ä¸€æ ·</li></ul><h4 id="æ—¶é—´å¤æ‚åº¦-v8">æ—¶é—´å¤æ‚åº¦</h4><p>å°†å›¾çš„é¡¶ç‚¹æ•°è®¾ä¸º <em>n</em>ã€è¾¹æ•°è®¾ä¸º <em>m</em>ï¼Œé‚£ä¹ˆå¦‚æœäº‹å…ˆä¸è¿›è¡Œä»»ä½•å¤„ç†ï¼Œè¯¥ç®—æ³•çš„æ—¶ é—´å¤æ‚åº¦å°±æ˜¯ <em>O</em>(<em>n</em>2)ã€‚</p><p>ä¸è¿‡ï¼Œå¦‚æœå¯¹æ•°æ®ç»“æ„è¿›è¡Œä¼˜åŒ–ï¼Œé‚£ä¹ˆæ—¶é—´å¤æ‚åº¦å°±ä¼šå˜ä¸º <em>O</em>(<em>m</em> + <em>n</em>log<em>n</em>)ã€‚</p><h4 id="Javaä»£ç å®ç°-v12">Javaä»£ç å®ç°</h4><p><a href="https://github.com/guozhe001/my-tools/blob/master/my-learn/my-algorithm/src/main/java/com/nicai/algorithm/map/Dijkstra.java">ç‹„å…‹æ–¯ç‰¹æ‹‰(Dijkstra)ç®—æ³•</a></p><h3 id="è´å°”æ›¼ç¦ç‰¹ç®—æ³•å’Œè¿ªå…‹æ–¯ç‰¹æ‹‰ç®—æ³•å¯¹æ¯”">è´å°”æ›¼ç¦ç‰¹ç®—æ³•å’Œè¿ªå…‹æ–¯ç‰¹æ‹‰ç®—æ³•å¯¹æ¯”</h3><h4 id="è¯´æ˜">è¯´æ˜</h4><p>å¦‚æœåœ¨ä¸€ä¸ªé—­ç¯ä¸­è¾¹çš„æƒé‡æ€»å’Œæ˜¯è´Ÿæ•°ï¼Œé‚£ä¹ˆåªè¦ä¸æ–­éå†è¿™ä¸ªé—­ç¯ï¼Œè·¯å¾„çš„æƒé‡å°±èƒ½ä¸æ–­å‡å°ï¼Œä¹Ÿå°±æ˜¯è¯´æ ¹æœ¬ä¸å­˜åœ¨æœ€çŸ­è·¯å¾„ã€‚</p><p>è´å°”æ›¼ - ç¦ç‰¹ç®—æ³•å¯ä»¥ç›´æ¥è®¤å®šä¸å­˜åœ¨æœ€çŸ­è·¯å¾„ï¼Œä½†åœ¨ç‹„å…‹æ–¯ç‰¹æ‹‰ç®—æ³•ä¸­ï¼Œå³ä¾¿ä¸å­˜åœ¨æœ€çŸ­è·¯å¾„ï¼Œå®ƒä¹Ÿä¼š ç®—å‡ºä¸€ä¸ªé”™è¯¯çš„æœ€çŸ­è·¯å¾„å‡ºæ¥ã€‚å› æ­¤ï¼Œæœ‰è´Ÿæ•°æƒé‡æ—¶ä¸èƒ½ä½¿ç”¨ç‹„å…‹æ–¯ç‰¹æ‹‰ç®—æ³•ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯ä¸å­˜åœ¨è´Ÿæ•°æƒé‡æ—¶ï¼Œæ›´é€‚åˆä½¿ç”¨æ•ˆç‡è¾ƒé«˜çš„ç‹„å…‹æ–¯ç‰¹æ‹‰ç®—æ³•ï¼Œè€Œå­˜ åœ¨è´Ÿæ•°æƒé‡æ—¶ï¼Œå³ä¾¿è¾ƒä¸ºè€—æ—¶ï¼Œä¹Ÿåº”è¯¥ä½¿ç”¨å¯ä»¥å¾—åˆ°æ­£ç¡®ç­”æ¡ˆçš„è´å°”æ›¼ - ç¦ç‰¹ç®—æ³•ã€‚</p><h3 id="A-ï¼ˆA-Starï¼‰ç®—æ³•">A*ï¼ˆA-Starï¼‰ç®—æ³•</h3><h4 id="è§£å†³çš„é—®é¢˜-v3">è§£å†³çš„é—®é¢˜</h4><p>A-Startç®—æ³•ä¹Ÿæ˜¯è§£å†³åœ¨å›¾ä¸­æ±‚è§£æœ€çŸ­è·¯å¾„é—®é¢˜çš„ç®—æ³•ï¼Œç”±ç‹„å…‹æ–¯ç‰¹æ‹‰ç®—æ³•å‘å±•è€Œæ¥ã€‚</p><p>ç‹„å…‹æ–¯ç‰¹æ‹‰ç®—æ³•ä¼šä»ç¦»èµ·ç‚¹è¿‘çš„é¡¶ç‚¹å¼€å§‹ï¼ŒæŒ‰é¡ºåºæ±‚å‡ºèµ·ç‚¹åˆ°å„ä¸ªé¡¶ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€äº›ç¦»ç»ˆç‚¹è¾ƒè¿œçš„é¡¶ç‚¹çš„æœ€çŸ­è·¯å¾„ä¹Ÿä¼šè¢«è®¡ç®—å‡ºæ¥ï¼Œä½†è¿™éƒ¨åˆ†å…¶å®æ˜¯æ— ç”¨çš„ã€‚</p><p>ä¸ä¹‹ä¸åŒï¼ŒA* å°± ä¼šé¢„å…ˆä¼°ç®—ä¸€ä¸ªå€¼ï¼Œå¹¶åˆ©ç”¨è¿™ä¸ªå€¼æ¥çœå»ä¸€äº›æ— ç”¨çš„è®¡ç®—</p><h1 id="ç¬¬äº”ç« -å®‰å…¨ç®—æ³•">ç¬¬äº”ç«  å®‰å…¨ç®—æ³•</h1><h2 id="å®‰å…¨å’Œç®—æ³•">å®‰å…¨å’Œç®—æ³•</h2><h3 id="ä¼ è¾“æ•°æ®æ—¶çš„å››ä¸ªé—®é¢˜">ä¼ è¾“æ•°æ®æ—¶çš„å››ä¸ªé—®é¢˜</h3><h4 id="çªƒå¬">çªƒå¬</h4><p>A å‘ B å‘é€çš„æ¶ˆæ¯å¯èƒ½ä¼šåœ¨ä¼ è¾“é€”ä¸­è¢« X å·çœ‹(å¦‚ä¸‹å›¾)ã€‚è¿™å°±æ˜¯â€œçªƒå¬â€ã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master//image-20200918183116803.png" alt="image-20200918183116803"></p><h4 id="å‡å†’">å‡å†’</h4><p>A ä»¥ä¸ºå‘ B å‘é€äº†æ¶ˆæ¯ï¼Œç„¶è€Œ B æœ‰å¯èƒ½æ˜¯ X å†’å……çš„(å¦‚ä¸‹å›¾);åè¿‡æ¥ï¼ŒB ä»¥ä¸ºä» A é‚£é‡Œæ”¶åˆ°äº†æ¶ˆæ¯ï¼Œç„¶è€Œ A ä¹Ÿæœ‰å¯èƒ½æ˜¯ X å†’å……çš„ã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master//image-20200918183227754.png" alt="image-20200918183227754"></p><h4 id="ç¯¡æ”¹">ç¯¡æ”¹</h4><p>å³ä¾¿ B ç¡®å®æ”¶åˆ°äº† A å‘é€çš„æ¶ˆæ¯ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½åƒå³å›¾ è¿™æ ·ï¼Œè¯¥æ¶ˆæ¯çš„å†…å®¹åœ¨é€”ä¸­å°±è¢« X æ›´æ”¹äº†ã€‚</p><p>é™¤äº†è¢«ç¬¬ä¸‰è€…ç¯¡æ”¹å¤–ï¼Œé€š ä¿¡æ•…éšœå¯¼è‡´çš„æ•°æ®æŸåä¹Ÿå¯èƒ½ä¼šä½¿æ¶ˆæ¯å†…å®¹å‘ç”Ÿå˜åŒ–ã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master//image-20200918183344985.png" alt="image-20200918183344985"></p><h4 id="äº‹åå¦è®¤">äº‹åå¦è®¤</h4><p>B ä» A é‚£é‡Œæ”¶åˆ°äº†æ¶ˆæ¯ï¼Œä½†ä½œä¸ºæ¶ˆæ¯å‘é€è€…çš„ A å¯ èƒ½å¯¹ B æŠ±æœ‰æ¶æ„ï¼Œå¹¶åœ¨äº‹åå£°ç§°â€œè¿™ä¸æ˜¯æˆ‘å‘é€çš„æ¶ˆæ¯â€ã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master//image-20200918183430948.png" alt="image-20200918183430948"></p><h3 id="è§£å†³è¿™äº›é—®é¢˜çš„å®‰å…¨æŠ€æœ¯">è§£å†³è¿™äº›é—®é¢˜çš„å®‰å…¨æŠ€æœ¯</h3><ul><li><p>ä¸ºäº†åº”å¯¹â€œçªƒå¬â€ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨â€œåŠ å¯†â€ æŠ€æœ¯ã€‚</p></li><li><p>ä¸ºäº†åº”å¯¹â€œå‡å†’â€ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨â€œæ¶ˆæ¯è®¤è¯ç â€(ä¸‹å›¾å·¦)æˆ–â€œæ•°å­—ç­¾åâ€(ä¸‹å›¾å³)æŠ€æœ¯ã€‚</p></li><li><p>ä¸ºäº†åº”å¯¹â€œç¯¡æ”¹â€ï¼Œæˆ‘ä»¬åŒæ ·ä¼šä½¿ç”¨ â€œæ¶ˆæ¯è®¤è¯ç â€æˆ–â€œæ•°å­—ç­¾åâ€æŠ€æœ¯ã€‚</p></li><li><p>å…¶ä¸­â€œæ•°å­—ç­¾åâ€æŠ€æœ¯è¿˜å¯ä»¥ç”¨äºé¢„é˜²â€œäº‹åå¦è®¤â€ã€‚</p></li></ul><h2 id="å“ˆå¸Œå‡½æ•°">å“ˆå¸Œå‡½æ•°</h2><ul><li><p>å“ˆå¸Œå‡½æ•°å¯ä»¥æŠŠç»™å®šçš„æ•°æ®è½¬æ¢æˆå›ºå®šé•¿åº¦çš„æ— è§„å¾‹æ•°å€¼ã€‚</p></li><li><p>è½¬æ¢åçš„æ— è§„å¾‹æ•°å€¼å¯ä»¥ä½œä¸ºæ•°æ®æ‘˜è¦åº”ç”¨äºå„ç§å„æ ·çš„åœºæ™¯ã€‚</p></li></ul><p>å¸Œå‡½æ•°çš„ç‰¹å¾ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªç‰¹å¾æ˜¯è¾“å‡ºçš„å“ˆå¸Œå€¼æ•°æ®é•¿åº¦ä¸å˜ã€‚ï¼ˆä¸è®ºè¾“å…¥çš„å‚æ•°é•¿çŸ­ï¼Œå¾—åˆ°çš„å“ˆå¸Œå€¼æ˜¯å®šé•¿çš„ï¼‰</li><li>ç¬¬äºŒä¸ªç‰¹å¾æ˜¯å¦‚æœè¾“å…¥çš„æ•°æ®ç›¸åŒï¼Œé‚£ä¹ˆè¾“å‡º çš„å“ˆå¸Œå€¼ä¹Ÿå¿…å®šç›¸åŒã€‚</li><li>ç¬¬ä¸‰ä¸ªç‰¹å¾æ˜¯å³ä½¿è¾“å…¥çš„æ•°æ®ç›¸ä¼¼ï¼Œä½†å“ªæ€•å®ƒä»¬åªæœ‰ä¸€æ¯”ç‰¹çš„å·®åˆ«ï¼Œé‚£ä¹ˆè¾“å‡ºçš„å“ˆå¸Œå€¼ä¹Ÿä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ã€‚</li><li>ç¬¬å››ä¸ªç‰¹å¾æ˜¯å³ä½¿è¾“å…¥çš„ä¸¤ä¸ªæ•°æ®å®Œå…¨ä¸åŒï¼Œè¾“ å‡ºçš„å“ˆå¸Œå€¼ä¹Ÿæœ‰å¯èƒ½æ˜¯ç›¸åŒçš„ï¼›è¿™ç§æƒ…å†µå«ä½œâ€œå“ˆå¸Œå†²çªâ€ã€‚</li><li>ç¬¬äº”ä¸ªç‰¹å¾æ˜¯ä¸å¯èƒ½ä»å“ˆå¸Œå€¼åå‘æ¨ç®—å‡ºåŸæœ¬çš„æ•°æ®ã€‚ï¼ˆè¾“å…¥å’Œè¾“å‡ºä¸å¯é€†ï¼‰</li></ul><p>å“ˆå¸Œå‡½æ•°çš„ç®—æ³•ä¸­å…·æœ‰ä»£è¡¨æ€§çš„æ˜¯ MD5 1ã€SHA-1 2å’Œ SHA-2 ç­‰ã€‚å…¶ä¸­ SHA-2 æ˜¯ç° åœ¨åº”ç”¨è¾ƒä¸ºå¹¿æ³›çš„ä¸€ä¸ªï¼Œè€Œ MD5 å’Œ SHA-1 å­˜åœ¨å®‰å…¨éšæ‚£ï¼Œä¸æ¨èä½¿ç”¨ã€‚</p><h3 id="åº”ç”¨ç¤ºä¾‹">åº”ç”¨ç¤ºä¾‹</h3><p>å°†ç”¨æˆ·è¾“å…¥çš„å¯†ç ä¿å­˜åˆ°æœåŠ¡å™¨æ—¶ä¹Ÿéœ€è¦ç”¨åˆ°å“ˆå¸Œå‡½æ•°ã€‚</p><p>å¦‚æœæŠŠå¯†ç ç›´æ¥ä¿å­˜åˆ°æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šè¢«ç¬¬ä¸‰è€…çªƒå¬ï¼Œå› æ­¤éœ€è¦ç®—å‡ºå¯†ç çš„å“ˆå¸Œå€¼ï¼Œå¹¶åªå­˜å‚¨å“ˆå¸Œå€¼ã€‚</p><p>å½“ç”¨æˆ·è¾“å…¥å¯†ç æ—¶ï¼Œå…ˆç®—å‡ºè¯¥è¾“å…¥å¯†ç çš„å“ˆå¸Œå€¼ï¼Œå†æŠŠå®ƒå’ŒæœåŠ¡ å™¨ä¸­çš„å“ˆå¸Œå€¼è¿›è¡Œæ¯”å¯¹ã€‚</p><h2 id="å…±äº«å¯†é’¥åŠ å¯†ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰">å…±äº«å¯†é’¥åŠ å¯†ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰</h2><p>å…±äº«å¯†é’¥åŠ å¯†æ˜¯åŠ å¯†å’Œè§£å¯†éƒ½<strong>ä½¿ç”¨ç›¸åŒå¯†é’¥</strong>çš„ä¸€ç§åŠ å¯†æ–¹å¼ã€‚</p><p>å®ç°å…±äº«å¯†é’¥åŠ å¯†çš„ç®—æ³•æœ‰å‡¯æ’’å¯†ç ã€AES 1ã€DES 2ã€åŠ¨æ€å£ä»¤ç­‰ï¼Œå…¶ä¸­ AES çš„åº”ç”¨æœ€ ä¸ºå¹¿æ³›ã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master//image-20200918185110697.png" alt="å¯¹ç§°åŠ å¯†"></p><h3 id="å­˜åœ¨å¯†é’¥åˆ†é…é—®é¢˜">å­˜åœ¨å¯†é’¥åˆ†é…é—®é¢˜</h3><p>å¦‚ä¸Šå›¾ï¼Œå¦‚æœåœ¨Aç»™Bå‘é€å¯†é’¥æ—¶ï¼Œè¢«Xç›‘å¬äº†ï¼Œåˆ™Xå°±èƒ½ç”¨ç›¸åŒçš„å¯†é’¥è§£å¯†æˆªè·çš„å¯†æ–‡ã€‚</p><h2 id="å…¬å¼€å¯†é’¥åŠ å¯†ï¼ˆéå¯¹ç§°åŠ å¯†ï¼‰">å…¬å¼€å¯†é’¥åŠ å¯†ï¼ˆéå¯¹ç§°åŠ å¯†ï¼‰</h2><ul><li><p>å…¬å¼€å¯†é’¥åŠ å¯†æ˜¯åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ä¸åŒå¯†é’¥çš„ä¸€ç§åŠ å¯†æ–¹æ³•ã€‚</p></li><li><p>ç”±äºä½¿ç”¨çš„å¯†é’¥ä¸åŒï¼Œæ‰€ä»¥è¿™ç§ç®—æ³•ä¹Ÿè¢«ç§°ä¸ºâ€œéå¯¹ç§°åŠ å¯†â€ã€‚</p></li><li><p>åŠ å¯†ç”¨çš„å¯†é’¥å«ä½œâ€œå…¬å¼€å¯†é’¥â€ï¼Œè§£å¯†ç”¨çš„å«ä½œâ€œç§æœ‰å¯†é’¥â€ã€‚</p></li></ul><p>å®ç°å…¬å¼€å¯†é’¥åŠ å¯†çš„ç®—æ³•æœ‰ RAS ç®—æ³•ã€æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•ç­‰ï¼Œå…¶ä¸­ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„æ˜¯ RSA ç®—æ³•ã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master//image-20200918185651314.png" alt="image-20200918185651314"></p><h3 id="ä¸å­˜åœ¨å¯†é’¥åˆ†é…é—®é¢˜">ä¸å­˜åœ¨å¯†é’¥åˆ†é…é—®é¢˜</h3><p>å…¬å¼€å¯†é’¥å’Œå¯†æ–‡éƒ½æ˜¯é€šè¿‡äº’è”ç½‘ä¼ è¾“çš„ï¼Œå› æ­¤å¯èƒ½ä¼šè¢« X çªƒå¬ã€‚</p><p>ä½†æ˜¯ï¼Œä½¿ç”¨å…¬å¼€å¯†é’¥æ— æ³•è§£å¯†å¯†æ–‡ï¼Œå› æ­¤ X ä¹Ÿæ— æ³•å¾—åˆ°åŸæœ¬çš„æ•°æ®ã€‚</p><h3 id="å¯†é’¥æ•°é‡ä¸ä¼šè¿‡å¤š">å¯†é’¥æ•°é‡ä¸ä¼šè¿‡å¤š</h3><p>åªéœ€è¦ç”Ÿæˆä¸€å¯¹å…¬ç§é’¥ï¼Œå°±å¯ä»¥æŠŠå…¬é’¥å…±äº«ç»™nä¸ªäººä½¿ç”¨ã€‚</p><p>å¯¹ç§°åŠ å¯†å°±çš„å¯†é’¥æ•°é‡ä¼šéšç€äººçš„å¢å¤šè€Œå¢å¤šã€‚</p><h3 id="å…¬å¼€å¯†é’¥åŠ å¯†å­˜åœ¨å…¬å¼€å¯†é’¥å¯é æ€§çš„é—®é¢˜">å…¬å¼€å¯†é’¥åŠ å¯†å­˜åœ¨å…¬å¼€å¯†é’¥å¯é æ€§çš„é—®é¢˜</h3><p>å¦‚ä¸‹å›¾ï¼ŒåŠ å…¥Båœ¨æŠŠå…¬é’¥Pbå…±äº«ç»™Açš„æ—¶å€™ï¼Œè¢«Xæˆªè·äº†ï¼›XæŠŠè‡ªå·±çš„å…¬é’¥Pxå‘é€ç»™äº†Aã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master//image-20200919111210334-20200919113122148.png" alt="image-20200919111210334"></p><p>è¿™æ—¶Aåœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä½¿ç”¨Pxå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†å‘é€ç»™Bæ—¶ï¼ŒXæˆªè·å¯†æ–‡å°±å¯ä»¥é€šè¿‡ç§é’¥Sxè¿›è¡Œè§£å¯†ã€‚</p><p>ç„¶åXå¯ä»¥æˆªè·çš„é€šè¿‡å…¬é’¥PbåŠ å¯†æ¶æ„æ•°æ®å‘é€ç»™Bï¼ŒBèƒ½å¤Ÿä½¿ç”¨è‡ªå·±çš„å¯†é’¥Sbè¿›è¡Œè§£å¯†ï¼Œä»¥ä¸ºæ•°æ®æ˜¯Aå‘é€çš„ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://gitee.com/guozhe001/images/raw/master//image-20200919113151447.png" alt="image-20200919113151447"></p><h3 id="éå¯¹ç§°åŠ å¯†ç®—æ³•çš„æ¡ä»¶">éå¯¹ç§°åŠ å¯†ç®—æ³•çš„æ¡ä»¶</h3><ul><li>å¯ä»¥ä½¿ç”¨æŸä¸ªæ•°å€¼å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†(è®¡ç®—)ã€‚</li><li>ä½¿ç”¨å¦ä¸€ä¸ªæ•°å€¼å¯¹åŠ å¯†æ•°æ®è¿›è¡Œè®¡ç®—å°±å¯ä»¥è®©æ•°æ®æ¢å¤åŸæ ·ã€‚</li><li>æ— æ³•ä»ä¸€ç§å¯†é’¥æ¨ç®—å‡ºå¦ä¸€ç§å¯†é’¥ã€‚</li></ul><h2 id="æ··åˆåŠ å¯†">æ··åˆåŠ å¯†</h2><p>å…±äº«å¯†é’¥åŠ å¯†å­˜åœ¨æ— æ³•å®‰å…¨ä¼ è¾“å¯†é’¥çš„å¯†é’¥åˆ†é…é—®é¢˜ï¼Œå…¬å¼€å¯†é’¥åŠ å¯†åˆå­˜åœ¨åŠ å¯†è§£å¯†é€Ÿåº¦è¾ƒæ…¢çš„é—®é¢˜ã€‚</p><p>åœ¨æ··åˆåŠ å¯†ä¸­ï¼Œè¦ç”¨å¤„ç†é€Ÿåº¦è¾ƒå¿«çš„å…±äº«å¯†é’¥åŠ å¯†å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚ä¸è¿‡ï¼ŒåŠ å¯†æ—¶ä½¿ç”¨çš„å¯†é’¥ï¼Œåˆ™éœ€è¦ç”¨æ²¡æœ‰å¯†é’¥åˆ†é…é—®é¢˜çš„å…¬å¼€å¯†é’¥åŠ å¯†è¿›è¡Œå¤„ç†ã€‚æ··åˆåŠ å¯†å¯ä»¥æ‹†åˆ†æˆä¸‹é¢ä¸¤æ­¥æ“ä½œï¼š</p><p>1ã€Aåœ¨ç»™Bå‘é€æ•°æ®ä¹‹å‰ï¼Œå…ˆä½¿ç”¨éå¯¹ç§°çš„å…¬é’¥å¯¹â€å¯¹ç§°åŠ å¯†çš„å¯†é’¥â€œè¿›è¡ŒåŠ å¯†ï¼Œç„¶åæŠŠåŠ å¯†åçš„å¯†æ–‡å‘é€ç»™Aï¼ŒAè§£å¯†åå°±å¾—åˆ°äº†â€å¯¹ç§°åŠ å¯†çš„å¯†é’¥â€œã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://gitee.com/guozhe001/images/raw/master//image-20200919113611840.png" alt="image-20200919113611840"></p><p>2ã€å‘é€æ•°æ®æ—¶ï¼ŒAä½¿ç”¨â€å¯¹ç§°åŠ å¯†çš„å¯†é’¥â€œå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œç„¶åå‘é€ç»™Bï¼Œè¿™æ ·Bå°±èƒ½ä½¿ç”¨ä¹‹å‰æ”¶åˆ°çš„â€å¯¹ç§°åŠ å¯†çš„å¯†é’¥â€œå¯¹æ•°æ®è¿›è¡Œè§£å¯†ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://gitee.com/guozhe001/images/raw/master//image-20200919114040964.png" alt="image-20200919114040964"></p><h2 id="è¿ªè²-èµ«å°”æ›¼å¯†é’¥äº¤æ¢">è¿ªè² - èµ«å°”æ›¼å¯†é’¥äº¤æ¢</h2><p>è¿ªè² - èµ«å°”æ›¼(Diffie-Hellman)å¯†é’¥äº¤æ¢æ˜¯ä¸€ç§å¯ä»¥åœ¨é€šä¿¡åŒæ–¹ä¹‹é—´å®‰å…¨äº¤æ¢å¯†é’¥çš„æ–¹æ³•ã€‚</p><p>è¿™ç§æ–¹æ³•é€šè¿‡å°†åŒæ–¹å…±æœ‰çš„ç§˜å¯†æ•°å€¼éšè—åœ¨å…¬å¼€æ•°å€¼ç›¸å…³çš„è¿ç®—ä¸­ï¼Œæ¥å®ç°åŒæ–¹ä¹‹é—´å¯†é’¥çš„å®‰å…¨äº¤æ¢ã€‚</p><h3 id="ç®—æ³•çš„æ¦‚å¿µ">ç®—æ³•çš„æ¦‚å¿µ</h3><p>å‡è®¾æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥åˆæˆä¸¤ä¸ªå¯†é’¥ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•æ¥åˆæˆå¯†é’¥På’Œå¯†é’¥Sï¼Œå°±ä¼šå¾—åˆ°ç”±è¿™ä¸¤ä¸ªå¯†é’¥çš„æˆåˆ†æ‰€æ„æˆçš„å¯†é’¥ P-Sã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master//image-20200919114844473.png" alt="image-20200919114844473"></p><p>è¿™ç§åˆæˆæ–¹æ³•æœ‰ä¸‰ä¸ªç‰¹å¾ã€‚</p><ul><li>ç¬¬ä¸€ï¼Œå³ä½¿æŒæœ‰å¯†é’¥ P å’Œåˆæˆçš„å¯†é’¥ P-Sï¼Œä¹Ÿæ— æ³•æŠŠå¯†é’¥ S å•ç‹¬å–å‡ºæ¥ã€‚</li><li>ç¬¬äºŒï¼Œä¸ç®¡æ˜¯æ€æ ·åˆæˆè€Œæ¥çš„å¯†é’¥ï¼Œéƒ½å¯ä»¥æŠŠå®ƒä½œä¸ºæ–°çš„å…ƒç´ ï¼Œç»§ç»­ä¸åˆ«çš„å¯†é’¥è¿›è¡Œåˆæˆã€‚å¦‚ä¸‹å›¾ï¼Œä½¿ç”¨å¯†é’¥ P å’Œå¯†é’¥ P-Sï¼Œè¿˜èƒ½åˆæˆå‡ºæ–°çš„å¯†é’¥ P-P-Sã€‚<ul><li><img src="https://gitee.com/guozhe001/images/raw/master//image-20200919115000979-0487431.png" alt="image-20200919115000979"></li></ul></li><li>ç¬¬ä¸‰ï¼Œå¯†é’¥çš„åˆæˆç»“æœä¸åˆæˆé¡ºåºæ— å…³ï¼Œåªä¸ç”¨äº†å“ªäº›å¯†é’¥æœ‰å…³ã€‚æ¯”å¦‚åˆæˆå¯†é’¥ B å’Œå¯†é’¥ C åï¼Œå¾—åˆ°çš„æ˜¯å¯† é’¥ B-Cï¼Œå†å°†å…¶ä¸å¯†é’¥ A åˆæˆï¼Œå¾—åˆ°çš„å°±æ˜¯å¯†é’¥ A-B-Cã€‚è€Œåˆæˆå¯†é’¥ A å’Œå¯†é’¥ C åï¼Œå¾—åˆ°çš„æ˜¯å¯†é’¥ A-Cï¼Œ å†å°†å…¶ä¸å¯†é’¥ B åˆæˆï¼Œå¾—åˆ°çš„å°±æ˜¯å¯†é’¥ B-A-Cã€‚æ­¤å¤„çš„å¯†é’¥ A-B-C å’Œå¯†é’¥ B-A-C æ˜¯ä¸€æ ·çš„ã€‚<ul><li><img src="https://gitee.com/guozhe001/images/raw/master//image-20200919115117042.png" alt="image-20200919115117042"></li></ul></li></ul><h3 id="å¯†é’¥çš„äº¤æ¢">å¯†é’¥çš„äº¤æ¢</h3><p><img src="https://gitee.com/guozhe001/images/raw/master//image-20200919115514893.png" alt="image-20200919115514893"></p><p><img src="https://gitee.com/guozhe001/images/raw/master//image-20200919115535132.png" alt="image-20200919115535132"></p><p><img src="https://gitee.com/guozhe001/images/raw/master//image-20200919115557280.png" alt="image-20200919115557280"></p><h2 id="æ¶ˆæ¯è®¤è¯ç ï¼ŒMACï¼ˆMessage-Authentication-Codeï¼‰">æ¶ˆæ¯è®¤è¯ç ï¼ŒMACï¼ˆMessage Authentication Codeï¼‰</h2><p>æ¶ˆæ¯è®¤è¯ç å¯ä»¥å®ç°â€œè®¤è¯â€å’Œâ€œæ£€æµ‹ç¯¡æ”¹â€è¿™ä¸¤ä¸ªåŠŸèƒ½ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚ä¸‹å›¾ï¼Œå‡è®¾ A å‘é€ç»™ B çš„å¯†æ–‡ï¼ˆabcï¼‰åœ¨é€šä¿¡è¿‡ç¨‹ä¸­è¢« X æ¶æ„ç¯¡æ”¹äº†ï¼Œè€Œ B æ”¶åˆ°å¯†æ–‡åæ²¡æœ‰æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜ã€‚</p><p>Bå¯¹å¯†æ–‡è¿›è¡Œè§£å¯†å¯èƒ½æ— æ³•è§£å¯†æˆ–è€…è§£å¯†åçš„æ•°æ®æ˜¯xyzã€‚å¦‚æœAåœ¨å‘Bè¿›è¡Œå•†å“è®¢è´­ï¼Œå¦‚æœBè§£å¯†å‡ºçš„å¯†æ–‡æ˜¯xyzï¼Œå°±ä¼šç»™Aå‘é€xyzå•†å“ä»è€Œå¯¼è‡´é—®é¢˜ã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master//image-20200919115921527.png" alt="image-20200919115921527"></p><h3 id="å¦‚ä½•ä½¿ç”¨æ¶ˆæ¯è®¤è¯ç è§£å†³ç¯¡æ”¹é—®é¢˜å‘¢ï¼Ÿ">å¦‚ä½•ä½¿ç”¨æ¶ˆæ¯è®¤è¯ç è§£å†³ç¯¡æ”¹é—®é¢˜å‘¢ï¼Ÿ</h3><ol><li>Aåœ¨å‘é€æ•°æ®ä¹‹å‰ï¼Œå…ˆç”Ÿæˆä¸€ä¸ªç”¨äºåˆ¶ä½œæ¶ˆæ¯éªŒè¯ç çš„å¯†é’¥ï¼ˆkeyï¼‰ï¼Œç„¶åç”¨å®‰å…¨çš„æ–¹æ³•ï¼ˆå¦‚æ··åˆåŠ å¯†ï¼‰å‘é€ç»™B</li><li>Aå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä¸”ä½¿ç”¨ç¬¬ä¸€æ­¥ç”Ÿæˆçš„keyå’Œå¯†æ–‡ç”Ÿæˆä¸€ä¸ªæ•°å€¼ï¼Œæ­¤å€¼å°±æ˜¯MAC</li><li>AæŠŠMACå’Œå¯†æ–‡ä¸€èµ·å‘é€ç»™B</li><li>Bæ¥æ”¶åˆ°å¯†æ–‡å’ŒMACåï¼Œå…ˆä½¿ç”¨ç¬¬ä¸€æ­¥Aå‘é€è¿‡æ¥çš„keyå’Œå¯†æ–‡ä½¿ç”¨åŒæ ·çš„æ–¹æ³•ç”Ÿæˆä¸€ä¸ªæ•°å€¼ï¼›å¹¶ä¸”ä½¿ç”¨æ­¤æ•°å€¼å’Œæ”¶åˆ°çš„MACè¿›è¡Œæ¯”å¯¹<ol><li>å¦‚æœæ¯”å¯¹ä¸€è‡´ï¼Œåˆ™è¯´æ˜æ•°æ®æœªè¢«ç¯¡æ”¹</li><li>å¦‚æœæ¯”å¯¹ä¸ä¸€è‡´ï¼Œåˆ™è¯´æ˜æ•°æ®è¢«ç¯¡æ”¹äº†ï¼Œç›´æ¥ä¸¢å¼ƒæ•°æ®ï¼›ç„¶åé€šçŸ¥Aé‡å‘</li></ol></li></ol><h3 id="å¦‚æœMACå’Œå¯†æ–‡éƒ½è¢«Xæˆªè·äº†æ€ä¹ˆåŠï¼Ÿ">å¦‚æœMACå’Œå¯†æ–‡éƒ½è¢«Xæˆªè·äº†æ€ä¹ˆåŠï¼Ÿ</h3><ul><li>Xå¯ä»¥ä¿®æ”¹å¯†æ–‡ï¼Œæ­¤æ—¶Bä½¿ç”¨è¢«ç¯¡æ”¹åçš„å¯†æ–‡å’Œkeyç”Ÿæˆçš„æ•°å€¼ä¸ç­‰äºMACï¼Œå°±èƒ½ç¡®è®¤é€šä¿¡è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ç¯¡æ”¹</li><li>Xå¦‚æœç¯¡æ”¹äº†MACï¼Œä¹Ÿä¸ä¸Šä¸€æ­¥ä¸€æ ·ï¼ŒBä¹Ÿèƒ½ç¡®è®¤é€šä¿¡è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ç¯¡æ”¹</li><li>Xæ—¢ç¯¡æ”¹äº†å¯†æ–‡ä¹Ÿç¯¡æ”¹äº†MACï¼Œå› ä¸ºXæ²¡æœ‰ç”ŸæˆMACçš„keyï¼Œæ‰€ä»¥Bæ”¶åˆ°è¢«ç¯¡æ”¹åçš„æ•°æ®æ—¶åŒæ ·èƒ½ç¡®è®¤å‘ç”Ÿäº†ç¯¡æ”¹</li></ul><p><strong>æˆ‘ä»¬å¯ä»¥æŠŠ MAC æƒ³è±¡æˆæ˜¯ç”±å¯†é’¥å’Œå¯†æ–‡ç»„æˆçš„å­—ç¬¦ä¸²çš„â€œå“ˆå¸Œå€¼â€ã€‚</strong></p><p><strong>è®¡ç®— MAC çš„ç®—æ³•æœ‰ HMAC 1ã€OMAC 2ã€CMAC 3ç­‰ã€‚ç›®å‰ï¼ŒHMAC çš„åº”ç”¨æœ€ä¸ºå¹¿æ³›ã€‚</strong></p><h3 id="æ¶ˆæ¯éªŒè¯ç æ— æ³•é˜²æ­¢â€œäº‹åå¦è®¤â€">æ¶ˆæ¯éªŒè¯ç æ— æ³•é˜²æ­¢â€œäº‹åå¦è®¤â€</h3><p>ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•ä¹Ÿæœ‰ç¼ºç‚¹ã€‚åœ¨ä½¿ç”¨æ¶ˆæ¯è®¤è¯ç çš„è¿‡ç¨‹ä¸­ï¼ŒAB åŒæ–¹éƒ½å¯ä»¥å¯¹æ¶ˆæ¯è¿›è¡ŒåŠ å¯†å¹¶ä¸”ç®—å‡º MACã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ— æ³•è¯æ˜åŸæœ¬çš„æ¶ˆæ¯æ˜¯ A ç”Ÿæˆçš„è¿˜æ˜¯ B ç”Ÿæˆçš„ã€‚ å› æ­¤ï¼Œå‡å¦‚ A æ˜¯åäººï¼Œä»–å°±å¯ä»¥åœ¨è‡ªå·±å‘å‡ºæ¶ˆæ¯åå£°ç§°â€œè¿™æ¡æ¶ˆæ¯æ˜¯ B æé€ çš„â€ï¼Œè€Œå¦è®¤è‡ªå·±çš„è¡Œä¸ºã€‚å¦‚æœ B æ˜¯åäººï¼Œä»–ä¹Ÿå¯ä»¥è‡ªå·±å‡†å¤‡ä¸€æ¡æ¶ˆæ¯ï¼Œç„¶åå£°ç§°â€œè¿™æ˜¯ A å‘ ç»™æˆ‘çš„æ¶ˆæ¯â€ã€‚</p><h2 id="æ•°å­—ç­¾å">æ•°å­—ç­¾å</h2><p>æ•°å­—ç­¾åä¸ä»…å¯ä»¥å®ç°æ¶ˆæ¯è®¤è¯ç çš„è®¤è¯å’Œæ£€æµ‹ç¯¡æ”¹åŠŸèƒ½ï¼Œè¿˜å¯ä»¥é¢„é˜²äº‹åå¦è®¤é—®é¢˜çš„å‘ç”Ÿã€‚</p><p>ç”±äºåœ¨æ¶ˆæ¯è®¤è¯ç ä¸­ä½¿ç”¨çš„æ˜¯å…±äº«å¯†é’¥åŠ å¯†ï¼Œæ‰€ä»¥æŒæœ‰å¯†é’¥çš„æ”¶ä¿¡äººä¹Ÿæœ‰å¯èƒ½æ˜¯æ¶ˆæ¯çš„å‘ é€è€…ï¼Œè¿™æ ·æ˜¯æ— æ³•é¢„é˜²äº‹åå¦è®¤è¡Œä¸ºçš„ã€‚</p><p>è€Œæ•°å­—ç­¾åæ˜¯åªæœ‰å‘ä¿¡äººæ‰èƒ½ç”Ÿæˆçš„ï¼Œå› æ­¤ä½¿ç”¨å®ƒå°±å¯ä»¥ç¡®å®šè°æ˜¯æ¶ˆæ¯çš„å‘é€è€…äº†ã€‚</p><h3 id="æ•°å­—ç­¾åçš„ç‰¹å¾">æ•°å­—ç­¾åçš„ç‰¹å¾</h3><p>æ¯”å¦‚Aç»™Bå‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ•°å­—ç­¾åå¿…é¡»æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼š</p><ul><li>åªè¦å‘é€çš„æ¶ˆæ¯ä¸Šæœ‰ A çš„æ•°å­—ç­¾åï¼Œå°±èƒ½ç¡®å®šæ¶ˆæ¯çš„å‘é€è€…å°±æ˜¯ Aã€‚</li><li>B å¯ä»¥éªŒè¯æ•°å­—ç­¾åçš„æ­£ç¡®æ€§ï¼Œä½†æ— æ³•ç”Ÿæˆæ•°å­—ç­¾åã€‚</li></ul><h3 id="å¦‚ä½•å®ç°æ•°å­—ç­¾å">å¦‚ä½•å®ç°æ•°å­—ç­¾å</h3><p>å…ˆå›æƒ³ä¸€ä¸‹éå¯¹ç§°åŠ å¯†çš„æµç¨‹ï¼ŒAç»™Bå‘é€æ¶ˆæ¯æ—¶ä½¿ç”¨Bæä¾›çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼ŒBä½¿ç”¨è‡ªå·±çš„ç§é’¥è¿›è¡Œè§£å¯†ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://gitee.com/guozhe001/images/raw/master//image-20200919153334400.png" alt="image-20200919153334400"></p><p>é‚£ä¹ˆæˆ‘ä»¬æŠŠè¿™ä¸ªè¿‡ç¨‹åè¿‡æ¥ï¼Œå°±å¯ä»¥åšåˆ°æ•°å­—ç­¾åï¼Œå¦‚ä¸‹å›¾ï¼š</p><ol><li>A ä½¿ç”¨è‡ªå·±çš„ç§æœ‰å¯†é’¥åŠ å¯†æ¶ˆæ¯ã€‚åŠ å¯†åçš„æ¶ˆæ¯å°±æ˜¯æ•°å­—ç­¾åã€‚</li><li>AæŠŠæ•°å­—ç­¾åå’ŒåŸå§‹çš„æ•°æ®éƒ½å‘é€ç»™B</li><li>Bæ¥æ”¶åˆ°æ•°å­—ç­¾åå’Œæ•°æ®åï¼Œä½¿ç”¨Aæä¾›çš„å…¬é’¥è¿›è¡Œè§£å¯†ï¼Œå¹¶æŠŠè§£å¯†åçš„æ•°æ®å’Œå‘é€æ¥çš„æ•°æ®åšæ¯”å¯¹</li><li>å¦‚æœä¸€è‡´ï¼Œåˆ™è¯´æ˜æ­¤æ¶ˆæ¯æ˜¯ç”±Aå‘é€çš„ï¼Œå› ä¸ºAçš„å…¬é’¥åªèƒ½è§£å¯†ç»æœ‰Açš„ç§é’¥åŠ å¯†çš„æ•°æ®</li></ol><p><img src="https://gitee.com/guozhe001/images/raw/master//image-20200919153913102.png" alt="image-20200919153913102"></p><p>èƒ½å¤Ÿç”¨ A çš„å…¬å¼€å¯†é’¥è§£å¯†çš„å¯†æ–‡ï¼Œå¿…å®šæ˜¯ç”± A ç”Ÿæˆçš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç»“è®ºæ¥ç¡®è®¤æ¶ˆæ¯çš„å‘é€è€…æ˜¯å¦ä¸º Aï¼Œæ¶ˆæ¯æ˜¯å¦è¢«äººç¯¡æ”¹ã€‚</p><p>ç”±äº B åªæœ‰å…¬å¼€å¯†é’¥ï¼Œæ— æ³•ç”Ÿæˆ A çš„ç­¾åï¼Œæ‰€ä»¥ä¹Ÿé¢„é˜²äº†â€œäº‹åå¦è®¤â€è¿™ä¸€é—®é¢˜çš„ å‘ç”Ÿã€‚</p><p><strong>åœ¨ä½¿ç”¨æ­¤æ–¹å¼è¿›è¡ŒåŠ å¯†æ—¶ï¼ŒAä½¿ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†çš„æ•°æ®æœ€å¥½æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œåªæ˜¯ç”¨æ¥éªŒè¯å‘é€ç€æ˜¯å¦æ˜¯Aï¼Œå¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚</strong></p><h2 id="æ•°å­—è¯ä¹¦">æ•°å­—è¯ä¹¦</h2><p>â€œå…¬å¼€å¯†é’¥åŠ å¯†â€å’Œâ€œæ•°å­—ç­¾åâ€æ— æ³•ä¿è¯å…¬å¼€å¯†é’¥ç¡®å®æ¥è‡ªä¿¡æ¯çš„å‘é€è€…ã€‚å› æ­¤ï¼Œå°±ç®—å…¬ å¼€å¯†é’¥è¢«ç¬¬ä¸‰è€…æ¶æ„æ›¿æ¢ï¼Œæ¥æ”¶æ–¹ä¹Ÿä¸ä¼šæ³¨æ„åˆ°ã€‚</p><p>è€Œæ•°å­—è¯ä¹¦ï¼Œå°±èƒ½ä¿è¯å…¬å¼€å¯†é’¥çš„æ­£ç¡®æ€§ã€‚</p><h3 id="å¦‚ä½•ä½¿ç”¨æ•°æ®è¯ä¹¦å‘é€å…¬é’¥">å¦‚ä½•ä½¿ç”¨æ•°æ®è¯ä¹¦å‘é€å…¬é’¥</h3><p>AæŒæœ‰å…¬å¼€å¯†é’¥Pa å’Œ Aç§æœ‰å¯†é’¥ Sa ï¼Œç°åœ¨æƒ³è¦å°†å…¬å¼€å¯†é’¥PAå‘é€ç»™Bï¼Œå¦‚ä½•åšå‘¢ï¼Ÿ</p><ol><li>Aé¦–å…ˆéœ€è¦å‘è®¤è¯ä¸­å¿ƒ (Certification Authorityï¼Œ CA)ç”³è¯·å‘è¡Œè¯ä¹¦ï¼Œè¯æ˜å…¬å¼€å¯†é’¥PA ç¡®å®ç”±è‡ªå·±ç”Ÿæˆ</li><li>è®¤è¯ä¸­å¿ƒé‡Œä¿ç®¡ç€ä»–ä»¬è‡ªå·±å‡†å¤‡çš„å…¬å¼€å¯†é’¥Pcå’Œç§æœ‰å¯†é’¥ Sc</li><li>Aå°†å…¬å¼€å¯†é’¥Pa å’ŒåŒ…å«é‚®ç®±ä¿¡æ¯çš„ä¸ªäººèµ„æ–™å‘é€ç»™è®¤è¯ä¸­å¿ƒ</li><li>è®¤è¯ä¸­å¿ƒå¯¹æ”¶åˆ°çš„èµ„æ–™è¿›è¡Œç¡®è®¤ï¼Œåˆ¤æ–­å…¶æ˜¯å¦ä¸ºAæœ¬äººçš„èµ„æ–™ã€‚ç¡®è®¤å®Œæ¯•åï¼Œè®¤è¯ä¸­å¿ƒä½¿ç”¨è‡ªå·±çš„ç§æœ‰å¯†é’¥ Scï¼Œæ ¹æ® A çš„èµ„æ–™ç”Ÿæˆæ•°å­—ç­¾åã€‚</li><li>è®¤è¯ä¸­å¿ƒå°†ç”Ÿæˆçš„æ•°å­—ç­¾åå’Œèµ„æ–™æ”¾è¿›åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶æŠŠè¿™ä¸ªæ–‡ä»¶å‘é€ç»™ Aã€‚ï¼ˆè¿™ä¸ªæ–‡ä»¶å°±æ˜¯ A çš„æ•°å­—è¯ä¹¦ï¼‰</li><li>A å°†ä½œä¸ºå…¬å¼€å¯†é’¥çš„æ•°å­—è¯ä¹¦å‘é€ç»™äº† Bã€‚</li><li>B æ”¶åˆ°æ•°å­—è¯ä¹¦åï¼Œç¡®è®¤è¯ä¹¦é‡Œçš„é‚®ä»¶åœ°å€ç¡®å®æ˜¯ A çš„åœ°å€ã€‚æ¥ç€ï¼ŒB è·å–äº†è®¤è¯ä¸­å¿ƒçš„å…¬å¼€å¯†é’¥ã€‚</li><li>B å¯¹è¯ä¹¦å†…çš„ç­¾åè¿›è¡ŒéªŒè¯ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦ä¸ºè®¤è¯ä¸­å¿ƒç»™å‡ºçš„ç­¾åã€‚è¯ä¹¦ä¸­çš„ç­¾ååªèƒ½ç”¨è®¤è¯ä¸­å¿ƒçš„å…¬å¼€å¯†é’¥ Pc è¿›è¡ŒéªŒè¯ã€‚å¦‚æœéªŒè¯ç»“æœæ²¡æœ‰å¼‚å¸¸ï¼Œå°±èƒ½è¯´æ˜è¿™ä»½è¯ä¹¦çš„ç¡®ç”±è®¤è¯ä¸­å¿ƒå‘è¡Œã€‚</li><li>ç¡®è®¤äº†è¯ä¹¦æ˜¯ç”±è®¤è¯ä¸­å¿ƒå‘è¡Œçš„ï¼Œä¸”é‚®ä»¶åœ°å€å°±æ˜¯ Açš„ä¹‹åï¼ŒBä»è¯ä¹¦ä¸­å–å‡ºAçš„å…¬å¼€å¯†é’¥PAã€‚è¿™æ ·ï¼Œå…¬å¼€å¯†é’¥ä¾¿ä» A ä¼ åˆ° äº†Bã€‚</li></ol><p>ç»è¿‡ä»¥ä¸Šæ­¥éª¤ä¿¡æ¯çš„æ¥æ”¶è€…Bå¯ä»¥ç¡®è®¤å…¬å¼€å¯†é’¥çš„åˆ¶ä½œè€…æ˜¯Aã€‚</p><h3 id="å¾ªç¯è´¨ç–‘ï¼Œæˆ‘ä»¬ä»è®¤è¯ä¸­å¿ƒè·å–çš„å…¬é’¥PcçœŸçš„æ¥è‡ªè®¤è¯ä¸­å¿ƒå—">å¾ªç¯è´¨ç–‘ï¼Œæˆ‘ä»¬ä»è®¤è¯ä¸­å¿ƒè·å–çš„å…¬é’¥PcçœŸçš„æ¥è‡ªè®¤è¯ä¸­å¿ƒå—</h3><p>ç”±äºå…¬å¼€å¯†é’¥è‡ªèº«ä¸èƒ½è¡¨ç¤ºå…¶åˆ¶ä½œè€…ï¼Œæ‰€ä»¥æœ‰å¯èƒ½æ˜¯å†’å……è®¤è¯ä¸­å¿ƒçš„ X æ‰€ç”Ÿæˆçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é‡ŒåŒæ ·å­˜åœ¨å…¬å¼€å¯†é’¥é—®é¢˜(è¯·å‚è€ƒä¸‹å›¾)ã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master//image-20200919165548842.png" alt="image-20200919165548842"></p><p>å®é™…ä¸Šï¼Œè®¤è¯ä¸­å¿ƒçš„å…¬å¼€å¯†é’¥ PC æ˜¯ä»¥æ•°å­—è¯ä¹¦çš„å½¢å¼äº¤ä»˜çš„ï¼Œä¼šæœ‰æ›´é«˜çº§åˆ«çš„è®¤è¯ ä¸­å¿ƒå¯¹è¿™ä¸ªè®¤è¯ä¸­å¿ƒç½²å(è¯·å‚è€ƒä¸‹å›¾)ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬æœ‰æ‰€æ€€ç–‘å¯ä»¥ä¸€ç›´éªŒè¯ä¸‹å»ã€‚</p><p>æœ€é¡¶ç«¯çš„è®¤è¯ä¸­å¿ƒè¢«ç§°ä¸ºâ€œæ ¹è®¤è¯ä¸­å¿ƒâ€(root CA)ï¼Œå…¶è‡ªèº«çš„æ­£å½“æ€§ç”±è‡ªå·±è¯æ˜ã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master//image-20200919165633696.png" alt="image-20200919165633696"></p><h1 id="ç¬¬å…­ç« -èšç±»">ç¬¬å…­ç«  èšç±»</h1><h2 id="ä»€ä¹ˆæ˜¯èšç±»">ä»€ä¹ˆæ˜¯èšç±»</h2><h3 id="å°†ç›¸ä¼¼çš„å¯¹è±¡åˆ†ä¸ºä¸€ç»„">å°†ç›¸ä¼¼çš„å¯¹è±¡åˆ†ä¸ºä¸€ç»„</h3><p>èšç±»å°±æ˜¯åœ¨è¾“å…¥ä¸ºå¤šä¸ªæ•°æ®æ—¶ï¼Œå°†â€œç›¸ä¼¼â€çš„æ•°æ®åˆ†ä¸ºä¸€ç»„çš„æ“ä½œã€‚1ä¸ªç»„å°±å«ä½œ1ä¸ª â€œç°‡â€ã€‚</p><p>ä¸‹é¢çš„ç¤ºä¾‹ä¸­æ¯ä¸ªç‚¹éƒ½ä»£è¡¨ 1 ä¸ªæ•°æ®ï¼Œåœ¨å¹³é¢ä¸Šä½ç½®è¾ƒä¸ºç›¸è¿‘ã€è¢«åœˆèµ·æ¥çš„ç‚¹å°±ä»£è¡¨ä¸€ç±»ç›¸ä¼¼çš„æ•°æ®ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›æ•°æ®è¢«åˆ†ä¸ºäº† 3 ä¸ªç°‡ã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master/null/%E6%88%AA%E5%B1%8F2020-09-21%20%E4%B8%8B%E5%8D%8811.05.28.png" alt="æˆªå±2020-09-21 ä¸‹åˆ11.05.28"></p><h3 id="å¦‚ä½•å®šä¹‰â€œç›¸ä¼¼â€">å¦‚ä½•å®šä¹‰â€œç›¸ä¼¼â€</h3><h4 id="å®šä¹‰æ•°æ®é—´çš„å·®è·">å®šä¹‰æ•°æ®é—´çš„å·®è·</h4><p>æ ¹æ®æ•°æ®ç±»å‹ä¸åŒï¼Œå®šä¹‰è¯¥æ•°æ®æ˜¯å¦â€œç›¸ä¼¼â€çš„æ ‡å‡†ä¹Ÿä¸åŒã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯è¦å¯¹ä¸¤ä¸ªæ•° æ®ä¹‹é—´çš„â€œå·®è·â€è¿›è¡Œå®šä¹‰ã€‚</p><p>å¦‚ï¼šå‡è®¾æŸæ‰€é«˜ä¸­çš„æŸä¸ªå¹´çº§ä¸­å…±æœ‰ 400 åå­¦ç”Ÿï¼Œç°åœ¨æˆ‘ä»¬æƒ³è¦å°†è¿™äº›å­¦ç”Ÿåœ¨è€ƒè¯•ä¸­å–å¾—çš„è¯­ æ–‡ã€æ•°å­¦ã€è‹±è¯­æˆç»©æ•°æ®åŒ–ï¼Œå¹¶å°†ä»–ä»¬æŒ‰ç…§â€œæ“…é•¿æˆ–ä¸æ“…é•¿çš„ç§‘ç›®ç›¸ä¼¼â€è¿›è¡Œèšç±»ã€‚</p><p>æŠŠæ¯ä¸ªå­¦ç”Ÿéƒ½è½¬æ¢æˆâ€œ(è¯­æ–‡æˆç»© , æ•°å­¦æˆç»© , è‹±è¯­æˆç»©)â€å½¢å¼çš„æ•°æ®åï¼Œå°±å¯ä»¥å°†ä¸¤ä¸ªæ•°æ®(<em>c</em>1, <em>m</em>1, <em>e</em>1)å’Œ(<em>c</em>2, <em>m</em>2, <em>e</em>2)ä¹‹é—´çš„å·®è·å®šä¹‰ä¸º (<em>c</em>1-<em>c</em>2) + (<em>m</em>1-<em>m</em>2) + (<em>e</em>1-<em>e</em>2) ï¼Œå…¶ä¸­å·®è·å°çš„æ•°æ® å°±äº’ä¸ºâ€œç›¸ä¼¼çš„æ•°æ®â€ã€‚</p><h4 id="ç¬¦åˆæ¡ä»¶çš„ç®—æ³•">ç¬¦åˆæ¡ä»¶çš„ç®—æ³•</h4><p>å³ä½¿å®šä¹‰å¥½äº†æ•°æ®é—´çš„å·®è·ï¼Œèšç±»çš„æ–¹æ³•ä¹Ÿä¼šæœ‰å¾ˆå¤šç§ã€‚æˆ‘ä»¬å¯ä»¥è®¾å®šå„ç§å„æ ·çš„æ¡ä»¶ï¼Œ æ¯”å¦‚æƒ³æŠŠæ•°æ®åˆ†ä¸º 10 ä¸ªç°‡ï¼Œæˆ–è€…æƒ³æŠŠ 1 ä¸ªç°‡å†…çš„æ•°æ®å®šåœ¨ 30~50 äººä¹‹é—´ï¼Œå†æˆ–è€…æƒ³æŠŠç°‡å†…æ•°æ® é—´çš„æœ€å¤§è·ç¦»è®¾ä¸º 10ï¼Œç­‰ç­‰ã€‚è€Œè®¾å®šä»€ä¹ˆæ ·çš„æ¡ä»¶å–å†³äºè¿›è¡Œèšç±»çš„ç›®çš„ã€‚</p><h2 id="k-means-ç®—æ³•">k-means ç®—æ³•</h2><p><em>k</em>-means ç®—æ³•æ˜¯èšç±»ç®—æ³•ä¸­çš„ä¸€ç§ï¼Œå®ƒå¯ä»¥æ ¹æ®äº‹å…ˆç»™å®šçš„ç°‡çš„æ•°é‡è¿›è¡Œèšç±»ã€‚</p><h3 id="k-meansç®—æ³•æ­¥éª¤">k-meansç®—æ³•æ­¥éª¤</h3><ol><li>é¦–å…ˆå‡†å¤‡å¥½éœ€è¦èšç±»çš„æ•°æ®ï¼Œç„¶åå†³å®šç°‡çš„æ•°é‡ï¼ˆæ¯”å¦‚ä¸‹é¢å›¾ç¤ºç°‡çš„æ•°é‡ä¸º3ï¼‰ã€‚</li><li>éšæœºé€‰æ‹© 3 ä¸ªç‚¹ä½œä¸ºç°‡çš„ä¸­å¿ƒç‚¹ã€‚</li><li>è®¡ç®—å„ä¸ªæ•°æ®åˆ†åˆ«å’Œ 3 ä¸ªä¸­å¿ƒç‚¹ä¸­çš„å“ªä¸€ä¸ªç‚¹è·ç¦»æœ€è¿‘ã€‚</li><li>å°†æ•°æ®åˆ†åˆ°ç›¸åº”çš„ç°‡ä¸­ã€‚è¿™æ ·ï¼Œ3 ä¸ªç°‡çš„èšç±»å°±å®Œæˆäº†ã€‚</li><li>è®¡ç®—å„ä¸ªç°‡ä¸­æ•°æ®çš„é‡å¿ƒï¼Œç„¶åå°†ç°‡çš„ä¸­å¿ƒç‚¹ç§»åŠ¨åˆ°è¿™ä¸ªä½ç½®ã€‚</li><li>é‡æ–°è®¡ç®—è·ç¦»æœ€è¿‘çš„ç°‡çš„ä¸­å¿ƒç‚¹ï¼Œå¹¶å°†æ•°æ®åˆ†åˆ°ç›¸åº”çš„ç°‡ä¸­ã€‚</li><li>é‡å¤æ‰§è¡Œâ€œå°†æ•°æ®åˆ†åˆ°ç›¸åº”çš„ç°‡ä¸­â€å’Œâ€œå°†ä¸­å¿ƒç‚¹ç§»åˆ°é‡å¿ƒçš„ä½ç½®â€è¿™ä¸¤ä¸ªæ“ä½œï¼Œç›´åˆ°ä¸­å¿ƒç‚¹ä¸ å†å‘ç”Ÿå˜åŒ–ä¸ºæ­¢ã€‚</li></ol><p><img src="https://gitee.com/guozhe001/images/raw/master/null/image-20200921231952128.png" alt="image-20200921231952128"></p><p><img src="https://gitee.com/guozhe001/images/raw/master/null/image-20200921232008317.png" alt="image-20200921232008317"></p><p><img src="https://gitee.com/guozhe001/images/raw/master/null/image-20200921232023522.png" alt="image-20200921232023522"></p><p><img src="https://gitee.com/guozhe001/images/raw/master/null/image-20200921232039847.png" alt="image-20200921232039847"></p><h3 id="è§£è¯´ï¼š">è§£è¯´ï¼š</h3><p><em>k</em>-means ç®—æ³•ä¸­ï¼Œéšç€æ“ä½œçš„ä¸æ–­é‡å¤ï¼Œä¸­å¿ƒç‚¹çš„ä½ç½®å¿…å®šä¼šåœ¨æŸå¤„æ”¶æ•›ï¼Œè¿™ä¸€ç‚¹ å·²ç»åœ¨æ•°å­¦å±‚é¢ä¸Šå¾—åˆ°è¯æ˜ã€‚</p><p>å‰é¢çš„ä¾‹å­ä¸­æˆ‘ä»¬å°†ç°‡çš„æ•°é‡å®šä¸º 3ï¼Œè‹¥ç°åœ¨ä½¿ç”¨åŒæ ·çš„æ•°æ®ï¼Œå°†ç°‡çš„æ•°é‡å®šä¸º 2ï¼Œ é‚£ä¹ˆèšç±»å°†å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master/null/image-20200921232309104.png" alt="image-20200921232309104"></p><p>ä½äºå·¦è¾¹å’Œä¸‹è¾¹çš„ä¸¤ä¸ªæ•°æ®å—è¢«åˆ†åˆ°äº†ä¸€ä¸ªç°‡ä¸­ã€‚å°±åƒè¿™æ ·ï¼Œç”±äº <em>k</em>-means ç®—æ³•éœ€ è¦äº‹å…ˆç¡®å®šå¥½ç°‡çš„æ•°é‡ï¼Œæ‰€ä»¥è®¾å®šçš„æ•°é‡å¦‚æœä¸åˆç†ï¼Œè¿è¡Œçš„ç»“æœå°±å¯èƒ½ä¼šä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ã€‚</p><p>å¦‚æœå¯¹ç°‡çš„æ•°é‡æ²¡æœ‰æ˜ç¡®è¦æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥äº‹å…ˆå¯¹æ•°æ®è¿›è¡Œåˆ†æï¼Œæ¨ç®—å‡ºä¸€ä¸ªåˆé€‚çš„æ•°é‡ï¼Œæˆ–è€…ä¸æ–­æ”¹å˜ç°‡çš„æ•°é‡æ¥è¯•éªŒ <em>k</em>-means ç®—æ³•ã€‚</p><p>å¦å¤–ï¼Œå¦‚æœç°‡çš„æ•°é‡åŒæ ·ä¸º 2ï¼Œä½†ä¸­å¿ƒç‚¹æœ€åˆçš„ä½ç½®ä¸åŒï¼Œé‚£ä¹ˆä¹Ÿå¯èƒ½ä¼šå‡ºç°ä¸‹å›¾ è¿™æ ·çš„èšç±»ç»“æœã€‚</p><p><img src="https://gitee.com/guozhe001/images/raw/master/null/image-20200921232443009.png" alt="image-20200921232443009"></p><p>ä¸ä¹‹å‰çš„æƒ…å†µä¸åŒï¼Œè¿™æ¬¡å³ä¸Šå’Œå³ä¸‹çš„ä¸¤ä¸ªæ•°æ®å—è¢«åˆ†åˆ°äº†ä¸€ä¸ªç°‡ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ å³ä½¿ç°‡çš„æ•°é‡ç›¸åŒï¼Œåªè¦éšæœºè®¾ç½®çš„ä¸­å¿ƒç‚¹æœ€åˆçš„ä½ç½®ä¸åŒï¼Œèšç±»çš„ç»“æœä¹Ÿä¼šäº§ç”Ÿå˜åŒ–ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹å˜éšæœºè®¾å®šçš„ä¸­å¿ƒç‚¹ä½ç½®æ¥ä¸æ–­å°è¯• <em>k</em>-means ç®—æ³•ï¼Œå†ä»ä¸­é€‰æ‹© æœ€åˆé€‚çš„èšç±»ç»“æœã€‚</p><h3 id="è¡¥å……è¯´æ˜-v2">è¡¥å……è¯´æ˜</h3><p>é™¤äº† <em>k</em>-means ç®—æ³•ä»¥å¤–ï¼Œèšç±»ç®—æ³•è¿˜æœ‰å¾ˆå¤šï¼Œå…¶ä¸­â€œå±‚æ¬¡èšç±»ç®—æ³•â€è¾ƒä¸ºæœ‰åã€‚ä¸ <em>k</em>-means ç®—æ³•ä¸åŒï¼Œå±‚æ¬¡èšç±»ç®—æ³•ä¸éœ€è¦äº‹å…ˆè®¾å®šç°‡çš„æ•°é‡ã€‚</p><p>åœ¨å±‚æ¬¡èšç±»ç®—æ³•ä¸­ï¼Œä¸€å¼€å§‹æ¯ä¸ªæ•°æ®éƒ½è‡ªæˆä¸€ç±»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰ <em>n</em> ä¸ªæ•°æ®å°±ä¼šå½¢æˆ <em>n</em> ä¸ªç°‡ã€‚ç„¶åé‡å¤æ‰§è¡Œâ€œå°†è·ç¦»æœ€è¿‘çš„ä¸¤ä¸ªç°‡åˆå¹¶ä¸ºä¸€ä¸ªâ€çš„æ“ä½œ <em>n</em>-1 æ¬¡ã€‚æ¯æ‰§è¡Œ 1 æ¬¡ï¼Œ ç°‡å°±ä¼šå‡å°‘ 1 ä¸ªã€‚æ‰§è¡Œ <em>n</em> - 1 æ¬¡åï¼Œæ‰€æœ‰æ•°æ®å°±éƒ½è¢«åˆ†åˆ°äº†ä¸€ä¸ªç°‡ä¸­ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªé˜¶æ®µçš„ç°‡çš„æ•°é‡éƒ½ä¸åŒï¼Œå¯¹åº”çš„èšç±»ç»“æœä¹Ÿä¸åŒã€‚åªè¦é€‰æ‹©å…¶ä¸­æœ€ä¸ºåˆç†çš„ 1 ä¸ªç»“æœ å°±å¥½ã€‚</p><p>åˆå¹¶ç°‡çš„æ—¶å€™ï¼Œä¸ºäº†æ‰¾å‡ºâ€œè·ç¦»æœ€è¿‘çš„ä¸¤ä¸ªç°‡â€ï¼Œéœ€è¦å…ˆå¯¹ç°‡ä¹‹é—´çš„è·ç¦»è¿›è¡Œå®šä¹‰ã€‚ æ ¹æ®å®šä¹‰æ–¹æ³•ä¸åŒï¼Œä¼šæœ‰â€œæœ€çŸ­è·ç¦»æ³•â€â€œæœ€é•¿è·ç¦»æ³•â€â€œä¸­é—´è·ç¦»æ³•â€ç­‰å¤šç§ç®—æ³•ã€‚</p><h1 id="ç¬¬ä¸ƒç« -å…¶ä»–ç®—æ³•">ç¬¬ä¸ƒç«  å…¶ä»–ç®—æ³•</h1><h2 id="æ¬§å‡ é‡Œå¾—ç®—æ³•">æ¬§å‡ é‡Œå¾—ç®—æ³•</h2><p>æ¬§å‡ é‡Œå¾—ç®—æ³•(åˆç§°è¾—è½¬ç›¸é™¤æ³•)ç”¨äºè®¡ç®—ä¸¤ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°**(GCD:greatest common divisor)**ï¼Œè¢«ç§°ä¸ºä¸–ç•Œä¸Šæœ€å¤è€çš„ç®—æ³•ã€‚</p><h3 id="ä½¿ç”¨æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚1112å’Œ695çš„æœ€å¤§å…¬çº¦æ•°">ä½¿ç”¨æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚1112å’Œ695çš„æœ€å¤§å…¬çº¦æ•°</h3><ol><li>é¦–å…ˆç”¨è¾ƒå°çš„æ•°å­—å»é™¤è¾ƒå¤§çš„æ•°å­—ï¼Œæ±‚å‡ºä½™æ•°ã€‚ä¹Ÿå°±æ˜¯å¯¹ä¸¤ä¸ªæ•°å­—è¿›è¡Œ mod è¿ç®—ï¼Œé™¤å®Œåçš„ä½™æ•°ä¸º417ã€‚<ol><li>modè¿ç®—å³å–ä½™è¿ç®—ï¼Œ<em>A</em> mod <em>B</em> å°±æ˜¯ç®—å‡º<em>A</em>é™¤ä»¥<em>B</em>åçš„ä½™æ•°<em>C</em>ã€‚</li></ol></li><li>æ¥ä¸‹æ¥å†ç”¨é™¤æ•°695å’Œä½™æ•°417è¿›è¡Œmodè¿ ç®—ã€‚ç»“æœä¸º 278ã€‚</li><li>ç»§ç»­é‡å¤åŒæ ·çš„æ“ä½œï¼Œå¯¹ 417 å’Œ 278 è¿›è¡Œ mod è¿ç®—ï¼Œç»“æœä¸º139ã€‚</li><li>å¯¹ 278 å’Œ 139 è¿›è¡Œ mod è¿ç®—ï¼Œç»“æœä¸º 0ã€‚ä¹Ÿå°± æ˜¯è¯´ï¼Œ278 å¯ä»¥è¢« 139 æ•´é™¤ã€‚</li><li>ä½™æ•°ä¸º 0 æ—¶ï¼Œæœ€åä¸€æ¬¡è¿ç®—ä¸­çš„é™¤æ•° 139 å°±æ˜¯ 1112 å’Œ 695 çš„æœ€å¤§å…¬çº¦æ•°ã€‚</li></ol><p><img src="https://gitee.com/guozhe001/images/raw/master/null/image-20200921233013836.png" alt="image-20200921233013836"></p><h3 id="Javaå®ç°">Javaå®ç°</h3><p><a href="https://github.com/guozhe001/my-tools/blob/master/my-learn/my-algorithm/src/main/java/com/nicai/algorithm/other/EuclideanGreatestCommonDivisor.java">æ¬§å‡ é‡Œå¾—æœ€å¤§å…¬çº¦æ•°ç®—æ³•</a></p><h2 id="ç´ æ€§æµ‹è¯•">ç´ æ€§æµ‹è¯•</h2><p>ç´ æ€§æµ‹è¯•æ˜¯åˆ¤æ–­ä¸€ä¸ªè‡ªç„¶æ•°æ˜¯å¦ä¸ºç´ æ•°çš„æµ‹è¯•ã€‚ç´ æ•°(prime number)å°±æ˜¯åªèƒ½è¢« 1 å’Œå…¶è‡ªèº«æ•´é™¤ï¼Œä¸”å¤§äº 1 çš„è‡ªç„¶æ•°ã€‚</p><p>ç´ æ•°ä»å°åˆ°å¤§æœ‰ 2ã€3ã€5ã€7ã€11ã€13â€¦ç›®å‰åœ¨åŠ å¯†æŠ€æœ¯ä¸­è¢«å¹¿æ³›åº”ç”¨çš„ RSA ç®—æ³•å°±ä¼šç”¨åˆ°å¤§ç´ æ•°ï¼Œå› æ­¤â€œç´ æ€§æµ‹è¯•â€åœ¨è¯¥ç®—æ³•ä¸­èµ·åˆ°äº†é‡è¦çš„ä½œç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
          <category> è¯»ä¹¦ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¯»ä¹¦ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ€è§„åˆ’å­¦ä¹ </title>
      <link href="2021/04/01/algorithms/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"/>
      <url>2021/04/01/algorithms/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/</url>
      
        <content type="html"><![CDATA[<h1 id="åŠ¨æ€è§„åˆ’">åŠ¨æ€è§„åˆ’</h1><p>æœ¬æ¥æƒ³ç”¨5W2Håˆ†ææ³•æ¥è§£é‡Šæ­¤é—®é¢˜ï¼Œä½†æ˜¯å‘ç°æ¯”è¾ƒå›°éš¾ï¼Œè¿˜æ˜¯å…ˆçœ‹ä¾‹å­å§ã€‚<br>åŠ¨æ€è§„åˆ’çš„åŸç†ï¼šåŠ¨æ€è§„åˆ’å…ˆè§£å†³å­é—®é¢˜ï¼Œå†é€æ­¥è§£å†³å¤§é—®é¢˜ã€‚å…ˆæœ‰è¿™ä¸ªç®€å•çš„æ¦‚å¿µå³å¯ï¼Œæˆ‘ä¼šé€šè¿‡ä¾‹å­æ¥è¯´æ˜ã€‚</p><h1 id="ä¸¾ä¾‹ï¼šåšä¸ªå°å·é¡¾é—®">ä¸¾ä¾‹ï¼šåšä¸ªå°å·é¡¾é—®</h1><h2 id="ä¾‹1ï¼Œæ‰“å®¶åŠ«èˆï¼ˆæ— é™èƒŒåŒ…é—®é¢˜ï¼‰">ä¾‹1ï¼Œæ‰“å®¶åŠ«èˆï¼ˆæ— é™èƒŒåŒ…é—®é¢˜ï¼‰</h2><h3 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h3><p>åœ¨ä¸‡æ¶çš„èµ„æœ¬ä¸»ä¹‰ç¤¾ä¼šç¾å›½ï¼Œæœ‰ä¸€ä¸ªå°å·ï¼ˆç½—ä¼¯ç‰¹ï¼‰ï¼Œæœ‰ä¸€å¤©æ™šä¸Šç½—ä¼¯ç‰¹ä¸ä»–çš„åŒä¼™å¼€äº†ä¸€è¾†å¡è½¦ï¼ˆå‡å¦‚å¯ä»¥è£…æ— é™çš„ç°é‡‘ï¼‰æ¥åˆ°äº†ä¸€æ’ä¸»äººéƒ½å‡ºé—¨æ—…æ¸¸å»äº†çš„æˆ¿å±‹é¢å‰ï¼Œæ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ï¼Œå½±å“ç½—ä¼¯ç‰¹å·çªƒçš„å”¯ä¸€åˆ¶çº¦å› ç´ å°±æ˜¯ç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œå¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ã€‚ è¯·å¸®ä»–è®¾è®¡ç¨‹åºä»¥å·å–æœ€å¤šçš„ç°é‡‘ã€‚<br></p><h3 id="é—®é¢˜åˆ†æ"><img src="https://gitee.com/guozhe001/images/raw/master/1604543616351-c27c0806-d0c7-47a7-b7f7-2e182fc1e17d.png" alt="image.png">é—®é¢˜åˆ†æ</h3><h4 id="1ã€ç®€åŒ–é—®é¢˜">1ã€ç®€åŒ–é—®é¢˜</h4><ul><li>å¦‚æœåªæœ‰ä¸€ä¸ªæˆ¿å­ç½—ä¼¯ç‰¹æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ</li><li>å¦‚æœæœ‰ä¸¤ä¸ªæˆ¿å­ç½—ä¼¯ç‰¹æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ</li><li>å¦‚æœæœ‰ä¸‰ä¸ªæˆ¿å­ç½—ä¼¯ç‰¹æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ</li><li>ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</li></ul><p><br>ä¸ºäº†æ–¹ä¾¿åˆ†æï¼Œæˆ‘ä»¬æŠŠæˆ¿å­çš„æ•°é‡å’Œèƒ½å¤Ÿå·çš„é’±æ•°è®°å½•ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”»ä¸€ä¸ªè¡¨æ ¼å¦‚ä¸‹ï¼š</p><ul><li>ç¬¬ä¸€åˆ—è¡¨ç¤ºå¦‚æœåªå·å‰é¢çš„nä¸ªæˆ¿å­</li><li>ç¬¬äºŒåˆ—è¡¨ç¤ºå¦‚æœåªå·å‰é¢çš„nä¸ªæˆ¿å­æœ€å¤šèƒ½å·å¤šå°‘é’±</li><li>æ‹¬å·é‡Œé¢çš„æ˜¯å·å“ªäº›æˆ¿å­</li></ul><h4 id="2ã€å„ä¸ªå‡»ç ´ç®€åŒ–åçš„é—®é¢˜">2ã€å„ä¸ªå‡»ç ´ç®€åŒ–åçš„é—®é¢˜</h4><p><strong>å¦‚æœåªæœ‰å‰é¢ä¸€ä¸ªæˆ¿å­ç½—ä¼¯ç‰¹æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ</strong></p><table><thead><tr><th>æˆ¿å­æ•°é‡</th><th>æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ</th></tr></thead><tbody><tr><td>1</td><td>$100(1)</td></tr></tbody></table><p><strong>å¦‚æœåªæœ‰å‰é¢ä¸¤ä¸ªæˆ¿å­ç½—ä¼¯ç‰¹æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ</strong><br>å½“åªæœ‰å‰é¢ä¸¤ä¸ªæˆ¿å­æ—¶ï¼Œå› ä¸ºé™åˆ¶æ¡ä»¶æ˜¯ä¸èƒ½å·ç›¸é‚»çš„æˆ¿å­ä¸ç„¶ä¼šè§¦å‘æŠ¥è­¦ï¼Œæ‰€ä»¥å·å…¶ä¸­é‡‘é¢å¤§çš„é‚£ä¸ªå³å¯ã€‚<br></p><table><thead><tr><th>æˆ¿å­æ•°é‡</th><th>æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ</th></tr></thead><tbody><tr><td>1</td><td>$100(1)</td></tr><tr><td>2</td><td>$200(2)</td></tr></tbody></table><p><strong>å¦‚æœåªæœ‰å‰é¢ä¸‰ä¸ªæˆ¿å­ç½—ä¼¯ç‰¹æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ</strong><br>å½“åªæœ‰å‰é¢ä¸‰ä¸ªæˆ¿å­æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹©ï¼Œç¬¬1ç§ï¼šå·ç¬¬ä¸‰ä¸ªå’Œç¬¬ä¸€ä¸ªï¼›ç¬¬2ç§ï¼šå·ç¬¬äºŒä¸ªã€‚ä»ä¸¤ç§é€‰æ‹©ä¸­æŒ‘ä¸€ä¸ªèƒ½å·çš„é‡‘é¢è¾ƒå¤§çš„æ–¹æ³•ã€‚</p><table><thead><tr><th>æˆ¿å­æ•°é‡</th><th>æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ</th></tr></thead><tbody><tr><td>1</td><td>$100(1)</td></tr><tr><td>2</td><td>$200(2)</td></tr><tr><td>3</td><td>$200(2)</td></tr></tbody></table><p><strong>å¦‚æœåªæœ‰å‰é¢å››ä¸ªæˆ¿å­ç½—ä¼¯ç‰¹æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ</strong></p><p>å½“åªæœ‰å‰é¢å››ä¸ªæˆ¿å­æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹©ï¼š</p><ul><li>ç¬¬1ç§ï¼šå·ç¬¬å››ä¸ªï¼Œå†åŠ ä¸Šå·å‰ä¸¤ä¸ªæˆ¿å­çš„æœ€å¤§å€¼</li><li>ç¬¬2ç§ï¼šä¸å·ç¬¬å››ä¸ªï¼Œåªå·å‰é¢ä¸‰ä¸ªæˆ¿å­çš„æœ€å¤§å€¼</li></ul><p>ä»ä¸¤ç§é€‰æ‹©ä¸­æŒ‘ä¸€ä¸ªèƒ½å·çš„é‡‘é¢è¾ƒå¤§çš„æ–¹æ³•ã€‚</p><table><thead><tr><th>æˆ¿å­æ•°é‡</th><th>æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ</th></tr></thead><tbody><tr><td>1</td><td>$100(1)</td></tr><tr><td>2</td><td>$200(2)</td></tr><tr><td>3</td><td>$200(2)</td></tr><tr><td>4</td><td>$500 = $300(4) + $200(2)</td></tr></tbody></table><p><strong>å¦‚æœåªæœ‰å‰é¢äº”ä¸ªæˆ¿å­ç½—ä¼¯ç‰¹æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ</strong><br>å½“åªæœ‰å‰é¢äº”ä¸ªæˆ¿å­æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹©ï¼š</p><ul><li>ç¬¬1ç§ï¼šå·ç¬¬äº”ä¸ªï¼Œå†åŠ ä¸Šå·å‰ä¸‰ä¸ªæˆ¿å­çš„æœ€å¤§å€¼</li><li>ç¬¬2ç§ï¼šä¸å·ç¬¬äº”ä¸ªï¼Œåªå·å‰é¢å››ä¸ªæˆ¿å­çš„æœ€å¤§å€¼</li></ul><p>ä»ä¸¤ç§é€‰æ‹©ä¸­æŒ‘ä¸€ä¸ªèƒ½å·çš„é‡‘é¢è¾ƒå¤§çš„æ–¹æ³•ã€‚</p><table><thead><tr><th>æˆ¿å­æ•°é‡</th><th>æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ</th></tr></thead><tbody><tr><td>1</td><td>$100(1)</td></tr><tr><td>2</td><td>$200(2)</td></tr><tr><td>3</td><td>$200(2)</td></tr><tr><td>4</td><td>$500 = $300(4) + $200(2)</td></tr><tr><td>5</td><td>$500 = $300(4) + $200(2)</td></tr></tbody></table><h4 id="3ã€æ€»ç»“å½’çº³">3ã€æ€»ç»“å½’çº³</h4><p>æˆ‘ä»¬é€šè¿‡ä¸Šé¢çš„è¡¨æ ¼å¯ä»¥æ€»ç»“å‡ºæ¥ä»€ä¹ˆå—ï¼Ÿæˆ‘ä»¬åœ¨æ­¤çº¦å®šä¸€ä¸ªæ•°å­¦å…¬å¼ï¼štotal(n)è¡¨ç¤ºæœ€å¤§èƒ½å·çš„é‡‘é¢ï¼›ä½¿ç”¨amount(n)è¡¨ç¤ºç¬¬nä¸ªæˆ¿å­æœ‰å¤šå°‘é‡‘é¢<br>æ ¹æ®ä»¥ä¸Šçš„è¡¨æ ¼æˆ‘ä»¬å¯ä»¥çŸ¥é“<br>total(1) = 100 = amount(1) = max(amount(1), 0)<br>total(2) = 200 = max(amount(2), amount(1))<br>total(3) = 200 = max(amount(3) + amount(1), amount(2)) = max(amount(3) + total(3-2), total(2))<br>total(4) = 500 = max(amount(4) + total(4-2), amount(3)) = max(amount(4) + total(4-2), total(3)) <br>total(n) = max(amount(n) + total(n-2), total(n-1))</p><h4 id="4ã€ä»£ç å®ç°">4ã€ä»£ç å®ç°</h4><p>ç»è¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬ç«Ÿç„¶æ€»ç»“å‡ºäº†ä¸€ä¸ªå…¬å¼ï¼štotal(n) = max(amount(n) + total(n-2), total(n-1))<br>å¤§å®¶åº”è¯¥å¯¹æ–æ³¢é‚£å¥‘æ•°åˆ—æ¯”è¾ƒç†Ÿæ‚‰ï¼Œä»–çš„å…¬å¼æ˜¯ï¼šf(n) = f(n-1) + f(n-2)ï¼Œç„¶åå¯èƒ½ç¬¬ä¸€ååº”å°±æƒ³åˆ°äº†é€’å½’çš„å®ç°ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨é€’å½’çš„æ–¹å¼è§£å†³ç½—ä¼¯ç‰¹çš„é—®é¢˜æŠŠï¼Ÿshow you the codeï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€’å½’æ–¹å¼</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">robRecursion</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å½“æ²¡æœ‰æˆ¿å­æ—¶</span></span><br><span class="line">    <span class="keyword">if</span> (Objects.isNull(nums) || nums.length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums.length == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// å½“åªæœ‰ä¸€ä¸ªæˆ¿å­æ—¶</span></span><br><span class="line">        <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums.length == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="comment">// å½“åªæœ‰ä¸¤ä¸ªæˆ¿å­æ—¶</span></span><br><span class="line">        <span class="keyword">return</span> Math.max(nums[<span class="number">0</span>], nums[<span class="number">1</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å…¶ä»–æƒ…å†µ</span></span><br><span class="line">        <span class="comment">// total(n) = max(amount(n) + total(n-2), total(n-1))</span></span><br><span class="line">        <span class="keyword">return</span> Math.max(nums[nums.length - <span class="number">1</span>] + robRecursion(Arrays.copyOf(nums, nums.length - <span class="number">2</span>)),</span><br><span class="line">                robRecursion(Arrays.copyOf(nums, nums.length - <span class="number">1</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>OKï¼Œå¤§åŠŸå‘Šæˆï¼Œä¸Šé¢çš„ä»£ç ç»è¿‡æµ‹è¯•æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œè§£å†³äº†ç½—ä¼¯ç‰¹çš„é—®é¢˜ï¼Œå›å®¶ç¡è§‰ã€‚<br>ç­‰ç­‰ï¼ï¼ï¼æˆ‘ä»¬æ˜¯ä¸æ˜¯å¿˜äº†ä»€ä¹ˆï¼Œè¿™ç¯‡æ–‡ç« çš„æ ‡é¢˜ä¸æ˜¯åŠ¨æ€è§„åˆ’å—ï¼ŒåŠ¨æ€è§„åˆ’å‘¢ï¼Ÿ<br>**<br>è®©æˆ‘ä»¬å†å›å¤´çœ‹ä¸€ä¸‹é€’å½’çš„æ–¹å¼å®ç°ï¼Œæ¯å½“è¦è®¡ç®—total(n)æ—¶ï¼Œå°±å…ˆè®¡ç®—total(n-1)å’Œtotal(n-2)ï¼Œå¦‚æœè¯´æˆ‘ä»¬å…ˆè®¡ç®—å‡ºæ¥total(n-1)å’Œtotal(n-2)æ˜¯ä¸æ˜¯è®¡ç®—total(n)çš„æ—¶å€™å°±ä¸ç”¨é‡æ–°è®¡ç®—total(n-1)å’Œtotal(n-2)äº†ï¼ŸæŒ‰ç…§è¿™ä¸ªæ€è·¯æˆ‘ä»¬å°±éœ€è¦æŠŠæ¯æ¬¡è®¡ç®—å‡ºçš„total(n-1)å’Œtotal(n-2)çš„ç»“æœè®°å½•ä¸‹æ¥ï¼Œç­‰è®¡ç®—total(n)çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥ç”¨äº†ã€‚<br>show you the codeï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŠ¨æ€è§„åˆ’æ–¹å¼</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">rob</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–åŠ¨æ€è§„åˆ’çš„æ•°ç»„ï¼Œæ­¤æ—¶çš„æ•°ç»„ä¸­çš„å€¼éƒ½æ˜¯0</span></span><br><span class="line"><span class="comment">     * æ­¤æ•°ç»„çš„ä¸‹æ ‡ä¸ºå·å–çš„å‰nä¸ªæˆ¿å±‹çš„æ•°é‡</span></span><br><span class="line"><span class="comment">     * æ­¤æ•°ç»„çš„å€¼ä¸ºå·å–çš„å‰nä¸ªæˆ¿å±‹å¯ä»¥å·å–çš„é‡‘é’±æœ€å¤§å€¼</span></span><br><span class="line"><span class="comment">     * å¦‚æœdp[5] = 100ï¼›è¡¨ç¤ºå·å–å‰é¢çš„5å®¶æˆ¿å±‹ï¼Œæœ€å¤šå¯ä»¥å·å–100åˆ€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span>[] dp = <span class="keyword">new</span> <span class="keyword">int</span>[nums.length + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nums.length; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> amountOfNumberI = nums[i - <span class="number">1</span>];</span><br><span class="line">        <span class="comment">// å¦‚æœåªå·ç¬¬ä¸€ä¸ªæˆ¿å­</span></span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">1</span>) &#123;</span><br><span class="line">            dp[i] = amountOfNumberI;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * æ­¤æ—¶æœ‰ä¸¤ç§é€‰æ‹©:1ã€å·å½“å‰çš„æˆ¿å±‹ï¼›2ã€ä¸å·å½“å‰çš„æˆ¿å±‹ï¼Œä¸¤ç§é€‰æ‹©å–æœ€å¤§å€¼</span></span><br><span class="line"><span class="comment">             * å¦‚æœé€‰æ‹©1ï¼Œåˆ™è¦è®¡ç®—å½“å‰æˆ¿å±‹çš„é‡‘é’±ä¸å½“å‰æˆ¿å±‹å‰ä¸€ä¸ªä¸ç›¸é‚»çš„æ‰€æœ‰æˆ¿å±‹çš„é‡‘é’±ä»·å€¼</span></span><br><span class="line"><span class="comment">             * å¦‚æœé€‰æ‹©2ï¼Œåˆ™ç›´æ¥å–å½“å‰æˆ¿å±‹ä¹‹å‰çš„æ‰€æœ‰æˆ¿å±‹èƒ½å¤Ÿå·çš„é‡‘é’±æœ€å¤§å€¼</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            dp[i] = Math.max(amountOfNumberI + dp[i - <span class="number">2</span>], dp[i - <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[nums.length];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­å–œä½ ï¼Œä¸Šé¢çš„ä»£ç å°±æ˜¯åŠ¨æ€è§„åˆ’çš„æ–¹å¼ï¼›ä¸é€’å½’çš„æ–¹å¼ä¸åŒï¼Œæ¯æ¬¡çš„è®¡ç®—ç»“æœéƒ½ä¿å­˜åœ¨äº†dpæ•°ç»„ä¸­ï¼Œè®¡ç®—ä¸‹ä¸€ä¸ªå€¼æ—¶ç›´æ¥ä»æ•°ç»„ä¸­è·å–ä»¥å‰è®¡ç®—è¿‡çš„å€¼å³å¯ã€‚<a href="https://github.com/guozhe001/my-tools/blob/eb33781f6fe3613ca531ad047de60b2cb0ec8e45/my-learn/my-algorithm/src/main/java/com/nicai/algorithm/leetcode/editor/cn/P198HouseRobber.java">ç½—ä¼¯ç‰¹å·ä¸€æ’æˆ¿å­çš„æºç </a><br></p><h2 id="ä¾‹2ï¼ŒèƒŒåŒ…é—®é¢˜">ä¾‹2ï¼ŒèƒŒåŒ…é—®é¢˜</h2><h3 id="é—®é¢˜æè¿°-v2">é—®é¢˜æè¿°</h3><p>æœ‰ä¸€å¤©ç½—ä¼¯ç‰¹å¸¦ç€ä¸€ä¸ªå¯ä»¥è£…4kgçš„èƒŒåŒ…ï¼Œå»äº†ä¸€å®¶å°å•†åº—ï¼Œå°å•†åº—é‡Œé¢æœ‰ä¸‹é¢è‡³å°‘ä¸‰ä¸ªå•†å“ï¼›è¯·å¸®åŠ©ä»–å†³å®šåº”è¯¥å·å“ªäº›å•†å“ã€‚</p><table><thead><tr><th>å•†å“åç§°</th><th>å•†å“ä»·æ ¼ï¼ˆå•ä½$ï¼‰</th><th>å•†å“é‡é‡ï¼ˆå•ä½kgï¼‰</th></tr></thead><tbody><tr><td>å‰ä»–</td><td>1500</td><td>1</td></tr><tr><td>éŸ³ç®±</td><td>3000</td><td>4</td></tr><tr><td>ç”µè„‘</td><td>2000</td><td>3</td></tr><tr><td>â€¦</td><td>â€¦</td><td>â€¦</td></tr></tbody></table><h3 id="é—®é¢˜åˆ†æ-v2">é—®é¢˜åˆ†æ</h3><p>é¦–å…ˆæ‹¿åˆ°è¿™ä¸ªé—®é¢˜å¯èƒ½ä¸€çœ¼å°±çœ‹å‡ºæ¥äº†ç­”æ¡ˆï¼Œå°±æ˜¯å·å‰ä»–å’Œç”µè„‘ï¼›é‚£ä¹ˆå¦‚æœè¯´å•†å“æ•°é‡æ˜¯100ä¸ªçš„è¯æ˜¯æ— æ³•ä¸€çœ¼çœ‹å‡ºç­”æ¡ˆçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ€ä¹ˆå»å¸®ç½—ä¼¯ç‰¹å†³ç­–å‘¢ï¼Ÿ<br><br><br>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹é—®é¢˜çš„å…³é”®ï¼š</p><ul><li>å®¹é‡4kgçš„èƒŒåŒ…</li><li>è‡³å°‘ä¸‰ä¸ªä¸åŒä»·æ ¼å’Œä¸åŒé‡é‡çš„å•†å“</li><li>ä¸€ä¸ªå•†å“è¦å˜›å…¨å·è¦å˜›ä¸å·ï¼Œä¸èƒ½åªå·ä¸€éƒ¨åˆ†</li><li>å·çš„å•†å“åˆ—è¡¨èƒŒåŒ…å¿…é¡»èƒ½è£…çš„ä¸‹ï¼Œå¹¶ä¸”ä»·æ ¼æœ€å¤§</li></ul><h4 id="1ã€ç®€åŒ–é—®é¢˜-v2">1ã€ç®€åŒ–é—®é¢˜</h4><p>ç®€åŒ–é—®é¢˜çš„è¿‡ç¨‹ï¼š</p><ul><li>æœ€ç®€å•çš„æ˜¯ä»€ä¹ˆï¼Ÿåªæœ‰ä¸€ä¸ªå•†å“ï¼Œåªèƒ½è£…1kgçš„èƒŒåŒ…</li><li>å¢åŠ ç‚¹éš¾åº¦ï¼Œåªæœ‰ä¸€ä¸ªå•†å“ï¼ŒèƒŒåŒ…çš„é‡é‡é€æ¸å¢åŠ åˆ°ç½—ä¼¯ç‰¹çš„èƒŒåŒ…é‡é‡</li><li>ç»§ç»­å¢åŠ éš¾åº¦ï¼Œåªæœ‰ä¸¤ä¸ªå•†å“ï¼Œ1kgçš„èƒŒåŒ…èƒ½å·ä»€ä¹ˆï¼Ÿ2kgçš„èƒŒåŒ…èƒ½å·ä»€ä¹ˆï¼Ÿ3kgã€4kgå‘¢ï¼Ÿ</li><li>æœ‰ä¸‰ä¸ªå•†å“ï¼Œ1kgçš„èƒŒåŒ…èƒ½å·ä»€ä¹ˆï¼Ÿ2kgçš„èƒŒåŒ…èƒ½å·ä»€ä¹ˆï¼Ÿ3kgã€4kgå‘¢ï¼Ÿ</li><li>æœ‰nä¸ªå•†å“å’Œèƒ½è£…mkgçš„èƒŒåŒ…</li></ul><h4 id="2ã€ç®€åŒ–åçš„é—®é¢˜å„ä¸ªå‡»ç ´">2ã€ç®€åŒ–åçš„é—®é¢˜å„ä¸ªå‡»ç ´</h4><h5 id="æŠŠé—®é¢˜æœ€å°åŒ–ï¼šåªæœ‰ä¸€ä¸ªå•†å“ï¼Œåªèƒ½è£…1kgçš„èƒŒåŒ…">æŠŠé—®é¢˜æœ€å°åŒ–ï¼šåªæœ‰ä¸€ä¸ªå•†å“ï¼Œåªèƒ½è£…1kgçš„èƒŒåŒ…</h5><p>åˆ°è¿™é‡Œå…¶å®æˆ‘ä»¬è¿˜æ˜¯æ— æ³•çŸ¥é“åˆ°åº•åº”è¯¥æ€ä¹ˆå¸®ç½—ä¼¯ç‰¹å†³ç­–ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä¸å¯ä»¥æŠŠé—®é¢˜ç®€åŒ–ä¸€ä¸‹ï¼Œå‡å¦‚èƒŒåŒ…å®¹é‡æ˜¯1ï¼Œå•†å“ä¸ªæ•°ä¹Ÿæ˜¯1åªæœ‰ä¸€æŠŠå‰ä»–ï¼›å¦‚ä¸‹ï¼š</p><ul><li>å®¹é‡1kgçš„èƒŒåŒ…</li><li>1æŠŠé‡é‡æ˜¯1kgä»·æ ¼æ˜¯$1500çš„å‰ä»–</li></ul><p>å¦‚æœæ˜¯ä¸Šé¢ç®€åŒ–åçš„é—®é¢˜ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥è®¡ç®—çš„ï¼Œè®¡ç®—æ–¹æ³•æ˜¯ï¼šåˆ¤æ–­å‰ä»–èƒ½å¦è£…å…¥èƒŒåŒ…ï¼Œå¦‚æœå¯ä»¥åˆ™1kgå®¹é‡çš„èƒŒåŒ…å¯ä»¥å·å‰ä»–ï¼Œæœ€å¤§ä»·æ ¼æ˜¯$1500ï¼Œæˆ‘ä»¬ç»§ç»­ä½¿ç”¨ä¸€ä¸ªè¡¨æ ¼æŠŠå®ƒè®°å½•ä¸‹æ¥ï¼š<br>æˆ‘ä»¬å…ˆçº¦å®šå¥½è¡¨æ ¼çš„å†…å®¹ï¼š</p><ul><li>è¡Œè¡¨ç¤ºèƒŒåŒ…çš„å®¹é‡</li><li>åˆ—è¡¨ç¤ºæœ‰å“ªäº›å•†å“</li><li>å•å…ƒæ ¼çš„æ•°å­—è¡¨ç¤ºå¯ä»¥å·çš„æœ€å¤§å€¼</li><li>æ‹¬å·é‡Œé¢æ˜¯å·å“ªäº›å•†å“<br>| å•†å“\å®¹é‡ | 1 |<br>| â€” | â€” |<br>| å‰ä»– | 1500ï¼ˆå‰ä»–ï¼‰ |</li></ul><p>æˆ‘ä»¬æ˜¯å¦‚ä½•å¾—åˆ°ä¸Šé¢çš„è¡¨æ ¼çš„å‘¢ï¼Ÿåˆ¤æ–­å‰ä»–æ˜¯å¦èƒ½è£…è¿›å®¹é‡ä¸º1kgçš„èƒŒåŒ…ä¸­ï¼Œå¦‚æœå¯ä»¥åˆ™å·å‰ä»–ï¼Œå‰ä»–çš„ä»·æ ¼ä¹Ÿå°±æ˜¯å·å–çš„æœ€å¤§çš„ä»·æ ¼ã€‚</p><h5 id="å¢åŠ éš¾åº¦ï¼Œå¢åŠ èƒŒåŒ…çš„å®¹é‡ï¼šåªæœ‰ä¸€ä¸ªå•†å“ï¼ŒèƒŒåŒ…çš„é‡é‡é€æ¸å¢åŠ åˆ°ç½—ä¼¯ç‰¹çš„èƒŒåŒ…é‡é‡">å¢åŠ éš¾åº¦ï¼Œå¢åŠ èƒŒåŒ…çš„å®¹é‡ï¼šåªæœ‰ä¸€ä¸ªå•†å“ï¼ŒèƒŒåŒ…çš„é‡é‡é€æ¸å¢åŠ åˆ°ç½—ä¼¯ç‰¹çš„èƒŒåŒ…é‡é‡</h5><p>æˆ‘ä»¬åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šå†æŠŠèƒŒåŒ…çš„å®¹é‡å¢åŠ ï¼Œç›´åˆ°å¢åŠ åˆ°ä¸ç½—ä¼¯ç‰¹çš„èƒŒåŒ…ç›¸åŒçš„å®¹é‡ä¸ºæ­¢ï¼Œä½†æ˜¯ä¾ç„¶åªå¯ä»¥å·å–ä¸€æŠŠå‰ä»–ï¼›æˆ‘ä»¬æŠŠè¿™äº›ä¿¡æ¯è®°å½•ä¸‹æ¥å¦‚ä¸‹ï¼Œå…¶ä¸­ç¬¬ä¸€åˆ—ä¸ºå•†å“ï¼Œç¬¬ä¸€è¡Œä¸ºèƒŒåŒ…å®¹é‡ï¼Œè¡¨æ ¼è®°å½•çš„æ˜¯å·å–å•†å“çš„æœ€å¤§ä»·æ ¼ï¼Œæ‹¬å·é‡Œé¢çš„æ˜¯å·å–çš„å•†å“ã€‚<br>å¦‚ä¸‹è¡¨çš„çº¢è‰²éƒ¨åˆ†å°±ä»£è¡¨ï¼ŒèƒŒåŒ…å®¹é‡ä¸º4åªæœ‰ä¸€æŠŠå‰ä»–å¯å·æ—¶ï¼Œå¯ä»¥å·å–çš„å•†å“æœ€å¤§ä»·æ ¼æ˜¯1500ï¼Œå·å–çš„å•†å“æ˜¯å‰ä»–ã€‚</p><table><thead><tr><th>å•†å“\å®¹é‡</th><th>1</th><th>2</th><th>3</th><th>4</th></tr></thead><tbody><tr><td>å‰ä»–</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td></tr></tbody></table><h5 id="ç»§ç»­å¢åŠ éš¾åº¦ï¼Œå¢åŠ ä¸€ä¸ªå•†å“">ç»§ç»­å¢åŠ éš¾åº¦ï¼Œå¢åŠ ä¸€ä¸ªå•†å“</h5><p>æˆ‘ä»¬å†åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šï¼Œå¢åŠ å¯ä»¥å·å–çš„å•†å“ï¼Œå†åŠ ä¸€ä¸ªéŸ³ç®±ï¼Œç„¶åä½¿ç”¨ç›¸åŒçš„æ–¹æ³•ç»˜åˆ¶ä¸Šé¢çš„è¡¨æ ¼ï¼›</p><table><thead><tr><th>å•†å“\å®¹é‡</th><th>1</th><th>2</th><th>3</th><th>4</th></tr></thead><tbody><tr><td>å‰ä»–</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td></tr><tr><td>éŸ³ç®±</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td></td><td></td><td></td></tr></tbody></table><p>ä¸Šé¢å¯ä»¥çœ‹åˆ°**table[éŸ³ç®±][å®¹é‡1]**çš„å•å…ƒæ ¼çš„å€¼å¦‚ä¸Šè¡¨æ˜¯1500,å› ä¸ºå®¹é‡æ˜¯1çš„èƒŒåŒ…æ— æ³•è£…ä¸‹éŸ³ç®±ï¼Œæ‰€ä»¥ä¾ç„¶åªèƒ½å·å‰ä»–ï¼Œæ‰€ä»¥å¯ä»¥å·å–çš„å•†å“çš„æœ€å¤§çš„ä»·æ ¼ä¸º1500ã€‚<br>è®©æˆ‘ä»¬å®Œæˆè¿™ä¸ªè¡¨æ ¼çš„å¡«å†™ï¼š</p><table><thead><tr><th>å•†å“\å®¹é‡</th><th>1</th><th>2</th><th>3</th><th>4</th></tr></thead><tbody><tr><td>å‰ä»–</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td></tr><tr><td>éŸ³ç®±</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>3000ï¼ˆéŸ³ç®±ï¼‰</td></tr></tbody></table><p>å¦‚ä¸Šè¡¨æ‰€ç¤ºï¼Œå½“èƒŒåŒ…å®¹é‡ä¸º4æ—¶ï¼Œå¯ä»¥è£…ä¸‹éŸ³ç®±ï¼Œå¹¶ä¸”éŸ³ç®±çš„ä»·æ ¼3000å¤§äº**table[å‰ä»–][å®¹é‡4]<strong>çš„1500ï¼Œæ‰€ä»¥æ­¤æ—¶æˆ‘ä»¬è®¾ç½®</strong>table[éŸ³ç®±][å®¹é‡4]<strong>çš„å•å…ƒæ ¼çš„æœ€å¤§ä»·æ ¼ä¸º3000ã€‚<strong>table[éŸ³ç®±][å®¹é‡4] = Max(å½“å‰è¡Œè®¡ç®—çš„å€¼, table[å‰ä»–][å®¹é‡4])</strong><br></strong></p><h5 id="ç»§ç»­å¢åŠ éš¾åº¦ï¼Œå†å¢åŠ ä¸€ä¸ªå•†å“å†å¢åŠ ä¸€ä¸ªå•†å“">ç»§ç»­å¢åŠ éš¾åº¦ï¼Œå†å¢åŠ ä¸€ä¸ªå•†å“å†å¢åŠ ä¸€ä¸ªå•†å“</h5><p>æˆ‘ä»¬ç»§ç»­æŠŠç”µè„‘å¢åŠ åˆ°å¯ä»¥å·å–çš„å•†å“åˆ—è¡¨ä¸­ï¼Œç„¶åç»§ç»­ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•ç”»å‡ºç”µè„‘è¡Œçš„å‰ä¸‰ä¸ªå®¹é‡çš„å•å…ƒæ ¼å¦‚ä¸‹ï¼šæ­¤æ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°**table[ç”µè„‘][å®¹é‡3]**çš„å€¼åº”è¯¥æ˜¯2000ï¼Œå› ä¸ºå®¹é‡æ˜¯3æ—¶å¯ä»¥è£…ä¸‹ç”µè„‘ï¼Œè€Œä¸”ç”µè„‘çš„ä»·æ ¼æ¯”å‰ä»–çš„ä»·æ ¼é«˜ï¼Œæ‰€ä»¥æ­¤æ—¶ç½—ä¼¯ç‰¹åº”è¯¥å·ç”µè„‘è€Œä¸æ˜¯å‰ä»–ã€‚</p><table><thead><tr><th>å•†å“\å®¹é‡</th><th>1</th><th>2</th><th>3</th><th>4</th></tr></thead><tbody><tr><td>å‰ä»–</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td></tr><tr><td>éŸ³ç®±</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>3000ï¼ˆéŸ³ç®±ï¼‰</td></tr><tr><td>ç”µè„‘</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>2000ï¼ˆç”µè„‘ï¼‰</td><td></td></tr></tbody></table><p><strong>table[ç”µè„‘][å®¹é‡3] = Max(å½“å‰è¡Œè®¡ç®—çš„å€¼, table[éŸ³ç®±][å®¹é‡3])</strong><br>æˆ‘ä»¬ç»§ç»­çœ‹æœ€åä¸€ä¸ªå•å…ƒæ ¼ï¼ˆ**table[ç”µè„‘][å®¹é‡4]ï¼‰**åº”è¯¥å¡«ä»€ä¹ˆï¼Œå¦‚æœç½—ä¼¯ç‰¹å·ç”µè„‘ï¼Œåˆ™èƒŒåŒ…å®¹é‡è¿˜å‰©ä¸‹1ï¼Œè€Œå®¹é‡ä¸º1çš„èƒŒåŒ…å¯ä»¥å·å–çš„å•†å“ä»·æ ¼æœ€å¤§å€¼æ˜¯1500ï¼Œå·å–çš„å•†å“æ˜¯å‰ä»–ï¼Œæ‰€ä»¥æ­¤æ—¶å¯ä»¥é€‰æ‹©å·å–ç”µè„‘+å‰ä»–ï¼Œä»·æ ¼æ˜¯2000+1500=3500ï¼›è¿™æ¯”ä¹‹å‰è®°å½•çš„èƒŒåŒ…å®¹é‡æ˜¯4æ—¶çš„å•†å“æœ€å¤§å€¼ï¼ˆ3000ï¼‰å¤§ï¼Œæ‰€ä»¥è¿™ä¸ªå•å…ƒæ ¼çš„ä»·æ ¼åº”è¯¥æ˜¯3500ï¼Œå·å–çš„å•†å“æ˜¯ç”µè„‘+å‰ä»–</p><table><thead><tr><th>å•†å“\å®¹é‡</th><th>1</th><th>2</th><th>3</th><th>4</th></tr></thead><tbody><tr><td>å‰ä»–</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td></tr><tr><td>éŸ³ç®±</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>3000ï¼ˆéŸ³ç®±ï¼‰</td></tr><tr><td>ç”µè„‘</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>1500ï¼ˆå‰ä»–ï¼‰</td><td>2000ï¼ˆç”µè„‘ï¼‰</td><td>3500ï¼ˆç”µè„‘+å‰ä»–ï¼‰</td></tr></tbody></table><p><strong>table[ç”µè„‘][å®¹é‡4] = Max(å½“å‰è¡Œè®¡ç®—çš„å€¼ + å‰©ä½™å®¹é‡å¯ä»¥å·å–çš„æœ€å¤§å€¼, table[éŸ³ç®±][å®¹é‡3])</strong><br>OKï¼Œå®Œæˆä¸Šé¢çš„è¡¨æ ¼ä¹‹åæˆ‘ä»¬å°±å¯ä»¥ç¡®å®šï¼Œç½—ä¼¯ç‰¹åº”è¯¥å·ç”µè„‘+å‰ä»–ï¼Œå•†å“çš„ä»·æ ¼ä¸º3500ã€‚éšç€æˆ‘ä»¬ä¸æ–­çš„å¡«å†™è¡¨æ ¼ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ç»“æœæœ€ç»ˆä¿å­˜åœ¨è¡¨æ ¼çš„å³ä¸‹è§’ï¼Œå³**table[ç”µè„‘][å®¹é‡4]**çš„å•å…ƒæ ¼å†…ã€‚</p><h4 id="2ã€æ€»ç»“å½’çº³">2ã€æ€»ç»“å½’çº³</h4><p>è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹æ¯ä¸ªå•å…ƒæ ¼å¡«å†™çš„è§„å¾‹ï¼š<br>å‡è®¾èƒŒåŒ…æ€»å®¹é‡ä¸ºVï¼Œå•†å“çš„æ•°é‡æ˜¯Mï¼Œç¬¬iä¸ªå•†å“çš„é‡é‡æ˜¯Wiï¼Œä»·æ ¼æ˜¯Piï¼Œå®¹é‡æ˜¯vï¼ˆ1&lt;v&lt;=Vï¼‰æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å…¬å¼ï¼š<br>f(i,v) = Wi &lt;= v ? max(Pi + f(i-1, v-Wi), f(i-1, v)) : f(i-1, v)<br>åˆ†è§£ä¸Šé¢çš„å…¬å¼ï¼š</p><table><thead><tr><th>æƒ…å½¢</th><th>å€¼</th></tr></thead><tbody><tr><td>Wi &lt;= v</td><td>max(Pi + f(i-1, v-Wi), f(i-1, v))</td></tr><tr><td>Wi &gt; v</td><td>f(i-1, v)</td></tr></tbody></table><p><strong>3ã€ä»£ç å®ç°</strong><br>æˆ‘ä»¬ç»§ç»­ç”¨ä¸Šé¢ç½—ä¼¯ç‰¹æ‰“å®¶åŠ«èˆçš„æ€è·¯ï¼ŒæŠŠå·²ç»è®¡ç®—è¿‡çš„å€¼ä¿å­˜ä¸‹æ¥ï¼Œç„¶ååœ¨ç”¨åˆ°çš„æ—¶å€™ç›´æ¥å–ç”¨ã€‚å› ä¸ºå½“å‰é—®é¢˜æœ‰å¤šä¸ªå•†å“å’Œå¤šç§èƒŒåŒ…å®¹é‡ä¸¤ä¸ªé™åˆ¶çº¬åº¦ï¼Œæ‰€ä»¥åœ¨è®°å½•æ—¶éœ€è¦ç”¨åˆ°äºŒç»´æ•°ç»„ã€‚<br>show you the codeï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç»™å‡ºå•†å“åˆ—è¡¨å’ŒèƒŒåŒ…çš„å®¹é‡ï¼Œè¯·è®¡ç®—å·å–å“ªäº›å•†å“å¯ä»¥è¾¾åˆ°ä»·æ ¼æœ€å¤§åŒ–ï¼Œæœ€å¤§çš„ä»·æ ¼æ˜¯å¤šå°‘ï¼Ÿ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> products    å•†å“åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bagCapacity èƒŒåŒ…å®¹é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> èƒ½å¤Ÿå·å–çš„å•†å“æœ€å¤§çš„ä»·æ ¼ä¹‹å’Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">stealMaxPrice</span><span class="params">(Product[] products, <span class="keyword">int</span> bagCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * äºŒç»´æ•°ç»„ï¼Œè®°å½•å·²ç»è®¡ç®—è¿‡çš„æœ€å¤§ä»·æ ¼</span></span><br><span class="line"><span class="comment">         * äºŒç»´æ•°ç»„æ¯”å•†å“çš„ä¸ªæ•°å¤š1ï¼Œæ¯”èƒŒåŒ…çš„å¤§å°å¤š1ï¼ŒåŸå› æ˜¯ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ç›¸åŒçš„å…¬å¼ï¼Œç¬¬0è¡Œå’Œç¬¬0åˆ—çš„å€¼éƒ½æ˜¯0</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">int</span>[][] table = <span class="keyword">new</span> <span class="keyword">int</span>[products.length + <span class="number">1</span>][bagCapacity + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= products.length; j++) &#123;</span><br><span class="line">            Product product = products[j - <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> currentBagCapacity = <span class="number">1</span>; currentBagCapacity &lt;= bagCapacity; currentBagCapacity++) &#123;</span><br><span class="line">                table[j][currentBagCapacity] = product.weight &lt;= currentBagCapacity ?</span><br><span class="line">                        Math.max(product.price + table[j - <span class="number">1</span>][currentBagCapacity - product.weight], table[j - <span class="number">1</span>][currentBagCapacity])</span><br><span class="line">                        : table[j - <span class="number">1</span>][currentBagCapacity];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> table[products.length][bagCapacity];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å•†å“ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Product</span><span class="params">(String name, <span class="keyword">int</span> price, <span class="keyword">int</span> weight)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">            <span class="keyword">this</span>.price = price;</span><br><span class="line">            <span class="keyword">this</span>.weight = weight;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å•†å“åç§°</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        String name;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å•†å“ä»·æ ¼(å•ä½$)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">int</span> price;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å•†å“é‡é‡(å•ä½ç£…)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">int</span> weight;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><br>ä»£ç ä¸­çš„tableæœ€ç»ˆæ˜¯è¿™æ ·çš„ï¼š</p><table><thead><tr><th>0</th><th>0</th><th>0</th><th>0</th><th>0</th><th>0</th></tr></thead><tbody><tr><td>0</td><td>1500</td><td>1500</td><td>1500</td><td>1500</td><td>1500</td></tr><tr><td>0</td><td>1500</td><td>1500</td><td>1500</td><td>1500</td><td>3000</td></tr><tr><td>0</td><td>1500</td><td>1500</td><td>1500</td><td>2000</td><td>3500</td></tr></tbody></table><p>å…¶å®ä¸Šé¢çš„ä»£ç æˆ‘ç®€åŒ–äº†ä¸€ä¸‹ï¼Œè¿”å›çš„æ˜¯æœ€å¤§èƒ½å·çš„ä»·æ ¼ï¼Œè€Œç½—ä¼¯ç‰¹å½“ç„¶æ˜¯è¦ä»·æ ¼æœ€å¤§çš„å•†å“åˆ—è¡¨äº†ï¼Œè¿™ä¸ªå®ç°æ¯”è¾ƒéº»çƒ¦ä¸è´´åœ¨è¿™é‡Œäº†å¯ä»¥çœ‹<a href="https://github.com/guozhe001/my-tools/blob/eb33781f6fe3613ca531ad047de60b2cb0ec8e45/my-learn/my-algorithm/src/main/java/com/nicai/algorithm/other/DynamicProgrammingPractice.java">æºç </a></p><h1 id="ä»€ä¹ˆæ˜¯åŠ¨æ€è§„åˆ’ï¼ˆè‹±è¯­ï¼šDynamic-programmingï¼Œç®€ç§°DPï¼‰">ä»€ä¹ˆæ˜¯åŠ¨æ€è§„åˆ’ï¼ˆè‹±è¯­ï¼šDynamic programmingï¼Œç®€ç§°DPï¼‰</h1><h2 id="æ¦‚å¿µï¼š">æ¦‚å¿µï¼š</h2><p>åŠ¨æ€è§„åˆ’æ˜¯ä¸€ç§åœ¨<a href="https://zh.wikipedia.org/wiki/%E6%95%B0%E5%AD%A6">æ•°å­¦</a>ã€<a href="https://zh.wikipedia.org/wiki/%E7%AE%A1%E7%90%86%E7%A7%91%E5%AD%A6">ç®¡ç†ç§‘å­¦</a>ã€<a href="https://zh.wikipedia.org/wiki/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6">è®¡ç®—æœºç§‘å­¦</a>ã€<a href="https://zh.wikipedia.org/wiki/%E7%BB%8F%E6%B5%8E%E5%AD%A6">ç»æµå­¦</a>å’Œ<a href="https://zh.wikipedia.org/wiki/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6">ç”Ÿç‰©ä¿¡æ¯å­¦</a>ä¸­ä½¿ç”¨çš„ï¼Œé€šè¿‡æŠŠåŸé—®é¢˜åˆ†è§£ä¸ºç›¸å¯¹ç®€å•çš„å­é—®é¢˜çš„æ–¹å¼æ±‚è§£å¤æ‚é—®é¢˜çš„æ–¹æ³•ã€‚</p><h2 id="ç”¨é€”ï¼š">ç”¨é€”ï¼š</h2><p>åŠ¨æ€è§„åˆ’å¸¸å¸¸é€‚ç”¨äºæœ‰é‡å å­é—®é¢˜å’Œæœ€ä¼˜å­ç»“æ„æ€§è´¨çš„é—®é¢˜ï¼ŒåŠ¨æ€è§„åˆ’æ–¹æ³•æ‰€è€—æ—¶é—´å¾€å¾€è¿œå°‘äºæœ´ç´ è§£æ³•ã€‚<br>åŠ¨æ€è§„åˆ’èƒŒåçš„åŸºæœ¬æ€æƒ³éå¸¸ç®€å•ã€‚å¤§è‡´ä¸Šï¼Œè‹¥è¦è§£ä¸€ä¸ªç»™å®šé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è§£å…¶ä¸åŒéƒ¨åˆ†ï¼ˆå³å­é—®é¢˜ï¼‰ï¼Œå†æ ¹æ®å­é—®é¢˜çš„è§£ä»¥å¾—å‡ºåŸé—®é¢˜çš„è§£ã€‚</p><h3 id="é€‚ç”¨æƒ…å†µ">é€‚ç”¨æƒ…å†µ</h3><ul><li>æœ€ä¼˜å­ç»“æ„æ€§è´¨ã€‚<ul><li>å¦‚æœé—®é¢˜çš„æœ€ä¼˜è§£æ‰€åŒ…å«çš„å­é—®é¢˜çš„è§£ä¹Ÿæ˜¯æœ€ä¼˜çš„ï¼Œæˆ‘ä»¬å°±ç§°è¯¥é—®é¢˜å…·æœ‰æœ€ä¼˜å­ç»“æ„æ€§è´¨ï¼ˆå³æ»¡è¶³æœ€ä¼˜åŒ–åŸç†ï¼‰ã€‚</li><li>æœ€ä¼˜å­ç»“æ„æ€§è´¨ä¸ºåŠ¨æ€è§„åˆ’ç®—æ³•è§£å†³é—®é¢˜æä¾›äº†é‡è¦çº¿ç´¢ã€‚</li></ul></li><li>æ— åæ•ˆæ€§ã€‚<ul><li>å³å­é—®é¢˜çš„è§£ä¸€æ—¦ç¡®å®šï¼Œå°±ä¸å†æ”¹å˜ï¼Œä¸å—åœ¨è¿™ä¹‹åã€åŒ…å«å®ƒçš„æ›´å¤§çš„é—®é¢˜çš„æ±‚è§£å†³ç­–å½±å“ã€‚</li></ul></li><li>å­é—®é¢˜é‡å æ€§è´¨ã€‚<ul><li>å­é—®é¢˜é‡å æ€§è´¨æ˜¯æŒ‡åœ¨ç”¨é€’å½’ç®—æ³•è‡ªé¡¶å‘ä¸‹å¯¹é—®é¢˜è¿›è¡Œæ±‚è§£æ—¶ï¼Œæ¯æ¬¡äº§ç”Ÿçš„å­é—®é¢˜å¹¶ä¸æ€»æ˜¯æ–°é—®é¢˜ï¼Œæœ‰äº›å­é—®é¢˜ä¼šè¢«é‡å¤è®¡ç®—å¤šæ¬¡ã€‚</li><li>åŠ¨æ€è§„åˆ’ç®—æ³•æ­£æ˜¯åˆ©ç”¨äº†è¿™ç§å­é—®é¢˜çš„é‡å æ€§è´¨ï¼Œå¯¹æ¯ä¸€ä¸ªå­é—®é¢˜åªè®¡ç®—ä¸€æ¬¡ï¼Œç„¶åå°†å…¶è®¡ç®—ç»“æœä¿å­˜åœ¨ä¸€ä¸ªè¡¨æ ¼ä¸­ï¼Œå½“å†æ¬¡éœ€è¦è®¡ç®—å·²ç»è®¡ç®—è¿‡çš„å­é—®é¢˜æ—¶ï¼Œåªæ˜¯åœ¨è¡¨æ ¼ä¸­ç®€å•åœ°æŸ¥çœ‹ä¸€ä¸‹ç»“æœï¼Œä»è€Œè·å¾—è¾ƒé«˜çš„æ•ˆç‡ï¼Œé™ä½äº†æ—¶é—´å¤æ‚åº¦ã€‚</li></ul></li></ul><br>### é‡å å­é—®é¢˜ï¼šå¦‚ä½•ç†è§£è¿™ä¸ªæ¦‚å¿µå‘¢ï¼ŸFibnacciæ•°åˆ—<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">fib</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">assert</span> n &gt;=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fib(n-<span class="number">2</span>) + fib(n-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„æ–æ³¢é‚£å¥‘æ•°åˆ—çš„é€’å½’çš„å®ç°æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°nç­‰äº8æˆ–è€…ç­‰äº10çš„æ—¶å€™ï¼Œç¬¬mï¼ˆm&lt;nï¼‰ä¸ªæ•°å­—æ˜¯å˜åŒ–çš„å—ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">fib</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">assert</span> n &gt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span>[] c = <span class="keyword">new</span> <span class="keyword">int</span>[n + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">2</span>) &#123;</span><br><span class="line">            c[i] = i;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            c[i] = c[i - <span class="number">2</span>] + c[i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> c[n];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ¨æ€è§„åˆ’æ˜¯é€’å½’ç®—æ³•çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œä¸€èˆ¬æ¥è¯´èƒ½ç”¨é€’å½’çš„éƒ½å¯ä»¥æ€è€ƒä¸€ä¸‹èƒ½ä¸èƒ½ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„æ–¹å¼ä¼˜åŒ–ã€‚</p><h3 id="æœ€ä¼˜å­ç»“æ„æ€§è´¨">æœ€ä¼˜å­ç»“æ„æ€§è´¨</h3><p>ä¸Šé¢ä¸¤ä¸ªç½—ä¼¯ç‰¹çš„ä¾‹å­å°±æ˜¯æœ€â€œä¼˜è‡ªç»“æ„æ€§è´¨â€çš„é—®é¢˜ï¼Œä¸å¥½è§£é‡Šå¤§å®¶å¯ä»¥è‡ªå·±ä½“ä¼šã€‚</p><p><strong>æ€»ç»“ï¼šåˆ¤æ–­æ˜¯å¦å¯ä»¥ç”¨åŠ¨æ€è§„åˆ’è§£å†³é—®é¢˜çš„æ ¸å¿ƒæ˜¯ï¼šå¤§è§„æ¨¡çš„é—®é¢˜æ˜¯å¦èƒ½å¤Ÿé€šè¿‡è¾ƒå°è§„æ¨¡çš„é—®é¢˜æ¥è§£å†³ã€‚</strong></p><h2 id="æ•ˆç‡ï¼š">æ•ˆç‡ï¼š</h2><p>é€šå¸¸è®¸å¤šå­é—®é¢˜éå¸¸ç›¸ä¼¼ï¼Œä¸ºæ­¤åŠ¨æ€è§„åˆ’æ³•è¯•å›¾ä»…ä»…è§£å†³æ¯ä¸ªå­é—®é¢˜ä¸€æ¬¡ï¼Œä»è€Œå‡å°‘è®¡ç®—é‡ï¼šä¸€æ—¦æŸä¸ªç»™å®šå­é—®é¢˜çš„è§£å·²ç»ç®—å‡ºï¼Œåˆ™å°†å…¶<a href="https://zh.wikipedia.org/wiki/%E8%AE%B0%E5%BF%86%E5%8C%96">è®°å¿†åŒ–</a>å­˜å‚¨ï¼Œä»¥ä¾¿ä¸‹æ¬¡éœ€è¦åŒä¸€ä¸ªå­é—®é¢˜è§£ä¹‹æ—¶ç›´æ¥æŸ¥è¡¨ã€‚è¿™ç§åšæ³•åœ¨é‡å¤å­é—®é¢˜çš„æ•°ç›®å…³äºè¾“å…¥çš„è§„æ¨¡å‘ˆ<a href="https://zh.wikipedia.org/wiki/%E6%8C%87%E6%95%B8%E5%A2%9E%E9%95%B7">æŒ‡æ•°å¢é•¿</a>æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚<br></p><h2 id="ä¸€äº›å¯ä»¥ä½¿ç”¨åŠ¨æ€è§„åˆ’è§£å†³çš„å¸¸è§é¢˜ç›®">ä¸€äº›å¯ä»¥ä½¿ç”¨åŠ¨æ€è§„åˆ’è§£å†³çš„å¸¸è§é¢˜ç›®</h2><ul><li>çˆ¬æ¥¼æ¢¯é—®é¢˜</li><li>æœ€é•¿å­ä¸²ï¼ˆå­ä¸²éœ€è¦è¿ç»­ï¼‰</li><li>æœ€é•¿å­åºåˆ—ï¼ˆå­åºåˆ—ä¸éœ€è¦è¿ç»­ï¼‰</li><li>æœ€é•¿å­ä¸²çš„å˜ç§ï¼šæœ€é•¿å›æ–‡å­ä¸²ï¼ˆå›æ–‡ï¼šâ€œä¸Šæµ·è‡ªæ¥æ°´æ¥è‡ªæµ·ä¸Šâ€ï¼‰</li><li>DNAåºåˆ—æ¯”å¯¹</li></ul><h2 id="åŠ¨æ€è§„åˆ’ä¸å¯ä»¥è§£å†³ä»€ä¹ˆé—®é¢˜">åŠ¨æ€è§„åˆ’ä¸å¯ä»¥è§£å†³ä»€ä¹ˆé—®é¢˜</h2><ul><li>å¯ä»¥æ‹†åˆ†çš„å•†å“ï¼ˆå¦‚ç½—ä¼¯ç‰¹æ‹¿ç€4kgçš„èƒŒåŒ…å·å››è¢‹ä¸åŒä»·æ ¼çš„è±†å­ï¼ˆè¿™äº›å•†å“å¯ä»¥æ‹†åˆ†ï¼‰ï¼‰</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³• </tag>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IDEAå®‰è£…leetcodeæ’ä»¶</title>
      <link href="2021/04/01/algorithms/IDEA%E5%AE%89%E8%A3%85leetcode%E6%8F%92%E4%BB%B6/"/>
      <url>2021/04/01/algorithms/IDEA%E5%AE%89%E8%A3%85leetcode%E6%8F%92%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸ºä»€ä¹ˆå®‰è£…leetcodeæ’ä»¶">ä¸ºä»€ä¹ˆå®‰è£…leetcodeæ’ä»¶</h2><p>å½“ç„¶æ˜¯åˆ·é¢˜äº†ï¼Œç¨‹åºå‘˜éƒ½æ‡‚çš„ã€‚å®˜æ–¹åœ°å€ï¼š<br><a href="https://leetcode-cn.com">åŠ›æ‰£ (leetcode) å®˜ç½‘ - å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å°</a></p><h2 id="å¦‚ä½•å®‰è£…leetcodeæ’ä»¶">å¦‚ä½•å®‰è£…leetcodeæ’ä»¶</h2><h3 id="å®‰è£…IDEAæ’ä»¶">å®‰è£…IDEAæ’ä»¶</h3><p>æ’ä»¶åœ°å€ï¼š<a href="https://plugins.jetbrains.com/plugin/12132-leetcode-editor">leetcode editor</a>ï¼›æ’ä»¶å¦‚ä½•å®‰è£…ç•¥ã€‚</p><h3 id="é…ç½®æ’ä»¶">é…ç½®æ’ä»¶</h3><p>æ‰“å¼€IDEAçš„Preferencesï¼Œæ‰¾åˆ°Tools-leetcode pluginï¼›é¡µé¢å¦‚ä¸‹ï¼š</p><p><img src="https://gitee.com/guozhe001/images/raw/master//797ea5920c87eaf25ebb58f9a4fe249b-451940.png" alt="img"></p><h4 id="ä¸Šå›¾çš„åºå·é…ç½®ä¾æ¬¡å¦‚ä¸‹ï¼š">ä¸Šå›¾çš„åºå·é…ç½®ä¾æ¬¡å¦‚ä¸‹ï¼š</h4><ol><li>é…ç½®leecodeç½‘ç«™çš„ç”¨æˆ·åå¯†ç </li><li>é…ç½®ç”Ÿæˆä»£ç çš„åœ°å€ï¼Œæ­¤å¤„æˆ‘é€‰æ‹©çš„æ˜¯ä¸€ä¸ªä¸“é—¨çš„é¡¹ç›®çš„<code>$&#123;base_dir&#125;/src/main/java/com</code>ç›®å½•ï¼Œæ­¤æ’ä»¶ä¼šè‡ªåŠ¨åœ¨æ­¤è·¯å¾„ä¸‹åˆ›å»º<code>leetcode/editor/cn</code>,æ‰€ä»¥æœ€ç»ˆä»£ç ä¼šåœ¨<code>$&#123;base_dir&#125;/src/main/java/com/leetcode/editor/cn</code>è·¯å¾„ä¸‹</li><li>é…ç½®ç±»åå’Œæ–‡ä»¶åï¼Œå¿…é¡»é…ç½®é»˜è®¤æ˜¯ä¸­æ–‡ç±»å(éœ€è¦å‹¾é€‰Costom Template)</li></ol><p>è´´å‡ºæœ¬äººé…ç½®ä¾›å‚è€ƒï¼š<br>CodeFileName:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">P$&#123;question.frontendQuestionId&#125;$!velocityTool.camelCaseName($&#123;question.titleSlug&#125;)</span><br></pre></td></tr></table></figure><p>CodeTemplate:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leetcode.editor.cn;</span><br><span class="line">$&#123;question.content&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">P</span>$</span>&#123;question.frontendQuestionId&#125;$!velocityTool.camelCaseName($&#123;question.titleSlug&#125;)&#123;</span><br><span class="line">    $&#123;question.code&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•ä½¿ç”¨leetcodeæ’ä»¶">å¦‚ä½•ä½¿ç”¨leetcodeæ’ä»¶</h2><h3 id="ç”Ÿæˆæ¨¡æ¿ä»£ç ">ç”Ÿæˆæ¨¡æ¿ä»£ç </h3><p>1ã€æŒ‰ç…§ä¸‹å›¾æ ‡çš„é¡ºåºä¾æ¬¡ç‚¹å‡»æ’ä»¶ä¼šåŠ è½½å„ç§ç®—æ³•</p><p><img src="https://gitee.com/guozhe001/images/raw/master//69f51dd49fa9f6035b1356debca9b036-217150.png" alt="img"></p><p>2ã€éšä¾¿åŒå‡»åˆ—è¡¨ä¸­çš„ä¸€ä¸ªç®—æ³•ï¼Œä¼šåœ¨é…ç½®çš„<code>$&#123;base_dir&#125;/src/main/java/com/leetcode/editor/cn</code>è·¯å¾„ä¸‹ç”Ÿæˆæ¨¡æ¿ä»£ç ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š<br><img src="https://gitee.com/guozhe001/images/raw/master//e981a38333bf3ee9d4fa3546215af97b-180334.png" alt="img"></p><h3 id="ç»“æœéªŒè¯">ç»“æœéªŒè¯</h3><p>ç å®Œä»£ç ä¹‹åé€‰ä¸­ç›¸åº”çš„ç®—æ³•ç‚¹Submitæ¥è¿›è¡ŒéªŒè¯æ­£ç¡®æ€§</p><p><img src="https://gitee.com/guozhe001/images/raw/master//f6dd4333dc34e58371cec60d8d0a1ab8-251387.png" alt="img"></p><h3 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h3><p>1ã€ä¸‹é¢çš„ä¸¤ä¸ªæ³¨é‡Šä¸èƒ½åˆ é™¤æˆ–ä¿®æ”¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// leetcode submit region begin(Prohibit modification and deletion)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// leetcode submit region end(Prohibit modification and deletion)</span></span><br></pre></td></tr></table></figure><p>2ã€æäº¤çš„æ‰€æœ‰ä»£ç å¿…é¡»åœ¨è‡ªåŠ¨ç”Ÿæˆçš„Solutionç±»ä¹‹å†…</p><p>éå¸¸æ„Ÿè°¢ï¼ï¼ï¼</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å·¥å…· </tag>
            
            <tag> leetcode </tag>
            
            <tag> IntelliJ </tag>
            
            <tag> æ•°æ®ç»“æ„ä¸ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
