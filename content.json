{"meta":{"title":"æ»´æ°´æˆæ¶“","subtitle":"æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹","description":"","author":"guozhe","url":"https://guozhe001.github.io","root":"/"},"pages":[{"title":"about","date":"2020-12-30T11:07:14.000Z","updated":"2021-04-01T10:18:21.508Z","comments":true,"path":"about/index.html","permalink":"https://guozhe001.github.io/about/index.html","excerpt":"","text":""},{"title":"åˆ†ç±»","date":"2020-12-31T03:08:07.000Z","updated":"2021-04-01T10:18:21.508Z","comments":true,"path":"categories/index.html","permalink":"https://guozhe001.github.io/categories/index.html","excerpt":"","text":""},{"title":"search","date":"2020-12-30T11:21:06.000Z","updated":"2021-04-01T10:18:21.509Z","comments":true,"path":"search/index.html","permalink":"https://guozhe001.github.io/search/index.html","excerpt":"","text":""},{"title":"æ ‡ç­¾","date":"2020-12-31T03:13:42.000Z","updated":"2021-04-01T10:18:21.509Z","comments":true,"path":"tags/index.html","permalink":"https://guozhe001.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"Macå®‰è£…swarm-bee","slug":"blockchain/eth/å®‰è£…swarm","date":"2021-04-01T10:26:52.458Z","updated":"2021-04-01T11:30:33.141Z","comments":true,"path":"2021/04/01/blockchain/eth/å®‰è£…swarm/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/eth/%E5%AE%89%E8%A3%85swarm/","excerpt":"","text":"å®‰è£…swarm-clef 1234567891011121314151617181920212223242526272829303132$brew tap ethersphere/tapHOMEBREW_CORE_GIT_REMOTE set: using https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git for Homebrew/brew Git remote.Updating Homebrew...remote: Counting objects: 8637, done.remote: Compressing objects: 100% (3519/3519), done.remote: Total 8637 (delta 5893), reused 7146 (delta 5115)Receiving objects: 100% (8637/8637), 2.98 MiB | 530.00 KiB/s, done.Resolving deltas: 100% (5893/5893), done.From https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core 4c4ccfe0f3..7fa7e5ada3 master -&gt; origin/master==&gt; Auto-updated Homebrew!Updated 1 tap (homebrew/core).==&gt; New Formulaeas-tree gopass-jsonapi klee moto pyqt-3d qt-libiodbc qt-unixodbc virtualenvclusterctl haskell-language-server leaf-proxy numactl pyqt-builder qt-mariadb rosa-cli wllvmdjl-serving iconsur libunwind obfs4proxy pyqt-networkauth qt-mysql threemux xrayenzyme influxdb@1 linux-pam orgalorg python-tabulate qt-percona-server timg zlib-ngglibc kertish-dfs lttng-ust pandoc-plot python-tk@3.9 qt-postgresql tz==&gt; Updated FormulaeUpdated 810 formulae.==&gt; Renamed Formulaekde-extra-cmake-modules -&gt; extra-cmake-modules kde-kdoctools -&gt; kdoctools kde-threadweaver -&gt; threadweaver pyqt5 -&gt; pyqt@5kde-karchive -&gt; karchive kde-ki18n -&gt; ki18n minizip2 -&gt; minizip-ng==&gt; Tapping ethersphere/tapCloning into &#x27;/usr/local/Homebrew/Library/Taps/ethersphere/homebrew-tap&#x27;...remote: Enumerating objects: 54, done.remote: Counting objects: 100% (54/54), done.remote: Compressing objects: 100% (53/53), done.remote: Total 54 (delta 25), reused 3 (delta 0), pack-reused 0Unpacking objects: 100% (54/54), done.Tapped 2 formulae (79 files, 55.2KB). å®‰è£…swarm-clef 12345678910111213141516171819202122232425262728293031323334353637$ brew install swarm-clef==&gt; Installing swarm-clef from ethersphere/tap==&gt; Downloading https://github.com/ethersphere/bee-clef/releases/download/v0.4.9/bee-clef-darwin-amd64.tar.gz==&gt; Downloading from https://github-releases.githubusercontent.com/315272652/3b94a200-76ca-11eb-8e99-bff3c754fc38?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20210329%2Fus-eas######################################################################## 100.0%==&gt; openssl rand -out /usr/local/var/lib/swarm-clef/password -base64 32==&gt; /usr/local/Cellar/swarm-clef/0.4.9/bin/swarm-clef-init &gt;/dev/null 2&gt;&amp;1==&gt; CaveatsLogs: /usr/local/var/log/swarm-clef/swarm-clef.logTo have launchd start ethersphere/tap/swarm-clef now and restart at login: brew services start ethersphere/tap/swarm-clef==&gt; SummaryğŸº /usr/local/Cellar/swarm-clef/0.4.9: 9 files, 31.3MB, built in 10 seconds==&gt; `brew cleanup` has not been run in 30 days, running now...Removing: /Users/apple/Library/Caches/Homebrew/git--man--2.30.1.tar.xz... (470.8KB)Removing: /Users/apple/Library/Caches/Homebrew/git--html--2.30.1.tar.xz... (1.3MB)Removing: /Users/apple/Library/Caches/Homebrew/git--2.30.1.tar.xz... (6MB)Removing: /Users/apple/Library/Caches/Homebrew/git--2.30.1.big_sur.bottle.tar.gz... (14.8MB)Removing: /Users/apple/Library/Caches/Homebrew/glib--2.66.7.big_sur.bottle.tar.gz... (6.2MB)Removing: /Users/apple/Library/Caches/Homebrew/go--1.16.big_sur.bottle.tar.gz... (154.2MB)Removing: /Users/apple/Library/Caches/Homebrew/jasper--2.0.26.big_sur.bottle.tar.gz... (310.4KB)Removing: /Users/apple/Library/Caches/Homebrew/node--15.11.0.big_sur.bottle.tar.gz... (15.5MB)Removing: /Users/apple/Library/Caches/Homebrew/openssl@1.1--1.1.1j.tar.gz... (9.4MB)Removing: /Users/apple/Library/Caches/Homebrew/openssl@1.1--1.1.1j.big_sur.bottle.tar.gz... (5.4MB)Removing: /Users/apple/Library/Caches/Homebrew/python@3.9--setuptools--53.0.0.tar.gz... (2.0MB)Removing: /Users/apple/Library/Caches/Homebrew/solidity--0.8.2.big_sur.bottle.tar.gz... (7.3MB)Removing: /Users/apple/Library/Caches/Homebrew/sqlite--3.34.0.big_sur.bottle.tar.gz... (2.0MB)Removing: /Users/apple/Library/Caches/Homebrew/sphinx-doc--3.5.1.tar.gz... (5.6MB)Removing: /Users/apple/Library/Caches/Homebrew/protobuf--3.14.0.tar.gz... (7.2MB)Removing: /Users/apple/Library/Caches/Homebrew/protobuf--patch--5433b6247127f9ca622b15c9f669efbaac830fa717ed6220081bc1fc3c735f91.patch... (1KB)Removing: /Users/apple/Library/Caches/Homebrew/sphinx-doc--urllib3--1.26.3.tar.gz... (285.7KB)Removing: /Users/apple/Library/Caches/Homebrew/cmake--3.19.6.tar.gz... (8.8MB)Removing: /Users/apple/Library/Caches/Homebrew/sphinx-doc--Pygments--2.8.0.tar.gz... (3.8MB)Removing: /Users/apple/Library/Logs/Homebrew/node@10... (64B)Removing: /Users/apple/Library/Logs/Homebrew/node... (64B)Pruned 2 symbolic links and 9 directories from /usr/local å¯åŠ¨ 123456789101112$ brew services start swarm-clef==&gt; Tapping homebrew/servicesCloning into &#x27;/usr/local/Homebrew/Library/Taps/homebrew/homebrew-services&#x27;...remote: Enumerating objects: 20, done.remote: Counting objects: 100% (20/20), done.remote: Compressing objects: 100% (12/12), done.remote: Total 1141 (delta 8), reused 10 (delta 8), pack-reused 1121Receiving objects: 100% (1141/1141), 331.41 KiB | 397.00 KiB/s, done.Resolving deltas: 100% (485/485), done.Tapped 1 command (40 files, 420.5KB).==&gt; Successfully started `swarm-clef` (label: homebrew.mxcl.swarm-clef) å®‰è£…swarm-bee å®‰è£… 12345678910111213141516171819202122232425$ brew install swarm-beeHOMEBREW_CORE_GIT_REMOTE set: using https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git for Homebrew/brew Git remote.Updating Homebrew...==&gt; Installing swarm-bee from ethersphere/tap==&gt; Downloading https://github.com/ethersphere/bee/releases/download/v0.5.3/bee-darwin-amd64.tar.gz==&gt; Downloading from https://github-releases.githubusercontent.com/234530887/4ac71c80-8bb0-11eb-8943-fe7e40bc83d8?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20210329%2Fus-eas######################################################################## 100.0%==&gt; openssl rand -out /usr/local/var/lib/swarm-bee/password -base64 32==&gt; /usr/local/Cellar/swarm-bee/0.5.3/bin/bee init --config /usr/local/etc/swarm-bee/bee.yaml &gt;/dev/null 2&gt;&amp;1==&gt; CaveatsLogs: /usr/local/var/log/swarm-bee/bee.logConfig: /usr/local/etc/swarm-bee/bee.yamlBee has SWAP enabled and by default is using slock.it goerli ethereum endpoint.It is recommended to use external signer with bee.Check documentation for more info:- SWAP https://docs.ethswarm.org/docs/installation/manual#swap-bandwidth-incentives- External signer https://docs.ethswarm.org/docs/installation/bee-clefAfter you finish configuration run &#x27;bee-get-addr&#x27;.To have launchd start ethersphere/tap/swarm-bee now and restart at login: brew services start ethersphere/tap/swarm-bee==&gt; SummaryğŸº /usr/local/Cellar/swarm-bee/0.5.3: 7 files, 32.5MB, built in 5 seconds å¯åŠ¨ 1brew services start swarm-bee æŸ¥çœ‹æ—¥å¿—éªŒè¯å¯åŠ¨æƒ…å†µ 12345678910111213 tail -f /usr/local/var/log/swarm-bee/bee.logtime=&quot;2021-03-29T11:53:15+08:00&quot; level=info msg=&quot;using ethereum address fb6fe8500a4101196cc80e02f7137a20720fed20&quot;time=&quot;2021-03-29T11:53:15+08:00&quot; level=info msg=&quot;debug api address: 127.0.0.1:1635&quot;time=&quot;2021-03-29T11:53:20+08:00&quot; level=info msg=&quot;using default factory address for chain id 5: f0277caffea72734853b834afc9892461ea18474&quot;time=&quot;2021-03-29T11:53:21+08:00&quot; level=info msg=&quot;no chequebook found, deploying new one.&quot;time=&quot;2021-03-29T11:53:23+08:00&quot; level=warning msg=&quot;cannot continue until there is sufficient ETH (for Gas) and at least 10 BZZ available on fb6fe8500a4101196cc80e02f7137a20720fed20&quot;time=&quot;2021-03-29T11:53:23+08:00&quot; level=warning msg=&quot;get your Goerli ETH and Goerli BZZ now via the bzzaar at https://bzz.ethswarm.org/?transaction=buy&amp;amount=10&amp;slippage=30&amp;receiver=0xfb6fe8500a4101196cc80e02f7137a20720fed20&quot;time=&quot;2021-03-29T11:53:43+08:00&quot; level=warning msg=&quot;cannot continue until there is sufficient ETH (for Gas) and at least 10 BZZ available on fb6fe8500a4101196cc80e02f7137a20720fed20&quot;time=&quot;2021-03-29T11:53:43+08:00&quot; level=warning msg=&quot;get your Goerli ETH and Goerli BZZ now via the bzzaar at https://bzz.ethswarm.org/?transaction=buy&amp;amount=10&amp;slippage=30&amp;receiver=0xfb6fe8500a4101196cc80e02f7137a20720fed20&quot;time=&quot;2021-03-29T11:54:05+08:00&quot; level=warning msg=&quot;cannot continue until there is sufficient ETH (for Gas) and at least 10 BZZ available on fb6fe8500a4101196cc80e02f7137a20720fed20&quot;time=&quot;2021-03-29T11:54:05+08:00&quot; level=warning msg=&quot;get your Goerli ETH and Goerli BZZ now via the bzzaar at https://bzz.ethswarm.org/?transaction=buy&amp;amount=10&amp;slippage=30&amp;receiver=0xfb6fe8500a4101196cc80e02f7137a20720fed20&quot;time=&quot;2021-03-29T11:54:26+08:00&quot; level=warning msg=&quot;cannot continue until there is sufficient ETH (for Gas) and at least 10 BZZ available on fb6fe8500a4101196cc80e02f7137a20720fed20&quot;time=&quot;2021-03-29T11:54:26+08:00&quot; level=warning msg=&quot;get your Goerli ETH and Goerli BZZ now via the bzzaar at https://bzz.ethswarm.org/?transaction=buy&amp;amount=10&amp;slippage=30&amp;receiver=0xfb6fe8500a4101196cc80e02f7137a20720fed20&quot; é—®é¢˜å¤„ç† æ²¡æœ‰è¶³å¤Ÿçš„BZZ åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œéœ€è¦æŠµæŠ¼10ä¸ªBZZï¼Œæ‰€ä»¥éœ€è¦å…ˆå»å…‘æ¢BZZã€‚æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š 1msg=&quot;cannot continue until there is sufficient ETH (for Gas) and at least 10 BZZ available on fb6fe8500a4101196cc80e02f7137a20720fed20&quot; è§£å†³æ–¹æ¡ˆ æŸ¥çœ‹æ—¥å¿—get your Goerli ETH and Goerli BZZ now via the bzzaar at https://bzz.ethswarm.org/?transaction=buy&amp;amount=10&amp;slippage=30&amp;receiver=0xfb6fe8500a4101196cc80e02f7137a20720fed20å»æ—¥å¿—é‡Œé¢çš„åœ°å€å»å…‘æ¢BZZå³å¯ã€‚ é’±åŒ…éœ€è¦è¿æ¥Goerliæµ‹è¯•ç½‘ç»œ è¿æ¥ä¸ä¸Š 1234time=&quot;2021-04-01T16:39:38+08:00&quot; level=warning msg=&quot;peer not reachable when attempting to connect&quot;time=&quot;2021-04-01T16:39:38+08:00&quot; level=info msg=&quot;attempting to connect to peer 4cf39bf945bd6e9b0c30bc2c71d1fbd37ea62a6914153198013f6a307ac42c5e&quot;time=&quot;2021-04-01T16:39:38+08:00&quot; level=debug msg=&quot;could not connect to peer 4cf39bf945bd6e9b0c30bc2c71d1fbd37ea62a6914153198013f6a307ac42c5e: breaker closed&quot;time=&quot;2021-04-01T16:39:38+08:00&quot; level=debug msg=&quot;peer not reachable from kademlia [Underlay: /ip4/185.141.62.127/tcp/1634/p2p/16Uiu2HAm9tLfWdu6UGxcqEsEssZDAug4LL3xDoTtL8C1KgWDoHSv, Overlay 4cf39bf945bd6e9b0c30bc2c71d1fbd37ea62a6914153198013f6a307ac42c5e, Signature 2fd8b012352e6d8bbb987a49c62060d4ec9c900335e9abe02c685ab3c4ec92f721dbeea4ad81943933dc50bd37d773677d27d5ae1ca9d89cd61de15477fbe72f1c]: breaker closed&quot; è§£å†³æ–¹æ¡ˆ-é‡å¯ï¼›æš‚æ—¶ä¸çŸ¥é“ä¸ºä»€ä¹ˆ å¸¸ç”¨å‘½ä»¤è®°å½• å¯åŠ¨å’Œåœæ­¢ 123456# å¯åŠ¨brew services start swarm-bee# åœæ­¢brew services stop swarm-bee# é‡å¯brew services restart swarm-bee ä¸Beeäº¤äº’ï¼šçŠ¶æ€æ£€æŸ¥ ä¸»é¡µ 1curl localhost:1633 æ£€æŸ¥è¿è¡Œæ˜¯å¦æ­£å¸¸ 1curl -s http://localhost:1635/health æŸ¥çœ‹å½“å‰beeèŠ‚ç‚¹çš„åœ°å€ 1bee-get-addr 1curl -s localhost:1635/addresses | jq .ethereum ä¸Beeäº¤äº’ï¼šæ”¯ç¥¨ä¿¡æ¯ æŸ¥è¯¢å½“å‰beeèŠ‚ç‚¹çš„ä½™é¢ 1curl localhost:1635/chequebook/balance | jq æŸ¥çœ‹æ¯ä¸ªèŠ‚ç‚¹ï¼ˆå½“å‰beeèŠ‚ç‚¹è¿æ¥çš„ï¼‰çš„ä½™é¢ 1curl localhost:1635/balances | jq æŸ¥çœ‹ç»“ç®—ä¿¡æ¯ 1curl localhost:1635/settlements | jq æŸ¥çœ‹æ”¯ç¥¨ä¿¡æ¯ 1curl localhost:1635/chequebook/cheque | jq æ”¯ç¥¨å…‘æ¢(åœ°å€æ˜¯ä¸Šä¸€ä¸ªå‘½ä»¤ä¸­æ˜¾ç¤ºçš„åœ°å€) 1curl -XPOST http://localhost:1635/chequebook/cashout/d7881307e793e389642ea733451db368c4c9b9e23f188cca659c8674d183a56b æŸ¥çœ‹æ”¯ç¥¨çš„å…‘æ¢çŠ¶æ€ 1curl http://localhost:1635/chequebook/cashout/d7881307e793e389642ea733451db368c4c9b9e23f188cca659c8674d183a56b | jq gBZZæç° 1curl -XPOST http://localhost:1635/chequebook/withdraw\\?amount\\=1000 | jq ç®¡ç†æ”¯ç¥¨ ä¸‹è½½å®˜æ–¹çš„è„šæœ¬ 1wget -O cashout.sh https://gist.githubusercontent.com/ralph-pichler/3b5ccd7a5c5cd0500e6428752b37e975/raw/7ba05095e0836735f4a648aefe52c584e18e065f/cashout.sh æ·»åŠ å¯æ‰§è¡Œæƒé™ 1chmod +x cashout.sh åˆ—å‡ºæ‰€æœ‰çš„æ²¡æœ‰å…‘æ¢çš„æ”¯ç¥¨ä¿¡æ¯ 12./cashout.sh5fc100feec04e097fcf1469962a20577f3e76f07b193ae5b28156e8c72779865 246000000000 å½“è¶…è¿‡5BZZæ—¶å…‘æ¢æ‰€æœ‰æ”¯ç¥¨ï¼š 1./cashout.sh cashout-all 5 æ–‡ä»¶è·¯å¾„ æ—¥å¿—æ–‡ä»¶ï¼š 1tail -f /usr/local/var/log/swarm-bee/bee.log é…ç½®æ–‡ä»¶ï¼š 1vi /usr/local/etc/swarm-bee/bee.yaml","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"ethereum","slug":"åŒºå—é“¾/ethereum","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/ethereum/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"ethereum","slug":"ethereum","permalink":"https://guozhe001.github.io/tags/ethereum/"},{"name":"swarm","slug":"swarm","permalink":"https://guozhe001.github.io/tags/swarm/"}]},{"title":"ubantuå®‰è£…swarm-bee","slug":"blockchain/eth/ubantuå®‰è£…swarm-bee","date":"2021-04-01T10:26:39.181Z","updated":"2021-04-01T11:29:54.831Z","comments":true,"path":"2021/04/01/blockchain/eth/ubantuå®‰è£…swarm-bee/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/eth/ubantu%E5%AE%89%E8%A3%85swarm-bee/","excerpt":"","text":"å®‰è£…swarm-clef å®‰è£… 12wget https://github.com/ethersphere/bee-clef/releases/download/v0.4.9/bee-clef_0.4.9_amd64.debsudo dpkg -i bee-clef_0.4.9_amd64.deb æŸ¥çœ‹çŠ¶æ€ 1systemctl status bee-clef æŸ¥çœ‹æ—¥å¿— 1journalctl -f -u bee-clef.service å®‰è£…swarm-bee å®‰è£… 12wget https://github.com/ethersphere/bee/releases/download/v0.5.3/bee_0.5.3_amd64.debsudo dpkg -i bee_0.5.3_amd64.deb æŸ¥çœ‹çŠ¶æ€ 1systemctl status bee æŸ¥çœ‹æ—¥å¿— 1journalctl --lines=100 --follow --unit bee é—®é¢˜å¤„ç† /var/lib/bee/statestoreç›®å½•æ²¡æœ‰æƒé™ 123456789101112131415161718192021222324Apr 01 08:54:29 localhost systemd[1]: Started Bee - Ethereum Swarm node.Apr 01 08:54:29 localhost bee[2291]: Welcome to the Swarm.... Bzzz Bzzzz BzzzzApr 01 08:54:29 localhost bee[2291]: \\ /Apr 01 08:54:29 localhost bee[2291]: \\ o ^ o /Apr 01 08:54:29 localhost bee[2291]: \\ ( ) /Apr 01 08:54:29 localhost bee[2291]: ____________(%%%%%%%)____________Apr 01 08:54:29 localhost bee[2291]: ( / / )%%%%%%%( \\ \\ )Apr 01 08:54:29 localhost bee[2291]: (___/___/__/ \\__\\___\\___)Apr 01 08:54:29 localhost bee[2291]: ( / /(%%%%%%%)\\ \\ )Apr 01 08:54:29 localhost bee[2291]: (__/___/ (%%%%%%%) \\___\\__)Apr 01 08:54:29 localhost bee[2291]: /( )\\Apr 01 08:54:29 localhost bee[2291]: / (%%%%%) \\Apr 01 08:54:29 localhost bee[2291]: (%%%)Apr 01 08:54:29 localhost bee[2291]: !Apr 01 08:54:29 localhost bee[2291]: time=&quot;2021-04-01T08:54:29Z&quot; level=info msg=&quot;version: 0.5.3-acbd0e2&quot;Apr 01 08:54:29 localhost bee[2291]: time=&quot;2021-04-01T08:54:29Z&quot; level=info msg=&quot;using swarm network address through clef: 25b2df172cc52d4805503dddcae1be83794e68982c9379dab5f318747ebd566f&quot;Apr 01 08:54:29 localhost bee[2291]: time=&quot;2021-04-01T08:54:29Z&quot; level=info msg=&quot;swarm public key 0384432c177666fe00f73142a5361b005bff3ebcc68fafe452730a15382ee79e15&quot;Apr 01 08:54:30 localhost bee[2291]: time=&quot;2021-04-01T08:54:30Z&quot; level=info msg=&quot;pss public key 0281af1ad7e6c9f2062ec25fe2bf889fe38eedb45389b7385298556ae1e5321795&quot;Apr 01 08:54:30 localhost bee[2291]: time=&quot;2021-04-01T08:54:30Z&quot; level=info msg=&quot;using ethereum address 9f2a5a94269f87af2d5219a0f7554f6d0744e2bb&quot;Apr 01 08:54:30 localhost bee[2291]: Error: open /var/lib/bee/statestore/LOCK: permission deniedApr 01 08:54:30 localhost systemd[1]: bee.service: Main process exited, code=exited, status=1/FAILUREApr 01 08:54:30 localhost systemd[1]: bee.service: Failed with result &#x27;exit-code&#x27;.Apr 01 08:54:35 localhost systemd[1]: bee.service: Scheduled restart job, restart counter is at 5.Apr 01 08:54:35 localhost systemd[1]: Stopped Bee - Ethereum Swarm node. æ²¡æœ‰è¶³å¤Ÿçš„ETH åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶æŠ¥é”™è¯´æ²¡æœ‰è¶³å¤Ÿçš„ETHä½œä¸ºgasè´¹ 1cannot continue until there is sufficient ETH (for Gas) available on 9f2a5a94269f87af2d5219a0f7554f6d0744e2bb è§£å†³æ–¹æ¡ˆ æŸ¥çœ‹æ—¥å¿—get your Goerli ETH and Goerli BZZ now via the bzzaar at https://bzz.ethswarm.org/?transaction=buy&amp;amount=10&amp;slippage=30&amp;receiver=0xfb6fe8500a4101196cc80e02f7137a20720fed20 åœ¨Goerliæµ‹è¯•ç½‘ç»œè·å–ä»¥å¤ªå¸ å¸¸ç”¨å‘½ä»¤è®°å½• å¯åŠ¨å’Œåœæ­¢ 1234# å¯åŠ¨# åœæ­¢# é‡å¯sudo systemctl restart bee ä¸Beeäº¤äº’ï¼šçŠ¶æ€æ£€æŸ¥ ä¸»é¡µ 1curl localhost:1633 æ£€æŸ¥è¿è¡Œæ˜¯å¦æ­£å¸¸ 1curl -s http://localhost:1635/health æŸ¥çœ‹å½“å‰beeèŠ‚ç‚¹çš„åœ°å€ 1bee-get-addr 1curl -s localhost:1635/addresses | jq .ethereum æŸ¥çœ‹é“¾æ¥äº†å¤šå°‘ä¸ªpeer 1curl -s http://localhost:1635/peers | jq &#x27;.peers | length&#x27; æŸ¥çœ‹ç½‘ç»œæ‹“æ‰‘ 1curl -X GET http://localhost:1635/topology | jq ä¸Beeäº¤äº’ï¼šä¸Šä¼ æ–‡ä»¶ ä¸Šä¼ æ–‡ä»¶ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªhashå€¼ 12# curl -F file=@bee.jpg http://localhost:1633/files&#123;&quot;reference&quot;:&quot;02a03340405f30c1027b885ee39903fb394ba8909e98029dd6c14371437edafc&quot;&#125; 1curl --data-binary @bee.jpg -H &quot;Content-Type: video/jpg&quot; &quot;http://localhost:1633/files?name=bee.jpg&quot; ä¸‹è½½æ–‡ä»¶ 12curl -OJ http://localhost:1633/files/042d4fe94b946e2cb51196a8c136b8cc335156525bf1ad7e86356c2402291dd4https://gateway.ethswarm.org/files/042d4fe94b946e2cb51196a8c136b8cc335156525bf1ad7e86356c2402291dd4 ç‰¹åˆ«æ³¨æ„ï¼šä¸è¦ä¼ ä¸€äº›é‡è¦æ•°æ®åˆ°swarmé™¤éå·²ç»åŠ å¯†ï¼Œå› ä¸ºä¸Šä¼ ä¸Šå»ä¹‹åçš„æ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯å…¬å¼€çš„ï¼Œåªè¦çŸ¥é“hashå°±èƒ½ä¸‹è½½ã€‚ ä¸Beeäº¤äº’ï¼šä¸Šä¼ æ–‡ä»¶å¤¹ æ¯”å¦‚æœ‰ä¸€ä¸ªå‰ç«¯vueé¡¹ç›®ï¼Œéœ€è¦ä¸Šä¼ åˆ°swarm éœ€è¦æŠŠé¡¹ç›®æ„å»ºä¸€ä¸‹npm run build æŠŠéœ€è¦ä¸Šä¼ çš„æ–‡ä»¶å¤¹distæ‰“åŒ… 12345curl \\ -X POST \\ -H &quot;Content-Type: application/x-tar&quot; \\ -H &quot;Swarm-Index-Document: index.html&quot; \\ --data-binary @hello-swarm.tar http://localhost:1633/dirs ä¸Beeäº¤äº’ï¼šæ”¯ç¥¨ä¿¡æ¯ æŸ¥è¯¢å½“å‰beeèŠ‚ç‚¹çš„ä½™é¢ 1curl localhost:1635/chequebook/balance | jq æŸ¥çœ‹æ¯ä¸ªèŠ‚ç‚¹ï¼ˆå½“å‰beeèŠ‚ç‚¹è¿æ¥çš„ï¼‰çš„ä½™é¢ 1curl localhost:1635/balances | jq æŸ¥çœ‹ç»“ç®—ä¿¡æ¯ 1curl localhost:1635/settlements | jq æŸ¥çœ‹æ”¯ç¥¨ä¿¡æ¯ 1curl localhost:1635/chequebook/cheque | jq æ”¯ç¥¨å…‘æ¢(åœ°å€æ˜¯ä¸Šä¸€ä¸ªå‘½ä»¤ä¸­æ˜¾ç¤ºçš„åœ°å€) 1curl -XPOST http://localhost:1635/chequebook/cashout/d7881307e793e389642ea733451db368c4c9b9e23f188cca659c8674d183a56b æŸ¥çœ‹æ”¯ç¥¨çš„å…‘æ¢çŠ¶æ€ 1curl http://localhost:1635/chequebook/cashout/d7881307e793e389642ea733451db368c4c9b9e23f188cca659c8674d183a56b | jq gBZZæç° 1curl -XPOST http://localhost:1635/chequebook/withdraw\\?amount\\=1000 | jq ç®¡ç†æ”¯ç¥¨ ä¸‹è½½å®˜æ–¹çš„è„šæœ¬ 1wget -O cashout.sh https://gist.githubusercontent.com/ralph-pichler/3b5ccd7a5c5cd0500e6428752b37e975/raw/7ba05095e0836735f4a648aefe52c584e18e065f/cashout.sh æ·»åŠ å¯æ‰§è¡Œæƒé™ 1chmod +x cashout.sh åˆ—å‡ºæ‰€æœ‰çš„æ²¡æœ‰å…‘æ¢çš„æ”¯ç¥¨ä¿¡æ¯ 1./cashout.sh å½“è¶…è¿‡5BZZæ—¶å…‘æ¢æ‰€æœ‰æ”¯ç¥¨ï¼š 1./cashout.sh cashout-all 5 æ–‡ä»¶è·¯å¾„ Bee-clef# Configuration files are stored in /etc/bee-clef/ Key material and other data is stored in /var/lib/bee-clef/ 1ll /var/lib/bee-clef/ Bee# Configuration files are stored in /etc/bee/ State, chunks and other data is stored in /var/lib/bee/ 1sudo vi /etc/bee/bee.yaml","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"ethereum","slug":"åŒºå—é“¾/ethereum","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/ethereum/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"ethereum","slug":"ethereum","permalink":"https://guozhe001.github.io/tags/ethereum/"},{"name":"swarm","slug":"swarm","permalink":"https://guozhe001.github.io/tags/swarm/"}]},{"title":"","slug":"blockchain/eth/ubantuç³»ç»Ÿå®‰è£…go-ethereumå®¢æˆ·ç«¯","date":"2021-04-01T10:18:57.780Z","updated":"2021-04-01T10:18:57.780Z","comments":true,"path":"2021/04/01/blockchain/eth/ubantuç³»ç»Ÿå®‰è£…go-ethereumå®¢æˆ·ç«¯/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/eth/ubantu%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85go-ethereum%E5%AE%A2%E6%88%B7%E7%AB%AF/","excerpt":"","text":"å¦‚ä½•åœ¨ubantuä¸Šå¯åŠ¨go-ethereumå®¢æˆ·ç«¯ ç¯å¢ƒå‡†å¤‡ å®‰è£…git:sudo apt install git å®‰è£…go:sudo apt install golang-go go-ethereumï¼ˆGethï¼‰å®¢æˆ·ç«¯ä¸‹è½½å’Œç¼–è¯‘ cloneæºç ï¼š 1https://gitee.com/guozhe001/go-ethereum.git ä»æºç æ„å»ºgeth éœ€è¦ç§‘å­¦ä¸Šç½‘ 12cd go-ethereummake geth ç¼–è¯‘ç»“æœå¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530env GO111MODULE=on go run build/ci.go install ./cmd/geth&gt;&gt;&gt; /usr/lib/go-1.13/bin/go build -ldflags -X main.gitCommit=54c0d573d75ab9baa239db3f071d6cb4d1ec6aad -X main.gitDate=20210325 -trimpath -v -o /home/guozhe/code/go-ethereum/build/bin/geth ./cmd/gethgo: downloading github.com/holiman/uint256 v1.1.1go: downloading github.com/peterh/liner v1.1.1-0.20190123174540-a2c9a5303de7go: downloading golang.org/x/sys v0.0.0-20210124154548-22da62e12c0cgo: downloading github.com/edsrzf/mmap-go v1.0.0go: downloading github.com/prometheus/tsdb v0.7.1go: downloading github.com/hashicorp/golang-lru v0.5.5-0.20210104140557-80c98217689dgo: downloading github.com/golang/protobuf v1.4.3go: downloading github.com/holiman/bloomfilter/v2 v2.0.3go: downloading github.com/rs/cors v1.7.0go: downloading github.com/tyler-smith/go-bip39 v1.0.1-0.20181017060643-dbb3b84ba2efgo: extracting github.com/rs/cors v1.7.0go: downloading github.com/olekukonko/tablewriter v0.0.2-0.20190409134802-7e037d187b0cgo: extracting github.com/edsrzf/mmap-go v1.0.0go: extracting github.com/holiman/uint256 v1.1.1go: downloading github.com/karalabe/usb v0.0.0-20190919080040-51dc0efba356go: extracting github.com/golang/protobuf v1.4.3go: downloading github.com/golang/snappy v0.0.3-0.20201103224600-674baa8c7fc3go: extracting golang.org/x/sys v0.0.0-20210124154548-22da62e12c0cgo: downloading github.com/status-im/keycard-go v0.0.0-20190316090335-8537d3370df4go: extracting github.com/prometheus/tsdb v0.7.1go: downloading github.com/deckarep/golang-set v0.0.0-20180603214616-504e848d77eago: extracting github.com/peterh/liner v1.1.1-0.20190123174540-a2c9a5303de7go: downloading github.com/rjeczalik/notify v0.9.1go: extracting github.com/tyler-smith/go-bip39 v1.0.1-0.20181017060643-dbb3b84ba2efgo: downloading golang.org/x/text v0.3.3go: extracting github.com/hashicorp/golang-lru v0.5.5-0.20210104140557-80c98217689dgo: downloading github.com/naoina/go-stringutil v0.1.0go: downloading google.golang.org/protobuf v1.23.0go: extracting github.com/holiman/bloomfilter/v2 v2.0.3go: downloading github.com/dop251/goja v0.0.0-20200721192441-a695b0cdd498go: extracting github.com/olekukonko/tablewriter v0.0.2-0.20190409134802-7e037d187b0cgo: downloading github.com/syndtr/goleveldb v1.0.1-0.20210305035536-64b5b1c73954go: extracting github.com/karalabe/usb v0.0.0-20190919080040-51dc0efba356go: downloading github.com/pkg/errors v0.8.1go: extracting github.com/golang/snappy v0.0.3-0.20201103224600-674baa8c7fc3go: downloading github.com/mattn/go-isatty v0.0.5-0.20180830101745-3fb116b82035go: extracting github.com/status-im/keycard-go v0.0.0-20190316090335-8537d3370df4go: downloading github.com/shirou/gopsutil v2.20.5+incompatiblego: extracting github.com/deckarep/golang-set v0.0.0-20180603214616-504e848d77eago: extracting github.com/rjeczalik/notify v0.9.1go: downloading github.com/davecgh/go-spew v1.1.1go: extracting github.com/naoina/go-stringutil v0.1.0go: downloading github.com/huin/goupnp v1.0.1-0.20210310174557-0ca763054c88go: extracting google.golang.org/protobuf v1.23.0go: downloading github.com/fatih/color v1.7.0go: extracting github.com/syndtr/goleveldb v1.0.1-0.20210305035536-64b5b1c73954go: downloading github.com/graph-gophers/graphql-go v0.0.0-20201113091052-beb923fada29go: extracting github.com/dop251/goja v0.0.0-20200721192441-a695b0cdd498go: downloading github.com/jackpal/go-nat-pmp v1.0.2-0.20160603034137-1fa385a6f458go: extracting github.com/pkg/errors v0.8.1go: extracting github.com/davecgh/go-spew v1.1.1go: downloading github.com/jedisct1/go-minisign v0.0.0-20190909160543-45766022959ego: extracting github.com/mattn/go-isatty v0.0.5-0.20180830101745-3fb116b82035go: extracting github.com/huin/goupnp v1.0.1-0.20210310174557-0ca763054c88go: downloading github.com/google/uuid v1.1.5go: downloading github.com/go-sourcemap/sourcemap v2.1.2+incompatiblego: extracting github.com/shirou/gopsutil v2.20.5+incompatiblego: downloading github.com/go-stack/stack v1.8.0go: extracting github.com/fatih/color v1.7.0go: downloading golang.org/x/net v0.0.0-20200822124328-c89045814202go: extracting github.com/graph-gophers/graphql-go v0.0.0-20201113091052-beb923fada29go: extracting github.com/jackpal/go-nat-pmp v1.0.2-0.20160603034137-1fa385a6f458go: downloading gopkg.in/olebedev/go-duktape.v3 v3.0.0-20200619000410-60c24ae608a6go: extracting github.com/jedisct1/go-minisign v0.0.0-20190909160543-45766022959ego: downloading github.com/mattn/go-runewidth v0.0.4go: extracting github.com/go-sourcemap/sourcemap v2.1.2+incompatiblego: downloading github.com/opentracing/opentracing-go v1.1.0go: extracting golang.org/x/text v0.3.3go: extracting github.com/google/uuid v1.1.5go: downloading github.com/gorilla/websocket v1.4.2go: downloading github.com/VictoriaMetrics/fastcache v1.5.7go: downloading github.com/dlclark/regexp2 v1.2.0go: downloading github.com/influxdata/influxdb v1.8.3go: extracting github.com/go-stack/stack v1.8.0go: extracting golang.org/x/net v0.0.0-20200822124328-c89045814202go: downloading golang.org/x/sync v0.0.0-20200317015054-43a5402ce75ago: extracting gopkg.in/olebedev/go-duktape.v3 v3.0.0-20200619000410-60c24ae608a6go: extracting github.com/VictoriaMetrics/fastcache v1.5.7go: downloading github.com/cespare/xxhash v1.1.0go: extracting github.com/opentracing/opentracing-go v1.1.0go: extracting github.com/gorilla/websocket v1.4.2go: extracting github.com/dlclark/regexp2 v1.2.0go: extracting github.com/mattn/go-runewidth v0.0.4go: extracting golang.org/x/sync v0.0.0-20200317015054-43a5402ce75ago: extracting github.com/cespare/xxhash v1.1.0go: downloading github.com/cespare/xxhash/v2 v2.1.1go: extracting github.com/cespare/xxhash/v2 v2.1.1go: extracting github.com/influxdata/influxdb v1.8.3go: finding gopkg.in/urfave/cli.v1 v1.20.0go: finding github.com/peterh/liner v1.1.1-0.20190123174540-a2c9a5303de7go: finding github.com/dop251/goja v0.0.0-20200721192441-a695b0cdd498go: finding github.com/VictoriaMetrics/fastcache v1.5.7go: finding github.com/davecgh/go-spew v1.1.1go: finding github.com/deckarep/golang-set v0.0.0-20180603214616-504e848d77eago: finding github.com/jedisct1/go-minisign v0.0.0-20190909160543-45766022959ego: finding github.com/go-stack/stack v1.8.0go: finding github.com/edsrzf/mmap-go v1.0.0go: finding github.com/fjl/memsize v0.0.0-20190710130421-bcb5799ab5e5go: finding github.com/shirou/gopsutil v2.20.5+incompatiblego: finding github.com/naoina/toml v0.1.2-0.20170918210437-9fafd6967416go: finding github.com/mattn/go-colorable v0.1.0go: finding github.com/mattn/go-isatty v0.0.5-0.20180830101745-3fb116b82035go: finding github.com/holiman/bloomfilter/v2 v2.0.3go: finding github.com/fatih/color v1.7.0go: finding github.com/golang/protobuf v1.4.3go: finding github.com/golang/snappy v0.0.3-0.20201103224600-674baa8c7fc3go: finding github.com/cespare/xxhash/v2 v2.1.1go: finding github.com/syndtr/goleveldb v1.0.1-0.20210305035536-64b5b1c73954go: finding github.com/olekukonko/tablewriter v0.0.2-0.20190409134802-7e037d187b0cgo: finding github.com/hashicorp/golang-lru v0.5.5-0.20210104140557-80c98217689dgo: finding github.com/naoina/go-stringutil v0.1.0go: finding github.com/dlclark/regexp2 v1.2.0go: finding github.com/prometheus/tsdb v0.7.1go: finding golang.org/x/sys v0.0.0-20210124154548-22da62e12c0cgo: finding github.com/google/uuid v1.1.5go: finding github.com/karalabe/usb v0.0.0-20190919080040-51dc0efba356go: finding github.com/rjeczalik/notify v0.9.1go: finding github.com/mattn/go-runewidth v0.0.4go: finding github.com/go-sourcemap/sourcemap v2.1.2+incompatiblego: finding github.com/pkg/errors v0.8.1go: finding golang.org/x/text v0.3.3go: finding github.com/holiman/uint256 v1.1.1go: finding github.com/gballet/go-libpcsclite v0.0.0-20190607065134-2772fd86a8ffgo: finding github.com/gorilla/websocket v1.4.2go: finding github.com/status-im/keycard-go v0.0.0-20190316090335-8537d3370df4go: finding github.com/rs/cors v1.7.0go: finding github.com/tyler-smith/go-bip39 v1.0.1-0.20181017060643-dbb3b84ba2efgo: finding google.golang.org/protobuf v1.23.0go: finding github.com/huin/goupnp v1.0.1-0.20210310174557-0ca763054c88go: finding github.com/jackpal/go-nat-pmp v1.0.2-0.20160603034137-1fa385a6f458go: finding github.com/influxdata/influxdb v1.8.3go: finding github.com/graph-gophers/graphql-go v0.0.0-20201113091052-beb923fada29go: finding golang.org/x/time v0.0.0-20190308202827-9d24e82272b4go: finding gopkg.in/olebedev/go-duktape.v3 v3.0.0-20200619000410-60c24ae608a6go: finding golang.org/x/net v0.0.0-20200822124328-c89045814202go: finding golang.org/x/sync v0.0.0-20200317015054-43a5402ce75ago: finding github.com/opentracing/opentracing-go v1.1.0unicodeunicode/utf8vendor/golang.org/x/crypto/cryptobyte/asn1crypto/internal/subtlemath/bitsgolang.org/x/sys/internal/unsafeheadercontainer/listinternal/nettracevendor/golang.org/x/crypto/internal/subtleencodinggolang.org/x/net/html/atomcrypto/subtleruntime/internal/sysgolang.org/x/text/encoding/internal/identifiergolang.org/x/text/internal/utf8internalruntime/cgogoogle.golang.org/protobuf/internal/flagsunicode/utf16runtime/internal/atomiccontainer/ringvendor/golang.org/x/crypto/curve25519internal/raceinternal/cpugoogle.golang.org/protobuf/internal/fieldnumsync/atomicgoogle.golang.org/protobuf/internal/gennamegithub.com/ethereum/go-ethereum/internal/web3extruntime/internal/mathinternal/testloggoogle.golang.org/protobuf/internal/setinternal/bytealgmathruntimeinternal/reflectlitesyncgoogle.golang.org/protobuf/internal/pragmainternal/singleflightmath/randerrorssortinternal/oserroriogithub.com/ethereum/go-ethereum/common/bitutilgithub.com/hashicorp/golang-lru/simplelruvendor/golang.org/x/net/dns/dnsmessagestrconvsyscallcontainer/heapgolang.org/x/text/internal/tagbyteshashgithub.com/ethereum/go-ethereum/ethdbcrypto/internal/randutilstringstext/tabwritergithub.com/go-sourcemap/sourcemap/internal/base64vlqcrypto/hmachash/fnvhash/crc32golang.org/x/crypto/pbkdf2vendor/golang.org/x/crypto/hkdfgolang.org/x/crypto/hkdfcrypto/rc4github.com/dop251/goja/tokencryptoreflectgolang.org/x/crypto/ripemd160github.com/syndtr/goleveldb/leveldb/comparergolang.org/x/text/transformvendor/golang.org/x/text/transformbufiopathgithub.com/influxdata/influxdb/pkg/escapeencoding/base32htmlregexp/syntaxgolang.org/x/text/runesgolang.org/x/text/encodinggolang.org/x/text/encoding/internalgolang.org/x/text/encoding/unicodegolang.org/x/text/encoding/charmapgolang.org/x/text/encoding/japanesegolang.org/x/text/encoding/traditionalchinesegolang.org/x/text/encoding/koreangolang.org/x/text/encoding/simplifiedchinesegithub.com/ethereum/go-ethereum/common/fdlimitinternal/syscall/unixgithub.com/mattn/go-isattytimeregexpcontextgithub.com/naoina/toml/astgithub.com/ethereum/go-ethereum/common/mclockinternal/pollgithub.com/ethereum/go-ethereum/common/prquegolang.org/x/sync/errgrouposinternal/fmtsortencoding/binarycrypto/md5github.com/cespare/xxhash/v2encoding/base64crypto/sha1crypto/sha256golang.org/x/crypto/sha3crypto/ciphervendor/golang.org/x/crypto/poly1305crypto/sha512crypto/ed25519/internal/edwards25519github.com/golang/snappyvendor/golang.org/x/sys/cpugolang.org/x/sys/unixfmtruntime/debugpath/filepathgithub.com/mattn/go-runewidthos/signalgoogle.golang.org/protobuf/internal/detrandgithub.com/mattn/go-colorablenetencoding/pemcrypto/aescrypto/desvendor/golang.org/x/crypto/internal/chacha20golang.org/x/crypto/scryptio/ioutilos/execvendor/golang.org/x/crypto/chacha20poly1305golang.org/x/sys/cpudatabase/sql/driverencoding/jsonencoding/hexgithub.com/ethereum/go-ethereum/eventgithub.com/go-stack/stacklognet/urlgithub.com/VictoriaMetrics/fastcachegithub.com/syndtr/goleveldb/leveldb/utilmath/biggithub.com/syndtr/goleveldb/leveldb/storageencoding/csvgithub.com/pkg/errorscompress/flategithub.com/hashicorp/golang-lruvendor/golang.org/x/net/http2/hpackencoding/gobmimemime/quotedprintableflagvendor/golang.org/x/text/unicode/normnet/http/internalgithub.com/peterh/linervendor/golang.org/x/text/unicode/bidigithub.com/olekukonko/tablewritergithub.com/ethereum/go-ethereum/crypto/blake2bencoding/xmlgolang.org/x/net/htmlgolang.org/x/text/internal/languagegithub.com/syndtr/goleveldb/leveldb/cachegithub.com/syndtr/goleveldb/leveldb/filtergithub.com/status-im/keycard-go/derivationpathgolang.org/x/text/unicode/normgoogle.golang.org/protobuf/internal/errorsgo/tokengoogle.golang.org/protobuf/internal/versiongithub.com/karalabe/usbgoogle.golang.org/protobuf/encoding/protowiregithub.com/davecgh/go-spew/spewgithub.com/syndtr/goleveldb/leveldb/errorsgithub.com/shirou/gopsutil/internal/commongoogle.golang.org/protobuf/reflect/protoreflectgithub.com/tyler-smith/go-bip39/wordlistsgithub.com/syndtr/goleveldb/leveldb/iteratorgithub.com/syndtr/goleveldb/leveldb/journalgithub.com/syndtr/goleveldb/leveldb/optcompress/gzipgithub.com/fjl/memsizevendor/golang.org/x/text/secure/bidiruletext/template/parseruntime/traceos/usergithub.com/ethereum/go-ethereum/console/promptgolang.org/x/time/rateruntime/pprofgithub.com/ethereum/go-ethereum/eth/tracers/internal/tracersgolang.org/x/text/internal/language/compactgo/scannergithub.com/graph-gophers/graphql-go/errorsgithub.com/syndtr/goleveldb/leveldb/memdbgithub.com/syndtr/goleveldb/leveldb/tabletestingtext/scannergithub.com/graph-gophers/graphql-go/loggithub.com/opentracing/opentracing-go/loggithub.com/rjeczalik/notifygithub.com/prometheus/tsdb/fileutilgithub.com/edsrzf/mmap-gogo/astgoogle.golang.org/protobuf/reflect/protoregistrygolang.org/x/text/languagegoogle.golang.org/protobuf/internal/strsgoogle.golang.org/protobuf/internal/mapsortgoogle.golang.org/protobuf/internal/fieldsortgithub.com/huin/goupnp/scpdvendor/golang.org/x/net/idnagoogle.golang.org/protobuf/runtime/protoifacegoogle.golang.org/protobuf/internal/descfmtgithub.com/deckarep/golang-setgithub.com/shirou/gopsutil/cpugoogle.golang.org/protobuf/internal/encoding/textgoogle.golang.org/protobuf/internal/descoptsgithub.com/graph-gophers/graphql-go/internal/commongithub.com/influxdata/influxdb/modelsgithub.com/dlclark/regexp2/syntaxgithub.com/syndtr/goleveldb/leveldbgithub.com/dop251/goja/filegithub.com/go-sourcemap/sourcemapgithub.com/fatih/colorgithub.com/ethereum/go-ethereum/internal/jsre/depsgoogle.golang.org/protobuf/internal/encoding/messagesetgithub.com/naoina/go-stringutilgithub.com/shirou/gopsutil/memtext/templategithub.com/ethereum/go-ethereum/common/hexutilcrypto/ellipticencoding/asn1crypto/randgithub.com/ethereum/go-ethereum/common/mathgithub.com/ethereum/go-ethereum/rlpcrypto/dsagithub.com/holiman/uint256google.golang.org/protobuf/protogithub.com/graph-gophers/graphql-go/internal/schemagithub.com/graph-gophers/graphql-go/internal/querygolang.org/x/text/encoding/htmlindexgithub.com/dop251/goja/astgolang.org/x/text/internalgo/parsergo/printergoogle.golang.org/protobuf/internal/encoding/defvalgolang.org/x/text/internal/colltabgithub.com/holiman/bloomfilter/v2crypto/ed25519crypto/rsagithub.com/ethereum/go-ethereum/crypto/bn256/cloudflaregithub.com/tyler-smith/go-bip39golang.org/x/net/html/charsetgithub.com/graph-gophers/graphql-go/internal/exec/packergithub.com/graph-gophers/graphql-go/introspectiongithub.com/graph-gophers/graphql-go/internal/validationgithub.com/dop251/goja/parsergolang.org/x/text/casesgolang.org/x/crypto/ed25519crypto/x509/pkixgithub.com/ethereum/go-ethereum/commonvendor/golang.org/x/crypto/cryptobytegithub.com/naoina/tomlgopkg.in/urfave/cli.v1html/templatecrypto/ecdsagithub.com/ethereum/go-ethereum/crypto/secp256k1github.com/jedisct1/go-minisigngithub.com/graph-gophers/graphql-go/internal/exec/resolvablegithub.com/dlclark/regexp2golang.org/x/text/collatego/formatgithub.com/ethereum/go-ethereum/les/vfluxgoogle.golang.org/protobuf/encoding/prototextgoogle.golang.org/protobuf/internal/filedescgithub.com/graph-gophers/graphql-go/internal/exec/selectedgithub.com/ethereum/go-ethereum/ethdb/memorydbgithub.com/ethereum/go-ethereum/crypto/bls12381github.com/ethereum/go-ethereum/crypto/bn256google.golang.org/protobuf/internal/encoding/taggoogle.golang.org/protobuf/internal/impllog/syslogvendor/golang.org/x/net/http/httpproxygithub.com/ethereum/go-ethereum/p2p/enrgithub.com/jackpal/go-nat-pmpgithub.com/ethereum/go-ethereum/p2p/netutilnet/textprotogithub.com/gballet/go-libpcsclitegithub.com/google/uuidcrypto/x509gopkg.in/olebedev/go-duktape.v3github.com/ethereum/go-ethereum/logvendor/golang.org/x/net/http/httpgutsmime/multipartgithub.com/ethereum/go-ethereum/signer/storagegithub.com/ethereum/go-ethereum/les/flowcontrolgithub.com/ethereum/go-ethereum/metricscrypto/tlsgithub.com/ethereum/go-ethereum/ethdb/leveldbgoogle.golang.org/protobuf/internal/filetypegithub.com/dop251/gojagoogle.golang.org/protobuf/runtime/protoimplgithub.com/golang/protobuf/protogoogle.golang.org/protobuf/types/descriptorpbnet/http/httptracenet/httpgithub.com/golang/protobuf/protoc-gen-go/descriptorgithub.com/ethereum/go-ethereum/accounts/usbwallet/trezorgithub.com/fjl/memsize/memsizeuigithub.com/ethereum/go-ethereum/metrics/prometheusgithub.com/rs/corsexpvargithub.com/influxdata/influxdb/clientnet/http/pprofgithub.com/huin/goupnp/soapgithub.com/huin/goupnp/httpugithub.com/opentracing/opentracing-gogithub.com/gorilla/websocketgithub.com/opentracing/opentracing-go/extgithub.com/ethereum/go-ethereum/metrics/expgithub.com/graph-gophers/graphql-go/tracegithub.com/huin/goupnp/ssdpgithub.com/ethereum/go-ethereum/metrics/influxdbgithub.com/graph-gophers/graphql-go/internal/execgithub.com/ethereum/go-ethereum/internal/debuggithub.com/huin/goupnpgithub.com/graph-gophers/graphql-gogithub.com/ethereum/go-ethereum/rpcgithub.com/huin/goupnp/dcps/internetgateway1github.com/huin/goupnp/dcps/internetgateway2github.com/ethereum/go-ethereum/internal/jsregithub.com/ethereum/go-ethereum/p2p/natgithub.com/ethereum/go-ethereum/cryptogithub.com/ethereum/go-ethereum/crypto/eciesgithub.com/ethereum/go-ethereum/p2p/enodegithub.com/ethereum/go-ethereum/paramsgithub.com/ethereum/go-ethereum/accounts/abigithub.com/ethereum/go-ethereum/p2p/rlpxgithub.com/ethereum/go-ethereum/internal/flagsgithub.com/ethereum/go-ethereum/core/typesgithub.com/ethereum/go-ethereum/p2p/discover/v4wiregithub.com/ethereum/go-ethereum/les/utilsgithub.com/ethereum/go-ethereum/p2p/dnsdiscgithub.com/ethereum/go-ethereum/p2p/nodestategithub.com/ethereum/go-ethereum/p2p/discover/v5wiregithub.com/ethereum/go-ethereum/les/vflux/clientgithub.com/ethereum/go-ethereum/les/vflux/servergithub.com/ethereum/go-ethereumgithub.com/ethereum/go-ethereum/eth/gaspricegithub.com/ethereum/go-ethereum/core/forkidgithub.com/ethereum/go-ethereum/core/bloombitsgithub.com/ethereum/go-ethereum/core/rawdbgithub.com/ethereum/go-ethereum/core/vmgithub.com/ethereum/go-ethereum/p2p/discovergithub.com/ethereum/go-ethereum/accountsgithub.com/ethereum/go-ethereum/ethclientgithub.com/ethereum/go-ethereum/accounts/scwalletgithub.com/ethereum/go-ethereum/accounts/keystoregithub.com/ethereum/go-ethereum/accounts/usbwalletgithub.com/ethereum/go-ethereum/p2pgithub.com/ethereum/go-ethereum/consolegithub.com/ethereum/go-ethereum/triegithub.com/ethereum/go-ethereum/core/state/snapshotgithub.com/ethereum/go-ethereum/core/stategithub.com/ethereum/go-ethereum/consensusgithub.com/ethereum/go-ethereum/consensus/miscgithub.com/ethereum/go-ethereum/core/state/prunergithub.com/ethereum/go-ethereum/consensus/cliquegithub.com/ethereum/go-ethereum/consensus/ethashgithub.com/ethereum/go-ethereum/coregithub.com/ethereum/go-ethereum/eth/filtersgithub.com/ethereum/go-ethereum/eth/protocols/ethgithub.com/ethereum/go-ethereum/eth/fetchergithub.com/ethereum/go-ethereum/lightgithub.com/ethereum/go-ethereum/eth/protocols/snapgithub.com/ethereum/go-ethereum/eth/downloadergithub.com/ethereum/go-ethereum/minergithub.com/ethereum/go-ethereum/internal/ethapigithub.com/ethereum/go-ethereum/signer/coregithub.com/ethereum/go-ethereum/accounts/externalgithub.com/ethereum/go-ethereum/nodegithub.com/ethereum/go-ethereum/accounts/abi/bindgithub.com/ethereum/go-ethereum/contracts/checkpointoracle/contractgithub.com/ethereum/go-ethereum/accounts/abi/bind/backendsgithub.com/ethereum/go-ethereum/contracts/checkpointoraclegithub.com/ethereum/go-ethereum/eth/ethconfiggithub.com/ethereum/go-ethereum/graphqlgithub.com/ethereum/go-ethereum/les/checkpointoraclegithub.com/ethereum/go-ethereum/ethgithub.com/ethereum/go-ethereum/lesgithub.com/ethereum/go-ethereum/ethstatsgithub.com/ethereum/go-ethereum/eth/tracersgithub.com/ethereum/go-ethereum/cmd/utilsgithub.com/ethereum/go-ethereum/cmd/gethDone building.Run &quot;./build/bin/geth&quot; to launch geth. é€šè¿‡æŸ¥çœ‹gethç‰ˆæœ¬æ¥ç¡®è®¤gethæ˜¯å¦å·²ç»å®‰è£…æ­£ç¡®ï¼š 12345678910$ ./build/bin/geth versionGethVersion: 1.10.2-unstableGit Commit: 54c0d573d75ab9baa239db3f071d6cb4d1ec6aadGit Commit Date: 20210325Architecture: amd64Go Version: go1.13.8Operating System: linuxGOPATH=GOROOT=go é¦–æ¬¡åŒæ­¥ä»¥å¤ªåŠåŒºå—æ•°æ® æŸ¥çœ‹go-ethereumçš„readmeæ–‡æ¡£ï¼Œé»˜è®¤æ˜¯fastæ–¹å¼åŒæ­¥æ•°æ®ï¼Œç›´æ¥è¿è¡Œgeth consoleå³å¯ï¼Œå› ä¸ºæ•°æ®æ¯”è¾ƒå¤§æˆ‘å•ç‹¬æŒ‚è½½äº†ä¸€ä¸ªç£ç›˜ï¼Œæ‰€ä»¥åˆ¶å®šäº†æ•°æ®å­˜æ”¾çš„ç›®å½•--datadic /data/ethereum/node 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354$ ./build/bin/geth console --datadir /data/ethereum/node/INFO [03-27|16:25:39.409] Starting Geth on Ethereum mainnet... INFO [03-27|16:25:39.409] Bumping default cache on mainnet provided=1024 updated=4096INFO [03-27|16:25:39.411] Maximum peer count ETH=50 LES=0 total=50INFO [03-27|16:25:39.411] Smartcard socket not found, disabling err=&quot;stat /run/pcscd/pcscd.comm: no such file or directory&quot;INFO [03-27|16:25:39.412] Set global gas cap cap=25000000INFO [03-27|16:25:39.412] Allocated trie memory caches clean=614.00MiB dirty=1024.00MiBINFO [03-27|16:25:39.412] Allocated cache and file handles database=/data/ethereum/node/geth/chaindata cache=2.00GiB handles=524288INFO [03-27|16:25:39.504] Opened ancient database database=/data/ethereum/node/geth/chaindata/ancient readonly=falseINFO [03-27|16:25:39.504] Writing default main-net genesis block INFO [03-27|16:25:39.645] Persisted trie from memory database nodes=12356 size=1.78MiB time=48.710818ms gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00BINFO [03-27|16:25:39.645] Initialised chain configuration config=&quot;&#123;ChainID: 1 Homestead: 1150000 DAO: 1920000 DAOSupport: true EIP150: 2463000 EIP155: 2675000 EIP158: 2675000 Byzantium: 4370000 Constantinople: 7280000 Petersburg: 7280000 Istanbul: 9069000, Muir Glacier: 9200000, Berlin: 12244000, YOLO v3: &lt;nil&gt;, Engine: ethash&#125;&quot;INFO [03-27|16:25:39.645] Disk storage enabled for ethash caches dir=/data/ethereum/node/geth/ethash count=3INFO [03-27|16:25:39.645] Disk storage enabled for ethash DAGs dir=/home/guozhe/.ethash count=2INFO [03-27|16:25:39.646] Initialising Ethereum protocol network=1 dbversion=&lt;nil&gt;WARN [03-27|16:25:39.646] Upgrade blockchain database version from=&lt;nil&gt; to=8INFO [03-27|16:25:39.646] Loaded most recent local header number=0 hash=&quot;d4e567â€¦cb8fa3&quot; td=17179869184 age=51y11mo3wINFO [03-27|16:25:39.646] Loaded most recent local full block number=0 hash=&quot;d4e567â€¦cb8fa3&quot; td=17179869184 age=51y11mo3wINFO [03-27|16:25:39.646] Loaded most recent local fast block number=0 hash=&quot;d4e567â€¦cb8fa3&quot; td=17179869184 age=51y11mo3wWARN [03-27|16:25:39.646] Failed to load snapshot, regenerating err=&quot;missing or corrupted snapshot&quot;INFO [03-27|16:25:39.646] Rebuilding state snapshot INFO [03-27|16:25:39.646] Deleted state snapshot leftovers kind=accounts wiped=0 elapsed=&quot;47.755Âµs&quot;INFO [03-27|16:25:39.647] Deleted state snapshot leftovers kind=storage wiped=0 elapsed=&quot;17.809Âµs&quot;INFO [03-27|16:25:39.647] Compacting snapshot account area INFO [03-27|16:25:39.647] Regenerated local transaction journal transactions=0 accounts=0INFO [03-27|16:25:39.650] Wiper running, state snapshotting paused accounts=0 slots=0 storage=0.00B elapsed=&quot;361.935Âµs&quot;INFO [03-27|16:25:39.676] Allocated fast sync bloom size=2.00GiBWARN [03-27|16:25:39.677] Error reading unclean shutdown markers error=&quot;leveldb: not found&quot;INFO [03-27|16:25:39.677] Starting peer-to-peer node instance=Geth/v1.10.2-unstable-54c0d573-20210325/linux-amd64/go1.13.8INFO [03-27|16:25:39.741] Initialized state bloom items=12356 errorrate=0.000 elapsed=64.036msINFO [03-27|16:25:39.817] New local node record seq=1 id=0d81eb9b177ba542 ip=127.0.0.1 udp=30303 tcp=30303INFO [03-27|16:25:39.817] Started P2P networking self=enode://dbb9a7d3a1ca59a200c1fa920b2cc467c342182b0f818c491028da1c564391f2cb91f0ce88bb7826264e609aa407dd8544224c0dd3d1a3f6bc449fd063dbdde7@127.0.0.1:30303INFO [03-27|16:25:39.818] IPC endpoint opened url=/data/ethereum/node/geth.ipcWARN [03-27|16:25:39.858] Served eth_coinbase reqid=3 t=&quot;12.338Âµs&quot; err=&quot;etherbase must be explicitly specified&quot;Welcome to the Geth JavaScript console!instance: Geth/v1.10.2-unstable-54c0d573-20210325/linux-amd64/go1.13.8at block: 0 (Thu Jan 01 1970 08:00:00 GMT+0800 (CST)) datadir: /data/ethereum/node modules: admin:1.0 debug:1.0 eth:1.0 ethash:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0To exit, press ctrl-d&gt; INFO [03-27|16:25:39.924] Compacting snapshot storage area INFO [03-27|16:25:39.924] Compacted snapshot area in database elapsed=277.624msINFO [03-27|16:25:39.924] Resuming state snapshot generation root=&quot;d7f897â€¦0f0544&quot; accounts=0 slots=0 storage=0.00B elapsed=&quot;9.119Âµs&quot;INFO [03-27|16:25:39.996] Generated state snapshot accounts=8893 slots=0 storage=409.64KiB elapsed=71.524msINFO [03-27|16:25:46.015] New local node record seq=2 id=0d81eb9b177ba542 ip=115.171.250.78 udp=52360 tcp=30303INFO [03-27|16:25:50.847] Looking for peers peercount=0 tried=8 static=0INFO [03-27|16:25:56.124] Block synchronisation started INFO [03-27|16:26:01.068] Looking for peers peercount=0 tried=4 static=0WARN [03-27|16:26:05.414] Dropping unsynced node during sync id=46e8efbdd811cf2e conn=dyndial addr=207.148.3.150:30303 type=Geth/v1.9.25-stable-...INFO [03-27|16:26:11.068] Looking for peers peercount=2 tried=15 static=0WARN [03-27|16:26:12.135] Dropping unsynced node during sync id=53455744030e83cc conn=dyndial addr=108.61.176.254:30303 type=Geth/v1.9.25-stable-... æŸ¥çœ‹/data/ethereum/nodeç›®å½• 123456$ llæ€»ç”¨é‡ 1drwxrwxrwx 1 root root 472 3æœˆ 27 16:28 geth/srwxrwxrwx 1 root root 1 3æœˆ 27 16:25 geth.ipc=drwxrwxrwx 1 root root 0 3æœˆ 27 16:25 keystore/ è°ƒç”¨gethçš„json-rpcæ¥å£ 1curl -X POST -H &quot;Content-Type: application/json&quot; --data &#x27;&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;web3_clientVersion&quot;,&quot;params&quot;:[],&quot;id&quot;:1&#125;&#x27; http://localhost:8545","categories":[],"tags":[]},{"title":"","slug":"blockchain/eth/ubantuç³»ç»Ÿä¸‹nvidiaæ˜¾å¡è¶…é¢‘è®¾ç½®","date":"2021-04-01T10:18:57.779Z","updated":"2021-04-01T10:18:57.779Z","comments":true,"path":"2021/04/01/blockchain/eth/ubantuç³»ç»Ÿä¸‹nvidiaæ˜¾å¡è¶…é¢‘è®¾ç½®/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/eth/ubantu%E7%B3%BB%E7%BB%9F%E4%B8%8Bnvidia%E6%98%BE%E5%8D%A1%E8%B6%85%E9%A2%91%E8%AE%BE%E7%BD%AE/","excerpt":"","text":"ubantuç³»ç»Ÿä¸‹nvidiaæ˜¾å¡è¶…é¢‘è®¾ç½® æŸ¥çœ‹æ˜¾å¡ä¿¡æ¯ï¼š nvidia-smi è®¾ç½®ç¬¬ä¸€ä¸ªæ˜¾å¡çš„åŠŸç‡ä¸º125wï¼š sudo nvidia-smi -i 0 -pl 125","categories":[],"tags":[]},{"title":"","slug":"blockchain/eth/ubantuå¦‚ä½•æŒ‚è½½ç¡¬ç›˜","date":"2021-04-01T10:18:57.778Z","updated":"2021-04-01T10:18:57.779Z","comments":true,"path":"2021/04/01/blockchain/eth/ubantuå¦‚ä½•æŒ‚è½½ç¡¬ç›˜/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/eth/ubantu%E5%A6%82%E4%BD%95%E6%8C%82%E8%BD%BD%E7%A1%AC%E7%9B%98/","excerpt":"","text":"ubantuå¦‚ä½•æŒ‚è½½ç¡¬ç›˜ï¼š æŸ¥çœ‹å·²ç»æŒ‚è½½äº†å“ªäº› 123456789101112131415161718192021$ df -læ–‡ä»¶ç³»ç»Ÿ 1K-å— å·²ç”¨ å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹udev 16362980 0 16362980 0% /devtmpfs 3285100 2364 3282736 1% /run/dev/nvme0n1p7 200537360 18016188 172264740 10% /tmpfs 16425488 408624 16016864 3% /dev/shmtmpfs 5120 4 5116 1% /run/locktmpfs 16425488 0 16425488 0% /sys/fs/cgroup/dev/loop0 56832 56832 0 100% /snap/core18/1988/dev/loop1 66432 66432 0 100% /snap/gtk-common-themes/1514/dev/loop2 33152 33152 0 100% /snap/snapd/11402/dev/loop3 52352 52352 0 100% /snap/snap-store/518/dev/loop4 31872 31872 0 100% /snap/snapd/11036/dev/loop5 224256 224256 0 100% /snap/gnome-3-34-1804/66/dev/nvme0n1p1 98304 33555 64749 35% /boot/efitmpfs 3285096 20 3285076 1% /run/user/125tmpfs 3285096 92 3285004 1% /run/user/1000/dev/loop6 101632 101632 0 100% /snap/core/10908/dev/loop7 435968 435968 0 100% /snap/pycharm-community/233/dev/loop8 680192 680192 0 100% /snap/intellij-idea-community/289 æŸ¥çœ‹æœ‰å“ªäº› 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889$ sudo fdisk -lDisk /dev/loop0ï¼š55.48 MiBï¼Œ58159104 å­—èŠ‚ï¼Œ113592 ä¸ªæ‰‡åŒºå•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚Disk /dev/loop1ï¼š64.79 MiBï¼Œ67915776 å­—èŠ‚ï¼Œ132648 ä¸ªæ‰‡åŒºå•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚Disk /dev/loop2ï¼š32.28 MiBï¼Œ33841152 å­—èŠ‚ï¼Œ66096 ä¸ªæ‰‡åŒºå•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚Disk /dev/loop3ï¼š51.4 MiBï¼Œ53522432 å­—èŠ‚ï¼Œ104536 ä¸ªæ‰‡åŒºå•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚Disk /dev/loop4ï¼š31.9 MiBï¼Œ32595968 å­—èŠ‚ï¼Œ63664 ä¸ªæ‰‡åŒºå•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚Disk /dev/loop5ï¼š218.102 MiBï¼Œ229629952 å­—èŠ‚ï¼Œ448496 ä¸ªæ‰‡åŒºå•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚Disk /dev/loop6ï¼š99.22 MiBï¼Œ104030208 å­—èŠ‚ï¼Œ203184 ä¸ªæ‰‡åŒºå•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚Disk /dev/loop7ï¼š425.67 MiBï¼Œ446328832 å­—èŠ‚ï¼Œ871736 ä¸ªæ‰‡åŒºå•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚Disk /dev/nvme0n1ï¼š931.53 GiBï¼Œ1000204886016 å­—èŠ‚ï¼Œ1953525168 ä¸ªæ‰‡åŒºDisk model: WDC WDS100T2B0C-00PXH0 å•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚ç£ç›˜æ ‡ç­¾ç±»å‹ï¼šgptç£ç›˜æ ‡è¯†ç¬¦ï¼šC12B6754-9D12-4F54-92FA-086CE249C548è®¾å¤‡ èµ·ç‚¹ æœ«å°¾ æ‰‡åŒº å¤§å° ç±»å‹/dev/nvme0n1p1 2048 206847 204800 100M EFI ç³»ç»Ÿ/dev/nvme0n1p2 206848 239615 32768 16M Microsoft ä¿ç•™/dev/nvme0n1p3 239616 408449302 408209687 194.7G Microsoft åŸºæœ¬æ•°æ®/dev/nvme0n1p4 408451072 409597951 1146880 560M Windows æ¢å¤ç¯å¢ƒ/dev/nvme0n1p5 409597952 1134321663 724723712 345.6G Microsoft åŸºæœ¬æ•°æ®/dev/nvme0n1p6 1134321664 1543921663 409600000 195.3G Microsoft åŸºæœ¬æ•°æ®/dev/nvme0n1p7 1543921664 1953523711 409602048 195.3G Linux æ–‡ä»¶ç³»ç»ŸDisk /dev/sdaï¼š7.28 TiBï¼Œ8001563222016 å­—èŠ‚ï¼Œ15628053168 ä¸ªæ‰‡åŒºDisk model: HGST HUS728T8TALå•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 4096 å­—èŠ‚I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š4096 å­—èŠ‚ / 4096 å­—èŠ‚ç£ç›˜æ ‡ç­¾ç±»å‹ï¼šgptç£ç›˜æ ‡è¯†ç¬¦ï¼šF654D976-A27E-49D1-B0FD-5DCB3914D51Dè®¾å¤‡ èµ·ç‚¹ æœ«å°¾ æ‰‡åŒº å¤§å° ç±»å‹/dev/sda1 34 32767 32734 16M Microsoft ä¿ç•™/dev/sda2 32768 4096032767 4096000000 1.9T Microsoft åŸºæœ¬æ•°æ®/dev/sda3 4096032768 8192032767 4096000000 1.9T Microsoft åŸºæœ¬æ•°æ®/dev/sda4 8192032768 15628050431 7436017664 3.5T Microsoft åŸºæœ¬æ•°æ®åˆ†åŒº 1 æœªèµ·å§‹äºç‰©ç†æ‰‡åŒºè¾¹ç•Œã€‚Disk /dev/loop8ï¼š664.17 MiBï¼Œ696426496 å­—èŠ‚ï¼Œ1360208 ä¸ªæ‰‡åŒºå•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚ æŸ¥çœ‹æƒ³è¦æŒ‚è½½çš„ç¡¬ç›˜çš„uuid 1234567891011121314151617181920212223242526$ lsblk -fNAME FSTYPE LABEL UUID FSAVAIL FSUSE% MOUNTPOINTloop0 squashfs 0 100% /snap/core18/1988loop1 squashfs 0 100% /snap/gtk-common-themes/1514loop2 squashfs 0 100% /snap/snapd/11402loop3 squashfs 0 100% /snap/snap-store/518loop4 squashfs 0 100% /snap/snapd/11036loop5 squashfs 0 100% /snap/gnome-3-34-1804/66loop6 squashfs 0 100% /snap/core/10908loop7 squashfs 0 100% /snap/pycharm-community/233loop8 squashfs 0 100% /snap/intellij-idea-community/289sda â”œâ”€sda1 â”œâ”€sda2 ntfs æ•°æ® 38C09128C090ECFE â”œâ”€sda3 ntfs æ–°åŠ å· 2A9E99709E993573 â””â”€sda4 ntfs æ–°åŠ å· C25E9EB25E9E9F2B nvme0n1 â”œâ”€nvme0n1p1 vfat 2E15-C03F 63.2M 34% /boot/efiâ”œâ”€nvme0n1p2 â”œâ”€nvme0n1p3 ntfs A4AA2056AA2026F0 â”œâ”€nvme0n1p4 ntfs FE347AD2347A8D81 â”œâ”€nvme0n1p5 ntfs å¨±ä¹ E848526348523114 â”œâ”€nvme0n1p6 ntfs å­¦ä¹ å·¥ä½œ EA1E592A1E58F155 â””â”€nvme0n1p7 ext4 12354a11-9bf9-4882-a202-3e3e675b3158 164.3G 9% / æ¯”å¦‚æˆ‘æƒ³è¦æŒ‚è½½/dev/sda4çš„uuidä¸ºC25E9EB25E9E9F2B ä¿®æ”¹/etc/fstabè¿›è¡ŒæŒ‚è½½ å‚è€ƒï¼šhttps://blog.51cto.com/13570193/2070157 æ¯”å¦‚æˆ‘çš„æ·»åŠ äº†ä¸€è¡Œï¼šUUID=C25E9EB25E9E9F2B /data ntfs defaults 0 0 é‡å¯ éªŒè¯ 12345678910111213141516171819202122$ df -hæ–‡ä»¶ç³»ç»Ÿ å®¹é‡ å·²ç”¨ å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹udev 16G 0 16G 0% /devtmpfs 3.2G 2.3M 3.2G 1% /run/dev/nvme0n1p7 192G 18G 165G 10% /tmpfs 16G 0 16G 0% /dev/shmtmpfs 5.0M 4.0K 5.0M 1% /run/locktmpfs 16G 0 16G 0% /sys/fs/cgroup/dev/loop0 56M 56M 0 100% /snap/core18/1988/dev/loop1 100M 100M 0 100% /snap/core/10908/dev/loop2 33M 33M 0 100% /snap/snapd/11402/dev/loop4 52M 52M 0 100% /snap/snap-store/518/dev/loop3 426M 426M 0 100% /snap/pycharm-community/233/dev/loop5 32M 32M 0 100% /snap/snapd/11036/dev/loop6 65M 65M 0 100% /snap/gtk-common-themes/1514/dev/loop7 219M 219M 0 100% /snap/gnome-3-34-1804/66/dev/loop8 665M 665M 0 100% /snap/intellij-idea-community/289/dev/nvme0n1p1 96M 33M 64M 35% /boot/efi/dev/sda4 3.5T 211M 3.5T 1% /datatmpfs 3.2G 16K 3.2G 1% /run/user/125tmpfs 3.2G 24K 3.2G 1% /run/user/1000","categories":[],"tags":[]},{"title":"è¯»ä¹¦ç¬”è®°-ã€Šä½ çš„ç¬¬ä¸€æœ¬ä¿é™©æŒ‡å—ã€‹","slug":"others/è¯»ä¹¦ç¬”è®°-ã€Šä½ çš„ç¬¬ä¸€æœ¬ä¿é™©æŒ‡å—ã€‹","date":"2021-04-01T10:18:21.507Z","updated":"2021-04-01T10:18:21.508Z","comments":true,"path":"2021/04/01/others/è¯»ä¹¦ç¬”è®°-ã€Šä½ çš„ç¬¬ä¸€æœ¬ä¿é™©æŒ‡å—ã€‹/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/others/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-%E3%80%8A%E4%BD%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E6%9C%AC%E4%BF%9D%E9%99%A9%E6%8C%87%E5%8D%97%E3%80%8B/","excerpt":"","text":"1ã€ç ´é™¤è¯¯ä¼šï¼Œæˆ‘ä»¬çœŸçš„äº†è§£ä¿é™©å— æˆ‘ä»¬å¯¹ä¿é™©çš„è®¤è¯†ï¼šç†èµ”ä¼¼ä¹ç‰¹åˆ«éš¾ å‘ç”Ÿçš„äº‹æ•…ä¸åœ¨ä¿é™©èŒƒå›´ï¼Œä¸èƒ½èµ”ä»˜ å®¢æˆ·æœªå¦‚å®å‘ŠçŸ¥è‡ªèº«æƒ…å†µï¼Œä¸èƒ½èµ”ä»˜ æ¡æ¬¾è¿‡äºä¸¥è‹›ï¼Œä¸èƒ½èµ”ä»˜ ä»€ä¹ˆæ˜¯æ ¸ä¿å¸ˆä¸å¥åº·å‘ŠçŸ¥ å¥åº·å‘ŠçŸ¥ å¥åº·å‘ŠçŸ¥é—®è¯¢ å¥åº·é—®è¯¢ï¼šæ˜¯å¦æœ‰ç–¾ç—…æˆ–ä½é™¢è®°å½•ç­‰ èŒä¸šé—®è¯¢ï¼šæ˜¯å¦ä»äº‹é«˜å±è¡Œä¸š ç”Ÿæ´»é—®è¯¢ï¼šæ˜¯å¦å¸çƒŸã€é…—é…’ï¼ˆé…’ç²¾ä¾èµ–ï¼‰ï¼Œæ˜¯å¦æœ‰æé™è¿åŠ¨ç­‰å±é™©æ€§é«˜çš„ä¸šä½™çˆ±å¥½ç­‰ æ ¸ä¿ç»“è®º ç»“è®ºä¸€ï¼šæ ‡å‡†ä½“ã€‚æ­å–œï¼Œä½ å®Œç¾åœ°ç¬¦åˆå¥åº·å‘ŠçŸ¥ä¸­çš„æ‰€æœ‰è¦æ±‚ï¼Œå¯ä»¥ç›´æ¥æŠ•ä¿ï¼Œæ— é¡»åšè¡¥å……å‘ŠçŸ¥ ç»“è®ºäºŒï¼šæ¬¡æ ‡å‡†ä½“ã€‚å¯èƒ½æœ‰å°‘æ•°å‡ æ¡ä¸ç¬¦åˆå¥åº·å‘ŠçŸ¥ï¼Œä½†è€ƒè™‘åˆ°åŸºæœ¬åœ¨å¯æ¥å—èŒƒå›´å†…ï¼Œä¿é™©å…¬å¸å°±â€œå‹‰ä¸ºå…¶éš¾â€åœ°å…è®¸ä½ æŠ•ä¿äº† æ¥å—é™¤å¤–è´£ä»»ï¼šä¿é™©å…¬å¸è€ƒè™‘åˆ°æŠ•ä¿äººå½“å‰çš„å¥åº·çŠ¶å†µï¼Œå°†ç‰¹å®šç–¾ç—…æ’é™¤åœ¨è´£ä»»èŒƒå›´ä¹‹å¤– å¢åŠ ä¿è´¹ ç»“è®ºä¸‰ï¼šå»¶æœŸã€‚ä¿é™©å…¬å¸è€ƒè™‘åˆ°ä½ çš„æŸä¸ªå¥åº·é—®é¢˜ï¼Œæš‚ä¸æ¥å—ä½ çš„æœ¬æ¬¡æŠ•ä¿ç”³è¯·ï¼Œå»ºè®®è¿‡ä¸€æ®µæ—¶é—´å†æ¥è¯•è¯• ç»“è®ºå››ï¼šæ‹’ä¿ åˆ°åº•æ€ä¹ˆå¥åº·å‘ŠçŸ¥ï¼Ÿ è¯´å®è¯ï¼Œå½“ä¿é™©å…¬å¸æŠŠé‡ç–¾é™©ã€åŒ»ç–—é™©è¿™ç±»ä¿éšœå‹äº§å“æ”¾åˆ°ç½‘ä¸Šé”€å”®çš„æ—¶å€™ï¼Œå…¶å®åªæ˜¯æƒ³å–ç»™æ ‡å‡†ä½“å®¢æˆ·ã€‚ è‡³äºæ¬¡æ ‡å‡†ä½“å’Œéæ ‡å‡†ä½“å®¢æˆ·ï¼Œå¯¹ä¸èµ·ï¼Œè¿™ç±»äº§å“ä¸æ˜¯ä¸ºä»–ä»¬å‡†å¤‡çš„ã€‚ ä¹°ä¿é™©ä¸€å®šè¦è¿”æœ¬å—ï¼Ÿ å½“ä½ æƒ³è¦è¿”è¿˜çš„æ—¶å€™ï¼Œä½ åˆ°åº•æƒ³è¦ä»€ä¹ˆ ç¬¬ä¸€ï¼Œæ‹¿å›ä¿è´¹ã€‚å¦‚æœæ²¡æœ‰å‘ç”Ÿä¿é™©äº‹æ•…ï¼Œè¯·æŠŠæˆ‘äº¤çš„ä¿è´¹è¿˜ç»™æˆ‘ ç¬¬äºŒï¼Œè·å¾—èµ”å¿ã€‚æ—¢ç„¶æˆ‘è´­ä¹°äº†ä¿é™©ï¼Œæ€»å½’æ˜¯å¸Œæœ›èƒ½æ´¾ä¸Šç”¨åœºã€‚ è¿½æ±‚ä¿è´¹è¿”è¿˜ï¼Œåˆ‡è«å› å°å¤±å¤§ åæœ¬ä¿é™©ä¸€èˆ¬ä¼šæ¯”ä¸åæœ¬ï¼ˆæ¶ˆè´¹å‹ï¼‰ä¿é™©æ›´è´µ åœ¨è¿½æ±‚ä¿è´¹è¿”è¿˜æ—¶ï¼Œæƒ³ä¸€ä¸‹è‡ªå·±è´­ä¹°ä¿é™©çš„åˆå¿ƒï¼šå½“åˆä½ è¯´è¦ä¹°ä¿é™©çš„æ—¶å€™ï¼Œåˆ°åº•æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿä¿è´¹å’Œä¿é¢ï¼Œå“ªä¸ªæ‰æ˜¯ä½ çš„åˆå¿ƒï¼Ÿ éè¦æ‹¿åˆ°ä¿è´¹ï¼Œä¸å¦¨è¿™æ ·é€‰æ‹© æå‰ç»™ä»˜å‹é‡ç–¾é™©ï¼šèº«æ‚£é‡ç–¾æˆ–ä¸å¹¸èº«æ•…ï¼Œå“ªä¸ªæå‰å‘ç”Ÿï¼Œéƒ½å¯ç»™ä»˜èµ”å¿ï¼Œä½†æ˜¯ä»£ä»·ä¾ç„¶æ˜¯æ”¯ä»˜æ›´å¤šä¿è´¹ ä¿éšœç»ˆèº«åªæ˜¯ä¿é™©äº§å“çš„ä¸€ä¸ªåŠŸèƒ½è®¾ç½®ï¼Œè€Œä¸åº”è¢«è§†ä¸ºä¸€ä¸ªä¼˜ç‚¹ï¼Œå› ä¸ºä½ ä¸ºæ­¤æ”¯ä»˜äº†æ›´å¤šçš„ä¿è´¹ ä¿é™©å…¬å¸ä¼šä¸ä¼šç ´äº§ ä¿é™©å…¬å¸ä¼šç ´äº§ï¼Œå´ä¸ä¼šå®Œè›‹ ä¿é™©å…¬å¸ç ´äº§æ—¶ï¼Œäººå¯¿ä¿é™©åˆåŒåŠè´£ä»»å‡†å¤‡é‡‘ï¼Œå¿…é¡»è½¬è®©ç»™å…¶ä»–ç»è¥æœ‰äººå¯¿ä¿é™©ä¸šåŠ¡çš„ä¿é™©å…¬å¸ ä¿é™©ä¿éšœåŸºé‡‘ï¼šæ¥æºæ˜¯81å®¶è´¢é™©å…¬å¸å’Œ88å®¶å¯¿é™©å…¬å¸ï¼Œä¿é™©å…¬å¸æ¯å¹´éœ€å‘å…¶ç¼´çº³ä¸€å®šæ•°é¢çš„èµ„é‡‘ï¼Œè¿™ä¹Ÿæ˜¯è¢«å†™è¿›ã€Šä¿é™©æ³•ã€‹çš„å¼ºåˆ¶æ€§è¦æ±‚ã€‚ æ”¿åºœåœ¨åšçš„ï¼Œæ˜¯æ‹¼å‘½é¢„é˜²ä¿é™©å…¬å¸ç ´äº§ ä¸€å®¶ä¿é™©å…¬å¸ä»è®¡åˆ’æˆç«‹ä¹‹åˆï¼Œå°±ä¸å¾—ä¸æ¥å—ä¸€ç³»åˆ—ç›‘ç®¡ã€‚è¿™äº›ç›‘ç®¡æªæ–½å’Œè§„å®šå°±åƒä¸€é“é“é˜²ç«å¢™ï¼Œç¡®ä¿å…¬å¸åœ¨æ­£ç¡®è½¨é“ä¸Šè¿è½¬ã€‚ ç¬¬ä¸€é“é˜²ç«å¢™æ˜¯æé«˜çš„å…¬å¸è®¾ç«‹æ ‡å‡† ç¬¬äºŒé“é˜²ç«å¢™æ˜¯å…¨é¢ç§‘å­¦çš„å¿ä»˜èƒ½åŠ›ç›‘ç®¡ æ‰€è°“å¿ä»˜èƒ½åŠ›ï¼ŒæŒ‡çš„æ˜¯å½“ä¿é™©å…¬å¸é­é‡æç«¯æƒ…å†µæ—¶ï¼Œæ˜¯å¦ä»æœ‰èƒ½åŠ›å±¥è¡Œèµ”ä»˜è´£ä»»ã€‚æ¯ä¸ªå¹´åº¦å’Œå­£åº¦ï¼Œä¿é™©å…¬å¸çš„ç²¾ç®—ã€è´¢åŠ¡ç­‰ä¸“ä¸šäººå£«éƒ½ä¼šç¼–åˆ¶å…¬å¸å¿ä»˜èƒ½åŠ›æŠ¥å‘Šï¼Œæ¶‰åŠä¸€ç³»åˆ—æ•°å­¦æ¨¡å‹å’Œå‹åŠ›æµ‹è¯• æ ¹æ®å¿ä»˜èƒ½åŠ›æƒ…å†µï¼Œä¿é™©å…¬å¸ä¼šå¾—åˆ°ä»ä¼˜åˆ°å·®çš„è¯„çº§ï¼ŒåŒ…æ‹¬Aã€Bã€Cã€D4ä¸ªç­‰çº§ã€‚è¯„çº§å¯ä»¥åœ¨ä¿é™©å…¬å¸å®˜ç½‘çš„â€œå…¬å¼€ä¿¡æ¯æŸ¥è¯¢â€æ ç›®æŸ¥åˆ°ï¼Œæˆ‘ä»¬å°†å®ƒè§†ä¸ºåˆ¤æ–­ä¿é™©å…¬å¸æ˜¯å¦â€œé è°±â€çš„ä¸€ä¸ªé‡è¦æ ‡å¿—ã€‚é•¿æœŸæ¥çœ‹ï¼Œåªè¦è¯„çº§ç¨³å®šåœ¨Aå’ŒBçš„å…¬å¸ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æ”¾å¿ƒè´­ä¹°å…¶äº§å“ ç¬¬ä¸‰é“é˜²ç«å¢™æ˜¯é¢‘ç‡é«˜ã€å¼ºåº¦å¤§çš„ç°åœºæ£€æŸ¥ ç›‘ç®¡éƒ¨é—¨ä¼šéšæ—¶è¿›é©»ä¿é™©å…¬å¸æ€»å…¬å¸å’Œåˆ†å…¬å¸ï¼Œé€šè¿‡è°ƒå–æ¡£æ¡ˆã€æŸ¥è¯¢ç³»ç»Ÿç­‰æ–¹å¼å®æ–½ç°åœºæ£€æŸ¥ å½“ç„¶ï¼Œä¸Šè¿°çš„é˜²ç«å¢™è™½å¥½ï¼Œå¦‚æœå› ä¸ºè´ªæ±¡è…è´¥è€Œè®©ä¿é™©å…¬å¸è’™æ··è¿‡å…³ï¼Œè¿™æ˜¯æˆ‘ä»¬æ— æ³•æ”¹å˜çš„äº‹æƒ…ï¼Œæš‚æ—¶åªèƒ½æ¥å— å¦‚ä½•é€‰æ‹©ä¸€å®¶ä¿é™©å…¬å¸ï¼Ÿ å¯¹æ¯”ä¸åŒä¿é™©å…¬å¸çš„æŠ•è¯‰æƒ…å†µ ç›‘ç®¡éƒ¨é—¨æ¯å¹´éƒ½ä¼šå¯¹å„å®¶ä¿é™©å…¬å¸çš„æŠ•è¯‰æƒ…å†µè¿›è¡Œé€šæŠ¥ã€è¯„åˆ†ï¼Œå¹¶å‘å¸ƒåœ¨å®˜ç½‘ä¸Šï¼ˆæ¯”å¦‚ä¿ç›‘ä¼šå®˜ç½‘ï¼‰ é”€å”®äººå‘˜å£ç¢‘å¦‚ä½•ï¼Œä¿¡æ¯æŠ€æœ¯å®åŠ›å¦‚ä½•ï¼ˆæ¯”å¦‚å®˜ç½‘å’Œæ‰‹æœºè½¯ä»¶çš„ä½¿ç”¨ä½“éªŒï¼‰ï¼Œå®¢æœç”µè¯èƒ½å¦å¿«é€Ÿæ¥é€šï¼Œè¯¸å¦‚æ­¤ç±» æœ€é‡è¦çš„æ˜¯ä¿é™©äº§å“çš„æ€§ä»·æ¯” 2ã€è´­å‰æŒ‡å—ï¼šä¹°ä¿é™©çš„æ­£ç¡®æ–¹æ³• ä¹°ä¿é™©å’Œåƒéº¦å½“åŠ³æ˜¯ä¸€æ ·çš„ï¼Œä¿é™©äº§å“ä¸€èˆ¬éƒ½æ˜¯å¾ˆå¤šä¿é™©ç»„æˆçš„ã€‚ ä¸€ä»½ä¿é™©è®¡åˆ’é€šå¸¸ç”±ä¸€æ¬¾ä¸»é™©å’Œè‹¥å¹²æ¬¾é™„åŠ é™©æ„æˆï¼Œä¸»é™©å°±åƒä¸€ä½å¤§å“¥ï¼Œå¸¦ç€ä¸€å¸®ä½œä¸ºé™„åŠ é™©çš„å°å¼Ÿã€‚ è¿™ç§å……åˆ†åˆ©ç”¨å’Œå®¢æˆ·æ¥è§¦çš„æœºä¼šæ¨é”€å°½å¯èƒ½å¤šçš„äº§å“ï¼Œæ˜¯ä¸€ç§æ™®éçš„ä¿é™©é”€å”®æ¨¡å¼ ä½†æ˜¯æœ‰æ—¶å€™ï¼Œå•ç‚¹æ¯”å¥—é¤æ›´å¥½ï¼Œæ¯•ç«Ÿä¿é™©å…¬å¸å®šçš„äº§å“å¹¶éæ ¹æ®æˆ‘ä»¬çš„éœ€æ±‚å®šï¼Œé™„åŠ é™©å¯èƒ½å¹¶éæˆ‘ä»¬éœ€è¦çš„ã€‚ è´£ä»»çš„å¤šå°‘ã€ä¿é¢çš„é«˜ä½ã€æœŸé™çš„é•¿çŸ­ï¼Œè¿™ä¸‰å¤§å› ç´ ç›´æ¥å†³å®šäº†ä¿é™©äº§å“çš„ä»·æ ¼ã€‚ ä¿é¢ï¼šçœŸåˆ°ç”¨æ—¶æ–¹æ¨å°‘ æœŸé™ï¼šä»ä¸€å¤©åˆ°ä¸€è¾ˆå­ çŸ­æœŸäº§å“ ä¿é™©æœŸé™ä¸è¶…è¿‡ä¸€å¹´ ä»¥ä¸€å¹´ä¸ºä¸€æœŸè®¡ï¼Œäº§å“çš„å®šä»·å°±è¦å‚è€ƒå½“ä¸‹è¢«ä¿é™©äººçš„å¹´é¾„æ¥è®¡ç®—äº†ã€‚30å²æ—¶è´­ä¹°ï¼Œä»·æ ¼å¯èƒ½æ˜¯100å…ƒï¼›5å¹´åï¼Œä»·æ ¼å¯èƒ½å°±ä¼šæ¶¨åˆ°400å…ƒã€‚è¿™ç§éšå¹´é¾„å¢åŠ è€Œä¸Šæ¶¨çš„å®šä»·ç­–ç•¥ï¼Œå«ä½œè‡ªç„¶è´¹ç‡ã€‚å®¢æˆ·æ¯å¹´äº¤çš„é’±ï¼Œåªè´Ÿè´£æ‰¿æ‹…å½“å¹´çš„é£é™©ã€‚ é•¿æœŸäº§å“ 10å¹´ã€20å¹´ç”šè‡³ç»ˆèº« å®šä»·æ–¹æ³•éµå¾ªä¸¤ä¸ªåŸåˆ™ï¼šä¸€æ˜¯å‡è¡¡è´¹ç‡åŸåˆ™ï¼ŒäºŒæ˜¯ä¿è¯è´¹ç‡åŸåˆ™ å‡è¡¡è´¹ç‡ï¼ŒæŒ‡çš„æ˜¯ä¿é™©å…¬å¸å°†è¢«ä¿é™©äººæœªæ¥å¾ˆé•¿ä¸€æ®µæ—¶é—´çš„é£é™©ï¼Œå½’å¹¶åˆ°ä¸€èµ·è¿›è¡Œå®šä»·ï¼Œè€Œä¸åªæ˜¯ä¸€å¹´çš„é£é™© æ¯”å¦‚ï¼Œä¿åˆ°70å²æˆ–ä¿ç»ˆèº«ï¼ŒæŠ•ä¿äººæœªæ¥å‡ åå¹´çš„ç–¾ç—…å‘ç”Ÿç‡æˆ–è€…æ­»äº¡ç‡è¢«ç´¯è®¡åç®—å‡ºä¿è´¹ï¼Œå†æŒ‰ç…§20å¹´æˆ–30å¹´äº¤è´¹çš„æ–¹å¼è¿›è¡Œå‡æ‘Šï¼Œä»·æ ¼å°±ç¡®å®šäº† åœ¨è¿™æ ·ä¸€ç§æ¨¡å¼ä¸‹ï¼Œé•¿æœŸäº§å“çš„åœå”®åªæ„å‘³ç€ä¸æ¥å—æ–°å®¢æˆ·çš„è´­ä¹°ï¼Œä½†å¹¶ä¸å½±å“å·²ç»æŠ•ä¿çš„å®¢æˆ· ä¿è¯è´¹ç‡ï¼šæŒ‡çš„æ˜¯åœ¨ä½ æŠ•ä¿çš„ä¸€ç¬é—´ï¼Œä»·æ ¼ä¾¿å·²ç¡®å®šï¼ŒåæœŸä¸ä¼šå¢åŠ ã€‚å¯¹äºé•¿æœŸé‡ç–¾é™©æ¥è¯´ï¼Œå³ä½¿æŠ•ä¿äººæœªæ¥çš„å‘ç—…ç‡ä¸Šå‡ï¼Œä¿é™©å…¬å¸ä¹Ÿä¸ä¼šæ¶¨ä»· é•¿æœŸäº§å“å’ŒçŸ­æœŸäº§å“è´¹ç”¨æ¯”è¾ƒ æ•´ä½“æ¥çœ‹ï¼Œè´­ä¹°çŸ­æœŸé™©è´¹ç”¨è¦æ¯”é•¿æœŸé™©è´¹ç”¨é«˜ äººåˆ°ä¸­å¹´ï¼Œå°±æœ‰å¯èƒ½æ— æ³•è´­ä¹°çŸ­æœŸé™© äººåˆ°è€å¹´ï¼Œåˆ™æ ¹æœ¬ä¸èƒ½è´­ä¹°çŸ­æœŸé™© å¯¹äºå·²ç»æœ‰é•¿æœŸé™©åº‡æŠ¤çš„äººæ¥è¯´ï¼Œé¢å¤–è´­ä¹°ä¸€ä»½ä¸€å¹´æœŸäº§å“ï¼Œå¯ä»¥åœ¨ä¸€å®šæ—¶é—´å†…å¢åŠ ä¿é¢ çŸ­æœŸé™©åœ¨å¹´è½»æ—¶æ¯”è¾ƒä¾¿å®œ ä¿é™©äº§å“çš„ä»·æ ¼ç”±è°å†³å®š æˆ‘ä»¬æœ‰å“ªäº›éœ€æ±‚éœ€è¦ä¿é™©è§£å†³ï¼Ÿ å¾—äº†é‡ç–¾ï¼Œæœ‰é’±æ²»ç—… å¾—äº†é‡ç–¾ï¼Œå¼¥è¡¥æ²»ç–—æœŸé—´çš„æ”¶å…¥ ä¸å¹¸èº«æ•…ï¼Œç»™çˆ¸å¦ˆç•™ä¸€ç¬”å…»è€è´¹ æ„å¤–å—ä¼¤ï¼Œè§£å†³åŒ»ä¿ä¸åŒ…å«çš„è´¹ç”¨ ä¿é™©è¿™ç§äº§å“ä¸æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå®ƒæ˜¯é™ªä¼´ä½ åº¦è¿‡æ¼«é•¿äººç”Ÿçš„ä¸€ç§é£é™©è§„åˆ’ å¦‚ä½•ä¸ä¿é™©ä¸šåŠ¡å‘˜æ‰“äº¤é“ ä¿é™©å…¬å¸ä¼šä¸é—ä½™åŠ›åœ°å¢åŠ äº§å“çš„â€œäººæƒ…å‘³â€ï¼Œæ¯”å¦‚å°†ä¿é™©å¡‘é€ æˆçˆ±ä¸è´£ä»»çš„è±¡å¾ï¼Œè®©ä½ æŠŠå¯¹å­å¥³ã€çˆ¶æ¯çš„çˆ±å¯„æ‰˜äºä¿é™©äº§å“ä¹‹ä¸Šï¼Œè®©è´­ä¹°è¡Œä¸ºæ›´åŠ é¡ºç†æˆç«  ä¿é™©é”€å”®äººå‘˜åˆ°åº•æŒ‡çš„æ˜¯è° ç¬¬ä¸€ï¼Œä¿é™©ä»£ç†äººã€‚å…¨å›½çº¦800ä¸‡ï¼Œä»–ä»¬ä»£è¡¨å„è‡ªæ‰€åœ¨çš„ä¿é™©å…¬å¸ï¼Œåªé”€å”®æŸä¸€å®¶ä¿é™©å…¬å¸çš„äº§å“ã€‚ ç¬¬äºŒï¼Œä¿é™©ç»çºªäººã€‚å’Œä»£ç†äººæœ€å¤§çš„ä¸åŒæ˜¯ï¼Œç»çºªäººä»£è¡¨çš„ä¸æ˜¯æŸä¸€å®¶ä¿é™©å…¬å¸ï¼Œè€Œæ˜¯ä¿é™©ä¸­ä»‹å…¬å¸ï¼Œä»–ä»¬å¯ä»¥é”€å”®å¤šå®¶ä¿é™©å…¬å¸äº§å“ ç¬¬ä¸‰ï¼Œé“¶è¡Œç†è´¢ç»ç† ç¬¬å››ï¼Œäº’è”ç½‘ç¬¬ä¸‰æ–¹å¹³å° å’Œä¸šåŠ¡å‘˜æ‰“äº¤é“ï¼Œè¦éµå¾ªä¸¤ä¸ªåŸåˆ™ æƒ³ä¸€ä¸‹æˆ‘ä»¬æœ‰æ—¶å€™ä¼šä¸ä¼šå› ä¸ºä¸‹é¢çš„æƒ…å†µè€Œä¹°ä¿é™© ç¬¬ä¸€ï¼Œå–ä¿é™©çš„äººæ˜¯äº²æˆšï¼ŒæŠ¹ä¸å¼€é¢å­ï¼Œä¹°å§ã€‚ ç¬¬äºŒï¼Œé‚»å±…éƒ½ç»™å­©å­ä¹°çš„è¿™ä¸ªï¼Œæˆ‘ä¹Ÿä¹°ä¸€ä¸ªå§ ç¬¬ä¸‰ï¼Œä»–ç­”åº”æˆ‘æŠŠä½£é‡‘è¿”è¿˜ç»™æˆ‘ï¼Œçœäº†ä¸å°‘é’±ï¼Œä¹°å§ã€‚ ç¬¬å››ï¼Œå°ä¼™å­å£æ‰å¥½ï¼Œäººä¹Ÿå¸…ï¼Œå–çš„ä¿é™©ä¸ä¼šå·®ã€‚ ç¬¬äº”ï¼Œå°±ç®—è¢«éª—ä¸€å¹´æ‰æŸå¤±1000å¤šå—é’±ï¼Œä¹°å§ å¥½é¢å­ã€ä»ä¼—å¿ƒç†ã€è´ªå›¾å°ä¾¿å®œã€å¿½ç•¥äº§å“çš„æœ¬è´¨ï¼Œè¿™ç±»é—®é¢˜ç»å¸¸å‘ç”Ÿï¼Œä¹Ÿé—´æ¥å‚¬ç”Ÿäº†ä¸€æ‰¹ä¸é è°±çš„ä¿é™©ä¸šåŠ¡å‘˜ ç¬¬ä¸€ä¸ªåŸåˆ™ï¼šäº’ç›¸å°Šé‡ï¼Œå­¦ä¼šæé—®ã€‚ æ¡æ¬¾èƒ½ç»™æˆ‘çœ‹ä¸€ä¸‹å—ï¼Ÿ ä¸ºä»€ä¹ˆæˆ‘éœ€è¦è¿™æ¬¾äº§å“ï¼Ÿ ä¸ºä»€ä¹ˆè¿™ç±»äº§å“ä½ ä»¬å®¶çš„æœ€å¥½ï¼Ÿ èƒ½æ¯”è¾ƒä¸€ä¸‹ä¸åŒäº§å“å—ï¼Ÿ ä¸ºä»€ä¹ˆè¦ä¿ç»ˆèº«ï¼Ÿ ä¸ºä»€ä¹ˆè¿™ä¸ªé™„åŠ é™©å€¼å¾—è´­ä¹°ï¼Ÿ å¦‚æœä½ å‘ç°è¿™ä½ä¿é™©ä¸šåŠ¡å‘˜é¢å¯¹ä½ æå‡ºçš„ä¸€ä¸ªä¸ªé—®é¢˜ï¼Œè¦ä¹ˆç­”ä¸å‡ºæ¥ï¼Œè¦ä¹ˆé€»è¾‘æ··ä¹±ï¼Œè¦ä¹ˆä¸åˆ†é’çº¢çš‚ç™½åœ°æ•Œè§†åŠè´¬æŸå…¶ä»–ä¿é™©å…¬å¸ï¼Œæœ€å¥½ç«‹å³æ›´æ¢ä¸šåŠ¡å‘˜ ç¬¬äºŒä¸ªåŸåˆ™ï¼šå……åˆ†ä¿¡ä»»ï¼Œè¦æœ‰ä¸»è§ å–ä¿é™©ç®€å•å— äº§å“è´µä¸è´µï¼ˆåŒç±»äº§å“çš„å®šä»·å’Œè´¹ç‡å¯¹æ¯”ï¼‰ï¼Ÿ åˆ°åº•æœ‰å“ªäº›ä¿éšœï¼ˆä¿é™©è´£ä»»çš„è§£è¯»ï¼‰ï¼Ÿ é€€ä¿èƒ½æ‹¿åˆ°å¤šå°‘ä¿è´¹ï¼ˆä¿å•ç°é‡‘ä»·å€¼çš„è§£è¯»ï¼‰ï¼Ÿ ä¹°å®Œåå“ªäº›ä¿¡æ¯å¯ä»¥ä¿®æ”¹ï¼ˆå¯¹ä¿å•ä¿å…¨åŠŸèƒ½çš„è®²è§£ï¼‰ï¼Ÿ è¿™ä¸ªäº§å“èƒ½å®ç°å¤šé«˜æ”¶ç›Šï¼ˆå¦‚ä½•è®¡ç®—åˆ†çº¢é™©ã€ä¸‡èƒ½é™©ã€å¹´é‡‘ç­‰äº§å“çš„æŠ•èµ„æ”¶ç›Šï¼‰ï¼Ÿ ç¼´è´¹æœŸé™æ€ä¹ˆé€‰æ‹©ï¼ˆç°é‡‘æµè´´ç°åŸç†ï¼‰ï¼Ÿ ä¿é™©æ¡æ¬¾é‡Œæœ‰æ²¡æœ‰æ‰€è°“çš„å‘ï¼ˆé™¤å¤–è´£ä»»åšé‡ç‚¹è¯´æ˜ï¼‰ï¼Ÿ é‡åˆ°çº çº·çš„æ—¶å€™å¦‚ä½•å¤„ç†ï¼Ÿ å¦‚æœä»–çœŸçš„åšäº†äº§å“å¯¹æ¯”ï¼Œä½†å¦‚æœä»–æ¨é”€çš„äº§å“ä»·æ ¼æ²¡æœ‰ç«äº‰åŠ›ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿä»–çœŸçš„ç®—æ¸…æ¥šäº†äº§å“æ”¶ç›Šï¼Œä½†å®¢æˆ·è§‰å¾—æ”¶ç›Šç‡ä¸å¦‚æƒ³è±¡çš„é‚£ä¹ˆé«˜ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿä»–çœŸçš„ä¸€æ¡ä¸€æ¡åœ°è§£é‡Šæ¸…æ¥šé™¤å¤–è´£ä»»ï¼Œå®¢æˆ·å´äº§ç”Ÿâ€œä¿é™©å…¬å¸æ¨å¸è´£ä»»â€çš„æƒ…ç»ªåŒ–è¯¯è§£ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿä»–å› ä¸ºå®¢æˆ·çš„å¥åº·é—®é¢˜è€Œæ‹’ç»å…¶æŠ•ä¿ï¼Œä¹‹å‰çš„å·¥ä½œä¸å°±ç™½å¿™æ´»äº†å—ï¼Ÿ è¿™äº›å‡è®¾ä¼¼ä¹æš—ç¤ºäº†ä¿é™©é”€å”®äººå‘˜â€œèƒ½åŠ›è¶Šå¼ºè¶Šå–ä¸å‡ºå»äº§å“â€çš„è§‚ç‚¹ï¼Œä½†æˆ‘æƒ³è¡¨è¾¾çš„ç»ä¸æ˜¯â€œçŸ¥è¯†æ— ç”¨è®ºâ€ï¼Œå®ƒä»¬åªæ˜¯åœ¨ä¸€å®šç¨‹åº¦ä¸Šåæ˜ äº†å½“å‰ä¿é™©é”€å”®é¢†åŸŸå­˜åœ¨çš„å¼Šç—…ã€‚è€Œè¿™äº›æç«¯çš„ä¾‹å­æ°æ°å‡¸æ˜¾äº†â€œä½ â€çš„é‡è¦æ€§ã€‚ ä½ çš„å…¬å¸ç»™ä½ ä¹°ä¿é™©äº†å— ä¼ä¸šå›¢ä½“ä¿é™© å›¢é™©é€šå¸¸ç”±4ä¸ªä¿é™©äº§å“ç»„æˆï¼š å®šæœŸå¯¿é™© é‡å¤§ç–¾ç—…é™© æ„å¤–é™© åŒ»ç–—é™© å›¢é™©è®¡åˆ’å¯ä»¥æ¶µç›–ä»¥ä¸‹è´£ä»»ï¼š ç½¹æ‚£é‡å¤§ç–¾ç—…ï¼šä¿é¢50ä¸‡å…ƒï¼ˆé‡å¤§ç–¾ç—…é™©çš„é‡ç–¾è´£ä»»50ä¸‡å…ƒï¼‰ã€‚ ç–¾ç—…å¯¼è‡´èº«æ•…ï¼šä¿é¢50ä¸‡å…ƒï¼ˆå®šæœŸå¯¿é™©èº«æ•…è´£ä»»50ä¸‡å…ƒï¼‰ã€‚ æ„å¤–å¯¼è‡´èº«æ•…ï¼šä¿é¢150ä¸‡å…ƒï¼ˆå®šæœŸå¯¿é™©èº«æ•…è´£ä»»50ä¸‡å…ƒ+æ„å¤–é™©èº«æ•…è´£ä»»100ä¸‡å…ƒï¼‰ã€‚ é—¨è¯Šè´£ä»»ï¼šä¿é¢2ä¸‡å…ƒï¼ˆåŒ»ç–—é™©åŒ…å«çš„é—¨æ€¥è¯ŠåŒ»ç–—è´£ä»»2ä¸‡å…ƒï¼‰ã€‚ ä½é™¢è´£ä»»ï¼šä¿é¢30ä¸‡å…ƒï¼ˆåŒ»ç–—é™©åŒ…å«çš„ä½é™¢åŒ»ç–—è´£ä»»30ä¸‡å…ƒï¼‰ã€‚ å›¢é™©ä»·æ ¼ä¹‹æ‰€ä»¥â€œäº²æ°‘â€ï¼Œä¸»è¦åŸå› å¦‚ä¸‹ï¼š ç¬¬ä¸€ï¼Œå›¢é™©å¯ä»¥ç®€å•ç±»æ¯”ä¸ºå›¢è´­ï¼Œä¹°çš„äººæ•°å¤šï¼ŒèŠ‚çœäº†ä¸€éƒ¨åˆ†ç®¡ç†æˆæœ¬ï¼Œè‡ªç„¶å°±èƒ½è·å¾—ä¸€å®šçš„ä¼˜æƒ  ç¬¬äºŒï¼Œå›¢é™©çš„ä¸»è¦é”€å”®å¯¹è±¡æ˜¯ä¼ä¸šäººåŠ›èµ„æºéƒ¨ï¼Œåªè¦è´Ÿè´£äººæ‹æ¿ï¼Œ100ä¸ªå‘˜å·¥å°±ç›´æ¥è´­ä¹°äº†ï¼Œä¸ç”¨ä¸€ä¸ªä¸€ä¸ªåœ°å®£ä¼ ã€ä»‹ç»ï¼Œé—´æ¥é™ä½äº†äº§å“çš„é”€å”®è´¹ç”¨ï¼Œæœ€ç»ˆçš„å®æƒ è½åœ¨äº†æ¯ä¸€ä½å‚ä¿å‘˜å·¥èº«ä¸Š ç¬¬ä¸‰ï¼Œä»¥ä¼ä¸šåä¹‰æŠ•ä¿ï¼Œå‚ä¿äººå‘˜çš„å·¥ä½œç¯å¢ƒå’Œæ€§è´¨ç›¸å¯¹ä¸€è‡´ï¼Œå¤–éƒ¨é£é™©å¯æ§ï¼Œä½•å†µä¸å°‘ä¼ä¸šè¿˜æœ‰å…¥èŒä½“æ£€ï¼Œå¯ä»¥å¾ˆå¥½è§£å†³å®¢æˆ·çš„é€†é€‰æ‹©å’Œå¥åº·é—®é¢˜ å›¢é™©å¸¦æ¥çš„â€œä¿é™©å¹»è§‰â€ ä¸€èˆ¬å…¬å¸å›¢é™©çš„ä¿é™©äº§å“çš„ä¿éšœæœŸé™éƒ½æ˜¯ä¸€å¹´ï¼Œå¦‚æœå®Œå…¨ä¾èµ–å…¬å¸ä¿é™©ï¼Œæˆ‘ä»¬ä¸€æ—¦ç¦»èŒå°±ä¼šé¢ä¸´ä¿é™©â€œè£¸å¥”â€çš„æƒ…å†µ æ‰€ä»¥ï¼Œå»ºè®®å¤§å®¶ç”¨å®¢è§‚çš„æ€åº¦çœ‹å¾…å…¬å¸ä¸ºå‘˜å·¥è´­ä¹°çš„å›¢é™©ã€‚å®ƒæ˜¯ä¸€ç§æå¥½çš„å‘˜å·¥ç¦åˆ©ï¼Œå®ƒåº”è¯¥æ˜¯å‘˜å·¥è‡ªèº«å·²è´­ä¿é™©çš„æœ‰åŠ›è¡¥å……ï¼Œå´ä¸èƒ½è¢«å½“ä½œå…¨éƒ¨ã€‚ äº†è§£å…¬å¸çš„å›¢é™©æ”¿ç­– è¿™ä»½å›¢é™©è®¡åˆ’é‡Œæœ‰æ¶µç›–èº«æ•…è´£ä»»çš„äº§å“å—ï¼Ÿ å¦‚æœæœ‰ï¼Œä¿é¢æ˜¯å¤šå°‘ï¼Ÿ å¦‚æœå‘˜å·¥è·å¾—æ™‹å‡ï¼Œä¿é¢ä¼šéšä¹‹æé«˜å—ï¼Ÿ 03 é‡ç‚¹å…³æ³¨ï¼šä¸­äº§å¿…å¤‡çš„â€œå››å¤§ä¿é™©é‡‘åˆšâ€ é‡å¤§ç–¾ç—…é™©ï¼šä¸ºäº†ä¸è¢«æ”¹å˜çš„äººç”Ÿ é‡ç–¾é™©çš„è¯ç”Ÿï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸ºäº†è§£å†³æ”¶å…¥ä¸­æ–­çš„é£é™©ï¼Œç«™åœ¨æ‚£è€…åŠå…¶å®¶äººçš„è§’åº¦ï¼Œä¸ºå·²åœ¨é‡ç—…æ·±æ¸Šçš„å®¶åº­æä¾›é›ªä¸­é€ç‚­èˆ¬çš„ç»æµè¡¥å¿ é‡ç–¾é™©ç©¶ç«Ÿä¿ä»€ä¹ˆ ä»€ä¹ˆå«â€œé‡å¤§ç–¾ç—…â€ï¼Ÿ ä¿ç›‘ä¼šå®‰æ’ä¸­å›½ä¿é™©è¡Œä¸šåä¼šå’Œä¸­å›½åŒ»å¸ˆåä¼šï¼Œåœ¨2007å¹´æ‹¿å‡ºäº†ä¸€ç‰ˆ25ç§é‡ç–¾æ ‡å‡†ï¼Œå›Šæ‹¬æ‰€æœ‰é«˜å‘é‡ç–¾ç±»å‹ï¼ˆå…¶å®ï¼Œåªè¦æ˜¯é‡ç–¾é™©å°±éƒ½åŒ…æ‹¬è¿™25ç§ï¼‰ ä¿ç›‘ä¼šè®¾å®šçš„è¿™25ç§é‡å¤§ç–¾ç—…ï¼Œå…¶å‘ç”Ÿæ¦‚ç‡è¶…è¿‡95%çš„ç–¾ç—…ç§ç±»ã€‚ æ‰€ä»¥å¦‚æœä¸€ä¸ªä¿é™©è¯´ä»–åŒ…å«æ›´å¤šçš„é‡ç–¾ï¼Œç„¶åè®©æˆ‘ä»¬å¤šèŠ±é’±ä¹°å®ƒï¼Œå…¶å®æ²¡æœ‰å¤ªå¿…è¦ã€‚ ä»€ä¹ˆå«â€œç½¹æ‚£â€ï¼Ÿ ç¬¬ä¸€ï¼Œç—…æƒ…è¾¾åˆ°æŸä¸ªæ ‡å‡†ï¼Œç›¸å½“äºç¡®è¯Šå³èµ”ï¼Œæ¯”å¦‚æ¶æ€§è‚¿ç˜¤ ç¬¬äºŒï¼ŒæŠ•ä¿äººä¸ºæ²»ç–—æŸç§ç–¾ç—…è€Œæ¥å—äº†æŸç§æ²»ç–—æ–¹æ³•ã€‚æ¯”å¦‚å¿ƒè„ç“£è†œæ‰‹æœ¯ ç¬¬ä¸‰ï¼ŒæŸç§çŠ¶æ€æŒç»­äº†ä¸€æ®µæ—¶é—´ã€‚æ¯”å¦‚è„‘ä¸­é£åé—ç—‡ é™¤äº†é‡å¤§ç–¾ç—…ï¼Œé‡ç–¾é™©è¿˜ä¿è¿™äº› å½“é‡ç–¾é™©çš„è´£ä»»åªæœ‰é‡å¤§ç–¾ç—…æ—¶ï¼Œæ¶ˆè´¹è€…ç†æ‰€å½“ç„¶åœ°æå‡ºäº†ä¸€ä¸ªæŒ¯è‹å‘è©çš„é—®é¢˜ï¼šå¦‚æœæˆ‘ä¸€è¾ˆå­æ²¡å¾—é‡ç–¾ï¼Œè¿™ä¿è´¹å²‚ä¸æ˜¯ç™½äº¤äº†ï¼Ÿ å¥½ï¼Œä¸ºäº†ä¸è®©ä½ ç™½äº¤ï¼Œä¿é™©å…¬å¸ç´¢æ€§å¢åŠ äº†å¾ˆå¤šå…¶ä»–è´£ä»»ï¼Œâ€œé¡ºä¾¿â€æå‡äº†ä¿è´¹ã€‚ä¹°å–åŒæ–¹éƒ½é«˜å…´ï¼Œè¿™ç§å•†ä¸šæ¨¡å¼å ªç§°å®Œç¾ã€‚ åœ¨æ–°å¢çš„è´£ä»»é‡Œï¼Œç¬¬ä¸€ç±»æ˜¯â€œèº«æ•…è´£ä»»â€ã€‚è¿™ç§åŒ…å«èº«æ•…è´£ä»»çš„é‡ç–¾é™©ï¼ŒåŸºæœ¬ä¸Šéƒ½å¯ä»¥â€œæå‰ç»™ä»˜â€ã€‚ è¿™é‡Œçš„æå‰æŒ‡çš„æ˜¯é‡ç–¾ã€èº«æ•…äºŒè€…ä¸­å“ªä¸ªå…ˆå‘ç”Ÿï¼Œå°±ç»™ä»˜å“ªä¸ªã€‚ æå‰ç»™ä»˜ä¸è¿‡æ˜¯ä¸€ç§äº§å“è®¾è®¡ç½¢äº†ï¼Œåƒä¸‡åˆ«è§‰å¾—å®ƒæ˜¯ä¸€é¡¹ç‹¬ç‰¹çš„ä¼˜åŠ¿ã€‚ ç¬¬äºŒç±»æ–°å¢è´£ä»»æ˜¯è½»ç—‡å’Œä¸­ç—‡è´£ä»» ç¬¬ä¸‰ç±»æ–°å¢è´£ä»»æ˜¯é’ˆå¯¹é‡å¤§ç–¾ç—…çš„èŠ±æ ·èµ”ä»˜æ–¹å¼ã€‚æ¯”å¦‚é‡ç–¾å’Œè½»ç—‡å¯ä»¥èµ”ä»˜å¤šæ¬¡ï¼Œåˆæ¯”å¦‚æŒ‘å‡ºæŸå‡ ä¸ªç—…ç§é¢å¤–èµ”ä»˜50%çš„ä¿é¢ï¼Œå†æ¯”å¦‚æŠ•ä¿åå‰10å¹´äº«å—ä¿é¢é¢å¤–å¢åŠ 50%ã€‚ ä¸Šé¢è¯´çš„è¿™äº›éƒ½æ˜¯åœ¨å¢åŠ ä¿è´¹çš„åŸºç¡€ä¸Šå¢åŠ äº†æ›´å¤šçš„è´£ä»»ï¼Œæ‰€ä»¥å½“ä¿é™©å…¬å¸è¯´æˆ‘ä»¬ä¿çš„å¤šçš„æ—¶å€™é™¤éå’Œåˆ«äººä»·æ ¼ä¸€æ ·ï¼Œå¦åˆ™åªæ˜¯åœ¨éª—æˆ‘ä»¬èŠ±æ›´å¤šé’±è€Œå·²ã€‚ é‡ç–¾é™©çš„ä¿é¢åŠå…¶ä»– å¦‚ä½•ç¡®å®šä¿é¢ æ‚£é‡ç–¾åï¼Œæ‚£è€…æ™®éé¢ä¸´çš„æ˜¯3~5å¹´çš„æ²»ç–—åº·å¤æœŸ ä¸æ­¤åŒæ—¶ï¼Œé‡ç–¾å¯¼è‡´æ”¶å…¥ä¸­æ–­å°†ä¸ºå®¶åº­å¸¦æ¥æ›´å¤§çš„å‹åŠ› å› æ­¤ï¼Œé‡ç–¾é™©çš„ä¿é¢åº”è‡³å°‘è¦†ç›–æŠ•ä¿äºº3~5å¹´çš„æ”¶å…¥ å¦‚å¹´æ”¶å…¥20ä¸‡å…ƒçš„ä¿é¢åº”è¯¥åœ¨60ä¸‡ä»¥ä¸Š è€Œä¸”åªè¦ç¡®ä¿è¿™æ¬¾é‡ç–¾é™©èƒ½æä¾›60ä¸‡å…ƒçš„é‡ç–¾ä¿é¢ï¼Œæœ‰æ²¡æœ‰èº«æ•…è´£ä»»ã€å¤šæ¬¡èµ”ä»˜ã€æŠ•ä¿äººè±å…ï¼Œéƒ½æ— å…³ç´§è¦ é‡ç–¾é™©åº”è¯¥ä¿éšœå¤šä¹…å’Œäº¤å¤šå°‘å¹´ä¿è´¹ã€‚ è®¨è®ºè¿™ä¸ªé—®é¢˜æœ‰ä¸€ä¸ªå‰æï¼šæˆ‘ä»¬é€‰æ‹©çš„æ˜¯é•¿æœŸäº§å“ã€‚ å¯¹äºé‡ç–¾é™©ã€å®šæœŸå¯¿é™©ï¼Œå¯ä»¥ä¿ç»ˆèº«æˆ–è€…ä¿åˆ°70å²å·¦å³çš„é•¿æœŸäº§å“ï¼Œæ˜¯æˆ‘ä»¬çš„é¦–é€‰â€”â€”ä¸ä»…ä»·æ ¼æ›´åˆ’ç®—ï¼Œä¹Ÿä¸ä¼šå‡ºç°ä¿é™©ä¸­æ–­çš„æƒ…å†µã€‚ é•¿æœŸé‡ç–¾é™©çš„ç¼´è´¹æœŸå¾€å¾€æœ‰å¤šç§é€‰æ‹©ï¼š è¶¸äº¤ï¼ˆä¸€æ¬¡æ€§äº¤å®Œï¼‰ 10å¹´äº¤ 20å¹´äº¤ å°‘æ•°äº§å“ç”šè‡³è¿˜è®¾è®¡äº†30å¹´äº¤ ä¿éšœæœŸé™ï¼š ä¿éšœæœŸé™çš„å»¶é•¿ï¼Œä¼šå¸¦æ¥ä¿è´¹çš„å‡é«˜ï¼›æ²¡åŠæ³•ï¼Œä¸€ä¸ªäººå¹´é¾„è¶Šå¤§ï¼Œç½¹æ‚£é‡ç–¾çš„æ¦‚ç‡å°±è¶Šé«˜ã€‚å¦‚æœé¢„ç®—å……è¶³ï¼Œä¿ç»ˆèº«å½“ç„¶æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚ åœ¨ç¡®ä¿ä¿é¢å……è¶³çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¿é¢æ‹†æˆä¸¤ä¸ªäº§å“æ¥å®ç°ï¼Œä¸€ä¸ªä¿åˆ°é€€ä¼‘ï¼Œå¦ä¸€ä¸ªä¿ç»ˆèº« å¦‚ï¼šå¯¹äºéœ€è¦60ä¸‡å…ƒé‡ç–¾é™©ä¿é¢çš„å°ç‹æ¥è¯´ï¼Œå¯ä»¥é€‰æ‹©ä¹°ä¸€ä»½ä¿ç»ˆèº«çš„30ä¸‡å…ƒä¿é¢çš„é‡ç–¾é™©ï¼Œå†ä¹°ä¸€ä»½ä¿åˆ°70å²çš„30ä¸‡å…ƒä¿é¢çš„é‡ç–¾é™©ã€‚è¿™æ¯”ç›´æ¥è´­ä¹°ä¸€ä»½ä¿ç»ˆèº«çš„60ä¸‡å…ƒä¿é¢çš„é‡ç–¾é™©ï¼ŒèŠ±è´¹æ›´å°‘ å®šæœŸå¯¿é™©ï¼šè§£å†³äººç”Ÿä¸­æœ€å¤§çš„é£é™© è°é€‚åˆä¹°å¯¿é™© å¦‚æœè¯´é‡ç–¾é™©çš„èµŒæ³¨æ˜¯ç—…ï¼Œå¯¿é™©çš„èµŒæ³¨å°±æ˜¯å‘½ã€‚å®šæœŸå¯¿é™©èµŒçš„åˆ™æ˜¯ä¸€æ®µæ—¶é—´çš„å‘½ã€‚æ¯”å¦‚æŠ•ä¿äººäº30å¹´å†…èº«æ•…ï¼Œå—ç›Šäººå³å¯è·å¾—ç†èµ”æ¬¾ã€‚ ä¸€èˆ¬çš„å®šæœŸå¯¿é™©ï¼Œé™¤äº†ä¿éšœèº«æ•…ï¼Œè¿˜ä¼šæŠŠå…¨æ®‹ä¹Ÿè§†ä½œä¸èº«æ•…ç­‰åŒçš„è´£ä»»ã€‚ å•èº«çš„äººç†åº”å…³å¿ƒçˆ¶æ¯çš„å…»è€é—®é¢˜ æ–°å©šçš„äººä¼šå¢åŠ å¯¹å¦ä¸€åŠçš„è€ƒè™‘ æœ‰äº†å­©å­åï¼Œè´£ä»»æ›´é‡ æ„å¤–é™©å’Œå¯¿é™©å¯¹æ¯” è¿™é‡Œéœ€è¦é¢å¤–å¼ºè°ƒä¸€ç‚¹ã€‚è°ˆåˆ°èº«æ•…é£é™©ï¼Œå¾ˆå¤šäººä¼šè”æƒ³åˆ°æ„å¤–é™©ï¼Œå› ä¸ºå®ƒä¸æ˜¯ä¹Ÿæœ‰èº«æ•…ä¿éšœå—ï¼Ÿ â€œç–¾ç—…â€å’Œâ€œæ„å¤–â€ä¸ºå æ¯”æœ€å¤§çš„ä¸¤ç±»æ­»äº¡åŸå› ï¼Œåˆ†åˆ«ä¸º79.3%å’Œ18.9%ã€‚ æ‰€ä»¥ï¼Œå•çº¯è´­ä¹°æ„å¤–é™©ï¼Œæ˜¯æ— æ³•è§£å†³èº«æ•…çš„é£é™©çš„ã€‚ å¦‚ä½•é€‰è´­å®šæœŸå¯¿é™©ï¼Ÿ ç¡®å®šä¿é¢æ˜¯å…³é”®æ€§çš„ç¬¬ä¸€æ­¥ ä¿é¢çš„é«˜ä½ï¼Œå†³å®šäº†æŠ•ä¿äººèº«æ•…åä»–çš„å¦»å­ã€çˆ¶æ¯æˆ–è€…å­©å­èƒ½æ‹¿åˆ°å¤šå°‘è¡¥å¿ã€‚å®šæœŸå¯¿é™©çš„ä¿é¢ï¼Œä¸»è¦å–å†³äºä¸‰ä¸ªå› ç´ ã€‚ ä¸€æ˜¯ä¸ªäººå’Œå®¶åº­çš„å€ºåŠ¡é¢åº¦ï¼Œæ¯”å¦‚æˆ¿è´·ã€è½¦è´·ç­‰ï¼Œç¡®ä¿ä¸€æ–¹èº«æ•…åï¼Œå€ºåŠ¡ä¸è½¬å«åˆ°å¦ä¸€æ–¹æˆ–çˆ¶æ¯èº«ä¸Š äºŒæ˜¯å®¶åº­æˆå‘˜çš„åŸºæœ¬ç”Ÿæ´»æˆæœ¬ã€‚å¦‚æœå®¶åº­æ¯å¹´çš„å¼€é”€ä¸º20ä¸‡å…ƒï¼Œé‚£ä¹ˆèº«æ•…ç†èµ”é‡‘è‡³å°‘åº”ä¸º100ä¸‡å…ƒï¼Œä»¥è´Ÿæ‹…å®¶åº­æœªæ¥5â€”10å¹´çš„åŸºæœ¬ç”Ÿæ´»å¼€é”€ã€‚ ä¸‰æ˜¯çˆ¶æ¯çš„å…»è€æ”¯å‡ºï¼Œè¿™ç¬”è´¹ç”¨çš„è®¡ç®—é€»è¾‘å’Œä¸Šä¸€ä¸ªç±»ä¼¼ã€‚ å®šæœŸå¯¿é™©è¿˜è¦è€ƒè™‘çš„é—®é¢˜æ˜¯ä¿éšœæœŸé™ åˆ°åº•è¦ä¿åˆ°å¤šå¤§å¹´é¾„å‘¢ï¼Ÿæˆ‘ä¸ªäººå»ºè®®ï¼Œä»¥é€€ä¼‘å¹´é¾„ä¸ºæ ‡å‡†ï¼Œ60å²æˆ–70å²çš†å¯ã€‚ è‡³äºç¼´è´¹å¹´é™çš„é€‰æ‹©ï¼Œæˆ‘å»ºè®®å°½å¯èƒ½æ‹‰é•¿ï¼Œ20å¹´äº¤æˆ–30å¹´äº¤çš†å¯ã€‚ç¼´è´¹å¹´é™è¶Šé•¿ï¼Œå¹´å‡ä¿è´¹è¶Šä½ï¼Œä»è€Œåšåˆ°ç”¨å°½å¯èƒ½å°‘çš„é’±å»æ’¬åŠ¨å°½å¯èƒ½é«˜çš„ä¿é¢ã€‚ ä¿é¢ã€ä¿éšœæœŸé™å’Œç¼´è´¹å¹´é™éƒ½ç¡®å®šåï¼Œæˆ‘ä»¬åœ¨é€‰è´­å…·ä½“äº§å“æ—¶ï¼Œè¿˜è¦æ ¼å¤–å…³æ³¨ä¸‰ä¸ªæ–¹é¢ï¼š ç¬¬ä¸€ï¼Œæ ¸ä¿æ˜¯å¦å®½æ¾ã€‚è¿™æ˜¯æœ€é‡è¦çš„ï¼Œå› ä¸ºå¦‚æœå¥åº·å‘ŠçŸ¥éå¸¸ä¸¥æ ¼ï¼Œæƒ³ä¹°ä¹Ÿä¹°ä¸äº†ï¼Œä½•è°ˆå…¶ä»–ï¼Ÿæ¯”å¦‚ï¼Œæœ‰çš„å®šæœŸå¯¿é™©ä¸æ¥å—ä¹™è‚å°ä¸‰é˜³æ‚£è€…ï¼Œæœ‰çš„ä¸æ¥å—é«˜å±èŒä¸šä»ä¸šè€…ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€å®šè¦å¼„æ¸…æ¥šæŠ•ä¿è¦æ±‚å†ä¹°ï¼Œå°½é‡é¿å…ç†èµ”æ—¶çš„æ½œåœ¨çº çº·ï¼Œæ‰èƒ½çœŸæ­£åšåˆ°å®‰å¿ƒã€‚ ç¬¬äºŒï¼Œé™¤å¤–è´£ä»»å¤šä¸å¤šã€‚å‰æ–‡åœ¨åˆ†æå¦‚ä½•é˜…è¯»ä¿é™©æ¡æ¬¾çš„æ—¶å€™ï¼Œä¸“é—¨å¼ºè°ƒè¦å…³æ³¨é™¤å¤–è´£ä»»ã€‚æ¯”å¦‚ï¼Œæœ‰çš„å®šæœŸå¯¿é™©æ˜ç¡®æŒ‡å‡ºï¼Œå› ä¸ºæˆ˜äº‰ã€å†›äº‹æš´ä¹±å¯¼è‡´çš„æ­»äº¡ï¼Œå®ƒä»¬æ¦‚ä¸è´Ÿè´£ã€‚é‚£ä¹ˆï¼Œå¯¹äºå»ä¸­ä¸œã€éæ´²ç­‰åœ°åŒºæ—…æ¸¸æˆ–å·¥ä½œçš„ä¸­å›½äººæ¥è¯´ï¼Œè¿™ç§å®šæœŸå¯¿é™©å°±å¾—æ…é‡è€ƒè™‘è´­ä¹°äº†ã€‚ ç¬¬ä¸‰ï¼Œä»·æ ¼ä½ä¸ä½ã€‚å¦‚æœä¸Šé¢å‡ æ¡æ ‡å‡†æ¯”è¾ƒèµ·æ¥éƒ½å·®ä¸å¤šï¼Œé—®é¢˜å°±å˜ç®€å•äº†ï¼šå“ªä¸ªäº§å“ä¾¿å®œå°±é€‰æ‹©å“ªä¸ªã€‚ å•†ä¸šåŒ»ç–—é™©ï¼šè®©é«˜é¢åŒ»ç–—å¼€æ”¯ä¸å†å¯æ€• ç¤¾ä¼šåŒ»ç–—ä¿é™© åœ¨ç”¨åŒ»ä¿å¡çœ‹ç—…çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éƒ½æ¥è§¦è¿‡ä¸€äº›é™Œç”Ÿçš„åè¯ï¼Œæ¯”å¦‚èµ·ä»˜çº¿ã€è¯å“ç›®å½•ã€è‡ªè´¹è¯ã€æŠ¥é”€é¢åº¦ç­‰ã€‚ èµ·ä»˜çº¿ï¼šçš„æ„æ€æ˜¯ï¼Œæ¯å¹´åªæœ‰èŠ±åˆ°ä¸€å®šé‡‘é¢ï¼Œæ‰èƒ½å¼€å§‹æŠ¥é”€ï¼Œå¦åˆ™å°±éƒ½æ˜¯è‡ªè´¹ è¯å“ç›®å½•ï¼šæŒ‡çš„æ˜¯åœ¨åŒ»ä¿ç³»ç»Ÿä¸­ï¼Œå¯¹äºåŒ»ç–—æœºæ„å¼€å…·çš„è¯å“åšäº†ä¸åŒåˆ†ç±»ï¼Œä¸åŒç±»å‹çš„è¯å“æŠ¥é”€é¢åº¦ä¹Ÿä¸ä¸€æ ·ï¼Œæœ‰çš„å¯å…¨éƒ¨æŠ¥é”€ï¼Œæœ‰çš„åˆ™åªå¯æŠ¥é”€ä¸€éƒ¨åˆ†ï¼Œè¿˜æœ‰çš„è¯å…¨éƒ¨è¦è‡ªè´¹è´­ä¹° é”€é¢åº¦å¾ˆå¥½ç†è§£ï¼Œå³ä½¿è¯å“ã€æ²»ç–—ç­‰éƒ½åœ¨æŠ¥é”€èŒƒå›´å†…ï¼ŒåŒ»ä¿ä¹Ÿä¸æ˜¯æ— é™åˆ¶çš„æŠ¥é”€ï¼Œæ•´ä½“æ¥çœ‹ï¼Œæ¯å¹´çš„æŠ¥é”€é¢åº¦èŒƒå›´ä¸º20ä¸‡~30ä¸‡å…ƒï¼›å¯¹äºç½¹æ‚£é‡å¤§ç–¾ç—…çš„æ‚£è€…æ¥è¯´ï¼Œè¿™ä¸€é¢åº¦æ ¹æœ¬æ— æ³•æ»¡è¶³ä»–ä»¬é•¿æœŸã€æ˜‚è´µçš„æ²»ç–—éœ€æ±‚ã€‚ åŒ»ä¿ä¸ç®¡çš„ï¼Œè®©å•†ä¸šåŒ»ç–—ä¿é™©æ¥ç®¡ åŒ»ç–—é™©å…¶å®åªåŒ…æ‹¬ä¸¤ç§äº§å“ ç¬¬ä¸€ç§æ˜¯åŒ…å«é—¨è¯Šè´£ä»»çš„å•†ä¸šåŒ»ç–—ä¿é™©ï¼Œå¯æš‚ä¸”ç§°ä¹‹ä¸ºé—¨è¯ŠåŒ»ç–—ä¿é™© è¿™ç§äº§å“ä¿é¢ä¸é«˜ï¼Œä¸€èˆ¬æ˜¯å‡ åƒå…ƒã€‚æœ‰çš„é—¨è¯ŠåŒ»ç–—ä¿é™©ä¼šè®¾ç½®ä¸€ä¸ªå…èµ”é¢ï¼Œæ¯”å¦‚å•æ¬¡100å…ƒæˆ–è€…ç´¯è®¡500å…ƒã€‚å…èµ”é¢å’Œæ”¿åºœåŒ»ä¿èµ·ä»˜çº¿æ˜¯åŒä¸€ä¸ªæ¦‚å¿µï¼Œéƒ½æ˜¯ä¸ºäº†å‡å°‘ç†èµ”æ”¯å‡ºï¼Œå®é™…ä¸Šä¹Ÿèµ·åˆ°äº†é™ä½ä¿è´¹çš„ä½œç”¨ã€‚ ç¬¬äºŒç§æ˜¯åŒ…å«ä½é™¢è´£ä»»çš„å•†ä¸šåŒ»ç–—ä¿é™©ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºä½é™¢åŒ»ç–—ä¿é™©ã€‚ è¿™ç±»äº§å“çš„ä¿é¢å°±é«˜å¤šäº†ï¼Œå‡ åä¸‡å…ƒç”šè‡³ä¸Šç™¾ä¸‡å…ƒéƒ½å¾ˆå¸¸è§ã€‚å’Œé—¨è¯ŠåŒ»ç–—ä¿é™©ç›¸æ¯”ï¼Œä½é™¢åŒ»ç–—ä¿é™©æ˜¯ä¸‹æ–‡è¦é‡ç‚¹ä»‹ç»çš„äº§å“ã€‚ èƒ½è¢«ç§°ä½œé£é™©çš„ï¼Œå¿…ç„¶æ„å‘³ç€è´¢åŠ¡ä¸Šçš„å·¨å¤§å½±å“ã€‚æ‰€ä»¥å’Œå‡ åä¸‡ç”šè‡³ä¸Šç™¾ä¸‡å…ƒçš„åŒ»ç–—æ”¯å‡ºç›¸æ¯”ï¼Œå‡ åƒå…ƒçš„é—¨è¯Šã€ä½é™¢è´¹ç”¨ï¼ŒçœŸçš„ç§°ä¸ä¸Šé£é™©ã€‚ ä¹°äº†é‡ç–¾é™©ï¼Œè¿˜è¦ä¹°åŒ»ç–—é™©å— é‡ç–¾é™©å’Œå•†ä¸šåŒ»ç–—æœ€é‡è¦çš„åŒºåˆ«ï¼Œæ˜¯ä¿é™©å…¬å¸çš„ç†èµ”æ–¹å¼ä¸ä¸€æ · é‡ç–¾é™©æœ‰ç‚¹å„¿åƒä¸€é”¤å­ä¹°å–ï¼Œåªè¦ç¬¦åˆæ¡æ¬¾è§„å®šï¼Œä¿é™©å…¬å¸å°±ä¼šæŠŠç†èµ”æ¬¾ä¸€æ¬¡æ€§æ‰“ç»™ä½ ï¼Œæ— è®ºæ˜¯å‡ ä¸‡å…ƒè¿˜æ˜¯å‡ åä¸‡å…ƒã€‚ å•†ä¸šåŒ»ä¿å°±ä¸ä¸€æ ·äº†ï¼ŒèŠ±å¤šå°‘æ‰èƒ½èµ”å¤šå°‘ï¼Œä¿é¢ä»…ä»£è¡¨å¯æŠ¥é”€é¢åº¦çš„ä¸Šé™ï¼Œè€Œä½ ä¸ä¸€å®šèƒ½èŠ±æ‰è¿™ä¹ˆå¤šé’± å¦‚æœä¸€ä¸ªäººç½¹æ‚£å½±å“æ­£å¸¸ç”Ÿæ´»çš„é‡å¤§ç–¾ç—…ï¼Œé‚£ä»–ä¸»è¦é¢ä¸´çš„é—®é¢˜æœ‰ä¸¤ä¸ªï¼šä¸€æ˜¯æ²»ç–—è´¹ç”¨å¤ªé«˜ï¼Œæç©ºå®¶åº•ï¼›äºŒæ˜¯æ— æ³•ç»§ç»­å·¥ä½œï¼Œå¤±å»æ”¶å…¥ã€‚å‰è€…å¯ä»¥é å•†ä¸šåŒ»ç–—ä¿é™©è§£å†³ï¼Œåè€…åˆ™åªèƒ½é é‡ç–¾é™©è§£å†³ï¼Œä¸¤ç±»ä¿é™©çš„åŠŸèƒ½ä¸ä¸€æ ·ã€‚ é‡ç–¾é™©å’Œå•†ä¸šåŒ»ç–—ä¿é™©åœ¨å®šä»·æ–¹é¢çš„åŒºåˆ« é•¿æœŸé‡ç–¾é™©æ¯å¹´çš„ä¿è´¹æ˜¯æ’å®šçš„ï¼Œå•†ä¸šåŒ»ç–—ä¿é™©çš„ä¿è´¹åˆ™ä¼šéšç€è¢«ä¿é™©äººå¹´é¾„çš„å¢åŠ è€Œä¸Šè°ƒ é‡ç–¾é™©å’Œå•†ä¸šåŒ»ç–—ä¿é™©åœ¨ç»­ä¿æ–¹é¢çš„åŒºåˆ« ç›®å‰å¸‚åœºä¸Šå¤§å¤šæ•°åŒ»ç–—é™©éƒ½æ˜¯ä¸€å¹´æœŸäº§å“ï¼Œå¦‚æœç¬¬äºŒå¹´ä½ æƒ³ç»§ç»­æŠ•ä¿ï¼Œå¾—å…ˆçœ‹çœ‹ä¿é™©æ¡æ¬¾æ˜¯æ€ä¹ˆè§„å®šçš„ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š ç¬¬ä¸€ç§æ˜¯ï¼Œå–ä¸å–ç»™ä½ ï¼Œæˆ‘è¯´äº†ç®—ã€‚æŠ•ä¿äººçš„ç»­ä¿ç”³è¯·é¡»ç»ä¿é™©äººå®¡æ ¸åŒæ„ï¼ŒæŠ•ä¿äººç”³è¯·ç»­ä¿æ—¶ï¼Œä¿é™©äººæœ‰æƒå¯¹è´¹ç‡è¿›è¡Œè°ƒæ•´ã€‚ ç¬¬äºŒç§è§„å®šæ˜¯ï¼Œåªè¦è¿™ä¸ªäº§å“è¿˜åœ¨é”€å”®ï¼Œä¿é™©å…¬å¸å°±è‚¯å®šä¼šå–ç»™ä½ ã€‚è¿ç»­æŠ•ä¿æ—¶ï¼Œä¿é™©äººä¸ä¼šå› ä¸ºæŸä¸€è¢«ä¿é™©äººçš„å¥åº·çŠ¶å†µå˜åŒ–æˆ–å†å²ç†èµ”æƒ…å†µè€Œå•ç‹¬è°ƒæ•´è¯¥è¢«ä¿é™©äººçš„è¿ç»­æŠ•ä¿è´¹ç‡ã€‚ æ„å¤–é™©ï¼šä¸å®¹å¿½è§†çš„â€œå°â€ä¿é™© æ„å¤–é™©ä¿ä»€ä¹ˆã€ä¸ä¿ä»€ä¹ˆ é­å—å¤–æ¥çš„ã€çªå‘çš„ã€éæœ¬æ„çš„ã€éç–¾ç—…çš„ä½¿èº«ä½“å—åˆ°ä¼¤å®³çš„å®¢è§‚äº‹ä»¶ã€‚è‡ªç„¶æ­»äº¡ã€ç–¾ç—…èº«æ•…ã€çŒæ­»ã€è‡ªæ€åŠè‡ªä¼¤å‡ä¸å±äºæ„å¤–ä¼¤å®³ã€‚ åœ¨æ¯ä»½æ„å¤–é™©çš„ä¿é™©æ¡æ¬¾é‡Œï¼Œä½ éƒ½èƒ½çœ‹åˆ°è¿™æ ·çš„æè¿°ã€‚è¿™æ®µè¯è¡¨è¾¾äº†ä¸¤å±‚æ„æ€ï¼š ç¬¬ä¸€ï¼Œå¤–æ¥çš„ã€çªå‘çš„ã€éæœ¬æ„çš„ã€éç–¾ç—…çš„ä½¿èº«ä½“å—åˆ°ä¼¤å®³çš„å®¢è§‚äº‹ä»¶ï¼Œå±äºæ„å¤–ï¼› ç¬¬äºŒï¼Œè‡ªç„¶æ­»äº¡ã€ç–¾ç—…èº«æ•…ã€çŒæ­»ã€è‡ªæ€åŠè‡ªä¼¤ï¼Œä¸å±äºæ„å¤–ã€‚ é™¤äº†çŒæ­»ï¼Œæ„å¤–é™©è¿˜æœ‰ä¸€äº›â€œä¸ä¿â€ï¼š æ„å¤–é™©é€šå¸¸ä¸ä¿é«˜å±èŒä¸šä»ä¸šè€… é™¤äº†ç‰¹å®šäººç¾¤â€œä¸ä¿â€ï¼Œè¿˜æœ‰æŸç±»åœ°åŒºâ€œä¸ä¿â€ã€‚å…³äºæ„å¤–åŒ»ç–—è´£ä»»ï¼Œä¿é™©æ¡æ¬¾ä¸­å¾€å¾€ä¼šæœ‰ä¸€ä¸ªè¡¥å……æè¿°ï¼šåªæ‰¿æ‹…ä¸­åäººæ°‘å…±å’Œå›½å›½å¢ƒå†…ï¼ˆä¸åŒ…æ‹¬æ¸¯æ¾³å°åœ°åŒºï¼‰åŒ»é™¢äº§ç”Ÿçš„åŒ»ç–—è´¹ç”¨å’Œæ”¯å‡ºã€‚ æœ€åä¸€ä¸ªâ€œä¸ä¿â€ï¼Œæ˜¯æŸäº›è¡Œä¸ºä¸ä¿ã€‚è¢«ä¿é™©äººä»äº‹æ½œæ°´ã€è·³ä¼ã€æ”€å²©è¿åŠ¨ã€æ¢é™©æ´»åŠ¨ã€æ­¦æœ¯æ¯”èµ›ã€æ‘”è·¤æ¯”èµ›ã€ç‰¹æŠ€è¡¨æ¼”ã€èµ›é©¬ã€èµ›è½¦ç­‰é«˜é£é™©æ´»åŠ¨æœŸé—´å‘ç”Ÿçš„æ„å¤–ï¼Œä¸åœ¨æ„å¤–é™©çš„è´£ä»»èŒƒå›´å†… é…ç½®æ„å¤–é™©çš„å‡ æ¡åŸåˆ™ åŸåˆ™ä¸€ï¼šå¿…é¡»æ¶µç›–æ„å¤–åŒ»ç–—è´£ä»»ã€‚ æ„å¤–å¯¼è‡´çš„ç»“æœæ— éä¸¤ç§ï¼šä¼¤æ®‹å’Œæ­»äº¡ã€‚å› æ­¤ï¼Œæ„å¤–é™©ä¿éšœçš„è´£ä»»æœ‰ä¸‰ä¸ªå¿…é€‰é¡¹ï¼šèº«æ•…ã€ä¼¤æ®‹ã€åŒ»ç–—ã€‚ æ„å¤–å—ä¼¤åï¼Œæˆ‘ä»¬æœ€å¤§çš„éœ€æ±‚å°±æ˜¯åŒ»ç–—è´¹ç”¨è¡¥å¿ã€‚è€ƒè™‘åˆ°å¾ˆå¤šæ„å¤–äº§ç”Ÿçš„åŒ»ç–—è´¹ç”¨åŒ»ä¿éƒ½æ— æ³•æŠ¥é”€ï¼Œæ„å¤–é™©çš„åŒ»ç–—è´£ä»»å°±æ›´é‡è¦äº†ã€‚ è‡³äºæ„å¤–åŒ»ç–—çš„ä¿é¢ï¼Œä¸€ä¸¤ä¸‡å°±è¶³å¤Ÿäº†ã€‚å¦‚æœæ˜¯ä¸€ä¸¤ä¸‡å…ƒéƒ½æ²»ä¸å¥½çš„æ„å¤–å—ä¼¤ï¼Œä¸€å®šå·²ç»ä¸¥é‡åˆ°éœ€è¦åšæ‰‹æœ¯æˆ–è€…é•¿æœŸä½é™¢æ²»ç–—äº†ï¼Œè¿™æ—¶ç†èµ”çš„è´£ä»»å°±å¯ä»¥äº¤ç»™ä¸Šæ–‡æåˆ°çš„ä½é™¢åŒ»ç–—ä¿é™©äº†ã€‚ å¦å¤–ï¼Œä½ å¯èƒ½å¬è¯´è¿‡ä½é™¢æ´¥è´´æˆ–ä½é™¢ä¿é™©é‡‘ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼ŒæŠ•ä¿äººæ¯ä½ä¸€å¤©é™¢ï¼Œä¿é™©å…¬å¸å°±ä¼šæ”¯ä»˜ç»™ä»–å‡ ç™¾å…ƒé’±ï¼Œä¸»è¦æ˜¯ä¸ºäº†å¼¥è¡¥ä½é™¢æœŸé—´çš„æ”¶å…¥æŸå¤±ï¼Œé¢‡ä¸ºè´´å¿ƒï¼Œæœ¬è´¨ä¸Šä¹Ÿå±äºæ„å¤–åŒ»ç–—çš„è´£ä»»èŒƒå›´ã€‚ä½é™¢æ´¥è´´å±äºé”¦ä¸Šæ·»èŠ±å‹ä¿é™©ï¼Œè€Œä¸”è¦èŠ±é’±è´­ä¹°ï¼Œæ‰€ä»¥æœ‰æ²¡æœ‰éƒ½æ— æ‰€è°“ã€‚ åŸåˆ™äºŒï¼šä¸€èˆ¬æ„å¤–èº«æ•…çš„ä¿é¢åº”è¶³å¤Ÿé«˜ã€‚ åœ¨è¿™é‡Œæˆ‘è¦æé†’å¤§å®¶æ³¨æ„æŸäº›ä¿é™©å…¬å¸çš„â€œå¥—è·¯â€ã€‚å½“ä½ çœ‹åˆ°ä¸€ä¸ªç±»ä¼¼äºâ€œç™¾ä¸‡èº«ä»·æ„å¤–é™©â€çš„æ‰“æŠ˜äº§å“æ—¶ï¼Œè¯·ä¸€å®šå¼„æ¸…æ¥šå®ƒæ‰€è¯´çš„ç™¾ä¸‡èº«ä»·åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰ä¸ªäº§å“é¡µé¢æ˜¯è¿™ä¹ˆæè¿°è¯¥äº§å“çš„ï¼š ä¸€èˆ¬æ„å¤–èº«æ•…ï¼š10ä¸‡å…ƒ èˆªç©ºæ„å¤–èº«æ•…ï¼š100ä¸‡å…ƒ æˆ‘æ›´å–œæ¬¢ä»¥ä¸‹è¿™ç±»ä¿é™©ï¼š ä¸€èˆ¬æ„å¤–èº«æ•…ï¼š100ä¸‡å…ƒ èˆªç©ºæ„å¤–èº«æ•…ï¼š200ä¸‡å…ƒ åŸåˆ™ä¸‰ï¼šä¸åŒäººç¾¤çš„æ„å¤–é™©ï¼Œä¾§é‡ç‚¹ä¸ä¸€æ ·ã€‚ å¯¹äºèŒåœºç™½é¢†æ¥è¯´ï¼Œæ„å¤–é™©æ—¢è¦æœ‰è¶³å¤Ÿçš„èº«æ•…è¡¥å¿ï¼ˆç”¨äºå¼¥è¡¥å®¶åº­ç»æµæŸå¤±ï¼‰ï¼Œä¹Ÿè¦ä¿è¯å—ä¼¤åæœ‰é’±æ²»ç–—ï¼› ä½†å¯¹äºå­©å­å’Œè€äººæ¥è¯´ï¼Œèº«æ•…è¡¥å¿å°±æ²¡æœ‰åŒ»ç–—è´¹ç”¨è¡¥å¿é‡è¦ï¼Œæ¯•ç«Ÿä»–ä»¬ä¸æ˜¯å®¶é‡Œçš„é¡¶æ¢æŸ±ã€‚ å› æ­¤ï¼Œå­©å­å’Œè€äººçš„æ„å¤–é™©ï¼Œåº”ä¾§é‡äºè€ƒè™‘æå‡æ„å¤–åŒ»ç–—çš„ä¿é¢ï¼Œè€Œæ²¡æœ‰å¿…è¦è¿½æ±‚æ„å¤–èº«æ•…çš„é«˜ä¿é¢ã€‚ åŸåˆ™å››ï¼šä¿éšœæ—¶é—´ä¸€å¹´å°±å¤Ÿäº†ã€‚ ä¹‹å‰åœ¨ä»‹ç»ä¸€å¹´æœŸäº§å“ç‰¹å¾çš„æ—¶å€™æˆ‘æè¿‡ï¼Œæ„å¤–é™©å’ŒåŒ»ç–—é™©å¤§å¤šä¼šè®¾è®¡æˆçŸ­æœŸé™©ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå°±å¯ä»¥éšæ—¶æŒ‰ç…§æ„å¤–å‘ç”Ÿç‡å’ŒåŒ»ç–—æˆæœ¬çš„æ³¢åŠ¨è¿›è¡Œä»·æ ¼è°ƒæ•´ã€‚å› æ­¤ï¼Œæ¯å¹´å„å®¶å…¬å¸çš„æ„å¤–é™©å±‚å‡ºä¸ç©·ï¼Œå¯èƒ½å»å¹´ä¹°çš„äº§å“ï¼Œåˆ°äº†æ˜å¹´å°±æ²¡ä»€ä¹ˆç«äº‰åŠ›äº†ï¼Œè¿™æ—¶ç›´æ¥æ¢ä¸€å®¶å…¬å¸è´­ä¹°å°±å¥½ã€‚ç”±äºæ„å¤–é™©çš„å‡ ä¸ªåŸºæœ¬è´£ä»»éƒ½æ²¡æœ‰ç­‰å¾…æœŸè¿™ä¸€è¯´ï¼Œæ‰€ä»¥å¯ä»¥åšåˆ°æ— ç¼è¡”æ¥ã€‚ 04 ä¼˜åŒ–é…ç½®ï¼šç»™ä¿é™©å‡ä¸ªçº§ åƒæœ‰é’±äººä¸€æ ·çœ‹ç—… é«˜ç«¯åŒ»ç–—ï¼Œé«˜ç«¯åœ¨å“ªé‡Œï¼Ÿ ç¬¬ä¸€ï¼Œä¿é¢æ›´é«˜ã€‚å‡ åä¸‡å…ƒç”šè‡³å‡ ç™¾ä¸‡å…ƒçš„ä¿é¢éƒ½æ˜¯å°èœä¸€ç¢Ÿï¼Œä»å‡ åƒä¸‡å…ƒåˆ°ä¸è®¾é™ï¼Œé«˜ç«¯åŒ»ç–—çš„ä¿é¢å®Œå…¨è¶…ä¹ä½ çš„æƒ³è±¡ã€‚ ç¬¬äºŒï¼ŒåŒ»é™¢æ›´å¤šã€æ›´é«˜ç«¯ã€‚ä»ä¸‰ç”²åŒ»é™¢çš„ç‰¹éœ€éƒ¨ã€å›½é™…éƒ¨ï¼Œåˆ°ç§ç«‹åŒ»é™¢ã€å›½é™…åŒ»é™¢ï¼Œè€Œä¸”ä¸é™ä¸­å›½åœ°åŒºï¼Œä»äºšå¤ªåœ°åŒºåˆ°å…¨çƒï¼ŒåŸºæœ¬è¦†ç›–æ‰€æœ‰ç±»å‹çš„åŒ»ç–—æœºæ„ã€‚ ç¬¬ä¸‰ï¼Œä¿éšœæ›´å…¨é¢ã€‚é™¤äº†ä¼ ç»Ÿçš„é—¨è¯Šã€ä½é™¢ä¸¤å¤§å—ä¹‹å¤–ï¼Œé«˜ç«¯åŒ»ç–—é™©è¿˜åŒ…å«åˆ†å¨©ã€ç‰™ç§‘ã€çœ¼ç§‘ã€ä½“æ£€ç­‰è´£ä»»ï¼Œè¦çŸ¥é“ï¼Œè¿™äº›æ²»ç–—é€šå¸¸éƒ½åœ¨å¸¸è§„åŒ»ç–—é™©çš„é™¤å¤–é¡¹ç›®é‡Œï¼Œä¸€èˆ¬åŒ»ç–—é™©éƒ½ä¸ç®¡ã€‚ ç¬¬å››ï¼Œå¢å€¼æœåŠ¡æ›´å¤šã€‚ ç¬¬äº”ï¼Œç†èµ”ä½“éªŒæ›´å¥½ã€‚ ä¿é™©èƒ½ä¸ºæˆ‘çš„å…»è€åšä»€ä¹ˆï¼Ÿ è¯¥ä¸è¯¥ä¹°å…»è€ä¿é™©ï¼Ÿ å¯ä¸å¯ä»¥æŠŠä¿é™©å½“ä½œæŠ•èµ„æ–¹å¼ è¦å›ç­”ä¸Šé¢ä¸¤ä¸ªé—®é¢˜ï¼Œéœ€è¦ä½¿ç”¨excelä¸­çš„IRRå…¬å¼è®¡ç®—å†…éƒ¨æ”¶ç›Šç‡ï¼Œå¦‚æœå†…éƒ¨æ”¶ç›Šç‡èƒ½å¤Ÿè¾¾åˆ°é¢„æœŸå¹¶ä¸”ç°åœ¨æ‰‹å¤´æœ‰é’±å°±å¯ä»¥ä¹°ã€‚ æ¯”å¦‚å¹´å¤åˆ©6%ä»¥ä¸Šå°±èƒ½è¾¾åˆ°é¢„æœŸï¼Œå¦åˆ™ä¸å¦‚ä¹°å€ºåˆ¸åŸºé‡‘æˆ–è€…æŒ‡æ•°å‹åŸºé‡‘ã€‚ è¯¥å»é¦™æ¸¯ä¹°ä¿é™©å—ï¼Ÿ ç•¥ 05 ä¸ªæ€§åŒ–å®šåˆ¶ï¼šä¿é™©æ–¹æ¡ˆï¼Œä½ è‡ªå·±è¯´äº†ç®— å¦‚ä½•ç»™å­©å­ä¹°ä¿é™© å…ˆåˆ«ç€æ€¥ä¹°å•†ä¸šä¿é™© å’Œå¤§äººä¸€æ ·ï¼Œå­©å­ä¹Ÿæ˜¯å¯ä»¥å‚åŠ æ”¿åºœåŒ»ä¿çš„ã€‚åœ¨é…ç½®å•†ä¸šä¿é™©ä¹‹å‰ï¼Œçˆ¶æ¯ä¸€å®šè¦å‚è€ƒå½“åœ°çš„åŒ»ä¿æ”¿ç­–ä¸ºå­©å­åŠç†å°‘å„¿åŒ»ä¿ã€‚ å°‘å„¿åŒ»ä¿æœ¬è´¨ä¸Šæ˜¯é’ˆå¯¹å„¿ç«¥ç½¹æ‚£é‡å¤§ç–¾ç—…æä¾›çš„é£é™©ä¿éšœã€‚ æœ‰æ²¡æœ‰åŒ»ä¿ä¹Ÿä¼šå½±å“å­©å­æŠ•ä¿å•†ä¸šä¿é™©çš„ä»·æ ¼ã€‚å°¤å…¶æ˜¯åŒ»ç–—é™©ï¼Œè¢«ä¿é™©äººæœ‰åŒ»ä¿çš„åŒ»ç–—é™©ä»·æ ¼æ›´ä½ã€‚ å­©å­ä¼šé¢ä¸´å“ªäº›é£é™© é£é™©ä¸€ï¼šèº«æ‚£å±é‡ç–¾ç—… å­©å­ä¸€æ—¦æ‚£å±é‡ç–¾ç—…ï¼Œé™¤äº†éœ€è¦é•¿æœŸæŠ•å…¥é«˜é¢æ²»ç–—è´¹ç”¨ï¼Œçˆ¶æ¯ä¹Ÿå¯èƒ½ä¸ºäº†ç…§é¡¾å­©å­è€Œè¾æ‰å·¥ä½œã€‚ å› æ­¤ï¼Œé‡ç–¾é™©å’Œé«˜ä¿é¢ä½é™¢åŒ»ç–—é™©æ˜¯åº”è¯¥é¦–å…ˆä¸ºå­©å­é…ç½®çš„ä¿é™©ã€‚ é‡ç–¾é™©çš„ä»·å€¼åœ¨äºï¼Œç½¹æ‚£é‡ç–¾åä¸€æ¬¡æ€§è·å¾—å®šé¢èµ”å¿ï¼Œå¯ä½œä¸ºè‡ªè´¹æ²»ç–—è´¹ç”¨å’Œå®¶åº­æ”¶å…¥ä¸­æ–­çš„è¡¥å¿ã€‚ é«˜é¢ä½é™¢åŒ»ç–—é™©çš„ä»·å€¼åœ¨äºåº”å¯¹é«˜é¢çš„åŒ»ç–—è´¹ç”¨ï¼Œå°¤å…¶æ˜¯è®¸å¤šåŒ»ä¿èŒƒå›´å¤–çš„è‡ªè´¹é¡¹ç›® é£é™©äºŒï¼šå‘ç”Ÿæ„å¤–å—ä¼¤ é£é™©ä¸‰ï¼šèº«æ‚£ä¸€èˆ¬ç–¾ç—… é…ç½®å„¿ç«¥å•†ä¸šä¿é™© å­©å­ä¸è¯¥ä¹°å“ªäº›ä¿é™© åŒ…å«èº«æ•…è´£ä»»çš„æ„å¤–é™©ä¸åœ¨æˆ‘ä»¬çš„è®¨è®ºèŒƒå›´å†… å®šæœŸå¯¿é™©ã€ç»ˆèº«å¯¿é™©ä¹Ÿæ— éœ€è´­ä¹° é™¤æ„ä¹‰ä¸å¤§çš„èº«æ•…è´£ä»»å¤–ï¼Œä¸ºå­©å­è´­ä¹°æ•™è‚²é‡‘ã€å…»è€é‡‘ï¼Œä¼˜å…ˆçº§ä¹Ÿä¸é«˜ å­©å­çœŸæ­£éœ€è¦çš„å•†ä¸šä¿é™©å…¶å®åªæœ‰ä¸‰æ¬¾ï¼šé‡å¤§ç–¾ç—…é™©ã€æ„å¤–é™©ã€é«˜é¢ä½é™¢åŒ»ç–—é™©ã€‚ å…³äºå­©å­çš„é‡ç–¾é™© è¯·è®°ä½ä¸€ä¸ªäº‹å®ï¼šå°‘å„¿ç½¹æ‚£é‡å¤§ç–¾ç—…çš„æ¦‚ç‡éå¸¸ä½ã€‚è¿™ç›´æ¥å†³å®šäº†å„¿ç«¥é‡ç–¾é™©çš„ä»·æ ¼ååˆ†ä¾¿å®œã€‚å› æ­¤ï¼Œä¸ºå­©å­é…ç½®é‡ç–¾é™©ï¼Œä¸€å®šè¦æŠ“ä½ä»·æ ¼ä¼˜åŠ¿ï¼Œå°½å¯èƒ½æé«˜ä¿é¢ï¼Œæ‹‰é•¿æœŸé™ã€‚éƒ½æ˜¯100ä¸‡å…ƒçš„ç»ˆèº«é‡ç–¾é™©ä¿é¢ï¼Œ30å¤šå²ç”·æ€§çš„è´­ä¹°ä»·æ ¼ï¼Œå¯ä»¥è¾¾åˆ°å°å­©å­çš„ä¸¤å€å¤šã€‚ å­©å­çš„é‡ç–¾é™©åº”è¯¥ä¹°ä¿ç»ˆèº«æˆ–è€…70å²çš„ï¼Œä¸è¦ä¹°ä¿éšœ30å¹´ï¼Œä¸‰åå¹´ä¹‹åå­©å­æ‰ä¸‰ã€å››åå²ï¼Œé‚£æ—¶æ–­ä¿å†æ–°ä¹°ä¿é™©ä¼šæ›´è´µã€‚ å­©å­æœ€å¥½çš„ä¿é™©æ˜¯çˆ¶æ¯ çˆ¶æ¯è‡ªèº«çš„å¥åº·ä»¥åŠç¨³å®šã€æŒç»­çš„èµšé’±èƒ½åŠ›ï¼Œæ˜¯å­©å­æœ€é‡è¦çš„ä¿é™©ã€‚ æ€»ç»“ä¸€ä¸‹ä¸ºå­©å­é…ç½®ä¿é™©çš„å‡ ä¸ªå…³é”®ç‚¹ã€‚ ä½œä¸ºçˆ¶æ¯ï¼Œå…ˆæŠŠè‡ªå·±çš„ä¿é™©é…ç½®å¥½ï¼Œå› ä¸ºä½ æ‰æ˜¯å­©å­æœ€å¤§çš„â€œä¿é™©â€ï¼› åœ¨è´­ä¹°ä»»ä½•å•†ä¸šä¿é™©ä¹‹å‰ï¼Œå…ˆä¸ºå­©å­åŠç†å¥½å½“åœ°çš„å°‘å„¿åŒ»ä¿ï¼Œè¿™æ˜¯æ”¿åºœç»™äºˆçš„ç¦åˆ©ï¼Œä¸€å®šè¦å……åˆ†åˆ©ç”¨ï¼› ç»“åˆè‡ªèº«é¢„ç®—ï¼Œé¦–å…ˆé…ç½®é«˜ä¿é¢çš„é‡å¤§ç–¾ç—…é™©å’Œä½é™¢åŒ»ç–—é™©ï¼Œå…¶ä»–çš„ä¿é™©åˆ™é‡åŠ›è´­ä¹°ã€‚ å¦‚ä½•ç»™çˆ¶æ¯ä¹°ä¿é™© ä¸€ä¸ªä¸æ–­å¦¥åé€€è®©çš„è¿‡ç¨‹ å…¶å®çˆ¶æ¯é¢ä¸´çš„é£é™©éå¸¸ç®€å•ï¼Œå°±æ˜¯ç–¾ç—…å¼•å‘çš„è´¢åŠ¡é£é™©ã€‚ è¿™æ ·çœ‹æ¥ï¼Œç»™çˆ¶æ¯é…ç½®ä¿é™©ï¼Œä¸»è¦è€ƒè™‘çš„åº”è¯¥æ˜¯é‡ç–¾é™©ã€åŒ»ç–—é™©å’Œæ„å¤–é™©ã€‚ å¹´é¾„è¶…è¿‡60å²çš„äººæƒ³è¦æŠ•ä¿é‡ç–¾é™©å’ŒåŒ»ç–—é™©ä¼šæœ‰å¾ˆå¤šé™åˆ¶ï¼š ç¬¬ä¸€ï¼Œå¹´é¾„é™åˆ¶ã€‚ å‡ ä¹æ‰€æœ‰é‡ç–¾é™©å’ŒåŒ»ç–—é™©çš„æŠ•ä¿å¹´é¾„éƒ½åœ¨0~60å²ã€‚å¯¹é‡ç–¾é™©è€Œè¨€ï¼Œ55å²çš„æŠ•ä¿å¹´é¾„ä¸Šé™æ˜¯æ™®éè§„åˆ™ã€‚ ç¬¬äºŒï¼Œä¿é¢é™åˆ¶ã€‚ åŒæ ·ä¸€ä»½ä¿é™©ï¼Œ30å²çš„äººå’Œ50å²çš„äººå¯äº«å—çš„ä¿é¢ä¸Šé™æ˜¯ä¸ä¸€æ ·çš„ã€‚ ä»¥é‡ç–¾é™©ä¸ºä¾‹ï¼Œå¦‚æœåœ¨ç½‘ä¸Šç›´æ¥æŠ•ä¿ï¼Œ30å²çš„è¢«ä¿é™©äººçš„ä¿é¢ä¸Šé™åŸºæœ¬ä¸º50ä¸‡~60ä¸‡å…ƒï¼Œè€Œ50å²çš„è¢«ä¿é™©äººçš„ä¿é¢ä¸Šé™åªæœ‰10ä¸‡å…ƒã€‚ ç¬¬ä¸‰ï¼Œä¿è´¹å€’æŒ‚ã€‚ ä¸€ä½55å²çš„ç”·æ€§è´­ä¹°ä¿é¢ä¸º10ä¸‡å…ƒçš„é‡ç–¾é™©ï¼Œæ¯å¹´éœ€è¦äº¤3500å…ƒå·¦å³ï¼Œäº¤20å¹´ï¼Œæ€»è®¡7ä¸‡å…ƒçš„æ”¯å‡ºå’Œ10ä¸‡å…ƒçš„ä¿é¢ç›¸æ¯”ï¼Œå·®åˆ«ä¸å¤§ã€‚ ç¬¬å››ï¼Œå¥åº·å‘ŠçŸ¥ä¸ç¬¦ã€‚ æ‚£æœ‰é«˜è¡€å‹ã€å¿ƒè„ç—…ã€ç³–å°¿ç—…çš„è€å¹´äººï¼Œå¯ä»¥ç›´æ¥å’Œé‡å¤§ç–¾ç—…é™©ã€ä½é™¢åŒ»ç–—é™©è¯´å†è§äº† ä¿é™©å…¬å¸ä¹Ÿæ„è¯†åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œäºæ˜¯æƒ³äº†ä¸€ä¸ªåŠæ³•ï¼šåŒæ–¹å„é€€ä¸€æ­¥ã€‚ä¿é™©å…¬å¸æŠŠä¿éšœèŒƒå›´ç¼©å°ï¼Œé™åˆ¶ä¹Ÿéšä¹‹å‡å°‘ã€‚ä½†è¿™ä¸ªä¿éšœèŒƒå›´ä¸èƒ½å¤ªå°ï¼Œå¾—æœ‰å­˜åœ¨çš„æ„ä¹‰ã€‚ äºæ˜¯ï¼Œé˜²ç™Œç±»ä¿é™©åº”è¿è€Œç”Ÿã€‚é‡ç–¾é™©æ¶µç›–çš„å‡ åç§ç–¾ç—…ï¼Œåªä¿ç•™ç¬¬ä¸€é¡¹ï¼Œå³æ¶æ€§è‚¿ç˜¤ï¼›ä½é™¢åŒ»ç–—é™©æ¶µç›–çš„æ‰€æœ‰ç–¾ç—…çš„ä½é™¢è´£ä»»ï¼Œä¹Ÿåªä¿ç•™ä¸€é¡¹ï¼Œå³ç™Œç—‡ä½é™¢è´£ä»»ã€‚ è¿™ç§åšæ³•æœ€å¤§çš„å¥½å¤„ï¼Œå°±æ˜¯å¥åº·å‘ŠçŸ¥çš„å†…å®¹å¤§å¹…å‡å°‘ã€‚åªè¦ä¸æ˜¯æ˜“å¼•å‘ç™Œç—‡çš„ç—‡çŠ¶ï¼ˆè‚éƒ¨ç–¾ç—…ã€å™¨å®˜æˆ–ç»„ç»‡çš„ç»“èŠ‚ç­‰ï¼‰ï¼Œä¿é™©å…¬å¸éƒ½ä¸ä»‹æ„ï¼Œé«˜è¡€å‹ã€ç³–å°¿ç—…æ‚£è€…ä¹Ÿå¯ä»¥æŠ•ä¿ã€‚æ¯•ç«Ÿï¼Œé«˜è¡€å‹å¯¼è‡´çš„æ€¥æ€§å¿ƒæ¢—å’Œç³–å°¿ç—…å¯¼è‡´çš„ç»ˆæœ«æœŸè‚¾ç—…æˆ–æˆªè‚¢ï¼Œéƒ½ä¸åœ¨é˜²ç™Œç±»ä¿é™©çš„è´£ä»»èŒƒå›´å†…ã€‚ å…­åˆ†é è§„åˆ’ï¼Œå››åˆ†é å¿ƒæ€ å“ªæ€•æœ‰é‚£ä¹ˆå¤šçš„é™åˆ¶ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥è´­ä¹°æ„å¤–é™©ã€é˜²ç™Œé™©ã€é˜²ç™ŒåŒ»ç–—é™©å’Œç³–å°¿ç—…ç‰¹å®šç–¾ç—…é‡ç–¾é™©ã€‚ å¦‚æœä½ æƒ³ç®€æ˜æ‰¼è¦åœ°æŒæ¡ç»™çˆ¶æ¯ä¹°ä¿é™©çš„æŠ€å·§ï¼Œè¯·è®°ä½ä»¥ä¸‹å‡ ç‚¹ã€‚ ç¬¬ä¸€ï¼Œç¡®ä¿çˆ¶æ¯åŒæ–¹éƒ½æœ‰ç¤¾ä¼šåŒ»ç–—ä¿é™©ã€‚ä¸ç®¡æ˜¯åŸå¸‚çš„å±…æ°‘åŒ»ä¿ï¼Œè¿˜æ˜¯å†œæ‘çš„â€œæ–°å†œåˆâ€ï¼Œæ²¡æœ‰çš„è¯ï¼Œèµ¶ç´§å…ˆæŠŠç¤¾ä¼šåŒ»ä¿åŠå¥½ã€‚ ç¬¬äºŒï¼Œé‡åˆ°ç–‘éš¾æ‚ç—‡ï¼Œä¸å°‘äººä¼šé€‰æ‹©å¸¦çˆ¶æ¯æ¥åŒ—ä¸Šå¹¿ç­‰å¤§åŸå¸‚å°±è¯Šã€‚æ‰€ä»¥ï¼Œè¯·æå‰ç ”ç©¶å¥½åŒ»ä¿çš„å¼‚åœ°ç»“ç®—æµç¨‹ï¼Œç¡®ä¿ä¸è®©åŒ»ä¿â€œç™½äº¤â€ï¼Œè¿™ä¸€ç‚¹éå¸¸æœ‰å¿…è¦ã€‚ ç¬¬ä¸‰ï¼Œè¯¦ç»†äº†è§£çˆ¸å¦ˆçš„èº«ä½“å¥åº·æƒ…å†µï¼Œå¯¹ç—‡ä¸‹è¯ä¹°ä¿é™©ã€‚ å¦‚ä½•ç»™è‡ªå·±ä¹°ä¿é™© 18å²ä¿é™©æ¸…å• å­¦ç”Ÿå›¢ä½“ä¿é™©ï¼šåŒ…å«æ„å¤–èº«æ•…/ä¼¤æ®‹è´£ä»»ï¼Œæ„å¤–åŒ»ç–—è´£ä»»ï¼Œä½é™¢åŒ»ç–—è´£ä»»ï¼›é¢„ç®—ä¸º200å…ƒã€‚ æˆ–è‡ªå·±æŠ•ä¿ï¼š æ„å¤–é™©ï¼šåŒ…å«æ„å¤–èº«æ•…/ä¼¤æ®‹è´£ä»»ï¼Œæ„å¤–åŒ»ç–—è´£ä»»ï¼›é¢„ç®—ä¸º200å…ƒï¼ˆä¿é¢ä¸º50ä¸‡å…ƒï¼‰ã€‚ åŒ»ç–—é™©ï¼šåŒ…å«ç–¾ç—…å¯¼è‡´çš„ä½é™¢åŒ»ç–—è´£ä»»ï¼Œé¢„ç®—ä¸º200å…ƒã€‚ 18å²ä¿éšœé€Ÿè§ˆ èº«æ•…è¡¥å¿ï¼ˆä»…é™æ„å¤–åŸå› ï¼‰ï¼š50ä¸‡å…ƒã€‚ æ„å¤–åŒ»ç–—è¡¥å¿ï¼š1ä¸‡å…ƒï¼ˆä¸Šé™ï¼‰ã€‚ ä½é™¢åŒ»ç–—è¡¥å¿ï¼š100ä¸‡å…ƒï¼ˆä¸Šé™ï¼‰ã€‚ 22å²æ–°å¢ä¿é™©æƒ…å†µ å®šæœŸå¯¿é™©Aï¼šå—ç›Šäººä¸ºçˆ¶æ¯ï¼Œä¿é¢å¤§çº¦ç›¸å½“äºçˆ¶æ¯5å¹´çš„é€€ä¼‘é‡‘ï¼›é¢„ç®—ä¸ºæ¯å¹´500å…ƒï¼ˆä¿é¢50ä¸‡å…ƒï¼Œä¿éšœæœŸ30å¹´ï¼Œç¼´è´¹æœŸ30å¹´ï¼‰ã€‚ ä¿éšœé€Ÿè§ˆ èº«æ•…è¡¥å¿ï¼ˆä¸é™æ­»äº¡åŸå› ï¼‰ï¼š50ä¸‡å…ƒã€‚ é¢å¤–èº«æ•…è¡¥å¿ï¼ˆä»…é™æ„å¤–åŸå› ï¼‰ï¼š50ä¸‡å…ƒã€‚ æ„å¤–åŒ»ç–—è¡¥å¿ï¼š1ä¸‡å…ƒï¼ˆä¸Šé™ï¼‰ã€‚ ä½é™¢åŒ»ç–—è¡¥å¿ï¼š100ä¸‡å…ƒï¼ˆä¸Šé™ï¼‰ã€‚ 28å²æ–°å¢ä¿é™©æƒ…å†µ å®šæœŸå¯¿é™©Bï¼šå—ç›Šäººä¸ºæ³•å®šå—ç›Šäººï¼Œä¿é¢çº¦ç­‰äº5å€å¹´è–ªï¼› é¢„ç®—ä¸ºæ¯å¹´1000å…ƒï¼ˆä¿é¢80ä¸‡å…ƒï¼Œä¿åˆ°60å²ï¼Œç¼´è´¹æœŸ30å¹´ï¼‰ã€‚ é‡å¤§ç–¾ç—…é™©Aï¼šä¿é¢çº¦ç­‰äºè´­ä¹°æ—¶çš„3å€å¹´è–ªï¼›é¢„ç®—ä¸ºæ¯å¹´5000å…ƒï¼ˆä¿é¢50ä¸‡å…ƒï¼Œä¿åˆ°70å²ï¼Œç¼´è´¹æœŸ30å¹´ï¼‰ã€‚ 28å²ä¿éšœé€Ÿè§ˆ èº«æ•…è¡¥å¿ï¼ˆä¸é™æ­»äº¡åŸå› ï¼‰ï¼š130ä¸‡å…ƒã€‚ é¢å¤–èº«æ•…è¡¥å¿ï¼ˆä»…é™æ„å¤–åŸå› ï¼‰ï¼š50ä¸‡å…ƒã€‚ æ„å¤–åŒ»ç–—è¡¥å¿ï¼š1ä¸‡å…ƒï¼ˆä¸Šé™ï¼‰ã€‚ ä½é™¢åŒ»ç–—è¡¥å¿ï¼š100ä¸‡å…ƒï¼ˆä¸Šé™ï¼‰ã€‚ é‡å¤§ç–¾ç—…è¡¥å¿ï¼š50ä¸‡å…ƒã€‚ 32å²æ–°å¢ä¿é™©æƒ…å†µ æ„å¤–é™©ï¼šåŒ…å«æ„å¤–èº«æ•…/ä¼¤æ®‹è´£ä»»ï¼›é¢„ç®—ä¸ºæ¯å¹´400å…ƒï¼ˆä¿é¢100ä¸‡å…ƒï¼‰ã€‚ å‡é¢å®šæœŸå¯¿é™©Cï¼šå—ç›Šäººä¸ºæ³•å®šå—ç›Šäººï¼Œä¿é¢ç­‰äºæˆ¿è´·æ€»é¢ï¼›é¢„ç®—ä¸ºæ¯å¹´2000å…ƒï¼ˆä¿é¢150ä¸‡å…ƒï¼Œä¿éšœæœŸ30å¹´ï¼Œç¼´è´¹æœŸ20å¹´ï¼‰ã€‚ï¼ˆæœ‰æˆ¿è´·æ‰ä¹°ï¼‰ é‡å¤§ç–¾ç—…é™©Bï¼šæå‡é‡ç–¾ä¿é¢ï¼›é¢„ç®—ä¸ºæ¯å¹´5000å…ƒï¼ˆä¿é¢30ä¸‡å…ƒï¼Œä¿ç»ˆèº«ï¼Œç¼´è´¹æœŸ30å¹´ï¼‰ã€‚ 32å²ä¿éšœé€Ÿè§ˆ èº«æ•…è¡¥å¿ï¼ˆä¸é™æ­»äº¡åŸå› ï¼‰ï¼š130ä¸‡å…ƒã€‚ é¢å¤–èº«æ•…è¡¥å¿ï¼ˆä»…é™æ„å¤–åŸå› ï¼‰ï¼š150ä¸‡å…ƒã€‚ æ„å¤–åŒ»ç–—è¡¥å¿ï¼š1ä¸‡å…ƒï¼ˆä¸Šé™ï¼‰ã€‚ ä½é™¢åŒ»ç–—è¡¥å¿ï¼š100ä¸‡å…ƒï¼ˆä¸Šé™ï¼‰ã€‚ é‡å¤§ç–¾ç—…è¡¥å¿ï¼š80ä¸‡å…ƒã€‚ 34å² æ„å¤–é™©ï¼šåŒ…å«æ„å¤–èº«æ•…/ä¼¤æ®‹è´£ä»»ï¼Œæ„å¤–åŒ»ç–—è´£ä»»ï¼›é¢„ç®—ä¸ºæ¯å¹´200å…ƒï¼ˆä¿é¢50ä¸‡å…ƒï¼‰ã€‚ æ„å¤–é™©ï¼šåŒ…å«æ„å¤–èº«æ•…/ä¼¤æ®‹è´£ä»»ï¼›é¢„ç®—ä¸ºæ¯å¹´400å…ƒï¼ˆä¿é¢100ä¸‡å…ƒï¼‰ã€‚ åŒ»ç–—é™©ï¼šåŒ…å«ç–¾ç—…å¯¼è‡´çš„ä½é™¢åŒ»ç–—è´£ä»»ï¼›é¢„ç®—ä¸ºæ¯å¹´200å…ƒã€‚å®šæœŸå¯¿é™©Aï¼šå—ç›Šäººä¸ºçˆ¶æ¯ï¼Œä¿é¢ç›¸å½“äºçˆ¶æ¯5å¹´çš„é€€ä¼‘é‡‘ï¼›é¢„ç®—ä¸ºæ¯å¹´500å…ƒï¼ˆä¿é¢50ä¸‡å…ƒï¼Œä¿éšœæœŸ30å¹´ï¼Œç¼´è´¹æœŸ30å¹´ï¼‰ã€‚ å®šæœŸå¯¿é™©Bï¼šå—ç›Šäººä¸ºæ³•å®šå—ç›Šäººï¼Œä¿é¢ç›¸å½“äºè‡ªå·±5å€çš„å¹´è–ªã€‚é¢„ç®—ä¸ºæ¯å¹´1000å…ƒï¼ˆä¿é¢80ä¸‡å…ƒï¼Œä¿åˆ°60å²ï¼Œç¼´è´¹æœŸ30å¹´ï¼‰ã€‚ å‡é¢å®šæœŸå¯¿é™©Cï¼šå—ç›Šäººä¸ºæ³•å®šå—ç›Šäººï¼Œä¿é¢ç­‰äºæˆ¿è´·æ€»é¢ï¼›é¢„ç®—ä¸ºæ¯å¹´2000å…ƒï¼ˆä¿é¢150ä¸‡å…ƒï¼Œä¿éšœæœŸ30å¹´ï¼Œç¼´è´¹æœŸ20å¹´ï¼‰ã€‚ å®šæœŸå¯¿é™©Dï¼šå—ç›Šäººä¸ºå­å¥³ï¼Œä¿é¢ç›¸å½“äºå­©å­5å¹´çš„ç”Ÿæ´»è´¹ï¼›é¢„ç®—ä¸ºæ¯å¹´4000å…ƒï¼ˆä¿é¢100ä¸‡å…ƒï¼Œä¿åˆ°60å²ï¼Œç¼´è´¹æœŸ20å¹´ï¼‰ã€‚ é‡å¤§ç–¾ç—…é™©Aï¼šä¿é¢ç›¸å½“äºè‡ªå·±å½“æ—¶çš„3å€å¹´è–ªï¼›é¢„ç®—ä¸ºæ¯å¹´5000å…ƒï¼ˆä¿é¢50ä¸‡å…ƒï¼Œä¿åˆ°70å²ï¼Œç¼´è´¹æœŸ30å¹´ï¼‰ã€‚é‡å¤§ç–¾ç—…é™©Bï¼šæå‡é‡ç–¾é™©ä¿é¢ï¼›é¢„ç®—ä¸ºæ¯å¹´5000å…ƒï¼ˆä¿é¢30ä¸‡å…ƒï¼Œä¿ç»ˆèº«ï¼Œç¼´è´¹æœŸ30å¹´ï¼‰ã€‚ å…»è€ä¿é™©ï¼ˆ60å²é¢†å–ï¼‰ï¼šé¢„ç®—ä¸ºæ¯å¹´60000å…ƒï¼ˆæ¯æœˆ5000å…ƒï¼‰ã€‚ ç»™è‡ªå·±ä¹°ä¿é™©ï¼Œä¸èƒ½ä¸€è¹´è€Œå°±ï¼Œåº”éšç€äººç”Ÿè¿›å…¥ä¸åŒé˜¶æ®µè€Œåˆ†æ­¥å®æ–½ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹è‡ªå·±çš„æƒ…æ„Ÿè¿›è¡Œå†åˆ†é…ï¼Œè¯´åˆ°åº•å°±æ˜¯ï¼Œå›ç­”â€œä¸ºè°ä¹°ä¿é™©â€çš„é—®é¢˜ã€‚æ¯”å¦‚ï¼Œæ¶‰åŠåŒ»ç–—è¡¥å¿çš„ä¿é™©ï¼ˆå¦‚ä½é™¢åŒ»ç–—é™©ã€é‡å¤§ç–¾ç—…é™©ï¼‰ï¼Œæ˜¯ä¸ºäº†è®©è‡ªå·±ä¸è‡³äºè¢«ç–¾ç—…æç©ºè…°åŒ…ï¼›å†æ¯”å¦‚ï¼Œæ¶‰åŠèº«æ•…è¡¥å¿çš„ä¿é™©ï¼ˆå¦‚å®šæœŸå¯¿é™©ã€æ„å¤–é™©ï¼‰ï¼Œæ˜¯ä¸ºäº†è®©å®¶äººèƒ½å¤Ÿç»§ç»­ç»´æŒåŸæ¥çš„ç”Ÿæ´»æ°´å‡†ã€‚","categories":[{"name":"è¯»ä¹¦ç¬”è®°","slug":"è¯»ä¹¦ç¬”è®°","permalink":"https://guozhe001.github.io/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"}],"tags":[{"name":"è¯»ä¹¦ç¬”è®°","slug":"è¯»ä¹¦ç¬”è®°","permalink":"https://guozhe001.github.io/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"},{"name":"ä¿é™©","slug":"ä¿é™©","permalink":"https://guozhe001.github.io/tags/%E4%BF%9D%E9%99%A9/"}]},{"title":"Gradleå­¦ä¹ è¸©å‘è®°å½•","slug":"others/gradleå­¦ä¹ è¸©å‘è®°å½•","date":"2021-04-01T10:18:21.506Z","updated":"2021-04-01T10:18:21.507Z","comments":true,"path":"2021/04/01/others/gradleå­¦ä¹ è¸©å‘è®°å½•/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/others/gradle%E5%AD%A6%E4%B9%A0%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/","excerpt":"","text":"gradleå­¦ä¹ è¸©å‘è®°å½• æœ€è¿‘æƒ³å­¦ä¹ ä¸€ä¸‹Java11ï¼Œä½¿ç”¨gradleæ­å»ºäº†ä¸€ä¸ªé¡¹ç›®ï¼Œä½†æ˜¯åœ¨æ‰§è¡Œæ‰“åŒ…å‘½ä»¤./gradlew clean buildæ—¶æŠ¥é”™å¦‚ä¸‹ï¼š 1Could not target platform: &#x27;Java SE 11&#x27; using tool chain: &#x27;JDK 8 (1.8)&#x27; åŸå› æ˜¯å› ä¸ºæˆ‘æœ¬åœ°çš„JAVA_HOMEé…ç½®çš„JDKç‰ˆæœ¬æ˜¯1.8ï¼Œä½†æ˜¯é¡¹ç›®ä¸­æŒ‡å®šçš„ç¼–è¯‘ç‰ˆæœ¬ä¸ºJava11ï¼š 12sourceCompatibility = JavaVersion.VERSION_11targetCompatibility = JavaVersion.VERSION_11 è§£å†³æ–¹å¼æ˜¯åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ–°å»ºgradle.propertiesæ–‡ä»¶ï¼Œå¹¶å†™å…¥ä»¥ä¸‹é…ç½®ï¼Œé—®é¢˜è§£å†³ 1org.gradle.java.home = /Library/Java/JavaVirtualMachines/jdk-11.0.9.jdk/Contents/Home gradleçš„å®˜æ–¹æ–‡æ¡£è§£é‡Šå¦‚ä¸‹ï¼š Resolve the Gradle JVM version for the existing project IntelliJ IDEA checks the gradle.properties file for the appropriate Gradle JVM specified in org.gradle.java.home and uses it for the project. Then it checks the JAVA_HOME environment variable. Then it checks the closest appropriate JDK version for the existing Gradle version.","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://guozhe001.github.io/categories/%E5%B7%A5%E5%85%B7/"},{"name":"Gradle","slug":"å·¥å…·/Gradle","permalink":"https://guozhe001.github.io/categories/%E5%B7%A5%E5%85%B7/Gradle/"}],"tags":[{"name":"Gradle","slug":"Gradle","permalink":"https://guozhe001.github.io/tags/Gradle/"},{"name":"Java","slug":"Java","permalink":"https://guozhe001.github.io/tags/Java/"}]},{"title":"Homebrewé…ç½®ä¸ºå›½å†…é•œåƒ","slug":"others/Homebrewé…ç½®ä¸ºå›½å†…é•œåƒ","date":"2021-04-01T10:18:21.505Z","updated":"2021-04-01T10:18:21.505Z","comments":true,"path":"2021/04/01/others/Homebrewé…ç½®ä¸ºå›½å†…é•œåƒ/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/others/Homebrew%E9%85%8D%E7%BD%AE%E4%B8%BA%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F/","excerpt":"","text":"æœ¬äººçš„Macç”µè„‘æŒ‰ç…§æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™çš„è®¾ç½®æ—¶æŠ¥é”™å¦‚ä¸‹ï¼š 12git -C &quot;$(brew --repo homebrew/cask)&quot; remote set-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-cask.gitfatal: cannot change to &#x27;/usr/local/Homebrew/Library/Taps/homebrew/homebrew-cask&#x27;: No such file or directory è§£å†³æ–¹æ¡ˆæ˜¯å…ˆchangeåˆ°å¯¹åº”çš„ç›®å½•ä¸‹ï¼Œåœ¨æ‰§è¡Œæ›¿æ¢è„šæœ¬ï¼Œæ“ä½œå¦‚ä¸‹ï¼š 12345cd &quot;$(brew --repo)&quot;git remote set-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/brew.gitcd $(brew --repo homebrew/core)git remote set-url origin https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git å¸è½½homebrew æ‰§è¡Œå¸è½½è„šæœ¬ï¼š 1sudo /usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/uninstall)&quot; å¦‚æœæŠ¥é”™å¦‚ä¸‹ï¼š 1curl: (7) Failed to connect to raw.githubusercontent.com port 443: Connection refused éœ€è¦é…ç½®ä¸€ä¸‹hostï¼›å»å¾€https://www.ipaddress.com/ï¼Œè¾“å…¥raw.githubusercontent.comæŸ¥çœ‹ipåœ°å€ï¼Œç„¶åé…ç½®hostä¹‹åé‡è¯•ã€‚ å®‰è£…bash_completion å¸è½½homebrewåå‘ç°è‡ªåŠ¨è¡¥å…¨çš„åŠŸèƒ½ä¹Ÿæ²¡æœ‰äº†ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š 1vi awk: can&#x27;t open file /usr/local/etc/bash_completion è§£å†³æ–¹æ³•æ˜¯é‡æ–°å®‰è£…homebrewåï¼Œå®‰è£…bash-completionï¼š 1brew install bash-completion","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://guozhe001.github.io/categories/%E5%B7%A5%E5%85%B7/"},{"name":"Homebrew","slug":"å·¥å…·/Homebrew","permalink":"https://guozhe001.github.io/categories/%E5%B7%A5%E5%85%B7/Homebrew/"}],"tags":[{"name":"Homebrew","slug":"Homebrew","permalink":"https://guozhe001.github.io/tags/Homebrew/"},{"name":"Mac","slug":"Mac","permalink":"https://guozhe001.github.io/tags/Mac/"}]},{"title":"Linuxå¸¸ç”¨å‘½ä»¤è®°å½•","slug":"others/Linux Shellå‘½ä»¤è®°å½•","date":"2021-04-01T10:18:21.505Z","updated":"2021-04-01T10:18:21.506Z","comments":true,"path":"2021/04/01/others/Linux Shellå‘½ä»¤è®°å½•/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/others/Linux%20Shell%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/","excerpt":"","text":"tar(è§£å‹ï¼Œå‹ç¼©ï¼Œå¸®åŠ©ï¼štar -h) è§£å‹ï¼Œ-Cæ ‡ç­¾æŒ‡å®šè§£å‹åˆ°å“ªä¸ªç›®å½• 1tar -xf -C ./test å‹ç¼© 1tar -cf &lt;archive-filename&gt; [filenames...] shasumï¼ˆhashï¼Œå¸®åŠ©shasum -hï¼‰ ç”Ÿæˆhashï¼Œ-aæ ‡ç­¾æŒ‡å®šä½¿ç”¨å“ªä¸ªç®—æ³• 1shasum -a 256 README.md ä¿®æ”¹ç»ˆç«¯æ˜¾ç¤ºï¼Œä¸æ˜¾ç¤ºç”¨æˆ·åå’Œç”µè„‘åç§° ä¿®æ”¹/etc/bashrcï¼šPS1='\\w $ â€™ 123456789101112$ more /etc/bashrc# System-wide .bashrc file for interactive bash(1) shells.if [ -z &quot;$PS1&quot; ]; then returnfi#PS1=&#x27;\\h:\\W \\u\\$ &#x27;PS1=&#x27;\\w \\$ &#x27;# Make bash check its window size after a process completesshopt -s checkwinsize[ -r &quot;/etc/bashrc_$TERM_PROGRAM&quot; ] &amp;&amp; . &quot;/etc/bashrc_$TERM_PROGRAM&quot; å…¶ä»–å‚æ•°ï¼š \\d ï¼šä»£è¡¨æ—¥æœŸï¼Œæ ¼å¼ä¸ºweekday month dateï¼Œä¾‹å¦‚ï¼šâ€œMon Aug 1â€ \\H ï¼šå®Œæ•´çš„ä¸»æœºåç§°ã€‚ä¾‹å¦‚ï¼šæˆ‘çš„æœºå™¨åç§°ä¸ºï¼šfc4.linuxï¼Œåˆ™è¿™ä¸ªåç§°å°±æ˜¯fc4.linux \\h ï¼šä»…å–ä¸»æœºçš„ç¬¬ä¸€ä¸ªåå­—ï¼Œå¦‚ä¸Šä¾‹ï¼Œåˆ™ä¸ºfc4ï¼Œ.linuxåˆ™è¢«çœç•¥ \\t ï¼šæ˜¾ç¤ºæ—¶é—´ä¸º24å°æ—¶æ ¼å¼ï¼Œå¦‚ï¼šHHï¼šMMï¼šSS \\T ï¼šæ˜¾ç¤ºæ—¶é—´ä¸º12å°æ—¶æ ¼å¼\\A ï¼šæ˜¾ç¤ºæ—¶é—´ä¸º24å°æ—¶æ ¼å¼ï¼šHHï¼šMM \\u ï¼šå½“å‰ç”¨æˆ·çš„è´¦å·åç§°\\v ï¼šBASHçš„ç‰ˆæœ¬ä¿¡æ¯ \\w ï¼šå®Œæ•´çš„å·¥ä½œç›®å½•åç§°ã€‚å®¶ç›®å½•ä¼šä»¥ ~ä»£æ›¿ \\W ï¼šåˆ©ç”¨basenameå–å¾—å·¥ä½œç›®å½•åç§°ï¼Œæ‰€ä»¥åªä¼šåˆ—å‡ºæœ€åä¸€ä¸ªç›®å½• # ï¼šä¸‹è¾¾çš„ç¬¬å‡ ä¸ªå‘½ä»¤ $ ï¼šæç¤ºå­—ç¬¦ï¼Œå¦‚æœæ˜¯rootæ—¶ï¼Œæç¤ºç¬¦ä¸ºï¼š# ï¼Œæ™®é€šç”¨æˆ·åˆ™ä¸ºï¼š$ crontabï¼ˆå®šæ—¶ä»»åŠ¡,man crontabï¼‰ æŸ¥çœ‹ï¼šcrontab -l ç¼–è¾‘ï¼šcrontab -e crontabé…ç½®ä¸¾ä¾‹å¦‚ä¸‹ï¼š 123# æ¯å¤©åç‚¹30åˆ†æ‰§è¡Œhello.sh# åˆ† æ—¶ æ—¥ æœˆ æ˜ŸæœŸ command30 10 * * * ï½/hello.sh","categories":[{"name":"Linux","slug":"Linux","permalink":"https://guozhe001.github.io/categories/Linux/"}],"tags":[{"name":"Linux","slug":"Linux","permalink":"https://guozhe001.github.io/tags/Linux/"},{"name":"shell","slug":"shell","permalink":"https://guozhe001.github.io/tags/shell/"}]},{"title":"Dockerå¸¸ç”¨å‘½ä»¤è®°å½•","slug":"others/Dockerå¸¸ç”¨å‘½ä»¤è®°å½•","date":"2021-04-01T10:18:21.504Z","updated":"2021-04-01T10:18:21.504Z","comments":true,"path":"2021/04/01/others/Dockerå¸¸ç”¨å‘½ä»¤è®°å½•/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/others/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/","excerpt":"","text":"dockerå‘½ä»¤ åˆ é™¤æœ¬åœ°æ‰€æœ‰æ²¡æœ‰è¢«ä½¿ç”¨çš„å·ï¼š 1docker volume prune WARNING! This will remove all local volumes not used by at least one container. æŸ¥çœ‹æœ¬åœ°çš„æ‰€æœ‰å·ï¼š 1docker volume ls åˆ é™¤æŸä¸ªvolumeå· 1docker volume rm docker_orderer.supply.com æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨ï¼ŒåŒ…æ‹¬æ²¡æœ‰è¿è¡Œä¸­çš„ 1docker ps -a æŸ¥çœ‹æŸä¸ªå®¹å™¨çš„æ—¥å¿— 1docker logs ead00b30e8ec åœæ­¢å®¹å™¨ 1docker stop 46bc78ee1f8a e8df5432a918 be15203b7835 åˆ é™¤å®¹å™¨ 1docker rm ead00b30e8ec 46bc78ee1f8a e8df5432a918 be15203b7835 è¿›å…¥dockerå®¹å™¨ 1docker exec -it f37c61b09023 /bin/sh ä¿®æ”¹å®¹å™¨çš„ç¯å¢ƒå˜é‡ åœ¨é…ç½®docker-composeæŸä¸ªå®¹å™¨çš„ç¯å¢ƒå˜é‡æ—¶å‡ºç°äº†é”™è¯¯ï¼Œä½†æ˜¯å®¹å™¨å·²ç»è¿è¡Œäº†ï¼Œå¦‚æœé‡æ–°è¿è¡Œåˆ™æ•°æ®ä¼šä¸¢å¤±ã€‚æ‰€ä»¥éœ€è¦ä¿®æ­£æ­¤ç¯å¢ƒå˜é‡ 1234567891011121314151617181920212223 peer0.s1.supply.com:â€‹ container_name: peer0.s1.supply.comâ€‹ image: hyperledger/fabric-peer:2.2.0â€‹ environment:â€‹ *#Generic peer variables*â€‹ \\- CORE_VM_ENDPOINT=unix:///host/var/run/docker.sockâ€‹ *# the following setting starts chaincode containers on the same*â€‹ *# bridge network as the peers*â€‹ *# https://docs.docker.com/compose/networking/*â€‹ \\- CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=_testâ€‹ \\- FABRIC_LOGGING_SPEC=INFOâ€‹ *#- FABRIC_LOGGING_SPEC=DEBUG* å¦‚è¦ä¿®æ”¹CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODEä¸ºdocker_test: 12345# 1ã€è¿›å…¥å®¹å™¨docker exec -it f37c61b09023 /bin/sh# 2ã€ä¿®æ”¹ç¯å¢ƒå˜é‡echo &quot;export CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=docker_test&quot; &gt;&gt; /etc/profile# 3ã€é‡æ–°å¯åŠ¨å®¹å™¨å³å¯ æŸ¥çœ‹dockerå¯åŠ¨çš„ç½‘ç»œ 1docker network ls docker-composeå‘½ä»¤ ä½¿ç”¨docker-composeå¯åŠ¨dockeré•œåƒ 12# --f æŒ‡å®šæ–‡ä»¶, -dæŒ‡å®šåå°è¿è¡Œdocker-compose --f docker-compose.yml up -d ä½¿ç”¨docker-composeå¯åŠ¨æŒ‡å®šçš„åç§°çš„å®¹å™¨ åœ¨ä¸€ä¸ªdocker-compose.yamlé…ç½®æ–‡ä»¶ä¸‹å¯èƒ½æœ‰å¤šä¸ªsereviceï¼Œå¯ä»¥æŒ‡å®šåç§°æ¥å¯åŠ¨å…¶ä¸­çš„ä¸€ä¸ªï¼Œå‘½ä»¤å¦‚ä¸‹: 1docker-compose up ca-tls","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://guozhe001.github.io/categories/%E5%B7%A5%E5%85%B7/"},{"name":"Docker","slug":"å·¥å…·/Docker","permalink":"https://guozhe001.github.io/categories/%E5%B7%A5%E5%85%B7/Docker/"}],"tags":[{"name":"Docker","slug":"Docker","permalink":"https://guozhe001.github.io/tags/Docker/"},{"name":"docker-compose","slug":"docker-compose","permalink":"https://guozhe001.github.io/tags/docker-compose/"}]},{"title":"Gradleå¸¸ç”¨å‘½ä»¤è®°å½•","slug":"others/Gradleå¸¸ç”¨å‘½ä»¤","date":"2021-04-01T10:18:21.504Z","updated":"2021-04-01T10:18:21.505Z","comments":true,"path":"2021/04/01/others/Gradleå¸¸ç”¨å‘½ä»¤/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/others/Gradle%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/","excerpt":"","text":"Gradleå¸¸ç”¨å‘½ä»¤è®°å½•: è¿è¡Œgradle help --task someTaskæ¥æ˜¾ç¤ºå¸®åŠ©ï¼Œå¦‚ï¼š 1./gradlew help --task test clean 1./gradlew clean build 1./gradlew build test 1./gradlew test æ’é™¤æŒ‡å®šçš„task--exclude-task 1./gradlew clean build --exclude-task test å¤šæ¨¡å—æŒ‡å®šæ¨¡å—è¿è¡Œtask 12./gradlew :my-subproject:taskName./gradlew my-subproject:taskName æµ‹è¯•å¤±è´¥ç»§ç»­æ‰§è¡Œ 1./gradlew test --continue æ£€æŸ¥ï¼Œä¼šæ‰§è¡Œtestå’Œlinting 1./gradlew check æ˜¾ç¤ºå½“å‰çš„é¡¹ç›®å±‚æ¬¡ 1./gradlew project åˆ—å‡ºæ‰€æœ‰çš„task 1./gradlew tasks åˆ—å‡ºé¡¹ç›®æ‰€æœ‰çš„ä¾èµ–ï¼š 1./gradlew dependencies å»å®˜ç½‘æŸ¥çœ‹æ›´å¤š","categories":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://guozhe001.github.io/categories/%E5%B7%A5%E5%85%B7/"},{"name":"Gradle","slug":"å·¥å…·/Gradle","permalink":"https://guozhe001.github.io/categories/%E5%B7%A5%E5%85%B7/Gradle/"}],"tags":[{"name":"Gradle","slug":"Gradle","permalink":"https://guozhe001.github.io/tags/Gradle/"},{"name":"Java","slug":"Java","permalink":"https://guozhe001.github.io/tags/Java/"}]},{"title":"ä½¿ç”¨Redisè‡ªå¢ç‰¹æ€§åˆ›å»ºå”¯ä¸€idç”Ÿæˆå™¨","slug":"language/java/ä½¿ç”¨redisè‡ªå¢ç‰¹æ€§åˆ›å»ºå”¯ä¸€idç”Ÿæˆå™¨","date":"2021-04-01T10:18:21.503Z","updated":"2021-04-01T10:18:21.503Z","comments":true,"path":"2021/04/01/language/java/ä½¿ç”¨redisè‡ªå¢ç‰¹æ€§åˆ›å»ºå”¯ä¸€idç”Ÿæˆå™¨/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/language/java/%E4%BD%BF%E7%94%A8redis%E8%87%AA%E5%A2%9E%E7%89%B9%E6%80%A7%E5%88%9B%E5%BB%BA%E5%94%AF%E4%B8%80id%E7%94%9F%E6%88%90%E5%99%A8/","excerpt":"","text":"éœ€æ±‚è¯´æ˜ äº§å“è¦æ±‚å®ç°ä¸€ä¸ªè®¢å•ç¼–å·ï¼Œæ­¤ç¼–å·è§„åˆ™å¦‚ä¸‹ è®¢å•ç¼–å·è§„åˆ™ï¼š â€œå­—æ¯â€ + â€œæ—¥æœŸâ€ + â€œè‡ªå¢IDâ€ è®¢å•ç¼–å·ä¸¾ä¾‹ æ¯”å¦‚ä¸šåŠ¡Aï¼Œåœ¨2020-08-04æ—¥æœ‰ä¸‰ä¸ªè®¢å•ï¼Œé‚£ä¹ˆè®¢å•ç¼–å·å¦‚ä¸‹ï¼š A202008040001 A202008040002 A202008040003 æ¯”å¦‚ä¸šåŠ¡Aï¼Œåœ¨2020-08-05æ—¥æœ‰4ä¸ªè®¢å•ï¼Œé‚£ä¹ˆè®¢å•ç¼–å·å¦‚ä¸‹ï¼š A202008050001 A202008050002 A202008050003 A202008050003 é€šè¿‡ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œåé¢çš„â€œè‡ªå¢IDâ€æ¯å¤©éƒ½ä¼šä»1å¼€å§‹å¢åŠ ï¼Œåœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè¦åšåˆ°æ¯å¤©ä»1å¼€å§‹ä¸é‡å¤å¹¶ä¸”è‡ªå¢çš„æ•ˆæœï¼›æƒ³åˆ°çš„ç¬¬ä¸€ä¸ªå®ç°æ–¹æ¡ˆå°±æ˜¯redisçš„Incrå‘½ä»¤ï¼ˆRedis Incr å‘½ä»¤å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢ä¸€ï¼‰ã€‚ éœ€æ±‚å®ç° é…ç½®redis ä¾èµ–redisç›¸å…³jaråŒ… å› ä¸ºæ­¤æ¨¡å—ç»§æ‰¿äº†spring-boot-starter-parentï¼Œæ‰€ä»¥ä¸éœ€è¦æŒ‡å®šç‰ˆæœ¬ 12345678&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;/dependency&gt; ç¼–å†™é…ç½®redisçš„config 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253package com.nicai.config;import org.springframework.boot.autoconfigure.data.redis.RedisProperties;import org.springframework.boot.context.properties.EnableConfigurationProperties;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.data.redis.connection.RedisClusterConfiguration;import org.springframework.data.redis.connection.RedisConnectionFactory;import org.springframework.data.redis.connection.jedis.JedisConnectionFactory;import org.springframework.data.redis.core.StringRedisTemplate;/** * redisé›†ç¾¤é…ç½® * * @author guozhe * @date 2020/08/04 */@Configuration@EnableConfigurationProperties(RedisProperties.class)public class RedisClusterConfig &#123; private final RedisProperties redisProperties; public RedisClusterConfig(RedisProperties redisProperties) &#123; this.redisProperties = redisProperties; &#125; /** * Thread-safe factory of Redis connectionsé…ç½® * * @return factory of Redis */ @Bean public RedisConnectionFactory redisConnectionFactory() &#123; RedisClusterConfiguration redisClusterConfiguration = new RedisClusterConfiguration(redisProperties.getCluster().getNodes()); redisClusterConfiguration.setPassword(redisProperties.getPassword()); return new JedisConnectionFactory(redisClusterConfiguration); &#125; /** * åˆ›å»ºStringç±»å‹çš„redisæ¨¡æ¿ * * @param redisConnectionFactory factory of Redis * @return String-focused extension of RedisTemplate */ @Bean public StringRedisTemplate stringRedisTemplate(RedisConnectionFactory redisConnectionFactory) &#123; StringRedisTemplate template = new StringRedisTemplate(redisConnectionFactory); template.afterPropertiesSet(); return template; &#125;&#125; å¦‚æœæ˜¯é…ç½®èŒƒå‹çš„RedisTemplateï¼Œéœ€è¦è®¾ç½®å€¼çš„åºåˆ—åŒ–è§„åˆ™ä¸ºï¼šStringRedisSerializerï¼ŒåŸå› å¯ä»¥å‚è€ƒæ­¤æ–‡ç« ï¼šSpring Bootä¸­ä½¿ç”¨RedisTemplateä¼˜é›…çš„æ“ä½œRedisï¼Œå¹¶ä¸”è§£å†³RedisTemplateæ³›å‹æ³¨å…¥å¤±è´¥çš„é—®é¢˜ æµ‹è¯•redisçš„configä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253package com.nicai.config;import com.yuanfeng.accounting.BaseAdminSpringTest;import com.yuanfeng.accounting.Constants;import lombok.extern.slf4j.Slf4j;import org.junit.Assert;import org.junit.Test;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.data.redis.core.StringRedisTemplate;import org.springframework.data.redis.core.ValueOperations;import java.util.concurrent.TimeUnit;/** * @author guozhe * @date 2020/08/04 */@Slf4j@RunWith(SpringRunner.class)@SpringBootTest(classes = AdminApplication.class)public class RedisClusterConfigTest &#123; private static final String TEST_KEY = Constants.REDIS_KEY_PREFIX + &quot;test:hello&quot;; private static final String TEST_VALUE = &quot;world&quot;; @Autowired private StringRedisTemplate stringRedisTemplate; @Test public void testStringRedisTemplateGetAndSet() &#123; stringRedisTemplate.opsForValue().set(TEST_KEY, TEST_VALUE); String value = stringRedisTemplate.opsForValue().get(TEST_KEY); Assert.assertEquals(TEST_VALUE, value); stringRedisTemplate.delete(TEST_KEY); Assert.assertNull(stringRedisTemplate.opsForValue().get(TEST_KEY)); &#125; @Test public void testIncr() &#123; String key = TEST_KEY; ValueOperations&lt;String, String&gt; valueOperations = stringRedisTemplate.opsForValue(); valueOperations.set(key, &quot;1&quot;, 24, TimeUnit.HOURS); String initValue = valueOperations.get(key); log.info(&quot;key=&#123;&#125;, init value=&#123;&#125;&quot;, key, initValue); Assert.assertEquals(&quot;1&quot;, initValue); Long increment = valueOperations.increment(key); log.info(&quot;key=&#123;&#125;, after increment=&#123;&#125;&quot;, key, increment); Assert.assertEquals(Long.valueOf(2), increment); stringRedisTemplate.delete(key); Assert.assertNull(valueOperations.get(key)); &#125;&#125; åŸºäºredisç¼–å†™å”¯ä¸€IDç”ŸæˆæœåŠ¡ æ·»åŠ æŠ½è±¡çš„å”¯ä¸€idç”ŸæˆæœåŠ¡ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197package com.nicai.service;import cn.hutool.core.util.BooleanUtil;import com.alibaba.fastjson.JSON;import lombok.AllArgsConstructor;import lombok.Data;import lombok.NoArgsConstructor;import lombok.extern.slf4j.Slf4j;import org.springframework.data.redis.core.StringRedisTemplate;import java.util.Objects;import java.util.Optional;import java.util.concurrent.TimeUnit;/** * åˆ†å¸ƒå¼IDç”ŸæˆæœåŠ¡ * * @author guozhe * @date 2020/08/04 */@Slf4jpublic abstract class AbstractRedisDistributedIDGenerateService&lt;T extends AbstractRedisDistributedIDGenerateService.Context&gt; &#123; /** * åˆå§‹åŒ–keyæ—¶çš„é»˜è®¤å€¼ */ private static final long DEFAULT_VALUE = 0; protected final StringRedisTemplate redisTemplate; public AbstractRedisDistributedIDGenerateService(StringRedisTemplate redisTemplate) &#123; this.redisTemplate = redisTemplate; &#125; /** * è·å–ä¸‹ä¸€ä¸ªIDï¼Œç›´æ¥ä»redisä¸­è·å–è‡ªå¢åçš„å€¼ï¼› * * @return ä¸‹ä¸€ä¸ªID, å¦‚æœrediså‡ºç°å¼‚å¸¸åˆ™è¿”å›nullï¼Œè¯·ä½¿ç”¨è€…è‡ªè¡Œå¤„ç† */ public final Optional&lt;Long&gt; nextId() &#123; // ä»redisä¸­è·å–è‡ªå¢id Long id = incr(getKey()); return Objects.isNull(id) ? Optional.empty() : Optional.of(id); &#125; /** * è·å–ä¸‹ä¸€ä¸ªIDï¼Œæ ¹æ®ä¼ å…¥çš„ä¸Šä¸‹æ–‡å’Œredisä¸­è‡ªå¢åçš„å€¼æœ€ç»ˆç»„è£…æˆä¸‹ä¸€ä¸ªIDï¼› * è·å–ä¹‹åä¼šäº¤ç»™å­ç±»æ£€æŸ¥æ­¤IDæ˜¯å¦é‡å¤ï¼Œå¦‚æœé‡å¤ä¼šä»å­ç±»ä¸­è·å–æœ€æ–°çš„IDï¼Œç„¶åæ›´æ–°redisä¸­çš„å€¼ * * @param context æ‹¼è£…idæ—¶éœ€è¦çš„ä¸Šä¸‹æ–‡ * @return ä¸‹ä¸€ä¸ªID */ public final String nextId(T context) &#123; Optional&lt;Long&gt; id = nextId(); // å¦‚æœå¯ä»¥ä»redisä¸­è·å–å€¼ï¼Œåˆ™è¯´æ˜redisæœåŠ¡æ­£å¸¸ï¼Œéœ€è¦åˆ¤é‡ï¼›å¦åˆ™ç›´æ¥ä»æ•°æ®åº“ä¸­è·å–ä¸‹ä¸€ä¸ªid String nextId = id.isPresent() ? ifDuplicatedThenUpdate(context, assemblyNextId(context, id.get())) : getNewIdFromDbAndUpdateRedis(context, null); if (log.isDebugEnabled()) &#123; log.debug(&quot;context=&#123;&#125;,redisIncrId=&#123;&#125; nextId=&#123;&#125;&quot;, JSON.toJSONString(context), id, nextId); &#125; return nextId; &#125; /** * æ£€æŸ¥è·å–åˆ°çš„IDæ˜¯å¦é‡å¤ * å¦‚æœé‡å¤åˆ™è¯´æ˜ç”±äºredisçš„ä¸€äº›åŸå› å¯¼è‡´çš„é‡å¤ï¼Œè¿”å›æœ€æ–°çš„redisä¸­åº”è¯¥å­˜åœ¨çš„å€¼ * * @param nextId ä¸‹ä¸€ä¸ªID * @return å¦‚æœå½“å‰IDæ²¡æœ‰é‡å¤ï¼Œåˆ™è¿”å›nullï¼Œå¦åˆ™å¦‚æœé‡å¤äº†åˆ™è¿”å›redisä¸­åº”è¯¥æœ‰çš„å€¼ */ protected abstract boolean checkIfDuplicated(String nextId); /** * ä»æ•°æ®åº“è·å–ä¸‹ä¸€ä¸ªid * * @param duplicatedId é‡å¤çš„idï¼Œæ­¤å…¥å‚å¯èƒ½ä¸ºnullï¼Œå­ç±»éœ€è¦è‡ªå·±å¤„ç† * @return æ•°æ®åº“è·å–ä¸‹ä¸€ä¸ªid */ protected abstract Long maxIdFromDatabase(String duplicatedId); /** * å­ç±»æ ¹æ®rediså½“å‰çš„å€¼è‡ªè¡Œç»„è£…æœ€ç»ˆçš„ID * * @param context ä¸Šä¸‹æ–‡ * @param redisValue rediså½“å‰çš„å€¼ * @return æœ€ç»ˆçš„ID */ protected abstract String assemblyNextId(T context, Long redisValue); /** * è·å–redisè‡ªå¢çš„key * * @return redisè‡ªå¢çš„key */ protected abstract String getKey(); /** * è°ƒç”¨redisçš„è‡ªå¢æ–¹æ³• * å¦‚æœkeyä¸å­˜åœ¨åˆ™å…ˆè®¾ç½®keyï¼Œå†è°ƒç”¨è‡ªå¢æ–¹æ³• * * @param key éœ€è¦è‡ªå¢çš„key * @return è‡ªå¢ä¹‹åçš„å€¼ï¼Œå¦‚æœrediså‡ºç°å¼‚å¸¸åˆ™è¿”å›null */ Long incr(String key) &#123; Long increment = null; try &#123; // å…ˆæ£€æŸ¥redisä¸­æ˜¯å¦æœ‰key,å¦‚æœæ²¡æœ‰,å…ˆè®¾ç½®keyå¹¶ä¸”è®¾ç½®è¿‡æœŸæ—¶é—´ if (BooleanUtil.isFalse(redisTemplate.hasKey(key))) &#123; initOrUpdateValue(key, getKeyInitValue()); &#125; increment = redisTemplate.opsForValue().increment(key); &#125; catch (Exception e) &#123; log.error(&quot;è°ƒç”¨redisçš„è‡ªå¢æ–¹æ³•å¼‚å¸¸ï¼Œerror_message=&#123;&#125;&quot;, e.getMessage(), e); &#125; log.debug(&quot;key = &#123;&#125;, increment=&#123;&#125;&quot;, key, increment); return increment; &#125; /** * è·å–åˆå§‹åŒ–keyæ—¶çš„valueå€¼ï¼Œé»˜è®¤æ˜¯0ï¼Œè‡ªå¢ä¹‹åidä»1å¼€å§‹ï¼› * å¦‚æœå­ç±»æƒ³ä»å…¶ä»–æ•°å­—å¼€å§‹åˆ™è‡ªå·±è¦†ç›–æ­¤æ–¹æ³•å³å¯ * * @return åˆå§‹åŒ–keyæ—¶çš„valueå€¼ */ protected long getKeyInitValue() &#123; return DEFAULT_VALUE; &#125; /** * è·å–keyçš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯å°æ—¶ï¼Œç”±å­ç±»è®¾ç½® * * @return è¶…æ—¶æ—¶é—´ï¼Œå•ä½å°æ—¶ */ protected abstract long getTimeOutHours(); /** * åˆ¤æ–­æ˜¯å¦é‡å¤ï¼Œå¦‚æœé‡å¤åˆ™ä»åˆ«çš„æ¸ é“ï¼ˆç”±å­ç±»è‡ªå·±å†³å®šä»å“ªä¸ªæ¸ é“ï¼‰æ›´æ–° * * @param context æ‹¼è£…idæ—¶éœ€è¦çš„ä¸Šä¸‹æ–‡ * @param nextId ä¸‹ä¸€ä¸ªid * @return å¦‚æœé‡å¤åˆ™è¿”å›æ–°çš„nextIdï¼Œå¦åˆ™è¿”å›å…¥å‚ä¼ å…¥çš„nextId */ private String ifDuplicatedThenUpdate(T context, String nextId) &#123; // åˆ¤æ–­æ˜¯å¦é‡å¤ï¼Œå¦‚æœé‡å¤åˆ™ä»æ•°æ®åº“ä¸­è·å–ï¼Œå¦åˆ™ç›´æ¥è¿”å›å½“å‰å€¼ return checkIfDuplicated(nextId) ? getNewIdFromDbAndUpdateRedis(context, nextId) : nextId; &#125; /** * ä»æ•°æ®åº“è·å–æ–°idå¹¶æ›´æ–°redisä¸­çš„å€¼ * * @param context æ‹¼è£…idæ—¶éœ€è¦çš„ä¸Šä¸‹æ–‡ * @param nextId ä¸‹ä¸€ä¸ªid * @return æ ¹æ®æ•°æ®åº“çš„idè·å¾—çš„æ–°id */ private String getNewIdFromDbAndUpdateRedis(T context, String nextId) &#123; Long maxIdFromDatabase = maxIdFromDatabase(nextId); String newId = assemblyNextId(context, maxIdFromDatabase); log.warn(&quot;nextId=&#123;&#125; åœ¨æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨ï¼ŒmaxIdFromDatabase=&#123;&#125; é‡æ–°è·å–æ–°çš„newId=&#123;&#125;&quot;, nextId, maxIdFromDatabase, newId); initOrUpdateValue(getKey(), maxIdFromDatabase); return newId; &#125; /** * åˆå§‹åŒ–æˆ–è€…æ›´æ–°redisä¸­çš„è‡ªå¢çš„å€¼ * * @param key redisä¸­çš„key * @param value éœ€è¦è®¾ç½®çš„å€¼ */ private void initOrUpdateValue(String key, Long value) &#123; try &#123; redisTemplate.opsForValue().set(key, String.valueOf(value), getTimeOutHours(), TimeUnit.HOURS); &#125; catch (Exception e) &#123; log.error(&quot;è®¾ç½®rediså€¼å¼‚å¸¸ï¼Œvalue=&#123;&#125; error_message=&#123;&#125;&quot;, value, e.getMessage(), e); &#125; &#125; /** * ä¸Šä¸‹æ–‡ï¼›å­ç±»è‡ªå·±å®šä¹‰ä¸Šä¸‹æ–‡ï¼Œç„¶åæ ¹æ®ä¸Šä¸‹æ–‡çš„æ•°æ®æ¥æœ€ç»ˆç»„è£…ID */ public interface Context &#123; &#125; /** * å‡­è¯ç¼–å·ä¸Šä¸‹æ–‡ */ @Data @NoArgsConstructor @AllArgsConstructor public static class AContext implements Context &#123; /** * ä¸šåŠ¡ç±»å‹ */ private String businessType; &#125;&#125; æ·»åŠ ä¸€ä¸ªAæœåŠ¡çš„å”¯ä¸€idç”ŸæˆæœåŠ¡å®ç° 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980package com.nicai.service.impl;import cn.hutool.core.date.DatePattern;import cn.hutool.core.date.DateUtil;import cn.hutool.core.util.StrUtil;import com.yuanfeng.accounting.Constants;import com.yuanfeng.accounting.dao.ManualVoucherDAO;import com.yuanfeng.accounting.entity.ManualVoucherEntity;import com.yuanfeng.accounting.exception.AccountingException;import com.yuanfeng.accounting.service.AbstractRedisDistributedIDGenerateService;import lombok.extern.slf4j.Slf4j;import org.springframework.data.redis.core.StringRedisTemplate;import org.springframework.stereotype.Service;import java.util.List;import java.util.Objects;import java.util.Optional;/** * åˆ†å¸ƒå¼å”¯ä¸€IDç”Ÿæˆ-Aå®ç°ç±» * ç¼–å·è§„åˆ™ï¼šç”¨é€”+æ—¥æœŸ+è‡ªå¢IDï¼Œå¦‚ï¼šA202007310001ï¼›A202007310002ï¼›A202008070001ï¼› * * @author guozhe * @date 2020/08/04 */@Slf4j@Servicepublic class DistributedIDGenerateServiceAImpl extends AbstractRedisDistributedIDGenerateService&lt;AbstractRedisDistributedIDGenerateService.AContext&gt; &#123; /** * ä¸šåŠ¡ç±»å‹ */ private static final String BUSINESS_TYPE = &quot;A:&quot;; /** * IDé•¿åº¦ä¸è¶³4ä½æ—¶åœ¨å‰é¢å¡«å……çš„å­—ç¬¦ */ private static final char FILLED_CHAR = &#x27;0&#x27;; /** * æœ€åçš„è‡ªå¢IDçš„é•¿åº¦ */ private static final int INCREMENT_LENGTH = 4; /** * è¿‡æœŸå°æ—¶æ•°ï¼Œå³åœ¨24å°æ—¶å€™è¿‡æœŸ */ private static final int EXPIRATION_HOURS = 24; public DistributedIDGenerateServiceAImpl(StringRedisTemplate redisTemplate) &#123; super(redisTemplate); &#125; @Override protected boolean checkIfDuplicated(String nextId) &#123; return false; &#125; @Override protected Long maxIdFromDatabase(String duplicatedId) &#123; return 1L; &#125; @Override protected String assemblyNextId(VoucherNumberContext context, Long redisValue) &#123; return String.join(Constants.BLANK, context.getBusinessType(), getDatePeriod(), StrUtil.fillBefore(String.valueOf(redisValue), FILLED_CHAR, INCREMENT_LENGTH)); &#125; @Override protected String getKey() &#123; return String.join(Constants.REDIS_KEY_DELIMITER, Constants.REDIS_KEY_PREFIX, BUSINESS_TYPE, getDatePeriod()); &#125; @Override protected long getTimeOutHours() &#123; return EXPIRATION_HOURS; &#125;&#125;","categories":[{"name":"Java","slug":"Java","permalink":"https://guozhe001.github.io/categories/Java/"},{"name":"Redis","slug":"Java/Redis","permalink":"https://guozhe001.github.io/categories/Java/Redis/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://guozhe001.github.io/tags/Java/"},{"name":"Redis","slug":"Redis","permalink":"https://guozhe001.github.io/tags/Redis/"}]},{"title":"çº¿ç¨‹æ± æ— æ³•æ•è·çº¿ç¨‹çš„å¼‚å¸¸è¸©å‘å¤ç›˜","slug":"language/java/çº¿ç¨‹æ± æ— æ³•æ•è·çº¿ç¨‹çš„å¼‚å¸¸è¸©å‘å¤ç›˜","date":"2021-04-01T10:18:21.503Z","updated":"2021-04-01T10:18:21.503Z","comments":true,"path":"2021/04/01/language/java/çº¿ç¨‹æ± æ— æ³•æ•è·çº¿ç¨‹çš„å¼‚å¸¸è¸©å‘å¤ç›˜/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/language/java/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%97%A0%E6%B3%95%E6%8D%95%E8%8E%B7%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%BC%82%E5%B8%B8%E8%B8%A9%E5%9D%91%E5%A4%8D%E7%9B%98/","excerpt":"","text":"é—®é¢˜æè¿° éœ€æ±‚ä¿¡æ¯ æœ€è¿‘åœ¨å·¥ä½œä¸­æœ‰ä¸ªéœ€æ±‚ï¼Œå…ˆåœ¨AæœåŠ¡é¡µé¢å¢åŠ ä¸€æ¡æ•°æ®ï¼Œç„¶åå»BæœåŠ¡æŸ¥è¯¢æ­¤æ•°æ®çš„è¯¦ç»†ä¿¡æ¯ è§£å†³æ–¹æ¡ˆ ä¸ºäº†ä½¿AæœåŠ¡çš„æ–°å¢æ•°æ®æ¥å£å¿«é€Ÿå“åº”ï¼Œåœ¨æŸ¥è¯¢BæœåŠ¡æ•°æ®è¯¦æƒ…çš„åœ°æ–¹ä½¿ç”¨äº†çº¿ç¨‹æ± å¼‚æ­¥æŸ¥è¯¢ä¸æ›´æ–°ã€‚ é—®é¢˜ç°è±¡ åœ¨éªŒè¯æ—¶å‘ç°æ•°æ®åº“ä¸­çš„æ•°æ®å­—æ®µä¸å…¨ï¼Œç»åˆ†æç¼ºå°‘çš„éƒ½æ˜¯éœ€è¦ä»BæœåŠ¡æŸ¥è¯¢å¹¶æ›´æ–°çš„å­—æ®µ åˆæ­¥å®šä½ çŒœæµ‹åº”è¯¥æ˜¯æŸ¥è¯¢BæœåŠ¡æ—¶å‡ºäº†ä¸€äº›å¼‚å¸¸ï¼Œè€Œç”±äºä¸è§„èŒƒä½¿ç”¨çº¿ç¨‹æ± å¯¼è‡´å¼‚å¸¸æ²¡æœ‰æŠ›å‡ºï¼Œç›´æ¥æ‰“åˆ°äº†æ§åˆ¶å°ï¼Œæ•…AæœåŠ¡çš„æ—¥å¿—ç³»ç»Ÿå¹¶çœ‹ä¸åˆ°é”™è¯¯æ—¥å¿—ã€‚ é—®é¢˜è§£å†³ æŸ¥è¯¢BæœåŠ¡æ•°æ®è¯¦æƒ…æ—¶æš‚æ—¶å»æ‰ä½¿ç”¨çº¿ç¨‹æ± ï¼Œæ”¹ä¸ºåŒæ­¥è°ƒç”¨ å¢åŠ å®¹é”™å®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶æŸ¥è¯¢éœ€è¦ä»BæœåŠ¡è·å–ç¼ºå¤±å­—æ®µçš„æ•°æ®è¿›è¡Œæ›´æ–° ä¸Šçº¿åè§‚å¯Ÿï¼Œæ–°å¢çš„æ•°æ®ä¸å†æœ‰éƒ¨åˆ†å­—æ®µç¼ºå¤±çš„æƒ…å†µï¼›é—®é¢˜è§£å†³ã€‚ é—®é¢˜å¤ç›˜ AæœåŠ¡çº¿ç¨‹æ± çš„ä½¿ç”¨ çº¿ç¨‹æ± å®šä¹‰ 12345/** * æŸ¥è¯¢BæœåŠ¡æ•°æ®è¯¦æƒ…çš„çº¿ç¨‹æ±  */private static final ExecutorService executorService = new ThreadPoolExecutor(2, 2, 0L, TimeUnit.MICROSECONDS, new LinkedBlockingDeque&lt;&gt;(), new ThreadFactoryBuilder().setNameFormat(&quot;queryDataDetail-%d&quot;).build()); çº¿ç¨‹æ± ä½¿ç”¨ 12345678910@Override@Transactional(rollbackFor = Exception.class)public void add(String contract) &#123; // 0ã€æ£€æŸ¥åˆåŒå¿…é¡»ä¸å­˜åœ¨ checkIfExist(contract); // 1ã€ä¿å­˜åˆåŒæ•°æ® Entity entity = saveData(contract); // 2ã€ä»BæœåŠ¡æŸ¥è¯¢ç¼ºå¤±ä¿¡æ¯ executorService.execute(() -&gt; queryDataDetail(entity));&#125; å¦‚æ­¤ä½¿ç”¨æœ‰ä½•é—®é¢˜ æˆ‘é‡æ–°å†™äº†ä¸€ä¸ªæµ‹è¯•æ–¹æ³•å¦‚ä¸‹ï¼š 1ã€å®šä¹‰ä¸€ä¸ªä¼šä¸€ç›´æŠ›å¼‚å¸¸çš„æ–¹æ³• 1234567891011121314/** * å¼•å…¥SystemOutRuleï¼Œç›‘å¬ç¨‹åºæ—¥å¿—è¾“å‡º */@Rulepublic SystemOutRule systemOutRule = new SystemOutRule().enableLog();/** * å¼•å…¥SystemOutRuleï¼Œç›‘å¬ç¨‹åºæ—¥å¿—è¾“å‡º */private String runWithException() &#123; Thread thread = Thread.currentThread(); log.info(&quot;thread is &#123;&#125;&quot;, thread); log.info(&quot;eh=&#123;&#125;&quot;, thread.getUncaughtExceptionHandler()); throw new NicaiException(&quot;å‡ºé”™å•¦ï¼&quot;);&#125; 2ã€ä½¿ç”¨çº¿ç¨‹æ± è°ƒç”¨ä¸Šé¢çš„æ–¹æ³• 12345678@Testpublic void run() throws InterruptedException &#123; ExecutorService executorService = Executors.newCachedThreadPool(); executorService.execute(this::runWithException); TimeUnit.MILLISECONDS.sleep(100L); // æ–­è¨€ç¨‹åºæ‰“å°çš„æ—¥å¿—ä¸åŒ…å«â€œå‡ºé”™å•¦ï¼â€ Assert.assertFalse(systemOutRule.getLog().contains(&quot;å‡ºé”™å•¦ï¼&quot;));&#125; 3ã€ä¸Šé¢çš„å•æµ‹æ–­è¨€æ˜¯æˆåŠŸçš„ï¼Œé‚£ä¹ˆå¼‚å¸¸è·‘å“ªé‡Œå»äº†ï¼Ÿä¸Šé¢çš„å•æµ‹åœ¨æ§åˆ¶å°çš„è¾“å‡ºå¦‚ä¸‹ï¼š 4ã€å¯ä»¥çœ‹å‡ºä¸Šé¢çš„å¼‚å¸¸ä¿¡æ¯æ˜¯ç›´æ¥è¾“å‡ºåˆ°äº†æ§åˆ¶å°ï¼Œè€Œä¸æ˜¯ç”±ç¨‹åºè¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œä¸»è¦åŸå› æ˜¯ä¸»ç¨‹åºæ²¡æœ‰æ•è·åˆ°æ­¤å¼‚å¸¸å¯¼è‡´çš„ã€‚ï¼ˆå…·ä½“åŸå› è¿˜æ²¡æœ‰æ·±å…¥ï¼‰ å¦‚ä½•è§£å†³çº¿ç¨‹æ± çš„å¼‚å¸¸æ•è·é—®é¢˜ ä¸Šé¢çš„æµ‹è¯•å¯ä»¥è¯´æ˜åˆ°ä¸ºä»€ä¹ˆæ—¥å¿—é‡Œé¢æŸ¥ä¸åˆ°é”™è¯¯æ—¥å¿—ï¼Œé‚£ä¹ˆå¦‚ä½•æ•è·çº¿ç¨‹é‡Œçš„å¼‚å¸¸å‘¢ï¼Ÿ æ–¹æ³•1:ä½¿ç”¨UncaughtExceptionHandler 1ã€åœ¨åˆ›å»ºçº¿ç¨‹æ± çš„æ—¶å€™ï¼Œè®¾ç½®ä¼ å…¥çš„ThreadFactoryçš„UncaughtExceptionHandlerå±æ€§ï¼Œæ­¤UncaughtExceptionHandlerä¼šå¤„ç†çº¿ç¨‹ä¸­çš„å¼‚å¸¸ï¼›ä¸‹é¢çš„ä¾‹å­æˆ‘ç›´æ¥æ‰“å°äº†å‡ºæ¥å¼‚å¸¸åŸå› å’Œå¼‚å¸¸æ ˆã€‚ 12345678910@Testpublic void runWithUncaughtExceptionHandler() throws InterruptedException &#123; ExecutorService executorService = Executors.newCachedThreadPool( new ThreadFactoryBuilder() .setUncaughtExceptionHandler((t, e) -&gt; log.info(&quot;UncaughtExceptionHandler caught, error_message=&#123;&#125;&quot;, e.getMessage(), e)) .build()); executorService.execute(this::runWithException); TimeUnit.MILLISECONDS.sleep(100L); Assert.assertTrue(systemOutRule.getLog().contains(&quot;å‡ºé”™å•¦ï¼&quot;));&#125; 2ã€ä¸Šé¢çš„å•æµ‹è¿è¡Œç»“æœå¦‚ä¸‹ï¼šï¼ˆå¯ä»¥å’Œä¸Šé¢çš„è¿è¡Œç»“æœè¿›è¡Œæ¯”å¯¹ï¼‰ 3ã€ä»ä¸Šé¢çš„è¿è¡Œç»“æœå¯ä»¥çœ‹å‡ºå¼‚å¸¸ä¿¡æ¯æ˜¯ç”±ç¨‹åºæ•è·åå†è¾“å‡ºå‡ºæ¥ï¼Œè¿™æ ·å°±ä¸ä¼šå¯¼è‡´æŸ¥ä¸åˆ°å¼‚å¸¸æ—¥å¿—äº†ã€‚ æ–¹æ³•2:ä½¿ç”¨guavaæ‰©å±•çš„FutureCallback 1ã€guavaå¯¹jdkçš„çº¿ç¨‹åšäº†ä¸€äº›æ‰©å±•ï¼Œå…¶ä¸­ä¸€ä¸ªå°±æ˜¯FutureCallbackï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š 123456789101112131415161718@Testpublic void runWithGuavaThreadPool() throws InterruptedException &#123; ListeningExecutorService executorService = MoreExecutors.listeningDecorator(Executors.newCachedThreadPool()); ListenableFuture&lt;String&gt; listenableFuture = executorService.submit(this::runWithException); Futures.addCallback(listenableFuture, new FutureCallback&lt;String&gt;() &#123; @Override public void onSuccess(String result) &#123; log.info(&quot;success! result = &#123;&#125;&quot;, result); &#125; @Override public void onFailure(Throwable t) &#123; log.error(&quot;guava FutureCallback caught, error_message=&#123;&#125;&quot;, t.getMessage(), t); &#125; &#125;, executorService); TimeUnit.MILLISECONDS.sleep(100L); Assert.assertTrue(systemOutRule.getLog().contains(&quot;å‡ºé”™å•¦ï¼&quot;));&#125; 2ã€ä¸Šé¢çš„å•æµ‹è¿è¡Œç»“æœå¦‚ä¸‹ï¼š é—®é¢˜æ€»ç»“ 1ã€é€šè¿‡ä¸Šé¢çš„æµ‹è¯•ï¼Œä¼˜åŒ–AæœåŠ¡çš„çº¿ç¨‹æ± å®šä¹‰ï¼Œä½¿ä¹‹åœ¨é‡åˆ°å¼‚å¸¸æ—¶èƒ½å¤Ÿæ­£å¸¸è¢«æ•è·ï¼Œèƒ½è¾“å‡ºï¼Œæ–¹ä¾¿é—®é¢˜å®šä½ï¼›è¡¥å¿å®šæ—¶ä»»åŠ¡ä¹Ÿèƒ½å¯¹ç¬¬ä¸€æ¬¡æŸ¥è¯¢å¼‚å¸¸è¿›è¡Œå®¹é”™ï¼Œä¿è¯æ•°æ®èƒ½å¤ŸåŒæ­¥è¿‡æ¥ã€‚ 1234567/** * æŸ¥è¯¢BæœåŠ¡æ•°æ®è¯¦æƒ…çš„çº¿ç¨‹æ±  */private static final ExecutorService executorService = new ThreadPoolExecutor(2, 2, 0L, TimeUnit.MICROSECONDS, new LinkedBlockingDeque&lt;&gt;(), new ThreadFactoryBuilder() .setUncaughtExceptionHandler((t, e) -&gt; log.error(&quot;æŸ¥è¯¢æ•°æ®è¯¦æƒ…çš„çº¿ç¨‹æ± å¼‚å¸¸,error_message=&#123;&#125;&quot;, e.getMessage(), e)) .setNameFormat(&quot;queryDataDetail-%d&quot;).build()); 2ã€å½“ç„¶æ­¤é—®é¢˜æ›´æ·±å±‚çš„é—®é¢˜è¿˜æ²¡æœ‰å®Œå…¨è§£ç­” ä¸ºä»€ä¹ˆçº¿ç¨‹é‡Œçš„å¼‚å¸¸ä¸ä¼šè¢«æ•è·ï¼Ÿ UncaughtExceptionHandlerçš„è¿è¡ŒåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ Guavaçš„FutureCallbackæ˜¯å¦‚ä½•è¿è¡Œçš„ï¼Ÿ 3ã€æµ‹è¯•ä»£ç æºç åœ°å€","categories":[{"name":"Java","slug":"Java","permalink":"https://guozhe001.github.io/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://guozhe001.github.io/tags/Java/"},{"name":"çº¿ç¨‹æ± ","slug":"çº¿ç¨‹æ± ","permalink":"https://guozhe001.github.io/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/"}]},{"title":"ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨ä½¿ç”¨Springçš„æ—¶å€™åº”è¯¥ä½¿ç”¨æ„é€ æ–¹æ³•æ³¨å…¥bean","slug":"language/java/ä¸ºä»€ä¹ˆå»ºè®®ä½¿ç”¨æ„é€ å™¨æ³¨å…¥è€Œä¸æ˜¯@Autoware","date":"2021-04-01T10:18:21.502Z","updated":"2021-04-01T10:18:21.503Z","comments":true,"path":"2021/04/01/language/java/ä¸ºä»€ä¹ˆå»ºè®®ä½¿ç”¨æ„é€ å™¨æ³¨å…¥è€Œä¸æ˜¯@Autoware/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/language/java/%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BB%BA%E8%AE%AE%E4%BD%BF%E7%94%A8%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5%E8%80%8C%E4%B8%8D%E6%98%AF@Autoware/","excerpt":"","text":"é—®é¢˜ å¯¹äºä½¿ç”¨Springæ¡†æ¶çš„javaå¼€å‘äººå‘˜å¯¹ä¸‹é¢çš„ä»£ç åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼š 12@Autowiredprivate HelloService helloService; ä½†æ˜¯å¯¹äºä¸Šé¢çš„ä»£ç ï¼ŒSonarä¼šæç¤ºï¼šRemove this annotation and use constructor injection instead. ç¿»è¯‘æˆä¸­æ–‡å³ï¼šç§»é™¤@Autowiredæ³¨è§£ä½¿ç”¨æ„é€ å™¨æ³¨å…¥æ–¹å¼æ›¿ä»£ã€‚ IntelliJ IDEAä¹Ÿä¼šæç¤ºField injection is not recommended ç¿»è¯‘æˆä¸­æ–‡å³ï¼šä¸æ¨èä½¿ç”¨å­—æ®µæ³¨å…¥ é‚£ä¹ˆä»–ä»¬ä¸ºä»€ä¹ˆè¿™ä¹ˆå»ºè®®å‘¢ï¼Ÿ é¦–å…ˆæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹Springæœ‰å“ªäº›æ³¨å…¥beançš„æ–¹å¼ æ„é€ æ–¹æ³•æ³¨å…¥ setæ–¹æ³•æ³¨å…¥ å­—æ®µæ³¨å…¥ï¼Œå³@Autowiredæ³¨è§£ å¦‚ä½•ä½¿ç”¨è¿™äº›æ–¹å¼ æ„é€ æ–¹æ³•æ³¨å…¥ åœ¨Spring4.3ç‰ˆæœ¬ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»è¦åœ¨æ„é€ æ–¹æ³•ä¸ŠåŠ @Autowiredæ³¨è§£ï¼›åœ¨æ–°ç‰ˆæœ¬ä¸­å¦‚æœå½“å‰ç±»åªæœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•@Autowiredæ³¨è§£å°±æ˜¯å¯é€‰çš„ã€‚ åªæœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•ç¤ºä¾‹ï¼š 123456789@Controllerpublic class ValidationController &#123; private final HelloService helloService; public ValidationController(HelloService helloService) &#123; this.helloService = helloService; &#125;&#125; å¤šä¸ªæ„é€ æ–¹æ³•ç¤ºä¾‹ï¼š 1234567891011121314@Controllerpublic class ValidationController &#123; private HelloService helloService; @Autowired public ValidationController(HelloService helloService) &#123; this.helloService = helloService; &#125; public ValidationController() &#123; &#125;&#125; setæ–¹æ³•æ³¨å…¥ è¿™ç§æ–¹å¼Springä¼šæ‰¾åˆ° @Autowired æ³¨è§£å¹¶ä¸”è°ƒç”¨setæ–¹æ³•æ¥æ³¨å…¥æ‰€éœ€çš„ä¾èµ–ã€‚ 1234567891011121314@Controllerpublic class ValidationController &#123; private HelloService helloService; public HelloService getHelloService() &#123; return helloService; &#125; @Autowired public void setHelloService(HelloService helloService) &#123; this.helloService = helloService; &#125;&#125; å­—æ®µæ³¨å…¥ é€šè¿‡åŸºäºå­—æ®µçš„æ³¨å…¥ï¼ŒSpringåœ¨ä½¿ç”¨@Autowiredæ³¨é‡Šè¿›è¡Œæ³¨é‡Šæ—¶ï¼Œç›´æ¥å°†æ‰€éœ€çš„ä¾èµ–é¡¹åˆ†é…ç»™å­—æ®µã€‚ 123456@Controllerpublic class ValidationController &#123; @Autowired private HelloService helloService;&#125; è¿™äº›æ–¹å¼æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ æ—¢ç„¶è¦ç§»é™¤@Autowiredæ³¨è§£ä½¿ç”¨æ„é€ å™¨æ³¨å…¥æ–¹å¼æ›¿ä»£ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸»è¦è®¨ä¸€ä¸‹è¿™äº›æ–¹å¼çš„ä¼˜ç¼ºç‚¹ã€‚ å­—æ®µæ³¨å…¥æ–¹å¼çš„ä¼˜ç‚¹ ç›¸æ¯”è¾ƒå¦å¤–ä¸¤ç§æ–¹å¼ï¼Œå­—æ®µæ³¨å…¥æ–¹å¼çš„ä»£ç é‡æ›´å°‘ã€æ›´æ•´é½ã€æ›´ç®€æ´ æ„é€ æ–¹æ³•æ³¨å…¥çš„ä¼˜ç‚¹ å®¹æ˜“å‘ç°ä»£ç çš„åå‘³é“ setæ–¹æ³•æ³¨å…¥å’Œå­—æ®µæ³¨å…¥ä¼šé—´æ¥è¿åå•ä¸€èŒè´£åŸåˆ™ã€‚ å› ä¸ºåœ¨ä¸€ä¸ªç±»ä¾èµ–å¾ˆå¤šå…¶ä»–ç±»çš„æ—¶å€™ï¼Œå¦‚æœä½¿ç”¨æ„é€ æ–¹æ³•æ³¨å…¥å°±ä¼šå‘ç°æ„é€ æ–¹æ³•çš„å‚æ•°å¤ªå¤šï¼Œè¿™ä¼šè®©å¼€å‘äººå‘˜åæ€è¿™ä¸ªç±»çœŸçš„éœ€è¦è¿™ä¹ˆå¤šä¾èµ–å—ï¼Ÿå½“å‰ç±»æ˜¯ä¸æ˜¯èŒè´£è¿‡å¤šï¼Ÿ è€Œä½¿ç”¨å­—æ®µæ³¨å…¥æ—¶ï¼Œå°±ä¼šæŠŠä¸€äº›ä¾‹å¦‚sonarçš„æç¤ºå±è”½æ‰ï¼Œè®©å¼€å‘äººå‘˜è¯¯ä»¥ä¸ºè¿™æ ·åšæ²¡æœ‰é—®é¢˜ å¯ä»¥åˆ›å»ºä¸å¯å˜ç±» åœ¨ä½¿ç”¨æ„é€ æ–¹æ³•æ³¨å…¥æ—¶å› ä¸ºæ„é€ æ–¹æ³•æ˜¯åˆ›å»ºä¾èµ–å¯¹è±¡çš„å”¯ä¸€æ–¹å¼ï¼Œè¿™éå¸¸æœ‰åŠ©äºè®©æˆ‘ä»¬åˆ›å»ºä¸å¯å˜çš„å¯¹è±¡ã€‚ æƒ³è±¡ä¸€ä¸‹åˆ›å»ºä¸€ä¸ªbeanä¹‹åä½ å¯ä»¥é€šè¿‡setæ–¹æ³•éšæ„ä¿®æ”¹æ­¤ç±»çš„ä¾èµ–ï¼Œåœ¨å‡ºç°é—®é¢˜æ—¶æ˜¯å¾ˆéš¾å®šä½çš„ã€‚ @Autowiredçš„æºç æœ‰ä¸€æ®µæ³¨é‡Šå¦‚ä¸‹ï¼šFields are injected right after construction of a bean, before any config methods are invoked. Such a config field does not have to be public. å¤§æ„æ˜¯ä½¿ç”¨@Autowiredæ³¨è§£æ—¶ï¼Œbeanæ˜¯åœ¨æ„é€ å½“å‰çš„beanä¹‹åï¼Œå¹¶ä¸”åœ¨ä»»ä½•çš„å…¶ä»–æ–¹æ³•è°ƒç”¨ä¹‹å‰æ³¨å…¥ï¼Œå› æ­¤æ— æ³•è®¾ç½®æˆfinalç±»å‹çš„å­—æ®µã€‚ æ›´æ˜æ˜¾çš„å£°æ˜æ‰€æœ‰çš„ä¾èµ– ä½¿ç”¨æ„é€ æ–¹æ³•æ³¨å…¥ï¼Œåœ¨ä½¿ç”¨è¿™ä¸ªç±»æ—¶å°±ä¼šæš´éœ²ç»™ä½¿ç”¨è€…è¯´æˆ‘è¦ä¾èµ–æ„é€ æ–¹æ³•ä¸­çš„ç±»ã€‚ ä½†æ˜¯ä½¿ç”¨å­—æ®µæ³¨å…¥æ—¶ï¼Œä½¿ç”¨è€…å…¶å®å¹¶ä¸çŸ¥é“è¿™ä¸ªç±»ä¾èµ–äº†å“ªäº›ç±»ï¼Œé™¤éæˆ‘åˆ°æ­¤ç±»ä¸­æŸ¥çœ‹è¿™ä¸ªç±»æœ‰å¤šå°‘ä¸ªå­—æ®µæ˜¯æœ‰@Autowiredæ³¨è§£ã€‚ ä¸æ–¹ä¾¿è¿ç§» springå®ç°äº†DIï¼ˆæ§åˆ¶åè½¬ï¼‰ï¼Œä½†å¹¶éæ˜¯DIæœ¬èº«ï¼› ä½¿ç”¨æ„é€ æ–¹æ³•æ³¨å…¥æ—¶ï¼Œé™¤äº†åœ¨ç±»ä¸Šé¢æœ‰@Serviceã€@Componentç­‰çš„æ³¨è§£ï¼Œæ²¡æœ‰å…¶ä»–çš„Springç›¸å…³çš„æ›´å¤šçš„æ³¨è§£ã€‚ ä½¿ç”¨å­—æ®µæ³¨å…¥æ—¶ï¼Œé™¤äº†åœ¨ç±»ä¸Šé¢æœ‰@Serviceã€@Componentç­‰çš„æ³¨è§£ä¹‹å¤–åˆä½¿ç”¨äº†Springçš„@Autowiredæ³¨è§£ï¼Œå¦‚æœæŠŠæ­¤ç±»è¿ç§»åˆ°å…¶ä»–æ²¡æœ‰springçš„ç¯å¢ƒæ—¶æ˜¯å®Œæˆä¸äº†æ³¨å…¥çš„ã€‚ ä¸æ–¹ä¾¿æµ‹è¯• åœ¨ä½¿ç”¨æ„é€ æ–¹æ³•æ³¨å…¥æ—¶ï¼Œå•å…ƒæµ‹è¯•æ—¶å¼€å‘äººå‘˜å¯ä»¥ç›´æ¥ä¼ å…¥ä¸€ä¸ªmockçš„ç±»æˆ–è€…å…¶ä»–çš„ä»»ä½•è¢«æµ‹è¯•ç±»ä¾èµ–çš„å­ç±»ï¼› å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨setæ–¹å¼æ³¨å…¥ä¸€ä¸ªmockçš„ç±»ï¼Œä½†æ˜¯å¦‚æœä»£ç ä¿®æ”¹äº†æ–°å¢äº†ä¸€ä¸ªä¾èµ–ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾ˆå®¹æ˜“å¿˜æ‰åœ¨æµ‹è¯•ä»£ç ä¸­setæ–°å¢çš„ä¾èµ–ï¼Œç›´åˆ°è¿è¡Œçš„æ—¶å€™æˆ‘ä»¬æ‰ä¼šçœ‹åˆ°å¯èƒ½æœ‰NPEå¼‚å¸¸çˆ†å‡ºï¼›ä½†æ˜¯æ„é€ æ–¹æ³•å°±ä¸å¿…æœ‰è¿™ç§çƒ¦æ¼ï¼Œå› ä¸ºå¦‚æœæ–°å¢äº†ä¸€ä¸ªä¾èµ–ï¼Œæµ‹è¯•æ–¹æ³•ä¼šé©¬ä¸Šç¼–è¯‘ä¸é€šè¿‡ã€‚ ä½¿ç”¨å­—æ®µæ³¨å…¥ï¼Œå¿…é¡»ä¾èµ–Springå»å¸®åŠ©æ³¨å…¥ä¾èµ–çš„ç±» æ€»ç»“ é€šè¿‡æ„é€ æ–¹æ³•æ³¨å…¥beanæ˜¯æˆ‘ä»¬æ›´å®¹æ˜“åˆ›å»ºä¸å¯å˜ç±»ï¼Œä»£ç æ›´å¥å£®ã€æ›´å…·æœ‰å¯æµ‹è¯•æ€§ã€æ›´å®¹æ˜“é¿å…NPEã€‚","categories":[{"name":"Java","slug":"Java","permalink":"https://guozhe001.github.io/categories/Java/"},{"name":"Spring","slug":"Java/Spring","permalink":"https://guozhe001.github.io/categories/Java/Spring/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://guozhe001.github.io/tags/Java/"},{"name":"Spring","slug":"Spring","permalink":"https://guozhe001.github.io/tags/Spring/"}]},{"title":"åˆ›å»ºä¸€ä¸ªæ–°çš„channel","slug":"blockchain/fabric/éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒ","date":"2021-04-01T10:18:21.501Z","updated":"2021-04-01T10:18:21.502Z","comments":true,"path":"2021/04/01/blockchain/fabric/éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒ/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E9%83%A8%E7%BD%B2%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83/","excerpt":"","text":"å®˜æ–¹æ–‡æ¡£:deployment_guide_overview Deploying a production network Step one: Decide on your network configuration Step two: Set up a cluster for your resources Step three: Set up your CAs Step four: Use the CA to create identities and MSPs Step five: Deploy peers and ordering nodes Creating a peerCreating an ordering node Step one: Decide on your network configuration Certificate Authority configuration. Use Organizational Units or not? Database type. ï¼ˆç›¸åŒçš„channelçš„peerèŠ‚ç‚¹å¿…é¡»ä½¿ç”¨ç›¸åŒçš„æ•°æ®åº“ï¼‰ Channels and private data. Container orchestration. Chaincode deployment methodï¼ˆä½¿ç”¨å†…ç½®çš„éƒ¨ç½²æ–¹å¼è¿˜æ˜¯å¤–éƒ¨çš„éƒ¨ç½²æ–¹å¼ï¼Œå¦‚ä½¿ç”¨k8séƒ¨ç½²ï¼‰ Using firewalls Step two: Set up a cluster for your resources Managing your infrastructure Using secret objects to securely store important configuration files in your cluster. ï¼ˆä½¿ç”¨ç§˜å¯†å¯¹è±¡å°†é‡è¦çš„é…ç½®æ–‡ä»¶å®‰å…¨åœ°å­˜å‚¨åœ¨ç¾¤é›†ä¸­ã€‚ï¼‰ Cluster considerations and node sizing. How you choose to mount your volumes. It is a best practice to mount the volumes relevant to your nodes external to the place where your nodes are deployed. (æ‚¨å¦‚ä½•é€‰æ‹©æŒ‚è½½å·ã€‚æœ€ä½³å®è·µæ˜¯å°†ä¸æ‚¨çš„èŠ‚ç‚¹ç›¸å…³çš„å·æŒ‚è½½åˆ°éƒ¨ç½²èŠ‚ç‚¹çš„å¤–éƒ¨ã€‚) How you will monitor your resources. Step three: Set up your CAs The first component that must be deployed in a Fabric network is a CA. This is because the certificates associated with a node (not just for the node itself but also the certificates identifying who can administer the node) must be created before the node itself can be deployed. å¿…é¡»åœ¨Fabricç½‘ç»œä¸­éƒ¨ç½²çš„ç¬¬ä¸€ä¸ªç»„ä»¶æ˜¯CAã€‚è¿™æ˜¯å› ä¸ºå¿…é¡»å…ˆåˆ›å»ºä¸èŠ‚ç‚¹å…³è”çš„è¯ä¹¦ï¼ˆä¸ä»…æ˜¯é’ˆå¯¹èŠ‚ç‚¹æœ¬èº«çš„è¯ä¹¦ï¼Œè€Œä¸”è¿˜åŒ…æ‹¬æ ‡è¯†è°å¯ä»¥ç®¡ç†è¯¥èŠ‚ç‚¹çš„è¯ä¹¦ï¼‰ï¼Œç„¶åæ‰èƒ½éƒ¨ç½²èŠ‚ç‚¹æœ¬èº«ã€‚ One CA (or more, if you are using intermediate CAs â€” more on intermediate CAs below) is used to generate (through a process called â€œenrollmentâ€) the certificates of the admin of an organization, the MSP of that organization, and any nodes owned by that organization. This CA will also generate the certificates for any additional users.This CA will also generate the certificates for any additional users. Because of its role in â€œenrollingâ€ identities, this CA is sometimes called the â€œenrollment CAâ€ or the â€œecert CAâ€. ä¸€ä¸ªCAç”¨äºç”Ÿæˆè¯¥ç»„ç»‡ç®¡ç†å‘˜ã€è¯¥ç»„ç»‡çš„MSPå’Œè¯¥ç»„ç»‡æ‰€æ‹¥æœ‰çš„ä»»ä½•èŠ‚ç‚¹çš„è¯ä¹¦ã€‚è¯¥CAè¿˜å°†ä¸ºä»»ä½•å…¶ä»–ç”¨æˆ·ç”Ÿæˆè¯ä¹¦ã€‚ç”±äºå…¶åœ¨â€œæ³¨å†Œâ€èº«ä»½ä¸­çš„ä½œç”¨ï¼Œå› æ­¤æœ‰æ—¶å°†è¯¥CAç§°ä¸ºâ€œæ³¨å†ŒCAâ€æˆ–â€œè¯ä¹¦CAâ€ã€‚ The other CA generates the certificates used to secure communications on Transport Layer Security (TLS).For this reason, this CA is often referred to as a â€œTLS CAâ€. These TLS certificates are attached to actions as a way of preventing â€œman in the middleâ€ attacks. å¦ä¸€ä¸ªCAç”Ÿæˆç”¨äºä¿æŠ¤ä¼ è¾“å±‚å®‰å…¨æ€§ï¼ˆTLSï¼‰ä¸Šçš„é€šä¿¡çš„è¯ä¹¦ã€‚å› æ­¤ï¼Œè¯¥CAé€šå¸¸è¢«ç§°ä¸ºâ€œ TLS CAâ€ã€‚å°†è¿™äº›TLSè¯ä¹¦é™„åŠ åˆ°æ“ä½œä¸­ï¼Œä»¥é˜²æ­¢â€œä¸­é—´äººâ€æ”»å‡»ã€‚ Deploy a Production CA Planning for a CA Checklist for a production CA server CA deployment steps Step four: Use the CA to create identities and MSPs For each organization, you will need to, at a minimum: Register and enroll an admin identity and create an MSP. you must create the org admin identity before creating the local MSP of a node, since the certificate of the node admin must be used when creating the local MSP. Register and enroll node identities. Step five: Deploy peers and ordering nodes Before any node can be deployed, its configuration file must be customized. For the peer, this file is called core.yaml, while the configuration file for ordering nodes is called orderer.yaml. åœ¨ä»»ä½•çš„èŠ‚ç‚¹å¯ä»¥è¢«éƒ¨ç½²ä¹‹å‰ï¼Œå¿…é¡»å…ˆè‡ªå®šä¹‰é…ç½®æ–‡ä»¶ã€‚ peerèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ï¼š core.yaml orderingèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶orderer.yaml You have three main options for tuning your configuration. Edit the YAML file bundled with the binaries. Use environment variable overrides when deploying. Specify flags on CLI commands. Creating a peer Among the parameters in core.yaml, there are: Identifiers: these include not just the paths to the relevant local MSP and Transport Layer Security (TLS) certificates, but also the name (known as the â€œpeer IDâ€) of the peer and the MSP ID of the organization that owns the peer. Addresses and paths: because peers are not entities unto themselves but interact with other peers and components, you must specify a series of addresses in the configuration. These include addresses where the peer itself can be found by other components as well as the addresses where, for example, chaincodes can be found (if you are employing external chaincodes). Similarly, you will need to specify the location of your ledger (as well as your state database type) and the path to your external builders (again, if you intend to employ external chaincodes). These include Operations and metrics, which allow you to set up methods for monitoring the health and performance of your peer through the configuration of endpoints. Gossip: components in Fabric networks communicate with each other using the â€œgossipâ€ protocol. Through this protocol, they can be discovered by the discovery service and disseminate blocks and private data to each other. Note that gossip communications are secured using TLS. Deploying a production peer Planning for a production peer Checklist for a production peer Deploy the peer Creating an ordering node Among the parameters in orderer.yaml, there are: Identifiers: these include not just the paths to the relevant local MSP and Transport Layer Security (TLS) certificates, but also the MSP ID of the organization that owns the ordering node. Addresses and paths: because ordering nodes interact with other components, you must specify a series of addresses in the configuration. These include addresses where the ordering node itself can be found by other components as well as Operations and metrics, which allow you to set up methods for monitoring the health and performance of your ordering node through the configuration of endpoints. Deploying a production ordering node Planning for an ordering service Checklist for a production ordering node Deploy the ordering service","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"channel","slug":"åŒºå—é“¾/Hyperledger-Fabric/channel","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/channel/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"channel","slug":"channel","permalink":"https://guozhe001.github.io/tags/channel/"}]},{"title":"éšç§˜äº¤æ˜“.md","slug":"blockchain/fabric/é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric/éšç§˜äº¤æ˜“","date":"2021-04-01T10:18:21.500Z","updated":"2021-04-01T10:18:21.501Z","comments":true,"path":"2021/04/01/blockchain/fabric/é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric/éšç§˜äº¤æ˜“/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E9%9A%90%E7%A7%98%E4%BA%A4%E6%98%93/","excerpt":"","text":"è‡ªå·±å¼€å‘çš„æ™ºèƒ½åˆçº¦åœ¨channelä¸Šçš„æ‰€æœ‰æˆå‘˜éƒ½å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ç¬¦åˆç°å®ä¸–ç•Œä¸­çš„äº¤æ˜“è§„åˆ™ã€‚ç†è®ºä¸Šä¸¤ä¸ªç»„ç»‡ä¹‹é—´çš„äº¤æ˜“æ˜¯ä¸å…è®¸åˆ«äººçœ‹åˆ°çš„ã€‚æ‰€ä»¥è¿™æ¬¡æˆ‘ä½¿ç”¨fabric-samplesæä¾›çš„asset-transfer-secured-agreementæ¥ä½œä¸ºæˆ‘çš„ä¾›åº”é“¾é‡‘èåŒºå—é“¾é¡¹ç›®çš„chaincodeã€‚ éƒ¨ç½²é“¾ç  æ‰“åŒ… 1peer lifecycle chaincode package secured_supply.5.tar.gz --path ./asset-transfer-secured-agreement/chaincode-go --lang golang --label secured_supply_15.0 å®‰è£…é“¾ç åŒ…,æ¯ä¸ªpeeréƒ½è¦å®‰è£…ï¼š 1peer lifecycle chaincode install secured_supply.5.tar.gz æ‰¹å‡†é“¾ç å®šä¹‰ æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode 1peer lifecycle chaincode queryinstalled å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ï¼Œä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦å®šä¹‰æ­¤å˜é‡ï¼š 1export CC_PACKAGE_ID=secured_supply_22.0:e815ca2d270dea029bc6992952140b1288a440aba8c430853f72eee7d5de24a7 æ‰¹å‡†é“¾ç å®šä¹‰ï¼Œæ¯ä¸ªpeeréƒ½è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š 1peer lifecycle chaincode approveformyorg -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name secured_supply --version 23.0 --package-id $CC_PACKAGE_ID --sequence 23 --signature-policy &quot;OR(&#x27;GylCoreOrg1MSP.member&#x27;,&#x27;GylFOrg1MSP.member&#x27;,&#x27;GylSOrg1MSP.member&#x27;,&#x27;GylSOrg2MSP.member&#x27;)&quot; --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š 1peer lifecycle chaincode checkcommitreadiness --channelID alljoinchannel --name secured_supply --version 23.0 --sequence 23 --signature-policy &quot;OR(&#x27;GylCoreOrg1MSP.member&#x27;,&#x27;GylFOrg1MSP.member&#x27;,&#x27;GylSOrg1MSP.member&#x27;,&#x27;GylSOrg2MSP.member&#x27;)&quot; --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json åœ¨æ‰€æœ‰ç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š 1peer lifecycle chaincode commit -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name secured_supply --version 23.0 --sequence 23 --signature-policy &quot;OR(&#x27;GylCoreOrg1MSP.member&#x27;,&#x27;GylFOrg1MSP.member&#x27;,&#x27;GylSOrg1MSP.member&#x27;,&#x27;GylSOrg2MSP.member&#x27;)&quot; --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt ä½¿ç”¨ peer lifecycle chaincode querycommitted å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚ 1peer lifecycle chaincode querycommitted --channelID alljoinchannel --name secured_supply --output json è°ƒç”¨é“¾ç  åˆ›å»ºèµ„äº§ èµ„äº§çš„å†…å®¹éœ€è¦æ‰“ä¸ªé—®å·ï¼Œå› ä¸ºè¿™ä¸ªèµ„äº§åœ¨åé¢éœ€è¦è¢«äº¤æ˜“ï¼Œå¦‚æœèµ„äº§çš„å†…å®¹ä¸èƒ½å¤Ÿä¿®æ”¹é‚£ä¹ˆåˆåŒå’Œå‘ç¥¨çš„hashåº”è¯¥ä¸åœ¨èµ„äº§çš„è¯¦ç»†ä¿¡æ¯é‡Œé¢ï¼Œè¿™é‡Œå…ˆæ”¾è¿™é‡Œåé¢å†æ”¹ å‘è¡Œè€…èƒ½å¦æ”¾åœ¨å¤–é¢è€Œä¸æ˜¯èµ„äº§é‡Œé¢ï¼Ÿå“ªç§æ–¹å¼æ¯”è¾ƒå¥½å‘¢ï¼Ÿ åœ¨æ ¸å¿ƒä¼ä¸šçš„èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªèµ„äº§å¦‚ä¸‹ï¼š 1export ASSET_PROPERTIES=$(echo -n &quot;&#123;\\&quot;objectType\\&quot;:\\&quot;asset_properties\\&quot;,\\&quot;assetID\\&quot;:\\&quot;asset011\\&quot;,\\&quot;issuer\\&quot;:\\&quot;GylCoreOrg1MSP\\&quot;,\\&quot;amount\\&quot;:1000,\\&quot;createDate\\&quot;:\\&quot;2020-01-11T06:57:06.963617Z\\&quot;,\\&quot;endDate\\&quot;:\\&quot;2021-07-11T06:57:06.963617Z\\&quot;,\\&quot;salt\\&quot;:\\&quot;224cba6c547aecc76ab6acfac41d12dfd96e7165\\&quot;&#125;&quot; | base64 | tr -d \\\\n) åœ¨æ ¸å¿ƒä¼ä¸šçš„èŠ‚ç‚¹ä¸Šè°ƒç”¨chaincodeï¼Œåˆ›å»ºèµ„äº§ï¼š 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;CreateAsset&quot;,&quot;Args&quot;:[&quot;asset011&quot;, &quot;A new asset for GylCoreOrg1MSP&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_properties\\&quot;:\\&quot;$ASSET_PROPERTIES\\&quot;&#125;&quot; åœ¨ç§æœ‰æ•°æ®é›†ä¸­æŸ¥è¯¢åˆšæ‰åˆ›å»ºçš„èµ„äº§ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset011&quot;]&#125;&#x27;|jq æˆåŠŸç»“æœï¼š 123456789&#123; &quot;objectType&quot;: &quot;asset_properties&quot;, &quot;assetID&quot;: &quot;asset010&quot;, &quot;issuer&quot;: &quot;GylCoreOrg1MSP&quot;, &quot;amount&quot;: 1000, &quot;createDate&quot;: &quot;2020-01-11T06:57:06.963617Z&quot;, &quot;endDate&quot;: &quot;2021-07-11T06:57:06.963617Z&quot;, &quot;salt&quot;: &quot;224cba6c547aecc76ab6acfac41d12dfd96e7165&quot;&#125; æŸ¥è¯¢è´¦æœ¬æ¥æŸ¥çœ‹å…¬å…±è®°å½•ï¼Œæ‰€æœ‰åœ¨channelä¸Šçš„æˆå‘˜éƒ½å¯ä»¥æŸ¥è¯¢å¾—åˆ°ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset010&quot;]&#125;&#x27; è¿”å›ç»“æœï¼Œchannelä¸Šçš„æˆå‘˜åªèƒ½çœ‹åˆ°èµ„äº§çš„éƒ¨åˆ†ä¿¡æ¯ï¼Œè¯¦ç»†ä¿¡æ¯æ˜¯æ— æ³•çœ‹åˆ°çš„ã€‚ï¼š 12345678&#123; &quot;objectType&quot;: &quot;asset&quot;, &quot;assetID&quot;: &quot;asset010&quot;, &quot;ownerOrg&quot;: &quot;GylCoreOrg1MSP&quot;, &quot;publicDescription&quot;: &quot;A new asset for GylCoreOrg1MSP&quot;, &quot;status&quot;: &quot;enable&quot;, &quot;parentID&quot;: &quot;&quot;&#125; èµ„äº§æ‹¥æœ‰è€…æ›´æ”¹èµ„äº§çš„å…¬å…±ä¿¡æ¯ 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset010&quot;,&quot;This asset is for sale&quot;]&#125;&#x27; ä¸Šé¢çš„æ–¹æ³•ï¼Œåœ¨æ ¸å¿ƒä¼ä¸šçš„peerèŠ‚ç‚¹è¿”å›æ—¥å¿—å¦‚ä¸‹ï¼š 12021-01-07 16:07:43.589 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200 å…¶ä»–çš„ç»„ç»‡å¦‚æœæƒ³è¦è°ƒç”¨è¿™ä¸ªé“¾ç çš„æ–¹æ³•æ›´æ”¹ä¿¡æ¯ï¼Œåˆ™ä¼šæŠ¥é”™ï¼Œå› ä¸ºå±äºæ ¸å¿ƒä¼ä¸šçš„èµ„äº§åˆ«äººä¸å¯ä»¥æ›´æ”¹ï¼š 1Error: endorsement failure during invoke. response: status:500 message:&quot;a client from GylFOrg1MSP cannot update the description of a asset owned by GylCoreOrg1MSP&quot; èµ„äº§äº¤æ˜“ å…è®¸å‡ºå”®èµ„äº§ ç°åœ¨æ ¸å¿ƒä¼ä¸šè¦ä¸ä¸€çº§ä¾›åº”å•†äº¤æ˜“æ ¸å¿ƒä¼ä¸šçš„èµ„äº§ã€‚é¦–å…ˆæ ¸å¿ƒä¼ä¸šä¸ä¸€çº§ä¾›åº”å•†è¦åœ¨é“¾ä¸‹å¯¹ä»·æ ¼è¾¾æˆå…±è¯†ï¼Œå¹¶ä¸”æ ¸å¿ƒä¼ä¸šè¦æŠŠèµ„äº§çš„è¯¦æƒ…ä¹Ÿé€šè¿‡é“¾ä¸‹çš„é€šé“å‘é€ç»™ä¸€çº§ä¾›åº”å•†ã€‚ä¹‹åä¹°å–åŒæ–¹å°±å¯ä»¥å¯¹ä»·æ ¼è¾¾æˆå…±è¯†äº†ã€‚ æ ¸å¿ƒä¼ä¸šå°†èµ„äº§çš„ä»·æ ¼è®¾ç½®ä¸º1000ï¼š ä¸‹é¢çš„trade_idæ˜¯åˆåŒçš„hashå€¼ 12export ASSET_PRICE=$(echo -n &quot;&#123;\\&quot;asset_id\\&quot;:\\&quot;asset007\\&quot;,\\&quot;trade_id\\&quot;:\\&quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14\\&quot;,\\&quot;price\\&quot;:1000&#125;&quot; | base64)peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToSell&quot;,&quot;Args&quot;:[&quot;asset007&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_price\\&quot;:\\&quot;$ASSET_PRICE\\&quot;&#125;&quot; æŸ¥è¯¢æ ¸å¿ƒä¼ä¸šçš„ç§æœ‰æ•°æ®é›†åˆæ¥è¯»å–åŒæ„çš„é”€å”®ä»·æ ¼ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetSalesPrice&quot;,&quot;Args&quot;:[&quot;asset007&quot;]&#125;&#x27; ä¸€çº§ä¾›åº”å•†å‡ºä»·1000 åœ¨ä¸€çº§ä¾›åº”å•†å‡ºä»·ä¹‹å‰ï¼Œä»–éœ€è¦å…ˆéªŒè¯èµ„äº§çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®ã€‚æ­¤é“¾ç ä¸­è¿”å›trueå³ä¸ºæ­£ç¡®ã€‚ 12#export ASSET_PROPERTIES=$(echo -n &quot;&#123;\\&quot;object_type\\&quot;:\\&quot;asset_properties\\&quot;,\\&quot;asset_id\\&quot;:\\&quot;asset006\\&quot;,\\&quot;issuer\\&quot;:\\&quot;GylCoreOrg1MSP\\&quot;,\\&quot;amount\\&quot;:1000,\\&quot;createDate\\&quot;:\\&quot;2020-01-11T06:57:06.963617Z\\&quot;,\\&quot;endDate\\&quot;:\\&quot;2021-07-11T06:57:06.963617Z\\&quot;,\\&quot;salt\\&quot;:\\&quot;224cba6c547aecc76ab6acfac41d12dfd96e7165\\&quot;&#125;&quot; | base64 | tr -d \\\\n)peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;VerifyAssetProperties&quot;,&quot;Args&quot;:[&quot;asset007&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_properties\\&quot;:\\&quot;$ASSET_PROPERTIES\\&quot;&#125;&quot; éªŒè¯é€šè¿‡ä¹‹åï¼Œå°±å¯¹èµ„äº§å‡ºä»·ï¼š 12export ASSET_PRICE=$(echo -n &quot;&#123;\\&quot;asset_id\\&quot;:\\&quot;asset007\\&quot;,\\&quot;trade_id\\&quot;:\\&quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14\\&quot;,\\&quot;price\\&quot;:1000&#125;&quot; | base64)peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToBuy&quot;,&quot;Args&quot;:[&quot;asset007&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_price\\&quot;:\\&quot;$ASSET_PRICE\\&quot;&#125;&quot; å¯ä»¥åœ¨ä¸€çº§ä¾›åº”å•†çš„éšç§æ•°æ®é›†ä¸­æŸ¥è¯¢åˆ°å‡ºä»·ä¿¡æ¯ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetBidPrice&quot;,&quot;Args&quot;:[&quot;asset007&quot;]&#125;&#x27; å¦‚æœåœ¨å…¶ä»–ç»„ç»‡ä¸ŠæŸ¥è¯¢ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹é”™è¯¯ï¼Œè¯´æ˜å‡ºä»·å–å‡ºè®¾ç½®çš„ä»·æ ¼ä¿¡æ¯æ˜¯éšç§˜çš„ï¼š 1Error: endorsement failure during query. response: status:500 message:&quot;asset price does not exist: asset001&quot; æ ¸å¿ƒä¼ä¸šæŠŠèµ„äº§è½¬ç§»ç»™ä¸€çº§ä¾›åº”å•† æ ¸å¿ƒä¼ä¸šå’Œä¸€çº§ä¾›åº”å•†å¯¹ç›¸åŒçš„ä»·æ ¼è¾¾æˆå…±è¯†ä¹‹åï¼Œæ ¸å¿ƒä¼ä¸šå°±å¯ä»¥æŠŠèµ„äº§è½¬ç§»ç»™ä¸€çº§ä¾›åº”å•†äº†ã€‚ 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAsset&quot;,&quot;Args&quot;:[&quot;asset007&quot;,&quot;GylFOrg1MSP&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_properties\\&quot;:\\&quot;$ASSET_PROPERTIES\\&quot;,\\&quot;asset_price\\&quot;:\\&quot;$ASSET_PRICE\\&quot;&#125;&quot; æŸ¥è¯¢å…¬å…±æ•°æ®çš„èµ„äº§å½’å±ä»¥éªŒè¯äº¤æ˜“æˆåŠŸï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset001&quot;]&#125;&#x27; äº¤æ˜“éªŒè¯ é™¤äº†äº¤æ˜“åŒæ–¹å…¶ä»–äººæ— æ³•æŸ¥çœ‹åˆ°èµ„äº§è¯¦æƒ… éªŒè¯ä¸€çº§ä¾›åº”å•†å¯ä»¥ä¿®æ”¹è‡ªå·±çš„èµ„äº§çš„å…¬å…±å±æ€§ï¼š 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset005&quot;,&quot;This asset is not for sale now&quot;]&#125;&#x27; ç„¶åé€šè¿‡æ‰€æœ‰å››ä¸ªç»„ç»‡æŸ¥è¯¢èµ„äº§IDä¸ºasset005çš„å…¬å…±ä¿¡æ¯å¦‚ä¸‹ï¼Œè¯´æ˜ä¸€çº§ä¾›åº”å•†å·²ç»è·å¾—äº†ä¿®æ”¹æƒé™å¹¶ä¿®æ”¹äº†è¿™ä¸ªèµ„äº§çš„å…¬å…±ä¿¡æ¯ï¼š 1234567(base) w:supply-finance apple$ peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset005&quot;]&#125;&#x27;|jq&#123; &quot;objectType&quot;: &quot;asset&quot;, &quot;assetID&quot;: &quot;asset005&quot;, &quot;ownerOrg&quot;: &quot;GylFOrg1MSP&quot;, &quot;publicDescription&quot;: &quot;This asset is not for sale now&quot;&#125; éªŒè¯æ ¸å¿ƒä¼ä¸šä¸å¯ä»¥å†ä¿®æ”¹è¿™ä¸ªèµ„äº§çš„å…¬å…±ä¿¡æ¯ 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset005&quot;,&quot;This asset is not for sale again&quot;]&#125;&#x27; ç»“æœæŠ¥é”™å¦‚ä¸‹ï¼Œç¬¦åˆé¢„æœŸï¼š 1Error: endorsement failure during invoke. response: status:500 message:&quot;a client from GylCoreOrg1MSP cannot update the description of a asset owned by GylFOrg1MSP&quot; éªŒè¯åªæœ‰ä¸€çº§ä¾›åº”å•†æ‰å¯ä»¥æŸ¥è¯¢è¿™ä¸ªèµ„äº§çš„ç§æœ‰ä¿¡æ¯ 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset005&quot;]&#125;&#x27; ç»“æœå¦‚ä¸‹ï¼ŒéªŒè¯é€šè¿‡ï¼š å†ä¸€çº§ä¾›åº”å•†çš„peerèŠ‚ç‚¹å¯ä»¥æŸ¥è¯¢åˆ°èµ„äº§çš„ç§æœ‰å±æ€§ï¼Œå…¶ä»–ç»„ç»‡çš„peerèŠ‚ç‚¹éƒ½æŠ¥é”™ï¼šError: endorsement failure during query. response: status:500 message:&quot;asset private details does not exist in client org's collection: asset005&quot; èµ„äº§æ‹†åˆ† è°ƒç”¨æ‹†åˆ†æ–¹æ³• å®Œæˆèµ„äº§çš„æ‹†åˆ†chaincodeçš„æ›´æ–°ä¹‹åï¼Œè°ƒç”¨æ‹†åˆ†çš„æ–¹æ³•ï¼š 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;SplitAsset&quot;,&quot;Args&quot;:[&quot;asset010&quot;, &quot;500&quot;]&#125;&#x27; éªŒè¯æ‹†åˆ†ç»“æœ ç§æœ‰æ•°æ®éªŒè¯ ç¬¬ä¸€ä¸ªèµ„äº§ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27;|jq 123456789&#123; &quot;objectType&quot;: &quot;asset_properties&quot;, &quot;assetID&quot;: &quot;asset0101&quot;, &quot;issuer&quot;: &quot;GylCoreOrg1MSP&quot;, &quot;amount&quot;: 500, &quot;createDate&quot;: &quot;2020-01-11T06:57:06.963617Z&quot;, &quot;endDate&quot;: &quot;2021-07-11T06:57:06.963617Z&quot;, &quot;salt&quot;: &quot;224cba6c547aecc76ab6acfac41d12dfd96e7165&quot;&#125; ç¬¬äºŒä¸ªèµ„äº§ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset0102&quot;]&#125;&#x27;|jq ç»“æœå¦‚ä¸‹ï¼š 123456789&#123; &quot;objectType&quot;: &quot;asset_properties&quot;, &quot;assetID&quot;: &quot;asset0102&quot;, &quot;issuer&quot;: &quot;GylCoreOrg1MSP&quot;, &quot;amount&quot;: 500, &quot;createDate&quot;: &quot;2020-01-11T06:57:06.963617Z&quot;, &quot;endDate&quot;: &quot;2021-07-11T06:57:06.963617Z&quot;, &quot;salt&quot;: &quot;224cba6c547aecc76ab6acfac41d12dfd96e7165&quot;&#125; åŸå§‹çš„èµ„äº§ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset010&quot;]&#125;&#x27;|jq ç»“æœå¦‚ä¸‹ï¼ŒåŸå§‹èµ„äº§å·²ç»æ²¡æœ‰äº†ï¼š 1Error: endorsement failure during query. response: status:500 message:&quot;asset private details does not exist in client org&#x27;s collection: asset010&quot; å…¬å…±æ•°æ®éªŒè¯ ç¬¬ä¸€ä¸ªèµ„äº§ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27;|jq ç»“æœå¦‚ä¸‹ï¼Œchannelä¸Šçš„æ‰€æœ‰çš„ç»„ç»‡éƒ½å¯ä»¥çœ‹åˆ°ç›¸åŒçš„æ•°æ®ï¼š 12345678&#123; &quot;objectType&quot;: &quot;asset&quot;, &quot;assetID&quot;: &quot;asset0101&quot;, &quot;ownerOrg&quot;: &quot;GylCoreOrg1MSP&quot;, &quot;publicDescription&quot;: &quot;A new asset for GylCoreOrg1MSP&quot;, &quot;status&quot;: &quot;enable&quot;, &quot;parentID&quot;: &quot;asset010&quot;&#125; ç¬¬äºŒä¸ªèµ„äº§ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset0102&quot;]&#125;&#x27;|jq ç»“æœå¦‚ä¸‹ï¼š 12345678&#123; &quot;objectType&quot;: &quot;asset&quot;, &quot;assetID&quot;: &quot;asset0102&quot;, &quot;ownerOrg&quot;: &quot;GylCoreOrg1MSP&quot;, &quot;publicDescription&quot;: &quot;A new asset for GylCoreOrg1MSP&quot;, &quot;status&quot;: &quot;enable&quot;, &quot;parentID&quot;: &quot;asset010&quot;&#125; åŸå§‹çš„èµ„äº§ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset010&quot;]&#125;&#x27;|jq ç»“æœå¦‚ä¸‹ï¼Œchaincodeæœ‰é—®é¢˜ï¼Œæ‹†åˆ†èµ„äº§ä¹‹ååŸå§‹èµ„äº§çš„çŠ¶æ€åº”è¯¥æ”¹å˜ï¼š 12345678&#123; &quot;objectType&quot;: &quot;asset&quot;, &quot;assetID&quot;: &quot;asset010&quot;, &quot;ownerOrg&quot;: &quot;GylCoreOrg1MSP&quot;, &quot;publicDescription&quot;: &quot;å·²æ‹†åˆ†&quot;, &quot;status&quot;: &quot;delete&quot;, &quot;parentID&quot;: &quot;&quot;&#125; æ‹†åˆ†åçš„èµ„äº§äº¤æ˜“ æ ¸å¿ƒå…è®¸å‡ºå”®èµ„äº§ï¼Œä»·æ ¼è®¾ç½®ä¸º500ï¼š ä¸‹é¢çš„trade_idæ˜¯åˆåŒçš„hashå€¼ 12export ASSET_PRICE=$(echo -n &quot;&#123;\\&quot;asset_id\\&quot;:\\&quot;asset0101\\&quot;,\\&quot;trade_id\\&quot;:\\&quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14\\&quot;,\\&quot;price\\&quot;:500&#125;&quot; | base64)peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToSell&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_price\\&quot;:\\&quot;$ASSET_PRICE\\&quot;&#125;&quot; æŸ¥è¯¢æ ¸å¿ƒä¼ä¸šçš„ç§æœ‰æ•°æ®é›†åˆæ¥è¯»å–åŒæ„çš„é”€å”®ä»·æ ¼ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetSalesPrice&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27; ä¸€çº§ä¾›åº”å•†å‡ºä»·500 åœ¨ä¸€çº§ä¾›åº”å•†å‡ºä»·ä¹‹å‰ï¼Œä»–éœ€è¦å…ˆéªŒè¯èµ„äº§çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®ã€‚æ­¤é“¾ç ä¸­è¿”å›trueå³ä¸ºæ­£ç¡®ã€‚ 12export ASSET_PROPERTIES=$(echo -n &quot;&#123;\\&quot;objectType\\&quot;:\\&quot;asset_properties\\&quot;,\\&quot;assetID\\&quot;:\\&quot;asset0101\\&quot;,\\&quot;issuer\\&quot;:\\&quot;GylCoreOrg1MSP\\&quot;,\\&quot;amount\\&quot;:500,\\&quot;createDate\\&quot;:\\&quot;2020-01-11T06:57:06.963617Z\\&quot;,\\&quot;endDate\\&quot;:\\&quot;2021-07-11T06:57:06.963617Z\\&quot;,\\&quot;salt\\&quot;:\\&quot;224cba6c547aecc76ab6acfac41d12dfd96e7165\\&quot;&#125;&quot; | base64 | tr -d \\\\n)peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;VerifyAssetProperties&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_properties\\&quot;:\\&quot;$ASSET_PROPERTIES\\&quot;&#125;&quot; éªŒè¯é€šè¿‡ä¹‹åï¼Œå°±å¯¹èµ„äº§å‡ºä»·ï¼š 12export ASSET_PRICE=$(echo -n &quot;&#123;\\&quot;asset_id\\&quot;:\\&quot;asset0101\\&quot;,\\&quot;trade_id\\&quot;:\\&quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14\\&quot;,\\&quot;price\\&quot;:500&#125;&quot; | base64)peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToBuy&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_price\\&quot;:\\&quot;$ASSET_PRICE\\&quot;&#125;&quot; å¯ä»¥åœ¨ä¸€çº§ä¾›åº”å•†çš„éšç§æ•°æ®é›†ä¸­æŸ¥è¯¢åˆ°å‡ºä»·ä¿¡æ¯ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetBidPrice&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27; å¦‚æœåœ¨å…¶ä»–ç»„ç»‡ä¸ŠæŸ¥è¯¢ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹é”™è¯¯ï¼Œè¯´æ˜å‡ºä»·å–å‡ºè®¾ç½®çš„ä»·æ ¼ä¿¡æ¯æ˜¯éšç§˜çš„ï¼š 1Error: endorsement failure during query. response: status:500 message:&quot;asset price does not exist: asset001&quot; æ ¸å¿ƒä¼ä¸šæŠŠèµ„äº§è½¬ç§»ç»™ä¸€çº§ä¾›åº”å•† æ ¸å¿ƒä¼ä¸šå’Œä¸€çº§ä¾›åº”å•†å¯¹ç›¸åŒçš„ä»·æ ¼è¾¾æˆå…±è¯†ä¹‹åï¼Œæ ¸å¿ƒä¼ä¸šå°±å¯ä»¥æŠŠèµ„äº§è½¬ç§»ç»™ä¸€çº§ä¾›åº”å•†äº†ã€‚ 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAsset&quot;,&quot;Args&quot;:[&quot;asset0101&quot;,&quot;GylFOrg1MSP&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_properties\\&quot;:\\&quot;$ASSET_PROPERTIES\\&quot;,\\&quot;asset_price\\&quot;:\\&quot;$ASSET_PRICE\\&quot;&#125;&quot; æŸ¥è¯¢å…¬å…±æ•°æ®çš„èµ„äº§å½’å±ä»¥éªŒè¯äº¤æ˜“æˆåŠŸï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27;|jq ç»“æœå¦‚ä¸‹ï¼š 12345678&#123; &quot;objectType&quot;: &quot;asset&quot;, &quot;assetID&quot;: &quot;asset0101&quot;, &quot;ownerOrg&quot;: &quot;GylFOrg1MSP&quot;, &quot;publicDescription&quot;: &quot;A new asset for GylCoreOrg1MSP&quot;, &quot;status&quot;: &quot;enable&quot;, &quot;parentID&quot;: &quot;asset010&quot;&#125; äº¤æ˜“éªŒè¯ é™¤äº†äº¤æ˜“åŒæ–¹å…¶ä»–äººæ— æ³•æŸ¥çœ‹åˆ°èµ„äº§è¯¦æƒ… éªŒè¯ä¸€çº§ä¾›åº”å•†å¯ä»¥ä¿®æ”¹è‡ªå·±çš„èµ„äº§çš„å…¬å…±å±æ€§ï¼š 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset0101&quot;,&quot;This asset is not for sale now&quot;]&#125;&#x27; ä¿®æ”¹æˆåŠŸä¹‹åé‡æ–°æŸ¥è¯¢èµ„äº§çš„å…¬å…±ä¿¡æ¯ï¼ŒéªŒè¯é€šè¿‡ï¼š 12345678&#123; &quot;objectType&quot;: &quot;asset&quot;, &quot;assetID&quot;: &quot;asset0101&quot;, &quot;ownerOrg&quot;: &quot;GylFOrg1MSP&quot;, &quot;publicDescription&quot;: &quot;This asset is not for sale now&quot;, &quot;status&quot;: &quot;enable&quot;, &quot;parentID&quot;: &quot;asset010&quot;&#125; éªŒè¯æ ¸å¿ƒä¼ä¸šä¸å¯ä»¥å†ä¿®æ”¹è¿™ä¸ªèµ„äº§çš„å…¬å…±ä¿¡æ¯ 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset0101&quot;,&quot;This asset is not for sale again&quot;]&#125;&#x27; ç»“æœæŠ¥é”™å¦‚ä¸‹ï¼Œç¬¦åˆé¢„æœŸï¼š 1Error: endorsement failure during invoke. response: status:500 message:&quot;a client from GylCoreOrg1MSP cannot update the description of a asset owned by GylFOrg1MSP&quot; éªŒè¯åªæœ‰ä¸€çº§ä¾›åº”å•†æ‰å¯ä»¥æŸ¥è¯¢è¿™ä¸ªèµ„äº§çš„ç§æœ‰ä¿¡æ¯ 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27; ç»“æœå¦‚ä¸‹ï¼ŒéªŒè¯é€šè¿‡ï¼š åœ¨ä¸€çº§ä¾›åº”å•†çš„peerèŠ‚ç‚¹å¯ä»¥æŸ¥è¯¢åˆ°èµ„äº§çš„ç§æœ‰å±æ€§ï¼Œå…¶ä»–ç»„ç»‡çš„peerèŠ‚ç‚¹éƒ½æŠ¥é”™ï¼šError: endorsement failure during query. response: status:500 message:&quot;asset private details does not exist in client org's collection: asset005&quot; ä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†äº¤æ˜“ è°ƒç”¨æ‹†åˆ†çš„æ–¹æ³•ï¼Œå°†èµ„äº§æ‹†åˆ†æˆ200å’Œ300ï¼š 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;SplitAsset&quot;,&quot;Args&quot;:[&quot;asset0101&quot;, &quot;200&quot;]&#125;&#x27; éªŒè¯æ‹†åˆ†ç»“æœ ç§æœ‰æ•°æ®éªŒè¯ ç¬¬ä¸€ä¸ªèµ„äº§ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset01011&quot;]&#125;&#x27;|jq ç¬¬äºŒä¸ªèµ„äº§ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27;|jq åŸå§‹çš„èµ„äº§ï¼ŒåŸå§‹èµ„äº§å·²ç»æ²¡æœ‰äº†ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27;|jq å…¬å…±æ•°æ®éªŒè¯ ç¬¬ä¸€ä¸ªèµ„äº§ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset01011&quot;]&#125;&#x27;|jq ç¬¬äºŒä¸ªèµ„äº§ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27;|jq åŸå§‹çš„èµ„äº§ï¼Œæ‹†åˆ†èµ„äº§ä¹‹ååŸå§‹èµ„äº§çš„çŠ¶æ€åº”è¯¥æ”¹å˜ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset0101&quot;]&#125;&#x27;|jq æ‹†åˆ†åçš„èµ„äº§äº¤æ˜“ ä¸€çº§ä¾›åº”å•†å…è®¸å‡ºå”®èµ„äº§ï¼Œè®¾ç½®ä»·æ ¼ï¼š ä¸‹é¢çš„trade_idæ˜¯åˆåŒçš„hashå€¼ 12export ASSET_PRICE=$(echo -n &quot;&#123;\\&quot;asset_id\\&quot;:\\&quot;asset01012\\&quot;,\\&quot;trade_id\\&quot;:\\&quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb\\&quot;,\\&quot;price\\&quot;:300&#125;&quot; | base64)peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToSell&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_price\\&quot;:\\&quot;$ASSET_PRICE\\&quot;&#125;&quot; æŸ¥è¯¢æ ¸å¿ƒä¼ä¸šçš„ç§æœ‰æ•°æ®é›†åˆæ¥è¯»å–åŒæ„çš„é”€å”®ä»·æ ¼ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetSalesPrice&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27; äºŒçº§ä¾›åº”å•†2å‡ºä»·300 åœ¨äºŒçº§ä¾›åº”å•†2å‡ºä»·ä¹‹å‰ï¼Œä»–éœ€è¦å…ˆéªŒè¯èµ„äº§çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®ã€‚æ­¤é“¾ç ä¸­è¿”å›trueå³ä¸ºæ­£ç¡®ã€‚ 12export ASSET_PROPERTIES=$(echo -n &quot;&#123;\\&quot;objectType\\&quot;:\\&quot;asset_properties\\&quot;,\\&quot;assetID\\&quot;:\\&quot;asset01012\\&quot;,\\&quot;issuer\\&quot;:\\&quot;GylCoreOrg1MSP\\&quot;,\\&quot;amount\\&quot;:300,\\&quot;createDate\\&quot;:\\&quot;2020-01-11T06:57:06.963617Z\\&quot;,\\&quot;endDate\\&quot;:\\&quot;2021-07-11T06:57:06.963617Z\\&quot;,\\&quot;salt\\&quot;:\\&quot;224cba6c547aecc76ab6acfac41d12dfd96e7165\\&quot;&#125;&quot; | base64 | tr -d \\\\n)peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;VerifyAssetProperties&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_properties\\&quot;:\\&quot;$ASSET_PROPERTIES\\&quot;&#125;&quot; éªŒè¯é€šè¿‡ä¹‹åï¼Œå°±å¯¹èµ„äº§å‡ºä»·ï¼š 12export ASSET_PRICE=$(echo -n &quot;&#123;\\&quot;asset_id\\&quot;:\\&quot;asset01012\\&quot;,\\&quot;trade_id\\&quot;:\\&quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb\\&quot;,\\&quot;price\\&quot;:300&#125;&quot; | base64)peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToBuy&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_price\\&quot;:\\&quot;$ASSET_PRICE\\&quot;&#125;&quot; å¯ä»¥åœ¨ä¸€çº§ä¾›åº”å•†çš„éšç§æ•°æ®é›†ä¸­æŸ¥è¯¢åˆ°å‡ºä»·ä¿¡æ¯ï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetBidPrice&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27; å¦‚æœåœ¨å…¶ä»–ç»„ç»‡ä¸ŠæŸ¥è¯¢ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹é”™è¯¯ï¼Œè¯´æ˜å‡ºä»·å–å‡ºè®¾ç½®çš„ä»·æ ¼ä¿¡æ¯æ˜¯éšç§˜çš„ï¼š 1Error: endorsement failure during query. response: status:500 message:&quot;asset price does not exist: asset001&quot; ä¸€çº§ä¾›åº”å•†æŠŠèµ„äº§è½¬ç§»ç»™äºŒçº§ä¾›åº”å•†2 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAsset&quot;,&quot;Args&quot;:[&quot;asset01012&quot;,&quot;GylSOrg2MSP&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_properties\\&quot;:\\&quot;$ASSET_PROPERTIES\\&quot;,\\&quot;asset_price\\&quot;:\\&quot;$ASSET_PRICE\\&quot;&#125;&quot; æŸ¥è¯¢å…¬å…±æ•°æ®çš„èµ„äº§å½’å±ä»¥éªŒè¯äº¤æ˜“æˆåŠŸï¼š 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27;|jq ç»“æœå¦‚ä¸‹ï¼š 12345678&#123; &quot;objectType&quot;: &quot;asset&quot;, &quot;assetID&quot;: &quot;asset01012&quot;, &quot;ownerOrg&quot;: &quot;GylSOrg2MSP&quot;, &quot;publicDescription&quot;: &quot;This asset is not for sale now&quot;, &quot;status&quot;: &quot;enable&quot;, &quot;parentID&quot;: &quot;asset0101&quot;&#125; äº¤æ˜“éªŒè¯ é™¤äº†äº¤æ˜“åŒæ–¹å…¶ä»–äººæ— æ³•æŸ¥çœ‹åˆ°èµ„äº§è¯¦æƒ… éªŒè¯äºŒçº§çº§ä¾›åº”å•†2å¯ä»¥ä¿®æ”¹è‡ªå·±çš„èµ„äº§çš„å…¬å…±å±æ€§ï¼š 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset01012&quot;,&quot;hello i am GylSOrg2MSP&quot;]&#125;&#x27; ä¿®æ”¹æˆåŠŸä¹‹åé‡æ–°æŸ¥è¯¢èµ„äº§çš„å…¬å…±ä¿¡æ¯ï¼ŒéªŒè¯é€šè¿‡ï¼š 12345678&#123; &quot;objectType&quot;: &quot;asset&quot;, &quot;assetID&quot;: &quot;asset01012&quot;, &quot;ownerOrg&quot;: &quot;GylSOrg2MSP&quot;, &quot;publicDescription&quot;: &quot;hello i am GylSOrg2MSP&quot;, &quot;status&quot;: &quot;enable&quot;, &quot;parentID&quot;: &quot;asset0101&quot;&#125; éªŒè¯åªæœ‰äºŒçº§çº§ä¾›åº”å•†2æ‰å¯ä»¥æŸ¥è¯¢è¿™ä¸ªèµ„äº§çš„ç§æœ‰ä¿¡æ¯ 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27; ç»“æœå¦‚ä¸‹ï¼ŒéªŒè¯é€šè¿‡ï¼š åœ¨ä¸€çº§ä¾›åº”å•†çš„peerèŠ‚ç‚¹å¯ä»¥æŸ¥è¯¢åˆ°èµ„äº§çš„ç§æœ‰å±æ€§ï¼Œå…¶ä»–ç»„ç»‡çš„peerèŠ‚ç‚¹éƒ½æŠ¥é”™ï¼šError: endorsement failure during query. response: status:500 message:&quot;asset private details does not exist in client org's collection: asset005&quot; chaincodeæ¥å£è®°å½• æŸ¥è¯¢å–å‡ºçš„äº¤æ˜“ä¿¡æ¯ 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;QueryAssetSaleAgreements&quot;,&quot;Args&quot;:[]&#125;&#x27; æŸ¥è¯¢èµ„äº§çš„å…¬å…±ä¿¡æ¯ 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27;|jq æŸ¥è¯¢ç§æœ‰èµ„äº§ä¿¡æ¯ 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27;|jq æŸ¥è¯¢ä¸€ä¸ªèµ„äº§å…¬å…±ä¿¡æ¯çš„å†å²æ•°æ® 1peer chaincode query -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply -c &#x27;&#123;&quot;function&quot;:&quot;QueryAssetHistory&quot;,&quot;Args&quot;:[&quot;asset01012&quot;]&#125;&#x27;|jq","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"ä¾›åº”é“¾é‡‘è","slug":"åŒºå—é“¾/Hyperledger-Fabric/ä¾›åº”é“¾é‡‘è","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"peer","slug":"peer","permalink":"https://guozhe001.github.io/tags/peer/"},{"name":"ä¾›åº”é“¾é‡‘è","slug":"ä¾›åº”é“¾é‡‘è","permalink":"https://guozhe001.github.io/tags/%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D/"}]},{"title":"éƒ¨ç½²æ–°çš„æ™ºèƒ½åˆçº¦åˆ°channel","slug":"blockchain/fabric/é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric/éƒ¨ç½²æ™ºèƒ½åˆçº¦åˆ°channel","date":"2021-04-01T10:18:21.498Z","updated":"2021-04-01T10:18:21.499Z","comments":true,"path":"2021/04/01/blockchain/fabric/é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric/éƒ¨ç½²æ™ºèƒ½åˆçº¦åˆ°channel/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E9%83%A8%E7%BD%B2%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E5%88%B0channel/","excerpt":"","text":"éƒ¨ç½²æ–°çš„æ™ºèƒ½åˆçº¦åˆ°channel éƒ¨ç½²V1ç‰ˆæœ¬ æ‰“åŒ… 1peer lifecycle chaincode package supply.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/chaincode-go/ --lang golang --label supply_1.0 è¿è¡Œå®Œä¸Šé¢çš„å‘½ä»¤ï¼ŒæŸ¥çœ‹å½“å‰ç›®å½•ä¼šå‘ç°å¤šäº†supply.tar.gzåŒ…ï¼Œè¯´æ˜æ‰“åŒ…æˆåŠŸã€‚ å®‰è£…é“¾ç åŒ… ä¸€çº§ä¾›åº”å•†å’Œæ ¸å¿ƒä¼ä¸šéƒ½è¦å®‰è£…ï¼š æ ¸å¿ƒä¼ä¸šï¼š 1peer lifecycle chaincode install supply.tar.gz --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt ä¸€çº§ä¾›åº”å•†ï¼š 1peer lifecycle chaincode install supply.tar.gz --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt å®‰è£…æˆåŠŸè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š 122020-12-28 17:12:37.540 CST [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 001 Installed remotely: response:&lt;status:200 payload:&quot;\\nKsupply_1.0:7f51b70454bfcc78087a784c84288a67bbad56786e4007c3a7106491a492ad3a\\022\\nsupply_1.0&quot; &gt;2020-12-28 17:12:37.542 CST [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 002 Chaincode code package identifier: supply_1.0:7f51b70454bfcc78087a784c84288a67bbad56786e4007c3a7106491a492ad3a æ‰¹å‡†é“¾ç å®šä¹‰ æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode 1peer lifecycle chaincode queryinstalled æˆåŠŸç»“æœå¦‚ä¸‹ï¼š 123Installed chaincodes on peer:Package ID: basic_1.0:4ec191e793b27e953ff2ede5a8bcc63152cecb1e4c3f301a26e22692c61967ad, Label: basic_1.0Package ID: supply_1.0:7f51b70454bfcc78087a784c84288a67bbad56786e4007c3a7106491a492ad3a, Label: supply_1.0 å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ 1export CC_PACKAGE_ID=supply_1.0:7f51b70454bfcc78087a784c84288a67bbad56786e4007c3a7106491a492ad3a æ‰¹å‡†é“¾ç å®šä¹‰ æ ¸å¿ƒä¼ä¸šå’Œä¸€çº§ä¾›åº”å•†éƒ½éœ€è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š 1peer lifecycle chaincode approveformyorg -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name supply --version 1.0 --package-id $CC_PACKAGE_ID --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem æˆåŠŸç»“æœå¦‚ä¸‹ï¼š 12020-12-28 17:14:07.090 CST [chaincodeCmd] ClientWait -&gt; INFO 001 txid [5c192d72135019a4bd6d444231fc95d41b6c7391cbc80a98cb67618f5e7a85c6] committed with status (VALID) at localhost:8053 å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š 1peer lifecycle chaincode checkcommitreadiness --channelID coreandfirstchannel --name supply --version 1.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json æˆåŠŸç»“æœå¦‚ä¸‹ï¼š 123456&#123; &quot;approvals&quot;: &#123; &quot;GylCoreOrg1MSP&quot;: true, &quot;GylFOrg1MSP&quot;: true &#125;&#125; åœ¨ä¸¤ä¸ªç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š 1peer lifecycle chaincode commit -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name supply --version 1.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt æˆåŠŸç»“æœå¦‚ä¸‹ï¼š 122020-12-28 17:14:57.631 CST [chaincodeCmd] ClientWait -&gt; INFO 001 txid [1c5e194c62a24b9fe78d51bd7003fce369f01a0b3051f63ed5e1f9ee4f6cf48b] committed with status (VALID) at localhost:80512020-12-28 17:14:57.631 CST [chaincodeCmd] ClientWait -&gt; INFO 002 txid [1c5e194c62a24b9fe78d51bd7003fce369f01a0b3051f63ed5e1f9ee4f6cf48b] committed with status (VALID) at localhost:8053 ä½¿ç”¨ peer lifecycle chaincode querycommitted å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚ 1peer lifecycle chaincode querycommitted --channelID coreandfirstchannel --name supply --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem æˆåŠŸç»“æœå¦‚ä¸‹ï¼š 12Committed chaincode definition for chaincode &#x27;supply&#x27; on channel &#x27;coreandfirstchannel&#x27;:Version: 1.0, Sequence: 1, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [GylCoreOrg1MSP: true, GylFOrg1MSP: true] è°ƒç”¨é“¾ç  1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C coreandfirstchannel -n supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;IssueVoucher&quot;,&quot;Args&quot;:[&quot;100&quot;, &quot;ä¸€çº§ä¾›åº”å•†&quot;]&#125;&#x27; æˆåŠŸä¿¡æ¯ï¼š 12020-12-25 17:26:22.583 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200 é”™è¯¯ä¿¡æ¯è®°å½•ï¼š 1Error: could not assemble transaction: ProposalResponsePayloads do not match - proposal response: version:1 response:&lt;status:200 &gt; payload:&quot;\\n \\266\\367\\033\\202\\030f\\357\\010\\266zg\\350\\237\\212\\313 \\342B\\2041\\316\\351&gt;H\\037\\035\\312\\274J\\021i\\220\\022\\266\\002\\n\\237\\002\\0227\\n\\n_lifecycle\\022)\\n&#x27;\\n!namespaces/fields/supply/Sequence\\022\\002\\010\\t\\022\\343\\001\\n\\006supply\\022\\330\\001\\n\\003\\n\\0011\\032\\320\\001\\n\\0011\\032\\312\\001&#123;\\&quot;ID\\&quot;:\\&quot;1\\&quot;,\\&quot;issuer\\&quot;:\\&quot;\\346\\240\\270\\345\\277\\203\\344\\274\\201\\344\\270\\232\\&quot;,\\&quot;owner\\&quot;:\\&quot;\\346\\240\\270\\345\\277\\203\\344\\274\\201\\344\\270\\232\\&quot;,\\&quot;amount\\&quot;:100,\\&quot;createDate\\&quot;:\\&quot;2020-12-28T09:24:44.871052163Z\\&quot;,\\&quot;endDate\\&quot;:\\&quot;2021-06-28T09:24:44.871052228Z\\&quot;,\\&quot;contractHash\\&quot;:\\&quot;test\\&quot;,\\&quot;invoiceHash\\&quot;:\\&quot;test\\&quot;&#125;\\032\\003\\010\\310\\001\\&quot;\\r\\022\\006supply\\032\\0031.0&quot; endorsement:&lt;endorser:&quot;\\n\\013GylFOrg1MSP\\022\\212\\006-----BEGIN CERTIFICATE-----\\nMIICETCCAbegAwIBAgIRAKxyUt8FsMI4LRaMcjh08ZgwCgYIKoZIzj0EAwIwbTEL\\nMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNhbGlmb3JuaWExFjAUBgNVBAcTDVNhbiBG\\ncmFuY2lzY28xFjAUBgNVBAoTDWYxLnN1cHBseS5jb20xGTAXBgNVBAMTEGNhLmYx\\nLnN1cHBseS5jb20wHhcNMjAxMjI1MDkxNzAwWhcNMzAxMjIzMDkxNzAwWjBYMQsw\\nCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMNU2FuIEZy\\nYW5jaXNjbzEcMBoGA1UEAxMTcGVlcjAuZjEuc3VwcGx5LmNvbTBZMBMGByqGSM49\\nAgEGCCqGSM49AwEHA0IABIChG5EnW6enlGqH2F9EiWYbilBwfA+KgqqxnN56njS5\\ngv368PElfoafV6jCrjA+p2OnbTI3gO2/RAwr2WBLB0+jTTBLMA4GA1UdDwEB/wQE\\nAwIHgDAMBgNVHRMBAf8EAjAAMCsGA1UdIwQkMCKAIHNOBiXoFslrjdFMBMzU7pNe\\nI5pmxxrQGrWTdgfI0cetMAoGCCqGSM49BAMCA0gAMEUCIQDEOKc114LvsauKzrMR\\n7k6ipg0HPM1+W8JJt06Jeqd1vwIgBre+xg2g/rS7F5oZaJpECUf7ALV0fy9/Dhw0\\nYDB3H+g=\\n-----END CERTIFICATE-----\\n&quot; signature:&quot;0D\\002 9\\020\\212\\014\\220\\302Ao_\\226n`o\\005\\354B\\263\\316\\346\\330\\347\\010\\217\\205^X\\&quot;\\267d\\320U\\365\\002 \\t&lt;\\024e\\324\\312X\\036\\346=\\025.I*A\\311\\223\\013\\301\\276\\320\\232\\366\\246tZm\\341g\\223\\235|&quot; &gt; åŸå› åº”è¯¥æ˜¯ä»£ç ä¸­ä½¿ç”¨äº†Nowï¼ˆï¼‰æ¥åˆ›å»ºå½“å‰æ—¶é—´ï¼Œä¸¤ä¸ªpeerçš„å½“å‰æ—¶é—´å¯èƒ½ä¼šæœ‰ä¸€ç‚¹è¯¯å·®å¯¼è‡´äº†æ ¡éªŒä¸é€šè¿‡ã€‚ **è§£å†³æ–¹æ¡ˆï¼š**ä½¿ç”¨ctx.GetStub().GetTxTimestamp()æ¥è·å–æ—¶é—´ï¼Œè¿™æ ·æ‰€æœ‰çš„èŠ‚ç‚¹åˆ›å»ºçš„æ—¶é—´éƒ½æ˜¯ä¸€è‡´çš„ï¼Œè¯¦è§å‚è€ƒæ–‡æ¡£ æ›´æ–°æ™ºèƒ½åˆçº¦ æ‰“åŒ… 1# peer lifecycle chaincode package supply.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/fabric-samples/asset-transfer-basic/chaincode-go/ --lang golang --label supply_1.0 æ‰“åŒ…æœ¬åœ°çš„ä»£ç ï¼š 1peer lifecycle chaincode package supply.5.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/chaincode-go/ --lang golang --label supply_5.0 å®‰è£…é“¾ç åŒ… ä¸€çº§ä¾›åº”å•†å’Œæ ¸å¿ƒä¼ä¸šéƒ½è¦å®‰è£…ï¼š æ ¸å¿ƒä¼ä¸šï¼š 1peer lifecycle chaincode install supply.5.tar.gz --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt ä¸€çº§ä¾›åº”å•†ï¼š 1peer lifecycle chaincode install supply.5.tar.gz --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt æ‰¹å‡†é“¾ç å®šä¹‰ æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode 1peer lifecycle chaincode queryinstalled å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ï¼Œä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦å®šä¹‰æ­¤å˜é‡ï¼š 1export CC_PACKAGE_ID=supply_5.0:0006888ea72e1b318238518b719382d440ab72f2d2c45b22e674f4828b7f7f9c æ‰¹å‡†é“¾ç å®šä¹‰ æ ¸å¿ƒä¼ä¸šå’Œä¸€çº§ä¾›åº”å•†éƒ½éœ€è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š 1peer lifecycle chaincode approveformyorg -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name supply --version 5.0 --package-id $CC_PACKAGE_ID --sequence 5 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem æˆåŠŸç»“æœå¦‚ä¸‹ï¼š 12020-12-28 17:58:55.313 CST [chaincodeCmd] ClientWait -&gt; INFO 001 txid [c4974d5c90ae4fb3bd31f179292d9943dd05aac47248f33e365d9f32ccb5ccb6] committed with status (VALID) at localhost:8051 å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š 1peer lifecycle chaincode checkcommitreadiness --channelID coreandfirstchannel --name supply --version 5.0 --sequence 5 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json æˆåŠŸç»“æœå¦‚ä¸‹ï¼š 123456&#123; &quot;approvals&quot;: &#123; &quot;GylCoreOrg1MSP&quot;: true, &quot;GylFOrg1MSP&quot;: true &#125;&#125; åœ¨ä¸¤ä¸ªç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š 1peer lifecycle chaincode commit -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name supply --version 5.0 --sequence 5 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt æˆåŠŸç»“æœå¦‚ä¸‹ï¼š 122020-12-28 17:51:08.452 CST [chaincodeCmd] ClientWait -&gt; INFO 001 txid [87bc060e5ccdf4014cd4cf34bbbeb5d2ea10c4ff8ebb6f444d10580e2de2da50] committed with status (VALID) at localhost:80532020-12-28 17:51:08.460 CST [chaincodeCmd] ClientWait -&gt; INFO 002 txid [87bc060e5ccdf4014cd4cf34bbbeb5d2ea10c4ff8ebb6f444d10580e2de2da50] committed with status (VALID) at localhost:8051 ä½¿ç”¨ peer lifecycle chaincode querycommitted å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚ 1peer lifecycle chaincode querycommitted --channelID coreandfirstchannel --name supply --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem æˆåŠŸç»“æœå¦‚ä¸‹,å¯ä»¥çœ‹åˆ°å·²ç»å‡çº§åˆ°2.0ç‰ˆæœ¬ï¼š 12Committed chaincode definition for chaincode &#x27;supply&#x27; on channel &#x27;coreandfirstchannel&#x27;:Version: 2.0, Sequence: 2, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [GylCoreOrg1MSP: true, GylFOrg1MSP: true] è°ƒç”¨é“¾ç  1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C coreandfirstchannel -n supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;IssueVoucher&quot;,&quot;Args&quot;:[&quot;asset001&quot;, &quot;100&quot;, &quot;ä¸€çº§ä¾›åº”å•†&quot;]&#125;&#x27; æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š 12020-12-28 18:37:54.285 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200 é”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š 1Error: could not assemble transaction: proposal response was not successful, error code 500, msg Incorrect number of params. Expected 2, received 1 - proposal response: version:1 response:&lt;status:200 &gt; payload:&quot;\\n \\177\\017\\350[\\344G6\\010V\\331\\332\\377\\354\\216&amp;\\035\\317&amp;\\251[N`\\023\\036\\033\\237\\237A\\005\\3670\\260\\022\\266\\002\\n\\237\\002\\0227\\n\\n_lifecycle\\022)\\n&#x27;\\n!namespaces/fields/supply/Sequence\\022\\002\\010\\016\\022\\343\\001\\n\\006supply\\022\\330\\001\\n\\003\\n\\0011\\032\\320\\001\\n\\0011\\032\\312\\001&#123;\\&quot;ID\\&quot;:\\&quot;1\\&quot;,\\&quot;issuer\\&quot;:\\&quot;\\346\\240\\270\\345\\277\\203\\344\\274\\201\\344\\270\\232\\&quot;,\\&quot;owner\\&quot;:\\&quot;\\346\\240\\270\\345\\277\\203\\344\\274\\201\\344\\270\\232\\&quot;,\\&quot;amount\\&quot;:100,\\&quot;createDate\\&quot;:\\&quot;2020-12-28T10:02:30.578872398Z\\&quot;,\\&quot;endDate\\&quot;:\\&quot;2021-06-28T10:02:30.578872527Z\\&quot;,\\&quot;contractHash\\&quot;:\\&quot;test\\&quot;,\\&quot;invoiceHash\\&quot;:\\&quot;test\\&quot;&#125;\\032\\003\\010\\310\\001\\&quot;\\r\\022\\006supply\\032\\0033.0&quot; endorsement:&lt;endorser:&quot;\\n\\016GylCoreOrg1MSP\\022\\222\\006-----BEGIN CERTIFICATE-----\\nMIICFjCCAbygAwIBAgIQU43L5gjtXO+uCpRP2jG2AjAKBggqhkjOPQQDAjBxMQsw\\nCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMNU2FuIEZy\\nYW5jaXNjbzEYMBYGA1UEChMPY29yZS5zdXBwbHkuY29tMRswGQYDVQQDExJjYS5j\\nb3JlLnN1cHBseS5jb20wHhcNMjAxMjI1MDkxNzAwWhcNMzAxMjIzMDkxNzAwWjBa\\nMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMNU2Fu\\nIEZyYW5jaXNjbzEeMBwGA1UEAxMVcGVlcjAuY29yZS5zdXBwbHkuY29tMFkwEwYH\\nKoZIzj0CAQYIKoZIzj0DAQcDQgAErf3R+7XpNQpmTsMO+iM4WS7IrOoafiPbAS7Q\\nbuFFR3Qs4riIczgSmjh9rOA6I1q2q0CstLhfWDbqpf+8fXPUlKNNMEswDgYDVR0P\\nAQH/BAQDAgeAMAwGA1UdEwEB/wQCMAAwKwYDVR0jBCQwIoAguznqsTisa64dNvOR\\nvPwP0KGklWohNpbSe7VgIghx4L8wCgYIKoZIzj0EAwIDSAAwRQIhALIw1VMzezCg\\n9LONbO4+V+weY42HQLbShkTP/gCFnGRYAiARyLLSDJIC2wwzSvOHNdm+aDRtbqGC\\nNJenP9hmEbYsTw==\\n-----END CERTIFICATE-----\\n&quot; signature:&quot;0E\\002!\\000\\251\\370K6S\\020\\373\\242\\321\\000\\211\\312\\0001\\333\\365&gt;\\314\\324\\231\\020&gt;u;+\\243\\303dD\\023\\221\\237\\002 z \\224\\236R\\355Z\\251\\202\\363\\035\\304\\365\\212\\277\\235\\375?\\376\\030\\371\\236\\220\\354iG6\\244\\334M\\315\\331&quot; &gt; åŸå› æ˜¯å› ä¸ºä¸‹å›¾ï¼Œåªæœ‰ä¸€ä¸ªç»„ç»‡çš„é“¾ç æ›´æ–°åˆ°äº†æœ€æ–°çš„ç‰ˆæœ¬ã€‚ ![æˆªå±2020-12-28 18.03.06](/Users/apple/Desktop/æˆªå±2020-12-28 18.03.06.png) **è§£å†³æ–¹æ¡ˆï¼š**åŸå› æ˜¯å› ä¸ºè®¾ç½®ç¯å¢ƒå˜é‡CC_PACKAGE_IDæ—¶åªè®¾ç½®äº†ä¸€ä¸ªç»„ç»‡çš„peerï¼Œå¯¼è‡´æ—§çš„ç¯å¢ƒå˜é‡è¿˜åœ¨ç”Ÿæ•ˆï¼Œé‡æ–°æ“ä½œä¸€éé—®é¢˜è§£å†³ã€‚ æŸ¥è¯¢è°ƒç”¨åçš„ç»“æœ 1peer chaincode query -C coreandfirstchannel -n supply -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27; æˆåŠŸç»“æœå¦‚ä¸‹ 1234# æ ¸å¿ƒä¼ä¸š[&#123;&quot;ID&quot;:&quot;asset001&quot;,&quot;issuer&quot;:&quot;æ ¸å¿ƒä¼ä¸š&quot;,&quot;owner&quot;:&quot;æ ¸å¿ƒä¼ä¸š&quot;,&quot;amount&quot;:100,&quot;createDate&quot;:&quot;2020-12-28T10:37:54.271518Z&quot;,&quot;endDate&quot;:&quot;2021-06-28T10:37:54.271518Z&quot;,&quot;contractHash&quot;:&quot;test&quot;,&quot;invoiceHash&quot;:&quot;test&quot;&#125;]# ä¸€çº§ä¾›åº”å•†[&#123;&quot;ID&quot;:&quot;asset001&quot;,&quot;issuer&quot;:&quot;æ ¸å¿ƒä¼ä¸š&quot;,&quot;owner&quot;:&quot;æ ¸å¿ƒä¼ä¸š&quot;,&quot;amount&quot;:100,&quot;createDate&quot;:&quot;2020-12-28T10:37:54.271518Z&quot;,&quot;endDate&quot;:&quot;2021-06-28T10:37:54.271518Z&quot;,&quot;contractHash&quot;:&quot;test&quot;,&quot;invoiceHash&quot;:&quot;test&quot;&#125;] è°ƒç”¨äº¤æ˜“æ–¹æ³• 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C coreandfirstchannel -n supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAsset&quot;,&quot;Args&quot;:[&quot;asset001&quot;, &quot;ä¸€çº§ä¾›åº”å•†&quot;]&#125;&#x27; å†æ¬¡æŸ¥è¯¢ï¼špeer chaincode query -C coreandfirstchannel -n supply -c '&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;' 1234# æ ¸å¿ƒä¼ä¸š[&#123;&quot;ID&quot;:&quot;asset001&quot;,&quot;issuer&quot;:&quot;æ ¸å¿ƒä¼ä¸š&quot;,&quot;owner&quot;:&quot;ä¸€çº§ä¾›åº”å•†&quot;,&quot;amount&quot;:100,&quot;createDate&quot;:&quot;2020-12-28T10:37:54.271518Z&quot;,&quot;endDate&quot;:&quot;2021-06-28T10:37:54.271518Z&quot;,&quot;contractHash&quot;:&quot;test&quot;,&quot;invoiceHash&quot;:&quot;test&quot;&#125;]# ä¸€çº§ä¾›åº”å•†[&#123;&quot;ID&quot;:&quot;asset001&quot;,&quot;issuer&quot;:&quot;æ ¸å¿ƒä¼ä¸š&quot;,&quot;owner&quot;:&quot;ä¸€çº§ä¾›åº”å•†&quot;,&quot;amount&quot;:100,&quot;createDate&quot;:&quot;2020-12-28T10:37:54.271518Z&quot;,&quot;endDate&quot;:&quot;2021-06-28T10:37:54.271518Z&quot;,&quot;contractHash&quot;:&quot;test&quot;,&quot;invoiceHash&quot;:&quot;test&quot;&#125;] äº¤æ˜“ä¹‹åownerå˜æˆäº†ä¸€çº§ä¾›åº”å•†ï¼Œæ²¡æœ‰é—®é¢˜ã€‚ é—®é¢˜è®°å½•ï¼š è™½ç„¶æ™ºèƒ½åˆçº¦çš„ä»£ç ç¼–å†™æ–¹å¼å¦‚ä¸‹ï¼Œä½†æ˜¯ç¬¬äºŒè¡Œçš„TransferAssetå¹¶æ²¡æœ‰æ‰§è¡Œï¼Œå¯èƒ½æ˜¯å› ä¸ºç¬¬ä¸€ä¸ªåˆ›å»ºäº¤æ˜“ï¼ˆCreateAssetï¼‰è¿˜æ²¡æœ‰æˆåŠŸï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªäº¤æ˜“ï¼ˆTransferAssetï¼‰æ²¡æœ‰è¿™ä¸ªèµ„äº§æ‰€ä»¥æ²¡æœ‰æ‰§è¡Œï¼Ÿå¾…ç¡®è®¤ 123// åˆ›å»ºèµ„äº§s.CreateAsset(ctx, assetID, amount)s.TransferAsset(ctx, assetID, owner) éƒ¨ç½²v6ç‰ˆæœ¬çš„supply v6ç‰ˆæœ¬æ™ºèƒ½åˆçº¦æºç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159package chaincodeimport ( &quot;encoding/json&quot; &quot;fmt&quot; &quot;time&quot; &quot;github.com/golang/protobuf/ptypes&quot; &quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot;)// SmartContract provides functions for managing an Assettype SmartContract struct &#123; contractapi.Contract&#125;// Asset describes basic details of what makes up a simple assettype Asset struct &#123; ID string `json:&quot;ID&quot;` Issuer string `json:&quot;issuer&quot;` Owner string `json:&quot;owner&quot;` Amount int64 `json:&quot;amount&quot;` CreateDate time.Time `json:&quot;createDate&quot;` EndDate time.Time `json:&quot;endDate&quot;` ContractHash string `json:&quot;contractHash&quot;` InvoiceHash string `json:&quot;invoiceHash&quot;`&#125;// IssueVoucher å‘è¡Œå‡­è¯func (s *SmartContract) IssueVoucher(ctx contractapi.TransactionContextInterface, assetID string, amount int64) error &#123; // åˆ›å»ºèµ„äº§ asset, err := s.createAsset(ctx, assetID, amount, &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;æ ¸å¿ƒä¼ä¸š&quot;) if err != nil &#123; return err &#125; return s.PutState(ctx, asset)&#125;// createAsset issues a new asset to the world state with given details.func (s *SmartContract) createAsset(ctx contractapi.TransactionContextInterface, id string, amount int64, issuerName string, owner string) (*Asset, error) &#123; exists, err := s.AssetExists(ctx, id) if err != nil &#123; return nil, err &#125; if exists &#123; return nil, fmt.Errorf(&quot;the asset %s already exists&quot;, id) &#125; now, err := getNow(ctx) if err != nil &#123; return nil, err &#125; asset := Asset&#123;ID: id, Issuer: issuerName, Amount: amount, Owner: owner, CreateDate: now, EndDate: now.AddDate(0, 6, 0), ContractHash: &quot;test&quot;, InvoiceHash: &quot;test&quot;&#125; return &amp;asset, nil&#125;func getNow(ctx contractapi.TransactionContextInterface) (time.Time, error) &#123; now, err := ctx.GetStub().GetTxTimestamp() if err != nil &#123; return time.Now(), err &#125; return ptypes.Timestamp(now)&#125;// ReadAsset returns the asset stored in the world state with given id.func (s *SmartContract) ReadAsset(ctx contractapi.TransactionContextInterface, id string) (*Asset, error) &#123; assetJSON, err := ctx.GetStub().GetState(id) if err != nil &#123; return nil, fmt.Errorf(&quot;failed to read from world state: %v&quot;, err) &#125; if assetJSON == nil &#123; return nil, fmt.Errorf(&quot;the asset %s does not exist&quot;, id) &#125; var asset Asset err = json.Unmarshal(assetJSON, &amp;asset) if err != nil &#123; return nil, err &#125; return &amp;asset, nil&#125;// AssetExists returns true when asset with given ID exists in world statefunc (s *SmartContract) AssetExists(ctx contractapi.TransactionContextInterface, id string) (bool, error) &#123; assetJSON, err := ctx.GetStub().GetState(id) if err != nil &#123; return false, fmt.Errorf(&quot;failed to read from world state: %v&quot;, err) &#125; return assetJSON != nil, nil&#125;// TransferAsset updates the owner field of asset with given id in world state.func (s *SmartContract) TransferAsset(ctx contractapi.TransactionContextInterface, id string, newOwner string, amount int64) error &#123; asset, err := s.ReadAsset(ctx, id) if err != nil &#123; return err &#125; // å¦‚æœé‡‘é¢åˆšå¥½ç­‰äºå‡­è¯èµ„äº§çš„é‡‘é¢ï¼Œç›´æ¥æ›´æ–°å‡­è¯èµ„äº§çš„æ‹¥æœ‰è€… if asset.Amount == amount &#123; asset.Owner = newOwner err = s.PutState(ctx, asset) &#125; else if asset.Amount &gt; amount &#123; // å¦‚æœå‡­è¯èµ„äº§çš„é‡‘é¢å¤§äºè½¬è´¦çš„é‡‘é¢ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„äº§ // åˆ›å»ºæ–°çš„èµ„äº§å¹¶ä¿å­˜ newAsset, err := s.createAsset(ctx, asset.ID+&quot;1&quot;, amount, asset.Issuer, newOwner) if err != nil &#123; return err &#125; err = s.PutState(ctx, newAsset) if err != nil &#123; return err &#125; // æ›´æ–°æ—§èµ„äº§çš„é‡‘é¢ asset.Amount = asset.Amount - amount err = s.PutState(ctx, asset) &#125; else if asset.Amount &lt; amount &#123; // å¦‚æœèµ„äº§çš„é¢åº¦å°äºè¦è½¬è´¦çš„é‡‘é¢ï¼Œåˆ™ç›´æ¥æŠ¥é”™ err = fmt.Errorf(&quot;è½¬è´¦é‡‘é¢=%d,ä¸èƒ½è¶…è¿‡èµ„äº§çš„é‡‘é¢=%d&quot;, amount, asset.Amount) &#125; return err&#125;// PutState æ›´æ–°èµ„äº§func (s *SmartContract) PutState(ctx contractapi.TransactionContextInterface, asset *Asset) error &#123; assetJSON, err := json.Marshal(asset) if err != nil &#123; return err &#125; return ctx.GetStub().PutState(asset.ID, assetJSON)&#125;// GetAllAssets returns all assets found in world statefunc (s *SmartContract) GetAllAssets(ctx contractapi.TransactionContextInterface) ([]*Asset, error) &#123; // range query with empty string for startKey and endKey does an // open-ended query of all assets in the chaincode namespace. resultsIterator, err := ctx.GetStub().GetStateByRange(&quot;&quot;, &quot;&quot;) if err != nil &#123; return nil, err &#125; defer resultsIterator.Close() var assets []*Asset for resultsIterator.HasNext() &#123; queryResponse, err := resultsIterator.Next() if err != nil &#123; return nil, err &#125; var asset Asset err = json.Unmarshal(queryResponse.Value, &amp;asset) if err != nil &#123; return nil, err &#125; assets = append(assets, &amp;asset) &#125; return assets, nil&#125; æ‰“åŒ… 1peer lifecycle chaincode package supply.6.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/chaincode-go/ --lang golang --label supply_6.0 å®‰è£…é“¾ç åŒ… ä¸€çº§ä¾›åº”å•†å’Œæ ¸å¿ƒä¼ä¸šéƒ½è¦å®‰è£…ï¼š æ ¸å¿ƒä¼ä¸šï¼š 1peer lifecycle chaincode install supply.6.tar.gz --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt ä¸€çº§ä¾›åº”å•†ï¼š 1peer lifecycle chaincode install supply.6.tar.gz --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt æ‰¹å‡†é“¾ç å®šä¹‰ æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode 1peer lifecycle chaincode queryinstalled å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ï¼Œä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦å®šä¹‰æ­¤å˜é‡ï¼š 1export CC_PACKAGE_ID=supply_6.0:18a7379ed3b12a57961a735880a71bea3dd242c741fa0970f779b5a338f848de æ‰¹å‡†é“¾ç å®šä¹‰ æ ¸å¿ƒä¼ä¸šå’Œä¸€çº§ä¾›åº”å•†éƒ½éœ€è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š 1peer lifecycle chaincode approveformyorg -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name supply --version 6.0 --package-id $CC_PACKAGE_ID --sequence 6 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem æˆåŠŸç»“æœå¦‚ä¸‹ï¼š 12020-12-28 17:58:55.313 CST [chaincodeCmd] ClientWait -&gt; INFO 001 txid [c4974d5c90ae4fb3bd31f179292d9943dd05aac47248f33e365d9f32ccb5ccb6] committed with status (VALID) at localhost:8051 å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š 1peer lifecycle chaincode checkcommitreadiness --channelID coreandfirstchannel --name supply --version 6.0 --sequence 6 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json æˆåŠŸç»“æœå¦‚ä¸‹ï¼š 123456&#123; &quot;approvals&quot;: &#123; &quot;GylCoreOrg1MSP&quot;: true, &quot;GylFOrg1MSP&quot;: true &#125;&#125; åœ¨ä¸¤ä¸ªç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š 1peer lifecycle chaincode commit -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name supply --version 6.0 --sequence 6 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt æˆåŠŸç»“æœå¦‚ä¸‹ï¼š 122020-12-28 17:51:08.452 CST [chaincodeCmd] ClientWait -&gt; INFO 001 txid [87bc060e5ccdf4014cd4cf34bbbeb5d2ea10c4ff8ebb6f444d10580e2de2da50] committed with status (VALID) at localhost:80532020-12-28 17:51:08.460 CST [chaincodeCmd] ClientWait -&gt; INFO 002 txid [87bc060e5ccdf4014cd4cf34bbbeb5d2ea10c4ff8ebb6f444d10580e2de2da50] committed with status (VALID) at localhost:8051 ä½¿ç”¨ peer lifecycle chaincode querycommitted å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚ 1peer lifecycle chaincode querycommitted --channelID coreandfirstchannel --name supply --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem æˆåŠŸç»“æœå¦‚ä¸‹,å¯ä»¥çœ‹åˆ°å·²ç»å‡çº§åˆ°2.0ç‰ˆæœ¬ï¼š 12Committed chaincode definition for chaincode &#x27;supply&#x27; on channel &#x27;coreandfirstchannel&#x27;:Version: 2.0, Sequence: 2, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [GylCoreOrg1MSP: true, GylFOrg1MSP: true] è°ƒç”¨é“¾ç  1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C coreandfirstchannel -n supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;IssueVoucher&quot;,&quot;Args&quot;:[&quot;asset002&quot;, &quot;1000&quot;]&#125;&#x27; æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š 12020-12-29 10:59:48.513 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200 é”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š 1Error: endorsement failure during invoke. response: status:500 message:&quot;the asset asset001 already exists&quot; **è§£å†³æ–¹æ¡ˆï¼š**åŸå› æ˜¯ä»¥å†…èµ„äº§IDä¸ºasset001çš„èµ„äº§å·²ç»å­˜åœ¨ï¼Œä¿®æ”¹èµ„äº§IDå‚æ•°å³å¯ã€‚ æŸ¥è¯¢è°ƒç”¨åçš„ç»“æœ 1peer chaincode query -C coreandfirstchannel -n supply -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27; æˆåŠŸç»“æœå¦‚ä¸‹ 12345678910111213141516171819202122[ &#123; &quot;ID&quot;: &quot;asset001&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;amount&quot;: 100, &quot;createDate&quot;: &quot;2020-12-28T10:37:54.271518Z&quot;, &quot;endDate&quot;: &quot;2021-06-28T10:37:54.271518Z&quot;, &quot;contractHash&quot;: &quot;test&quot;, &quot;invoiceHash&quot;: &quot;test&quot; &#125;, &#123; &quot;ID&quot;: &quot;asset002&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;amount&quot;: 1000, &quot;createDate&quot;: &quot;2020-12-29T02:59:48.495257Z&quot;, &quot;endDate&quot;: &quot;2021-06-29T02:59:48.495257Z&quot;, &quot;contractHash&quot;: &quot;test&quot;, &quot;invoiceHash&quot;: &quot;test&quot; &#125;] è°ƒç”¨äº¤æ˜“æ–¹æ³• æŠŠå‡­è¯èµ„äº§æ‹†åˆ†ä¸€éƒ¨åˆ†ï¼ˆ200ï¼‰ç»™ä¸€çº§ä¾›åº”å•†ï¼š 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C coreandfirstchannel -n supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAsset&quot;,&quot;Args&quot;:[&quot;asset002&quot;, &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;200&quot;]&#125;&#x27; å†æ¬¡æŸ¥è¯¢ï¼špeer chaincode query -C coreandfirstchannel -n supply -c '&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;' 1234567891011121314151617181920212223242526272829303132[ &#123; &quot;ID&quot;: &quot;asset001&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;amount&quot;: 100, &quot;createDate&quot;: &quot;2020-12-28T10:37:54.271518Z&quot;, &quot;endDate&quot;: &quot;2021-06-28T10:37:54.271518Z&quot;, &quot;contractHash&quot;: &quot;test&quot;, &quot;invoiceHash&quot;: &quot;test&quot; &#125;, &#123; &quot;ID&quot;: &quot;asset002&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;amount&quot;: 800, &quot;createDate&quot;: &quot;2020-12-29T02:59:48.495257Z&quot;, &quot;endDate&quot;: &quot;2021-06-29T02:59:48.495257Z&quot;, &quot;contractHash&quot;: &quot;test&quot;, &quot;invoiceHash&quot;: &quot;test&quot; &#125;, &#123; &quot;ID&quot;: &quot;asset0021&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;amount&quot;: 200, &quot;createDate&quot;: &quot;2020-12-29T03:02:49.495789Z&quot;, &quot;endDate&quot;: &quot;2021-06-29T03:02:49.495789Z&quot;, &quot;contractHash&quot;: &quot;test&quot;, &quot;invoiceHash&quot;: &quot;test&quot; &#125;] äº¤æ˜“ä¹‹åï¼Œæ ¸å¿ƒä¼ä¸šå‰©ä½™800çš„å‡­è¯ï¼Œä¸€çº§ä¾›åº”å•†è·å¾—ä¸€ä¸ªæ–°çš„å‡­è¯ã€‚éªŒè¯æ— è¯¯ã€‚ éƒ¨ç½²v7ç‰ˆæœ¬çš„supply v7ç‰ˆæœ¬æ™ºèƒ½åˆçº¦æºç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166package chaincodeimport ( &quot;encoding/json&quot; &quot;fmt&quot; &quot;time&quot; &quot;github.com/golang/protobuf/ptypes&quot; &quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot;)// SmartContract provides functions for managing an Assettype SmartContract struct &#123; contractapi.Contract&#125;// Asset describes basic details of what makes up a simple assettype Asset struct &#123; ID string `json:&quot;ID&quot;` Issuer string `json:&quot;issuer&quot;` Owner string `json:&quot;owner&quot;` Amount int64 `json:&quot;amount&quot;` CreateDate time.Time `json:&quot;createDate&quot;` EndDate time.Time `json:&quot;endDate&quot;` ContractHash string `json:&quot;contractHash&quot;` InvoiceHash string `json:&quot;invoiceHash&quot;`&#125;// IssueVoucher å‘è¡Œå‡­è¯func (s *SmartContract) IssueVoucher(ctx contractapi.TransactionContextInterface, assetID string, amount int64, owner string, contractHash string, invoiceHash string) error &#123; // åˆ›å»ºèµ„äº§ return s.CreateAssetAndSave(ctx, assetID, amount, &quot;æ ¸å¿ƒä¼ä¸š&quot;, owner, contractHash, invoiceHash)&#125;// CreateAssetAndSave åˆ›å»ºèµ„äº§å¹¶ä¿å­˜func (s *SmartContract) CreateAssetAndSave(ctx contractapi.TransactionContextInterface, id string, amount int64, issuerName string, owner string, contractHash string, invoiceHash string) error &#123; asset, err := s.createAsset(ctx, id, amount, issuerName, owner, contractHash, invoiceHash) if err != nil &#123; return err &#125; return s.PutState(ctx, asset)&#125;// createAsset issues a new asset to the world state with given details.func (s *SmartContract) createAsset(ctx contractapi.TransactionContextInterface, id string, amount int64, issuerName string, owner string, contractHash string, invoiceHash string) (*Asset, error) &#123; exists, err := s.AssetExists(ctx, id) if err != nil &#123; return nil, err &#125; if exists &#123; return nil, fmt.Errorf(&quot;the asset %s already exists&quot;, id) &#125; now, err := getNow(ctx) if err != nil &#123; return nil, err &#125; asset := Asset&#123;ID: id, Issuer: issuerName, Amount: amount, Owner: owner, CreateDate: now, EndDate: now.AddDate(0, 6, 0), ContractHash: contractHash, InvoiceHash: invoiceHash&#125; return &amp;asset, nil&#125;// è·å–å½“å‰æ—¶é—´func getNow(ctx contractapi.TransactionContextInterface) (time.Time, error) &#123; now, err := ctx.GetStub().GetTxTimestamp() if err != nil &#123; return time.Now(), err &#125; return ptypes.Timestamp(now)&#125;// ReadAsset returns the asset stored in the world state with given id.func (s *SmartContract) ReadAsset(ctx contractapi.TransactionContextInterface, id string) (*Asset, error) &#123; assetJSON, err := ctx.GetStub().GetState(id) if err != nil &#123; return nil, fmt.Errorf(&quot;failed to read from world state: %v&quot;, err) &#125; if assetJSON == nil &#123; return nil, fmt.Errorf(&quot;the asset %s does not exist&quot;, id) &#125; var asset Asset err = json.Unmarshal(assetJSON, &amp;asset) if err != nil &#123; return nil, err &#125; return &amp;asset, nil&#125;// AssetExists returns true when asset with given ID exists in world statefunc (s *SmartContract) AssetExists(ctx contractapi.TransactionContextInterface, id string) (bool, error) &#123; assetJSON, err := ctx.GetStub().GetState(id) if err != nil &#123; return false, fmt.Errorf(&quot;failed to read from world state: %v&quot;, err) &#125; return assetJSON != nil, nil&#125;// TransferAssetByID æ ¹æ®èµ„äº§IDè½¬è´¦func (s *SmartContract) TransferAssetByID(ctx contractapi.TransactionContextInterface, id string, newOwner string, amount int64, contractHash string, invoiceHash string) error &#123; asset, err := s.ReadAsset(ctx, id) if err != nil &#123; return err &#125; return s.TransferAsset(ctx, asset, newOwner, amount, contractHash, invoiceHash)&#125;// TransferAsset updates the owner field of asset with given id in world state.func (s *SmartContract) TransferAsset(ctx contractapi.TransactionContextInterface, asset *Asset, newOwner string, amount int64, contractHash string, invoiceHash string) error &#123; // å¦‚æœé‡‘é¢åˆšå¥½ç­‰äºå‡­è¯èµ„äº§çš„é‡‘é¢ï¼Œç›´æ¥æ›´æ–°å‡­è¯èµ„äº§çš„æ‹¥æœ‰è€… if asset.Amount == amount &#123; asset.Owner = newOwner return s.PutState(ctx, asset) &#125; else if asset.Amount &gt; amount &#123; // å¦‚æœå‡­è¯èµ„äº§çš„é‡‘é¢å¤§äºè½¬è´¦çš„é‡‘é¢ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„äº§ // åˆ›å»ºæ–°çš„èµ„äº§å¹¶ä¿å­˜ err := s.CreateAssetAndSave(ctx, asset.ID+&quot;1&quot;, amount, asset.Issuer, newOwner, contractHash, invoiceHash) if err != nil &#123; return err &#125; // æ›´æ–°æ—§èµ„äº§çš„é‡‘é¢ asset.Amount = asset.Amount - amount return s.PutState(ctx, asset) &#125; else if asset.Amount &lt; amount &#123; // å¦‚æœèµ„äº§çš„é¢åº¦å°äºè¦è½¬è´¦çš„é‡‘é¢ï¼Œåˆ™ç›´æ¥æŠ¥é”™ return fmt.Errorf(&quot;è½¬è´¦é‡‘é¢=%d,ä¸èƒ½è¶…è¿‡èµ„äº§çš„é‡‘é¢=%d&quot;, amount, asset.Amount) &#125; return nil&#125;// PutState æ›´æ–°èµ„äº§func (s *SmartContract) PutState(ctx contractapi.TransactionContextInterface, asset *Asset) error &#123; assetJSON, err := json.Marshal(asset) if err != nil &#123; return err &#125; return ctx.GetStub().PutState(asset.ID, assetJSON)&#125;// GetAllAssets returns all assets found in world statefunc (s *SmartContract) GetAllAssets(ctx contractapi.TransactionContextInterface) ([]*Asset, error) &#123; // range query with empty string for startKey and endKey does an // open-ended query of all assets in the chaincode namespace. resultsIterator, err := ctx.GetStub().GetStateByRange(&quot;&quot;, &quot;&quot;) if err != nil &#123; return nil, err &#125; defer resultsIterator.Close() var assets []*Asset for resultsIterator.HasNext() &#123; queryResponse, err := resultsIterator.Next() if err != nil &#123; return nil, err &#125; var asset Asset err = json.Unmarshal(queryResponse.Value, &amp;asset) if err != nil &#123; return nil, err &#125; assets = append(assets, &amp;asset) &#125; return assets, nil&#125; æ‰“åŒ… 1peer lifecycle chaincode package supply.7.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/chaincode-go/ --lang golang --label supply_7.0 å®‰è£…é“¾ç åŒ… ä¸€çº§ä¾›åº”å•†å’Œæ ¸å¿ƒä¼ä¸šéƒ½è¦å®‰è£…ï¼š æ ¸å¿ƒä¼ä¸šï¼š 1peer lifecycle chaincode install supply.7.tar.gz --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt ä¸€çº§ä¾›åº”å•†ï¼š 1peer lifecycle chaincode install supply.7.tar.gz --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt æ‰¹å‡†é“¾ç å®šä¹‰ æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode 1peer lifecycle chaincode queryinstalled å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ï¼Œä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦å®šä¹‰æ­¤å˜é‡ï¼š 1export CC_PACKAGE_ID=supply_7.0:770f0c8f4fe3a348314f546594d402ccb3eb5f5779f12e7edee48f6ce474227b æ‰¹å‡†é“¾ç å®šä¹‰ æ ¸å¿ƒä¼ä¸šå’Œä¸€çº§ä¾›åº”å•†éƒ½éœ€è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š 1peer lifecycle chaincode approveformyorg -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name supply --version 7.0 --package-id $CC_PACKAGE_ID --sequence 7 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š 1peer lifecycle chaincode checkcommitreadiness --channelID coreandfirstchannel --name supply --version 7.0 --sequence 7 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json åœ¨ä¸¤ä¸ªç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š 1peer lifecycle chaincode commit -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name supply --version 7.0 --sequence 7 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt ä½¿ç”¨ peer lifecycle chaincode querycommitted å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚ 1peer lifecycle chaincode querycommitted --channelID coreandfirstchannel --name supply --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem è°ƒç”¨é“¾ç  è°ƒç”¨é“¾ç ä¹‹å‰å…ˆç”Ÿæˆæµ‹è¯•çš„åˆåŒhashå€¼å’Œå‘ç¥¨hashå€¼ 12shasum -a 256 CORE_AND_F1_CONTRACT.txt &gt; core_and_f1_contract_hash.txtshasum -a 256 CORE_AND_F1_INVOICE.txt &gt; CORE_AND_F1_INVOICE_hash.txt å‘è¡Œå‡­è¯ 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C coreandfirstchannel -n supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;IssueVoucher&quot;,&quot;Args&quot;:[&quot;asset003&quot;, &quot;1000&quot;, &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;, &quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot;]&#125;&#x27; æŸ¥è¯¢è°ƒç”¨åçš„ç»“æœ 1peer chaincode query -C coreandfirstchannel -n supply -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27; æˆåŠŸç»“æœå¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142[ &#123; &quot;ID&quot;: &quot;asset001&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;amount&quot;: 100, &quot;createDate&quot;: &quot;2020-12-28T10:37:54.271518Z&quot;, &quot;endDate&quot;: &quot;2021-06-28T10:37:54.271518Z&quot;, &quot;contractHash&quot;: &quot;test&quot;, &quot;invoiceHash&quot;: &quot;test&quot; &#125;, &#123; &quot;ID&quot;: &quot;asset002&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;amount&quot;: 800, &quot;createDate&quot;: &quot;2020-12-29T02:59:48.495257Z&quot;, &quot;endDate&quot;: &quot;2021-06-29T02:59:48.495257Z&quot;, &quot;contractHash&quot;: &quot;test&quot;, &quot;invoiceHash&quot;: &quot;test&quot; &#125;, &#123; &quot;ID&quot;: &quot;asset0021&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;amount&quot;: 200, &quot;createDate&quot;: &quot;2020-12-29T03:02:49.495789Z&quot;, &quot;endDate&quot;: &quot;2021-06-29T03:02:49.495789Z&quot;, &quot;contractHash&quot;: &quot;test&quot;, &quot;invoiceHash&quot;: &quot;test&quot; &#125;, &#123; &quot;ID&quot;: &quot;asset003&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;amount&quot;: 1000, &quot;createDate&quot;: &quot;2020-12-29T06:20:30.868298Z&quot;, &quot;endDate&quot;: &quot;2021-06-29T06:20:30.868298Z&quot;, &quot;contractHash&quot;: &quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;, &quot;invoiceHash&quot;: &quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot; &#125;] IDä¸ºasset003çš„èµ„äº§å½’å±ä¸ºä¸€çº§ä¾›åº”å•†ï¼Œé‡‘é¢æ— è¯¯ã€‚ åˆ›å»ºä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†ä¹‹é—´çš„channel åˆ›å»ºé€šé“ï¼š è¿è¡Œä¸‹é¢çš„ç¨‹åºæ¥ä¸ºfirstandsecondchannelé€šé“åˆ›å»ºä¸€ä¸ªâ€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€ 1configtxgen -profile FirstAndSecondChannel -outputCreateChannelTx ./channel-artifacts/firstandsecondchannel.tx -channelID firstandsecondchannel æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š 12342020-12-29 14:27:37.416 CST [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration2020-12-29 14:27:37.430 CST [common.tools.configtxgen.localconfig] Load -&gt; INFO 002 Loaded configuration: /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/config/configtx.yaml2020-12-29 14:27:37.430 CST [common.tools.configtxgen] doOutputChannelCreateTx -&gt; INFO 003 Generating new channel configtx2020-12-29 14:27:37.436 CST [common.tools.configtxgen] doOutputChannelCreateTx -&gt; INFO 004 Writing new channel tx è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä»¥ä¸€çº§ä¾›åº”å•†ç®¡ç†å‘˜èº«ä»½æ“ä½œpeerCLIï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŠŠäº¤æ˜“å‘ç»™orderæœåŠ¡åˆ›å»ºé€šé“ï¼š 1peer channel create -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c firstandsecondchannel -f ./channel-artifacts/firstandsecondchannel.tx --outputBlock ./channel-artifacts/firstandsecondchannel.block --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem é”™è¯¯ä¿¡æ¯è®°å½•ï¼š 1Error: got unexpected status: BAD_REQUEST -- error validating channel creation transaction for new channel &#x27;firstandsecondchannel&#x27;, could not successfully apply update to template configuration: error authorizing update: error validating DeltaSet: policy for [Group] /Channel/Application not satisfied: implicit policy evaluation failed - 0 sub-policies were satisfied, but this policy requires 1 of the &#x27;Admins&#x27; sub-policies to be satisfied é”™è¯¯åŸå› å’Œè§£å†³æ–¹æ¡ˆï¼š ç”±äºé…ç½®æ–‡ä»¶é‡Œé¢é…ç½®çš„firstandsecondchannelé‡Œé¢åŒ…å«ä¸€çº§ä¾›åº”å•†å’Œä¸¤ä¸ªäºŒçº§ä¾›åº”å•†ï¼Œè€Œä¸Šé¢çš„å‘½ä»¤æ˜¯ä»¥æ ¸å¿ƒä¼ä¸šçš„ç®¡ç†å‘˜èº«ä»½è¿è¡Œçš„ã€‚æ‰€ä»¥æœ‰é—®é¢˜ã€‚åˆ‡æ¢æˆä¸€çº§ä¾›åº”å•†çš„ç¯å¢ƒæ‰§è¡Œå³å¯ã€‚ æ­£ç¡®æ‰§è¡Œä¹‹åçš„æ—¥å¿—ï¼š 1234567891011122020-12-29 14:34:06.203 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized2020-12-29 14:34:06.231 CST [cli.common] readBlock -&gt; INFO 002 Expect block, but got status: &amp;&#123;NOT_FOUND&#125;2020-12-29 14:34:06.244 CST [channelCmd] InitCmdFactory -&gt; INFO 003 Endorser and orderer connections initialized2020-12-29 14:34:06.450 CST [cli.common] readBlock -&gt; INFO 004 Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;2020-12-29 14:34:06.458 CST [channelCmd] InitCmdFactory -&gt; INFO 005 Endorser and orderer connections initialized2020-12-29 14:34:06.667 CST [cli.common] readBlock -&gt; INFO 006 Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;2020-12-29 14:34:06.676 CST [channelCmd] InitCmdFactory -&gt; INFO 007 Endorser and orderer connections initialized2020-12-29 14:34:06.885 CST [cli.common] readBlock -&gt; INFO 008 Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;2020-12-29 14:34:06.892 CST [channelCmd] InitCmdFactory -&gt; INFO 009 Endorser and orderer connections initialized2020-12-29 14:34:07.099 CST [cli.common] readBlock -&gt; INFO 00a Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;2020-12-29 14:34:07.108 CST [channelCmd] InitCmdFactory -&gt; INFO 00b Endorser and orderer connections initialized2020-12-29 14:34:07.320 CST [cli.common] readBlock -&gt; INFO 00c Received block: 0 æŠŠä¸€çº§ä¾›åº”å•†å’ŒäºŒçº§ä¾›åº”å•†çš„peeråŠ å…¥é€šé“ ä¸€çº§ä¾›åº”å•†çš„peeråŠ å…¥é€šé“ ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°†peeråŠ å…¥é€šé“ 1peer channel join -b ./channel-artifacts/firstandsecondchannel.block æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š 122020-12-29 14:35:00.679 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized2020-12-29 14:35:00.724 CST [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel é€šè¿‡è·å–é€šé“ä¿¡æ¯ç¡®è®¤åŠ å…¥æˆåŠŸ è·å–é€šé“ä¿¡æ¯ 1peer channel getinfo -c firstandsecondchannel å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š 122020-12-29 14:35:28.593 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initializedBlockchain info: &#123;&quot;height&quot;:1,&quot;currentBlockHash&quot;:&quot;270CWtnSyXJmeGCxJx41sX7uTchRZpljYWKJ48dD434=&quot;&#125; äºŒçº§ä¾›åº”å•†1åŠ å…¥é€šé“ è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œç„¶åæ‹‰å–é€šé“çš„åˆ›ä¸–çºªåŒºå—(å› ä¸ºæ˜¯æµ‹è¯•æœ¬æ¬¡å¿½ç•¥)ï¼š 1peer channel fetch 0 ./channel-artifacts/coreandfirstchannel.block -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c coreandfirstchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem åŠ å…¥é€šé“ï¼š 1peer channel join -b ./channel-artifacts/firstandsecondchannel.block æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š 122020-12-29 14:47:03.684 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized2020-12-29 14:47:03.722 CST [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š 123supply-finance apple$ peer channel join -b ./channel-artifacts/coreandfirstchannel.block2020-12-29 14:43:56.186 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initializedError: proposal failed (err: rpc error: code = Unknown desc = error validating proposal: access denied: channel [] creator org [GylSOrg1M]) **é”™è¯¯åŸå› ï¼š**ç”±äºç¯å¢ƒå˜é‡è®¾ç½®çš„æœ‰é—®é¢˜ï¼ŒCORE_PEER_LOCALMSPIDè®¾ç½®æˆäº†GylSOrg1Mï¼Œåº”è¯¥è®¾ç½®ä¸ºGylSOrg1MSP äºŒçº§ä¾›åº”å•†2åŠ å…¥é€šé“ è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œç„¶åæ‹‰å–é€šé“çš„åˆ›ä¸–çºªåŒºå—(å› ä¸ºæ˜¯æµ‹è¯•æœ¬æ¬¡å¿½ç•¥)ï¼š 1peer channel fetch 0 ./channel-artifacts/coreandfirstchannel.block -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c coreandfirstchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem åŠ å…¥é€šé“ï¼š 1peer channel join -b ./channel-artifacts/firstandsecondchannel.block æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š 122020-12-29 14:52:12.969 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized2020-12-29 14:52:13.010 CST [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel è®¾ç½®é”šèŠ‚ç‚¹ ä¸ºGylFOrg1MSPè®¾ç½®é”šèŠ‚ç‚¹ æ‹‰å–æœ€æ–°çš„channelé…ç½®åŒºå— 1peer channel fetch config channel-artifacts/firstandsecondchannel_config_block.pb -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c firstandsecondchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š 12342020-12-29 14:55:57.114 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized2020-12-29 14:55:57.120 CST [cli.common] readBlock -&gt; INFO 002 Received block: 02020-12-29 14:55:57.120 CST [channelCmd] fetch -&gt; INFO 003 Retrieving last config block: 02020-12-29 14:55:57.125 CST [cli.common] readBlock -&gt; INFO 004 Received block: 0 ä¿®æ”¹é€šé“é…ç½®åŒºå— åˆ‡æ¢åˆ°channel-artifactsç„¶åæŠŠåŒºå—å†…å®¹è½¬æ¢æˆjsonæ ¼å¼ï¼š 12345cd channel-artifactsconfigtxlator proto_decode --input firstandsecondchannel_config_block.pb --type common.Block --output firstandsecondchannel_config_block.jsonjq .data.data[0].payload.data.config firstandsecondchannel_config_block.json &gt; firstandsecondchannel_config.json# copyä¸€ä»½cp firstandsecondchannel_config.json firstandsecondchannel_config_copy.json ä½¿ç”¨jq å·¥å…·æ¥æ·»åŠ GylFOrg1MSPç»„ç»‡çš„é”šèŠ‚ç‚¹åˆ°é€šé“é…ç½®ã€‚ 1jq &#x27;.channel_group.groups.Application.groups.GylFOrg1MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.f1.supply.com&quot;,&quot;port&quot;: 8053&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; firstandsecondchannel_config_copy.json &gt; modified_firstandsecondchannel_config.json å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚ 123configtxlator proto_encode --input firstandsecondchannel_config.json --type common.Config --output firstandsecondchannel_config.pbconfigtxlator proto_encode --input modified_firstandsecondchannel_config.json --type common.Config --output modified_firstandsecondchannel_config.pbconfigtxlator compute_update --channel_id firstandsecondchannel --original firstandsecondchannel_config.pb --updated modified_firstandsecondchannel_config.pb --output firstandsecondchannel_config_update.pb æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼š 123configtxlator proto_decode --input firstandsecondchannel_config_update.pb --type common.ConfigUpdate --output firstandsecondchannel_config_update.jsonecho &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;firstandsecondchannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat firstandsecondchannel_config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; firstandsecondchannel_config_update_in_envelope.jsonconfigtxlator proto_encode --input firstandsecondchannel_config_update_in_envelope.json --type common.Envelope --output firstandsecondchannel_config_update_in_envelope.pb æäº¤â€œæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“â€ è¿›åˆ°ä¸Šä¸€çº§ç›®å½•cd ..ï¼Œä¹‹åè¿è¡Œå‘½ä»¤å°†äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡è¿›è¡Œé€šé“é…ç½®çš„æ›´æ–°ï¼š 12cd ..peer channel update -f channel-artifacts/firstandsecondchannel_config_update_in_envelope.pb -c firstandsecondchannel -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem æ‰§è¡ŒæˆåŠŸçš„ç»“æœï¼š 122020-12-29 14:57:48.872 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized2020-12-29 14:57:48.894 CST [channelCmd] update -&gt; INFO 002 Successfully submitted channel update éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯:peer channel getinfo -c firstandsecondchannel 122020-12-29 14:58:15.937 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initializedBlockchain info: &#123;&quot;height&quot;:2,&quot;currentBlockHash&quot;:&quot;4lhXvhRKDNxBsOIGL0H0A5QDdNkySgv/ehtUkobtW9Y=&quot;,&quot;previousBlockHash&quot;:&quot;270CWtnSyXJmeGCxJx41sX7uTchRZpljYWKJ48dD434=&quot;&#125; ä¸ºäºŒçº§ä¾›åº”å•†1ï¼ˆGylSOrg1MSPï¼‰è®¾ç½®é”šèŠ‚ç‚¹ ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œæ‹‰å–æœ€æ–°çš„channelé…ç½®åŒºå— 1peer channel fetch config channel-artifacts/firstandsecondchannel_config_block.pb -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c firstandsecondchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem ä¿®æ”¹é€šé“é…ç½®åŒºå— åˆ‡æ¢åˆ°channel-artifactsç„¶åæŠŠåŒºå—å†…å®¹è½¬æ¢æˆjsonæ ¼å¼ï¼š 12345cd channel-artifactsconfigtxlator proto_decode --input firstandsecondchannel_config_block.pb --type common.Block --output firstandsecondchannel_config_block.jsonjq .data.data[0].payload.data.config firstandsecondchannel_config_block.json &gt; firstandsecondchannel_config.json# copyä¸€ä»½cp firstandsecondchannel_config.json firstandsecondchannel_config_copy.json ä½¿ç”¨jq å·¥å…·æ¥æ·»åŠ GylCoreOrg1MSPç»„ç»‡çš„é”šèŠ‚ç‚¹åˆ°é€šé“é…ç½®ã€‚ 1jq &#x27;.channel_group.groups.Application.groups.GylSOrg1MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.s1.supply.com&quot;,&quot;port&quot;: 8055&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; firstandsecondchannel_config_copy.json &gt; modified_firstandsecondchannel_config.json å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚ 123configtxlator proto_encode --input firstandsecondchannel_config.json --type common.Config --output firstandsecondchannel_config.pbconfigtxlator proto_encode --input modified_firstandsecondchannel_config.json --type common.Config --output modified_firstandsecondchannel_config.pbconfigtxlator compute_update --channel_id firstandsecondchannel --original firstandsecondchannel_config.pb --updated modified_firstandsecondchannel_config.pb --output firstandsecondchannel_config_update.pb æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼š 123configtxlator proto_decode --input firstandsecondchannel_config_update.pb --type common.ConfigUpdate --output firstandsecondchannel_config_update.jsonecho &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;firstandsecondchannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat firstandsecondchannel_config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; firstandsecondchannel_config_update_in_envelope.jsonconfigtxlator proto_encode --input firstandsecondchannel_config_update_in_envelope.json --type common.Envelope --output firstandsecondchannel_config_update_in_envelope.pb æäº¤â€œæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“â€ è¿›åˆ°ä¸Šä¸€çº§ç›®å½•cd ..ï¼Œä¹‹åè¿è¡Œå‘½ä»¤å°†äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡è¿›è¡Œé€šé“é…ç½®çš„æ›´æ–°ï¼š 12cd ..peer channel update -f channel-artifacts/firstandsecondchannel_config_update_in_envelope.pb -c firstandsecondchannel -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem æ‰§è¡ŒæˆåŠŸçš„ç»“æœï¼š 122020-12-29 15:01:14.643 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized2020-12-29 15:01:14.670 CST [channelCmd] update -&gt; INFO 002 Successfully submitted channel update éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯ 123(base) w:supply-finance apple$ peer channel getinfo -c firstandsecondchannel2020-12-29 15:01:26.952 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initializedBlockchain info: &#123;&quot;height&quot;:3,&quot;currentBlockHash&quot;:&quot;DPXkm090OpH9ww862WmR4EktxT0NHEM2i3Py0yHAGPE=&quot;,&quot;previousBlockHash&quot;:&quot;4lhXvhRKDNxBsOIGL0H0A5QDdNkySgv/ehtUkobtW9Y=&quot;&#125; ä¸ºäºŒçº§ä¾›åº”å•†2ï¼ˆGylSOrg2MSPï¼‰è®¾ç½®é”šèŠ‚ç‚¹ ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œæ‹‰å–æœ€æ–°çš„channelé…ç½®åŒºå— 1peer channel fetch config channel-artifacts/firstandsecondchannel_config_block.pb -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c firstandsecondchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem ä¿®æ”¹é€šé“é…ç½®åŒºå— åˆ‡æ¢åˆ°channel-artifactsç„¶åæŠŠåŒºå—å†…å®¹è½¬æ¢æˆjsonæ ¼å¼ï¼š 12345cd channel-artifactsconfigtxlator proto_decode --input firstandsecondchannel_config_block.pb --type common.Block --output firstandsecondchannel_config_block.jsonjq .data.data[0].payload.data.config firstandsecondchannel_config_block.json &gt; firstandsecondchannel_config.json# copyä¸€ä»½cp firstandsecondchannel_config.json firstandsecondchannel_config_copy.json ä½¿ç”¨jq å·¥å…·æ¥æ·»åŠ GylCoreOrg1MSPç»„ç»‡çš„é”šèŠ‚ç‚¹åˆ°é€šé“é…ç½®ã€‚ 1jq &#x27;.channel_group.groups.Application.groups.GylSOrg2MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.s2.supply.com&quot;,&quot;port&quot;: 8151&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; firstandsecondchannel_config_copy.json &gt; modified_firstandsecondchannel_config.json å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚ 123configtxlator proto_encode --input firstandsecondchannel_config.json --type common.Config --output firstandsecondchannel_config.pbconfigtxlator proto_encode --input modified_firstandsecondchannel_config.json --type common.Config --output modified_firstandsecondchannel_config.pbconfigtxlator compute_update --channel_id firstandsecondchannel --original firstandsecondchannel_config.pb --updated modified_firstandsecondchannel_config.pb --output firstandsecondchannel_config_update.pb æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼š 123configtxlator proto_decode --input firstandsecondchannel_config_update.pb --type common.ConfigUpdate --output firstandsecondchannel_config_update.jsonecho &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;firstandsecondchannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat firstandsecondchannel_config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; firstandsecondchannel_config_update_in_envelope.jsonconfigtxlator proto_encode --input firstandsecondchannel_config_update_in_envelope.json --type common.Envelope --output firstandsecondchannel_config_update_in_envelope.pb æäº¤â€œæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“â€ è¿›åˆ°ä¸Šä¸€çº§ç›®å½•cd ..ï¼Œä¹‹åè¿è¡Œå‘½ä»¤å°†äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡è¿›è¡Œé€šé“é…ç½®çš„æ›´æ–°ï¼š 12cd ..peer channel update -f channel-artifacts/firstandsecondchannel_config_update_in_envelope.pb -c firstandsecondchannel -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem æ‰§è¡ŒæˆåŠŸçš„ç»“æœï¼š 122020-12-29 15:03:39.793 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized2020-12-29 15:03:39.817 CST [channelCmd] update -&gt; INFO 002 Successfully submitted channel update éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯ 123(base) w:supply-finance apple$ peer channel getinfo -c firstandsecondchannel2020-12-29 15:04:10.414 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initializedBlockchain info: &#123;&quot;height&quot;:4,&quot;currentBlockHash&quot;:&quot;PWXXje7tci4mk1ggQ9QMVzkvkP3i+N8WslOGDXreIQ0=&quot;,&quot;previousBlockHash&quot;:&quot;DPXkm090OpH9ww862WmR4EktxT0NHEM2i3Py0yHAGPE=&quot;&#125; éƒ¨ç½²supply-v7åˆ°äºŒçº§ä¾›åº”å•†çš„peerèŠ‚ç‚¹ æ‰“åŒ… 1peer lifecycle chaincode package supply.7.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/chaincode-go/ --lang golang --label supply_7.0 å®‰è£…é“¾ç åŒ… ä¸¤ä¸ªäºŒçº§ä¾›åº”å•†éƒ½è¦å®‰è£…ï¼š äºŒçº§ä¾›åº”å•†1ï¼š 1peer lifecycle chaincode install supply.7.tar.gz --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt äºŒçº§ä¾›åº”å•†2ï¼š 1peer lifecycle chaincode install supply.7.tar.gz --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt æ‰¹å‡†é“¾ç å®šä¹‰ æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode 1peer lifecycle chaincode queryinstalled å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ï¼Œä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦å®šä¹‰æ­¤å˜é‡ï¼š 1export CC_PACKAGE_ID=supply_7.0:770f0c8f4fe3a348314f546594d402ccb3eb5f5779f12e7edee48f6ce474227b æ‰¹å‡†é“¾ç å®šä¹‰ ä¸€çº§ä¾›åº”å•†å’Œä¸¤ä¸ªäºŒçº§ä¾›åº”å•†éƒ½éœ€è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š 1peer lifecycle chaincode approveformyorg -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID firstandsecondchannel --name supply --version 7.0 --package-id $CC_PACKAGE_ID --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š 1peer lifecycle chaincode checkcommitreadiness --channelID firstandsecondchannel --name supply --version 7.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json åœ¨æ‰€æœ‰ç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š 1peer lifecycle chaincode commit -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID firstandsecondchannel --name supply --version 7.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt ä½¿ç”¨ peer lifecycle chaincode querycommitted å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚ 1peer lifecycle chaincode querycommitted --channelID firstandsecondchannel --name supply --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem é”™è¯¯ä¿¡æ¯è®°å½•ï¼š 12(base) w:supply-finance apple$ peer lifecycle chaincode commit -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID firstandsecondchannel --name supply --version 7.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crtError: proposal failed with status: 500 - channel &#x27;firstandsecondchannel&#x27; not found **é”™è¯¯åŸå› ï¼š**ç”±äºæ‰¹å‡†çš„ç»„ç»‡ä¸­åŒ…å«æ ¸å¿ƒä¼ä¸šï¼Œæ ¸å¿ƒä¼ä¸šå¹¶æ²¡æœ‰åŠ å…¥firstandsecondchannelé€šé“ï¼Œæ‰€ä»¥æŠ¥é”™ã€‚ è°ƒç”¨é“¾ç  è°ƒç”¨é“¾ç ä¹‹å‰å…ˆç”Ÿæˆæµ‹è¯•çš„åˆåŒhashå€¼å’Œå‘ç¥¨hashå€¼å¦‚ä¸‹ï¼š 123476307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a f1_and_s1_contract.txt792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49 f1_and_s1_invoice.txtf46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb f1_and_s2_contract.txtf807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468 f1_and_s2_invoice.txt è°ƒç”¨è½¬è´¦äº¤æ˜“ï¼šTODO é—®é¢˜æ¥äº†ï¼Œä¸¤ä¸ªchannelä¹‹é—´å¦‚ä½•äº¤æ¢èµ„äº§ï¼Ÿè¿™æ˜¯ä¸ªé—®é¢˜ 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -C firstandsecondchannel -n supply --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;IssueVoucher&quot;,&quot;Args&quot;:[&quot;asset003&quot;, &quot;1000&quot;, &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;, &quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot;]&#125;&#x27; 1peer chaincode query -C firstandsecondchannel -n supply -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27; æ ¸å¿ƒä¼ä¸šã€ä¸€çº§å’ŒäºŒçº§ä¾›åº”å•†åŠ å…¥åŒä¸€ä¸ªchannel æŸ¥çœ‹åˆ›å»ºchannel éƒ¨ç½²supply-v7åˆ°alljoinchannelé€šé“ æ‰“åŒ… 1# peer lifecycle chaincode package supply.7.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/chaincode-go/ --lang golang --label supply_7.0 å®‰è£…é“¾ç åŒ… æ¯ä¸ªpeeréƒ½è¦å®‰è£…ï¼špeer lifecycle chaincode install supply.7.tar.gz æ‰¹å‡†é“¾ç å®šä¹‰ æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode 1peer lifecycle chaincode queryinstalled å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ï¼Œä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦å®šä¹‰æ­¤å˜é‡ï¼š 1export CC_PACKAGE_ID=supply_7.0:770f0c8f4fe3a348314f546594d402ccb3eb5f5779f12e7edee48f6ce474227b æ‰¹å‡†é“¾ç å®šä¹‰ æ¯ä¸ªpeeréƒ½è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š 1peer lifecycle chaincode approveformyorg -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name supply --version 7.0 --package-id $CC_PACKAGE_ID --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š 1peer lifecycle chaincode checkcommitreadiness --channelID alljoinchannel --name supply --version 7.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json åœ¨æ‰€æœ‰ç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š 1peer lifecycle chaincode commit -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name supply --version 7.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt ä½¿ç”¨ peer lifecycle chaincode querycommitted å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚ 1peer lifecycle chaincode querycommitted --channelID alljoinchannel --name supply --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem è°ƒç”¨é“¾ç  è°ƒç”¨é“¾ç ä¹‹å‰å…ˆç”Ÿæˆæµ‹è¯•çš„åˆåŒhashå€¼å’Œå‘ç¥¨hashå€¼å¦‚ä¸‹ï¼š 12345683c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9 CORE_AND_F1_INVOICE.txt93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14 CORE_AND_F1_CONTRACT.txt76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a f1_and_s1_contract.txt792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49 f1_and_s1_invoice.txtf46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb f1_and_s2_contract.txtf807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468 f1_and_s2_invoice.txt å‘è¡Œå‡­è¯ 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;IssueVoucher&quot;,&quot;Args&quot;:[&quot;asset003&quot;, &quot;1000&quot;, &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;, &quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot;]&#125;&#x27; æŸ¥è¯¢èµ„äº§ 1peer chaincode query -C alljoinchannel -n supply -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27; ç»“æœå¦‚ä¸‹ï¼š 123456789101112[ &#123; &quot;ID&quot;: &quot;asset003&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;amount&quot;: 1000, &quot;createDate&quot;: &quot;2020-12-29T10:07:43.665003Z&quot;, &quot;endDate&quot;: &quot;2021-06-29T10:07:43.665003Z&quot;, &quot;contractHash&quot;: &quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;, &quot;invoiceHash&quot;: &quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot; &#125;] ä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†1äº¤æ˜“ 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAssetByID&quot;,&quot;Args&quot;:[&quot;asset003&quot;, &quot;äºŒçº§ä¾›åº”å•†1&quot;, &quot;500&quot;, &quot;76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a&quot;, &quot;792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49&quot;]&#125;&#x27; æŸ¥è¯¢èµ„äº§ 1peer chaincode query -C alljoinchannel -n supply -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27; ç»“æœå¦‚ä¸‹ï¼š 12345678910111213141516171819202122[ &#123; &quot;ID&quot;: &quot;asset003&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;amount&quot;: 500, &quot;createDate&quot;: &quot;2020-12-29T10:07:43.665003Z&quot;, &quot;endDate&quot;: &quot;2021-06-29T10:07:43.665003Z&quot;, &quot;contractHash&quot;: &quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;, &quot;invoiceHash&quot;: &quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot; &#125;, &#123; &quot;ID&quot;: &quot;asset0031&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;äºŒçº§ä¾›åº”å•†1&quot;, &quot;amount&quot;: 500, &quot;createDate&quot;: &quot;2020-12-29T10:12:37.227293Z&quot;, &quot;endDate&quot;: &quot;2021-06-29T10:12:37.227293Z&quot;, &quot;contractHash&quot;: &quot;76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a&quot;, &quot;invoiceHash&quot;: &quot;792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49&quot; &#125;] ä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†2äº¤æ˜“ 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAssetByID&quot;,&quot;Args&quot;:[&quot;asset003&quot;, &quot;äºŒçº§ä¾›åº”å•†2&quot;, &quot;300&quot;, &quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb&quot;, &quot;f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468&quot;]&#125;&#x27; é”™è¯¯ä¿¡æ¯è®°å½•ï¼š 1Error: endorsement failure during invoke. response: status:500 message:&quot;the asset asset0031 already exists&quot; åŸå› å¦‚ä¸‹ï¼šå¦‚æœåŒä¸€ä¸ªèµ„äº§IDäº¤æ˜“ä¸¤æ¬¡ï¼Œåˆ™ä¼šå‡ºç°èµ„äº§IDé‡å¤çš„é—®é¢˜ï¼›ä»£ç bugã€‚ 1err := s.CreateAssetAndSave(ctx, asset.ID+&quot;1&quot;, amount, asset.Issuer, newOwner, contractHash, invoiceHash) ä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†2äº¤æ˜“ 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAssetByID&quot;,&quot;Args&quot;:[&quot;asset0031&quot;, &quot;äºŒçº§ä¾›åº”å•†2&quot;, &quot;300&quot;, &quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb&quot;, &quot;f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468&quot;]&#125;&#x27; æŸ¥è¯¢èµ„äº§ï¼Œç»“æœå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132[ &#123; &quot;ID&quot;: &quot;asset003&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;amount&quot;: 500, &quot;createDate&quot;: &quot;2020-12-29T10:07:43.665003Z&quot;, &quot;endDate&quot;: &quot;2021-06-29T10:07:43.665003Z&quot;, &quot;contractHash&quot;: &quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;, &quot;invoiceHash&quot;: &quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot; &#125;, &#123; &quot;ID&quot;: &quot;asset0031&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;äºŒçº§ä¾›åº”å•†1&quot;, &quot;amount&quot;: 200, &quot;createDate&quot;: &quot;2020-12-29T10:12:37.227293Z&quot;, &quot;endDate&quot;: &quot;2021-06-29T10:12:37.227293Z&quot;, &quot;contractHash&quot;: &quot;76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a&quot;, &quot;invoiceHash&quot;: &quot;792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49&quot; &#125;, &#123; &quot;ID&quot;: &quot;asset00311&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;äºŒçº§ä¾›åº”å•†2&quot;, &quot;amount&quot;: 300, &quot;createDate&quot;: &quot;2020-12-29T10:17:26.148125Z&quot;, &quot;endDate&quot;: &quot;2021-06-29T10:17:26.148125Z&quot;, &quot;contractHash&quot;: &quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb&quot;, &quot;invoiceHash&quot;: &quot;f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468&quot; &#125;] éƒ¨ç½²supply-v8åˆ°alljoinchannelé€šé“ æºç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169package chaincodeimport ( &quot;encoding/json&quot; &quot;fmt&quot; &quot;time&quot; &quot;github.com/golang/protobuf/ptypes&quot; &quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot;)// SmartContract provides functions for managing an Assettype SmartContract struct &#123; contractapi.Contract&#125;// Asset describes basic details of what makes up a simple assettype Asset struct &#123; ID string `json:&quot;ID&quot;` Issuer string `json:&quot;issuer&quot;` Owner string `json:&quot;owner&quot;` Amount int64 `json:&quot;amount&quot;` CreateDate time.Time `json:&quot;createDate&quot;` EndDate time.Time `json:&quot;endDate&quot;` ContractHash string `json:&quot;contractHash&quot;` InvoiceHash string `json:&quot;invoiceHash&quot;`&#125;// IssueVoucher å‘è¡Œå‡­è¯func (s *SmartContract) IssueVoucher(ctx contractapi.TransactionContextInterface, assetID string, amount int64, owner string, contractHash string, invoiceHash string) error &#123; // åˆ›å»ºèµ„äº§ return s.CreateAssetAndSave(ctx, assetID, amount, &quot;æ ¸å¿ƒä¼ä¸š&quot;, owner, contractHash, invoiceHash)&#125;// CreateAssetAndSave åˆ›å»ºèµ„äº§å¹¶ä¿å­˜func (s *SmartContract) CreateAssetAndSave(ctx contractapi.TransactionContextInterface, id string, amount int64, issuerName string, owner string, contractHash string, invoiceHash string) error &#123; asset, err := s.createAsset(ctx, id, amount, issuerName, owner, contractHash, invoiceHash) if err != nil &#123; return err &#125; return s.PutState(ctx, asset)&#125;// createAsset issues a new asset to the world state with given details.func (s *SmartContract) createAsset(ctx contractapi.TransactionContextInterface, id string, amount int64, issuerName string, owner string, contractHash string, invoiceHash string) (*Asset, error) &#123; exists, err := s.AssetExists(ctx, id) if err != nil &#123; return nil, err &#125; if exists &#123; return nil, fmt.Errorf(&quot;the asset %s already exists&quot;, id) &#125; now, err := getNow(ctx) if err != nil &#123; return nil, err &#125; asset := Asset&#123;ID: id, Issuer: issuerName, Amount: amount, Owner: owner, CreateDate: now, EndDate: now.AddDate(0, 6, 0), ContractHash: contractHash, InvoiceHash: invoiceHash&#125; return &amp;asset, nil&#125;// è·å–å½“å‰æ—¶é—´func getNow(ctx contractapi.TransactionContextInterface) (time.Time, error) &#123; now, err := ctx.GetStub().GetTxTimestamp() if err != nil &#123; return time.Now(), err &#125; return ptypes.Timestamp(now)&#125;// ReadAsset returns the asset stored in the world state with given id.func (s *SmartContract) ReadAsset(ctx contractapi.TransactionContextInterface, id string) (*Asset, error) &#123; assetJSON, err := ctx.GetStub().GetState(id) if err != nil &#123; return nil, fmt.Errorf(&quot;failed to read from world state: %v&quot;, err) &#125; if assetJSON == nil &#123; return nil, fmt.Errorf(&quot;the asset %s does not exist&quot;, id) &#125; var asset Asset err = json.Unmarshal(assetJSON, &amp;asset) if err != nil &#123; return nil, err &#125; return &amp;asset, nil&#125;// AssetExists returns true when asset with given ID exists in world statefunc (s *SmartContract) AssetExists(ctx contractapi.TransactionContextInterface, id string) (bool, error) &#123; assetJSON, err := ctx.GetStub().GetState(id) if err != nil &#123; return false, fmt.Errorf(&quot;failed to read from world state: %v&quot;, err) &#125; return assetJSON != nil, nil&#125;// TransferAssetByID æ ¹æ®èµ„äº§IDè½¬è´¦func (s *SmartContract) TransferAssetByID(ctx contractapi.TransactionContextInterface, id string, newID string, newOwner string, amount int64, contractHash string, invoiceHash string) error &#123; asset, err := s.ReadAsset(ctx, id) if err != nil &#123; return err &#125; return s.TransferAsset(ctx, asset, newID, newOwner, amount, contractHash, invoiceHash)&#125;// TransferAsset updates the owner field of asset with given id in world state.func (s *SmartContract) TransferAsset(ctx contractapi.TransactionContextInterface, asset *Asset, newID string, newOwner string, amount int64, contractHash string, invoiceHash string) error &#123; // å¦‚æœé‡‘é¢åˆšå¥½ç­‰äºå‡­è¯èµ„äº§çš„é‡‘é¢ï¼Œç›´æ¥æ›´æ–°å‡­è¯èµ„äº§çš„æ‹¥æœ‰è€… if asset.Amount == amount &#123; asset.Owner = newOwner return s.PutState(ctx, asset) &#125; else if asset.Amount &gt; amount &#123; // å¦‚æœå‡­è¯èµ„äº§çš„é‡‘é¢å¤§äºè½¬è´¦çš„é‡‘é¢ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„äº§ if newID == &quot;&quot; &#123; return fmt.Errorf(&quot;è½¬è´¦é‡‘é¢å°äºèµ„äº§çš„é‡‘é¢æ—¶ï¼ŒnewIDå¿…é¡»ä¸èƒ½ä¸ºç©º&quot;) &#125; // åˆ›å»ºæ–°çš„èµ„äº§å¹¶ä¿å­˜ err := s.CreateAssetAndSave(ctx, newID, amount, asset.Issuer, newOwner, contractHash, invoiceHash) if err != nil &#123; return err &#125; // æ›´æ–°æ—§èµ„äº§çš„é‡‘é¢ asset.Amount = asset.Amount - amount return s.PutState(ctx, asset) &#125; else if asset.Amount &lt; amount &#123; // å¦‚æœèµ„äº§çš„é¢åº¦å°äºè¦è½¬è´¦çš„é‡‘é¢ï¼Œåˆ™ç›´æ¥æŠ¥é”™ return fmt.Errorf(&quot;è½¬è´¦é‡‘é¢=%d,ä¸èƒ½è¶…è¿‡èµ„äº§çš„é‡‘é¢=%d&quot;, amount, asset.Amount) &#125; return nil&#125;// PutState æ›´æ–°èµ„äº§func (s *SmartContract) PutState(ctx contractapi.TransactionContextInterface, asset *Asset) error &#123; assetJSON, err := json.Marshal(asset) if err != nil &#123; return err &#125; return ctx.GetStub().PutState(asset.ID, assetJSON)&#125;// GetAllAssets returns all assets found in world statefunc (s *SmartContract) GetAllAssets(ctx contractapi.TransactionContextInterface) ([]*Asset, error) &#123; // range query with empty string for startKey and endKey does an // open-ended query of all assets in the chaincode namespace. resultsIterator, err := ctx.GetStub().GetStateByRange(&quot;&quot;, &quot;&quot;) if err != nil &#123; return nil, err &#125; defer resultsIterator.Close() var assets []*Asset for resultsIterator.HasNext() &#123; queryResponse, err := resultsIterator.Next() if err != nil &#123; return nil, err &#125; var asset Asset err = json.Unmarshal(queryResponse.Value, &amp;asset) if err != nil &#123; return nil, err &#125; assets = append(assets, &amp;asset) &#125; return assets, nil&#125; æ‰“åŒ… 1peer lifecycle chaincode package supply.8.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/chaincode-go/ --lang golang --label supply_8.0 å®‰è£…é“¾ç åŒ… æ¯ä¸ªpeeréƒ½è¦å®‰è£…ï¼špeer lifecycle chaincode install supply.8.tar.gz æ‰¹å‡†é“¾ç å®šä¹‰ æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode 1peer lifecycle chaincode queryinstalled å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ï¼Œä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦å®šä¹‰æ­¤å˜é‡ï¼š 1export CC_PACKAGE_ID=supply_8.0:797ec1d00145482b746640d0b8bb9bea64cb69dea3e95abb69a1195a19e34511 æ‰¹å‡†é“¾ç å®šä¹‰ æ¯ä¸ªpeeréƒ½è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š 1peer lifecycle chaincode approveformyorg -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name supply --version 8.0 --package-id $CC_PACKAGE_ID --sequence 2 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š 1peer lifecycle chaincode checkcommitreadiness --channelID alljoinchannel --name supply --version 8.0 --sequence 2 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json åœ¨æ‰€æœ‰ç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š 1peer lifecycle chaincode commit -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name supply --version 8.0 --sequence 2 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt ä½¿ç”¨ peer lifecycle chaincode querycommitted å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚ 1peer lifecycle chaincode querycommitted --channelID alljoinchannel --name supply --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem è°ƒç”¨é“¾ç  è°ƒç”¨é“¾ç ä¹‹å‰å…ˆç”Ÿæˆæµ‹è¯•çš„åˆåŒhashå€¼å’Œå‘ç¥¨hashå€¼å¦‚ä¸‹ï¼š 12345683c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9 CORE_AND_F1_INVOICE.txt93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14 CORE_AND_F1_CONTRACT.txt76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a f1_and_s1_contract.txt792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49 f1_and_s1_invoice.txtf46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb f1_and_s2_contract.txtf807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468 f1_and_s2_invoice.txt å‘è¡Œå‡­è¯ 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;IssueVoucher&quot;,&quot;Args&quot;:[&quot;asset001&quot;, &quot;1000&quot;, &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;, &quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot;]&#125;&#x27; æŸ¥è¯¢èµ„äº§ 1peer chaincode query -C alljoinchannel -n supply -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27; ç»“æœå¦‚ä¸‹ï¼š 123456789101112[ &#123; &quot;ID&quot;: &quot;asset001&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;amount&quot;: 1000, &quot;createDate&quot;: &quot;2020-12-30T06:57:06.963617Z&quot;, &quot;endDate&quot;: &quot;2021-06-30T06:57:06.963617Z&quot;, &quot;contractHash&quot;: &quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;, &quot;invoiceHash&quot;: &quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot; &#125;] ä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†1äº¤æ˜“ 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAssetByID&quot;,&quot;Args&quot;:[&quot;asset001&quot;, &quot;asset0011&quot;, &quot;äºŒçº§ä¾›åº”å•†1&quot;, &quot;500&quot;, &quot;76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a&quot;, &quot;792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49&quot;]&#125;&#x27; æŸ¥è¯¢èµ„äº§ 1peer chaincode query -C alljoinchannel -n supply -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27; ç»“æœå¦‚ä¸‹ï¼š 12345678910111213141516171819202122[ &#123; &quot;ID&quot;: &quot;asset001&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;amount&quot;: 500, &quot;createDate&quot;: &quot;2020-12-30T06:57:06.963617Z&quot;, &quot;endDate&quot;: &quot;2021-06-30T06:57:06.963617Z&quot;, &quot;contractHash&quot;: &quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;, &quot;invoiceHash&quot;: &quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot; &#125;, &#123; &quot;ID&quot;: &quot;asset0011&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;äºŒçº§ä¾›åº”å•†1&quot;, &quot;amount&quot;: 500, &quot;createDate&quot;: &quot;2020-12-30T06:57:50.047189Z&quot;, &quot;endDate&quot;: &quot;2021-06-30T06:57:50.047189Z&quot;, &quot;contractHash&quot;: &quot;76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a&quot;, &quot;invoiceHash&quot;: &quot;792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49&quot; &#125;] ä¸€çº§ä¾›åº”å•†ä¸äºŒçº§ä¾›åº”å•†2äº¤æ˜“ 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAssetByID&quot;,&quot;Args&quot;:[&quot;asset001&quot;, &quot;asset0012&quot;, &quot;äºŒçº§ä¾›åº”å•†2&quot;, &quot;300&quot;, &quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb&quot;, &quot;f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468&quot;]&#125;&#x27; æŸ¥è¯¢èµ„äº§ï¼Œç»“æœå¦‚ä¸‹peer chaincode query -C alljoinchannel -n supply -c '&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;'ï¼š 1234567891011121314151617181920212223242526272829303132[ &#123; &quot;ID&quot;: &quot;asset001&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;ä¸€çº§ä¾›åº”å•†&quot;, &quot;amount&quot;: 200, &quot;createDate&quot;: &quot;2020-12-30T06:57:06.963617Z&quot;, &quot;endDate&quot;: &quot;2021-06-30T06:57:06.963617Z&quot;, &quot;contractHash&quot;: &quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;, &quot;invoiceHash&quot;: &quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot; &#125;, &#123; &quot;ID&quot;: &quot;asset0011&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;äºŒçº§ä¾›åº”å•†1&quot;, &quot;amount&quot;: 500, &quot;createDate&quot;: &quot;2020-12-30T06:57:50.047189Z&quot;, &quot;endDate&quot;: &quot;2021-06-30T06:57:50.047189Z&quot;, &quot;contractHash&quot;: &quot;76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a&quot;, &quot;invoiceHash&quot;: &quot;792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49&quot; &#125;, &#123; &quot;ID&quot;: &quot;asset0012&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;äºŒçº§ä¾›åº”å•†2&quot;, &quot;amount&quot;: 300, &quot;createDate&quot;: &quot;2020-12-30T06:58:33.143818Z&quot;, &quot;endDate&quot;: &quot;2021-06-30T06:58:33.143818Z&quot;, &quot;contractHash&quot;: &quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb&quot;, &quot;invoiceHash&quot;: &quot;f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468&quot; &#125;] è½¬è´¦é‡‘é¢å¤§äºå‡­è¯èµ„äº§çš„é‡‘é¢(æœŸå¾…é”™è¯¯) å‡ºç°é”™è¯¯ï¼š 12(base) w:supply-finance apple$ peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAssetByID&quot;,&quot;Args&quot;:[&quot;asset001&quot;, &quot;asset0013&quot;, &quot;äºŒçº§ä¾›åº”å•†2&quot;, &quot;300&quot;, &quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb&quot;, &quot;f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468&quot;]&#125;&#x27;Error: endorsement failure during invoke. response: status:500 message:&quot;\\350\\275\\254\\350\\264\\246\\351\\207\\221\\351\\242\\235=300,\\344\\270\\215\\350\\203\\275\\350\\266\\205\\350\\277\\207\\350\\265\\204\\344\\272\\247\\347\\232\\204\\351\\207\\221\\351\\242\\235=200&quot; é”™è¯¯ä¿¡æ¯è§£ç å¦‚ä¸‹ï¼š è½¬è´¦é‡‘é¢ç­‰äºå‡­è¯èµ„äº§çš„é‡‘é¢ï¼ˆå˜æ›´ownerï¼Œä¸äº§ç”Ÿæ–°çš„å‡­è¯èµ„äº§ï¼‰ ä¸€çº§ä¾›åº”å•†æŠŠå‰©ä½™çš„200è½¬ç»™äºŒçº§ä¾›åº”å•†2: 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;&#x2F;organizations&#x2F;ordererOrganizations&#x2F;supply.com&#x2F;orderers&#x2F;orderer.supply.com&#x2F;msp&#x2F;tlscacerts&#x2F;tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;&#x2F;organizations&#x2F;peerOrganizations&#x2F;f1.supply.com&#x2F;peers&#x2F;peer0.f1.supply.com&#x2F;tls&#x2F;ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;&#x2F;organizations&#x2F;peerOrganizations&#x2F;s1.supply.com&#x2F;peers&#x2F;peer0.s1.supply.com&#x2F;tls&#x2F;ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;&#x2F;organizations&#x2F;peerOrganizations&#x2F;s2.supply.com&#x2F;peers&#x2F;peer0.s2.supply.com&#x2F;tls&#x2F;ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;&#x2F;organizations&#x2F;peerOrganizations&#x2F;core.supply.com&#x2F;peers&#x2F;peer0.core.supply.com&#x2F;tls&#x2F;ca.crt -c &#39;&#123;&quot;function&quot;:&quot;TransferAssetByID&quot;,&quot;Args&quot;:[&quot;asset001&quot;, &quot;asset0013&quot;, &quot;äºŒçº§ä¾›åº”å•†2&quot;, &quot;200&quot;, &quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb&quot;, &quot;f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468&quot;]&#125;&#39; æŸ¥è¯¢èµ„äº§ï¼Œç»“æœå¦‚ä¸‹peer chaincode query -C alljoinchannel -n supply -c '&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;'ï¼š 1234567891011121314151617181920212223242526272829303132[ &#123; &quot;ID&quot;: &quot;asset001&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;äºŒçº§ä¾›åº”å•†2&quot;, &quot;amount&quot;: 200, &quot;createDate&quot;: &quot;2020-12-30T06:57:06.963617Z&quot;, &quot;endDate&quot;: &quot;2021-06-30T06:57:06.963617Z&quot;, &quot;contractHash&quot;: &quot;93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14&quot;, &quot;invoiceHash&quot;: &quot;83c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9&quot; &#125;, &#123; &quot;ID&quot;: &quot;asset0011&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;äºŒçº§ä¾›åº”å•†1&quot;, &quot;amount&quot;: 500, &quot;createDate&quot;: &quot;2020-12-30T06:57:50.047189Z&quot;, &quot;endDate&quot;: &quot;2021-06-30T06:57:50.047189Z&quot;, &quot;contractHash&quot;: &quot;76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a&quot;, &quot;invoiceHash&quot;: &quot;792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49&quot; &#125;, &#123; &quot;ID&quot;: &quot;asset0012&quot;, &quot;issuer&quot;: &quot;æ ¸å¿ƒä¼ä¸š&quot;, &quot;owner&quot;: &quot;äºŒçº§ä¾›åº”å•†2&quot;, &quot;amount&quot;: 300, &quot;createDate&quot;: &quot;2020-12-30T06:58:33.143818Z&quot;, &quot;endDate&quot;: &quot;2021-06-30T06:58:33.143818Z&quot;, &quot;contractHash&quot;: &quot;f46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb&quot;, &quot;invoiceHash&quot;: &quot;f807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468&quot; &#125;] æ²¡æœ‰äº§ç”Ÿæ–°çš„èµ„äº§ï¼Œè€Œæ˜¯æŠŠåŸæ¥çš„èµ„äº§çš„æ‹¥æœ‰è€…å˜æ›´äº†ã€‚ æ³¨æ„ï¼šè¿™æ ·æœ‰ä¸ªé—®é¢˜ï¼ŒåˆåŒhashå’Œå‘ç¥¨hashä¸åº”è¯¥è¿˜æ˜¯åŸæ¥çš„ã€‚ éƒ¨ç½²supply-v9åˆ°alljoinchannelé€šé“ æºç  ä¸v8ç‰ˆæœ¬ç›¸æ¯”ï¼Œå¢åŠ åˆ é™¤èµ„äº§çš„æ–¹æ³• 123456789101112131415// DelState åˆ é™¤èµ„äº§func (s *SmartContract) DelState(ctx contractapi.TransactionContextInterface, assetIds ...string) error &#123; for _, assetID := range assetIds &#123; exists, err := s.AssetExists(ctx, assetID) if err != nil &#123; return nil &#125; if !exists &#123; return fmt.Errorf(&quot;assetID=%sçš„èµ„äº§ä¸å­˜åœ¨&quot;, assetID) &#125; return ctx.GetStub().DelState(assetID) &#125; return nil&#125; æ‰“åŒ… 1peer lifecycle chaincode package supply.18.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/supply-finance-chaincode/ --lang golang --label secured_supply_22.0 å®‰è£…é“¾ç åŒ… æ¯ä¸ªpeeréƒ½è¦å®‰è£…ï¼špeer lifecycle chaincode install supply.18.tar.gz æ‰¹å‡†é“¾ç å®šä¹‰ æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode 1peer lifecycle chaincode queryinstalled å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ï¼Œä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦å®šä¹‰æ­¤å˜é‡ï¼š 1export CC_PACKAGE_ID=secured_supply_22.0:e815ca2d270dea029bc6992952140b1288a440aba8c430853f72eee7d5de24a7 æ‰¹å‡†é“¾ç å®šä¹‰ æ¯ä¸ªpeeréƒ½è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š 1peer lifecycle chaincode approveformyorg -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name secured_supply --version 22.0 --package-id $CC_PACKAGE_ID --sequence 22 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š 1peer lifecycle chaincode checkcommitreadiness --channelID alljoinchannel --name secured_supply --version 22.0 --sequence 22 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json åœ¨æ‰€æœ‰ç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š 1peer lifecycle chaincode commit -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name secured_supply --version 22.0 --sequence 22 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt ä½¿ç”¨ peer lifecycle chaincode querycommitted å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚ 1peer lifecycle chaincode querycommitted --channelID alljoinchannel --name secured_supply --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem è°ƒç”¨é“¾ç  è°ƒç”¨é“¾ç ä¹‹å‰å…ˆç”Ÿæˆæµ‹è¯•çš„åˆåŒhashå€¼å’Œå‘ç¥¨hashå€¼å¦‚ä¸‹ï¼š 12345683c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9 CORE_AND_F1_INVOICE.txt93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14 CORE_AND_F1_CONTRACT.txt76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a f1_and_s1_contract.txt792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49 f1_and_s1_invoice.txtf46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb f1_and_s2_contract.txtf807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468 f1_and_s2_invoice.txt åˆ é™¤èµ„äº§ 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;DelState&quot;,&quot;Args&quot;:[&quot;asset001 asset0011 asset0012 asset003 asset0031 asset00311&quot;]&#125;&#x27; é”™è¯¯ä¿¡æ¯è®°å½•ï¼š 12(base) w:supply-finance apple$ peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;DelState&quot;,&quot;Args&quot;:[&quot;asset001 asset0011 asset0012 asset003 asset0031 asset00311&quot;]&#125;&#x27;Error: endorsement failure during invoke. response: status:500 message:&quot;Error managing parameter param0. Conversion error. Value asset001 asset0011 asset0012 asset003 asset0031 asset00311 was not passed in expected format []string&quot; **é”™è¯¯åŸå› ï¼š**å› ä¸ºæ–¹æ³•ä½¿ç”¨çš„æ˜¯å¯å˜é•¿å‚æ•°ï¼Œä½†æ˜¯ä¸çŸ¥é“è¯¥æ€ä¹ˆç»™ä»–ä¼ å‚æ•° éƒ¨ç½²supply-v9.1åˆ°alljoinchannelé€šé“ æºç  ä¸v9ç‰ˆæœ¬ç›¸æ¯”ï¼Œä¿®æ”¹åˆ é™¤èµ„äº§çš„æ–¹æ³•ä¸ºåˆ é™¤å•ä¸ªèµ„äº§ 1234567891011// DelState åˆ é™¤èµ„äº§func (s *SmartContract) DelState(ctx contractapi.TransactionContextInterface, assetID string) error &#123; exists, err := s.AssetExists(ctx, assetID) if err != nil &#123; return nil &#125; if !exists &#123; return fmt.Errorf(&quot;assetID=%sçš„èµ„äº§ä¸å­˜åœ¨&quot;, assetID) &#125; return ctx.GetStub().DelState(assetID)&#125; æ‰“åŒ… 1peer lifecycle chaincode package supply.9.1.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/chaincode-go/ --lang golang --label supply_9.1 å®‰è£…é“¾ç åŒ… æ¯ä¸ªpeeréƒ½è¦å®‰è£…ï¼špeer lifecycle chaincode install supply.9.1.tar.gz æ‰¹å‡†é“¾ç å®šä¹‰ æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode 1peer lifecycle chaincode queryinstalled å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ï¼Œä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦å®šä¹‰æ­¤å˜é‡ï¼š 1export CC_PACKAGE_ID=supply_9.1:f733e8484c17cb415e38ac1fb14ed646622f2980762906c97d6e7e1c1a90f2c3 æ‰¹å‡†é“¾ç å®šä¹‰ æ¯ä¸ªpeeréƒ½è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š 1peer lifecycle chaincode approveformyorg -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name supply --version 9.1 --package-id $CC_PACKAGE_ID --sequence 4 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š 1peer lifecycle chaincode checkcommitreadiness --channelID alljoinchannel --name supply --version 9.1 --sequence 4 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json åœ¨æ‰€æœ‰ç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š 1peer lifecycle chaincode commit -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID alljoinchannel --name supply --version 9.1 --sequence 4 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt ä½¿ç”¨ peer lifecycle chaincode querycommitted å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚ 1peer lifecycle chaincode querycommitted --channelID alljoinchannel --name supply --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem è°ƒç”¨é“¾ç  è°ƒç”¨é“¾ç ä¹‹å‰å…ˆç”Ÿæˆæµ‹è¯•çš„åˆåŒhashå€¼å’Œå‘ç¥¨hashå€¼å¦‚ä¸‹ï¼š 12345683c02ac2d48c863dab2ccf6870455aadfc2cec073b8db269b517c879d76aa6d9 CORE_AND_F1_INVOICE.txt93b46869be90a6b1f688357965f89b5a8a5e32bf13710fb4ad00e25cca0f0b14 CORE_AND_F1_CONTRACT.txt76307cd9d79c76a2a7894677692ce421ff1a31e32717a7de6f07deb5de395e7a f1_and_s1_contract.txt792376c209f338959be4cf00c54dbf82662b90516082e23106faec4c43c69e49 f1_and_s1_invoice.txtf46555b7ddd1f8dd232bdc0dcbc5b1f34bdf1d4bb7c123a79a6ed628175f29bb f1_and_s2_contract.txtf807fe6dc767be2e7021d41540114b33b30fa7784f6de5521251f23a3eb66468 f1_and_s2_invoice.txt åˆ é™¤èµ„äº§ èµ„äº§IDåˆ—è¡¨ï¼šâ€œasset001 asset0011 asset0012 asset003 asset0031 asset00311â€ 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;DelState&quot;,&quot;Args&quot;:[&quot;asset00311&quot;]&#125;&#x27; åˆ é™¤ä¹‹åæŸ¥è¯¢ï¼š 1peer chaincode query -C alljoinchannel -n supply -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27; è¿”å›çš„èµ„äº§åˆ—è¡¨ä¸ºç©ºï¼Œåˆ é™¤æ–¹æ³•éªŒè¯æˆåŠŸã€‚ 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;Practice_SmartContract:InitLedger&quot;,&quot;Args&quot;:[]&#125;&#x27; 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt --peerAddresses localhost:8055 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crt --peerAddresses localhost:8151 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crt --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;Practice_SmartContract:SomeStubMethod&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; 1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C alljoinchannel -n secured_supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;Practice_SmartContract:InitLedger&quot;,&quot;Args&quot;:[]&#125;&#x27;","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"ä¾›åº”é“¾é‡‘è","slug":"åŒºå—é“¾/Hyperledger-Fabric/ä¾›åº”é“¾é‡‘è","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"peer","slug":"peer","permalink":"https://guozhe001.github.io/tags/peer/"},{"name":"ä¾›åº”é“¾é‡‘è","slug":"ä¾›åº”é“¾é‡‘è","permalink":"https://guozhe001.github.io/tags/%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D/"},{"name":"chaincode","slug":"chaincode","permalink":"https://guozhe001.github.io/tags/chaincode/"}]},{"title":"å¼€å‘æ™ºèƒ½åˆçº¦","slug":"blockchain/fabric/é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric/å¼€å‘æ™ºèƒ½åˆçº¦","date":"2021-04-01T10:18:21.497Z","updated":"2021-04-01T10:18:21.497Z","comments":true,"path":"2021/04/01/blockchain/fabric/é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric/å¼€å‘æ™ºèƒ½åˆçº¦/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E5%BC%80%E5%8F%91%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/","excerpt":"","text":"å¼€å‘æ™ºèƒ½åˆçº¦ æœ¬æ¬¡çš„æ™ºèƒ½åˆçº¦ä»fabric-samplesçš„asset-transfer-basic/chaincode-goæ‹·è´ç„¶åè¿›è¡Œäº†ä¿®æ”¹ã€‚ æ™ºèƒ½åˆçº¦ä»£ç smartcontract.goå¦‚ä¸‹ï¼šæœ¬æ–‡æ¡£æ›´æ–°ä¸åŠæ—¶ï¼Œå¯åˆ°æºç åœ°å€æŸ¥çœ‹ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181package chaincodeimport ( &quot;encoding/json&quot; &quot;fmt&quot; &quot;time&quot; &quot;github.com/golang/protobuf/ptypes&quot; &quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot;)// SmartContract provides functions for managing an Assettype SmartContract struct &#123; contractapi.Contract&#125;// Asset describes basic details of what makes up a simple assettype Asset struct &#123; ID string `json:&quot;ID&quot;` Issuer string `json:&quot;issuer&quot;` Owner string `json:&quot;owner&quot;` Amount int64 `json:&quot;amount&quot;` CreateDate time.Time `json:&quot;createDate&quot;` EndDate time.Time `json:&quot;endDate&quot;` ContractHash string `json:&quot;contractHash&quot;` InvoiceHash string `json:&quot;invoiceHash&quot;`&#125;// IssueVoucher å‘è¡Œå‡­è¯func (s *SmartContract) IssueVoucher(ctx contractapi.TransactionContextInterface, assetID string, amount int64, owner string, contractHash string, invoiceHash string) error &#123; // åˆ›å»ºèµ„äº§ return s.CreateAssetAndSave(ctx, assetID, amount, &quot;æ ¸å¿ƒä¼ä¸š&quot;, owner, contractHash, invoiceHash)&#125;// CreateAssetAndSave åˆ›å»ºèµ„äº§å¹¶ä¿å­˜func (s *SmartContract) CreateAssetAndSave(ctx contractapi.TransactionContextInterface, id string, amount int64, issuerName string, owner string, contractHash string, invoiceHash string) error &#123; asset, err := s.createAsset(ctx, id, amount, issuerName, owner, contractHash, invoiceHash) if err != nil &#123; return err &#125; return s.PutState(ctx, asset)&#125;// createAsset issues a new asset to the world state with given details.func (s *SmartContract) createAsset(ctx contractapi.TransactionContextInterface, id string, amount int64, issuerName string, owner string, contractHash string, invoiceHash string) (*Asset, error) &#123; exists, err := s.AssetExists(ctx, id) if err != nil &#123; return nil, err &#125; if exists &#123; return nil, fmt.Errorf(&quot;the asset %s already exists&quot;, id) &#125; now, err := getNow(ctx) if err != nil &#123; return nil, err &#125; asset := Asset&#123;ID: id, Issuer: issuerName, Amount: amount, Owner: owner, CreateDate: now, EndDate: now.AddDate(0, 6, 0), ContractHash: contractHash, InvoiceHash: invoiceHash&#125; return &amp;asset, nil&#125;// è·å–å½“å‰æ—¶é—´func getNow(ctx contractapi.TransactionContextInterface) (time.Time, error) &#123; now, err := ctx.GetStub().GetTxTimestamp() if err != nil &#123; return time.Now(), err &#125; return ptypes.Timestamp(now)&#125;// ReadAsset returns the asset stored in the world state with given id.func (s *SmartContract) ReadAsset(ctx contractapi.TransactionContextInterface, id string) (*Asset, error) &#123; assetJSON, err := ctx.GetStub().GetState(id) if err != nil &#123; return nil, fmt.Errorf(&quot;failed to read from world state: %v&quot;, err) &#125; if assetJSON == nil &#123; return nil, fmt.Errorf(&quot;the asset %s does not exist&quot;, id) &#125; var asset Asset err = json.Unmarshal(assetJSON, &amp;asset) if err != nil &#123; return nil, err &#125; return &amp;asset, nil&#125;// AssetExists returns true when asset with given ID exists in world statefunc (s *SmartContract) AssetExists(ctx contractapi.TransactionContextInterface, id string) (bool, error) &#123; assetJSON, err := ctx.GetStub().GetState(id) if err != nil &#123; return false, fmt.Errorf(&quot;failed to read from world state: %v&quot;, err) &#125; return assetJSON != nil, nil&#125;// TransferAssetByID æ ¹æ®èµ„äº§IDè½¬è´¦func (s *SmartContract) TransferAssetByID(ctx contractapi.TransactionContextInterface, id string, newID string, newOwner string, amount int64, contractHash string, invoiceHash string) error &#123; asset, err := s.ReadAsset(ctx, id) if err != nil &#123; return err &#125; return s.TransferAsset(ctx, asset, newID, newOwner, amount, contractHash, invoiceHash)&#125;// TransferAsset updates the owner field of asset with given id in world state.func (s *SmartContract) TransferAsset(ctx contractapi.TransactionContextInterface, asset *Asset, newID string, newOwner string, amount int64, contractHash string, invoiceHash string) error &#123; // å¦‚æœé‡‘é¢åˆšå¥½ç­‰äºå‡­è¯èµ„äº§çš„é‡‘é¢ï¼Œç›´æ¥æ›´æ–°å‡­è¯èµ„äº§çš„æ‹¥æœ‰è€… if asset.Amount == amount &#123; asset.Owner = newOwner return s.PutState(ctx, asset) &#125; else if asset.Amount &gt; amount &#123; // å¦‚æœå‡­è¯èµ„äº§çš„é‡‘é¢å¤§äºè½¬è´¦çš„é‡‘é¢ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„äº§ if newID == &quot;&quot; &#123; return fmt.Errorf(&quot;è½¬è´¦é‡‘é¢å°äºèµ„äº§çš„é‡‘é¢æ—¶ï¼ŒnewIDå¿…é¡»ä¸èƒ½ä¸ºç©º&quot;) &#125; // åˆ›å»ºæ–°çš„èµ„äº§å¹¶ä¿å­˜ err := s.CreateAssetAndSave(ctx, newID, amount, asset.Issuer, newOwner, contractHash, invoiceHash) if err != nil &#123; return err &#125; // æ›´æ–°æ—§èµ„äº§çš„é‡‘é¢ asset.Amount = asset.Amount - amount return s.PutState(ctx, asset) &#125; else if asset.Amount &lt; amount &#123; // å¦‚æœèµ„äº§çš„é¢åº¦å°äºè¦è½¬è´¦çš„é‡‘é¢ï¼Œåˆ™ç›´æ¥æŠ¥é”™ return fmt.Errorf(&quot;è½¬è´¦é‡‘é¢=%d,ä¸èƒ½è¶…è¿‡èµ„äº§çš„é‡‘é¢=%d&quot;, amount, asset.Amount) &#125; return nil&#125;// PutState æ›´æ–°èµ„äº§func (s *SmartContract) PutState(ctx contractapi.TransactionContextInterface, asset *Asset) error &#123; assetJSON, err := json.Marshal(asset) if err != nil &#123; return err &#125; return ctx.GetStub().PutState(asset.ID, assetJSON)&#125;// DelState åˆ é™¤èµ„äº§func (s *SmartContract) DelState(ctx contractapi.TransactionContextInterface, assetID string) error &#123; exists, err := s.AssetExists(ctx, assetID) if err != nil &#123; return nil &#125; if !exists &#123; return fmt.Errorf(&quot;assetID=%sçš„èµ„äº§ä¸å­˜åœ¨&quot;, assetID) &#125; return ctx.GetStub().DelState(assetID)&#125;// GetAllAssets returns all assets found in world statefunc (s *SmartContract) GetAllAssets(ctx contractapi.TransactionContextInterface) ([]*Asset, error) &#123; // range query with empty string for startKey and endKey does an // open-ended query of all assets in the chaincode namespace. resultsIterator, err := ctx.GetStub().GetStateByRange(&quot;&quot;, &quot;&quot;) if err != nil &#123; return nil, err &#125; defer resultsIterator.Close() var assets []*Asset for resultsIterator.HasNext() &#123; queryResponse, err := resultsIterator.Next() if err != nil &#123; return nil, err &#125; var asset Asset err = json.Unmarshal(queryResponse.Value, &amp;asset) if err != nil &#123; return nil, err &#125; assets = append(assets, &amp;asset) &#125; return assets, nil&#125;","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"ä¾›åº”é“¾é‡‘è","slug":"åŒºå—é“¾/Hyperledger-Fabric/ä¾›åº”é“¾é‡‘è","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"ä¾›åº”é“¾é‡‘è","slug":"ä¾›åº”é“¾é‡‘è","permalink":"https://guozhe001.github.io/tags/%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D/"}]},{"title":"ç¯å¢ƒå˜é‡è®¾ç½®","slug":"blockchain/fabric/é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric/è®¾ç½®ç¯å¢ƒå˜é‡","date":"2021-04-01T10:18:21.497Z","updated":"2021-04-01T10:18:21.498Z","comments":true,"path":"2021/04/01/blockchain/fabric/é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric/è®¾ç½®ç¯å¢ƒå˜é‡/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/","excerpt":"","text":"ä»¥ä¸‹æ‰€æœ‰çš„å‘½ä»¤å‡åœ¨supply-financeç›®å½•ä¸‹æ‰§è¡Œ ç¯å¢ƒå˜é‡è®¾ç½®ï¼š 123export PATH=$&#123;PWD&#125;/bin:$PATHexport FABRIC_CFG_PATH=$&#123;PWD&#125;/configconfigtxgen --help æ ¸å¿ƒä¼ä¸šGylCoreOrg1MSP,Adminï¼š 12345export CORE_PEER_TLS_ENABLED=trueexport CORE_PEER_LOCALMSPID=&quot;GylCoreOrg1MSP&quot;export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crtexport CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/users/Admin@core.supply.com/mspexport CORE_PEER_ADDRESS=localhost:8051 ä¸€çº§ä¾›åº”å•†GylFOrg1MSP,Adminï¼š 12345export CORE_PEER_TLS_ENABLED=trueexport CORE_PEER_LOCALMSPID=&quot;GylFOrg1MSP&quot;export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crtexport CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/users/Admin@f1.supply.com/mspexport CORE_PEER_ADDRESS=localhost:8053 äºŒçº§ä¾›åº”å•†1GylSOrg1MSP,Adminï¼š 12345export CORE_PEER_TLS_ENABLED=trueexport CORE_PEER_LOCALMSPID=&quot;GylSOrg1MSP&quot;export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls/ca.crtexport CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/s1.supply.com/users/Admin@s1.supply.com/mspexport CORE_PEER_ADDRESS=localhost:8055 äºŒçº§ä¾›åº”å•†2GylSOrg2MSP,Adminï¼š 12345export CORE_PEER_TLS_ENABLED=trueexport CORE_PEER_LOCALMSPID=&quot;GylSOrg2MSP&quot;export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls/ca.crtexport CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/s2.supply.com/users/Admin@s2.supply.com/mspexport CORE_PEER_ADDRESS=localhost:8151","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"ä¾›åº”é“¾é‡‘è","slug":"åŒºå—é“¾/Hyperledger-Fabric/ä¾›åº”é“¾é‡‘è","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"peer","slug":"peer","permalink":"https://guozhe001.github.io/tags/peer/"},{"name":"ä¾›åº”é“¾é‡‘è","slug":"ä¾›åº”é“¾é‡‘è","permalink":"https://guozhe001.github.io/tags/%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D/"}]},{"title":"åˆ›å»ºç½‘ç»œ","slug":"blockchain/fabric/é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric/åˆ›å»ºç½‘ç»œ","date":"2021-04-01T10:18:21.496Z","updated":"2021-04-01T10:18:21.497Z","comments":true,"path":"2021/04/01/blockchain/fabric/é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric/åˆ›å»ºç½‘ç»œ/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E5%88%9B%E5%BB%BA%E7%BD%91%E7%BB%9C/","excerpt":"","text":"åˆ›å»ºç½‘ç»œ ä¸€ä¸ªç”Ÿäº§çš„fabricç½‘ç»œåº”è¯¥ç”±å„ä¸ªç»„ç»‡è‡ªå·±ä¿å­˜è‡ªå·±çš„åŠ å¯†ææ–™ï¼Œæµ‹è¯•ç¯å¢ƒä¸ºäº†æ¼”ç¤ºåœ¨æœ¬åœ°ç”Ÿæˆæ‰€æœ‰ç»„ç»‡çš„åŠ å¯†ææ–™ã€‚ ç”ŸæˆåŠ å¯†ææ–™ åˆ›å»ºé…ç½®æ–‡ä»¶ åˆ›å»ºsupply-financeæ–‡ä»¶å¤¹ï¼Œé…ç½®config/crypto-config.yamlæ–‡ä»¶ï¼š 123456789101112131415161718192021222324252627282930OrdererOrgs: - Name: Orderer Domain: supply.com Specs: - Hostname: ordererPeerOrgs: - Name: gyl_core_org1 Domain: core.supply.com Template: Count: 1 Users: Count: 2 - Name: gyl_f_org1 Domain: f1.supply.com Template: Count: 1 Users: Count: 2 - Name: gyl_s_org1 Domain: s1.supply.com Template: Count: 1 Users: Count: 2 - Name: gyl_s_org2 Domain: s2.supply.com Template: Count: 1 Users: Count: 2 ä½¿ç”¨é…ç½®æ–‡ä»¶ç”ŸæˆåŠ å¯†ææ–™ ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ç”ŸæˆåŠ å¯†ææ–™ï¼š 1cryptogen generate --config=config/crypto-config.yaml --output=&quot;./organizations&quot; ä½¿ç”¨åŠ å¯†ææ–™ç”Ÿæˆåˆ›ä¸–çºªåŒºå— ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ç”Ÿæˆç³»ç»Ÿåˆ›ä¸–çºªåŒºå—ï¼š 1configtxgen -profile TestOrgsOrdererGenesis -channelID system-channel -outputBlock ./system-genesis-block/genesis.block è¾“å‡ºç»“æœï¼š 12345678esis.block2020-12-24 15:41:52.702 CST [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration2020-12-24 15:41:52.716 CST [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 002 orderer type: etcdraft2020-12-24 15:41:52.716 CST [common.tools.configtxgen.localconfig] completeInitialization -&gt; INFO 003 Orderer.EtcdRaft.Options unset, setting to tick_interval:&quot;500ms&quot; election_tick:10 heartbeat_tick:1 max_inflight_blocks:5 snapshot_interval_size:167772162020-12-24 15:41:52.716 CST [common.tools.configtxgen.localconfig] Load -&gt; INFO 004 Loaded configuration: /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/config/configtx.yaml2020-12-24 15:41:52.723 CST [common.tools.configtxgen] doOutputBlock -&gt; INFO 005 Generating genesis block2020-12-24 15:41:52.723 CST [common.tools.configtxgen] doOutputBlock -&gt; INFO 006 Creating system channel genesis block2020-12-24 15:41:52.724 CST [common.tools.configtxgen] doOutputBlock -&gt; INFO 007 Writing genesis block é‡åˆ°çš„é”™è¯¯ä¿¡æ¯ï¼š 12020-12-24 15:39:28.696 CST [common.tools.configtxgen] main -&gt; FATA 005 Error on outputBlock: could not create bootstrapper: could not create channel group: could not create orderer group: cannot marshal metadata for orderer type etcdraft: cannot load client cert for consenter orderer.supply.com:8050: open /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/cryptogen/crypto-config/ordererOrganizations/supply.com/orderers/orderer.supply.com/tls/server.crt: no such file or directory é”™è¯¯åŸå› ï¼š$FABRIC_CFG_PATH/configtx.yamlé…ç½®çš„åŠ å¯†æ–‡ä»¶åœ°å€ä¸æ­£ç¡® å¯åŠ¨ç½‘ç»œ å„ä¸ªç»„ç»‡çš„åŠ å¯†ææ–™ç”Ÿæˆä¹‹åï¼Œåœ¨æœ¬åœ°dockerç¯å¢ƒå¯åŠ¨è¿™äº›ç»„ç»‡çš„peerèŠ‚ç‚¹ã€‚ é…ç½®docker-compose.ymlæ–‡ä»¶ åœ¨supply-financeç›®å½•ä¸‹æ·»åŠ docker/docker-compose.ymlæ–‡ä»¶ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206# Copyright IBM Corp. All Rights Reserved.## SPDX-License-Identifier: Apache-2.0#version: &#x27;2&#x27;volumes: orderer.supply.com: peer0.core.supply.com: peer0.f1.supply.com: peer0.s1.supply.com: peer0.s2.supply.com:networks: test:services: orderer.supply.com: container_name: orderer.supply.com image: hyperledger/fabric-orderer:2.2.0 environment: - FABRIC_LOGGING_SPEC=INFO - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0 - ORDERER_GENERAL_LISTENPORT=8050 - ORDERER_GENERAL_GENESISMETHOD=file - ORDERER_GENERAL_BOOTSTRAPFILE=/etc/hyperledger/orderer/orderer.genesis.block - ORDERER_GENERAL_LOCALMSPID=OrdererMSP - ORDERER_GENERAL_LOCALMSPDIR=/etc/hyperledger/fabric/msp - ORDERER_GENERAL_LEDGERTYPE=file - ORDERER_OPERATIONS_LISTENADDRESS=0.0.0.0:8443 # enabled TLS - ORDERER_GENERAL_TLS_ENABLED=true - ORDERER_GENERAL_TLS_PRIVATEKEY=/etc/hyperledger/fabric/tls/server.key - ORDERER_GENERAL_TLS_CERTIFICATE=/etc/hyperledger/fabric/tls/server.crt - ORDERER_GENERAL_TLS_ROOTCAS=[/etc/hyperledger/fabric/tls/ca.crt] - ORDERER_GENERAL_CLUSTER_CLIENTCERTIFICATE=/etc/hyperledger/fabric/tls/server.crt - ORDERER_GENERAL_CLUSTER_CLIENTPRIVATEKEY=/etc/hyperledger/fabric/tls/server.key - ORDERER_GENERAL_CLUSTER_ROOTCAS=[/etc/hyperledger/fabric/tls/ca.crt] working_dir: /opt/gopath/src/github.com/hyperledger/fabric command: orderer volumes: - ../system-genesis-block/genesis.block:/etc/hyperledger/orderer/orderer.genesis.block - ../organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp:/etc/hyperledger/fabric/msp - ../organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/tls:/etc/hyperledger/fabric/tls - orderer.supply.com:/var/hyperledger/production/orderer - ../organizations:/tmp ports: - 8050:8050 networks: - test peer0.core.supply.com: container_name: peer0.core.supply.com image: hyperledger/fabric-peer:2.2.0 environment: #Generic peer variables - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock # the following setting starts chaincode containers on the same # bridge network as the peers # https://docs.docker.com/compose/networking/ - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=docker_test - FABRIC_LOGGING_SPEC=INFO #- FABRIC_LOGGING_SPEC=DEBUG - CORE_PEER_TLS_ENABLED=true - CORE_PEER_PROFILE_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt # Peer specific variabes - CORE_PEER_ID=peer0.core.supply.com - CORE_PEER_ADDRESS=peer0.core.supply.com:8051 - CORE_PEER_LISTENADDRESS=0.0.0.0:8051 - CORE_PEER_CHAINCODEADDRESS=peer0.core.supply.com:8052 - CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0:8052 - CORE_PEER_GOSSIP_BOOTSTRAP=peer0.core.supply.com:8051 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.core.supply.com:8051 - CORE_PEER_LOCALMSPID=GylCoreOrg1MSP volumes: - /var/run/:/host/var/run/ - ../organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/msp:/etc/hyperledger/fabric/msp - ../organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls:/etc/hyperledger/fabric/tls - peer0.core.supply.com:/var/hyperledger/production - ../organizations:/tmp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer command: peer node start ports: - 8051:8051 networks: - test peer0.f1.supply.com: container_name: peer0.f1.supply.com image: hyperledger/fabric-peer:2.2.0 environment: #Generic peer variables - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock # the following setting starts chaincode containers on the same # bridge network as the peers # https://docs.docker.com/compose/networking/ - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=docker_test - FABRIC_LOGGING_SPEC=INFO #- FABRIC_LOGGING_SPEC=DEBUG - CORE_PEER_TLS_ENABLED=true - CORE_PEER_PROFILE_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt # Peer specific variabes - CORE_PEER_ID=peer0.f1.supply.com - CORE_PEER_ADDRESS=peer0.f1.supply.com:8053 - CORE_PEER_LISTENADDRESS=0.0.0.0:8053 - CORE_PEER_CHAINCODEADDRESS=peer0.f1.supply.com:8054 - CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0:8054 - CORE_PEER_GOSSIP_BOOTSTRAP=peer0.f1.supply.com:8053 - CORE_PEER_LOCALMSPID=GylFOrg1MSP volumes: - /var/run/:/host/var/run/ - ../organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/msp:/etc/hyperledger/fabric/msp - ../organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls:/etc/hyperledger/fabric/tls - peer0.f1.supply.com:/var/hyperledger/production - ../organizations:/tmp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer command: peer node start ports: - 8053:8053 networks: - test peer0.s1.supply.com: container_name: peer0.s1.supply.com image: hyperledger/fabric-peer:2.2.0 environment: #Generic peer variables - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock # the following setting starts chaincode containers on the same # bridge network as the peers # https://docs.docker.com/compose/networking/ - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=docker_test - FABRIC_LOGGING_SPEC=INFO #- FABRIC_LOGGING_SPEC=DEBUG - CORE_PEER_TLS_ENABLED=true - CORE_PEER_PROFILE_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt # Peer specific variabes - CORE_PEER_ID=peer0.s1.supply.com - CORE_PEER_ADDRESS=peer0.s1.supply.com:8055 - CORE_PEER_LISTENADDRESS=0.0.0.0:8055 - CORE_PEER_CHAINCODEADDRESS=peer0.s1.supply.com:8056 - CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0:8056 - CORE_PEER_GOSSIP_BOOTSTRAP=peer0.s1.supply.com:8055 - CORE_PEER_LOCALMSPID=GylSOrg1MSP volumes: - /var/run/:/host/var/run/ - ../organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/msp:/etc/hyperledger/fabric/msp - ../organizations/peerOrganizations/s1.supply.com/peers/peer0.s1.supply.com/tls:/etc/hyperledger/fabric/tls - peer0.s1.supply.com:/var/hyperledger/production - ../organizations:/tmp working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer command: peer node start ports: - 8055:8055 networks: - test peer0.s2.supply.com: container_name: peer0.s2.supply.com image: hyperledger/fabric-peer:2.2.0 environment: #Generic peer variables - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock # the following setting starts chaincode containers on the same # bridge network as the peers # https://docs.docker.com/compose/networking/ - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=docker_test - FABRIC_LOGGING_SPEC=INFO #- FABRIC_LOGGING_SPEC=DEBUG - CORE_PEER_TLS_ENABLED=true - CORE_PEER_PROFILE_ENABLED=true - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt # Peer specific variabes - CORE_PEER_ID=peer0.s2.supply.com - CORE_PEER_ADDRESS=peer0.s2.supply.com:8151 - CORE_PEER_LISTENADDRESS=0.0.0.0:8151 - CORE_PEER_CHAINCODEADDRESS=peer0.s2.supply.com:8152 - CORE_PEER_CHAINCODELISTENADDRESS=0.0.0.0:8152 - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.s2.supply.com:8151 - CORE_PEER_GOSSIP_BOOTSTRAP=peer0.s2.supply.com:8151 - CORE_PEER_LOCALMSPID=GylSOrg2MSP volumes: - /var/run/:/host/var/run/ - ../organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/msp:/etc/hyperledger/fabric/msp - ../organizations/peerOrganizations/s2.supply.com/peers/peer0.s2.supply.com/tls:/etc/hyperledger/fabric/tls - ../organizations:/tmp - peer0.s2.supply.com:/var/hyperledger/production working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer command: peer node start ports: - 8151:8151 networks: - test ä½¿ç”¨docker-compose.ymlé…ç½®æ–‡ä»¶å¯åŠ¨å„ç»„ç»‡çš„æœåŠ¡ å‘½ä»¤å¦‚ä¸‹ï¼š 1docker-compose -f ./docker/docker-compose.yml up -d å¯åŠ¨ä¹‹åä¼šåœ¨dockerå¯åŠ¨ä¸‹é¢è¿™äº›å®¹å™¨ï¼š orderer.supply.com:æ’åºèŠ‚ç‚¹ peer0.core.supply.com:æ ¸å¿ƒä¼ä¸šèŠ‚ç‚¹ peer0.f1.supply.com:ä¸€çº§ä¾›åº”å•†èŠ‚ç‚¹ peer0.s1.supply.com:äºŒçº§ä¾›åº”å•†1èŠ‚ç‚¹ peer0.s2.supply.com:äºŒçº§ä¾›åº”å•†2èŠ‚ç‚¹","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"ä¾›åº”é“¾é‡‘è","slug":"åŒºå—é“¾/Hyperledger-Fabric/ä¾›åº”é“¾é‡‘è","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"ä¾›åº”é“¾é‡‘è","slug":"ä¾›åº”é“¾é‡‘è","permalink":"https://guozhe001.github.io/tags/%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D/"}]},{"title":"åˆ›å»ºchannel","slug":"blockchain/fabric/é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric/åˆ›å»ºchannel","date":"2021-04-01T10:18:21.495Z","updated":"2021-04-01T10:18:21.496Z","comments":true,"path":"2021/04/01/blockchain/fabric/é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric/åˆ›å»ºchannel/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/%E5%88%9B%E5%BB%BAchannel/","excerpt":"","text":"2. åˆ›å»ºChannel å‚è€ƒï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„channel åˆ›å»ºé€šé“ï¼š è¿è¡Œä¸‹é¢çš„ç¨‹åºæ¥ä¸ºcoreandfirstchannelé€šé“åˆ›å»ºä¸€ä¸ªâ€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€ 1configtxgen -profile CoreAndFirstChannel -outputCreateChannelTx ./channel-artifacts/coreandfirstchannel.tx -channelID coreandfirstchannel æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š 12342020-12-24 14:29:40.728 CST [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration2020-12-24 14:29:40.739 CST [common.tools.configtxgen.localconfig] Load -&gt; INFO 002 Loaded configuration: /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/configtx/configtx.yaml2020-12-24 14:29:40.739 CST [common.tools.configtxgen] doOutputChannelCreateTx -&gt; INFO 003 Generating new channel configtx2020-12-24 14:29:40.750 CST [common.tools.configtxgen] doOutputChannelCreateTx -&gt; INFO 004 Writing new channel tx è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä»¥æ ¸å¿ƒä¼ä¸š(core.supply.com)ç®¡ç†å‘˜èº«ä»½æ“ä½œpeerCLI;ç„¶åä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŠŠäº¤æ˜“å‘ç»™orderæœåŠ¡åˆ›å»ºé€šé“ï¼š 1peer channel create -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c coreandfirstchannel -f ./channel-artifacts/coreandfirstchannel.tx --outputBlock ./channel-artifacts/coreandfirstchannel.block --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem æ­£ç¡®æ‰§è¡Œä¹‹åçš„æ—¥å¿—ï¼š 1234567891011122020-12-24 15:59:28.470 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized2020-12-24 15:59:28.490 CST [cli.common] readBlock -&gt; INFO 002 Expect block, but got status: &amp;&#123;NOT_FOUND&#125;2020-12-24 15:59:28.497 CST [channelCmd] InitCmdFactory -&gt; INFO 003 Endorser and orderer connections initialized2020-12-24 15:59:28.701 CST [cli.common] readBlock -&gt; INFO 004 Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;2020-12-24 15:59:28.708 CST [channelCmd] InitCmdFactory -&gt; INFO 005 Endorser and orderer connections initialized2020-12-24 15:59:28.917 CST [cli.common] readBlock -&gt; INFO 006 Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;2020-12-24 15:59:28.924 CST [channelCmd] InitCmdFactory -&gt; INFO 007 Endorser and orderer connections initialized2020-12-24 15:59:29.134 CST [cli.common] readBlock -&gt; INFO 008 Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;2020-12-24 15:59:29.141 CST [channelCmd] InitCmdFactory -&gt; INFO 009 Endorser and orderer connections initialized2020-12-24 15:59:29.349 CST [cli.common] readBlock -&gt; INFO 00a Expect block, but got status: &amp;&#123;SERVICE_UNAVAILABLE&#125;2020-12-24 15:59:29.357 CST [channelCmd] InitCmdFactory -&gt; INFO 00b Endorser and orderer connections initialized2020-12-24 15:59:29.566 CST [cli.common] readBlock -&gt; INFO 00c Received block: 0 æŠ¥é”™ä¿¡æ¯è®°å½•ï¼š 12345(base) apple@WHOAMIdeMacBook-Pro:~/code/open-source/blockchain/hyperledger/supply-finance$ peer channel create -o localhost:8051 --ordererTLSHostnameOverride orderer.supply.com -c coreandfirstchannel -f ./channel-artifacts/coreandfirstchannel.tx --outputBlock ./channel-artifacts/coreandfirstchannel.block --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem2020-12-24 15:56:56.602 CST [comm.tls] ClientHandshake -&gt; ERRO 001 Client TLS handshake failed after 5.225381ms with error: x509: certificate is valid for peer0.core.supply.com, peer0, not orderer.supply.com remoteaddress=[::1]:80512020-12-24 15:56:57.611 CST [comm.tls] ClientHandshake -&gt; ERRO 002 Client TLS handshake failed after 3.907471ms with error: x509: certificate is valid for peer0.core.supply.com, peer0, not orderer.supply.com remoteaddress=[::1]:80512020-12-24 15:56:59.315 CST [comm.tls] ClientHandshake -&gt; ERRO 003 Client TLS handshake failed after 4.52302ms with error: x509: certificate is valid for peer0.core.supply.com, peer0, not orderer.supply.com remoteaddress=[::1]:8051Error: failed to create deliver client for orderer: orderer client failed to connect to localhost:8051: failed to create new connection: context deadline exceeded é”™è¯¯åŸå› ï¼špeer channel create -o localhost:8051 å‘½ä»¤-oåº”è¯¥ä¼ å…¥orderæœåŠ¡çš„åœ°å€å’Œç«¯å£ã€‚ æŠŠæ ¸å¿ƒä¼ä¸šå’Œä¸€çº§ä¾›åº”å•†çš„peeråŠ å…¥é€šé“ æ ¸å¿ƒä¼ä¸šçš„peeråŠ å…¥é€šé“ ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°†æ ¸å¿ƒä¼ä¸šçš„peeråŠ å…¥é€šé“ï¼ˆç¡®è®¤å·²ç»è®¾ç½®äº†æ ¸å¿ƒä¼ä¸šçš„ç¯å¢ƒå˜é‡ï¼‰ï¼š 1peer channel join -b ./channel-artifacts/coreandfirstchannel.block æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š 122020-12-24 16:46:40.206 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized2020-12-24 16:46:40.235 CST [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel æŠ¥é”™ä¿¡æ¯è®°å½•: 12345(base) apple@WHOAMIdeMacBook-Pro:~/code/open-source/blockchain/hyperledger/supply-finance$ peer channel join -b ./channel-artifacts/coreandfirstchannel.block2020-12-24 16:18:23.258 CST [comm.tls] ClientHandshake -&gt; ERRO 001 Client TLS handshake failed after 2.895228ms with error: x509: certificate is valid for peer0.core.supply.com, peer0, not localhost remoteaddress=[::1]:80512020-12-24 16:18:24.266 CST [comm.tls] ClientHandshake -&gt; ERRO 002 Client TLS handshake failed after 4.537447ms with error: x509: certificate is valid for peer0.core.supply.com, peer0, not localhost remoteaddress=[::1]:80512020-12-24 16:18:25.659 CST [comm.tls] ClientHandshake -&gt; ERRO 003 Client TLS handshake failed after 4.16728ms with error: x509: certificate is valid for peer0.core.supply.com, peer0, not localhost remoteaddress=[::1]:8051Error: error getting endorser client for channel: endorser client failed to connect to localhost:8051: failed to create new connection: context deadline exceeded **é”™è¯¯åŸå› ï¼š**æœªçŸ¥ã€‚ **è§£å†³æ–¹å¼ï¼š**æŠŠProfilesé‡Œé¢çš„Organizationsä¿¡æ¯ç»Ÿä¸€ä¿®æ”¹ï¼Œä¸ç¯å¢ƒå˜é‡ä¿æŒä¸€è‡´ 123456Organizations: - *GylCoreOrg1MSP - *GylFOrg1MSP - *GylSOrg1MSP - *GylSOrg2MSP ç„¶åæŠŠä¸Šé¢æ­¥éª¤ä¸­ç”Ÿæˆçš„åŠ å¯†ææ–™ä¿¡æ¯ã€åŒºå—ä¿¡æ¯éƒ½åˆ é™¤ï¼Œå®¹å™¨å’Œvolumeå…¨éƒ¨åˆ é™¤ï¼›é‡æ–°æ‰§è¡Œä¸€éã€‚ é€šè¿‡è·å–é€šé“ä¿¡æ¯ç¡®è®¤åŠ å…¥æˆåŠŸ è·å–é€šé“ä¿¡æ¯ 1peer channel getinfo -c coreandfirstchannel å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š 122020-12-24 16:53:01.633 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initializedBlockchain info: &#123;&quot;height&quot;:1,&quot;currentBlockHash&quot;:&quot;kXOOwW8prt0XPvgEGMDrzdt1nNH8T7qlObL9eT8FZ7c=&quot;&#125; ä¸€çº§ä¾›åº”å•†åŠ å…¥é€šé“ è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œç„¶åæ‹‰å–é€šé“çš„åˆ›ä¸–çºªåŒºå—(å› ä¸ºæ˜¯æµ‹è¯•æœ¬æ¬¡å¿½ç•¥)ï¼š 1peer channel fetch 0 ./channel-artifacts/coreandfirstchannel.block -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c coreandfirstchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem åŠ å…¥é€šé“ï¼š 1peer channel join -b ./channel-artifacts/coreandfirstchannel.block æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š 122020-12-24 17:06:30.499 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized2020-12-24 17:06:30.527 CST [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š 12(base) apple@WHOAMIdeMacBook-Pro:~/code/open-source/blockchain/hyperledger/supply-finance$ peer channel join -b ./channel-artifacts/coreandfirstchannel.block2020-12-24 17:01:05.904 CST [main] InitCmd -&gt; ERRO 001 Cannot run peer because cannot init crypto, specified path &quot;/Users/apple/code/open-source/blockchain/hyperledger/supply-finance/organizations/peerOrganizations/f1.supply.com/users/Admin@f1.supply.com/msp/organizations/peerOrganizations/f1.supply.com/users/Admin@f1.supply.com/msp&quot; does not exist or cannot be accessed: stat /Users/apple/code/open-source/blockchain/hyperledger/supply-finance/organizations/peerOrganizations/f1.supply.com/users/Admin@f1.supply.com/msp/organizations/peerOrganizations/f1.supply.com/users/Admin@f1.supply.com/msp: no such file or directory **é”™è¯¯åŸå› ï¼š**å› ä¸ºåœ¨è®¾ç½®ç¯å¢ƒå˜é‡æ—¶ä¸æ˜¯åœ¨supply-financeç›®å½•ä¸‹è®¾ç½®çš„ï¼Œæ‰€ä»¥è®¾ç½®çš„ç¯å¢ƒå˜é‡æœ‰é—®é¢˜ï¼Œé‡æ–°è®¾ç½®ä¸€ä¸‹ã€‚ è®¾ç½®é”šèŠ‚ç‚¹ ä¸ºGylFOrg1MSPè®¾ç½®é”šèŠ‚ç‚¹ å› ä¸ºä¸Šé¢å·²ç»è®¾ç½®äº†ä¸€çº§ä¾›åº”å•†ï¼ˆGylFOrg1MSPï¼‰çš„ç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥å…ˆè®¾ç½®GylFOrg1MSPçš„é”šèŠ‚ç‚¹ï¼š æ‹‰å–æœ€æ–°çš„channelé…ç½®åŒºå— 1peer channel fetch config channel-artifacts/coreandfirstchannel_config_block.pb -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c coreandfirstchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š 12342020-12-24 17:56:48.435 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized2020-12-24 17:56:48.439 CST [cli.common] readBlock -&gt; INFO 002 Received block: 02020-12-24 17:56:48.439 CST [channelCmd] fetch -&gt; INFO 003 Retrieving last config block: 02020-12-24 17:56:48.442 CST [cli.common] readBlock -&gt; INFO 004 Received block: 0 ä¿®æ”¹é€šé“é…ç½®åŒºå— åˆ‡æ¢åˆ°channel-artifactsç„¶åæŠŠåŒºå—å†…å®¹è½¬æ¢æˆjsonæ ¼å¼ï¼š 12345cd channel-artifactsconfigtxlator proto_decode --input coreandfirstchannel_config_block.pb --type common.Block --output coreandfirstchannel_config_block.jsonjq .data.data[0].payload.data.config coreandfirstchannel_config_block.json &gt; coreandfirstchannel_config.json# copyä¸€ä»½cp coreandfirstchannel_config.json coreandfirstchannel_config_copy.json ä½¿ç”¨jq å·¥å…·æ¥æ·»åŠ GylFOrg1MSPç»„ç»‡çš„é”šèŠ‚ç‚¹åˆ°é€šé“é…ç½®ã€‚ 1jq &#x27;.channel_group.groups.Application.groups.GylFOrg1MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.f1.supply.com&quot;,&quot;port&quot;: 8053&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; coreandfirstchannel_config_copy.json &gt; modified_coreandfirstchannel_config.json å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚ 123configtxlator proto_encode --input coreandfirstchannel_config.json --type common.Config --output coreandfirstchannel_config.pbconfigtxlator proto_encode --input modified_coreandfirstchannel_config.json --type common.Config --output modified_coreandfirstchannel_config.pbconfigtxlator compute_update --channel_id coreandfirstchannel --original coreandfirstchannel_config.pb --updated modified_coreandfirstchannel_config.pb --output coreandfirstchannel_config_update.pb æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼š 123configtxlator proto_decode --input coreandfirstchannel_config_update.pb --type common.ConfigUpdate --output coreandfirstchannel_config_update.jsonecho &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;coreandfirstchannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat coreandfirstchannel_config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; coreandfirstchannel_config_update_in_envelope.jsonconfigtxlator proto_encode --input coreandfirstchannel_config_update_in_envelope.json --type common.Envelope --output coreandfirstchannel_config_update_in_envelope.pb æäº¤â€œæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“â€ è¿›åˆ°ä¸Šä¸€çº§ç›®å½•cd ..ï¼Œä¹‹åè¿è¡Œå‘½ä»¤å°†äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡è¿›è¡Œé€šé“é…ç½®çš„æ›´æ–°ï¼š 12cd ..peer channel update -f channel-artifacts/coreandfirstchannel_config_update_in_envelope.pb -c coreandfirstchannel -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem æ‰§è¡ŒæˆåŠŸçš„ç»“æœï¼š 122020-12-24 18:13:59.246 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized2020-12-24 18:13:59.265 CST [channelCmd] update -&gt; INFO 002 Successfully submitted channel update é”™è¯¯ä¿¡æ¯è®°å½•ï¼š 122020-12-24 18:12:49.469 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initializedError: got unexpected status: BAD_REQUEST -- error applying config update to existing channel &#x27;coreandfirstchannel&#x27;: error authorizing update: ConfigUpdate for channel &#x27;channel1&#x27; but envelope for channel &#x27;coreandfirstchannel&#x27; **é”™è¯¯åŸå› ï¼š**åœ¨ä¿®æ”¹é…ç½®çš„æ—¶å€™æŒ‡å®šchannelåç§°é”™è¯¯ï¼Œä¿®æ­£é‡æ–°æ‰§è¡Œä¸€éã€‚ éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯:peer channel getinfo -c coreandfirstchannel 123supply-finance$ peer channel getinfo -c coreandfirstchannel2020-12-24 18:19:31.275 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initializedBlockchain info: &#123;&quot;height&quot;:2,&quot;currentBlockHash&quot;:&quot;h5CY6RfVNNg8kYWPZ+tZqdMIrGoXeoDSQFd0YfiBhRk=&quot;,&quot;previousBlockHash&quot;:&quot;kXOOwW8prt0XPvgEGMDrzdt1nNH8T7qlObL9eT8FZ7c=&quot;&#125; ä¸ºæ ¸å¿ƒä¼ä¸šGylCoreOrg1MSPè®¾ç½®é”šèŠ‚ç‚¹ ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œç„¶åæ‹‰å–æœ€æ–°çš„channelé…ç½®åŒºå— 1peer channel fetch config channel-artifacts/coreandfirstchannel_config_block.pb -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c coreandfirstchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem ä¿®æ”¹é€šé“é…ç½®åŒºå— åˆ‡æ¢åˆ°channel-artifactsç„¶åæŠŠåŒºå—å†…å®¹è½¬æ¢æˆjsonæ ¼å¼ï¼š 12345cd channel-artifactsconfigtxlator proto_decode --input coreandfirstchannel_config_block.pb --type common.Block --output coreandfirstchannel_config_block.jsonjq .data.data[0].payload.data.config coreandfirstchannel_config_block.json &gt; coreandfirstchannel_config.json# copyä¸€ä»½cp coreandfirstchannel_config.json coreandfirstchannel_config_copy.json ä½¿ç”¨jq å·¥å…·æ¥æ·»åŠ GylCoreOrg1MSPç»„ç»‡çš„é”šèŠ‚ç‚¹åˆ°é€šé“é…ç½®ã€‚ 1jq &#x27;.channel_group.groups.Application.groups.GylCoreOrg1MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.core.supply.com&quot;,&quot;port&quot;: 8051&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; coreandfirstchannel_config_copy.json &gt; modified_coreandfirstchannel_config.json å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚ 123configtxlator proto_encode --input coreandfirstchannel_config.json --type common.Config --output coreandfirstchannel_config.pbconfigtxlator proto_encode --input modified_coreandfirstchannel_config.json --type common.Config --output modified_coreandfirstchannel_config.pbconfigtxlator compute_update --channel_id coreandfirstchannel --original coreandfirstchannel_config.pb --updated modified_coreandfirstchannel_config.pb --output coreandfirstchannel_config_update.pb æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼š 123configtxlator proto_decode --input coreandfirstchannel_config_update.pb --type common.ConfigUpdate --output coreandfirstchannel_config_update.jsonecho &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;coreandfirstchannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat coreandfirstchannel_config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; coreandfirstchannel_config_update_in_envelope.jsonconfigtxlator proto_encode --input coreandfirstchannel_config_update_in_envelope.json --type common.Envelope --output coreandfirstchannel_config_update_in_envelope.pb æäº¤â€œæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“â€ è¿›åˆ°ä¸Šä¸€çº§ç›®å½•cd ..ï¼Œä¹‹åè¿è¡Œå‘½ä»¤å°†äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡è¿›è¡Œé€šé“é…ç½®çš„æ›´æ–°ï¼š 12cd ..peer channel update -f channel-artifacts/coreandfirstchannel_config_update_in_envelope.pb -c coreandfirstchannel -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem æ‰§è¡ŒæˆåŠŸçš„ç»“æœï¼š 122020-12-24 18:13:59.246 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized2020-12-24 18:13:59.265 CST [channelCmd] update -&gt; INFO 002 Successfully submitted channel update éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯ 123$ peer channel getinfo -c coreandfirstchannel2020-12-24 18:24:51.015 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initializedBlockchain info: &#123;&quot;height&quot;:3,&quot;currentBlockHash&quot;:&quot;e52oT2HAiTxyeh4a30kTx32xLJAKIWa7rm6PVOn8eoA=&quot;,&quot;previousBlockHash&quot;:&quot;h5CY6RfVNNg8kYWPZ+tZqdMIrGoXeoDSQFd0YfiBhRk=&quot;&#125; éƒ¨ç½²æµ‹è¯•chaincodeæ¥ç¡®è®¤ æ‰“åŒ… 1peer lifecycle chaincode package basic.tar.gz --path /Users/apple/code/open-source/blockchain/hyperledger/fabric-samples/asset-transfer-basic/chaincode-go/ --lang golang --label basic_1.0 è¿è¡Œå®Œä¸Šé¢çš„å‘½ä»¤ï¼ŒæŸ¥çœ‹å½“å‰ç›®å½•ä¼šå‘ç°å¤šäº†basic.tar.gzåŒ…ï¼Œè¯´æ˜æ‰“åŒ…æˆåŠŸã€‚ å®‰è£…é“¾ç åŒ… ä¸€çº§ä¾›åº”å•†å’Œæ ¸å¿ƒä¼ä¸šéƒ½è¦å®‰è£…ï¼š æ ¸å¿ƒä¼ä¸šï¼š 1peer lifecycle chaincode install basic.tar.gz --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt ä¸€çº§ä¾›åº”å•†ï¼š 1peer lifecycle chaincode install basic.tar.gz --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt å®‰è£…æˆåŠŸè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š 122020-12-24 18:51:45.793 CST [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 001 Installed remotely: response:&lt;status:200 payload:&quot;\\nJbasic_1.0:4ec191e793b27e953ff2ede5a8bcc63152cecb1e4c3f301a26e22692c61967ad\\022\\tbasic_1.0&quot; &gt;2020-12-24 18:51:45.793 CST [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 002 Chaincode code package identifier: basic_1.0:4ec191e793b27e953ff2ede5a8bcc63152cecb1e4c3f301a26e22692c61967ad æ‰¹å‡†é“¾ç å®šä¹‰ æŸ¥çœ‹å·²ç»å®‰è£…çš„chaincode 1peer lifecycle chaincode queryinstalled æˆåŠŸç»“æœå¦‚ä¸‹ï¼š 12Installed chaincodes on peer:Package ID: basic_1.0:4ec191e793b27e953ff2ede5a8bcc63152cecb1e4c3f301a26e22692c61967ad, Label: basic_1.0 å°†é“¾ç çš„ä¿¡æ¯ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡ 1export CC_PACKAGE_ID=basic_1.0:4ec191e793b27e953ff2ede5a8bcc63152cecb1e4c3f301a26e22692c61967ad æ‰¹å‡†é“¾ç å®šä¹‰ æ ¸å¿ƒä¼ä¸šå’Œä¸€çº§ä¾›åº”å•†éƒ½éœ€è¦æ‰§è¡Œæ­¤å‘½ä»¤ï¼š 1peer lifecycle chaincode approveformyorg -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name basic --version 1.0 --package-id $CC_PACKAGE_ID --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem æˆåŠŸç»“æœå¦‚ä¸‹ï¼š 12020-12-24 19:02:47.351 CST [chaincodeCmd] ClientWait -&gt; INFO 001 txid [d7e2224f63a1516ffeeed26ec5c8f69872141f5864b3602a1409679472692840] committed with status (VALID) at localhost:8051 å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†é“¾ç å®šä¹‰ï¼š 1peer lifecycle chaincode checkcommitreadiness --channelID coreandfirstchannel --name basic --version 1.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json æˆåŠŸç»“æœå¦‚ä¸‹ï¼š 123456&#123; &quot;approvals&quot;: &#123; &quot;GylCoreOrg1MSP&quot;: true, &quot;GylFOrg1MSP&quot;: true &#125;&#125; åœ¨ä¸¤ä¸ªç»„ç»‡éƒ½æ‰¹å‡†ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼š 1peer lifecycle chaincode commit -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --channelID coreandfirstchannel --name basic --version 1.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt æˆåŠŸç»“æœå¦‚ä¸‹ï¼š 122020-12-24 19:10:18.071 CST [chaincodeCmd] ClientWait -&gt; INFO 001 txid [5b363e2e419dbb1307726fe44428e23ae1b0e5feaf86cb577383b6e8a68464d6] committed with status (VALID) at localhost:80532020-12-24 19:10:18.094 CST [chaincodeCmd] ClientWait -&gt; INFO 002 txid [5b363e2e419dbb1307726fe44428e23ae1b0e5feaf86cb577383b6e8a68464d6] committed with status (VALID) at localhost:8051 ä½¿ç”¨ peer lifecycle chaincode querycommitted å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚ 1peer lifecycle chaincode querycommitted --channelID coreandfirstchannel --name basic --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem æˆåŠŸç»“æœå¦‚ä¸‹ï¼š 12Committed chaincode definition for chaincode &#x27;basic&#x27; on channel &#x27;coreandfirstchannel&#x27;:Version: 1.0, Sequence: 1, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [GylCoreOrg1MSP: true, GylFOrg1MSP: true] è°ƒç”¨é“¾ç  1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C coreandfirstchannel -n basic --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;InitLedger&quot;,&quot;Args&quot;:[]&#125;&#x27; æˆåŠŸä¿¡æ¯ï¼š 12020-12-25 17:26:22.583 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200 æŸ¥è¯¢è°ƒç”¨åçš„ç»“æœ 1peer chaincode query -C coreandfirstchannel -n basic -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27; æˆåŠŸç»“æœå¦‚ä¸‹,è¯´æ˜channeléƒ¨ç½²æˆåŠŸï¼š 1[&#123;&quot;ID&quot;:&quot;asset1&quot;,&quot;color&quot;:&quot;blue&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Tomoko&quot;,&quot;appraisedValue&quot;:300&#125;,&#123;&quot;ID&quot;:&quot;asset2&quot;,&quot;color&quot;:&quot;red&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Brad&quot;,&quot;appraisedValue&quot;:400&#125;,&#123;&quot;ID&quot;:&quot;asset3&quot;,&quot;color&quot;:&quot;green&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Jin Soo&quot;,&quot;appraisedValue&quot;:500&#125;,&#123;&quot;ID&quot;:&quot;asset4&quot;,&quot;color&quot;:&quot;yellow&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Max&quot;,&quot;appraisedValue&quot;:600&#125;,&#123;&quot;ID&quot;:&quot;asset5&quot;,&quot;color&quot;:&quot;black&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Adriana&quot;,&quot;appraisedValue&quot;:700&#125;,&#123;&quot;ID&quot;:&quot;asset6&quot;,&quot;color&quot;:&quot;white&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Michel&quot;,&quot;appraisedValue&quot;:800&#125;] é”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š 1Error: endorsement failure during invoke. response: status:500 message:&quot;error in simulation: failed to execute transaction 207cf99d289ffe9deca6a320aba59cc155fae02d19d51c9cfebc9943ffc7794d: could not launch chaincode basic_1.0:4ec191e793b27e953ff2ede5a8bcc63152cecb1e4c3f301a26e22692c61967ad: error starting container: error starting container: API error (404): network _test not found&quot; **é”™è¯¯åŸå› ï¼š**å› ä¸ºchaincodeçš„å®¹å™¨æ²¡æœ‰å¯åŠ¨æˆåŠŸ,ç›´æ¥æŒ‡å®šå®¹å™¨å¯åŠ¨æŠ¥é”™å¦‚ä¸‹ï¼š 123/supply-finance$ docker start bc47970e58a5Error response from daemon: network _test not foundError: failed to start containers: bc47970e58a5 é—®é¢˜è§£å†³ï¼š å› ä¸ºåœ¨docker-compose.ymlæ–‡ä»¶ä¸­é…ç½®äº†ä¸‹é¢çš„ç¯å¢ƒå˜é‡ï¼Œåœ¨å¯åŠ¨chaincodeå®¹å™¨æ—¶ä¼šé“¾æ¥åˆ°è¿™ä¸ªç½‘ç»œã€‚ ä¹‹å‰çš„é…ç½®æ˜¯ï¼š 1- CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=$&#123;COMPOSE_PROJECT_NAME&#125;_test ä¿®æ”¹åé‡æ–°å¯åŠ¨ï¼Œé—®é¢˜è§£å†³ã€‚ 1- CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE&#x3D;docker_test ä¸ºä»€ä¹ˆä¿®æ”¹æˆdocker_testå‘¢ï¼Œå¯ä»¥æŸ¥çœ‹ä½¿ç”¨docker-composeå‘½ä»¤å¯åŠ¨å®¹å™¨æ—¶çš„æ—¥å¿—ï¼š 1Creating network &quot;docker_test&quot; with the default driver æ ¸å¿ƒä¼ä¸šã€ä¸€çº§å’ŒäºŒçº§ä¾›åº”å•†åŠ å…¥åŒä¸€ä¸ªchannel åˆ›å»ºé€šé“ï¼š è¿è¡Œä¸‹é¢çš„ç¨‹åºæ¥ä¸ºalljoinchannelé€šé“åˆ›å»ºä¸€ä¸ªâ€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€ 123configtxgen -profile AllPlayChannel -outputCreateChannelTx ./channel-artifacts/alljoinchannel.tx -channelID alljoinchannel# ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŠŠäº¤æ˜“å‘ç»™orderæœåŠ¡åˆ›å»ºé€šé“ï¼špeer channel create -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c alljoinchannel -f ./channel-artifacts/alljoinchannel.tx --outputBlock ./channel-artifacts/alljoinchannel.block --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem åŠ å…¥é€šé“ ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°†peeråŠ å…¥é€šé“,æ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦æ‰§è¡Œï¼š 123peer channel join -b ./channel-artifacts/alljoinchannel.block# é€šè¿‡è·å–é€šé“ä¿¡æ¯ç¡®è®¤åŠ å…¥æˆåŠŸpeer channel getinfo -c alljoinchannel ä¸ºå„ä¸ªç»„ç»‡è®¾ç½®é”šèŠ‚ç‚¹ GylCoreOrg1MSP 12345678peer channel fetch config channel-artifacts/alljoinchannel_config_block.pb -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c alljoinchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem# åˆ‡æ¢åˆ°`channel-artifacts`ç„¶åæŠŠåŒºå—å†…å®¹è½¬æ¢æˆjsonæ ¼å¼ï¼šcd channel-artifactsconfigtxlator proto_decode --input alljoinchannel_config_block.pb --type common.Block --output alljoinchannel_config_block.jsonjq .data.data[0].payload.data.config alljoinchannel_config_block.json &gt; alljoinchannel_config.jsoncp alljoinchannel_config.json alljoinchannel_config_copy.json# ä½¿ç”¨`jq`å·¥å…·æ·»åŠ å„ä¸ªç»„ç»‡çš„é”šèŠ‚ç‚¹é…ç½®jq &#x27;.channel_group.groups.Application.groups.GylCoreOrg1MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.core.supply.com&quot;,&quot;port&quot;: 8051&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; alljoinchannel_config_copy.json &gt; modified_alljoinchannel_config.json 12345678# å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚configtxlator proto_encode --input alljoinchannel_config.json --type common.Config --output alljoinchannel_config.pbconfigtxlator proto_encode --input modified_alljoinchannel_config.json --type common.Config --output modified_alljoinchannel_config.pbconfigtxlator compute_update --channel_id alljoinchannel --original alljoinchannel_config.pb --updated modified_alljoinchannel_config.pb --output alljoinchannel_config_update.pb# æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼šconfigtxlator proto_decode --input alljoinchannel_config_update.pb --type common.ConfigUpdate --output alljoinchannel_config_update.jsonecho &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;alljoinchannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat alljoinchannel_config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; alljoinchannel_config_update_in_envelope.jsonconfigtxlator proto_encode --input alljoinchannel_config_update_in_envelope.json --type common.Envelope --output alljoinchannel_config_update_in_envelope.pb 12345# è¿›åˆ°ä¸Šä¸€çº§ç›®å½•`cd ..`ï¼Œä¹‹åè¿è¡Œå‘½ä»¤å°†äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡è¿›è¡Œé€šé“é…ç½®çš„æ›´æ–°ï¼šcd ..peer channel update -f channel-artifacts/alljoinchannel_config_update_in_envelope.pb -c alljoinchannel -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem# éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯:peer channel getinfo -c alljoinchannel GylFOrg1MSP 12345678peer channel fetch config channel-artifacts/alljoinchannel_config_block.pb -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c alljoinchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem# åˆ‡æ¢åˆ°`channel-artifacts`ç„¶åæŠŠåŒºå—å†…å®¹è½¬æ¢æˆjsonæ ¼å¼ï¼šcd channel-artifactsconfigtxlator proto_decode --input alljoinchannel_config_block.pb --type common.Block --output alljoinchannel_config_block.jsonjq .data.data[0].payload.data.config alljoinchannel_config_block.json &gt; alljoinchannel_config.jsoncp alljoinchannel_config.json alljoinchannel_config_copy.json# ä½¿ç”¨`jq`å·¥å…·æ·»åŠ å„ä¸ªç»„ç»‡çš„é”šèŠ‚ç‚¹é…ç½®jq &#x27;.channel_group.groups.Application.groups.GylFOrg1MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.f1.supply.com&quot;,&quot;port&quot;: 8053&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; alljoinchannel_config_copy.json &gt; modified_alljoinchannel_config.json 12345678# å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚configtxlator proto_encode --input alljoinchannel_config.json --type common.Config --output alljoinchannel_config.pbconfigtxlator proto_encode --input modified_alljoinchannel_config.json --type common.Config --output modified_alljoinchannel_config.pbconfigtxlator compute_update --channel_id alljoinchannel --original alljoinchannel_config.pb --updated modified_alljoinchannel_config.pb --output alljoinchannel_config_update.pb# æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼šconfigtxlator proto_decode --input alljoinchannel_config_update.pb --type common.ConfigUpdate --output alljoinchannel_config_update.jsonecho &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;alljoinchannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat alljoinchannel_config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; alljoinchannel_config_update_in_envelope.jsonconfigtxlator proto_encode --input alljoinchannel_config_update_in_envelope.json --type common.Envelope --output alljoinchannel_config_update_in_envelope.pb 12345# è¿›åˆ°ä¸Šä¸€çº§ç›®å½•`cd ..`ï¼Œä¹‹åè¿è¡Œå‘½ä»¤å°†äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡è¿›è¡Œé€šé“é…ç½®çš„æ›´æ–°ï¼šcd ..peer channel update -f channel-artifacts/alljoinchannel_config_update_in_envelope.pb -c alljoinchannel -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem# éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯:peer channel getinfo -c alljoinchannel GylSOrg1MSP 12345678peer channel fetch config channel-artifacts/alljoinchannel_config_block.pb -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c alljoinchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem# åˆ‡æ¢åˆ°`channel-artifacts`ç„¶åæŠŠåŒºå—å†…å®¹è½¬æ¢æˆjsonæ ¼å¼ï¼šcd channel-artifactsconfigtxlator proto_decode --input alljoinchannel_config_block.pb --type common.Block --output alljoinchannel_config_block.jsonjq .data.data[0].payload.data.config alljoinchannel_config_block.json &gt; alljoinchannel_config.jsoncp alljoinchannel_config.json alljoinchannel_config_copy.json# ä½¿ç”¨`jq`å·¥å…·æ·»åŠ å„ä¸ªç»„ç»‡çš„é”šèŠ‚ç‚¹é…ç½®jq &#x27;.channel_group.groups.Application.groups.GylSOrg1MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.s1.supply.com&quot;,&quot;port&quot;: 8055&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; alljoinchannel_config_copy.json &gt; modified_alljoinchannel_config.json 12345678# å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚configtxlator proto_encode --input alljoinchannel_config.json --type common.Config --output alljoinchannel_config.pbconfigtxlator proto_encode --input modified_alljoinchannel_config.json --type common.Config --output modified_alljoinchannel_config.pbconfigtxlator compute_update --channel_id alljoinchannel --original alljoinchannel_config.pb --updated modified_alljoinchannel_config.pb --output alljoinchannel_config_update.pb# æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼šconfigtxlator proto_decode --input alljoinchannel_config_update.pb --type common.ConfigUpdate --output alljoinchannel_config_update.jsonecho &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;alljoinchannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat alljoinchannel_config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; alljoinchannel_config_update_in_envelope.jsonconfigtxlator proto_encode --input alljoinchannel_config_update_in_envelope.json --type common.Envelope --output alljoinchannel_config_update_in_envelope.pb 12345# è¿›åˆ°ä¸Šä¸€çº§ç›®å½•`cd ..`ï¼Œä¹‹åè¿è¡Œå‘½ä»¤å°†äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡è¿›è¡Œé€šé“é…ç½®çš„æ›´æ–°ï¼šcd ..peer channel update -f channel-artifacts/alljoinchannel_config_update_in_envelope.pb -c alljoinchannel -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem# éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯:peer channel getinfo -c alljoinchannel GylSOrg1MSP 12345678peer channel fetch config channel-artifacts/alljoinchannel_config_block.pb -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com -c alljoinchannel --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem# åˆ‡æ¢åˆ°`channel-artifacts`ç„¶åæŠŠåŒºå—å†…å®¹è½¬æ¢æˆjsonæ ¼å¼ï¼šcd channel-artifactsconfigtxlator proto_decode --input alljoinchannel_config_block.pb --type common.Block --output alljoinchannel_config_block.jsonjq .data.data[0].payload.data.config alljoinchannel_config_block.json &gt; alljoinchannel_config.jsoncp alljoinchannel_config.json alljoinchannel_config_copy.json# ä½¿ç”¨`jq`å·¥å…·æ·»åŠ å„ä¸ªç»„ç»‡çš„é”šèŠ‚ç‚¹é…ç½®jq &#x27;.channel_group.groups.Application.groups.GylSOrg2MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.s2.supply.com&quot;,&quot;port&quot;: 8151&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; alljoinchannel_config_copy.json &gt; modified_alljoinchannel_config.json 12345678# å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚configtxlator proto_encode --input alljoinchannel_config.json --type common.Config --output alljoinchannel_config.pbconfigtxlator proto_encode --input modified_alljoinchannel_config.json --type common.Config --output modified_alljoinchannel_config.pbconfigtxlator compute_update --channel_id alljoinchannel --original alljoinchannel_config.pb --updated modified_alljoinchannel_config.pb --output alljoinchannel_config_update.pb# æŠŠæ›´æ–°åçš„äº¤æ˜“æ‰“åŒ…æˆä¸€ä¸ªæ›´æ–°é€šé“é…ç½®çš„äº¤æ˜“ï¼šconfigtxlator proto_decode --input alljoinchannel_config_update.pb --type common.ConfigUpdate --output alljoinchannel_config_update.jsonecho &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;alljoinchannel&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat alljoinchannel_config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; alljoinchannel_config_update_in_envelope.jsonconfigtxlator proto_encode --input alljoinchannel_config_update_in_envelope.json --type common.Envelope --output alljoinchannel_config_update_in_envelope.pb 12345# è¿›åˆ°ä¸Šä¸€çº§ç›®å½•`cd ..`ï¼Œä¹‹åè¿è¡Œå‘½ä»¤å°†äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡è¿›è¡Œé€šé“é…ç½®çš„æ›´æ–°ï¼šcd ..peer channel update -f channel-artifacts/alljoinchannel_config_update_in_envelope.pb -c alljoinchannel -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem# éªŒè¯ï¼Œè·å–é€šé“ä¿¡æ¯:peer channel getinfo -c alljoinchannel","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"ä¾›åº”é“¾é‡‘è","slug":"åŒºå—é“¾/Hyperledger-Fabric/ä¾›åº”é“¾é‡‘è","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"channel","slug":"channel","permalink":"https://guozhe001.github.io/tags/channel/"},{"name":"ä¾›åº”é“¾é‡‘è","slug":"ä¾›åº”é“¾é‡‘è","permalink":"https://guozhe001.github.io/tags/%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D/"}]},{"title":"fabricå‘½ä»¤è®°å½•.md","slug":"blockchain/fabric/é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric/fabricå‘½ä»¤è®°å½•","date":"2021-04-01T10:18:21.494Z","updated":"2021-04-01T10:18:21.494Z","comments":true,"path":"2021/04/01/blockchain/fabric/é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric/fabricå‘½ä»¤è®°å½•/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/fabric%E5%91%BD%E4%BB%A4%E8%AE%B0%E5%BD%95/","excerpt":"","text":"","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"ä¾›åº”é“¾é‡‘è","slug":"åŒºå—é“¾/Hyperledger-Fabric/ä¾›åº”é“¾é‡‘è","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"}]},{"title":"SUMMARY-ä¾›åº”é“¾é‡‘è","slug":"blockchain/fabric/é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric/summary","date":"2021-04-01T10:18:21.494Z","updated":"2021-04-01T10:18:21.495Z","comments":true,"path":"2021/04/01/blockchain/fabric/é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric/summary/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E9%80%9A%E8%BF%87%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D%E7%BB%83%E4%B9%A0Fabric/summary/","excerpt":"","text":"é¡¹ç›®èƒŒæ™¯ ä¸ºäº†å­¦ä¹ Fabricï¼Œæ¨¡æ‹Ÿæ­å»ºä¸€ä¸ªä¾›åº”é“¾é‡‘èçš„åŒºå—é“¾é¡¹ç›®ã€‚ ä¸ºäº†ç®€å•èµ·è§ï¼Œæ­¤é¡¹ç›®æœ‰ä»¥ä¸‹å››ä¸ªç»„ç»‡ï¼š æ ¸å¿ƒä¼ä¸š ä¸€çº§ä¾›åº”å•† äºŒçº§ä¾›åº”å•†1 äºŒçº§ä¾›åº”å•†2 æ“ä½œæ­¥éª¤ï¼š è®¾ç½®ç¯å¢ƒå˜é‡ åˆ›å»ºç½‘ç»œ åˆ›å»ºchannel å¼€å‘æ™ºèƒ½åˆçº¦ éƒ¨ç½²æ™ºèƒ½åˆçº¦åˆ°channelå¹¶è¿›è¡Œäº¤æ˜“ [äº¤æ˜“ä¸éªŒè¯](file://éƒ¨ç½²æ™ºèƒ½åˆçº¦åˆ°channel.md)ï¼šæŸ¥çœ‹â€œéƒ¨ç½²supply-v8åˆ°alljoinchannelé€šé“â€éƒ¨åˆ† éšç§˜äº¤æ˜“ æºç åœ°å€ æ€»ç»“ï¼š æœ¬é¡¹ç›®æˆåŠŸçš„åœ¨æµ‹è¯•ç¯å¢ƒè‡ªå·±éƒ¨ç½²ç½‘ç»œï¼Œè‡ªå·±å†™æ™ºèƒ½åˆçº¦å¹¶è¿›è¡Œè°ƒç”¨ï¼›å®Œæˆäº†å…¥é—¨ç»ƒä¹ ã€‚ å­˜åœ¨çš„é—®é¢˜ï¼š é—®é¢˜1 ç›®å‰æ­¤ç¨‹åºæŠŠæ‰€æœ‰çš„ç»„ç»‡éƒ½åŠ å…¥äº†åŒä¸€ä¸ªæ¸ é“ï¼Œæ‰€ä»¥è´¦æœ¬æ˜¯å¯¹æ‰€æœ‰ç»„ç»‡éƒ½æ˜¯å…¬å¼€çš„ï¼›ç°å®ç”Ÿæ´»ä¸­æ¯ä¸ªä¼ä¸šä¹‹é—´çš„äº¤æ˜“åº”è¯¥éƒ½æ˜¯ç§å¯†çš„ï¼Œä¸èƒ½è¢«å…¶ä»–ä¼ä¸šæ‰€è§ã€‚ è§£å†³æ–¹æ¡ˆ1ï¼š ä½¿ç”¨é€šé“éš”ç¦»ï¼Œæ¯ä¸¤ä¸ªéœ€è¦äº¤æ˜“çš„ç»„ç»‡ä¹‹é—´éƒ½åˆ›å»ºä¸€ä¸ªé€šé“ã€‚ å¯è¡Œæ€§ï¼š åˆæ­¥åˆ¤æ–­æ­¤æ–¹æ³•ä¸å¯è¡Œï¼Œå› ä¸ºä¸åŒé€šé“ä¹‹é—´æ— æ³•äº¤æ˜“èµ„äº§ï¼Ÿå¦‚æœå¯ä»¥äº¤æ˜“éœ€è¦ä»åŸæ¥çš„channelé”€æ¯æ­¤èµ„äº§ï¼Œç„¶ååœ¨æ–°channelåˆ›å»ºä¸€ä¸ªæ–°çš„å¯è¢«ä¿¡ä»»çš„æ–°èµ„äº§ è§£å†³æ–¹æ¡ˆ2ï¼š ä½¿ç”¨ç§å¯†èµ„äº§äº¤æ˜“çš„æ–¹å¼è§£å†³,å‚è€ƒæ–‡æ¡£Secured asset transfer in Fabric å¯è¡Œæ€§ï¼š å¯ä»¥ï¼ŒæŸ¥çœ‹[éšç§˜äº¤æ˜“](file://éšç§˜äº¤æ˜“.md) é—®é¢˜2: åŒä¸€ä¸ªæ™ºèƒ½åˆçº¦å¦‚ä½•é™åˆ¶åªèƒ½ç”±æŒ‡å®šçš„äººè°ƒç”¨ï¼Ÿå¦‚æœ¬ä¾‹ä¸­ï¼Œå‘è¡Œæ–¹æ³•åº”è¯¥åªèƒ½ç”±æ ¸å¿ƒä¼ä¸šè°ƒç”¨ã€‚ è§£å†³æ–¹æ¡ˆ åŒä¸€ä¸ªæ™ºèƒ½åˆçº¦å¯ä»¥ç”±éƒ¨ç½²æ™ºèƒ½åˆçº¦çš„æˆå‘˜è°ƒç”¨ï¼Œæ‰€ä»¥æ— æ³•é™åˆ¶ï¼Œé™¤éæ™ºèƒ½åˆçº¦é‡Œé¢å†™æ­»ã€‚ åœ¨åº”æ”¶è´¦æ¬¾ä¾›åº”é“¾é‡‘èçš„demoä¸­ï¼Œæˆ‘ä»¬å†™çš„æ™ºèƒ½åˆçº¦å¯ä»¥ç”±ä»»ä½•äººå‘è¡Œåº”æ”¶è´¦æ¬¾ï¼Œä½†æ˜¯è¿™åªæ˜¯ç”Ÿæˆäº†ç§æœ‰çš„æ•°æ®ï¼Œåˆ«äººè®¤ä¸è®¤å¯æ˜¯å¦è·Ÿå‘è¡Œåº”æ”¶è´¦æ¬¾çš„ç»„ç»‡äº¤æ˜“æ˜¯é“¾ä¸‹è§£å†³çš„é—®é¢˜ã€‚ é—®é¢˜3ï¼š ä½¿ç”¨å®‰å…¨çš„æ–¹å¼äº¤æ˜“èµ„äº§ä¹‹åï¼Œé™¤äº†èµ„äº§çš„æ‹¥æœ‰è€…ä¹‹å¤–å…¶ä»–ä»»ä½•äººéƒ½æ— æ³•çŸ¥é“èµ„äº§çš„é‡‘é¢ç­‰ç§æœ‰ä¿¡æ¯ã€‚ä½†æ˜¯ç°å®ä¸­çš„ä¾›åº”é“¾é‡‘èåº”è¯¥æ˜¯å…è®¸å‡­è¯èµ„äº§çš„å‘è¡ŒäººçŸ¥é“èµ„äº§å½’å±æ˜¯è°ã€èµ„äº§çš„é‡‘é¢æ˜¯å¤šå°‘ï¼›åªæœ‰è¿™æ ·å‘è¡Œäººæ‰èƒ½å¤Ÿåœ¨å‡­è¯èµ„äº§åˆ°æœŸæ—¶è¿›è¡Œè¿˜æ¬¾ã€‚ è§£å†³æ–¹æ¡ˆ ä¿®æ”¹æ™ºèƒ½åˆçº¦ï¼Œå¾…å®Œæˆã€‚","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"ä¾›åº”é“¾é‡‘è","slug":"åŒºå—é“¾/Hyperledger-Fabric/ä¾›åº”é“¾é‡‘è","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"ä¾›åº”é“¾é‡‘è","slug":"ä¾›åº”é“¾é‡‘è","permalink":"https://guozhe001.github.io/tags/%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D/"}]},{"title":"ç¼–å†™æ‚¨çš„ç¬¬ä¸€ä¸ªChaincode","slug":"blockchain/fabric/ç¼–å†™æ‚¨çš„ç¬¬ä¸€ä¸ªChaincode","date":"2021-04-01T10:18:21.493Z","updated":"2021-04-01T10:18:21.493Z","comments":true,"path":"2021/04/01/blockchain/fabric/ç¼–å†™æ‚¨çš„ç¬¬ä¸€ä¸ªChaincode/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E7%BC%96%E5%86%99%E6%82%A8%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AAChaincode/","excerpt":"","text":"å®˜æ–¹æ–‡æ¡£ Asset Transfer Chaincodeï¼ˆèµ„äº§äº¤æ˜“æ™ºèƒ½åˆçº¦ï¼‰ Our application is a basic sample chaincode to initialize a ledger with assets, create, read, update, and delete assets, check to see if an asset exists, and transfer assets from one owner to another. æˆ‘ä»¬çš„ç¨‹åºæ˜¯ä¸€ä¸ªåŸºæœ¬ç®€å•çš„é“¾ç ï¼Œåˆ©ç”¨èµ„äº§åˆå§‹åŒ–è´¦æœ¬ï¼Œåˆ›å»ºã€è¯»å–ï¼Œæ›´æ–°ä»¥åŠæ›´æ–°èµ„äº§ï¼Œæ£€æŸ¥ä¸€ä¸ªèµ„äº§æ˜¯å¦å­˜åœ¨å¹¶ä¸”æŠŠèµ„äº§ä»ä¸€ä¸ªæ‰€æœ‰è€…äº¤æ˜“ç»™å¦ä¸€ä¸ªæ‰€æœ‰è€…ã€‚ Choosing a Location for the Codeï¼ˆç»™ä»£ç é€‰ä¸€ä¸ªä½ç½®ï¼‰ If you havenâ€™t been doing programming in Go, you may want to make sure that you have Go installed and your system properly configured. We assume you are using a version that supports modules. å¦‚æœä½ è¿˜æ²¡æœ‰ä½¿ç”¨è¿‡Goï¼Œä½ éœ€è¦ç¡®è®¤ä½ çš„ç¯å¢ƒå·²ç»å®‰è£…äº† Goå¹¶é…ç½®å¥½äº†ç¯å¢ƒå˜é‡ã€‚æˆ‘ä»¬å‡è®¾ä½ ä½¿ç”¨çš„æ˜¯æ”¯æŒæ¨¡å—çš„ç‰ˆæœ¬ã€‚ Now, you will want to create a directory for your chaincode application. To keep things simple, letâ€™s use the following command: ç°åœ¨ä½ æƒ³è¦ä¸ºä½ çš„é“¾ç ç¨‹åºåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š 12// atcc is shorthand for asset transfer chaincodemkdir atcc &amp;&amp; cd atcc Now, letâ€™s create the module and the source file that weâ€™ll fill in with code: ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºæ¨¡å—å’Œæºæ–‡ä»¶ï¼Œå¹¶ç”¨ä»£ç å¡«å……å®ƒä»¬ï¼š 12go mod init atcctouch atcc.go Housekeeping(æ•´ç†å·¥ä½œ) First, letâ€™s start with some housekeeping. As with every chaincode, it implements the fabric-contract-api interface, so letâ€™s add the Go import statements for the necessary dependencies for our chaincode. Weâ€™ll import the fabric contract api package and define our SmartContract. é¦–å…ˆè®©æˆ‘ä»¬åšä¸€äº›æ•´ç†å·¥ä½œã€‚æ‰€æœ‰çš„é“¾ç éƒ½å®ç°äº†fabric-contract-api interfaceï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä¸ºGoç¨‹åºæ·»åŠ å¿…è¦çš„ä¾èµ–ã€‚æˆ‘ä»¬ä¼šå¯¼å…¥fabricåˆåŒAPIåŒ…æ¥å®šä¹‰æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ã€‚ 123456789101112package mainimport ( &quot;fmt&quot; &quot;log&quot; &quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot;)// SmartContract provides functions for managing an Asset type SmartContract struct &#123; contractapi.Contract &#125; Next, letâ€™s add a struct Asset to represent simple assets on the ledger. Note the JSON annotations, which will be used to marshal the asset to JSON which is stored on the ledger. ä¸‹ä¸€æ­¥è®©æˆ‘ä»¬å¢åŠ ä¸€ä¸ªAsset ç±»æ¥è¡¨ç¤ºè´¦æœ¬ä¸Šçš„ç®€å•çš„èµ„äº§ã€‚è¯·æ³¨æ„JSONæ³¨é‡Šï¼Œè¯¥æ³¨é‡Šå°†ç”¨äºå°†èµ„äº§ç¼–ç»„ä¸ºå­˜å‚¨åœ¨åˆ†ç±»å¸ä¸­çš„JSONã€‚ 12345678// Asset describes basic details of what makes up a simple asset type Asset struct &#123; ID string `json:&quot;ID&quot;` Color string `json:&quot;color&quot;` Size int `json:&quot;size&quot;` Owner string `json:&quot;owner&quot;` AppraisedValue int `json:&quot;appraisedValue&quot;` &#125; Initializing the Chaincode(åˆå§‹åŒ–é“¾ç ) Next, weâ€™ll implement the InitLedger function to populate the ledger with some initial data. æ¥ä¸‹æ¥æˆ‘ä»¬å®ç°InitLedger æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä½¿ç”¨ä¸€äº›åˆå§‹åŒ–çš„æ•°æ®æ¥å¡«å……è´¦æœ¬ã€‚ 12345678910111213141516171819202122232425// InitLedger adds a base set of assets to the ledger func (s *SmartContract) InitLedger(ctx contractapi.TransactionContextInterface) error &#123; assets := []Asset&#123; &#123;ID: &quot;asset1&quot;, Color: &quot;blue&quot;, Size: 5, Owner: &quot;Tomoko&quot;, AppraisedValue: 300&#125;, &#123;ID: &quot;asset2&quot;, Color: &quot;red&quot;, Size: 5, Owner: &quot;Brad&quot;, AppraisedValue: 400&#125;, &#123;ID: &quot;asset3&quot;, Color: &quot;green&quot;, Size: 10, Owner: &quot;Jin Soo&quot;, AppraisedValue: 500&#125;, &#123;ID: &quot;asset4&quot;, Color: &quot;yellow&quot;, Size: 10, Owner: &quot;Max&quot;, AppraisedValue: 600&#125;, &#123;ID: &quot;asset5&quot;, Color: &quot;black&quot;, Size: 15, Owner: &quot;Adriana&quot;, AppraisedValue: 700&#125;, &#123;ID: &quot;asset6&quot;, Color: &quot;white&quot;, Size: 15, Owner: &quot;Michel&quot;, AppraisedValue: 800&#125;, &#125; for _, asset := range assets &#123; assetJSON, err := json.Marshal(asset) if err != nil &#123; return err &#125; err = ctx.GetStub().PutState(asset.ID, assetJSON) if err != nil &#123; return fmt.Errorf(&quot;failed to put to world state. %v&quot;, err) &#125; &#125; return nil &#125; Next, we write a function to create an asset on the ledger that does not yet exist. When writing chaincode, it is a good idea to check for the existence of something on the ledger prior to taking an action on it, as is demonstrated in the CreateAsset function below. æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªåˆ›å»ºä¸€ä¸ªè´¦æœ¬ä¸Šä¸å­˜åœ¨çš„èµ„äº§çš„æ–¹æ³•ã€‚å½“ç¼–å†™é“¾ç æ—¶ï¼Œæœ€å¥½å…ˆå¯¹åˆ†ç±»å¸è¿›è¡Œæ£€æŸ¥ï¼Œç„¶åå†å¯¹å…¶è¿›è¡Œæ“ä½œï¼Œå¦‚ä¸‹é¢çš„CreateAssetå‡½æ•°æ‰€ç¤ºã€‚ 123456789101112131415161718192021222324// CreateAsset issues a new asset to the world state with given details. func (s *SmartContract) CreateAsset(ctx contractapi.TransactionContextInterface, id string, color string, size int, owner string, appraisedValue int) error &#123; exists, err := s.AssetExists(ctx, id) if err != nil &#123; return err &#125; if exists &#123; return fmt.Errorf(&quot;the asset %s already exists&quot;, id) &#125; asset := Asset&#123; ID: id, Color: color, Size: size, Owner: owner, AppraisedValue: appraisedValue, &#125; assetJSON, err := json.Marshal(asset) if err != nil &#123; return err &#125; return ctx.GetStub().PutState(id, assetJSON) &#125; Now that we have populated the ledger with some initial assets and created an asset, letâ€™s write a function ReadAsset that allows us to read an asset from the ledger. ç°åœ¨æˆ‘ä»¬å·²ç»ä½¿ç”¨åˆå§‹åŒ–èµ„äº§å’Œåˆ›å»ºä¸€ä¸ªèµ„äº§æ¥å¡«å……äº†è´¦æœ¬ï¼Œè®©æˆ‘ä»¬å†™ä¸€ä¸ª ReadAsset æ–¹æ³•æ¥å…è®¸æˆ‘ä»¬è¯»å–è´¦æœ¬ä¸Šçš„èµ„äº§ã€‚ 123456789101112131415161718// ReadAsset returns the asset stored in the world state with given id. func (s *SmartContract) ReadAsset(ctx contractapi.TransactionContextInterface, id string) (*Asset, error) &#123; assetJSON, err := ctx.GetStub().GetState(id) if err != nil &#123; return nil, fmt.Errorf(&quot;failed to read from world state: %v&quot;, err) &#125; if assetJSON == nil &#123; return nil, fmt.Errorf(&quot;the asset %s does not exist&quot;, id) &#125; var asset Asset err = json.Unmarshal(assetJSON, &amp;asset) if err != nil &#123; return nil, err &#125; return &amp;asset, nil &#125; Now that we have assets on our ledger we can interact with, letâ€™s write a chaincode function UpdateAsset that allows us to update attributes of the asset that we are allowed to change. ç°åœ¨æˆ‘ä»¬å·²ç»åœ¨æˆ‘ä»¬çš„è´¦æœ¬ä¸Šæœ‰èµ„äº§å¹¶èƒ½å¤Ÿä¸ä»–ä»¬äº¤äº’äº†ï¼Œè®©æˆ‘ä»¬å†™ä¸€ä¸ªé“¾ç æ–¹æ³• UpdateAsset æ¥ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ›´æ–°å…è®¸æ›´æ”¹çš„èµ„äº§çš„å±æ€§ã€‚ 12345678910111213141516171819202122232425// UpdateAsset updates an existing asset in the world state with provided parameters. func (s *SmartContract) UpdateAsset(ctx contractapi.TransactionContextInterface, id string, color string, size int, owner string, appraisedValue int) error &#123; exists, err := s.AssetExists(ctx, id) if err != nil &#123; return err &#125; if !exists &#123; return fmt.Errorf(&quot;the asset %s does not exist&quot;, id) &#125; // overwriting original asset with new asset asset := Asset&#123; ID: id, Color: color, Size: size, Owner: owner, AppraisedValue: appraisedValue, &#125; assetJSON, err := json.Marshal(asset) if err != nil &#123; return err &#125; return ctx.GetStub().PutState(id, assetJSON) &#125; There may be cases where we need the ability to delete an asset from the ledger, so letâ€™s write a DeleteAsset function to handle that requirement. å¯èƒ½æˆ‘æœ¬éœ€è¦ä»è´¦æœ¬ä¸Šåˆ é™¤ä¸€ä¸ªèµ„äº§ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å†™ä¸€ä¸ª DeleteAsset æ–¹æ³•æ¥å¤„ç†è¿™ä¸ªéœ€æ±‚ã€‚ 123456789101112// DeleteAsset deletes an given asset from the world state. func (s *SmartContract) DeleteAsset(ctx contractapi.TransactionContextInterface, id string) error &#123; exists, err := s.AssetExists(ctx, id) if err != nil &#123; return err &#125; if !exists &#123; return fmt.Errorf(&quot;the asset %s does not exist&quot;, id) &#125; return ctx.GetStub().DelState(id) &#125; We said earlier that is was a good idea to check to see if an asset exists before taking an action on it, so letâ€™s write a function called AssetExists to implement that requirement. æˆ‘ä»¬ä¹‹å‰è¯´åœ¨å¯¹ä¸€ä¸ªèµ„äº§è¿›è¡Œæ“ä½œä¹‹å‰ï¼Œæœ€å¥½å…ˆæ£€æŸ¥è¿™ä¸ªèµ„äº§æ˜¯å¦å­˜åœ¨ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å†™ä¸€ä¸ªåä¸º AssetExistsçš„æ–¹æ³•æ¥å®ç°è¿™ä¸ªéœ€æ±‚ã€‚ 123456789// AssetExists returns true when asset with given ID exists in world state func (s *SmartContract) AssetExists(ctx contractapi.TransactionContextInterface, id string) (bool, error) &#123; assetJSON, err := ctx.GetStub().GetState(id) if err != nil &#123; return false, fmt.Errorf(&quot;failed to read from world state: %v&quot;, err) &#125; return assetJSON != nil, nil &#125; Next, weâ€™ll write a function weâ€™ll call TransferAsset that enables the transfer of an asset from one owner to another. æ¥ç€ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªæˆ‘ä»¬ç§°ä½œTransferAssetçš„æ–¹æ³•ï¼Œè¯¥å‡½æ•°å¯å°†èµ„äº§ä»ä¸€ä¸ªæ‰€æœ‰è€…è½¬ç§»åˆ°å¦ä¸€ä¸ªæ‰€æœ‰è€…ã€‚ 123456789101112131415// TransferAsset updates the owner field of asset with given id in world state. func (s *SmartContract) TransferAsset(ctx contractapi.TransactionContextInterface, id string, newOwner string) error &#123; asset, err := s.ReadAsset(ctx, id) if err != nil &#123; return err &#125; asset.Owner = newOwner assetJSON, err := json.Marshal(asset) if err != nil &#123; return err &#125; return ctx.GetStub().PutState(id, assetJSON) &#125; Letâ€™s write a function weâ€™ll call GetAllAssets that enables the querying of the ledger to return all of the assets on the ledger. è®©æˆ‘ä»¬å†™ä¸€ä¸ª GetAllAssets æ–¹æ³•æ¥æŸ¥è¯¢è´¦æœ¬ä¸Šçš„èµ„äº§ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›è´¦æœ¬ä¸Šçš„æ‰€æœ‰èµ„äº§ã€‚ 123456789101112131415161718192021222324252627// GetAllAssets returns all assets found in world state func (s *SmartContract) GetAllAssets(ctx contractapi.TransactionContextInterface) ([]*Asset, error) &#123;// range query with empty string for startKey and endKey does an// open-ended query of all assets in the chaincode namespace. resultsIterator, err := ctx.GetStub().GetStateByRange(&quot;&quot;, &quot;&quot;) if err != nil &#123; return nil, err &#125; defer resultsIterator.Close() var assets []*Asset for resultsIterator.HasNext() &#123; queryResponse, err := resultsIterator.Next() if err != nil &#123; return nil, err &#125; var asset Asset err = json.Unmarshal(queryResponse.Value, &amp;asset) if err != nil &#123; return nil, err &#125; assets = append(assets, &amp;asset) &#125; return assets, nil &#125; Pulling it All Togetherï¼ˆæŠŠè¿™äº›ä»£ç æ”¾åˆ°ä¸€èµ·ï¼‰ Finally, we need to add the main function, which will call the ContractChaincode.Start function. Hereâ€™s the whole chaincode program source. æœ€ç»ˆæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªè°ƒç”¨ ContractChaincode.Start æ–¹æ³•çš„ main æ–¹æ³•ã€‚ä¸‹é¢å°±æ˜¯å…¨éƒ¨çš„é“¾ç ç¨‹åºæºç ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197package mainimport ( &quot;encoding/json&quot; &quot;fmt&quot; &quot;log&quot; &quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot;)// SmartContract provides functions for managing an Asset type SmartContract struct &#123; contractapi.Contract &#125;// Asset describes basic details of what makes up a simple asset type Asset struct &#123; ID string `json:&quot;ID&quot;` Color string `json:&quot;color&quot;` Size int `json:&quot;size&quot;` Owner string `json:&quot;owner&quot;` AppraisedValue int `json:&quot;appraisedValue&quot;` &#125;// InitLedger adds a base set of assets to the ledger func (s *SmartContract) InitLedger(ctx contractapi.TransactionContextInterface) error &#123; assets := []Asset&#123; &#123;ID: &quot;asset1&quot;, Color: &quot;blue&quot;, Size: 5, Owner: &quot;Tomoko&quot;, AppraisedValue: 300&#125;, &#123;ID: &quot;asset2&quot;, Color: &quot;red&quot;, Size: 5, Owner: &quot;Brad&quot;, AppraisedValue: 400&#125;, &#123;ID: &quot;asset3&quot;, Color: &quot;green&quot;, Size: 10, Owner: &quot;Jin Soo&quot;, AppraisedValue: 500&#125;, &#123;ID: &quot;asset4&quot;, Color: &quot;yellow&quot;, Size: 10, Owner: &quot;Max&quot;, AppraisedValue: 600&#125;, &#123;ID: &quot;asset5&quot;, Color: &quot;black&quot;, Size: 15, Owner: &quot;Adriana&quot;, AppraisedValue: 700&#125;, &#123;ID: &quot;asset6&quot;, Color: &quot;white&quot;, Size: 15, Owner: &quot;Michel&quot;, AppraisedValue: 800&#125;, &#125; for _, asset := range assets &#123; assetJSON, err := json.Marshal(asset) if err != nil &#123; return err &#125; err = ctx.GetStub().PutState(asset.ID, assetJSON) if err != nil &#123; return fmt.Errorf(&quot;failed to put to world state. %v&quot;, err) &#125; &#125; return nil &#125;// CreateAsset issues a new asset to the world state with given details. func (s *SmartContract) CreateAsset(ctx contractapi.TransactionContextInterface, id string, color string, size int, owner string, appraisedValue int) error &#123; exists, err := s.AssetExists(ctx, id) if err != nil &#123; return err &#125; if exists &#123; return fmt.Errorf(&quot;the asset %s already exists&quot;, id) &#125; asset := Asset&#123; ID: id, Color: color, Size: size, Owner: owner, AppraisedValue: appraisedValue, &#125; assetJSON, err := json.Marshal(asset) if err != nil &#123; return err &#125; return ctx.GetStub().PutState(id, assetJSON) &#125;// ReadAsset returns the asset stored in the world state with given id. func (s *SmartContract) ReadAsset(ctx contractapi.TransactionContextInterface, id string) (*Asset, error) &#123; assetJSON, err := ctx.GetStub().GetState(id) if err != nil &#123; return nil, fmt.Errorf(&quot;failed to read from world state: %v&quot;, err) &#125; if assetJSON == nil &#123; return nil, fmt.Errorf(&quot;the asset %s does not exist&quot;, id) &#125; var asset Asset err = json.Unmarshal(assetJSON, &amp;asset) if err != nil &#123; return nil, err &#125; return &amp;asset, nil &#125;// UpdateAsset updates an existing asset in the world state with provided parameters. func (s *SmartContract) UpdateAsset(ctx contractapi.TransactionContextInterface, id string, color string, size int, owner string, appraisedValue int) error &#123; exists, err := s.AssetExists(ctx, id) if err != nil &#123; return err &#125; if !exists &#123; return fmt.Errorf(&quot;the asset %s does not exist&quot;, id) &#125; // overwriting original asset with new asset asset := Asset&#123; ID: id, Color: color, Size: size, Owner: owner, AppraisedValue: appraisedValue, &#125; assetJSON, err := json.Marshal(asset) if err != nil &#123; return err &#125; return ctx.GetStub().PutState(id, assetJSON) &#125; // DeleteAsset deletes an given asset from the world state. func (s *SmartContract) DeleteAsset(ctx contractapi.TransactionContextInterface, id string) error &#123; exists, err := s.AssetExists(ctx, id) if err != nil &#123; return err &#125; if !exists &#123; return fmt.Errorf(&quot;the asset %s does not exist&quot;, id) &#125; return ctx.GetStub().DelState(id) &#125;// AssetExists returns true when asset with given ID exists in world state func (s *SmartContract) AssetExists(ctx contractapi.TransactionContextInterface, id string) (bool, error) &#123; assetJSON, err := ctx.GetStub().GetState(id) if err != nil &#123; return false, fmt.Errorf(&quot;failed to read from world state: %v&quot;, err) &#125; return assetJSON != nil, nil &#125;// TransferAsset updates the owner field of asset with given id in world state. func (s *SmartContract) TransferAsset(ctx contractapi.TransactionContextInterface, id string, newOwner string) error &#123; asset, err := s.ReadAsset(ctx, id) if err != nil &#123; return err &#125; asset.Owner = newOwner assetJSON, err := json.Marshal(asset) if err != nil &#123; return err &#125; return ctx.GetStub().PutState(id, assetJSON) &#125;// GetAllAssets returns all assets found in world state func (s *SmartContract) GetAllAssets(ctx contractapi.TransactionContextInterface) ([]*Asset, error) &#123;// range query with empty string for startKey and endKey does an// open-ended query of all assets in the chaincode namespace. resultsIterator, err := ctx.GetStub().GetStateByRange(&quot;&quot;, &quot;&quot;) if err != nil &#123; return nil, err &#125; defer resultsIterator.Close() var assets []*Asset for resultsIterator.HasNext() &#123; queryResponse, err := resultsIterator.Next() if err != nil &#123; return nil, err &#125; var asset Asset err = json.Unmarshal(queryResponse.Value, &amp;asset) if err != nil &#123; return nil, err &#125; assets = append(assets, &amp;asset) &#125; return assets, nil &#125; func main() &#123; assetChaincode, err := contractapi.NewChaincode(&amp;SmartContract&#123;&#125;) if err != nil &#123; log.Panicf(&quot;Error creating asset-transfer-basic chaincode: %v&quot;, err) &#125; if err := assetChaincode.Start(); err != nil &#123; log.Panicf(&quot;Error starting asset-transfer-basic chaincode: %v&quot;, err) &#125; &#125; Chaincode access control Chaincode can utilize the client (submitter) certificate for access control decisions with ctx.GetStub().GetCreator(). Additionally the Fabric Contract API provides extension APIs that extract client identity from the submitterâ€™s certificate that can be used for access control decisions, whether that is based on client identity itself, or the org identity, or on a client identity attribute. é“¾ç å¯ä»¥é€šè¿‡ ctx.GetStub().GetCreator()åˆ©ç”¨å®¢æˆ·ç«¯ï¼ˆæäº¤è€…ï¼‰è¯ä¹¦è¿›è¡Œè®¿é—®æ§åˆ¶å†³ç­–ã€‚æ­¤å¤–ï¼ŒFabric Contract APIè¿˜æä¾›äº†æ‰©å±•APIï¼Œè¿™äº›APIä»æäº¤è€…çš„è¯ä¹¦ä¸­æå–å®¢æˆ·ç«¯èº«ä»½ï¼Œå¯ç”¨äºè®¿é—®æ§åˆ¶å†³ç­–ï¼Œä¸è®ºæ˜¯åŸºäºå®¢æˆ·ç«¯èº«ä»½æœ¬èº«ï¼Œç»„ç»‡èº«ä»½æˆ–å®¢æˆ·ç«¯èº«ä»½å±æ€§ã€‚ For example an asset that is represented as a key/value may include the clientâ€™s identity as part of the value (for example as a JSON attribute indicating that asset owner), and only this client may be authorized to make updates to the key/value in the future. The client identity library extension APIs can be used within chaincode to retrieve this submitter information to make such access control decisions. ä¾‹å¦‚ï¼Œè¡¨ç¤ºä¸ºé”®/å€¼çš„èµ„äº§å¯èƒ½åŒ…å«å®¢æˆ·çš„èº«ä»½ä½œä¸ºå€¼çš„ä¸€éƒ¨åˆ†ï¼ˆå¦‚ä½œä¸ºè¡¨ç¤ºè¯¥èµ„äº§æ‰€æœ‰è€…çš„JSONå±æ€§ï¼‰ï¼Œå¹¶ä¸”åªæœ‰è¿™ä¸ªå®¢æˆ·ç«¯å¯èƒ½æœ‰æƒé™æ¥åœ¨å°†æ¥æ›´æ–°è¿™äº› key/valueã€‚å®¢æˆ·ç«¯èº«ä»½åº“æ‰©å±•APIå¯ä»¥åœ¨é“¾ç ä¸­ä½¿ç”¨ï¼Œä»¥æ£€ç´¢æ­¤æäº¤è€…ä¿¡æ¯ä»¥åšå‡ºæ­¤ç±»è®¿é—®æ§åˆ¶å†³ç­–ã€‚","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"chaincode","slug":"åŒºå—é“¾/Hyperledger-Fabric/chaincode","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/chaincode/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"chaincode","slug":"chaincode","permalink":"https://guozhe001.github.io/tags/chaincode/"}]},{"title":"æ·»åŠ ä¸€ä¸ªæ–°çš„ç»„ç»‡åˆ°channel","slug":"blockchain/fabric/æ·»åŠ ä¸€ä¸ªæ–°çš„ç»„ç»‡åˆ°channel","date":"2021-04-01T10:18:21.492Z","updated":"2021-04-01T10:18:21.492Z","comments":true,"path":"2021/04/01/blockchain/fabric/æ·»åŠ ä¸€ä¸ªæ–°çš„ç»„ç»‡åˆ°channel/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E7%BB%84%E7%BB%87%E5%88%B0channel/","excerpt":"","text":"æ·»åŠ ä¸€ä¸ªæ–°çš„ç»„ç»‡åˆ°channel å®˜æ–¹æ–‡æ¡£ This tutorial extends the Fabric test network by adding a new organization â€“ Org3 â€“ to an application channel. æœ¬æ•™ç¨‹é€šè¿‡å‘åº”ç”¨ç¨‹åºé€šé“æ·»åŠ æ–°ç»„ç»‡Org3æ‰©å±•äº†Fabricæµ‹è¯•ç½‘ç»œã€‚ While we will focus on adding a new organization to the channel, you can use a similar process to make other channel configuration updates (updating modification policies or altering batch size, for example). To learn more about the process and possibilities of channel config updates in general, check out Updating a channel configuration). Itâ€™s also worth noting that channel configuration updates like the one demonstrated here will usually be the responsibility of an organization admin (rather than a chaincode or application developer). æˆ‘ä»¬å°†ä¸“æ³¨äºå‘channelæ·»åŠ æ–°ç»„ç»‡ï¼Œä½ å¯ä»¥ä½¿ç”¨ç›¸ä¼¼çš„æµç¨‹æ¥è¿›è¡Œå…¶ä»–æƒ…å†µçš„é€šé“é…ç½®æ›´æ–°ã€‚ç•¥ Setup the Environmentï¼ˆå¯åŠ¨ç¯å¢ƒï¼‰ å¯åŠ¨æµ‹è¯•ç¯å¢ƒå¹¶åˆ›å»ºé»˜è®¤çš„channelï¼Œè¯·å‚è€ƒï¼šFabricæµ‹è¯•ç½‘ç»œä½¿ç”¨ Bring Org3 into the Channel with the Scriptï¼ˆä½¿ç”¨è„šæœ¬å°†Org3åŠ å…¥åˆ°é€šé“ï¼‰ You should be in the test-network directory. To use the script, simply issue the following commands: 12cd addOrg3./addOrg3.sh up The output here is well worth reading. Youâ€™ll see the Org3 crypto material being generated, the Org3 organization definition being created, and then the channel configuration being updated, signed, and then submitted to the channel. è¿™é‡Œçš„è¾“å‡ºå€¼çš„æˆ‘ä»¬ä¸€è¯»ã€‚ä½ ä¼šçœ‹åˆ°ç”ŸæˆOrg3ç»„ç»‡çš„åŠ å¯†ææ–™ï¼Œåˆ›å»ºç»„ç»‡Org3çš„å®šä¹‰ç„¶åé€šé“é…ç½®ä¼šè¢«æ›´æ–°ã€ç­¾åå¹¶ä¸”æäº¤åˆ°é€šé“ã€‚ If everything goes well, youâ€™ll get this message: 1========= Finished adding Org3 to your test network! ========= Now that we have confirmed we can add Org3 to our channel, we can go through the steps to update the channel configuration that the script completed behind the scenes. ç°åœ¨æˆ‘ä»¬å·²ç»ç¡®è®¤æˆ‘ä»¬å¯ä»¥æŠŠç»„ç»‡Org3æ·»åŠ åˆ°æˆ‘ä»¬çš„é€šé“ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ›´æ–°é€šé“é…ç½®æ¥å®Œæˆè„šæœ¬åœ¨å¹•åå®Œæˆå·¥ä½œã€‚ Bring Org3 into the Channel Manuallyï¼ˆæ‰‹åŠ¨å°†Org3åŠ å…¥é€šé“ï¼‰ If you just used the addOrg3.sh script, youâ€™ll need to bring your network down. The following command will bring down all running components and remove the crypto material for all organizations: å¦‚æœä½ åˆšæ‰ä½¿ç”¨äº† addOrg3.shè„šæœ¬ï¼Œä½ éœ€è¦å…ˆæŠŠç½‘ç»œå…³é—­ã€‚ä¸‹é¢çš„å‘½ä»¤ä¼šå…³é—­æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ç»„ä»¶å¹¶ä¸”ç§»é™¤æ‰€æœ‰ç»„ç»‡çš„åŠ å¯†ææ–™ï¼š 12cd addOrg3./addOrg3.sh down After the network is brought down, bring it back up againï¼ˆç½‘ç»œå…³é—­ä¹‹åï¼Œé‡æ–°å¯åŠ¨å®ƒï¼‰: 12cd .../network.sh up createChannel This will bring your network back to the same state it was in before you executed the addOrg3.sh script. è¿™å°†ä½¿æ‚¨çš„ç½‘ç»œæ¢å¤åˆ°æ‰§è¡ŒaddOrg3.shè„šæœ¬ä¹‹å‰çš„çŠ¶æ€ã€‚ Now weâ€™re ready to add Org3 to the channel manually. As a first step, weâ€™ll need to generate Org3â€™s crypto material. ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½æ‰‹åŠ¨çš„å°†Org3æ·»åŠ åˆ°é€šé“ä¸­äº†ï¼Œç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦ç”ŸæˆOrg3çš„åŠ å¯†ææ–™ã€‚ Generate the Org3 Crypto Materialï¼ˆç”ŸæˆOrg3çš„åŠ å¯†ææ–™ï¼‰ In another terminal, change into the addOrg3 subdirectory from test-network. åœ¨å¦ä¸€ä¸ªç»ˆç«¯åˆ‡æ¢åˆ° test-networkç›®å½•çš„å­ç›®å½• addOrg3ä¸­ï¼š 1cd addOrg3 First, we are going to create the certificates and keys for the Org3 peer, along with an application and admin user. Because we are updating an example channel, we are going to use the cryptogen tool instead of using a Certificate Authority. The following command uses cryptogen to read the org3-crypto.yaml file and generate the Org3 crypto material in a new org3.example.com folder: é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä¸ºOrg3ç»„ç»‡çš„peerèŠ‚ç‚¹åŒ…æ‹¬åº”ç”¨ç¨‹åºå’Œç®¡ç†å‘˜ç”¨æˆ·åˆ›å»ºè¯ä¹¦å’Œå¯†é’¥ã€‚å› ä¸ºæˆ‘ä»¬æ­£åœ¨æ›´æ–°ç¤ºä¾‹é€šé“ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨cryptogenå·¥å…·è€Œä¸æ˜¯ä½¿ç”¨è¯ä¹¦é¢å‘æœºæ„ã€‚ ä¸‹é¢çš„å‘½ä»¤ä½¿ç”¨cryptogenè¯»å– org3-crypto.yamlæ–‡ä»¶ç„¶ååœ¨æ–°çš„ org3.example.com æ–‡ä»¶å¤¹ä¸‹é¢ç”ŸæˆOrg3çš„åŠ å¯†ææ–™ã€‚ 1../../bin/cryptogen generate --config=org3-crypto.yaml --output=&quot;../organizations&quot;","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"channel","slug":"åŒºå—é“¾/Hyperledger-Fabric/channel","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/channel/"},{"name":"peer","slug":"åŒºå—é“¾/Hyperledger-Fabric/peer","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/peer/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"channel","slug":"channel","permalink":"https://guozhe001.github.io/tags/channel/"},{"name":"peer","slug":"peer","permalink":"https://guozhe001.github.io/tags/peer/"}]},{"title":"contract_chaincode.goæºç å­¦ä¹ ","slug":"blockchain/fabric/æ™ºèƒ½åˆçº¦APIå­¦ä¹ /contract_chaincode.goæºç å­¦ä¹ ","date":"2021-04-01T10:18:21.491Z","updated":"2021-04-01T10:18:21.492Z","comments":true,"path":"2021/04/01/blockchain/fabric/æ™ºèƒ½åˆçº¦APIå­¦ä¹ /contract_chaincode.goæºç å­¦ä¹ /","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6API%E5%AD%A6%E4%B9%A0/contract_chaincode.go%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/","excerpt":"","text":"Chaincodeå¦‚ä½•è¢«å¯ç”¨ å®šä¹‰æ™ºèƒ½åˆçº¦ æˆ‘ä»¬çœ‹ä¸‹é¢çš„ï¼Œåä¸ºSmartContractçš„ç»“æ„ï¼Œå°±æ˜¯æ™ºèƒ½åˆçº¦ï¼Œä½ ä¹Ÿå¯ä»¥èµ·å…¶ä»–çš„åå­—ï¼Œä½†æ˜¯æ— è®ºåå­—å«ä»€ä¹ˆï¼Œæ™ºèƒ½åˆçº¦éƒ½å¿…é¡»æœ‰ä¸€ä¸ªå†…åµŒçš„contractapi.Contractï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒçš„å®šä¹‰ï¼š 123type SmartContract struct &#123; contractapi.Contract&#125; å¯åŠ¨æ™ºèƒ½åˆçº¦çš„å…¥å£ åœ¨æ¯ä¸ªchaincodeä¸­éƒ½å¿…é¡»æœ‰ä¸€ä¸ªmainæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„é“¾ç å¹¶è°ƒç”¨å®ƒçš„Start()æ–¹æ³•ï¼š 1234567891011func main() &#123; // é€šè¿‡NewChaincode()æ–¹æ³•åˆ›å»ºé“¾ç  chaincode, err := contractapi.NewChaincode(new(SmartContract)) if err != nil &#123; log.Panicf(&quot;Error create transfer asset chaincode: %v&quot;, err) &#125; // è°ƒç”¨é“¾ç çš„Start()æ–¹æ³•æ¥å¯åŠ¨é“¾ç  if err := chaincode.Start(); err != nil &#123; log.Panicf(&quot;Error starting asset chaincode: %v&quot;, err) &#125;&#125; æ™ºèƒ½åˆçº¦å¯åŠ¨çš„æºç  è®©æˆ‘ä»¬å®Œæ•´çš„çœ‹ä¸€ä¸‹contractapiçš„æºç ï¼Œæºç è·¯å¾„ï¼šgithub.com/hyperledger/fabric-contract-api-go/contractapi/contract_chaincode.go 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477// Copyright the Hyperledger Fabric contributors. All rights reserved.// SPDX-License-Identifier: Apache-2.0package contractapiimport ( &quot;encoding/json&quot; &quot;fmt&quot; &quot;reflect&quot; &quot;sort&quot; &quot;strings&quot; &quot;unicode&quot; &quot;github.com/hyperledger/fabric-chaincode-go/pkg/cid&quot; &quot;github.com/hyperledger/fabric-chaincode-go/shim&quot; &quot;github.com/hyperledger/fabric-contract-api-go/internal&quot; &quot;github.com/hyperledger/fabric-contract-api-go/internal/utils&quot; &quot;github.com/hyperledger/fabric-contract-api-go/metadata&quot; &quot;github.com/hyperledger/fabric-contract-api-go/serializer&quot; &quot;github.com/hyperledger/fabric-protos-go/peer&quot;)type contractChaincodeContract struct &#123; info metadata.InfoMetadata functions map[string]*internal.ContractFunction unknownTransaction *internal.TransactionHandler beforeTransaction *internal.TransactionHandler afterTransaction *internal.TransactionHandler transactionContextHandler reflect.Type&#125;// ContractChaincode a struct to meet the chaincode interface and provide routing of calls to contractstype ContractChaincode struct &#123; DefaultContract string contracts map[string]contractChaincodeContract metadata metadata.ContractChaincodeMetadata Info metadata.InfoMetadata TransactionSerializer serializer.TransactionSerializer&#125;// SystemContractName the name of the system smart contractconst SystemContractName = &quot;org.hyperledger.fabric&quot;// NewChaincode creates a new chaincode using contracts passed. The function parses each// of the passed functions and stores details about their make-up to be used by the chaincode.// Public functions of the contracts are stored and are made callable in the chaincode. The function// will error if contracts are invalid e.g. public functions take in illegal types. A system contract is added// to the chaincode which provides functionality for getting the metadata of the chaincode. The generated// metadata is a JSON formatted MetadataContractChaincode containing each contract as a name and details// of the public functions and types they take in/return. It also outlines version details for contracts and the// chaincode. If these are blank strings this is set to latest. The names for parameters do not match those used// in the functions, instead they are recorded as param0, param1, ..., paramN. If there exists a file// contract-metadata/metadata.json then this will overwrite the generated metadata. The contents of this file must// validate against the schema. The transaction serializer for the contract is set to be the JSONSerializer by// default. This can be updated using by changing the TransactionSerializer property// ä½¿ç”¨ä¼ å…¥çš„`ContractInterface`åˆ—è¡¨åˆ›å»ºä¸€ä¸ªæ–°çš„é“¾ç ï¼ˆè¯´æ˜é“¾ç å¹¶ä¸æ˜¯æ™ºèƒ½åˆçº¦ï¼Œé“¾ç åŒ…å«äº†å¾ˆå¤šæ™ºèƒ½åˆçº¦ï¼‰ã€‚// è¯¥å‡½æ•°è§£ææ¯ä¸ªè¢«ä¼ é€’è¿‡æ¥çš„`ContractInterface`çš„å‡½æ•°ï¼Œå¹¶å­˜å‚¨æœ‰å…³é“¾ç å°†ä½¿ç”¨çš„å…¶ç»„æˆçš„è¯¦ç»†ä¿¡æ¯ã€‚// contractsçš„å…¬å…±æ–¹æ³•è¢«å­˜å‚¨å¹¶ä¸”å¯ä»¥åœ¨é“¾ç ä¸­è°ƒç”¨è¿™äº›å…¬å…±æ–¹æ³•ã€‚å¦‚æœåˆçº¦å®šä¹‰çš„ä¸åˆæ³•ï¼ˆå¦‚å…¬å…±æ–¹æ³•ä½¿ç”¨éæ³•çš„ç±»å‹ï¼‰è¿™ä¸ªæ–¹æ³•ä¼šæŠ¥é”™ã€‚// ä¸€ä¸ªç³»ç»Ÿåˆçº¦å·²æ·»åŠ åˆ°é“¾ç ä¸­ï¼Œè¯¥åˆçº¦æä¾›äº†è·å–é“¾ç å…ƒæ•°æ®çš„åŠŸèƒ½ã€‚// ç”Ÿæˆçš„å…ƒæ•°æ®æ˜¯JSONæ ¼å¼çš„MetadataContractChaincodeï¼Œå…¶ä¸­åŒ…å«æ¯ä¸ªåˆçº¦çš„åç§°ä»¥åŠå…¬å…±å‡½æ•°ä»¥åŠå®ƒä»¬å‚æ•°å’Œè¿”å›çš„ç±»å‹çš„è¯¦ç»†ä¿¡æ¯ã€‚// å®ƒè¿˜æ¦‚è¿°äº†åˆåŒå’Œé“¾ç çš„ç‰ˆæœ¬è¯¦ç»†ä¿¡æ¯ã€‚ å¦‚æœè¿™äº›æ˜¯ç©ºç™½å­—ç¬¦ä¸²ï¼Œåˆ™å°†å…¶è®¾ç½®ä¸ºæœ€æ–°ã€‚// å…ƒæ•°æ®å¯¹äºå…¬å…±æ–¹æ³•çš„æè¿°çš„å‚æ•°åç§°ä¸åŸå§‹å®šä¹‰çš„å‡½æ•°ä¸­ä½¿ç”¨çš„åç§°ä¸åŒ¹é…ï¼Œè€Œæ˜¯è®°å½•ä¸ºparam0ï¼Œparam1ï¼Œ...ï¼ŒparamNã€‚// å¦‚æœå­˜åœ¨contract-metadata/metadata.jsonæ–‡ä»¶ï¼Œé‚£ä¹ˆå®ƒå°†è¦†ç›–ç”Ÿæˆçš„å…ƒæ•°æ®ã€‚ è¯¥æ–‡ä»¶çš„å†…å®¹å¿…é¡»æ ¹æ®æ¶æ„è¿›è¡ŒéªŒè¯ã€‚// é»˜è®¤æƒ…å†µä¸‹ï¼Œåˆçº¦çš„äº¤æ˜“åºåˆ—åŒ–å™¨è®¾ç½®ä¸ºJSONSerializerã€‚å¯ä»¥é€šè¿‡æ›´æ”¹TransactionSerializerå±æ€§æ¥æ›´æ”¹ã€‚func NewChaincode(contracts ...ContractInterface) (*ContractChaincode, error) &#123; ciMethods := getCiMethods() // newä¸€ä¸ªContractChaincode cc := new(ContractChaincode) // è®¾ç½®ccçš„contractsä¸ºä¸€ä¸ªç©ºmap cc.contracts = make(map[string]contractChaincodeContract) // éå†ä¼ å…¥çš„åˆçº¦åˆ—è¡¨ for _, contract := range contracts &#123; additionalExcludes := []string&#123;&#125; // å¦‚æœä¼ å…¥çš„åˆçº¦ç±»å‹æ˜¯IgnoreContractInterface if castContract, ok := contract.(IgnoreContractInterface); ok &#123; // åˆ™æŠŠcastContractä¸­çš„éœ€è¦å¿½ç•¥çš„æ–¹æ³•èµ‹å€¼ç»™additionalExcludesåˆ‡ç‰‡ additionalExcludes = castContract.GetIgnoredFunctions() &#125; // å‘ccä¸­æ·»åŠ åˆçº¦ï¼Œä¸‹é¢å†çœ‹addContractæ–¹æ³•éƒ½å¹²äº†ä»€ä¹ˆ err := cc.addContract(contract, append(ciMethods, additionalExcludes...)) if err != nil &#123; return nil, err &#125; &#125; // åˆ›å»ºç³»ç»Ÿåˆçº¦ï¼Œå¹¶æŠŠç³»ç»Ÿåˆçº¦æ·»åŠ åˆ°é“¾ç ä¸­ sysC := new(SystemContract) sysC.Name = SystemContractName cc.addContract(sysC, ciMethods) // should never error as system contract is good // å¢åŠ å…ƒæ•°æ® err := cc.augmentMetadata() if err != nil &#123; return nil, err &#125; metadataJSON, _ := json.Marshal(cc.metadata) // æŠŠå…ƒæ•°æ®è®¾ç½®åˆ°ç³»ç»Ÿåˆçº¦ä¸­ sysC.setMetadata(string(metadataJSON)) // è®¾ç½®é“¾ç çš„äº¤æ˜“åºåˆ—åŒ–å™¨ cc.TransactionSerializer = new(serializer.JSONSerializer) return cc, nil&#125;// Start starts the chaincode in the fabric shim// åœ¨fabric shimä¸­å¯åŠ¨é“¾ç // è‡³äºshimæ˜¯ä»€ä¹ˆï¼Œå…ˆäº†è§£å¤§æ¦‚ï¼šshimåŒ…ä¸ºé“¾ç æä¾›APIï¼Œè¿™äº›APIå¯ä»¥è®¿é—®çŠ¶æ€å˜é‡ã€äº¤æ˜“ä¸Šä¸‹æ–‡å’Œè°ƒç”¨å…¶ä»–çš„é“¾ç ã€‚// shimåŒ…æºç æ³¨é‡Šï¼š// Package shim provides APIs for the chaincode to access its state// variables, transaction context and call other chaincodes.func (cc *ContractChaincode) Start() error &#123; return shim.Start(cc)&#125;// Init is called during Instantiate transaction after the chaincode container// has been established for the first time, passes off details of the request to Invoke// for handling the request if a function name is passed, otherwise returns shim.Success// é¦–æ¬¡å»ºç«‹é“¾ç å®¹å™¨åï¼Œåœ¨å®ä¾‹åŒ–äº¤æ˜“ä¹‹å‰è°ƒç”¨Init// å¦‚æœä¸€ä¸ªæ–¹æ³•åè¢«ä¼ é€’äº†è¿‡æ¥ï¼Œåˆ™æŠŠè¯·æ±‚çš„è¯¦æƒ…ä¼ é€’ç»™Invokeæ–¹æ³•æ¥å¤„ç†ï¼Œå¦åˆ™è¿”å›shim.Successfunc (cc *ContractChaincode) Init(stub shim.ChaincodeStubInterface) peer.Response &#123; nsFcn, _ := stub.GetFunctionAndParameters() if nsFcn == &quot;&quot; &#123; return shim.Success([]byte(&quot;Default initiator successful.&quot;)) &#125; return cc.Invoke(stub)&#125;// Invoke is called to update or query the ledger in a proposal transaction. Takes the// args passed in the transaction and uses the first argument to identify the contract// and function of that contract to be called. The remaining args are then used as// parameters to that function. Args are converted from strings to the expected parameter// types of the function before being passed using the set transaction serializer for the ContractChaincode.// A transaction context is generated and is passed, if required, as the first parameter to the named function.// Before and after functions are called before and after the named function passed if the contract defines such// functions to exist. If the before function returns an error the named function is not called and its error// is returned in shim.Error. If the after function returns an error then its value is returned// to shim.Error otherwise the value returned from the named function is returned as shim.Success (formatted by// the transaction serializer). If an unknown name is passed as part of the first arg a shim.Error is returned.// If a valid name is passed but the function name is unknown then the contract with that name&#x27;s// unknown function is called and its value returned as success or error depending on its return. If no// unknown function is defined for the contract then shim.Error is returned by Invoke. In the case of// unknown function names being passed (and the unknown handler returns an error) or the named function// returning an error then the after function if defined is not called. If the named function or unknown// function handler returns a non-error type then then the after transaction is sent this value. The same// transaction context is passed as a pointer to before, after, named and unknown functions on each Invoke.// If no contract name is passed then the default contract is used.func (cc *ContractChaincode) Invoke(stub shim.ChaincodeStubInterface) peer.Response &#123; // è·å–æ–¹æ³•å’Œå…¥å‚ nsFcn, params := stub.GetFunctionAndParameters() // è·å–å­—ç¬¦ä¸²&quot;:&quot;åœ¨nsFcnä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä¸‹æ ‡ li := strings.LastIndex(nsFcn, å­—ç¬¦ä¸²&quot;:&quot;åœ¨) // åˆçº¦ var ns string // æ–¹æ³• var fn string // å¦‚æœnsFcnä¸­ä¸å­˜åœ¨&quot;:&quot;ï¼Œåˆ™è¯´æ˜æ²¡æœ‰æŒ‡å®šåˆçº¦åç§° if li == -1 &#123; ns = cc.DefaultContract fn = nsFcn &#125; else &#123; ns = nsFcn[:li] fn = nsFcn[li+1:] &#125; // å¦‚æœåˆçº¦åä¸åœ¨é“¾ç çš„åˆçº¦é‡Œé¢ï¼Œåˆ™æŠ¥é”™ if _, ok := cc.contracts[ns]; !ok &#123; return shim.Error(fmt.Sprintf(&quot;Contract not found with name %s&quot;, ns)) &#125; // å¦‚æœæ–¹æ³•ä¸ºç©ºï¼Œåˆ™æŠ¥é”™ if fn == &quot;&quot; &#123; return shim.Error(&quot;Blank function name passed&quot;) &#125; originalFn := fn // æŠŠfnå¼ºè½¬æˆrune(int32ç±»å‹çš„åˆ«å) fnRune := []rune(fn) // å¦‚æœä¼ å…¥çš„æ–¹æ³•åçš„é¦–å­—æ¯æ˜¯å°å†™çš„ï¼Œåˆ™è½¬æ¢æˆå¤§å†™ if unicode.IsLower(fnRune[0]) &#123; fnRune[0] = unicode.ToUpper(fnRune[0]) fn = string(fnRune) &#125; // ä»é“¾ç çš„åˆçº¦åˆ—è¡¨ä¸­è·å–åˆçº¦ nsContract := cc.contracts[ns] // é€šè¿‡åå°„newä¸€ä¸ªtransactionContextHandlerç±»å‹ï¼›è¿™å‡ è¡Œæœ‰ç‚¹çœ‹ä¸æ‡‚äº†ï¼Œæš‚åœä¸€ä¸‹TODO ctx := reflect.New(nsContract.transactionContextHandler) ctxIface := ctx.Interface().(SettableTransactionContextInterface) ctxIface.SetStub(stub) ci, _ := cid.New(stub) ctxIface.SetClientIdentity(ci) beforeTransaction := nsContract.beforeTransaction if beforeTransaction != nil &#123; _, _, errRes := beforeTransaction.Call(ctx, nil, nil) if errRes != nil &#123; return shim.Error(errRes.Error()) &#125; &#125; var successReturn string var successIFace interface&#123;&#125; var errorReturn error serializer := cc.TransactionSerializer if _, ok := nsContract.functions[fn]; !ok &#123; unknownTransaction := nsContract.unknownTransaction if unknownTransaction == nil &#123; return shim.Error(fmt.Sprintf(&quot;Function %s not found in contract %s&quot;, originalFn, ns)) &#125; successReturn, successIFace, errorReturn = unknownTransaction.Call(ctx, nil, serializer) &#125; else &#123; var transactionSchema *metadata.TransactionMetadata for _, v := range cc.metadata.Contracts[ns].Transactions &#123; if v.Name == fn &#123; transactionSchema = &amp;v break &#125; &#125; successReturn, successIFace, errorReturn = nsContract.functions[fn].Call(ctx, transactionSchema, &amp;cc.metadata.Components, serializer, params...) &#125; if errorReturn != nil &#123; return shim.Error(errorReturn.Error()) &#125; afterTransaction := nsContract.afterTransaction if afterTransaction != nil &#123; _, _, errRes := afterTransaction.Call(ctx, successIFace, nil) if errRes != nil &#123; return shim.Error(errRes.Error()) &#125; &#125; return shim.Success([]byte(successReturn))&#125;func (cc *ContractChaincode) addContract(contract ContractInterface, excludeFuncs []string) error &#123; // è¿”å›åˆåŒåç§°ã€‚å½“åˆåŒç”¨äºåˆ›å»ºæ–°çš„é“¾ç æ—¶ï¼Œå°†è°ƒç”¨æ­¤å‡½æ•°ï¼Œç„¶åä½¿ç”¨è¿”å›çš„åç§°åœ¨è°ƒç”¨Init/Invokeæ—¶åœ¨é“¾ç ä¸­æ ‡è¯†åˆåŒã€‚ // æ­¤å‡½æ•°å¯ä»¥è¿”å›ç©ºç™½å­—ç¬¦ä¸²ï¼Œä½†è¿™æ˜¯æœªå®šä¹‰çš„è¡Œä¸ºã€‚ ns := contract.GetName() // å¦‚æœåˆçº¦åç§°ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨åˆçº¦ç±»å‹é€šè¿‡åå°„çš„æ–¹å¼è·å–åˆçº¦çš„åç§° if ns == &quot;&quot; &#123; ns = reflect.TypeOf(contract).Elem().Name() &#125; // å¦‚æœé“¾ç ä¸­å·²ç»åŒ…å«äº†ç›¸åŒçš„åˆçº¦åç§°ï¼Œåˆ™æŠ›å¼‚å¸¸ if _, ok := cc.contracts[ns]; ok &#123; return fmt.Errorf(&quot;Multiple contracts being merged into chaincode with name %s&quot;, ns) &#125; ccn := contractChaincodeContract&#123;&#125; ccn.transactionContextHandler = reflect.ValueOf(contract.GetTransactionContextHandler()).Elem().Type() transactionContextPtrHandler := reflect.ValueOf(contract.GetTransactionContextHandler()).Type() ccn.functions = make(map[string]*internal.ContractFunction) // GetInfoæ–¹æ³•è¿”å›å­˜å‚¨çš„åˆçº¦çš„ä¿¡æ¯ï¼Œè¿™ä¸ªä¿¡æ¯ä¼šç”¨äºæ„å»ºåˆçº¦çš„å…ƒæ•°æ®ã€‚å¦‚æœæ­¤ä¿¡æ¯ä¸­çš„ç‰ˆæœ¬ä¿¡æ¯ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨&quot;latest&quot; // å¦‚æœä¿¡æ¯ä¸­çš„titleä¸ºç©ºï¼Œåˆ™ä½¿ç”¨åˆçº¦çš„GetNameæ–¹æ³•è¿”å›çš„åç§°ï¼Œå¦‚æœè¿™ä¸ªåç§°ä¹Ÿä¸ºç©ºï¼Œåˆ™ä½¿ç”¨åˆçº¦çš„ç±»å‹å ccn.info = contract.GetInfo() if ccn.info.Version == &quot;&quot; &#123; ccn.info.Version = &quot;latest&quot; &#125; if ccn.info.Title == &quot;&quot; &#123; ccn.info.Title = ns &#125; contractType := reflect.PtrTo(reflect.TypeOf(contract).Elem()) contractValue := reflect.ValueOf(contract).Elem().Addr() // returns the unknown function to be used for a contract. // When the contract is used in creating a new chaincode this function is called // and the unknown transaction returned is stored. The unknown function is then // called in cases where an unknown function name is passed for a call to the // contract via Init/Invoke of the chaincode. If nil is returned the // chaincode uses its default handling for unknown function names // è¿”å›è¦ç”¨äºåˆçº¦çš„æœªçŸ¥å‡½æ•°ï¼Œå½“åˆçº¦è¢«ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„é“¾ç æ—¶æ­¤æ–¹æ³•è¢«è°ƒç”¨å¹¶ä¸”è¿”å›å­˜å‚¨çš„æœªçŸ¥çš„äº¤æ˜“ã€‚ // åœ¨é“¾ç é€šè¿‡Init/Invokeè°ƒç”¨åˆçº¦æ—¶ï¼Œå¦‚æœä¸€ä¸ªæœªçŸ¥çš„æ–¹æ³•åç§°è¢«ä¼ å…¥äº†åˆ™è°ƒç”¨æ­¤æœªçŸ¥æ–¹æ³• // å¦‚æœæ­¤æ–¹æ³•è¿”å›nilã€‚åˆ™chaincodeä½¿ç”¨ä¸€ä¸ªé»˜è®¤å€¼æ¥å¤„ç†æœªçŸ¥çš„æ–¹æ³•å // ä¸ªäººç†è§£å°±æ˜¯ä¸æŒ‡å®šæ–¹æ³•åè°ƒç”¨åˆçº¦æ—¶çš„é»˜è®¤å¤„ç†é€»è¾‘ã€‚ ut := contract.GetUnknownTransaction() if ut != nil &#123; var err error ccn.unknownTransaction, err = internal.NewTransactionHandler(ut, transactionContextPtrHandler, internal.TransactionHandlerTypeUnknown) if err != nil &#123; return err &#125; &#125; // returns the before function to be used for a contract. // When the contract is used in creating a new chaincode this function is called // and the before transaction returned is stored. The before function is then // called before the named function on each Init/Invoke of that contract via the // chaincode. When called the before function is passed no extra args, only the // the transaction context (if specified to take it). If nil is returned // then no before function is called on Init/Invoke. // è¿”å›éœ€è¦å¯¹æ­¤åˆçº¦ä½¿ç”¨çš„å‰ç½®å‡½æ•°ï¼Œå½“åˆçº¦è¢«ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„é“¾ç æ—¶æ­¤æ–¹æ³•è¢«è°ƒç”¨å¹¶ä¸”è¿”å›å­˜å‚¨çš„å‰ç½®äº¤æ˜“ã€‚ // ç„¶åé€šè¿‡é“¾ç åœ¨è¯¥åˆçº¦ä½¿ç”¨Init/Invokeè°ƒç”¨æŒ‡å®šå‡½æ•°ä¹‹å‰è°ƒç”¨å‰ç½®å‡½æ•°ã€‚ // å½“è°ƒç”¨beforeå‡½æ•°æ—¶ï¼Œä¸ä¼ é€’ä»»ä½•é¢å¤–çš„å‚æ•°ï¼Œä»…ä¼ é€’äº‹åŠ¡ä¸Šä¸‹æ–‡ï¼ˆå¦‚æœæŒ‡å®šä½¿ç”¨å®ƒï¼‰ã€‚ // å¦‚æœæ­¤æ–¹æ³•è¿”å›nilï¼Œåˆ™åœ¨è°ƒç”¨Init/Invokeä¹‹å‰æ²¡æœ‰éœ€è¦æ‰§è¡Œçš„å‡½æ•°ã€‚ bt := contract.GetBeforeTransaction() if bt != nil &#123; var err error ccn.beforeTransaction, err = internal.NewTransactionHandler(bt, transactionContextPtrHandler, internal.TransactionHandlerTypeBefore) if err != nil &#123; return err &#125; &#125; // è·å–åç½®å‡½æ•°ï¼Œåœ¨è°ƒç”¨åˆçº¦çš„æŒ‡å®šæ–¹æ³•ä¹‹åè°ƒç”¨æ­¤å‡½æ•° at := contract.GetAfterTransaction() if at != nil &#123; var err error ccn.afterTransaction, err = internal.NewTransactionHandler(at, transactionContextPtrHandler, internal.TransactionHandlerTypeAfter) if err != nil &#123; return err &#125; &#125; evaluateMethods := []string&#123;&#125; if eci, ok := contract.(EvaluationContractInterface); ok &#123; // returns a list of function names that should be tagged in the // metadata as &quot;evaluate&quot; to indicate to a user of the chaincode that they should query // rather than invoke these functions // è¿”å›åº”è¯¥åœ¨å…ƒæ•°æ®ä¸Šæ‰“ä¸Š&quot;æ±‚å€¼&quot;æ ‡ç­¾çš„æ–¹æ³•åˆ—è¡¨ï¼Œæ¥å‘é“¾ç çš„ç”¨æˆ·å±•ç¤ºä»–ä»¬åº”è¯¥æŸ¥è¯¢è¿™ä¸ªå‡½æ•°è€Œä¸æ˜¯è°ƒç”¨å®ƒ // ä¸ªäººç†è§£ï¼šæ‰€ä»¥è¿™äº›å‡½æ•°åº”è¯¥åªæ˜¯è®¡ç®—ä¸€äº›æ•°æ®çš„ï¼Œä¸ä¼šå¯¹è´¦æœ¬äº§ç”Ÿå½±å“ã€‚å¦‚æœå¯¹è´¦æœ¬äº§ç”Ÿå½±å“åˆæ‰“ä¸Šè¿™ä¸ªæ ‡ç­¾æ˜¯ä¸æ˜¯å¾ˆæµæ°“ï¼Ÿ evaluateMethods = eci.GetEvaluateTransactions() &#125; // éå†åˆçº¦ä¸­çš„æ‰€æœ‰çš„æ–¹æ³• for i := 0; i &lt; contractType.NumMethod(); i++ &#123; typeMethod := contractType.Method(i) valueMethod := contractValue.Method(i) // å¦‚æœæ­¤æ–¹æ³•ä¸å†æ’é™¤çš„åˆ—è¡¨ä¸­ï¼Œåˆ™å¯ä»¥è°ƒç”¨ if !utils.StringInSlice(typeMethod.Name, excludeFuncs) &#123; var err error // é»˜è®¤çš„è°ƒç”¨æ–¹å¼æ˜¯CallTypeSubmit var callType internal.CallType = internal.CallTypeSubmit // å¦‚æœåœ¨åªç”¨äºè®¡ç®—çš„å‡½æ•°åˆ—è¡¨ä¸­ï¼Œåˆ™è°ƒç”¨æ–¹æ³•ä¿®æ”¹ä¸ºCallTypeEvaluateï¼› // ä¸¤æ¬¡è°ƒç”¨StringInSliceä¼šéå†å•Šä¸¤ä¸ªåˆ—è¡¨ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥ç”¨mapæŠŠè¿™é‡Œä¼˜åŒ–ä¸€ä¸‹å‘¢ï¼Ÿ if utils.StringInSlice(typeMethod.Name, evaluateMethods) &#123; callType = internal.CallTypeEvaluate &#125; // åˆ›å»ºåˆçº¦çš„æ–¹æ³• ccn.functions[typeMethod.Name], err = internal.NewContractFunctionFromReflect(typeMethod, valueMethod, callType, transactionContextPtrHandler) if err != nil &#123; return err &#125; &#125; &#125; // å¦‚æœåˆçº¦æ–¹æ³•çš„åˆ—è¡¨ä¸ºç©ºï¼Œåˆ™æŠ¥é”™ï¼Œä¸€ä¸ªåˆçº¦ä¸­è‡³å°‘æœ‰ä¸€ä¸ªå…¬å…±æ–¹æ³• if len(ccn.functions) == 0 &#123; return fmt.Errorf(&quot;Contracts are required to have at least 1 (non-ignored) public method. Contract %s has none. Method names that have been ignored: %s&quot;, ns, utils.SliceAsCommaSentence(excludeFuncs)) &#125; cc.contracts[ns] = ccn // å¦‚æœé“¾ç çš„é»˜è®¤çš„åˆçº¦ä¸ºç©ºï¼Œåˆ™æŠŠå½“å‰çš„åˆçº¦è®¾ç½®ä¸ºé»˜è®¤çš„åˆçº¦ï¼›æ‰€ä»¥ä¼ å…¥çš„ç¬¬ä¸€ä¸ªåˆçº¦å°±æ˜¯é»˜è®¤çš„åˆçº¦ if cc.DefaultContract == &quot;&quot; &#123; cc.DefaultContract = ns &#125; return nil&#125;// åå°„çš„æ–¹å¼è·å–å…ƒæ•°æ®func (cc *ContractChaincode) reflectMetadata() metadata.ContractChaincodeMetadata &#123; reflectedMetadata := metadata.ContractChaincodeMetadata&#123;&#125; reflectedMetadata.Contracts = make(map[string]metadata.ContractMetadata) reflectedMetadata.Components.Schemas = make(map[string]metadata.ObjectMetadata) reflectedMetadata.Info = &amp;cc.Info if cc.Info.Version == &quot;&quot; &#123; reflectedMetadata.Info.Version = &quot;latest&quot; &#125; if cc.Info.Title == &quot;&quot; &#123; reflectedMetadata.Info.Title = &quot;undefined&quot; &#125; // éå†é“¾ç çš„åˆçº¦ for key, contract := range cc.contracts &#123; // åˆ›å»ºåˆçº¦çš„å…ƒæ•°æ® contractMetadata := metadata.ContractMetadata&#123;&#125; contractMetadata.Name = key infoCopy := contract.info contractMetadata.Info = &amp;infoCopy // å¦‚æœè¿™ä¸ªåˆçº¦æ˜¯é»˜è®¤çš„åˆçº¦ï¼Œå…ƒæ•°æ®çš„å­—æ®µä¹Ÿè®¾ç½®ä¸ºtrue if cc.DefaultContract == key &#123; contractMetadata.Default = true &#125; // éå†åˆçº¦çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¹¶åˆ›å»ºæ–¹æ³•çš„å…ƒæ•°æ®ï¼Œæœ€åæŠŠè¿™äº›æ–¹æ³•çš„å…ƒæ•°æ®åŠ å…¥åˆ°åˆçº¦çš„å…ƒæ•°æ® for key, fn := range contract.functions &#123; fnMetadata := fn.ReflectMetadata(key, &amp;reflectedMetadata.Components) contractMetadata.Transactions = append(contractMetadata.Transactions, fnMetadata) &#125; sort.Slice(contractMetadata.Transactions, func(i, j int) bool &#123; return contractMetadata.Transactions[i].Name &lt; contractMetadata.Transactions[j].Name &#125;) reflectedMetadata.Contracts[key] = contractMetadata &#125; return reflectedMetadata&#125;func (cc *ContractChaincode) augmentMetadata() error &#123; // è¯»å–å…ƒæ•°æ®çš„æ–‡ä»¶ï¼Œå°±æ˜¯ä¸Šé¢è¯´çš„contract-metadata/metadata.jsonæ–‡ä»¶ fileMetadata, err := metadata.ReadMetadataFile() // å¦‚æœæŠ¥é”™äº†å¹¶ä¸”æŠ¥é”™ä¿¡æ¯ä¸æ˜¯å› ä¸ºæ–‡ä»¶ä¸å­˜åœ¨çš„é”™è¯¯ï¼Œåˆ™æŠŠé”™è¯¯æŠ›å‡ºå» // ä¼˜åŒ–å»ºè®®ï¼šè¿™é‡Œèƒ½ä¸èƒ½ä½¿ç”¨ä¸åŒçš„errorç±»å‹æ¥åšè¿™ç§åˆ¤æ–­å‘¢ï¼Œè¿™ä¹ˆåˆ¤æ–­å¦‚æœerrorä¿¡æ¯æ›´æ”¹äº†å°±å¿…é¡»ä¸¤ä¸ªåœ°æ–¹åŒæ—¶ä¿®æ”¹ if err != nil &amp;&amp; !strings.Contains(err.Error(), &quot;Failed to read metadata from file&quot;) &#123; return err &#125; reflectedMetadata := cc.reflectMetadata() fileMetadata.Append(reflectedMetadata) err = fileMetadata.CompileSchemas() if err != nil &#123; return err &#125; // éªŒè¯ err = metadata.ValidateAgainstSchema(fileMetadata) if err != nil &#123; return err &#125; cc.metadata = fileMetadata return nil&#125;// getCiMethods è·å–åˆçº¦æ¥å£çš„æ–¹æ³•æè¿°çš„åˆ‡ç‰‡func getCiMethods() []string &#123; // é€šè¿‡åå°„çš„æ–¹å¼è·å–è¿™ä¸ªç±»å‹ contractInterfaceType := reflect.TypeOf((*ContractInterface)(nil)).Elem() ignoreContractInterfaceType := reflect.TypeOf((*IgnoreContractInterface)(nil)).Elem() evaluateContractInterfaceType := reflect.TypeOf((*EvaluationContractInterface)(nil)).Elem() interfaceTypes := []reflect.Type&#123;contractInterfaceType, ignoreContractInterfaceType, evaluateContractInterfaceType&#125; // éå†è¿™äº›åå°„çš„ç±»å‹ï¼ŒæŠŠä»–ä»¬çš„æ–¹æ³•æè¿°æ·»åŠ åˆ°ciMethodsåˆ‡ç‰‡ä¸­ var ciMethods []string for _, interfaceType := range interfaceTypes &#123; for i := 0; i &lt; interfaceType.NumMethod(); i++ &#123; ciMethods = append(ciMethods, interfaceType.Method(i).Name) &#125; &#125; return ciMethods&#125;","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"API","slug":"åŒºå—é“¾/Hyperledger-Fabric/API","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/API/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"API","slug":"API","permalink":"https://guozhe001.github.io/tags/API/"},{"name":"contractapi","slug":"contractapi","permalink":"https://guozhe001.github.io/tags/contractapi/"}]},{"title":"Fabricæ™ºèƒ½åˆçº¦APIå­¦ä¹ ","slug":"blockchain/fabric/æ™ºèƒ½åˆçº¦APIå­¦ä¹ /Fabricæ™ºèƒ½åˆçº¦APIå­¦ä¹ ","date":"2021-04-01T10:18:21.490Z","updated":"2021-04-01T10:18:21.491Z","comments":true,"path":"2021/04/01/blockchain/fabric/æ™ºèƒ½åˆçº¦APIå­¦ä¹ /Fabricæ™ºèƒ½åˆçº¦APIå­¦ä¹ /","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6API%E5%AD%A6%E4%B9%A0/Fabric%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6API%E5%AD%A6%E4%B9%A0/","excerpt":"","text":"è¿™ç¯‡æ–‡æ¡£é€šè¿‡å­¦ä¹ ä¹‹å‰å†™çš„chaincodeæ¥æŸ¥çœ‹Fabricçš„æ™ºèƒ½åˆçº¦ç›¸å…³çš„æºç ã€‚å¹¶å­¦ä¹ è¿™äº›æºç çš„åŠŸèƒ½ã€‚ æ™ºèƒ½åˆçº¦é‡Œé¢çš„æ–¹æ³•å¦‚ä½•å®šä¹‰çš„ æ™ºèƒ½åˆçº¦ä¸­çš„æ¯ä¸ªå¯¼å‡ºçš„æ–¹æ³•éƒ½å¿…é¡»æœ‰contractapi.TransactionContextInterfaceç±»å‹çš„å‚æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•æ˜¯è¢«å®šä¹‰åœ¨SmartContractä¸Šçš„ï¼Œå¦‚ä¸‹é¢ä¸€ä¸ªè·å–èµ„äº§å‡ºä»·ä»·æ ¼çš„æ–¹æ³•ã€‚ 1234// GetAssetBidPrice returns the bid pricefunc (s *SmartContract) GetAssetBidPrice(ctx contractapi.TransactionContextInterface, assetID string) (string, error) &#123; return getAssetPrice(ctx, assetID, typeAssetBid)&#125; contractapi.TransactionContextInterfaceçš„æºç å¦‚ä¸‹ï¼š 1234567891011121314// TransactionContextInterface defines the interface which TransactionContext// meets. This can be taken by transacton functions on a contract which has not set// a custom transaction context to allow transaction functions to take an interface// to simplify unit testing.// äº¤æ˜“ä¸Šä¸‹æ–‡æ¥å£ï¼Œä¸ºäº†æ–¹ä¾¿æµ‹è¯•type TransactionContextInterface interface &#123; // GetStub should provide a way to access the stub set by Init/Invoke // è·å–ç”±Init/Invokeè®¾ç½®çš„å­˜æ ¹ GetStub() shim.ChaincodeStubInterface // GetClientIdentity should provide a way to access the client identity set by Init/Invoke // è·å–ç”±Init/Invokeè®¾ç½®çš„å®¢æˆ·ç«¯èº«ä»½ GetClientIdentity() cid.ClientIdentity&#125; mockæ–¹å¼æµ‹è¯•shim.ChaincodeStubInterfaceä¸­çš„æ–¹æ³• æ¥ç€çœ‹shim.ChaincodeStubInterfaceæœ‰å“ªäº›åŠŸèƒ½ï¼Œæºç åœ¨è¿™é‡Œå°±ä¸è´´äº†ï¼Œç›´æ¥çœ‹æµ‹è¯•ç”¨ä¾‹,ä¸‹é¢çš„æµ‹è¯•ç”¨ä¾‹çš„å…¥å£æ˜¯TestStartï¼Œä¸åŒ…å«å°šæœªå®ç°mockçš„æ–¹æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344package chaincode_testimport ( &quot;encoding/json&quot; &quot;github.com/hyperledger/fabric-chaincode-go/pkg/statebased&quot; &quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot; &quot;log&quot; &quot;testing&quot; &quot;unsafe&quot; &quot;github.com/guozhe001/learn-contractapi-go/chaincode&quot; &quot;github.com/hyperledger/fabric-chaincode-go/shim&quot; &quot;github.com/hyperledger/fabric-chaincode-go/shimtest&quot; &quot;github.com/stretchr/testify/require&quot;)func mockInitLedger(t *testing.T, stub *shimtest.MockStub) &#123; assets := []chaincode.Asset&#123; &#123;ID: AssetId, Color: &quot;blue&quot;, Size: 5, Owner: &quot;Tomoko&quot;, AppraisedValue: 300&#125;, &#123;ID: &quot;asset2&quot;, Color: &quot;red&quot;, Size: 5, Owner: &quot;Brad&quot;, AppraisedValue: 400&#125;, &#123;ID: &quot;asset3&quot;, Color: &quot;green&quot;, Size: 10, Owner: &quot;Jin Soo&quot;, AppraisedValue: 500&#125;, &#123;ID: &quot;asset4&quot;, Color: &quot;yellow&quot;, Size: 10, Owner: &quot;Max&quot;, AppraisedValue: 600&#125;, &#123;ID: &quot;asset5&quot;, Color: &quot;black&quot;, Size: 15, Owner: &quot;Adriana&quot;, AppraisedValue: 700&#125;, &#123;ID: &quot;asset6&quot;, Color: &quot;white&quot;, Size: 15, Owner: &quot;Michel&quot;, AppraisedValue: 800&#125;, &#125; stub.MockTransactionStart(&quot;test&quot;) putState(t, stub, assets...) id := stub.GetTxID() timestamp, err := stub.GetTxTimestamp() channelID := stub.GetChannelID() require.NoError(t, err) require.NotNil(t, timestamp) log.Printf(&quot;GetTxID()=%s, GetTxTimestamp()=%s, GetChannelID()=%s&quot;, id, timestamp, channelID) stub.MockTransactionEnd(&quot;test&quot;)&#125;func marshal(asset chaincode.Asset, t *testing.T) []byte &#123; assetJSON, err := json.Marshal(asset) require.NoError(t, err) return assetJSON&#125;// ChaincodeStubInterface#PutState()func putState(t *testing.T, stub *shimtest.MockStub, assets ...chaincode.Asset) &#123; for _, asset := range assets &#123; log.Printf(&quot;putState=%v&quot;, asset) require.NoError(t, stub.PutState(asset.ID, marshal(asset, t))) &#125;&#125;// ChaincodeStubInterface#GetState()// ChaincodeStubInterface#PutState()// ChaincodeStubInterface#DelState()func getState(assetId string, t *testing.T, stub *shimtest.MockStub) &#123; // è·å–æŒ‡å®škeyçš„èµ„äº§çš„ä¸–ç•ŒçŠ¶æ€ state, err := stub.GetState(assetId) require.NoError(t, err) printAsset(t, state) newAssetID := &quot;temp001&quot; newAsset := chaincode.Asset&#123;ID: newAssetID, Color: &quot;blue&quot;, Size: 5, Owner: &quot;Tomoko&quot;, AppraisedValue: 300&#125; // putä¸€ä¸ªæ–°çš„èµ„äº§ putState(t, stub, newAsset) // æŸ¥è¯¢æ–°çš„èµ„äº§ newState, err := stub.GetState(newAssetID) require.NoError(t, err) require.NotNil(t, newState) printAsset(t, newState) // æŒ‡å®šèµ„äº§IDåˆ é™¤èµ„äº§ require.NoError(t, stub.DelState(newAssetID)) // åˆ é™¤ä¹‹åé‡æ–°æŸ¥è¯¢æ–°çš„èµ„äº§ newStateAgain, err := stub.GetState(newAssetID) require.NoError(t, err) require.Nil(t, newStateAgain)&#125;func getHistoryForKey(assetId string, t *testing.T, stub *shimtest.MockStub) &#123; // è·å–keyçš„å†å²æ•°æ®ï¼Œç›®å‰mockè¿˜æœªå®ç° history, err := stub.GetHistoryForKey(assetId) require.NoError(t, err) if history != nil &#123; if history.HasNext() &#123; next, err := history.Next() require.NoError(t, err) marshal, err := json.Marshal(next) require.NoError(t, err) log.Printf(&quot;asset=%s history=%s&quot;, assetId, marshal) &#125; history.Close() &#125;&#125;func printAsset(t *testing.T, state []byte) &#123; var a chaincode.Asset require.NoError(t, json.Unmarshal(state, &amp;a)) marshal, err := json.Marshal(a) require.NoError(t, err) log.Printf(&quot;result state json value = %s&quot;, marshal)&#125;// ChaincodeStubInterface#GetArgs()// ChaincodeStubInterface#GetStringArgs()func getArgs(t *testing.T, stub *shimtest.MockStub) &#123; args := stub.GetArgs() for _, arg := range args &#123; log.Print(string(arg)) &#125; stringArgs := stub.GetStringArgs() for _, argString := range stringArgs &#123; log.Print(argString) &#125;&#125;// ChaincodeStubInterface#GetStateByRange(startKey, endKey string) (StateQueryIteratorInterface, error)// ChaincodeStubInterface#GetStateByRangeWithPagination(startKey, endKey string, pageSize int32, bookmark string) (StateQueryIteratorInterface, *pb.QueryResponseMetadata, error)func getStateByRange(t *testing.T, stub *shimtest.MockStub) &#123; // GetStateByRangeä¸æŒ‡å®šstartKeyå’ŒendKeyï¼Œä¼šè¿”å›å…¨éƒ¨çš„èµ„äº§ï¼›è°¨æ…ä½¿ç”¨ states, err := stub.GetStateByRange(&quot;&quot;, &quot;&quot;) require.NoError(t, err) printStateQueryIteratorInterface(t, states) // GetStateByRangeWithPagination å› ä¸ºmockStubç›´æ¥è¿”å›ä¸‰ä¸ªnilï¼Œæ‰€ä»¥æ— æ³•åœ¨mockç¯å¢ƒæµ‹è¯• pagination, metadata, err := stub.GetStateByRangeWithPagination(&quot;&quot;, &quot;&quot;, 5, &quot;&quot;) require.NoError(t, err) log.Print(&quot;==========================================================================================&quot;) log.Printf(&quot;GetStateByRangeWithPagination metadata=%v&quot;, metadata) printStateQueryIteratorInterface(t, pagination)&#125;func printStateQueryIteratorInterface(t *testing.T, states shim.StateQueryIteratorInterface) &#123; if states != nil &#123; for states.HasNext() &#123; next, err := states.Next() require.NoError(t, err) log.Print(next) &#125; states.Close() &#125;&#125;// ChaincodeStubInterface#CreateCompositeKey(objectType string, attributes []string) (string, error)// ChaincodeStubInterface#SplitCompositeKey(compositeKey string) (string, []string, error)func createCompositeKey(t *testing.T, stub *shimtest.MockStub) &#123; objectType := &quot;test&quot; attributes := []string&#123;&quot;param1&quot;, &quot;param2&quot;, &quot;param3&quot;, &quot;end&quot;&#125; // åˆ›å»ºç»„åˆkeyï¼Œæ‹¼æ¥äº†ä¸€ä¸‹ key, err := stub.CreateCompositeKey(objectType, attributes) require.NoError(t, err) log.Printf(&quot;key=%s&quot;, key) // åˆ†å‰²ç»„åˆkeyï¼ŒCreateCompositeKeyçš„é€†è¿ç®— compositeKey, strings, err := stub.SplitCompositeKey(key) require.Equal(t, objectType, compositeKey) require.Equal(t, attributes, strings) newAsset := chaincode.Asset&#123;ID: key, Color: &quot;blue&quot;, Size: 5, Owner: &quot;Tomoko&quot;, AppraisedValue: 300&#125; putState(t, stub, newAsset) empty := []string&#123;&#125; // æ ¹æ®åˆ›å»ºç»„åˆkeyçš„å‚æ•°æŸ¥è¯¢ï¼Œåé¢çš„å‚æ•°å¯ä»¥æ˜¯ç©ºï¼Œè¿™æ ·ä¼šå…¨éƒ¨åŒ¹é…å‡ºæ¥ states, err := stub.GetStateByPartialCompositeKey(objectType, empty) require.NoError(t, err) require.NotNil(t, states) printStateQueryIteratorInterface(t, states)&#125;const ( AssetId string = &quot;asset1&quot; TestMSP string = &quot;TestMSP&quot; TestCollection string = &quot;private_TestMSP&quot; Blank string = &quot;&quot;)// ChaincodeStubInterface#SetStateValidationParameter(key string, ep []byte) error// ChaincodeStubInterface#GetStateValidationParameter(key string) ([]byte, error)func setStateValidationParameter(t *testing.T, stub *shimtest.MockStub) &#123; // æ–°å»ºä¸€ä¸ªåŸºäºçŠ¶æ€çš„èƒŒä¹¦ç­–ç•¥ endorsementPolicy, err := statebased.NewStateEP(nil) require.NoError(t, err) // å‘èƒŒä¹¦ç­–ç•¥æ·»åŠ éœ€è¦èƒŒä¹¦çš„å…¬å¸ require.NoError(t, endorsementPolicy.AddOrgs(statebased.RoleTypeMember, TestMSP)) policy, err := endorsementPolicy.Policy() require.NoError(t, err) // SetStateValidationParameterè®¾ç½®åŸºäºçŠ¶æ€çš„èƒŒä¹¦ç­–ç•¥ require.NoError(t, stub.SetStateValidationParameter(AssetId, policy)) // GetStateValidationParameterè·å–åŸºäºçŠ¶æ€çš„èƒŒä¹¦ç­–ç•¥ parameter, err := stub.GetStateValidationParameter(AssetId) require.NoError(t, err) str := byteToString(parameter) // æ‰“å°å‡ºæ¥çš„StateValidationParameteræœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œæ‰€ä»¥ä½¿ç”¨åŒ…å«ä¼ å…¥çš„å­—ç¬¦çš„æ–¹å¼æ–­è¨€ log.Printf(&quot;ID=%s, StateValidationParameter=%s&quot;, AssetId, str) require.Contains(t, str, TestMSP)&#125;// ChaincodeStubInterface#GetPrivateData(collection, key string) ([]byte, error)// ChaincodeStubInterface#GetPrivateDataHash(collection, key string) ([]byte, error) è·å–ç§æœ‰æ•°æ®çš„hashå€¼ï¼Œè¿™ä¸ªæ–¹æ³•å°±ç®—ä¸æ˜¯ç§æœ‰æ•°æ®çš„æ‰€æœ‰è€…ä¹Ÿå¯ä»¥è°ƒç”¨ï¼Œmockç‰ˆæœ¬æ²¡æœ‰å®ç°ï¼›// ChaincodeStubInterface#DelPrivateData(collection, key string) error åˆ é™¤ç§æœ‰æ•°æ®ï¼Œmockç‰ˆæœ¬æ²¡æœ‰å®ç°ï¼›// ChaincodeStubInterface#SetPrivateDataValidationParameter(collection, key string, ep []byte) error è®¾ç½®ç§æœ‰æ•°æ®çš„// ChaincodeStubInterface#GetPrivateDataValidationParameter(collection, key string) ([]byte, error)// ChaincodeStubInterface#GetPrivateDataByRange(collection, startKey, endKey string) (StateQueryIteratorInterface, error) æ ¹æ®èŒƒå›´æŸ¥è¯¢ç§æœ‰æ•°æ®// ChaincodeStubInterface#GetPrivateDataByPartialCompositeKey(collection, objectType string, keys []string) (StateQueryIteratorInterface, error)func getPrivateData(t *testing.T, stub *shimtest.MockStub) &#123; key := &quot;private001&quot; privateAsset := chaincode.Asset&#123;ID: key, Color: &quot;blue&quot;, Size: 5, Owner: &quot;Tomoko&quot;, AppraisedValue: 300&#125; bytes, err := json.Marshal(privateAsset) require.NoError(t, err) // æ·»åŠ ç§æœ‰æ•°æ® require.NoError(t, stub.PutPrivateData(TestCollection, key, bytes)) // è·å–ç§æœ‰èµ„äº§ data, err := stub.GetPrivateData(TestCollection, key) require.NoError(t, err) require.NotNil(t, data) printAsset(t, data) // ä½¿ç”¨ä¸å­˜åœ¨çš„å…¶ä»–çš„collectionè·å–ç§æœ‰èµ„äº§ï¼Œä¸ä¼šè¿”å›errorï¼Œä¼šè¿”å›nilæ•°æ® data, err = stub.GetPrivateData(&quot;test_collections&quot;, key) require.NoError(t, err) require.Nil(t, data) // ä½¿ç”¨å…¶ä»–çš„keyè·å–ä¸å­˜åœ¨ç§æœ‰èµ„äº§ data, err = stub.GetPrivateData(TestCollection, AssetId) require.NoError(t, err) require.Nil(t, data) // æŸ¥è¯¢å…¬å…±èµ„äº§æ•°æ®,æ–­è¨€æ²¡æœ‰è¿™ä¸ªèµ„äº§ state, err := stub.GetState(key) require.NoError(t, err) require.Nil(t, state) endorsementPolicy, err := statebased.NewStateEP(nil) require.NoError(t, err) require.NoError(t, endorsementPolicy.AddOrgs(statebased.RoleTypeMember, TestMSP)) policy, err := endorsementPolicy.Policy() require.NoError(t, err) require.NoError(t, stub.SetPrivateDataValidationParameter(TestCollection, key, policy)) parameter, err := stub.GetPrivateDataValidationParameter(TestCollection, key) require.NoError(t, err) str := byteToString(parameter) // æ‰“å°å‡ºæ¥çš„StateValidationParameteræœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œæ‰€ä»¥ä½¿ç”¨åŒ…å«ä¼ å…¥çš„å­—ç¬¦çš„æ–¹å¼æ–­è¨€ log.Printf(&quot;ID=%s, StateValidationParameter=%s&quot;, AssetId, str) require.Contains(t, str, TestMSP) // GetPrivateDataHash(collection, key string) ([]byte, error) è·å–ç§æœ‰æ•°æ®çš„hashå€¼ï¼Œè¿™ä¸ªæ–¹æ³•å°±ç®—ä¸æ˜¯ç§æœ‰æ•°æ®çš„æ‰€æœ‰è€…ä¹Ÿå¯ä»¥è°ƒç”¨ï¼Œmockç‰ˆæœ¬æ²¡æœ‰å®ç°ï¼› // DelPrivateData(collection, key string) error åˆ é™¤ç§æœ‰æ•°æ®ï¼Œmockç‰ˆæœ¬æ²¡æœ‰å®ç°ï¼› //require.NoError(t, stub.DelPrivateData(TestCollection, key)) //// åˆ é™¤ä¹‹åå†æ¬¡æŸ¥è¯¢ï¼Œæ–­è¨€å·²ç»æ²¡æœ‰æ­¤èµ„äº§ //data, err = stub.GetPrivateData(TestCollection, key) //require.NoError(t, err) //require.Nil(t, state) // GetPrivateDataByRangeæ²¡æœ‰å®ç° //byRange, err := stub.GetPrivateDataByRange(TestCollection, Blank, Blank) //require.NoError(t, err) //require.NotNil(t, byRange) //for byRange.HasNext() &#123; // next, err := byRange.Next() // require.NotNil(t, err) // log.Print(next) //&#125;&#125;func byteToString(data []byte) string &#123; str := (*string)(unsafe.Pointer(&amp;data)) return *str&#125;// ChaincodeStubInterface#ChaincodeStubInterface#GetCreator() ([]byte, error) è·å–ç­¾çº¦äº¤æ˜“æè®®çš„äººï¼Œç­¾çº¦æè®®çš„äººä¹Ÿæ˜¯è¿™ä¸ªäº¤æ˜“çš„åˆ›å»ºè€…; mockstubæœªå®ç°// ChaincodeStubInterface#GetTransient() (map[string][]byte, error) è·å–ä¸´æ—¶æ•°æ®ï¼Œè¿™ä¸ªæ–¹æ³•åªæœ‰è®¾ç½®äº†ä¸´æ—¶æ•°æ®çš„peeræ‰èƒ½æŸ¥åˆ°æ•°æ®ï¼Œä¸»è¦æ˜¯ä¸ºäº†åšéšç§ä¿æŠ¤çš„ï¼Œè¯¦æƒ…å‚è€ƒéšç§˜çš„äº¤æ˜“èµ„äº§// ChaincodeStubInterface#GetBinding() ([]byte, error) TODO å¾…ç†è§£// ChaincodeStubInterface#GetDecorations() ([]byte, error) TODO å¾…ç†è§£,ç›®å‰çœ‹æ˜¯ä¸ºäº†ä¼ é€’æ›´å¤šå…³äºæè®®çš„çš„é¢å¤–æ•°æ®// ChaincodeStubInterface#GetSignedProposal() ([]byte, error) è·å–æè®®// ChaincodeStubInterface#SetEvent(name string, payload []byte) error å…è®¸é“¾ç åœ¨æè®®çš„responseè®¾ç½®ä¸€ä¸ªäº‹ä»¶ã€‚æ— è®ºäº¤æ˜“çš„æœ‰æ•ˆæ€§å¦‚ä½•ï¼Œäº‹ä»¶éƒ½å°†åœ¨å·²æäº¤çš„å—ä¸­çš„äº¤æ˜“å†…å¯ç”¨ã€‚ä¸€ä¸ªäº¤æ˜“åªèƒ½åŒ…å«ä¸€ä¸ªäº‹ä»¶ï¼Œå¹¶ä¸”å¦‚æœæ˜¯é“¾ç è°ƒç”¨å¦ä¸€ä¸ªé“¾ç çš„æƒ…å†µï¼Œäº‹ä»¶åªèƒ½åœ¨æœ€å¤–å±‚ã€‚func stubOthers(t *testing.T, stub *shimtest.MockStub) &#123; m := make(map[string][]byte) tempAsset := chaincode.Asset&#123;ID: &quot;temp001&quot;, Color: &quot;blue&quot;, Size: 5, Owner: &quot;Tomoko&quot;, AppraisedValue: 300&#125; m[&quot;temp_asset&quot;], _ = json.Marshal(tempAsset) require.NoError(t, stub.SetTransient(m)) transient, err := stub.GetTransient() require.NoError(t, err) require.NotNil(t, transient) for k, v := range transient &#123; log.Printf(&quot;k=%s, v=%s&quot;, k, v) &#125; decorations := stub.GetDecorations() for k, v := range decorations &#123; log.Printf(&quot;k=%s, v=%s&quot;, k, v) &#125;&#125;// æµ‹è¯•shim.ChaincodeStubInterfaceæ¥å£func stubTest(t *testing.T, stub *shimtest.MockStub) &#123; assetId := AssetId mockInitLedger(t, stub) stub.MockTransactionStart(&quot;test1&quot;) getState(assetId, t, stub) //getHistoryForKey(assetId, t, stub) getArgs(t, stub) stub.MockTransactionStart(&quot;test1&quot;) getStateByRange(t, stub) createCompositeKey(t, stub) setStateValidationParameter(t, stub) getPrivateData(t, stub) stubOthers(t, stub)&#125;// æµ‹è¯•contractapi.Contractçš„æ–¹æ³•func contractTest(t *testing.T, ccc *contractapi.ContractChaincode, stub *shimtest.MockStub) &#123; log.Printf(&quot;DefaultContract=%s&quot;, ccc.DefaultContract) info := ccc.Info log.Printf(&quot;info=%v&quot;, info) stub.MockTransactionStart(&quot;contract_test&quot;) // å¦‚æœè°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œå¦‚æœå®ç°äº†GetUnknownTransactionæ¥å£ï¼Œåˆ™ä¼šæ‰§è¡Œæ­¤æ¥å£è¿”å›çš„æ–¹æ³•ï¼›å¦åˆ™ä¸æ‰§è¡Œï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯å¦‚æœæœ‰beforeæ–¹æ³•æ˜¯ä¼šæ‰§è¡Œçš„ response := stub.MockInvoke(&quot;uuid_002&quot;, [][]byte&#123;[]byte(&quot;Unknow&quot;)&#125;) log.Printf(&quot;response=%#v, response.Status=%d, response.Payload=%s&quot;, response, response.Status, byteToString(response.Payload)) // è°ƒç”¨ä¸€ä¸ªè¢«å¿½ç•¥çš„æ–¹æ³•, è™½ç„¶IgnoredMeæ–¹æ³•åœ¨æ™ºèƒ½åˆçº¦ä¸­å­˜åœ¨ï¼Œä½†æ˜¯å› ä¸ºåˆçº¦æ»¡è¶³IgnoreContractInterfaceæ¥å£ç„¶åæŠŠè¿™ä¸ªæ–¹æ³•åŠ å…¥åˆ°äº†å¿½ç•¥åˆ—è¡¨ä¸­ï¼Œæ‰€ä»¥æœ€åè¿˜æ˜¯è°ƒç”¨çš„é»˜è®¤æ–¹æ³• response = stub.MockInvoke(&quot;uuid_002&quot;, [][]byte&#123;[]byte(&quot;IgnoredMe&quot;)&#125;) log.Printf(&quot;response=%#v, response.Status=%d, response.Payload=%s&quot;, response, response.Status, byteToString(response.Payload)) // æŒ‡å®šæŸä¸ªæŒ‡å®šåˆçº¦ï¼Œè°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œå†’å·å‰é¢çš„éƒ¨åˆ†æ˜¯æ™ºèƒ½åˆçº¦åç§°ï¼Œåé¢æ˜¯æ–¹æ³•åç§° response = stub.MockInvoke(&quot;uuid_002&quot;, [][]byte&#123;[]byte(&quot;TestSmartContract:Unknow&quot;)&#125;) log.Printf(&quot;response=%#v, response.Status=%d, response.Payload=%s&quot;, response, response.Status, byteToString(response.Payload)) //invoke := ccc.Invoke(stub) //log.Printf(&quot;response=%v&quot;, invoke) stub.MockTransactionEnd(&quot;uuid_001&quot;) transactionSerializer := ccc.TransactionSerializer log.Printf(&quot;transactionSerializer=%v&quot;, transactionSerializer)&#125;// æµ‹è¯•å…¥å£func TestStart(t *testing.T) &#123; // ä¸€ä¸ªé“¾ç åŒ…ä¸­å¯ä»¥æœ‰å¤šä¸ªæ™ºèƒ½åˆçº¦ assetChaincode, err := contractapi.NewChaincode(&amp;chaincode.SmartContract&#123;&#125;, &amp;TestSmartContract&#123;&#125;) require.NoError(t, err) // NewMockStub stub := shimtest.NewMockStub(&quot;mockSub&quot;, assetChaincode) stubTest(t, stub) contractTest(t, assetChaincode, stub)&#125;type TestSmartContract struct &#123; contractapi.Contract&#125;// GetUnknownTransaction returns the current set unknownTransaction, may be nilfunc (t *TestSmartContract) GetUnknownTransaction() interface&#123;&#125; &#123; return t.UnknownTransaction&#125;// Default å¦‚æœä¸æŒ‡å®šæ–¹æ³•åç§°æ—¶æŒ‡å®šçš„é»˜è®¤æ–¹æ³•func (t *TestSmartContract) UnknownTransaction(ctx contractapi.TransactionContextInterface) string &#123; log.Printf(&quot;hello, i&#x27;m Default func in TestSmartContractï¼&quot;) return &quot;i&#x27;m TestSmartContract, Bye!&quot;&#125; åœ¨æ™ºèƒ½åˆçº¦ä¸­æ·»åŠ äº†å¦‚ä¸‹çš„ä¸€äº›æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435363738// GetUnknownTransaction returns the current set unknownTransaction, may be nilfunc (s *SmartContract) GetUnknownTransaction() interface&#123;&#125; &#123; return s.UnknownTransaction&#125;// Default å¦‚æœä¸æŒ‡å®šæ–¹æ³•åç§°æ—¶æŒ‡å®šçš„é»˜è®¤æ–¹æ³•func (s *SmartContract) UnknownTransaction(ctx contractapi.TransactionContextInterface) string &#123; log.Printf(&quot;hello, i&#x27;m Default funcï¼&quot;) return &quot;Bye!&quot;&#125;// GetBeforeTransaction returns the current set beforeTransaction, may be nilfunc (s *SmartContract) GetBeforeTransaction() interface&#123;&#125; &#123; return s.BeforeTransaction&#125;func (s *SmartContract) BeforeTransaction(ctx contractapi.TransactionContextInterface) &#123; log.Printf(&quot;i&#x27;m BeforeTransaction&quot;)&#125;// GetAfterTransaction returns the current set afterTransaction, may be nilfunc (s *SmartContract) GetAfterTransaction() interface&#123;&#125; &#123; return s.AfterTransaction&#125;func (s *SmartContract) AfterTransaction(ctx contractapi.TransactionContextInterface) &#123; log.Printf(&quot;i&#x27;m AfterTransaction&quot;)&#125;func (s *SmartContract) IgnoredMe(ctx contractapi.TransactionContextInterface) &#123; log.Printf(&quot;Ignored Me!&quot;)&#125;func (s *SmartContract) GetIgnoredFunctions() []string &#123; return []string&#123;&quot;IgnoredMe&quot;&#125;&#125; æµ‹è¯•æ— æ³•mockæµ‹è¯•çš„shim.ChaincodeStubInterfaceæ–¹æ³• ä¸€äº›å…¶ä»–çš„æ— æ³•ä½¿ç”¨shimtestsåšmockæµ‹è¯•çš„shim.ChaincodeStubInterfaceæ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119// SomeStubMethod stubå…¶ä»–çš„æ— æ³•é€šè¿‡mockæ–¹å¼æµ‹è¯•çš„æ–¹æ³•ç»ƒä¹ func (s *SmartContract) SomeStubMethod(ctx contractapi.TransactionContextInterface, assetID string) error &#123; stub := ctx.GetStub() // stub.GetArgs()å’Œstub.GetStringArgs()éƒ½æ˜¯è·å–è°ƒç”¨é“¾ç æ—¶çš„å…¥å‚ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ—¶æ–¹æ³•åï¼Œåé¢çš„å‚æ•°æ˜¯è¿™ä¸ªæ–¹æ³•çš„å‚æ•°çš„ä¿¡æ¯,å¦‚ä¸‹ï¼š // 2021/01/25 08:06:32 stub.GetArgs(),i=0, arg=Practice_SmartContract:SomeStubMethod //2021/01/25 08:06:32 stub.GetArgs(),i=1, arg=asset1 for i, arg := range stub.GetArgs() &#123; log.Printf(&quot;stub.GetArgs(),i=%d, arg=%s&quot;, i, byteToString(arg)) &#125; for i, arg := range stub.GetStringArgs() &#123; log.Printf(&quot;stub.GetStringArgs(),i=%d, arg=%s&quot;, i, arg) &#125; binding, err := stub.GetBinding() if err != nil &#123; return err &#125; log.Printf(&quot;stub.GetBinding()=%s&quot;, byteToString(binding)) for k, v := range stub.GetDecorations() &#123; log.Printf(&quot;stub.GetDecorations(), k=%s, v=%s&quot;, k, byteToString(v)) &#125; // stub.GetCreator()è¿”å›çš„æ˜¯è¯ä¹¦ï¼Œå¦‚è¿‡æ˜¯ç»„ç»‡s2.supply.comçš„ç®¡ç†å‘˜å‘èµ·çš„äº¤æ˜“ï¼Œåˆ™æ­¤å¤„è·å¾—çš„æ˜¯ï¼šAdmin@s2.supply.com-cert.pem creator, err := stub.GetCreator() if err != nil &#123; return err &#125; log.Printf(&quot;stub.GetCreator()=%s&quot;, byteToString(creator)) // å·²ç»ç­¾åçš„æè®®ï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š // 1.é€šé“åç§° // 2.é“¾ç åç§° // 3.å‘èµ·äº¤æ˜“çš„ç»„ç»‡åç§° // 4.å‘èµ·äº¤æ˜“çš„äººçš„è¯ä¹¦ // 5.è°ƒç”¨é“¾ç æ—¶çš„å…¥å‚ï¼šæ–¹æ³•åï¼Œå‚æ•°ç­‰ // stub.GetSignedProposal().GetProposalBytes()çš„ä¿¡æ¯å¦‚ä¸‹ï¼š //2021/01/25 08:06:32 stub.GetSignedProposal().GetProposalBytes()= //ï¿½\u0007 //v\b\u0003\u001a \bï¿½ï¿½ï¿½ï¿½\u0006\u0010ï¿½ï¿½ï¿½ï¿½\u0002&quot;\u000ealljoinchannel*@252b6bbd22eeaf2193cdbc86fe7bd9fa257e33a6209a5da7d81dcc41b8bb1b9d:\u0012\u0012\u0010\u0012\u000esecured_supply\u0012ï¿½\u0006 //ï¿½\u0006 // GylSOrg2MSP\u0012ï¿½\u0006-----BEGIN CERTIFICATE----- //MIICETCCAbegAwIBAgIRAJw2YUKkmyKusGHm33D7LhkwCgYIKoZIzj0EAwIwbTEL //MAkGA1UEBhMCVVMxEzARBgNVBAgTCkNhbGlmb3JuaWExFjAUBgNVBAcTDVNhbiBG //cmFuY2lzY28xFjAUBgNVBAoTDXMyLnN1cHBseS5jb20xGTAXBgNVBAMTEGNhLnMy //LnN1cHBseS5jb20wHhcNMjEwMTA3MDgzMTAwWhcNMzEwMTA1MDgzMTAwWjBYMQsw //CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMNU2FuIEZy //YW5jaXNjbzEcMBoGA1UEAwwTQWRtaW5AczIuc3VwcGx5LmNvbTBZMBMGByqGSM49 //AgEGCCqGSM49AwEHA0IABJ6An5vHmug1YBIUXKuD50ZJ79TiwDkW5uEr2ZkXU5Em //XwVlxwCOKpfqKOr1Xdk0DWMlAQPQIxeXktdVBJxFc4KjTTBLMA4GA1UdDwEB/wQE //AwIHgDAMBgNVHRMBAf8EAjAAMCsGA1UdIwQkMCKAIGO9q5qcp089i7bDqwyxRYdg //aX65Bvs4X5wCsXWbxj37MAoGCCqGSM49BAMCA0gAMEUCIQCRBC/uF8ooaLQzSDo6 //e5+4UbBqjSi5MUy3IYfVrM5tHQIgaGHKXcKZY7q0Txs6LsbtayW6kWPOAee6Z1W8 //top2VDc= //-----END CERTIFICATE----- //\u0012\u0018ï¿½wï¿½&#125;dÈ§C&gt;\u000fï¿½vï¿½@ï¿½Elï¿½Sï¿½ï¿½ï¿½ï¿½\u0018\u0012I //G //E\b\u0001\u0012\u0010\u0012\u000esecured_supply\u001a/ //%Practice_SmartContract:SomeStubMethod //\u0006asset1 proposal, err := stub.GetSignedProposal() if err != nil &#123; return err &#125; log.Printf(&quot;stub.GetSignedProposal()=%#v&quot;, proposal) bytes := proposal.GetProposalBytes() log.Printf(&quot;stub.GetSignedProposal().GetProposalBytes()=%s&quot;, byteToString(bytes)) p := &amp;peer.Proposal&#123;&#125; err = proto.Unmarshal(bytes, p) if err != nil &#123; return err &#125; log.Printf(&quot;stub.GetSignedProposal().GetProposalBytes(),proto.Unmarshal=%#v&quot;, p) //headerBytes:= p.GetHeader() //header := &amp;peer.ChaincodeHeaderExtension&#123;&#125; //err = proto.Unmarshal(headerBytes, header) //if err != nil &#123; // return err //&#125; //log.Printf(&quot;stub.GetSignedProposal().GetProposalBytes()-Proposal-GetHeader()=%#v&quot;, header) //payloadBytes := p.GetPayload() //payload := &amp;peer.ChaincodeProposalPayload&#123;&#125; //err = proto.Unmarshal(payloadBytes, payload) //if err != nil &#123; // return err //&#125; //log.Printf(&quot;stub.GetSignedProposal().GetProposalBytes()-Proposal-GetPayload()=%#v&quot;, payload) log.Printf(&quot;stub.GetSignedProposal().GetSignature()=%s&quot;, byteToString(proposal.GetSignature())) // è®¾ç½®ä¸€ä¸ªEvent if err := stub.SetEvent(&quot;hello event&quot;, []byte(&quot;hello&quot;)); err != nil &#123; return err &#125; //2021/01/25 10:22:57 stub.GetHistoryForKey(asset1), next=&amp;queryresult.KeyModification&#123; //TxId:&quot;f251ce5352e294cd628fc0b5d09271ebe8253b41d66069c164195fe2783c3adc&quot;, //Value:[]uint8&#123;0x7b, 0x22, 0x49, 0x44, 0x22, 0x3a, 0x22, 0x61, 0x73, 0x73, 0x65, 0x74, 0x31, 0x22, 0x2c //, 0x22, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x22, 0x3a, 0x22, 0x62, 0x6c, 0x75, 0x65, 0x22, 0x2c, 0x22, 0x73, 0x69, 0x7a, 0x65, 0x22, 0x3a, 0x35, 0x2c, 0x22, 0x6f, 0x77, 0x6e, 0x65, 0x72, 0x22, 0x3a, 0x22, 0x54, 0x6f, 0x6d, 0x6f, 0x6b, 0x6f, 0x22, 0x2c, 0x22, 0x61, 0x70, 0x70, 0x72, 0x61, 0x69, 0x73, 0x65, 0x64, 0x56, 0x61, 0x6c, 0x75, 0x65, 0x22, 0x3a, 0x33, 0x30, 0x30, 0x7d&#125;, //Timestamp:(*timestamp.Timestamp)(0xc00043d1a0), //IsDelete:false, XXX_NoUnkeyedLiteral:struct &#123;&#125;&#123;&#125;, //XXX_unrecognized:[]uint8(nil), //XXX_sizecache:0&#125; assetHistory, err := stub.GetHistoryForKey(assetID) if err != nil &#123; return err &#125; defer assetHistory.Close() for assetHistory.HasNext() &#123; next, err := assetHistory.Next() if err != nil &#123; return err &#125; log.Printf(&quot;stub.GetHistoryForKey(%s), next=%#v&quot;, assetID, next) &#125; return nil&#125;func byteToString(data []byte) string &#123; str := (*string)(unsafe.Pointer(&amp;data)) return *str&#125; shimåŒ…ä¸‹é¢ä¹Ÿæœ‰ä¸€ä¸ªGetMSPIDæ–¹æ³•ï¼Œå…·ä½“å¦‚ä¸‹ï¼š 12345678910111213// GetMSPID returns the local mspid of the peer by checking the CORE_PEER_LOCALMSPID// env var and returns an error if the env var is not set// é€šè¿‡æ£€æŸ¥ç¯å¢ƒå˜é‡CORE_PEER_LOCALMSPIDè¿”å›peerèŠ‚ç‚¹æœ¬åœ°çš„mspidï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®è¿™ä¸ªç¯å¢ƒå˜é‡åˆ™è¿”å›ä¸€ä¸ªerrorfunc GetMSPID() (string, error) &#123; mspid := os.Getenv(&quot;CORE_PEER_LOCALMSPID&quot;) if mspid == &quot;&quot; &#123; return &quot;&quot;, errors.New(&quot;&#x27;CORE_PEER_LOCALMSPID&#x27; is not set&quot;) &#125; return mspid, nil&#125; TODO å¾…æ•´åˆåˆ°ä¸€èµ· 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684/* SPDX-License-Identifier: Apache-2.0*/package mainimport ( &quot;bytes&quot; &quot;crypto/sha256&quot; &quot;encoding/json&quot; &quot;fmt&quot; &quot;log&quot; &quot;time&quot; &quot;github.com/golang/protobuf/ptypes&quot; &quot;github.com/hyperledger/fabric-chaincode-go/pkg/statebased&quot; &quot;github.com/hyperledger/fabric-chaincode-go/shim&quot; &quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot;)const ( typeAssetForSale = &quot;S&quot; typeAssetBid = &quot;B&quot; typeAssetSaleReceipt = &quot;SR&quot; typeAssetBuyReceipt = &quot;BR&quot; statusEnable = &quot;enable&quot; statusDelete = &quot;delete&quot;)type SmartContract struct &#123; contractapi.Contract&#125;// Asset struct and properties must be exported (start with capitals) to work with contract api metadatatype Asset struct &#123; ObjectType string `json:&quot;objectType&quot;` // ObjectType is used to distinguish different object types in the same chaincode namespace ID string `json:&quot;assetID&quot;` OwnerOrg string `json:&quot;ownerOrg&quot;` PublicDescription string `json:&quot;publicDescription&quot;` Status string `json:&quot;status&quot;` ParentID string `json:&quot;parentID&quot;`&#125;type receipt struct &#123; price int timestamp time.Time&#125;// AssetProperties èµ„äº§å±æ€§type AssetProperties struct &#123; ObjectType string `json:&quot;objectType&quot;` // ObjectType is used to distinguish different object types in the same chaincode namespace ID string `json:&quot;assetID&quot;` Issuer string `json:&quot;issuer&quot;` Amount int `json:&quot;amount&quot;` CreateDate time.Time `json:&quot;createDate&quot;` EndDate time.Time `json:&quot;endDate&quot;` Salt string `json:&quot;salt&quot;`&#125;// CreateAsset creates an asset and sets it as owned by the client&#x27;s orgfunc (s *SmartContract) CreateAsset(ctx contractapi.TransactionContextInterface, assetID, publicDescription string) error &#123; // è·å–ä¸´æ—¶æ•°æ®åº“çš„æ•°æ®ï¼Œè¿”å›ä¸€ä¸ªmap[string][]byte transientMap, err := ctx.GetStub().GetTransient() if err != nil &#123; return fmt.Errorf(&quot;error getting transient: %v&quot;, err) &#125; // Asset properties must be retrieved from the transient field as they are private immutablePropertiesJSON, ok := transientMap[&quot;asset_properties&quot;] fmt.Println(&quot;immutablePropertiesJSON:&quot;, immutablePropertiesJSON) if !ok &#123; return fmt.Errorf(&quot;asset_properties key not found in the transient map&quot;) &#125; return createAsset(ctx, immutablePropertiesJSON, assetID, publicDescription, &quot;&quot;)&#125;// CreateAsset creates an asset and sets it as owned by the client&#x27;s orgfunc createAsset(ctx contractapi.TransactionContextInterface, immutablePropertiesJSON []byte, assetID, publicDescription string, parentID string) error &#123; // Get client org id and verify it matches peer org id. // In this scenario, client is only authorized to read/write private data from its own peer. clientOrgID, err := getClientOrgID(ctx, true) fmt.Println(&quot;clientOrgID:&quot;, clientOrgID) if err != nil &#123; return fmt.Errorf(&quot;failed to get verified OrgID: %v&quot;, err) &#125; asset := Asset&#123; ObjectType: &quot;asset&quot;, ID: assetID, OwnerOrg: clientOrgID, PublicDescription: publicDescription, Status: statusEnable, ParentID: parentID, &#125; fmt.Println(&quot;asset:&quot;, asset) assetBytes, err := json.Marshal(asset) if err != nil &#123; return fmt.Errorf(&quot;failed to create asset JSON: %v&quot;, err) &#125; err = ctx.GetStub().PutState(asset.ID, assetBytes) if err != nil &#123; return fmt.Errorf(&quot;failed to put asset in public data: %v&quot;, err) &#125; // Set the endorsement policy such that an owner org peer is required to endorse future updates err = setAssetStateBasedEndorsement(ctx, asset.ID, clientOrgID) if err != nil &#123; return fmt.Errorf(&quot;failed setting state based endorsement for owner: %v&quot;, err) &#125; // Persist private immutable asset properties to owner&#x27;s private data collection collection := buildCollectionName(clientOrgID) fmt.Println(&quot;collection:&quot;, collection) err = ctx.GetStub().PutPrivateData(collection, asset.ID, immutablePropertiesJSON) if err != nil &#123; return fmt.Errorf(&quot;failed to put Asset private details: %v&quot;, err) &#125; return nil&#125;// // verifyAssetProperties éªŒè¯èµ„äº§å±æ€§çš„ä¿¡æ¯// func verifyAssetProperties(immutablePropertiesJSON []byte, asset Asset) error &#123;// assetProperties, err := getAssetProperties(immutablePropertiesJSON)// if err != nil &#123;// return err// &#125;// // èµ„äº§çš„å±æ€§IDå’Œèµ„äº§IDç›¸åŒ// if asset.ID != assetProperties.ID &#123;// return fmt.Errorf(&quot;èµ„äº§IDå’Œèµ„äº§å±æ€§IDå¿…é¡»ç›¸åŒ&quot;)// &#125;// // èµ„äº§çš„å‘è¡Œè€…å°±æ˜¯èµ„äº§çš„åˆ›å»ºè€…ï¼Œæ‰€æœ‰äººéƒ½å¯ä»¥å‘è¡Œï¼Œä½†æ˜¯åˆ«äººè®¤ä¸è®¤å¯è¿™ä¸ªç»„ç»‡å‘è¡Œçš„èµ„äº§æ˜¯å¦ä¸€å›äº‹// if asset.OwnerOrg != assetProperties.Issuer &#123;// return fmt.Errorf(&quot;èµ„äº§çš„å‘è¡Œæ–¹å¿…é¡»æ˜¯å½“å‰åˆ›å»ºèµ„äº§çš„ç»„ç»‡&quot;)// &#125;// // ç†è®ºä¸Šè¿™é‡Œåº”è¯¥è¿˜æœ‰æ›´å¤šçš„æ ¡éªŒï¼Œæ¯”å¦‚è¯´åˆ›å»ºæ—¶é—´å’Œå¤±æ•ˆæ—¶é—´çš„éªŒè¯// return nil// &#125;// ChangePublicDescription updates the assets public description. Only the current owner can update the public descriptionfunc (s *SmartContract) ChangePublicDescription(ctx contractapi.TransactionContextInterface, assetID string, newDescription string) error &#123; asset, err := s.ReadAsset(ctx, assetID) if err != nil &#123; return fmt.Errorf(&quot;failed to get asset: %v&quot;, err) &#125; return changeOriginAssetInfo(ctx, *asset, &quot;&quot;, newDescription)&#125;// AgreeToSell adds seller&#x27;s asking price to seller&#x27;s implicit private data collectionfunc (s *SmartContract) AgreeToSell(ctx contractapi.TransactionContextInterface, assetID string) error &#123; asset, err := s.ReadAsset(ctx, assetID) if err != nil &#123; return err &#125; clientOrgID, err := getClientOrgID(ctx, true) if err != nil &#123; return fmt.Errorf(&quot;failed to get verified OrgID: %v&quot;, err) &#125; // Verify that this clientOrgId actually owns the asset. if clientOrgID != asset.OwnerOrg &#123; return fmt.Errorf(&quot;a client from %s cannot sell an asset owned by %s&quot;, clientOrgID, asset.OwnerOrg) &#125; return agreeToPrice(ctx, assetID, typeAssetForSale)&#125;// AgreeToBuy adds buyer&#x27;s bid price to buyer&#x27;s implicit private data collectionfunc (s *SmartContract) AgreeToBuy(ctx contractapi.TransactionContextInterface, assetID string) error &#123; return agreeToPrice(ctx, assetID, typeAssetBid)&#125;// agreeToPrice adds a bid or ask price to caller&#x27;s implicit private data collectionfunc agreeToPrice(ctx contractapi.TransactionContextInterface, assetID string, priceType string) error &#123; // In this scenario, client is only authorized to read/write private data from its own peer. clientOrgID, err := getClientOrgID(ctx, true) if err != nil &#123; return fmt.Errorf(&quot;failed to get verified OrgID: %v&quot;, err) &#125; transMap, err := ctx.GetStub().GetTransient() if err != nil &#123; return fmt.Errorf(&quot;error getting transient: %v&quot;, err) &#125; // Asset price must be retrieved from the transient field as they are private price, ok := transMap[&quot;asset_price&quot;] if !ok &#123; return fmt.Errorf(&quot;asset_price key not found in the transient map&quot;) &#125; collection := buildCollectionName(clientOrgID) // Persist the agreed to price in a collection sub-namespace based on priceType key prefix, // to avoid collisions between private asset properties, sell price, and buy price assetPriceKey, err := ctx.GetStub().CreateCompositeKey(priceType, []string&#123;assetID&#125;) if err != nil &#123; return fmt.Errorf(&quot;failed to create composite key: %v&quot;, err) &#125; // The Price hash will be verified later, therefore always pass and persist price bytes as is, // so that there is no risk of nondeterministic marshaling. err = ctx.GetStub().PutPrivateData(collection, assetPriceKey, price) if err != nil &#123; return fmt.Errorf(&quot;failed to put asset bid: %v&quot;, err) &#125; return nil&#125;// VerifyAssetProperties Allows a buyer to validate the properties of// an asset against the owner&#x27;s implicit private data collectionfunc (s *SmartContract) VerifyAssetProperties(ctx contractapi.TransactionContextInterface, assetID string) (bool, error) &#123; transMap, err := ctx.GetStub().GetTransient() if err != nil &#123; return false, fmt.Errorf(&quot;error getting transient: %v&quot;, err) &#125; /// Asset properties must be retrieved from the transient field as they are private immutablePropertiesJSON, ok := transMap[&quot;asset_properties&quot;] if !ok &#123; return false, fmt.Errorf(&quot;asset_properties key not found in the transient map&quot;) &#125; asset, err := s.ReadAsset(ctx, assetID) if err != nil &#123; return false, fmt.Errorf(&quot;failed to get asset: %v&quot;, err) &#125; // æ·»åŠ èµ„äº§çŠ¶æ€çš„éªŒè¯ if (*asset).Status != statusEnable &#123; return false, fmt.Errorf(&quot;èµ„äº§ä¸å¯ä»¥ï¼Œä¸å…è®¸äº¤æ˜“: %v&quot;, err) &#125; collectionOwner := buildCollectionName(asset.OwnerOrg) immutablePropertiesOnChainHash, err := ctx.GetStub().GetPrivateDataHash(collectionOwner, assetID) if err != nil &#123; return false, fmt.Errorf(&quot;failed to read asset private properties hash from seller&#x27;s collection: %v&quot;, err) &#125; if immutablePropertiesOnChainHash == nil &#123; return false, fmt.Errorf(&quot;asset private properties hash does not exist: %s&quot;, assetID) &#125; hash := sha256.New() hash.Write(immutablePropertiesJSON) calculatedPropertiesHash := hash.Sum(nil) // verify that the hash of the passed immutable properties matches the on-chain hash if !bytes.Equal(immutablePropertiesOnChainHash, calculatedPropertiesHash) &#123; return false, fmt.Errorf(&quot;hash %x for passed immutable properties %s does not match on-chain hash %x&quot;, calculatedPropertiesHash, immutablePropertiesJSON, immutablePropertiesOnChainHash, ) &#125; return true, nil&#125;// TransferAsset checks transfer conditions and then transfers asset state to buyer.// TransferAsset can only be called by current ownerfunc (s *SmartContract) TransferAsset(ctx contractapi.TransactionContextInterface, assetID string, buyerOrgID string) error &#123; clientOrgID, err := getClientOrgID(ctx, false) if err != nil &#123; return fmt.Errorf(&quot;failed to get verified OrgID: %v&quot;, err) &#125; transMap, err := ctx.GetStub().GetTransient() if err != nil &#123; return fmt.Errorf(&quot;error getting transient data: %v&quot;, err) &#125; immutablePropertiesJSON, ok := transMap[&quot;asset_properties&quot;] if !ok &#123; return fmt.Errorf(&quot;asset_properties key not found in the transient map&quot;) &#125; priceJSON, ok := transMap[&quot;asset_price&quot;] if !ok &#123; return fmt.Errorf(&quot;asset_price key not found in the transient map&quot;) &#125; var agreement Agreement err = json.Unmarshal(priceJSON, &amp;agreement) if err != nil &#123; return fmt.Errorf(&quot;failed to unmarshal price JSON: %v&quot;, err) &#125; asset, err := s.ReadAsset(ctx, assetID) if err != nil &#123; return fmt.Errorf(&quot;failed to get asset: %v&quot;, err) &#125; // æ·»åŠ èµ„äº§çŠ¶æ€çš„éªŒè¯ if (*asset).Status != statusEnable &#123; return fmt.Errorf(&quot;èµ„äº§ä¸å¯ä»¥ï¼Œä¸å…è®¸äº¤æ˜“&quot;) &#125; err = verifyTransferConditions(ctx, asset, immutablePropertiesJSON, clientOrgID, buyerOrgID, priceJSON) if err != nil &#123; return fmt.Errorf(&quot;failed transfer verification: %v&quot;, err) &#125; err = transferAssetState(ctx, asset, immutablePropertiesJSON, clientOrgID, buyerOrgID, agreement.Price) if err != nil &#123; return fmt.Errorf(&quot;failed asset transfer: %v&quot;, err) &#125; return nil&#125;// SplitAsset æ‹†åˆ†èµ„äº§ä¸ºä¸¤ä¸ªèµ„äº§ï¼Œä¼ å…¥çš„amountæ˜¯æ‹†åˆ†åçš„å…¶ä¸­ä¸€ä¸ªèµ„äº§çš„é‡‘é¢func (s *SmartContract) SplitAsset(ctx contractapi.TransactionContextInterface, assetID string, amount int) error &#123; asset, err := s.ReadAsset(ctx, assetID) if err != nil &#123; return err &#125; immutableProperties, err := getAssetPrivateProperties(ctx, assetID) if err != nil &#123; return err &#125; assetProperties, err := getAssetProperties(immutableProperties) if err != nil &#123; return err &#125; if assetProperties.Amount &lt;= amount &#123; return fmt.Errorf(&quot;èµ„äº§IDçš„é‡‘é¢ä¸º%då°äºæƒ³è¦æ‹†åˆ†çš„é‡‘é¢ä¸º%dï¼Œä¸å…è®¸æ‹†åˆ†&quot;, assetProperties.Amount, amount) &#125; if err := splitAsset(ctx, assetProperties, assetID+&quot;1&quot;, amount, *asset); err != nil &#123; return err &#125; if err := splitAsset(ctx, assetProperties, assetID+&quot;2&quot;, assetProperties.Amount-amount, *asset); err != nil &#123; return err &#125; // æ‹†åˆ†ä¹‹ååˆ é™¤æ—§èµ„äº§ collection := buildCollectionName((*asset).OwnerOrg) err = ctx.GetStub().DelPrivateData(collection, asset.ID) if err != nil &#123; return fmt.Errorf(&quot;failed to delete Asset private details from org: %v&quot;, err) &#125; // ä¿®æ”¹å…¬å…±èµ„äº§ä¿¡æ¯ changeOriginAssetInfo(ctx, *asset, statusDelete, &quot;å·²æ‹†åˆ†&quot;) return nil&#125;// æ ¹æ®transientè·å–çš„assetPropertiesçš„å­—èŠ‚æ•°ç»„è·å–AssetPropertiesfunc getAssetProperties(immutablePropertiesJSON []byte) (AssetProperties, error) &#123; var assetProperties AssetProperties if err := json.Unmarshal(immutablePropertiesJSON, &amp;assetProperties); err != nil &#123; return assetProperties, fmt.Errorf(&quot;failed to unmarshal price JSON: %v&quot;, err) &#125; return assetProperties, nil&#125;// ChangePublicDescription updates the assets public description. Only the current owner can update the public descriptionfunc changeOriginAssetInfo(ctx contractapi.TransactionContextInterface, asset Asset, status string, newDescription string) error &#123; // No need to check client org id matches peer org id, rely on the asset ownership check instead. clientOrgID, err := getClientOrgID(ctx, false) if err != nil &#123; return fmt.Errorf(&quot;failed to get verified OrgID: %v&quot;, err) &#125; // Auth check to ensure that client&#x27;s org actually owns the asset if clientOrgID != asset.OwnerOrg &#123; return fmt.Errorf(&quot;a client from %s cannot update the description of a asset owned by %s&quot;, clientOrgID, asset.OwnerOrg) &#125; // æ·»åŠ èµ„äº§çŠ¶æ€çš„éªŒè¯ if asset.Status != statusEnable &#123; return fmt.Errorf(&quot;èµ„äº§ä¸å¯ç”¨ï¼Œä¸å…è®¸ä¿®æ”¹&quot;) &#125; if status != &quot;&quot; &#123; asset.Status = status &#125; if newDescription != &quot;&quot; &#123; asset.PublicDescription = newDescription &#125; updatedAssetJSON, err := json.Marshal(asset) if err != nil &#123; return fmt.Errorf(&quot;failed to marshal asset: %v&quot;, err) &#125; return ctx.GetStub().PutState(asset.ID, updatedAssetJSON)&#125;// splitAsset ä»åŸå§‹èµ„äº§å±æ€§æ‹†åˆ†æˆæŒ‡å®šIDå’Œé‡‘é¢çš„èµ„äº§func splitAsset(ctx contractapi.TransactionContextInterface, originAssetProperties AssetProperties, newAssetID string, newAmount int, asset Asset) error &#123; originAssetProperties.Amount = newAmount originAssetProperties.ID = newAssetID immutablePropertiesJSON, err := json.Marshal(originAssetProperties) if err != nil &#123; return err &#125; return createAsset(ctx, immutablePropertiesJSON, newAssetID, asset.PublicDescription, asset.ID)&#125;// verifyTransferConditions checks that client org currently owns asset and that both parties have agreed on pricefunc verifyTransferConditions(ctx contractapi.TransactionContextInterface, asset *Asset, immutablePropertiesJSON []byte, clientOrgID string, buyerOrgID string, priceJSON []byte) error &#123; // CHECK1: Auth check to ensure that client&#x27;s org actually owns the asset if clientOrgID != asset.OwnerOrg &#123; return fmt.Errorf(&quot;a client from %s cannot transfer a asset owned by %s&quot;, clientOrgID, asset.OwnerOrg) &#125; // CHECK2: Verify that the hash of the passed immutable properties matches the on-chain hash collectionSeller := buildCollectionName(clientOrgID) immutablePropertiesOnChainHash, err := ctx.GetStub().GetPrivateDataHash(collectionSeller, asset.ID) if err != nil &#123; return fmt.Errorf(&quot;failed to read asset private properties hash from seller&#x27;s collection: %v&quot;, err) &#125; if immutablePropertiesOnChainHash == nil &#123; return fmt.Errorf(&quot;asset private properties hash does not exist: %s&quot;, asset.ID) &#125; hash := sha256.New() hash.Write(immutablePropertiesJSON) calculatedPropertiesHash := hash.Sum(nil) // verify that the hash of the passed immutable properties matches the on-chain hash if !bytes.Equal(immutablePropertiesOnChainHash, calculatedPropertiesHash) &#123; return fmt.Errorf(&quot;hash %x for passed immutable properties %s does not match on-chain hash %x&quot;, calculatedPropertiesHash, immutablePropertiesJSON, immutablePropertiesOnChainHash, ) &#125; // CHECK3: Verify that seller and buyer agreed on the same price // Get sellers asking price assetForSaleKey, err := ctx.GetStub().CreateCompositeKey(typeAssetForSale, []string&#123;asset.ID&#125;) if err != nil &#123; return fmt.Errorf(&quot;failed to create composite key: %v&quot;, err) &#125; sellerPriceHash, err := ctx.GetStub().GetPrivateDataHash(collectionSeller, assetForSaleKey) if err != nil &#123; return fmt.Errorf(&quot;failed to get seller price hash: %v&quot;, err) &#125; if sellerPriceHash == nil &#123; return fmt.Errorf(&quot;seller price for %s does not exist&quot;, asset.ID) &#125; // Get buyers bid price collectionBuyer := buildCollectionName(buyerOrgID) assetBidKey, err := ctx.GetStub().CreateCompositeKey(typeAssetBid, []string&#123;asset.ID&#125;) if err != nil &#123; return fmt.Errorf(&quot;failed to create composite key: %v&quot;, err) &#125; // TODO ç–‘é—®ï¼šè¿™ä¸ªæ–¹æ³•æ˜¯ç”±èµ„äº§æ‹¥æœ‰è€…è°ƒç”¨çš„ï¼Œé‚£ä¹ˆèµ„äº§æ‹¥æœ‰è€…æ€ä¹ˆå¯ä»¥è·å–èµ„äº§ä¹°æ–¹çš„å‡ºä»·ä¿¡æ¯å‘¢ï¼Ÿå¦‚æœæ˜¯ä»å…¬å…±çŠ¶æ€è·å–è´­ä¹°æ–¹çš„å‡ºä»·hashæ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯ä»è´­ä¹°æ–¹çš„ç§æœ‰æ•°æ®é›†ä¸­è·å–å‡ºä»·hashå¾ˆè®©äººè´¹è§£ã€‚ buyerPriceHash, err := ctx.GetStub().GetPrivateDataHash(collectionBuyer, assetBidKey) if err != nil &#123; return fmt.Errorf(&quot;failed to get buyer price hash: %v&quot;, err) &#125; if buyerPriceHash == nil &#123; return fmt.Errorf(&quot;buyer price for %s does not exist&quot;, asset.ID) &#125; hash = sha256.New() hash.Write(priceJSON) calculatedPriceHash := hash.Sum(nil) // Verify that the hash of the passed price matches the on-chain sellers price hash if !bytes.Equal(calculatedPriceHash, sellerPriceHash) &#123; return fmt.Errorf(&quot;hash %x for passed price JSON %s does not match on-chain hash %x, seller hasn&#x27;t agreed to the passed trade id and price&quot;, calculatedPriceHash, priceJSON, sellerPriceHash, ) &#125; // Verify that the hash of the passed price matches the on-chain buyer price hash if !bytes.Equal(calculatedPriceHash, buyerPriceHash) &#123; return fmt.Errorf(&quot;hash %x for passed price JSON %s does not match on-chain hash %x, buyer hasn&#x27;t agreed to the passed trade id and price&quot;, calculatedPriceHash, priceJSON, buyerPriceHash, ) &#125; return nil&#125;// transferAssetState performs the public and private state updates for the transferred assetfunc transferAssetState(ctx contractapi.TransactionContextInterface, asset *Asset, immutablePropertiesJSON []byte, clientOrgID string, buyerOrgID string, price int) error &#123; asset.OwnerOrg = buyerOrgID updatedAsset, err := json.Marshal(asset) if err != nil &#123; return err &#125; err = ctx.GetStub().PutState(asset.ID, updatedAsset) if err != nil &#123; return fmt.Errorf(&quot;failed to write asset for buyer: %v&quot;, err) &#125; // Change the endorsement policy to the new owner err = setAssetStateBasedEndorsement(ctx, asset.ID, buyerOrgID) if err != nil &#123; return fmt.Errorf(&quot;failed setting state based endorsement for new owner: %v&quot;, err) &#125; // Transfer the private properties (delete from seller collection, create in buyer collection) collectionSeller := buildCollectionName(clientOrgID) err = ctx.GetStub().DelPrivateData(collectionSeller, asset.ID) if err != nil &#123; return fmt.Errorf(&quot;failed to delete Asset private details from seller: %v&quot;, err) &#125; collectionBuyer := buildCollectionName(buyerOrgID) err = ctx.GetStub().PutPrivateData(collectionBuyer, asset.ID, immutablePropertiesJSON) if err != nil &#123; return fmt.Errorf(&quot;failed to put Asset private properties for buyer: %v&quot;, err) &#125; // Delete the price records for seller assetPriceKey, err := ctx.GetStub().CreateCompositeKey(typeAssetForSale, []string&#123;asset.ID&#125;) if err != nil &#123; return fmt.Errorf(&quot;failed to create composite key for seller: %v&quot;, err) &#125; err = ctx.GetStub().DelPrivateData(collectionSeller, assetPriceKey) if err != nil &#123; return fmt.Errorf(&quot;failed to delete asset price from implicit private data collection for seller: %v&quot;, err) &#125; // Delete the price records for buyer assetPriceKey, err = ctx.GetStub().CreateCompositeKey(typeAssetBid, []string&#123;asset.ID&#125;) if err != nil &#123; return fmt.Errorf(&quot;failed to create composite key for buyer: %v&quot;, err) &#125; err = ctx.GetStub().DelPrivateData(collectionBuyer, assetPriceKey) if err != nil &#123; return fmt.Errorf(&quot;failed to delete asset price from implicit private data collection for buyer: %v&quot;, err) &#125; // Keep record for a &#x27;receipt&#x27; in both buyers and sellers private data collection to record the sale price and date. // Persist the agreed to price in a collection sub-namespace based on receipt key prefix. receiptBuyKey, err := ctx.GetStub().CreateCompositeKey(typeAssetBuyReceipt, []string&#123;asset.ID, ctx.GetStub().GetTxID()&#125;) if err != nil &#123; return fmt.Errorf(&quot;failed to create composite key for receipt: %v&quot;, err) &#125; txTimestamp, err := ctx.GetStub().GetTxTimestamp() if err != nil &#123; return fmt.Errorf(&quot;failed to create timestamp for receipt: %v&quot;, err) &#125; timestamp, err := ptypes.Timestamp(txTimestamp) if err != nil &#123; return err &#125; assetReceipt := receipt&#123; price: price, timestamp: timestamp, &#125; receipt, err := json.Marshal(assetReceipt) if err != nil &#123; return fmt.Errorf(&quot;failed to marshal receipt: %v&quot;, err) &#125; err = ctx.GetStub().PutPrivateData(collectionBuyer, receiptBuyKey, receipt) if err != nil &#123; return fmt.Errorf(&quot;failed to put private asset receipt for buyer: %v&quot;, err) &#125; receiptSaleKey, err := ctx.GetStub().CreateCompositeKey(typeAssetSaleReceipt, []string&#123;ctx.GetStub().GetTxID(), asset.ID&#125;) if err != nil &#123; return fmt.Errorf(&quot;failed to create composite key for receipt: %v&quot;, err) &#125; err = ctx.GetStub().PutPrivateData(collectionSeller, receiptSaleKey, receipt) if err != nil &#123; return fmt.Errorf(&quot;failed to put private asset receipt for seller: %v&quot;, err) &#125; return nil&#125;// getClientOrgID gets the client org ID.// The client org ID can optionally be verified against the peer org ID, to ensure that a client// from another org doesn&#x27;t attempt to read or write private data from this peer.// The only exception in this scenario is for TransferAsset, since the current owner// needs to get an endorsement from the buyer&#x27;s peer.func getClientOrgID(ctx contractapi.TransactionContextInterface, verifyOrg bool) (string, error) &#123; // GetClientIdentity()è·å–å®¢æˆ·ç«¯çš„èº«ä»½ï¼Œè¿”å›ClientIdentityæ¥å£ï¼Œè¿™ä¸ªæ¥å£æœ‰å¦‚ä¸‹æ–¹æ³•ï¼š // GetID returns the ID associated with the invoking identity. This ID // is guaranteed to be unique within the MSP. // * GetID() (string, error) è·å– clientOrgID, err := ctx.GetClientIdentity().GetMSPID() if err != nil &#123; return &quot;&quot;, fmt.Errorf(&quot;failed getting client&#x27;s orgID: %v&quot;, err) &#125; if verifyOrg &#123; err = verifyClientOrgMatchesPeerOrg(clientOrgID) if err != nil &#123; return &quot;&quot;, err &#125; &#125; return clientOrgID, nil&#125;// verifyClientOrgMatchesPeerOrg checks the client org id matches the peer org id.func verifyClientOrgMatchesPeerOrg(clientOrgID string) error &#123; peerOrgID, err := shim.GetMSPID() if err != nil &#123; return fmt.Errorf(&quot;failed getting peer&#x27;s orgID: %v&quot;, err) &#125; if clientOrgID != peerOrgID &#123; return fmt.Errorf(&quot;client from org %s is not authorized to read or write private data from an org %s peer&quot;, clientOrgID, peerOrgID, ) &#125; return nil&#125;// setAssetStateBasedEndorsement adds an endorsement policy to a asset so that only a peer from an owning org// can update or transfer the asset.func setAssetStateBasedEndorsement(ctx contractapi.TransactionContextInterface, assetID string, orgToEndorse string) error &#123; endorsementPolicy, err := statebased.NewStateEP(nil) if err != nil &#123; return err &#125; err = endorsementPolicy.AddOrgs(statebased.RoleTypeMember, orgToEndorse) if err != nil &#123; return fmt.Errorf(&quot;failed to add org to endorsement policy: %v&quot;, err) &#125; policy, err := endorsementPolicy.Policy() if err != nil &#123; return fmt.Errorf(&quot;failed to create endorsement policy bytes from org: %v&quot;, err) &#125; // fmt.Printf(&quot;assetID=%s, orgToEndorse=%s, policy=%s, len(policy)=%d \\n&quot;, assetID, orgToEndorse, policy, len(policy)) // fmt.Printf(&quot;assetID=%s, policy=%s, endorsementPolicy.ListOrgs=%s\\n&quot;, assetID, string(policy[:]), endorsementPolicy.ListOrgs()) return ctx.GetStub().SetStateValidationParameter(assetID, policy)&#125;func buildCollectionName(clientOrgID string) string &#123; return fmt.Sprintf(&quot;_implicit_org_%s&quot;, clientOrgID)&#125;func getClientImplicitCollectionName(ctx contractapi.TransactionContextInterface) (string, error) &#123; clientOrgID, err := getClientOrgID(ctx, true) if err != nil &#123; return &quot;&quot;, fmt.Errorf(&quot;failed to get verified OrgID: %v&quot;, err) &#125; err = verifyClientOrgMatchesPeerOrg(clientOrgID) if err != nil &#123; return &quot;&quot;, err &#125; return buildCollectionName(clientOrgID), nil&#125;func main() &#123; chaincode, err := contractapi.NewChaincode(new(SmartContract)) if err != nil &#123; log.Panicf(&quot;Error create transfer asset chaincode: %v&quot;, err) &#125; if err := chaincode.Start(); err != nil &#123; log.Panicf(&quot;Error starting asset chaincode: %v&quot;, err) &#125;&#125;","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"API","slug":"åŒºå—é“¾/Hyperledger-Fabric/API","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/API/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"API","slug":"API","permalink":"https://guozhe001.github.io/tags/API/"}]},{"title":"ClientIdentityæ¥å£ç»ƒä¹ ","slug":"blockchain/fabric/æ™ºèƒ½åˆçº¦APIå­¦ä¹ /ClientIdentityæ¥å£ç»ƒä¹ ","date":"2021-04-01T10:18:21.489Z","updated":"2021-04-01T10:18:21.490Z","comments":true,"path":"2021/04/01/blockchain/fabric/æ™ºèƒ½åˆçº¦APIå­¦ä¹ /ClientIdentityæ¥å£ç»ƒä¹ /","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6API%E5%AD%A6%E4%B9%A0/ClientIdentity%E6%8E%A5%E5%8F%A3%E7%BB%83%E4%B9%A0/","excerpt":"","text":"å­¦ä¹ /github.com/hyperledger/fabric-chaincode-go/pkg/cid/interfaces.goä¸­çš„ClientIdentityæ¥å£ï¼Œæºç å¦‚ä¸‹ï¼Œæ¯”è¾ƒç®€å•ï¼š æºç  12345678910111213141516171819202122232425262728293031323334// ClientIdentity represents information about the identity that submitted the// transaction// ClientIdentityè¡¨ç¤ºæäº¤äº¤æ˜“çš„èº«ä»½çš„ä¿¡æ¯type ClientIdentity interface &#123; // GetID returns the ID associated with the invoking identity. This ID // is guaranteed to be unique within the MSP. // è¿”å›ä¸è°ƒç”¨è€…èº«ä»½å…³è”çš„IDã€‚è¯¥IDåœ¨MSPä¸­ä¿è¯æ˜¯å”¯ä¸€çš„ã€‚ GetID() (string, error) // Return the MSP ID of the client // è·å–å®¢æˆ·ç«¯çš„MSPçš„ID GetMSPID() (string, error) // GetAttributeValue returns the value of the client&#x27;s attribute named `attrName`. // If the client possesses the attribute, `found` is true and `value` equals the // value of the attribute. // If the client does not possess the attribute, `found` is false and `value` // equals &quot;&quot;. // è¿”å›åä¸º`attrName`çš„å®¢æˆ·ç«¯çš„å±æ€§ä¿¡æ¯ // å¦‚æœå®¢æˆ·ç«¯æœ‰è¿™ä¸ªå±æ€§ï¼Œè¿”å›å€¼`found`ç­‰äºtrueå¹¶ä¸”è¿”å›å€¼`value`ç­‰äºè¿™ä¸ªå±æ€§ã€‚ // å¦‚æœè¿™ä¸ªå®¢æˆ·ç«¯ä¸æ‹¥æœ‰è¿™ä¸ªå±æ€§ï¼Œ`found`ç­‰äºfalseå¹¶ä¸”`value`ç­‰äº&quot;&quot;ã€‚ GetAttributeValue(attrName string) (value string, found bool, err error) // AssertAttributeValue verifies that the client has the attribute named `attrName` // with a value of `attrValue`; otherwise, an error is returned. // éªŒè¯å®¢æˆ·ç«¯æ˜¯å¦æœ‰åä¸º`attrName`çš„å±æ€§ï¼Œå¹¶ä¸”å€¼ä¸º`attrValue`ï¼›å¦‚æœæ²¡æœ‰æˆ–è€…å€¼ä¸ä¸€è‡´åˆ™è¿”å›ä¸€ä¸ªerror AssertAttributeValue(attrName, attrValue string) error // GetX509Certificate returns the X509 certificate associated with the client, // or nil if it was not identified by an X509 certificate. // è¿”å›ä¸å®¢æˆ·ç«¯å…³è”çš„X509è¯ä¹¦ï¼Œå¦‚æœæ²¡æœ‰è¢«X509è¯ä¹¦æ ‡è¯†ï¼Œåˆ™è¿”å›nilã€‚ GetX509Certificate() (*x509.Certificate, error)&#125; æµ‹è¯•ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142package mainimport ( &quot;github.com/hyperledger/fabric-contract-api-go/contractapi&quot; &quot;log&quot;)// ClientIdentityPractice ClientIdentityæ¥å£æä¾›çš„æ–¹æ³•ç»ƒä¹ func (s *SmartContract) ClientIdentityPractice(ctx contractapi.TransactionContextInterface) error &#123; log.Println(&quot;ClientIdentityPractice==================start=====================&quot;) clientIdentity := ctx.GetClientIdentity() id, err := clientIdentity.GetID() if err != nil &#123; return err &#125; log.Printf(&quot;clientIdentity.GetID()=%s&quot;, id) mspid, err := clientIdentity.GetMSPID() if err != nil &#123; return err &#125; log.Printf(&quot;clientIdentity.GetMSPID()=%s&quot;, mspid) certificate, err := clientIdentity.GetX509Certificate() if err != nil &#123; return err &#125; log.Printf(&quot;clientIdentity.GetX509Certificate()=%#v&quot;, certificate) value, found, err := clientIdentity.GetAttributeValue(&quot;test&quot;) if err != nil &#123; return err &#125; if found &#123; log.Printf(&quot;clientIdentity.GetAttributeValue(\\&quot;test\\&quot;)=%s&quot;, value) &#125; if err := clientIdentity.AssertAttributeValue(&quot;test&quot;, &quot;hello&quot;); err != nil &#123; log.Printf(&quot;clientIdentity.AssertAttributeValue(\\&quot;test\\&quot;, \\&quot;hello\\&quot;) error!&quot;) return err &#125; log.Println(&quot;ClientIdentityPractice===================end======================&quot;) return nil&#125; æµ‹è¯•æ—¥å¿— 123452021&#x2F;01&#x2F;25 03:42:33 ClientIdentityPractice&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;start&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;2021&#x2F;01&#x2F;25 03:42:33 clientIdentity.GetID()&#x3D;eDUwOTo6Q049QWRtaW5AczIuc3VwcGx5LmNvbSxMPVNhbiBGcmFuY2lzY28sU1Q9Q2FsaWZvcm5pYSxDPVVTOjpDTj1jYS5zMi5zdXBwbHkuY29tLE89czIuc3VwcGx5LmNvbSxMPVNhbiBGcmFuY2lzY28sU1Q9Q2FsaWZvcm5pYSxDPVVT2021&#x2F;01&#x2F;25 03:42:33 clientIdentity.GetMSPID()&#x3D;GylSOrg2MSP2021&#x2F;01&#x2F;25 03:42:33 clientIdentity.GetX509Certificate()&#x3D;&amp;x509.Certificate&#123;Raw:[]uint8&#123;0x30, 0x82, 0x2, 0x11, 0x30, 0x82, 0x1, 0xb7, 0xa0, 0x3, 0x2, 0x1, 0x2, 0x2, 0x11, 0x0, 0x9c, 0x36, 0x61, 0x42, 0xa4, 0x9b, 0x22, 0xae, 0xb0, 0x61, 0xe6, 0xdf, 0x70, 0xfb, 0x2e, 0x19, 0x30, 0xa, 0x6, 0x8, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x4, 0x3, 0x2, 0x30, 0x6d, 0x31, 0xb, 0x30, 0x9, 0x6, 0x3, 0x55, 0x4, 0x6, 0x13, 0x2, 0x55, 0x53, 0x31, 0x13, 0x30, 0x11, 0x6, 0x3, 0x55, 0x4, 0x8, 0x13, 0xa, 0x43, 0x61, 0x6c, 0x69, 0x66, 0x6f, 0x72, 0x6e, 0x69, 0x61, 0x31, 0x16, 0x30, 0x14, 0x6, 0x3, 0x55, 0x4, 0x7, 0x13, 0xd, 0x53, 0x61, 0x6e, 0x20, 0x46, 0x72, 0x61, 0x6e, 0x63, 0x69, 0x73, 0x63, 0x6f, 0x31, 0x16, 0x30, 0x14, 0x6, 0x3, 0x55, 0x4, 0xa, 0x13, 0xd, 0x73, 0x32, 0x2e, 0x73, 0x75, 0x70, 0x70, 0x6c, 0x79, 0x2e, 0x63, 0x6f, 0x6d, 0x31, 0x19, 0x30, 0x17, 0x6, 0x3, 0x55, 0x4, 0x3, 0x13, 0x10, 0x63, 0x61, 0x2e, 0x73, 0x32, 0x2e, 0x73, 0x75, 0x70, 0x70, 0x6c, 0x79, 0x2e, 0x63, 0x6f, 0x6d, 0x30, 0x1e, 0x17, 0xd, 0x32, 0x31, 0x30, 0x31, 0x30, 0x37, 0x30, 0x38, 0x33, 0x31, 0x30, 0x30, 0x5a, 0x17, 0xd, 0x33, 0x31, 0x30, 0x31, 0x30, 0x35, 0x30, 0x38, 0x33, 0x31, 0x30, 0x30, 0x5a, 0x30, 0x58, 0x31, 0xb, 0x30, 0x9, 0x6, 0x3, 0x55, 0x4, 0x6, 0x13, 0x2, 0x55, 0x53, 0x31, 0x13, 0x30, 0x11, 0x6, 0x3, 0x55, 0x4, 0x8, 0x13, 0xa, 0x43, 0x61, 0x6c, 0x69, 0x66, 0x6f, 0x72, 0x6e, 0x69, 0x61, 0x31, 0x16, 0x30, 0x14, 0x6, 0x3, 0x55, 0x4, 0x7, 0x13, 0xd, 0x53, 0x61, 0x6e, 0x20, 0x46, 0x72, 0x61, 0x6e, 0x63, 0x69, 0x73, 0x63, 0x6f, 0x31, 0x1c, 0x30, 0x1a, 0x6, 0x3, 0x55, 0x4, 0x3, 0xc, 0x13, 0x41, 0x64, 0x6d, 0x69, 0x6e, 0x40, 0x73, 0x32, 0x2e, 0x73, 0x75, 0x70, 0x70, 0x6c, 0x79, 0x2e, 0x63, 0x6f, 0x6d, 0x30, 0x59, 0x30, 0x13, 0x6, 0x7, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x2, 0x1, 0x6, 0x8, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x3, 0x1, 0x7, 0x3, 0x42, 0x0, 0x4, 0x9e, 0x80, 0x9f, 0x9b, 0xc7, 0x9a, 0xe8, 0x35, 0x60, 0x12, 0x14, 0x5c, 0xab, 0x83, 0xe7, 0x46, 0x49, 0xef, 0xd4, 0xe2, 0xc0, 0x39, 0x16, 0xe6, 0xe1, 0x2b, 0xd9, 0x99, 0x17, 0x53, 0x91, 0x26, 0x5f, 0x5, 0x65, 0xc7, 0x0, 0x8e, 0x2a, 0x97, 0xea, 0x28, 0xea, 0xf5, 0x5d, 0xd9, 0x34, 0xd, 0x63, 0x25, 0x1, 0x3, 0xd0, 0x23, 0x17, 0x97, 0x92, 0xd7, 0x55, 0x4, 0x9c, 0x45, 0x73, 0x82, 0xa3, 0x4d, 0x30, 0x4b, 0x30, 0xe, 0x6, 0x3, 0x55, 0x1d, 0xf, 0x1, 0x1, 0xff, 0x4, 0x4, 0x3, 0x2, 0x7, 0x80, 0x30, 0xc, 0x6, 0x3, 0x55, 0x1d, 0x13, 0x1, 0x1, 0xff, 0x4, 0x2, 0x30, 0x0, 0x30, 0x2b, 0x6, 0x3, 0x55, 0x1d, 0x23, 0x4, 0x24, 0x30, 0x22, 0x80, 0x20, 0x63, 0xbd, 0xab, 0x9a, 0x9c, 0xa7, 0x4f, 0x3d, 0x8b, 0xb6, 0xc3, 0xab, 0xc, 0xb1, 0x45, 0x87, 0x60, 0x69, 0x7e, 0xb9, 0x6, 0xfb, 0x38, 0x5f, 0x9c, 0x2, 0xb1, 0x75, 0x9b, 0xc6, 0x3d, 0xfb, 0x30, 0xa, 0x6, 0x8, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x4, 0x3, 0x2, 0x3, 0x48, 0x0, 0x30, 0x45, 0x2, 0x21, 0x0, 0x91, 0x4, 0x2f, 0xee, 0x17, 0xca, 0x28, 0x68, 0xb4, 0x33, 0x48, 0x3a, 0x3a, 0x7b, 0x9f, 0xb8, 0x51, 0xb0, 0x6a, 0x8d, 0x28, 0xb9, 0x31, 0x4c, 0xb7, 0x21, 0x87, 0xd5, 0xac, 0xce, 0x6d, 0x1d, 0x2, 0x20, 0x68, 0x61, 0xca, 0x5d, 0xc2, 0x99, 0x63, 0xba, 0xb4, 0x4f, 0x1b, 0x3a, 0x2e, 0xc6, 0xed, 0x6b, 0x25, 0xba, 0x91, 0x63, 0xce, 0x1, 0xe7, 0xba, 0x67, 0x55, 0xbc, 0xb6, 0x8a, 0x76, 0x54, 0x37&#125;, RawTBSCertificate:[]uint8&#123;0x30, 0x82, 0x1, 0xb7, 0xa0, 0x3, 0x2, 0x1, 0x2, 0x2, 0x11, 0x0, 0x9c, 0x36, 0x61, 0x42, 0xa4, 0x9b, 0x22, 0xae, 0xb0, 0x61, 0xe6, 0xdf, 0x70, 0xfb, 0x2e, 0x19, 0x30, 0xa, 0x6, 0x8, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x4, 0x3, 0x2, 0x30, 0x6d, 0x31, 0xb, 0x30, 0x9, 0x6, 0x3, 0x55, 0x4, 0x6, 0x13, 0x2, 0x55, 0x53, 0x31, 0x13, 0x30, 0x11, 0x6, 0x3, 0x55, 0x4, 0x8, 0x13, 0xa, 0x43, 0x61, 0x6c, 0x69, 0x66, 0x6f, 0x72, 0x6e, 0x69, 0x61, 0x31, 0x16, 0x30, 0x14, 0x6, 0x3, 0x55, 0x4, 0x7, 0x13, 0xd, 0x53, 0x61, 0x6e, 0x20, 0x46, 0x72, 0x61, 0x6e, 0x63, 0x69, 0x73, 0x63, 0x6f, 0x31, 0x16, 0x30, 0x14, 0x6, 0x3, 0x55, 0x4, 0xa, 0x13, 0xd, 0x73, 0x32, 0x2e, 0x73, 0x75, 0x70, 0x70, 0x6c, 0x79, 0x2e, 0x63, 0x6f, 0x6d, 0x31, 0x19, 0x30, 0x17, 0x6, 0x3, 0x55, 0x4, 0x3, 0x13, 0x10, 0x63, 0x61, 0x2e, 0x73, 0x32, 0x2e, 0x73, 0x75, 0x70, 0x70, 0x6c, 0x79, 0x2e, 0x63, 0x6f, 0x6d, 0x30, 0x1e, 0x17, 0xd, 0x32, 0x31, 0x30, 0x31, 0x30, 0x37, 0x30, 0x38, 0x33, 0x31, 0x30, 0x30, 0x5a, 0x17, 0xd, 0x33, 0x31, 0x30, 0x31, 0x30, 0x35, 0x30, 0x38, 0x33, 0x31, 0x30, 0x30, 0x5a, 0x30, 0x58, 0x31, 0xb, 0x30, 0x9, 0x6, 0x3, 0x55, 0x4, 0x6, 0x13, 0x2, 0x55, 0x53, 0x31, 0x13, 0x30, 0x11, 0x6, 0x3, 0x55, 0x4, 0x8, 0x13, 0xa, 0x43, 0x61, 0x6c, 0x69, 0x66, 0x6f, 0x72, 0x6e, 0x69, 0x61, 0x31, 0x16, 0x30, 0x14, 0x6, 0x3, 0x55, 0x4, 0x7, 0x13, 0xd, 0x53, 0x61, 0x6e, 0x20, 0x46, 0x72, 0x61, 0x6e, 0x63, 0x69, 0x73, 0x63, 0x6f, 0x31, 0x1c, 0x30, 0x1a, 0x6, 0x3, 0x55, 0x4, 0x3, 0xc, 0x13, 0x41, 0x64, 0x6d, 0x69, 0x6e, 0x40, 0x73, 0x32, 0x2e, 0x73, 0x75, 0x70, 0x70, 0x6c, 0x79, 0x2e, 0x63, 0x6f, 0x6d, 0x30, 0x59, 0x30, 0x13, 0x6, 0x7, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x2, 0x1, 0x6, 0x8, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x3, 0x1, 0x7, 0x3, 0x42, 0x0, 0x4, 0x9e, 0x80, 0x9f, 0x9b, 0xc7, 0x9a, 0xe8, 0x35, 0x60, 0x12, 0x14, 0x5c, 0xab, 0x83, 0xe7, 0x46, 0x49, 0xef, 0xd4, 0xe2, 0xc0, 0x39, 0x16, 0xe6, 0xe1, 0x2b, 0xd9, 0x99, 0x17, 0x53, 0x91, 0x26, 0x5f, 0x5, 0x65, 0xc7, 0x0, 0x8e, 0x2a, 0x97, 0xea, 0x28, 0xea, 0xf5, 0x5d, 0xd9, 0x34, 0xd, 0x63, 0x25, 0x1, 0x3, 0xd0, 0x23, 0x17, 0x97, 0x92, 0xd7, 0x55, 0x4, 0x9c, 0x45, 0x73, 0x82, 0xa3, 0x4d, 0x30, 0x4b, 0x30, 0xe, 0x6, 0x3, 0x55, 0x1d, 0xf, 0x1, 0x1, 0xff, 0x4, 0x4, 0x3, 0x2, 0x7, 0x80, 0x30, 0xc, 0x6, 0x3, 0x55, 0x1d, 0x13, 0x1, 0x1, 0xff, 0x4, 0x2, 0x30, 0x0, 0x30, 0x2b, 0x6, 0x3, 0x55, 0x1d, 0x23, 0x4, 0x24, 0x30, 0x22, 0x80, 0x20, 0x63, 0xbd, 0xab, 0x9a, 0x9c, 0xa7, 0x4f, 0x3d, 0x8b, 0xb6, 0xc3, 0xab, 0xc, 0xb1, 0x45, 0x87, 0x60, 0x69, 0x7e, 0xb9, 0x6, 0xfb, 0x38, 0x5f, 0x9c, 0x2, 0xb1, 0x75, 0x9b, 0xc6, 0x3d, 0xfb&#125;, RawSubjectPublicKeyInfo:[]uint8&#123;0x30, 0x59, 0x30, 0x13, 0x6, 0x7, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x2, 0x1, 0x6, 0x8, 0x2a, 0x86, 0x48, 0xce, 0x3d, 0x3, 0x1, 0x7, 0x3, 0x42, 0x0, 0x4, 0x9e, 0x80, 0x9f, 0x9b, 0xc7, 0x9a, 0xe8, 0x35, 0x60, 0x12, 0x14, 0x5c, 0xab, 0x83, 0xe7, 0x46, 0x49, 0xef, 0xd4, 0xe2, 0xc0, 0x39, 0x16, 0xe6, 0xe1, 0x2b, 0xd9, 0x99, 0x17, 0x53, 0x91, 0x26, 0x5f, 0x5, 0x65, 0xc7, 0x0, 0x8e, 0x2a, 0x97, 0xea, 0x28, 0xea, 0xf5, 0x5d, 0xd9, 0x34, 0xd, 0x63, 0x25, 0x1, 0x3, 0xd0, 0x23, 0x17, 0x97, 0x92, 0xd7, 0x55, 0x4, 0x9c, 0x45, 0x73, 0x82&#125;, RawSubject:[]uint8&#123;0x30, 0x58, 0x31, 0xb, 0x30, 0x9, 0x6, 0x3, 0x55, 0x4, 0x6, 0x13, 0x2, 0x55, 0x53, 0x31, 0x13, 0x30, 0x11, 0x6, 0x3, 0x55, 0x4, 0x8, 0x13, 0xa, 0x43, 0x61, 0x6c, 0x69, 0x66, 0x6f, 0x72, 0x6e, 0x69, 0x61, 0x31, 0x16, 0x30, 0x14, 0x6, 0x3, 0x55, 0x4, 0x7, 0x13, 0xd, 0x53, 0x61, 0x6e, 0x20, 0x46, 0x72, 0x61, 0x6e, 0x63, 0x69, 0x73, 0x63, 0x6f, 0x31, 0x1c, 0x30, 0x1a, 0x6, 0x3, 0x55, 0x4, 0x3, 0xc, 0x13, 0x41, 0x64, 0x6d, 0x69, 0x6e, 0x40, 0x73, 0x32, 0x2e, 0x73, 0x75, 0x70, 0x70, 0x6c, 0x79, 0x2e, 0x63, 0x6f, 0x6d&#125;, RawIssuer:[]uint8&#123;0x30, 0x6d, 0x31, 0xb, 0x30, 0x9, 0x6, 0x3, 0x55, 0x4, 0x6, 0x13, 0x2, 0x55, 0x53, 0x31, 0x13, 0x30, 0x11, 0x6, 0x3, 0x55, 0x4, 0x8, 0x13, 0xa, 0x43, 0x61, 0x6c, 0x69, 0x66, 0x6f, 0x72, 0x6e, 0x69, 0x61, 0x31, 0x16, 0x30, 0x14, 0x6, 0x3, 0x55, 0x4, 0x7, 0x13, 0xd, 0x53, 0x61, 0x6e, 0x20, 0x46, 0x72, 0x61, 0x6e, 0x63, 0x69, 0x73, 0x63, 0x6f, 0x31, 0x16, 0x30, 0x14, 0x6, 0x3, 0x55, 0x4, 0xa, 0x13, 0xd, 0x73, 0x32, 0x2e, 0x73, 0x75, 0x70, 0x70, 0x6c, 0x79, 0x2e, 0x63, 0x6f, 0x6d, 0x31, 0x19, 0x30, 0x17, 0x6, 0x3, 0x55, 0x4, 0x3, 0x13, 0x10, 0x63, 0x61, 0x2e, 0x73, 0x32, 0x2e, 0x73, 0x75, 0x70, 0x70, 0x6c, 0x79, 0x2e, 0x63, 0x6f, 0x6d&#125;, Signature:[]uint8&#123;0x30, 0x45, 0x2, 0x21, 0x0, 0x91, 0x4, 0x2f, 0xee, 0x17, 0xca, 0x28, 0x68, 0xb4, 0x33, 0x48, 0x3a, 0x3a, 0x7b, 0x9f, 0xb8, 0x51, 0xb0, 0x6a, 0x8d, 0x28, 0xb9, 0x31, 0x4c, 0xb7, 0x21, 0x87, 0xd5, 0xac, 0xce, 0x6d, 0x1d, 0x2, 0x20, 0x68, 0x61, 0xca, 0x5d, 0xc2, 0x99, 0x63, 0xba, 0xb4, 0x4f, 0x1b, 0x3a, 0x2e, 0xc6, 0xed, 0x6b, 0x25, 0xba, 0x91, 0x63, 0xce, 0x1, 0xe7, 0xba, 0x67, 0x55, 0xbc, 0xb6, 0x8a, 0x76, 0x54, 0x37&#125;, SignatureAlgorithm:10, PublicKeyAlgorithm:3, PublicKey:(*ecdsa.PublicKey)(0xc0003f4980), Version:3, SerialNumber:207641924046541125914056390919893757465, Issuer:pkix.Name&#123;Country:[]string&#123;&quot;US&quot;&#125;, Organization:[]string&#123;&quot;s2.supply.com&quot;&#125;, OrganizationalUnit:[]string(nil), Locality:[]string&#123;&quot;San Francisco&quot;&#125;, Province:[]string&#123;&quot;California&quot;&#125;, StreetAddress:[]string(nil), PostalCode:[]string(nil), SerialNumber:&quot;&quot;, CommonName:&quot;ca.s2.supply.com&quot;, Names:[]pkix.AttributeTypeAndValue&#123;pkix.AttributeTypeAndValue&#123;Type:asn1.ObjectIdentifier&#123;2, 5, 4, 6&#125;, Value:&quot;US&quot;&#125;, pkix.AttributeTypeAndValue&#123;Type:asn1.ObjectIdentifier&#123;2, 5, 4, 8&#125;, Value:&quot;California&quot;&#125;, pkix.AttributeTypeAndValue&#123;Type:asn1.ObjectIdentifier&#123;2, 5, 4, 7&#125;, Value:&quot;San Francisco&quot;&#125;, pkix.AttributeTypeAndValue&#123;Type:asn1.ObjectIdentifier&#123;2, 5, 4, 10&#125;, Value:&quot;s2.supply.com&quot;&#125;, pkix.AttributeTypeAndValue&#123;Type:asn1.ObjectIdentifier&#123;2, 5, 4, 3&#125;, Value:&quot;ca.s2.supply.com&quot;&#125;&#125;, ExtraNames:[]pkix.AttributeTypeAndValue(nil)&#125;, Subject:pkix.Name&#123;Country:[]string&#123;&quot;US&quot;&#125;, Organization:[]string(nil), OrganizationalUnit:[]string(nil), Locality:[]string&#123;&quot;San Francisco&quot;&#125;, Province:[]string&#123;&quot;California&quot;&#125;, StreetAddress:[]string(nil), PostalCode:[]string(nil), SerialNumber:&quot;&quot;, CommonName:&quot;Admin@s2.supply.com&quot;, Names:[]pkix.AttributeTypeAndValue&#123;pkix.AttributeTypeAndValue&#123;Type:asn1.ObjectIdentifier&#123;2, 5, 4, 6&#125;, Value:&quot;US&quot;&#125;, pkix.AttributeTypeAndValue&#123;Type:asn1.ObjectIdentifier&#123;2, 5, 4, 8&#125;, Value:&quot;California&quot;&#125;, pkix.AttributeTypeAndValue&#123;Type:asn1.ObjectIdentifier&#123;2, 5, 4, 7&#125;, Value:&quot;San Francisco&quot;&#125;, pkix.AttributeTypeAndValue&#123;Type:asn1.ObjectIdentifier&#123;2, 5, 4, 3&#125;, Value:&quot;Admin@s2.supply.com&quot;&#125;&#125;, ExtraNames:[]pkix.AttributeTypeAndValue(nil)&#125;, NotBefore:time.Time&#123;wall:0x0, ext:63745605060, loc:(*time.Location)(nil)&#125;, NotAfter:time.Time&#123;wall:0x0, ext:64060965060, loc:(*time.Location)(nil)&#125;, KeyUsage:1, Extensions:[]pkix.Extension&#123;pkix.Extension&#123;Id:asn1.ObjectIdentifier&#123;2, 5, 29, 15&#125;, Critical:true, Value:[]uint8&#123;0x3, 0x2, 0x7, 0x80&#125;&#125;, pkix.Extension&#123;Id:asn1.ObjectIdentifier&#123;2, 5, 29, 19&#125;, Critical:true, Value:[]uint8&#123;0x30, 0x0&#125;&#125;, pkix.Extension&#123;Id:asn1.ObjectIdentifier&#123;2, 5, 29, 35&#125;, Critical:false, Value:[]uint8&#123;0x30, 0x22, 0x80, 0x20, 0x63, 0xbd, 0xab, 0x9a, 0x9c, 0xa7, 0x4f, 0x3d, 0x8b, 0xb6, 0xc3, 0xab, 0xc, 0xb1, 0x45, 0x87, 0x60, 0x69, 0x7e, 0xb9, 0x6, 0xfb, 0x38, 0x5f, 0x9c, 0x2, 0xb1, 0x75, 0x9b, 0xc6, 0x3d, 0xfb&#125;&#125;&#125;, ExtraExtensions:[]pkix.Extension(nil), UnhandledCriticalExtensions:[]asn1.ObjectIdentifier(nil), ExtKeyUsage:[]x509.ExtKeyUsage(nil), UnknownExtKeyUsage:[]asn1.ObjectIdentifier(nil), BasicConstraintsValid:true, IsCA:false, MaxPathLen:-1, MaxPathLenZero:false, SubjectKeyId:[]uint8(nil), AuthorityKeyId:[]uint8&#123;0x63, 0xbd, 0xab, 0x9a, 0x9c, 0xa7, 0x4f, 0x3d, 0x8b, 0xb6, 0xc3, 0xab, 0xc, 0xb1, 0x45, 0x87, 0x60, 0x69, 0x7e, 0xb9, 0x6, 0xfb, 0x38, 0x5f, 0x9c, 0x2, 0xb1, 0x75, 0x9b, 0xc6, 0x3d, 0xfb&#125;, OCSPServer:[]string(nil), IssuingCertificateURL:[]string(nil), DNSNames:[]string(nil), EmailAddresses:[]string(nil), IPAddresses:[]net.IP(nil), URIs:[]*url.URL(nil), PermittedDNSDomainsCritical:false, PermittedDNSDomains:[]string(nil), ExcludedDNSDomains:[]string(nil), PermittedIPRanges:[]*net.IPNet(nil), ExcludedIPRanges:[]*net.IPNet(nil), PermittedEmailAddresses:[]string(nil), ExcludedEmailAddresses:[]string(nil), PermittedURIDomains:[]string(nil), ExcludedURIDomains:[]string(nil), CRLDistributionPoints:[]string(nil), PolicyIdentifiers:[]asn1.ObjectIdentifier(nil)&#125;2021&#x2F;01&#x2F;25 03:42:33 clientIdentity.AssertAttributeValue(&quot;test&quot;, &quot;hello&quot;) error! æµ‹è¯•æ—¥å¿—åˆ†æ clientIdentity.GetID() æºç  12id := fmt.Sprintf(&quot;x509::%s::%s&quot;, getDN(&amp;c.cert.Subject), getDN(&amp;c.cert.Issuer))return base64.StdEncoding.EncodeToString([]byte(id)), nil è§£ç æ—¥å¿—è¾“å‡ºçš„base64ç¼–ç çš„å†…å®¹eDUwOTo6Q049QWRtaW5AczIuc3VwcGx5LmNvbSxMPVNhbiBGcmFuY2lzY28sU1Q9Q2FsaWZvcm5pYSxDPVVTOjpDTj1jYS5zMi5zdXBwbHkuY29tLE89czIuc3VwcGx5LmNvbSxMPVNhbiBGcmFuY2lzY28sU1Q9Q2FsaWZvcm5pYSxDPVVTç»“æœå¦‚ä¸‹ï¼Œä¸»è¦æ˜¯è¯ä¹¦é‡Œé¢çš„æ‘˜è¦ä¿¡æ¯ï¼š 1x509::CN=Admin@s2.supply.com,L=San Francisco,ST=California,C=US::CN=ca.s2.supply.com,O=s2.supply.com,L=San Francisco,ST=California,C=US clientIdentity.GetAttributeValue(â€œtestâ€) log.Printf(&quot;clientIdentity.GetAttributeValue(\\&quot;test\\&quot;)=%s&quot;, value)è¿™è¡Œæ—¥å¿—æ²¡æœ‰æ‰“å°ï¼Œæ˜¯å› ä¸ºæ²¡æœ‰æŸ¥è¯¢åˆ°è¿™ä¸ªå±æ€§ã€‚","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"API","slug":"åŒºå—é“¾/Hyperledger-Fabric/API","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/API/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"ClientIdentity","slug":"ClientIdentity","permalink":"https://guozhe001.github.io/tags/ClientIdentity/"},{"name":"API","slug":"API","permalink":"https://guozhe001.github.io/tags/API/"}]},{"title":"å°†æ™ºèƒ½åˆçº¦éƒ¨ç½²åˆ°é€šé“","slug":"blockchain/fabric/å°†æ™ºèƒ½åˆçº¦éƒ¨ç½²åˆ°é€šé“","date":"2021-04-01T10:18:21.487Z","updated":"2021-04-01T10:18:21.488Z","comments":true,"path":"2021/04/01/blockchain/fabric/å°†æ™ºèƒ½åˆçº¦éƒ¨ç½²åˆ°é€šé“/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E5%B0%86%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E9%83%A8%E7%BD%B2%E5%88%B0%E9%80%9A%E9%81%93/","excerpt":"","text":"Deploying a smart contract to a channelï¼ˆå°†æ™ºèƒ½åˆçº¦éƒ¨ç½²åˆ°é€šé“ï¼‰ å‚è€ƒæ–‡æ¡£ æœ€ç»ˆç”¨æˆ·é€šè¿‡è°ƒç”¨æ™ºèƒ½åˆçº¦ä¸åŒºå—é“¾è´¦æœ¬è¿›è¡Œäº¤äº’ã€‚åœ¨Hyperledger Fabricä¸­ï¼Œæ™ºèƒ½åˆçº¦é€šè¿‡ç§°ä¸ºchaincodeçš„è½¯ä»¶åŒ…è¿›è¡Œéƒ¨ç½²ã€‚ä¸€ä¸ªç»„ç»‡æƒ³è¦éªŒè¯äº¤æ˜“æˆ–è€…æŸ¥è¯¢è´¦æœ¬çš„å†…å®¹ï¼Œå°±éœ€è¦åœ¨å…¶peerèŠ‚ç‚¹ä¸Šéƒ¨ç½²chaincodeã€‚å½“ä¸€ä¸ªå·²ç»å®‰è£…äº†chaincodeçš„èŠ‚ç‚¹åŠ å…¥channelä¹‹åï¼Œchannelçš„æˆå‘˜å°±å¯ä»¥æŠŠchaincodeéƒ¨ç½²åˆ°channelä¸Šï¼Œç„¶åä½¿ç”¨chaincodeä¸Šçš„æ™ºèƒ½åˆçº¦æ¥åˆ›å»ºå’Œæ›´æ–°chanelè´¦æœ¬ä¸Šçš„èµ„äº§ã€‚ æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå«åšFabricé“¾ç ç”Ÿå‘½å‘¨æœŸçš„ç¨‹åºæ¥å°†chaincodeéƒ¨ç½²åˆ°channelä¸Šï¼›åœ¨é“¾ç å¯ä»¥è¢«ä½¿ç”¨äºäº¤æ˜“ä¹‹å‰ï¼ŒFabricé“¾ç ç”Ÿå‘½å‘¨æœŸéœ€è¦å¤šä¸ªç»„ç»‡åŒæ„é“¾ç å°†å¦‚ä½•æ“ä½œã€‚ï¼ˆä¸ªäººç†è§£ï¼šéœ€è¦ç»„ç»‡åŒæ„æ™ºèƒ½åˆçº¦çš„å†…å®¹ï¼Œæ™ºèƒ½åˆçº¦æ‰èƒ½éƒ¨ç½²åˆ°channelä¸Šï¼‰ä¸¾ä¸ªä¾‹å­ï¼Œå½“ä¸€ä¸ªèƒŒä¹¦ç­–ç•¥åˆ¶å®šå“ªäº›ç»„ç»‡éœ€è¦æ‰§è¡Œchaincodeæ¥éªŒè¯ä¸€ä¸ªäº¤æ˜“æ—¶ï¼Œchannelä¸Šçš„æˆå‘˜éœ€è¦ä½¿ç”¨Fabricé“¾ç ç”Ÿå‘½å‘¨æœŸæ¥åŒæ„é“¾ç çš„èƒŒä¹¦ç­–ç•¥ã€‚æœ‰å…³å¦‚ä½•åœ¨é€šé“ä¸Šéƒ¨ç½²å’Œç®¡ç†é“¾ç çš„æ›´æ·±å…¥çš„æ¦‚è¿°ï¼Œè¯·å‚é˜…Fabric chaincode lifecycleã€‚ ä½ å¯ä»¥ä½¿ç”¨ peer lifecycle chaincode commandsè¿™ä¸ªæ•™ç¨‹æ¥å­¦ä¹ åœ¨Fabricæµ‹è¯•ç½‘ç»œä¸­å¦‚ä½•ä½¿ç”¨peer lifecycle chaincode commandsæ¥éƒ¨ç½²é“¾ç åˆ°channelã€‚äº†è§£å‘½ä»¤åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æœ¬æ•™ç¨‹ä¸­çš„æ­¥éª¤å°†è‡ªå·±çš„é“¾ç éƒ¨ç½²åˆ°æµ‹è¯•æˆ–ç”Ÿäº§ç½‘ç»œã€‚åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œä½ ä¼šéƒ¨ç½²æ•™ç¨‹Writing your first application tutorialä½¿ç”¨çš„é“¾ç ç¨‹åºã€‚ **æ³¨æ„ï¼š**å½“å‰æ•™ç¨‹ä½¿ç”¨v2.0ç‰ˆæœ¬ä¸­å¼•å…¥çš„Fabricé“¾ç ç”Ÿå‘½å‘¨æœŸã€‚ Start the networkï¼ˆå¯åŠ¨æµ‹è¯•ç½‘ç»œï¼‰ å¯åŠ¨æµ‹è¯•ç½‘ç»œå¹¶åˆ›å»ºchannelï¼Œå…·ä½“æ­¥éª¤å‚è€ƒFabricæµ‹è¯•ç½‘ç»œä½¿ç”¨ã€‚ ä½ å¯ä»¥æ ¹æ®ä»¥ä¸‹æ­¥éª¤ä½¿ç”¨èŠ‚ç‚¹çš„CLIæ¥éƒ¨ç½² asset-transfer (basic) é“¾ç åˆ°channelä¸­ï¼š [ç¬¬ä¸€æ­¥ï¼šæ‰“åŒ…æ™ºèƒ½åˆçº¦] [ç¬¬äºŒæ­¥ï¼šå®‰è£…é“¾ç åŒ…] [ç¬¬ä¸‰æ­¥ï¼šæ‰¹å‡†é“¾ç å®šä¹‰] [ç¬¬å››éƒ¨ï¼šæäº¤é“¾ç å®šä¹‰åˆ°channelä¸­] Setup Logspout (optional)ï¼ˆå¯åŠ¨æ—¥å¿—è¾“å‡ºï¼Œå¯é€‰ï¼‰ æ­¤æ­¥éª¤ä¸æ˜¯å¿…éœ€çš„ï¼Œä½†æ˜¯å¯¹äºæ•…éšœæ’é™¤é“¾ç éå¸¸æœ‰ç”¨ã€‚è¦ç›‘è§†æ™ºèƒ½åˆçº¦çš„æ—¥å¿—ï¼Œç®¡ç†å‘˜å¯ä»¥ä½¿ç”¨logspoutæŸ¥çœ‹ä¸€ç»„Dockerå®¹å™¨çš„èšåˆè¾“å‡ºã€‚è¿™ä¸ªå·¥å…·æ”¶é›†ä¸åŒçš„Dockerå®¹å™¨çš„è¾“å‡ºæµåˆ°ä¸€ä¸ªä½ç½®ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸€ä¸ªçª—å£çœ‹è¿™äº›å®¹å™¨éƒ½å‘ç”Ÿäº†ä»€ä¹ˆã€‚è¿™å¯ä»¥å¸®åŠ©ç®¡ç†å‘˜åœ¨å®‰è£…æ™ºèƒ½åˆçº¦æˆ–è€…æ˜¯å¼€å‘äººå‘˜è°ƒç”¨æ™ºèƒ½åˆçº¦æ—¶è°ƒè¯•é—®é¢˜ã€‚å› ä¸ºæŸäº›å®¹å™¨çš„åˆ›å»ºçº¯ç²¹æ˜¯ä¸ºäº†å¯åŠ¨æ™ºèƒ½åˆçº¦ï¼Œå¹¶ä¸”ä»…å­˜åœ¨å¾ˆçŸ­çš„æ—¶é—´ï¼Œæ‰€ä»¥ä»ç½‘ç»œä¸­æ”¶é›†æ‰€æœ‰æ—¥å¿—å°†å¾ˆæœ‰å¸®åŠ©ã€‚ Fabricçš„å•†ä¸šç¥¨æ®ç¤ºä¾‹ä¸­å·²ç»åŒ…å«äº†ç”¨äºå®‰è£…å’Œé…ç½®Logspoutçš„è„šæœ¬monitordocker.shã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜å°†ä½¿ç”¨ç›¸åŒçš„è„šæœ¬ã€‚Logspoutå·¥å…·å°†æŒç»­å‘æ‚¨çš„ç»ˆç«¯æµå¼ä¼ è¾“æ—¥å¿—ï¼Œå› æ­¤æ‚¨å°†éœ€è¦ä½¿ç”¨æ–°çš„ç»ˆç«¯çª—å£ã€‚æ‰“å¼€ä¸€ä¸ªæ–°ç»ˆç«¯ï¼Œç„¶åå¯¼èˆªåˆ°test-networkç›®å½•ã€‚ 1cd fabric-samples/test-network ä½ å¯ä»¥åœ¨ä»»ä½•ç›®å½•ä¸‹è¿è¡Œ monitordocker.shè„šæœ¬ï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨æˆ‘ä»¬æŠŠ monitordocker.sh ä»commercial-paperæ‹·è´åˆ°ä½ çš„å·¥ä½œç›®å½•(test-network)ã€‚ 1cp ../commercial-paper/organization/digibank/configuration/cli/monitordocker.sh . ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥å¯åŠ¨Logspoutï¼š 1./monitordocker.sh net_test ä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„è¾“å‡ºï¼š 123456789Starting monitoring on all containers on the network net_basicUnable to find image &#x27;gliderlabs/logspout:latest&#x27; locallylatest: Pulling from gliderlabs/logspout4fe2ade4980c: Pull completedecca452f519: Pull completead60f6b6c009: Pull completeDigest: sha256:374e06b17b004bddc5445525796b5f7adb8234d64c5c5d663095fccafb6e4c26Status: Downloaded newer image for gliderlabs/logspout:latest1f99d130f15cf01706eda3e1f040496ec885036d485cb6bcc0da4a567ad84361 åœ¨æˆ‘ä»¬éƒ¨ç½²é“¾ç ä¹‹å‰ä½ ä¸ä¼šçœ‹åˆ°å¤ªå¤šçš„æ—¥å¿—ã€‚ Package the smart contractï¼ˆæ‰“åŒ…æ™ºèƒ½åˆçº¦ï¼‰ We need to package the chaincode before it can be installed on our peers. The steps are different if you want to install a smart contract written in Go, JavaScript, or Typescript. åœ¨æŠŠæ™ºèƒ½åˆçº¦å®‰è£…åˆ°æˆ‘ä»¬çš„èŠ‚ç‚¹ä¹‹å‰éœ€è¦å…ˆå°†å…¶æ‰“åŒ…ã€‚æ ¹æ®ç¼–å†™æ™ºèƒ½åˆçº¦çš„è¯­è¨€çš„ä¸åŒï¼Œå…¶æ­¥éª¤ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚ï¼ˆæœ¬æ¬¡åªä½¿ç”¨Goï¼Œå…¶ä»–è¯­è¨€å¦‚Go, JavaScript, or Typescriptè¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼‰ Go åœ¨æˆ‘ä»¬æ‰“åŒ…é“¾ç ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå®‰è£…é“¾ç çš„ä¾èµ–ã€‚åˆ‡æ¢åˆ°Goç‰ˆæœ¬çš„ asset-transfer (basic) é¡¹ç›®ç›®å½•ä¸‹ï¼š 1cd fabric-samples/asset-transfer-basic/chaincode-go è¯¥ç¤ºä¾‹ä½¿ç”¨Goæ¨¡å—æ¥å®‰è£…chaincodeä¾èµ–é¡¹ã€‚ä¾èµ–å…³ç³»åˆ—åœ¨asset-transfer-basic / chaincode-goç›®å½•çš„go.modæ–‡ä»¶ä¸­ã€‚æ‚¨åº”è¯¥èŠ±ä¸€ç‚¹æ—¶é—´æ¥æ£€æŸ¥æ­¤æ–‡ä»¶ã€‚ 1234567891011module github.com/hyperledger/fabric-samples/asset-transfer-basic/chaincode-gogo 1.14require ( github.com/golang/protobuf v1.3.2 github.com/hyperledger/fabric-chaincode-go v0.0.0-20200424173110-d7076418f212 github.com/hyperledger/fabric-contract-api-go v1.1.0 github.com/hyperledger/fabric-protos-go v0.0.0-20200424173316-dd554ba3746e github.com/stretchr/testify v1.5.1) go.modæ–‡ä»¶å°†Fabricåˆçº¦APIå¯¼å…¥åˆ°æ™ºèƒ½åˆçº¦åŒ…ä¸­ã€‚ä½ å¯ä»¥æ‰“å¼€asset-transfer-basic/chaincode-go/chaincode/smartcontract.goæ¥æŸ¥çœ‹åœ¨æ™ºèƒ½åˆçº¦çš„æœ€å¼€å§‹æ˜¯å¦‚ä½¿ç”¨contract APIæ¥å®šä¹‰SmartContractç±»çš„ã€‚ 1234// SmartContract provides functions for managing an Assettype SmartContract struct &#123; contractapi.Contract&#125; ç„¶åï¼Œå°†SmartContractç±»å‹ç”¨äºä¸ºæ™ºèƒ½åˆçº¦ä¸­å®šä¹‰çš„æ–¹æ³•åˆ›å»ºäº¤æ˜“ä¸Šä¸‹æ–‡ï¼Œè¯¥æ–¹æ³•å¯å°†æ•°æ®è¯»å–å’Œå†™å…¥åŒºå—é“¾è´¦æœ¬ã€‚ 12345678910111213141516171819202122232425// CreateAsset issues a new asset to the world state with given details.func (s *SmartContract) CreateAsset(ctx contractapi.TransactionContextInterface, id string, color string, size int, owner string, appraisedValue int) error &#123; exists, err := s.AssetExists(ctx, id) if err != nil &#123; return err &#125; if exists &#123; return fmt.Errorf(&quot;the asset %s already exists&quot;, id) &#125; asset := Asset&#123; ID: id, Color: color, Size: size, Owner: owner, AppraisedValue: appraisedValue, &#125; assetJSON, err := json.Marshal(asset) if err != nil &#123; return err &#125; return ctx.GetStub().PutState(id, assetJSON)&#125; ä½ å¯ä»¥é€šè¿‡è®¿é—® API documentation å’Œ smart contract processing topicæ¥å­¦ä¹ æ›´å¤šçš„å…³äºåˆçº¦APIçš„å†…å®¹ã€‚ ä¸ºäº†å®‰è£…æ™ºèƒ½åˆçº¦çš„ä¾èµ–ï¼Œåœ¨asset-transfer-basic/chaincode-go ç›®å½•ä¸‹è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š 1GO111MODULE=on go mod vendor å¦‚æœå‘½ä»¤æˆåŠŸï¼Œåˆ™goè½¯ä»¶åŒ…å°†å®‰è£…vendoræ–‡ä»¶å¤¹ä¸­ã€‚ ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¾èµ–çš„åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºchaincodeçš„åŒ…äº†ã€‚æŠŠå½“å‰ç›®å½•åˆ‡æ¢åˆ°test-network ä»¥ä¾¿æˆ‘ä»¬å¯ä»¥å°†é“¾ç äºå…¶ä»–ç½‘ç»œç»„ä»¶æ‰“åŒ…åœ¨ä¸€èµ·ã€‚ 1cd ..&#x2F;..&#x2F;test-network You can use the peer CLI to create a chaincode package in the required format. The peer binaries are located in the bin folder of the fabric-samples repository. Use the following command to add those binaries to your CLI Path: æ‚¨å¯ä»¥ä½¿ç”¨peerCLIåˆ›å»ºæ‰€éœ€æ ¼å¼çš„é“¾ç åŒ…ã€‚peeräºŒè¿›åˆ¶æ–‡ä»¶ä½äºfabric-sampleså­˜å‚¨åº“çš„binæ–‡ä»¶å¤¹ä¸­ã€‚å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ·»åŠ åˆ°ä½ çš„ç¯å¢ƒå˜é‡ä¸­ã€‚ 1export PATH=$&#123;PWD&#125;/../bin:$PATH æ‚¨è¿˜éœ€è¦å°†FABRIC_CFG_PATHè®¾ç½®ä¸ºæŒ‡å‘fabric-sampleså­˜å‚¨åº“ä¸­çš„core.yamlæ–‡ä»¶ï¼š 1export FABRIC_CFG_PATH=$PWD/../config/ ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥çœ‹peerçš„ç‰ˆæœ¬ï¼Œå¦‚æœè¾“å‡ºæ­£å¸¸è¯´æ˜ä½ å·²ç»å¯ä»¥ä½¿ç”¨peerCLIäº†ã€‚ 1peer version You can now create the chaincode package using the peer lifecycle chaincode package command: ç°åœ¨ä½ å¯ä»¥é€šè¿‡ peer lifecycle chaincode package å‘½ä»¤æ¥åˆ›å»ºé“¾ç åŒ…äº†: 1peer lifecycle chaincode package basic.tar.gz --path ../asset-transfer-basic/chaincode-go/ --lang golang --label basic_1.0 This command will create a package named basic.tar.gz in your current directory. The --lang flag is used to specify the chaincode language and the --path flag provides the location of your smart contract code. The path must be a fully qualified path or a path relative to your present working directory. The --label flag is used to specify a chaincode label that will identity your chaincode after it is installed. It is recommended that your label include the chaincode name and version. è¿™ä¸ªå‘½ä»¤ä¼šåœ¨ä½ çš„å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºbasic.tar.gzçš„å‹ç¼©åŒ…ã€‚--langæ ‡å¿—æ˜¯åˆ¶å®šchaincodeçš„è¯­è¨€ï¼Œè€Œ--path æ ‡å¿—ç”¨äºæä¾›æ™ºèƒ½åˆçº¦ä»£ç çš„ä½ç½®ã€‚è¯¥è·¯å¾„å¿…é¡»æ˜¯æ ‡å‡†è·¯å¾„æˆ–ç›¸å¯¹äºæ‚¨å½“å‰å·¥ä½œç›®å½•çš„è·¯å¾„ã€‚--labelæ ‡å¿—ç”¨äºæŒ‡å®šä¸€ä¸ªé“¾ç æ ‡ç­¾ï¼Œè¯¥æ ‡ç­¾å°†åœ¨å®‰è£…é“¾ç åå¯¹å…¶è¿›è¡Œæ ‡è¯†ã€‚å»ºè®®æ‚¨çš„æ ‡ç­¾åŒ…å«é“¾ç åç§°å’Œç‰ˆæœ¬ã€‚ Now that we created the chaincode package, we can install the chaincode on the peers of the test network. ç°åœ¨æˆ‘ä»¬å·²ç»åˆ›å»ºäº†é“¾ç åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠé“¾ç å®‰è£…åˆ°ç½‘ç»œä¸Šçš„èŠ‚ç‚¹ä¸Šäº†ã€‚ Install the chaincode packageï¼ˆå®‰è£…é“¾ç åŒ…ï¼‰ After we package the asset-transfer (basic) smart contract, we can install the chaincode on our peers. The chaincode needs to be installed on every peer that will endorse a transaction. Because we are going to set the endorsement policy to require endorsements from both Org1 and Org2, we need to install the chaincode on the peers operated by both organizations: åœ¨æˆ‘ä»¬æ‰“åŒ…äº† asset-transfer (basic) çš„æ™ºèƒ½åˆçº¦ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†æ­¤é“¾ç å®‰è£…åˆ°æˆ‘ä»¬çš„peerèŠ‚ç‚¹ä¸Šäº†ã€‚éœ€è¦åœ¨æ‰€æœ‰çš„äº¤æ˜“èƒŒä¹¦èŠ‚ç‚¹ä¸Šå®‰è£…é“¾ç ã€‚å› ä¸ºæˆ‘ä»¬å°†è®¾ç½®èƒŒä¹¦ç­–ç•¥è¦æ±‚æ¥è‡ªOrg1å’ŒOrg2çš„èƒŒä¹¦ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ä¸¤ä¸ªç»„ç»‡è¿è¥çš„å¯¹ç­‰æ–¹ä¸Šå®‰è£…é“¾ç ï¼š peer0.org1.example.com peer0.org2.example.com Letâ€™s install the chaincode on the Org1 peer first. Set the following environment variables to operate the peer CLI as the Org1 admin user. The CORE_PEER_ADDRESS will be set to point to the Org1 peer, peer0.org1.example.com. è®©æˆ‘ä»¬å…ˆæŠŠé“¾ç å®‰è£…åˆ°Org1çš„èŠ‚ç‚¹ä¸Šã€‚è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡æ¥ä½¿ç”¨Org1çš„adminç”¨æˆ·çš„èº«ä»½è¿è¡ŒpeerCLIã€‚å°†CORE_PEER_ADDRESSè®¾ç½®ä¸ºæŒ‡å‘Org1çš„èŠ‚ç‚¹çš„peer0.org1.example.comã€‚ 12345export CORE_PEER_TLS_ENABLED=trueexport CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crtexport CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/mspexport CORE_PEER_ADDRESS=localhost:7051 Issue the peer lifecycle chaincode install command to install the chaincode on the peer: å‘å‡ºåœ¨peerèŠ‚ç‚¹ä¸Šå®‰è£…é“¾ç çš„å‘½ä»¤ï¼š 1peer lifecycle chaincode install basic.tar.gz If the command is successful, the peer will generate and return the package identifier. This package ID will be used to approve the chaincode in the next step. You should see output similar to the following: å¦‚æœå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œåˆ™peerå°†ç”Ÿæˆå¹¶è¿”å›å®‰è£…åŒ…çš„æ ‡è¯†ç¬¦ã€‚è¿™ä¸ªåŒ…çš„IDä¼šåœ¨ä¸‹ä¸€æ­¥æ‰¹å‡†è¿™ä¸ªé“¾ç æ—¶ä½¿ç”¨ã€‚ä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„è¾“å‡ºï¼š 122020-12-21 14:46:18.360 CST [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 001 Installed remotely: response:&lt;status:200 payload:&quot;\\nJbasic_1.0:2c47b5b060a64aafa3c878b4bcb0ca680bdb2417ca8855b5440fa595562517d2\\022\\tbasic_1.0&quot; &gt;2020-12-21 14:46:18.361 CST [cli.lifecycle.chaincode] submitInstallProposal -&gt; INFO 002 Chaincode code package identifier: basic_1.0:2c47b5b060a64aafa3c878b4bcb0ca680bdb2417ca8855b5440fa595562517d2 åœ¨è¿è¡Œmonitordocker.shçš„ç»ˆç«¯å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„æ—¥å¿—ï¼š 1234peer0.org1.example.com|2020-12-21 06:46:18.363 UTC [lifecycle] InstallChaincode -&gt; INFO 046 Successfully installed chaincode with package ID &#x27;basic_1.0:2c47b5b060a64aafa3c878b4bcb0ca680bdb2417ca8855b5440fa595562517d2&#x27;peer0.org1.example.com|2020-12-21 06:46:18.363 UTC [endorser] callChaincode -&gt; INFO 047 finished chaincode: _lifecycle duration: 35751ms channel= txID=26a66cb7peer0.org1.example.com|2020-12-21 06:46:18.363 UTC [comm.grpc.server] 1 -&gt; INFO 048 unary call completed grpc.service=protos.Endorser grpc.method=ProcessProposal grpc.peer_address=172.19.0.1:62970 grpc.code=OK grpc.call_duration=35.752599039s We can now install the chaincode on the Org2 peer. Set the following environment variables to operate as the Org2 admin and target target the Org2 peer, peer0.org2.example.com. ç°åœ¨æˆ‘ä»¬æŠŠé“¾ç å®‰è£…åˆ°Org2ç»„ç»‡çš„peerèŠ‚ç‚¹ä¸Šã€‚å…ˆè®¾ç½®ç¯å¢ƒå˜é‡è®©æˆ‘ä»¬å¯ä»¥ä»¥Org2çš„ç®¡ç†å‘˜èº«ä»½æ¥æ“ä½œOrg2çš„èŠ‚ç‚¹ï¼š 12345export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crtexport CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crtexport CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/mspexport CORE_PEER_ADDRESS=localhost:9051 Issue the following command to install the chaincodeï¼ˆå‘å‡ºä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…é“¾ç ï¼‰: 1peer lifecycle chaincode install basic.tar.gz The chaincode is built by the peer when the chaincode is installed. The install command will return any build errors from the chaincode if there is a problem with the smart contract code. åœ¨å®‰è£…é“¾ç æ—¶ï¼Œç”±peerèŠ‚ç‚¹æ¥æ„å»ºé“¾ç ã€‚å¦‚æœæ™ºèƒ½åˆçº¦æœ‰é—®é¢˜ï¼Œå®‰è£…å‘½ä»¤ä¼šæŠŠæ‰€æœ‰æ„å»ºçš„é”™è¯¯è¿”å›ã€‚ Approve a chaincode definitionï¼ˆæ‰¹å‡†é“¾ç å®šä¹‰ï¼‰ After you install the chaincode package, you need to approve a chaincode definition for your organization. The definition includes the important parameters of chaincode governance such as the name, version, and the chaincode endorsement policy. åœ¨å®‰è£…é“¾ç åŒ…ä¹‹åï¼Œéœ€è¦ä½ æ‰€åœ¨çš„ç»„ç»‡æ‰¹å‡†é“¾ç çš„å®šä¹‰ã€‚è¿™ä¸ªå®šä¹‰åŒ…æ‹¬é“¾ç ç®¡ç†çš„é‡è¦å‚æ•°ï¼Œä¾‹å¦‚åç§°ã€ç‰ˆæœ¬ä»¥åŠé“¾ç çš„èƒŒä¹¦ç­–ç•¥ã€‚ The set of channel members who need to approve a chaincode before it can be deployed is governed by the Application/Channel/lifeycleEndorsement policy.By default, this policy requires that a majority of channel members need to approve a chaincode before it can used on a channel.Because we have only two organizations on the channel, and a majority of 2 is 2, we need approve a chaincode definition of asset-transfer (basic) as Org1 and Org2. åœ¨channelä¸Šçš„å“ªäº›æˆå‘˜éœ€è¦åœ¨å…¶å¯ä»¥éƒ¨ç½²é“¾ç ä¹‹å‰æ‰¹å‡†ï¼Œæ˜¯å®šä¹‰åœ¨Application/Channel/lifeycleEndorsementç­–ç•¥ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤ç­–ç•¥è¦æ±‚å¤§å¤šæ•°channelçš„æˆå‘˜éœ€è¦æ‰¹å‡†é“¾ç åæ‰èƒ½åœ¨é¢‘é“ä¸Šä½¿ç”¨ã€‚å› ä¸ºåœ¨æˆ‘ä»¬çš„channelä¸Šåªæœ‰ä¸¤ä¸ªç»„ç»‡ï¼Œå¹¶ä¸”å¤§å¤šæ•°å°±æ˜¯2ï¼Œæˆ‘ä»¬éœ€è¦ä»¥Org1å’ŒOrg2çš„èº«ä»½æ¥æ‰¹å‡†asset-transfer (basic)çš„é“¾ç å®šä¹‰ã€‚ If an organization has installed the chaincode on their peer, they need to include the packageID in the chaincode definition approved by their organization. The package ID is used to associate the chaincode installed on a peer with an approved chaincode definition, and allows an organization to use the chaincode to endorse transactions. You can find the package ID of a chaincode by using the peer lifecycle chaincode queryinstalled command to query your peer. å¦‚æœä¸€ä¸ªç»„ç»‡å·²ç»åœ¨å…¶peerèŠ‚ç‚¹ä¸Šå®‰è£…äº†é“¾ç ï¼Œè¿™ä¸ªç»„ç»‡éœ€è¦åœ¨å…¶æ‰¹å‡†çš„é“¾ç å®šä¹‰ä¸­åŒ…å«packageIDã€‚packageIDæ˜¯ç”¨æ¥æŠŠå®‰è£…åœ¨èŠ‚ç‚¹ä¸Šçš„chaincodeå’Œå·²ç»æ‰¹å‡†é€šè¿‡çš„é“¾ç å®šä¹‰å…³è”èµ·æ¥çš„ï¼Œå¹¶ä¸”å…è®¸ä¸€ä¸ªç»„ç»‡åœ¨èƒŒä¹¦èŠ‚ç‚¹ä½¿ç”¨è¿™ä¸ªé“¾ç ã€‚ä½ å¯ä»¥ä½¿ç”¨peer lifecycle chaincode queryinstalled å‘½ä»¤åœ¨ä½ çš„peerèŠ‚ç‚¹ä¸ŠæŸ¥è¯¢ä¸€ä¸ªé“¾ç çš„packageIDã€‚ 1peer lifecycle chaincode queryinstalled The package ID is the combination of the chaincode label and a hash of the chaincode binaries. Every peer will generate the same package ID. You should see output similar to the following: packageIDæ˜¯é“¾ç æ ‡ç­¾å’Œé“¾ç äºŒè¿›åˆ¶æ–‡ä»¶çš„å“ˆå¸Œå€¼çš„ç»„åˆã€‚æ¯ä¸ªpeerå°†ç”Ÿæˆç›¸åŒçš„ç¨‹åºåŒ…IDã€‚æ‚¨åº”è¯¥çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„è¾“å‡ºï¼š 12Installed chaincodes on peer:Package ID: basic_1.0:2c47b5b060a64aafa3c878b4bcb0ca680bdb2417ca8855b5440fa595562517d2, Label: basic_1.0 We are going to use the package ID when we approve the chaincode, so letâ€™s go ahead and save it as an environment variable. Paste the package ID returned by peer lifecycle chaincode queryinstalled into the command below. Note: The package ID will not be the same for all users, so you need to complete this step using the package ID returned from your command window in the previous step. åœ¨æˆ‘ä»¬æ‰¹å‡†é“¾ç æ—¶æˆ‘ä»¬éœ€è¦ä½¿ç”¨è¿™ä¸ª package IDï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å…ˆæŠŠå®ƒä¿å­˜ä¸ºä¸€ä¸ªç¯å¢ƒå˜é‡ï¼š 1export CC_PACKAGE_ID=basic_1.0:2c47b5b060a64aafa3c878b4bcb0ca680bdb2417ca8855b5440fa595562517d2 Because the environment variables have been set to operate the peer CLI as the Org2 admin, we can approve the chaincode definition of asset-transfer (basic) as Org2. Chaincode is approved at the organization level, so the command only needs to target one peer. The approval is distributed to the other peers within the organization using gossip. Approve the chaincode definition using the peer lifecycle chaincode approveformyorg command: å› ä¸ºå½“å‰çš„ç¯å¢ƒå˜é‡å·²ç»è®¾ç½®ä¸ºä»¥Org2ç»„ç»‡çš„ç®¡ç†å‘˜æ¥æ“ä½œpeerCLIï¼Œæˆ‘ä»¬å¯ä»¥ä»¥ç»„ç»‡Org2çš„èº«ä»½æ‰¹å‡†è¿™ä¸ªasset-transfer (basic)çš„é“¾ç å®šä¹‰ã€‚é“¾ç æ˜¯åœ¨ç»„ç»‡çš„çº§åˆ«è¿›è¡Œæ‰¹å‡†çš„ï¼Œæ‰€ä»¥è¿™ä¸ªå‘½ä»¤åªéœ€è¦é’ˆå¯¹ä¸€ä¸ªpeerèŠ‚ç‚¹å³å¯ã€‚è¿™ä¸ªæ‰¹å‡†çš„åŠ¨ä½œä¼šä½¿ç”¨gossipæ¥åœ¨ç»„ç»‡å†…éƒ¨ä¼ æ’­ã€‚ä½¿ç”¨ peer lifecycle chaincode approveformyorgå‘½ä»¤æ¥æ‰¹å‡†é“¾ç å®šä¹‰ï¼š 1peer lifecycle chaincode approveformyorg -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name basic --version 1.0 --package-id $CC_PACKAGE_ID --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem The command above uses the --package-id flag to include the package identifier in the chaincode definition. The --sequence parameter is an integer that keeps track of the number of times a chaincode has been defined or updated. Because the chaincode is being deployed to the channel for the first time, the sequence number is 1. When the asset-transfer (basic) chaincode is upgraded, the sequence number will be incremented to 2. If you are using the low level APIs provided by the Fabric Chaincode Shim API, you could pass the --init-required flag to the command above to request the execution of the Init function to initialize the chaincode. The first invoke of the chaincode would need to target the Init function and include the --isInit flag before you could use the other functions in the chaincode to interact with the ledger. ä¸Šé¢çš„å‘½ä»¤ä½¿ç”¨--package-idæ ‡å¿—å°†è½¯ä»¶åŒ…æ ‡è¯†ç¬¦åŒ…å«åœ¨é“¾ç å®šä¹‰ä¸­ã€‚--sequenceå‚æ•°æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œç”¨äºè·Ÿè¸ªå®šä¹‰æˆ–æ›´æ–°é“¾ç çš„æ¬¡æ•°ï¼›ç”±äºé“¾ç æ˜¯ç¬¬ä¸€æ¬¡éƒ¨ç½²åˆ°channelï¼Œå› æ­¤åºåˆ—å·ä¸º1ã€‚å½“asset-transfer (basic) çš„é“¾ç åœ¨æ›´æ–°æ—¶ï¼Œè¿™ä¸ªåºåˆ—å·ä¼šå¢åŠ åˆ°2ã€‚é“¾ä»£ç çš„é¦–æ¬¡è°ƒç”¨éœ€è¦ä½¿ç”¨--isInitæ¥æŒ‡æ˜è°ƒç”¨é“¾ç çš„Initå‡½æ•°ï¼Œç„¶åæ‰èƒ½ä½¿ç”¨é“¾ä»£ç ä¸­çš„å…¶ä»–å‡½æ•°ä¸è´¦æœ¬è¿›è¡Œäº¤äº’ã€‚ We could have provided a --signature-policy or --channel-config-policy argument to the approveformyorg command to specify a chaincode endorsement policy. The endorsement policy specifies how many peers belonging to different channel members need to validate a transaction against a given chaincode. Because we did not set a policy, the definition of asset-transfer (basic) will use the default endorsement policy, which requires that a transaction be endorsed by a majority of channel members present when the transaction is submitted. This implies that if new organizations are added or removed from the channel, the endorsement policy is updated automatically to require more or fewer endorsements. In this tutorial, the default policy will require a majority of 2 out of 2 and transactions will need to be endorsed by a peer from Org1 and Org2. If you want to specify a custom endorsement policy, you can use the Endorsement Policies operations guide to learn about the policy syntax. æˆ‘ä»¬å¯ä»¥åœ¨approveformyorgå‘½ä»¤ä¸­æä¾›--signature-policyæˆ–--channel-config-policyå‚æ•°ï¼Œä»¥æŒ‡å®šé“¾ç èƒŒä¹¦ç­–ç•¥ã€‚èƒŒä¹¦ç­–ç•¥æŒ‡å®šéœ€è¦å¤šå°‘ä¸ªå±äºä¸åŒæ¸ é“æˆå‘˜çš„peeræ ¹æ®ç»™å®šçš„é“¾ç éªŒè¯æ¥äº¤æ˜“ã€‚å› ä¸ºæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šåˆæ ¼ç­–ç•¥ï¼Œasset-transfer (basic) çš„å®šä¹‰ä¼šä½¿ç”¨é»˜è®¤çš„èƒŒä¹¦ç­–ç•¥ï¼Œè¯¥æ”¿ç­–è¦æ±‚åœ¨æäº¤äº¤æ˜“æ—¶ï¼Œè¯¥äº¤æ˜“å¿…é¡»å¾—åˆ°channelä¸­å¤§å¤šæ•°æˆå‘˜çš„è®¤å¯ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœåœ¨channelä¸­æ·»åŠ æˆ–åˆ é™¤ç»„ç»‡ï¼Œåˆ™èƒŒä¹¦æ”¿ç­–ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œä»¥è¦æ±‚æ›´å¤šæˆ–æ›´å°‘çš„è®¤å¯ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œé»˜è®¤ç­–ç•¥éœ€è¦2ä¸ªä¸­çš„å¤§å¤šæ•°ä¹Ÿå°±æ˜¯2ï¼Œå¹¶ä¸”äº¤æ˜“éœ€è¦ç”±æ¥è‡ªOrg1å’ŒOrg2çš„peerè®¤å¯ã€‚å¦‚æœè¦æŒ‡å®šè‡ªå®šä¹‰è®¤å¯ç­–ç•¥ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ Endorsement Policies æ“ä½œæŒ‡å—æ¥äº†è§£ç­–ç•¥è¯­æ³•ã€‚ You need to approve a chaincode definition with an identity that has an admin role. As a result, the CORE_PEER_MSPCONFIGPATH variable needs to point to the MSP folder that contains an admin identity. You cannot approve a chaincode definition with a client user. The approval needs to be submitted to the ordering service, which will validate the admin signature and then distribute the approval to your peers. ä½ éœ€è¦ä½¿ç”¨å…·æœ‰ç®¡ç†å‘˜è§’è‰²çš„èº«ä»½æ¥æ‰¹å‡†çš„é“¾ç å®šä¹‰ã€‚å³CORE_PEER_MSPCONFIGPATHå˜é‡éœ€è¦æŒ‡å‘åŒ…å«ç®¡ç†å‘˜èº«ä»½çš„MSPæ–‡ä»¶å¤¹ã€‚ä½ ä¸èƒ½ä½¿ç”¨å®¢æˆ·ç«¯ç”¨æˆ·çš„èº«ä»½æ¥æ‰¹å‡†é“¾ç ã€‚è¿™ä¸ªå®¡æ‰¹ç»“æœéœ€è¦æäº¤ç»™æ’åºæœåŠ¡ï¼Œæ’åºæœåŠ¡ä¼šéªŒè¯ç®¡ç†å‘˜çš„ç­¾åï¼Œç„¶ååˆ†å‘è¿™ä¸ªéªŒè¯ç»“æœåˆ°ä½ çš„peerèŠ‚ç‚¹ã€‚ We still need to approve the chaincode definition as Org1. Set the following environment variables to operate as the Org1 admin: ä½ è¿˜éœ€è¦åœ¨ç»„ç»‡Org1ä¸Šæ‰¹å‡†è¿™ä¸ªé“¾ç å®šä¹‰ï¼ŒæŠŠç¯å¢ƒå˜é‡ä¿®æ”¹ä¸ºä»¥ç»„ç»‡Org1çš„ç®¡ç†å‘˜èº«ä»½æ¥æ“ä½œï¼š 1234export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/mspexport CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crtexport CORE_PEER_ADDRESS=localhost:7051 You can now approve the chaincode definition as Org1. ç°åœ¨ä½ å¯ä»¥ä»¥ç»„ç»‡Org1çš„èº«ä»½æ‰¹å‡†é“¾ç å®šä¹‰äº†ã€‚ 1peer lifecycle chaincode approveformyorg -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name basic --version 1.0 --package-id $CC_PACKAGE_ID --sequence 1 --tls --cafile $&#123;PWD&#125;&#x2F;organizations&#x2F;ordererOrganizations&#x2F;example.com&#x2F;orderers&#x2F;orderer.example.com&#x2F;msp&#x2F;tlscacerts&#x2F;tlsca.example.com-cert.pem We now have the majority we need to deploy the asset-transfer (basic) the chaincode to the channel. While only a majority of organizations need to approve a chaincode definition (with the default policies), all organizations need to approve a chaincode definition to start the chaincode on their peers. If you commit the definition before a channel member has approved the chaincode, the organization will not be able to endorse transactions. As a result, it is recommended that all channel members approve a chaincode before committing the chaincode definition. ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†å°†asset-transfer (basic) çš„é“¾ç éƒ¨ç½²åˆ°æ¸ é“çš„å¤§å¤šæ•°çš„æ‰¹å‡†ã€‚åœ¨å°†é“¾ç å®šä¹‰éƒ¨ç½²åˆ°channelä¸Šæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¤§å¤šæ•°ç»„ç»‡çš„æ‰¹å‡†ï¼ˆä½¿ç”¨é»˜è®¤çš„ç­–ç•¥ï¼‰ï¼›ä½†æ˜¯æ‰€æœ‰çš„ç»„ç»‡éƒ½éœ€æ‰¹å‡†é“¾ç å®šä¹‰æ‰èƒ½åœ¨å…¶peerå¯åŠ¨è¿™ä¸ªé“¾ç ã€‚å¦‚æœä½ åœ¨ä¸€ä¸ªchannelæˆå‘˜æ‰¹å‡†å®šä¹‰ä¹‹å‰å°†é“¾ç å®šä¹‰æäº¤åˆ°channelï¼Œé‚£ä¹ˆè¿™ä¸ªç»„ç»‡å°†æ— æ³•æ‰¹å‡†äº¤æ˜“ã€‚ç»“æœï¼Œå»ºè®®æ‰€æœ‰é€šé“æˆå‘˜åœ¨æäº¤é“¾ç å®šä¹‰ä¹‹å‰æ‰¹å‡†é“¾ç ã€‚ Committing the chaincode definition to the channelï¼ˆå°†é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ï¼‰ After a sufficient number of organizations have approved a chaincode definition, one organization can commit the chaincode definition to the channel. If a majority of channel members have approved the definition, the commit transaction will be successful and the parameters agreed to in the chaincode definition will be implemented on the channel. åœ¨æœ‰è¶³å¤Ÿæ•°é‡çš„ç»„ç»‡æ‰¹å‡†é“¾ç å®šä¹‰ä¹‹åï¼Œå…¶ä¸­ä¸€ä¸ªç»„ç»‡å°±å¯ä»¥æŠŠé“¾ç å®šä¹‰æäº¤åˆ°é€šé“ä¸­äº†ã€‚å¦‚æœå¤§å¤šæ•°é€šé“æˆå‘˜å·²æ‰¹å‡†è¯¥å®šä¹‰ï¼Œåˆ™æäº¤å®šä¹‰çš„äº¤æ˜“å°†ä¼šæˆåŠŸï¼Œå¹¶ä¸”é“¾ç å®šä¹‰ä¸­åŒæ„çš„å‚æ•°å°†åœ¨è¯¥é€šé“ä¸Šå®ç°ã€‚ You can use the peer lifecycle chaincode checkcommitreadiness command to check whether channel members have approved the same chaincode definition. The flags used for the checkcommitreadiness command are identical to the flags used to approve a chaincode for your organization. However, you do not need to include the --package-id flag. ä½ å¯ä»¥ä½¿ç”¨ peer lifecycle chaincode checkcommitreadinesså‘½ä»¤æ¥æ£€æŸ¥channelä¸Šçš„æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†ç›¸åŒçš„é“¾ç å®šä¹‰ã€‚ç”¨äºcheckcommitreadinesså‘½ä»¤çš„æ ‡å¿—ä¸æ‚¨çš„ç»„ç»‡æ‰¹å‡†é“¾ç çš„æ ‡å¿—ç›¸åŒï¼›ä½†æ˜¯ä¸éœ€è¦åŒ…æ‹¬--package-idæ ‡å¿—ã€‚ 1peer lifecycle chaincode checkcommitreadiness --channelID mychannel --name basic --version 1.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem --output json The command will produce a JSON map that displays if a channel member has approved the parameters that were specified in the checkcommitreadiness command: è¿™ä¸ªå‘½ä»¤ä¼šç”Ÿæˆä¸€ä¸ªJSONæ¥æ˜¾ç¤ºé€šé“æˆå‘˜æ˜¯å¦å·²ç»æ‰¹å‡†äº†å®šä¹‰ã€‚ 123456&#123; &quot;Approvals&quot;: &#123; &quot;Org1MSP&quot;: true, &quot;Org2MSP&quot;: true &#125; &#125; Since both organizations that are members of the channel have approved the same parameters, the chaincode definition is ready to be committed to the channel. You can use the peer lifecycle chaincode commit command to commit the chaincode definition to the channel. The commit command also needs to be submitted by an organization admin. å› ä¸ºchannelä¸Šçš„ä¸¤ä¸ªæˆå‘˜éƒ½å·²ç»æ‰¹å‡†äº†ç›¸åŒçš„å‚æ•°ï¼Œå› æ­¤é“¾ç å®šä¹‰å·²å‡†å¤‡å¥½æäº¤ç»™channelã€‚ä½ å¯ä»¥ä½¿ç”¨peer lifecycle chaincode commit å‘½ä»¤å°†é“¾ç å®šä¹‰æäº¤åˆ°channelã€‚commitå‘½ä»¤ä¾ç„¶éœ€è¦ç”±ç»„ç»‡ç®¡ç†å‘˜æ¥å‘èµ·ã€‚ 1peer lifecycle chaincode commit -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name basic --version 1.0 --sequence 1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt The transaction above uses the --peerAddresses flag to target peer0.org1.example.com from Org1 and peer0.org2.example.com from Org2. The commit transaction is submitted to the peers joined to the channel to query the chaincode definition that was approved by the organization that operates the peer. The command needs to target the peers from a sufficient number of organizations to satisfy the policy for deploying a chaincode. Because the approval is distributed within each organization, you can target any peer that belongs to a channel member. ä¸Šé¢çš„äº¤æ˜“ä½¿ç”¨--peerAddressesæ ‡å¿—æ¥æŒ‡å®šOrg1ä¸­çš„peer0.org1.example.comå’ŒOrg2ä¸­çš„peer0.org2.example.comã€‚ commit äº¤æ˜“ä¼šæäº¤ç»™å·²ç»åŠ å…¥é€šé“çš„peerèŠ‚ç‚¹ï¼Œç”¨äºpeerèŠ‚ç‚¹æŸ¥è¯¢åŒç»„ç»‡å†…å…¶ä»–èŠ‚ç‚¹æ‰¹å‡†çš„é“¾ç å®šä¹‰ã€‚è¯¥å‘½ä»¤éœ€è¦æŒ‡æ˜æ¥è‡ªè¶³å¤Ÿæ•°é‡çš„ç»„ç»‡ä¸­çš„peerèŠ‚ç‚¹ï¼Œä»¥æ»¡è¶³éƒ¨ç½²é“¾ç çš„ç­–ç•¥ã€‚å› ä¸ºæ‰¹å‡†æ“ä½œå·²ç»åœ¨æ¯ä¸ªç»„ç»‡å†…éƒ¨è¿›è¡Œå¹¿æ’­ï¼Œæ‰€ä»¥ä½ å¯ä»¥æŒ‡å®šå±äºä¸€ä¸ªé€šé“æˆå‘˜çš„ä»»æ„çš„peerèŠ‚ç‚¹ã€‚ The chaincode definition endorsements by channel members are submitted to the ordering service to be added to a block and distributed to the channel. The peers on the channel then validate whether a sufficient number of organizations have approved the chaincode definition. The peer lifecycle chaincode commit command will wait for the validations from the peer before returning a response. é€šé“æˆå‘˜å¯¹é“¾ç å®šä¹‰çš„è®¤å¯ä¼šæäº¤ç»™æ’åºæœåŠ¡ï¼Œä»¥æ·»åŠ åˆ°åŒºå—å¹¶åˆ†å‘ç»™æ¸ é“ã€‚ç„¶åé€šé“ä¸Šçš„peerèŠ‚ç‚¹éªŒè¯æ˜¯å¦æœ‰è¶³å¤Ÿæ•°é‡çš„ç»„ç»‡æ‰¹å‡†äº†é“¾ç å®šä¹‰ã€‚peer lifecycle chaincode commitå‘½ä»¤åœ¨è¿”å›ç›¸åº”ä¹‹å‰ä¼šç­‰å¾…peerèŠ‚ç‚¹çš„éªŒè¯ã€‚ You can use the peer lifecycle chaincode querycommitted command to confirm that the chaincode definition has been committed to the channel. ä½ å¯ä»¥ä½¿ç”¨ peer lifecycle chaincode querycommitted å‘½ä»¤æ¥ç¡®è®¤é“¾ç å®šä¹‰å·²ç»æäº¤åˆ°é€šé“ã€‚ 1peer lifecycle chaincode querycommitted --channelID mychannel --name basic --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem If the chaincode was successful committed to the channel, the querycommitted command will return the sequence and version of the chaincode definition: å¦‚æœé“¾ç å·²ç»æˆåŠŸæäº¤åˆ°é€šé“ï¼Œquerycommitted å‘½ä»¤ä¼šè¿”å›è¯¥é“¾ç å®šä¹‰çš„åºåˆ—å·å’Œç‰ˆæœ¬å·ï¼š 12Committed chaincode definition for chaincode &#x27;basic&#x27; on channel &#x27;mychannel&#x27;:Version: 1.0, Sequence: 1, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [Org1MSP: true, Org2MSP: true] Invoking the chaincodeï¼ˆè°ƒç”¨é“¾ç ï¼‰ After the chaincode definition has been committed to a channel, the chaincode will start on the peers joined to the channel where the chaincode was installed. The asset-transfer (basic) chaincode is now ready to be invoked by client applications. Use the following command create an initial set of assets on the ledger. Note that the invoke command needs target a sufficient number of peers to meet chaincode endorsement policy. åœ¨é“¾ç å®šä¹‰æäº¤åˆ°é€šé“ä¹‹åï¼Œé“¾ç å¯ä»¥ç”±åŠ å…¥äº†é€šé“å¹¶ä¸”å®‰è£…äº†æ­¤é“¾ç çš„peerèŠ‚ç‚¹æ¥å¯åŠ¨ã€‚ asset-transfer (basic) çš„é“¾ç å·²ç»å¯ä»¥ç”±å®¢æˆ·ç«¯ç¨‹åºè¿›è¡Œè°ƒç”¨ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨è´¦æœ¬ä¸Šåˆ›å»ºå’Œåˆå§‹åŒ–èµ„äº§ã€‚è¯·æ³¨æ„ï¼Œinvokeå‘½ä»¤éœ€è¦ä»¥è¶³å¤Ÿæ•°é‡çš„peerä¸ºç›®æ ‡ï¼Œä»¥æ»¡è¶³é“¾ç çš„èƒŒä¹¦ç­–ç•¥ã€‚ 1peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n basic --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;InitLedger&quot;,&quot;Args&quot;:[]&#125;&#x27; If the command is successful, you should be able to a response similar to the following: å¦‚æœå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„å“åº”ï¼š 12020-12-21 16:51:11.086 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200 We can use a query function to read the set of cars that were created by the chaincode: æˆ‘ä»¬ä½¿ç”¨æŸ¥è¯¢æ–¹æ³•æ¥æŸ¥çœ‹æˆ‘ä»¬é€šè¿‡é“¾ç åˆ›å»ºçš„è½¦ï¼š 1peer chaincode query -C mychannel -n basic -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27; The response to the query should be the following list of assets: ä¸‹é¢çš„èµ„äº§åˆ—è¡¨å°±æ˜¯æŸ¥è¯¢çš„å“åº”ç»“æœï¼š 1[&#123;&quot;ID&quot;:&quot;asset1&quot;,&quot;color&quot;:&quot;blue&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Tomoko&quot;,&quot;appraisedValue&quot;:300&#125;,&#123;&quot;ID&quot;:&quot;asset2&quot;,&quot;color&quot;:&quot;red&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Brad&quot;,&quot;appraisedValue&quot;:400&#125;,&#123;&quot;ID&quot;:&quot;asset3&quot;,&quot;color&quot;:&quot;green&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Jin Soo&quot;,&quot;appraisedValue&quot;:500&#125;,&#123;&quot;ID&quot;:&quot;asset4&quot;,&quot;color&quot;:&quot;yellow&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Max&quot;,&quot;appraisedValue&quot;:600&#125;,&#123;&quot;ID&quot;:&quot;asset5&quot;,&quot;color&quot;:&quot;black&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Adriana&quot;,&quot;appraisedValue&quot;:700&#125;,&#123;&quot;ID&quot;:&quot;asset6&quot;,&quot;color&quot;:&quot;white&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Michel&quot;,&quot;appraisedValue&quot;:800&#125;] Upgrading a smart contractï¼ˆæ›´æ–°æ™ºèƒ½åˆçº¦ï¼‰ You can use the same Fabric chaincode lifecycle process to upgrade a chaincode that has already been deployed to a channel. Channel members can upgrade a chaincode by installing a new chaincode package and then approving a chaincode definition with the new package ID, a new chaincode version, and with the sequence number incremented by one. The new chaincode can be used after the chaincode definition is committed to the channel. This process allows channel members to coordinate on when a chaincode is upgraded, and ensure that a sufficient number of channel members are ready to use the new chaincode before it is deployed to the channel. æ‚¨å¯ä»¥ä½¿ç”¨ç›¸åŒçš„Fabricé“¾ç ç”Ÿå‘½å‘¨æœŸæµç¨‹æ¥å‡çº§å·²ç»éƒ¨ç½²åˆ°é€šé“çš„é“¾ç ã€‚é€šé“æˆå‘˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å‡çº§é“¾ç ï¼šå®‰è£…æ–°çš„é“¾ç åŒ…ï¼Œç„¶åæ‰¹å‡†è¿™ä¸ªå…·æœ‰æ–°packageIDã€æ–°é“¾ç ç‰ˆæœ¬ä»¥åŠåºåˆ—å·åŠ 1çš„é“¾ç å®šä¹‰ã€‚åœ¨é“¾ç å®šä¹‰è¢«æäº¤ç»™é€šé“åæ–°çš„é“¾ç å°±å¯ä»¥è¢«ä½¿ç”¨ã€‚æ­¤è¿‡ç¨‹å…è®¸é€šé“æˆå‘˜åœ¨å‡çº§é“¾ç æ—¶è¿›è¡Œåè°ƒï¼Œå¹¶ç¡®ä¿åœ¨å°†æ–°é“¾ç éƒ¨ç½²åˆ°é€šé“ä¹‹å‰ï¼Œæœ‰è¶³å¤Ÿæ•°é‡çš„é€šé“æˆå‘˜å‡†å¤‡ä½¿ç”¨æ–°é“¾ç ã€‚ Channel members can also use the upgrade process to change the chaincode endorsement policy. By approving a chaincode definition with a new endorsement policy and committing the chaincode definition to the channel, channel members can change the endorsement policy governing a chaincode without installing a new chaincode package. é€šé“æˆå‘˜ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ›´æ–°æµç¨‹æ¥ä¿®æ”¹é“¾ç çš„èƒŒä¹¦ç­–ç•¥ã€‚é€šè¿‡æ‰¹å‡†å…·æœ‰æ–°èƒŒä¹¦ç­–ç•¥çš„é“¾ç å®šä¹‰å¹¶å°†å…¶æäº¤ç»™æ¸ é“ï¼Œæ¸ é“æˆå‘˜å¯ä»¥æ›´æ”¹èƒŒä¹¦ç­–ç•¥è€Œæ— éœ€å®‰è£…æ–°çš„é“¾ç åŒ…ã€‚ To provide a scenario for upgrading the asset-transfer (basic) chaincode that we just deployed,letâ€™s assume that Org1 and Org2 would like to install a version of the chaincode that is written in another language. They will use the Fabric chaincode lifecycle to update the chaincode version and ensure that both organizations have installed the new chaincode before it becomes active on the channel. ä¸ºäº†æä¾›ä¸€ä¸ªæˆ‘ä»¬åˆšæ‰éƒ¨ç½²çš„asset-transfer (basic) é“¾ç å‡çº§çš„æƒ…æ™¯ï¼Œè®©æˆ‘ä»¬å‡è®¾Org1å’ŒOrg2æƒ³è¦å®‰è£…ä¸€ä¸ªé€šè¿‡å…¶ä»–è¯­è¨€ç¼–å†™çš„é“¾ç ç‰ˆæœ¬ã€‚ä»–ä»¬ä¼šä½¿ç”¨Fabricé“¾ç ç”Ÿå‘½å‘¨æœŸæ¥æ›´æ–°é“¾ç çš„ç‰ˆæœ¬å¹¶ä¸”åœ¨æ–°é“¾ç å¯ç”¨äºé€šé“ä¹‹å‰ç¡®ä¿æ‰€æœ‰çš„ç»„ç»‡å·²ç»å®‰è£…äº†æ–°çš„é“¾ç ã€‚ We are going to assume that Org1 and Org2 initially installed the GO version of the asset-transfer (basic) chaincode, but would be more comfortable working with a chaincode written in JavaScript. The first step is to package the JavaScript version of the asset-transfer (basic) chaincode. If you used the JavaScript instructions to package your chaincode when you went through the tutorial, you can install new chaincode binaries by following the steps for packaging a chaincode written in Go or TypeScript. æˆ‘ä»¬å‡è®¾Org1å’ŒOrg2æœ€åˆå®‰è£…äº†asset-transfer (basic) GOç‰ˆæœ¬çš„é“¾ç ï¼Œä½†ä½¿ç”¨JavaScriptç¼–å†™çš„é“¾ç ä¼šæ›´èˆ’é€‚ã€‚ç¬¬ä¸€æ­¥å°±æ˜¯æ‰“åŒ…JavaScriptç‰ˆæœ¬çš„asset-transfer (basic) é“¾ç ã€‚ Issue the following commands from the test-network directory to install the chaincode dependences. åœ¨test-network ç›®å½•ä¸‹è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥å®‰è£…é“¾ç çš„ä¾èµ–ã€‚ 123cd ../asset-transfer-basic/chaincode-javascriptnpm installcd ../../test-network æ‰“åŒ… You can then issue the following commands to package the JavaScript chaincode from the test-network directory. We will set the environment variables needed to use the peer CLI again in case you closed your terminal. ç„¶åä½ å¯ä»¥åœ¨test-network ç›®å½•ä¸‹è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æ‰“åŒ…JavaScriptç‰ˆæœ¬çš„é“¾ç ã€‚åœ¨è¿è¡Œå‘½ä»¤ä¹‹å‰å…ˆå‚è€ƒå‰é¢çš„å†…å®¹æ¥è®¾ç½®å¯ä»¥æ“ä½œOrg1çš„ç¯å¢ƒå˜é‡ã€‚ 1peer lifecycle chaincode package basic_2.tar.gz --path ../asset-transfer-basic/chaincode-javascript/ --lang node --label basic_2.0 å®‰è£… We can now use the following command to install the new chaincode package on the Org1 peer. ä½ å¯ä»¥åœ¨Org1ç»„ç»‡çš„peerèŠ‚ç‚¹é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥å®‰è£…ä¸€ä¸ªæ–°çš„é“¾ç åŒ…ã€‚ 1peer lifecycle chaincode install basic_2.tar.gz The new chaincode package will create a new package ID. We can find the new package ID by querying our peer. æ–°çš„é“¾ç åŒ…ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„package IDï¼Œæˆ‘ä»¬é€šè¿‡æŸ¥è¯¢peeræ¥è·å–æ–°çš„package IDã€‚ 1peer lifecycle chaincode queryinstalled The queryinstalled command will return a list of the chaincode that have been installed on your peer similar to this output. queryinstalled å‘½ä»¤ä¼šè¿”å›ä½ çš„peerå·²ç»å®‰è£…çš„é“¾ç ï¼Œè¾“å‡ºç±»ä¼¼å¦‚ä¸‹ï¼š 123Installed chaincodes on peer:Package ID: basic_1.0:2c47b5b060a64aafa3c878b4bcb0ca680bdb2417ca8855b5440fa595562517d2, Label: basic_1.0Package ID: basic_2.0:59cb45985332d79a903ef39d710eeb23a1c63bddaf8cd999481071457d22acbd, Label: basic_2.0 You can use the package label to find the package ID of the new chaincode and save it as a new environment variable. This output is for example only â€“ your package ID will be different, so DO NOT COPY AND PASTE! ä½ å¯ä»¥æŠŠæ–°çš„ package IDä¿å­˜ä¸ºä¸€ä¸ªæ–°çš„ç¯å¢ƒå˜é‡ã€‚ä¸‹é¢çš„å‘½ä»¤åªæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œä¸è¦ç›´æ¥copyã€‚ 1export NEW_CC_PACKAGE_ID&#x3D;basic_2.0:59cb45985332d79a903ef39d710eeb23a1c63bddaf8cd999481071457d22acbd æ‰¹å‡†é“¾ç å®šä¹‰ Org1 can now approve a new chaincode definitionï¼ˆOrg1ç°åœ¨å¯ä»¥æ‰¹å‡†è¿™ä¸ªæ–°çš„é“¾ç å®šä¹‰ï¼‰: 1peer lifecycle chaincode approveformyorg -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name basic --version 2.0 --package-id $NEW_CC_PACKAGE_ID --sequence 2 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem The new chaincode definition uses the package ID of the JavaScript chaincode package and updates the chaincode version. Because the sequence parameter is used by the Fabric chaincode lifecycle to keep track of chaincode upgrades, Org1 also needs to increment the sequence number from 1 to 2. You can use the peer lifecycle chaincode querycommitted command to find the sequence of the chaincode that was last committed to the channel. æ–°çš„é“¾ç å®šä¹‰ä½¿ç”¨JavaScriptç‰ˆæœ¬çš„é“¾ç åŒ…çš„packageIDä»¥åŠæ–°çš„é“¾ç ç‰ˆæœ¬ã€‚ç”±äºFabricé“¾ç ç”Ÿå‘½å‘¨æœŸä½¿ç”¨åºåˆ—å·æ¥è·Ÿè¸ªé“¾ç å‡çº§ï¼Œå› æ­¤Org1è¿˜éœ€è¦å°†åºåˆ—å·ä»1é€’å¢åˆ°2ã€‚ä½ å¯ä»¥ä½¿ç”¨ peer lifecycle chaincode querycommittedå‘½ä»¤æ¥æŸ¥è¯¢é“¾ç ä¸Šæ¬¡æäº¤åˆ°é€šé“çš„åºåˆ—å·ã€‚ We now need to install the chaincode package and approve the chaincode definition as Org2 in order to upgrade the chaincode. Run the following commands to operate the peer CLI as the Org2 admin: æˆ‘ä»¬ç°åœ¨éœ€è¦ä»¥Org2ç»„ç»‡çš„èº«ä»½æ¥å®‰è£…é“¾ç å¹¶ä¸”æ‰¹å‡†é“¾ç å®šä¹‰æ¥æ›´æ–°é“¾ç ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥ä½¿ç”¨Org2ç»„ç»‡çš„ç®¡ç†å‘˜è¿›è¡Œæ“ä½œï¼š 12345export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crtexport CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crtexport CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/mspexport CORE_PEER_ADDRESS=localhost:9051 å…¶ä»–ç»„ç»‡å®‰è£…é“¾ç  We can now use the following command to install the new chaincode package on the Org2 peer. æˆ‘ä»¬ç°åœ¨å°±å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥å®‰è£…æ–°çš„é“¾ç åŒ…åˆ°Org2ç»„ç»‡çš„peerä¸Šã€‚ 1peer lifecycle chaincode install basic_2.tar.gz æ‰¹å‡†é“¾ç å®šä¹‰ You can now approve the new chaincode definition for Org2. æˆ‘ä»¬ç°åœ¨å¯ä»¥ä¸ºOrg2ç»„ç»‡æ‰¹å‡†è¿™ä¸ªæ–°çš„é“¾ç å®šä¹‰ã€‚ 1peer lifecycle chaincode approveformyorg -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name basic --version 2.0 --package-id $NEW_CC_PACKAGE_ID --sequence 2 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem Use the peer lifecycle chaincode checkcommitreadiness command to check if the chaincode definition with sequence 2 is ready to be committed to the channel: ä½¿ç”¨peer lifecycle chaincode checkcommitreadiness æ•ç²æ¥æ£€æŸ¥åºåˆ—å·ä¸º2çš„é“¾ç å®šä¹‰æ˜¯å¦å·²ç»å‡†å¤‡å¥½è¢«æäº¤åˆ°channelä¸Šï¼š 1peer lifecycle chaincode checkcommitreadiness --channelID mychannel --name basic --version 2.0 --sequence 2 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem --output json The chaincode is ready to be upgraded if the command returns the following JSON: å¦‚æœè¿™ä¸ªå‘½ä»¤è¿”å›ä»¥ä¸‹å†…å®¹ï¼Œè¯´æ˜å·²ç»å‡†å¤‡å¥½æ›´æ–°äº†ï¼š 123456&#123; &quot;approvals&quot;: &#123; &quot;Org1MSP&quot;: true, &quot;Org2MSP&quot;: true &#125;&#125; The chaincode will be upgraded on the channel after the new chaincode definition is committed. Until then, the previous chaincode will continue to run on the peers of both organizations. Org2 can use the following command to upgrade the chaincode: åœ¨æ–°çš„é“¾ç å®šä¹‰æäº¤åï¼Œé€šé“ä¸Šçš„é“¾ç å°†ä¼šå‡çº§ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå…ˆå‰çš„é“¾ç å°†ç»§ç»­åœ¨ä¸¤ä¸ªç»„ç»‡çš„peerä¸Šè¿è¡Œã€‚Org2ç»„ç»‡å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æ›´æ–°é“¾ç ï¼š 1peer lifecycle chaincode commit -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --channelID mychannel --name basic --version 2.0 --sequence 2 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt A successful commit transaction will start the new chaincode right away. If the chaincode definition changed the endorsement policy, the new policy would be put in effect. æˆåŠŸçš„æäº¤çš„äº¤æ˜“å°†ç«‹å³å¯åŠ¨æ–°çš„é“¾ç ã€‚å¦‚æœé“¾ç å®šä¹‰æ›´æ”¹äº†èƒŒä¹¦ç­–ç•¥ï¼Œåˆ™æ–°æ”¿ç­–å°†ç”Ÿæ•ˆã€‚ You can use the docker ps command to verify that the new chaincode has started on your peers: ä½ ç°åœ¨å¯ä»¥ä½¿ç”¨ docker ps å‘½ä»¤æ¥éªŒè¯æ–°çš„é“¾ç å·²ç»åœ¨ä½ çš„peerèŠ‚ç‚¹å¯åŠ¨ã€‚ 12345678$docker psCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES2e253d5141c3 dev-peer0.org2.example.com-basic_2.0-59cb45985332d79a903ef39d710eeb23a1c63bddaf8cd999481071457d22acbd-c00efc2e7c009601f23247ba3330c47fc5b737d476f8233da9b404c28681847b &quot;docker-entrypoint.sâ€¦&quot; 2 minutes ago Up 2 minutes dev-peer0.org2.example.com-basic_2.0-59cb45985332d79a903ef39d710eeb23a1c63bddaf8cd999481071457d22acbdcb7260fc3aa6 dev-peer0.org1.example.com-basic_2.0-59cb45985332d79a903ef39d710eeb23a1c63bddaf8cd999481071457d22acbd-ececda85b7ddf5cad9e5cbca808ffe76bc0b4b0d3067c345afa365a764b062ff &quot;docker-entrypoint.sâ€¦&quot; 2 minutes ago Up 2 minutes dev-peer0.org1.example.com-basic_2.0-59cb45985332d79a903ef39d710eeb23a1c63bddaf8cd999481071457d22acbdee12e6769e93 gliderlabs/logspout &quot;/bin/logspout&quot; 6 hours ago Up 6 hours 127.0.0.1:8000-&gt;80/tcp logspout628b12f2b3f0 hyperledger/fabric-peer:latest &quot;peer node start&quot; 6 hours ago Up 6 hours 7051/tcp, 0.0.0.0:9051-&gt;9051/tcp peer0.org2.example.come47cbd1b0b15 hyperledger/fabric-peer:latest &quot;peer node start&quot; 6 hours ago Up 6 hours 0.0.0.0:7051-&gt;7051/tcp peer0.org1.example.come67946f412a7 hyperledger/fabric-orderer:latest &quot;orderer&quot; 6 hours ago Up 6 hours 0.0.0.0:7050-&gt;7050/tcp orderer.example.com If you used the --init-required flag, you need to invoke the Init function before you can use the upgraded chaincode. Because we did not request the execution of Init, we can test our new JavaScript chaincode by creating a new car: æˆ‘ä»¬ç°åœ¨å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çš„æ±½è½¦æ¥æµ‹è¯•æˆ‘ä»¬æ–°çš„JavaScriptç‰ˆæœ¬çš„é“¾ç ï¼š 1peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n basic --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;CreateAsset&quot;,&quot;Args&quot;:[&quot;asset8&quot;,&quot;blue&quot;,&quot;16&quot;,&quot;Kelley&quot;,&quot;750&quot;]&#125;&#x27; You can query all the cars on the ledger again to see the new car: ä½ å¯ä»¥æŸ¥è¯¢è´¦æœ¬ä¸Šæ‰€æœ‰çš„è½¦æ¥çœ‹æ–°åˆ›å»ºçš„carï¼š 1peer chaincode query -C mychannel -n basic -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27; You should see the following result from the JavaScript chaincode: é€šè¿‡JavaScriptç‰ˆæœ¬çš„é“¾ç ï¼Œä½ ä¼šçœ‹åˆ°ä¸‹é¢çš„ç»“æœï¼š 1[&#123;&quot;Key&quot;:&quot;asset1&quot;,&quot;Record&quot;:&#123;&quot;ID&quot;:&quot;asset1&quot;,&quot;color&quot;:&quot;blue&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Tomoko&quot;,&quot;appraisedValue&quot;:300&#125;&#125;,&#123;&quot;Key&quot;:&quot;asset2&quot;,&quot;Record&quot;:&#123;&quot;ID&quot;:&quot;asset2&quot;,&quot;color&quot;:&quot;red&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Brad&quot;,&quot;appraisedValue&quot;:400&#125;&#125;,&#123;&quot;Key&quot;:&quot;asset3&quot;,&quot;Record&quot;:&#123;&quot;ID&quot;:&quot;asset3&quot;,&quot;color&quot;:&quot;green&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Jin Soo&quot;,&quot;appraisedValue&quot;:500&#125;&#125;,&#123;&quot;Key&quot;:&quot;asset4&quot;,&quot;Record&quot;:&#123;&quot;ID&quot;:&quot;asset4&quot;,&quot;color&quot;:&quot;yellow&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Max&quot;,&quot;appraisedValue&quot;:600&#125;&#125;,&#123;&quot;Key&quot;:&quot;asset5&quot;,&quot;Record&quot;:&#123;&quot;ID&quot;:&quot;asset5&quot;,&quot;color&quot;:&quot;black&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Adriana&quot;,&quot;appraisedValue&quot;:700&#125;&#125;,&#123;&quot;Key&quot;:&quot;asset6&quot;,&quot;Record&quot;:&#123;&quot;ID&quot;:&quot;asset6&quot;,&quot;color&quot;:&quot;white&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Michel&quot;,&quot;appraisedValue&quot;:800&#125;&#125;,&#123;&quot;Key&quot;:&quot;asset8&quot;,&quot;Record&quot;:&#123;&quot;ID&quot;:&quot;asset8&quot;,&quot;Color&quot;:&quot;blue&quot;,&quot;Size&quot;:&quot;16&quot;,&quot;Owner&quot;:&quot;Kelley&quot;,&quot;AppraisedValue&quot;:&quot;750&quot;&#125;&#125;] Clean upï¼ˆæ¸…ç†ï¼‰ When you are finished using the chaincode, you can also use the following commands to remove the Logspout tool. å½“ä½ ä½¿ç”¨é“¾ç ç»“æŸä¹‹åï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥ç§»é™¤Logspout toolã€‚ 12docker stop logspoutdocker rm logspout You can then bring down the test network by issuing the following command from the test-network directory: ä½ ç°åœ¨å¯ä»¥åœ¨test-network ç›®å½•ä¸‹ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥å…³é—­æµ‹è¯•ç½‘ç»œï¼š 1./network.sh down","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"channel","slug":"åŒºå—é“¾/Hyperledger-Fabric/channel","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/channel/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"channel","slug":"channel","permalink":"https://guozhe001.github.io/tags/channel/"}]},{"title":"åœ¨Fabricä¸­ä½¿ç”¨ç§æœ‰æ•°æ®","slug":"blockchain/fabric/åœ¨Fabricä¸­ä½¿ç”¨ç§æœ‰æ•°æ®","date":"2021-04-01T10:18:21.486Z","updated":"2021-04-01T10:18:21.487Z","comments":true,"path":"2021/04/01/blockchain/fabric/åœ¨Fabricä¸­ä½¿ç”¨ç§æœ‰æ•°æ®/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E5%9C%A8Fabric%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%A7%81%E6%9C%89%E6%95%B0%E6%8D%AE/","excerpt":"","text":"åœ¨Fabricä¸­ä½¿ç”¨ç§æœ‰æ•°æ® å®˜æ–¹æ–‡æ¡£ï¼šUsing Private Data in Fabric This tutorial will demonstrate the use of Private Data Collections (PDC) to provide storage and retrieval of private data on the blockchain network for authorized peers of organizations. The collection is specified using a collection definition file containing the policies governing that collection. æœ¬æ•™ç¨‹å°†æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ç§æœ‰æ•°æ®é›†ï¼ˆPDCï¼‰ä¸ºç»„ç»‡çš„æœ‰æƒé™çš„peeråœ¨åŒºå—é“¾ç½‘ç»œä¸Šæä¾›ç§æœ‰æ•°æ®çš„å­˜å‚¨å’Œæ£€ç´¢ã€‚ä½¿ç”¨åŒ…å«å®šä¹‰è¯¥PDCç­–ç•¥çš„é›†åˆå®šä¹‰æ–‡ä»¶æ¥ç®¡ç†PDCã€‚ The information in this tutorial assumes knowledge of private data stores and their use cases. For more information, check out Private data. æœ¬æ•™ç¨‹ä¸­çš„ä¿¡æ¯å‡å®šæ‚¨äº†è§£ç§æœ‰æ•°æ®å­˜å‚¨åŠå…¶ä½¿ç”¨æ¡ˆä¾‹ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹Private dataã€‚ The tutorial will take you through the following steps to practice defining, configuring and using private data with Fabric: æœ¬æ•™ç¨‹å°†æŒ‡å¯¼æ‚¨å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼Œä»¥ç»ƒä¹ å®šä¹‰ã€é…ç½®å’Œä½¿ç”¨Fabricç§æœ‰æ•°æ®ï¼š Asset transfer private data sample use case èµ„äº§è½¬ç§»ç§æœ‰æ•°æ®æ ·ä¾‹ä½¿ç”¨æ–¹æ³• Build a collection definition JSON file æ„å»ºä¸€ä¸ªé›†åˆå®šä¹‰JSONæ–‡ä»¶ Read and Write private data using chaincode APIs ä½¿ç”¨chaincode APIè¯»å†™ç§æœ‰æ•°æ® Deploy the private data smart contract to the channel éƒ¨ç½²ç§æœ‰æ•°æ®æ™ºèƒ½åˆçº¦åˆ°é€šé“ Register identities æ³¨å†Œèº«ä»½ Create an asset in private data åœ¨ç§æœ‰æ•°æ®é›†ä¸­åˆ›å»ºèµ„äº§ Query the private data as an authorized peer é€šè¿‡æœ‰æƒé™çš„peeræŸ¥è¯¢ç§æœ‰æ•°æ® Query the private data as an unauthorized peer é€šè¿‡æ²¡æœ‰æƒé™çš„peeræŸ¥è¯¢ç§æœ‰æ•°æ® Transfer the Asset äº¤æ˜“åœ¨ç§æœ‰æ•°æ®é›†ä¸­çš„èµ„äº§ Purge Private Data æ¸…é™¤ç§æœ‰æ•°æ® Using indexes with private data å¯¹ç§æœ‰æ•°æ®ä½¿ç”¨ç´¢å¼• Additional resources é¢å¤–èµ„æº This tutorial will deploy the asset transfer private data sample to the Fabric test network to demonstrate how to create, deploy, and use a collection of private data. You should have completed the task Install Samples, Binaries, and Docker Images. è¿™ä¸ªæ•™ç¨‹ä¼šéƒ¨ç½² asset transfer private data sampleåˆ°Fabricçš„æµ‹è¯•ç½‘ç»œæ¥æ¼”ç¤ºå¦‚ä½•åˆ›å»ºã€éƒ¨ç½²ä»¥åŠä½¿ç”¨PDCã€‚ Asset transfer private data sample use caseï¼ˆèµ„äº§è½¬ç§»ç§æœ‰æ•°æ®æ ·ä¾‹ä½¿ç”¨æ–¹æ³•ï¼‰ This sample demonstrates the use of three private data collections, assetCollection, Org1MSPPrivateCollection &amp; Org2MSPPrivateCollection to transfer an asset between Org1 and Org2, using following use case: è¿™ä¸ªæ ·ä¾‹ä½¿ç”¨ä»¥ä¸‹ç”¨ä¾‹æ¼”ç¤ºä½¿ç”¨ä¸‰ä¸ªç§æœ‰æ•°æ®é›†ï¼ˆPDCï¼‰æ¥åœ¨Org1å’ŒOrg2ç»„ç»‡ä¹‹é—´äº¤æ˜“èµ„äº§ï¼›è¿™ä¸‰ä¸ªPDCä¸ºï¼šassetCollection, Org1MSPPrivateCollection &amp; Org2MSPPrivateCollection ã€‚ A member of Org1 creates a new asset, henceforth referred as owner. The public details of the asset, including the identity of the owner, are stored in the private data collection named assetCollection. The asset is also created with an appraised value supplied by the owner. The appraised value is used by each participant to agree to the transfer of the asset, and is only stored in owner organizationâ€™s collection. In our case, the initial appraisal value agreed by the owner is stored in the Org1MSPPrivateCollection. ç»„ç»‡Org1çš„ä¸€ä¸ªæˆå‘˜åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„äº§ï¼Œå¹¶æ‹¥æœ‰è¿™ä¸ªèµ„äº§ã€‚å…¬å…±çš„èµ„äº§è¯¦æƒ…ï¼ŒåŒ…æ‹¬æ‹¥æœ‰è€…çš„èº«ä»½è¢«å­˜å‚¨åœ¨ç§°ä½œ assetCollectionçš„ç§æœ‰æ•°æ®é›†ä¸­ã€‚èµ„äº§æ‰€æœ‰è€…ä¹Ÿä¼šä¸ºè¿™ä¸ªèµ„äº§åˆ›å»ºä¸€ä¸ªè¯„ä¼°ä»·å€¼ï¼Œé€šé“ä¸Šçš„æ¯ä¸ªå‚ä¸è€…éƒ½ä½¿ç”¨è¿™ä¸ªè¯„ä¼°ä»·å€¼æ¥åŒæ„èµ„äº§è½¬è®©ï¼Œå¹¶ä¸”å®ƒä»…å­˜å‚¨åœ¨æ‰€æœ‰è€…ç»„ç»‡çš„é›†åˆä¸­ã€‚åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œæ‰€æœ‰è€…ç¡®è®¤çš„åˆå§‹è¯„ä¼°å€¼å­˜å‚¨åœ¨Org1MSPPrivateCollectionä¸­ã€‚ To purchase the asset, the buyer needs to agree to the same appraised value as the asset owner. In this step, the buyer (a member of Org2) creates an agreement to trade and agree to an appraisal value using smart contract function 'AgreeToTransfer'. This value is stored in Org2MSPPrivateCollection collection. Now, the asset owner can transfer the asset to the buyer using smart contract function 'TransferAsset'. The 'TransferAsset' function uses the hash on the channel ledger to confirm that the owner and the buyer have agreed to the same appraised value before transferring the asset. è¦è´­ä¹°èµ„äº§ï¼Œè´­ä¹°è€…éœ€è¦åŒæ„ä¸èµ„äº§æ‰€æœ‰è€…ç›¸åŒçš„è¯„ä¼°ä»·å€¼ã€‚åœ¨æ­¤æ­¥éª¤ä¸­ï¼Œä¹°æ–¹ï¼ˆOrg2çš„æˆå‘˜ï¼‰ä½¿ç”¨æ™ºèƒ½åˆçº¦çš„â€œAgreeToTransferâ€æ–¹æ³•æ¥åˆ›å»ºäº¤æ˜“åè®®å¹¶åŒæ„è¯„ä¼°ä»·å€¼ã€‚æ­¤å€¼å­˜å‚¨åœ¨Org2MSPPrivateCollectioné›†åˆä¸­ã€‚ç°åœ¨èµ„äº§çš„æ‹¥æœ‰è€…å¯ä»¥é€šè¿‡æ™ºèƒ½åˆçº¦ä¸­çš„'TransferAsset'æ–¹æ³•æ¥äº¤æ˜“èµ„äº§äº†ã€‚ 'TransferAsset' æ–¹æ³•åœ¨è½¬è®©èµ„äº§ä¹‹å‰å…ˆä½¿ç”¨é€šé“è´¦æœ¬ä¸Šçš„hashæ¥éªŒè¯ä¹°å–åŒæ–¹å·²ç»å¯¹ç›¸åŒçš„è¯„ä¼°ä»·æ ¼è¾¾æˆäº†ä¸€è‡´ã€‚ Before we go through the transfer scenario, we will discuss how organizations can use private data collections in Fabric. åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å°†è®¨è®ºç»„ç»‡å¦‚ä½•åœ¨Fabricä¸­ä½¿ç”¨ç§æœ‰æ•°æ®é›†åˆã€‚ Build a collection definition JSON fileï¼ˆæ„å»ºä¸€ä¸ªé›†åˆå®šä¹‰JSONæ–‡ä»¶ï¼‰ Before a set of organizations can transact using private data, all organizations on channel need to build a collection definition file that defines the private data collections associated with each chaincode. Data that is stored in a private data collection is only distributed to the peers of certain organizations instead of all members of the channel. The collection definition file describes all of the private data collections that organizations can read and write to from a chaincode. åœ¨ä¸€ç»„ç»„ç»‡å¯ä»¥ä½¿ç”¨ç§æœ‰æ•°æ®è¿›è¡Œäº¤æ˜“ä¹‹å‰ï¼Œé€šé“ä¸Šçš„æ‰€æœ‰ç»„ç»‡éœ€è¦æ„å»ºä¸€ä¸ªé›†åˆå®šä¹‰æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å®šä¹‰ä¸æ¯ä¸ªé“¾ç å…³è”çš„ç§æœ‰æ•°æ®é›†åˆã€‚å­˜å‚¨åœ¨ç§æœ‰æ•°æ®é›†åˆä¸­çš„æ•°æ®ä»…åˆ†å‘ç»™ç›¸åŒç»„ç»‡çš„peerèŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯åˆ†å‘ç»™é€šé“çš„æ‰€æœ‰æˆå‘˜ã€‚é›†åˆå®šä¹‰æ–‡ä»¶æè¿°äº†ç»„ç»‡å¯ä»¥é€šè¿‡é“¾ç è¯»å†™çš„æ‰€æœ‰ç§æœ‰æ•°æ®é›†ã€‚ Each collection is defined by the following properties: name: Name of the collection. policy: Defines the organization peers allowed to persist the collection data. requiredPeerCount: Number of peers required to disseminate the private data as a condition of the endorsement of the chaincode maxPeerCount: For data redundancy purposes, the number of other peers that the current endorsing peer will attempt to distribute the data to. If an endorsing peer goes down, these other peers are available at commit time if there are requests to pull the private data. blockToLive: For very sensitive information such as pricing or personal information, this value represents how long the data should live on the private database in terms of blocks. The data will live for this specified number of blocks on the private database and after that it will get purged, making this data obsolete from the network. To keep private data indefinitely, that is, to never purge private data, set the blockToLive property to 0. memberOnlyRead: a value of true indicates that peers automatically enforce that only clients belonging to one of the collection member organizations are allowed read access to private data. memberOnlyWrite: a value of true indicates that peers automatically enforce that only clients belonging to one of the collection member organizations are allowed write access to private data. endorsementPolicy: defines the endorsement policy that needs to be met in order to write to the private data collection. The collection level endorsement policy overrides to chaincode level policy. For more information on building a policy definition refer to the Endorsement policies topic. æ‰€æœ‰çš„é›†åˆéƒ½æ˜¯ç”¨ä¸‹é¢çš„å±æ€§æ¥å®šä¹‰ï¼š name: é›†åˆåç§° policy: å®šä¹‰å…è®¸æŒä¹…åŒ–é›†åˆæ•°æ®çš„ç»„ç»‡çš„peerèŠ‚ç‚¹ã€‚ requiredPeerCount: ä¼ æ’­ç§æœ‰æ•°æ®æ‰€éœ€çš„peeræ•°ç›®ï¼Œä»¥ä½œä¸ºå¯¹é“¾ç çš„è®¤å¯ maxPeerCount: ä¸ºäº†æ•°æ®å†—ä½™ï¼Œå½“å‰åˆæ³•peerå°†å°è¯•å‘å…¶åˆ†å‘æ•°æ®çš„å…¶ä»–peerçš„æ•°é‡ã€‚å¦‚æœä¸€ä¸ªåˆæ³•çš„peeræŒ‚äº†ï¼Œå¦‚æœæœ‰è¯·æ±‚æ‹‰ç§æœ‰æ•°æ®çš„è¯·æ±‚ï¼Œåˆ™è¿™äº›å…¶ä»–peeråœ¨æäº¤æ—¶å¯ç”¨ã€‚ blockToLive: å¯¹äºå¦‚ä»·æ ¼æˆ–ä¸ªäººä¿¡æ¯è¿™ç±»éå¸¸æ•æ„Ÿçš„ä¿¡æ¯ï¼Œæ­¤å€¼è¡¨ç¤ºæ•°æ®åº”åœ¨ç§æœ‰æ•°æ®åº“çš„å—ä¸Šä¿å­˜çš„æ—¶é—´ã€‚æ•°æ®å°†åœ¨ç§æœ‰æ•°æ®åº“å—ä¸Šä¿ç•™æŒ‡å®šçš„æ—¶é—´ï¼Œç„¶åæ¸…é™¤ï¼Œä½¿è¯¥æ•°æ®ä»ç½‘ç»œä¸Šè¿‡æ—¶ã€‚è¦æ— é™æœŸä¿ç•™ç§æœ‰æ•°æ®ï¼Œå³ä»ä¸æ¸…é™¤ç§æœ‰æ•°æ®ï¼Œè¯·å°†blockToLiveå±æ€§è®¾ç½®ä¸º0ã€‚ memberOnlyRead: å€¼ä¸ºtrueè¡¨ç¤ºpeerèŠ‚ç‚¹è‡ªåŠ¨å¼ºåˆ¶åªæœ‰å±äºé›†åˆæˆå‘˜ç»„ç»‡çš„å®¢æˆ·ç«¯æ‰å…è®¸è¯»å–ç§æœ‰æ•°æ®ã€‚ memberOnlyWrite:å€¼ä¸ºtrueè¡¨ç¤ºpeerèŠ‚ç‚¹è‡ªåŠ¨å¼ºåˆ¶åªæœ‰å±äºé›†åˆæˆå‘˜ç»„ç»‡çš„å®¢æˆ·ç«¯æ‰å…è®¸å†™å…¥ç§æœ‰æ•°æ®ã€‚ endorsementPolicy: å®šä¹‰äº†å†™å…¥ç§æœ‰æ•°æ®é›†åˆéœ€è¦æ»¡è¶³çš„è®¤å¯ç­–ç•¥ã€‚é›†åˆçº§åˆ«çš„èƒŒä¹¦ç­–ç•¥ä¼šè¦†ç›–chaincodeçº§åˆ«çš„ç­–ç•¥ã€‚æœ‰å…³æ„å»ºç­–ç•¥å®šä¹‰çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ Endorsement policiesä¸»é¢˜ã€‚ The same collection definition file needs to be deployed by all organizations that use the chaincode, even if the organization does not belong to any collections. In addition to the collections that are explicitly defined in a collection file, each organization has access to an implicit collection on their peers that can only be read by their organization. For an example that uses implicit data collections, see the Secured asset transfer in Fabric. æ‰€æœ‰ä½¿ç”¨åŒä¸€ä¸ªchaincodeçš„ç»„ç»‡éƒ½è¦éƒ¨ç½²ç›¸åŒçš„é›†åˆå®šä¹‰æ–‡ä»¶ï¼Œå³ä½¿è¿™ä¸ªç»„ç»‡ä¸å±äºä»»ä½•é›†åˆã€‚é™¤äº†åœ¨é›†åˆæ–‡ä»¶ä¸­æ˜¾å¼å®šä¹‰çš„é›†åˆä¹‹å¤–ï¼Œæ¯ä¸ªç»„ç»‡éƒ½å¯ä»¥è®¿é—®å…¶peerèŠ‚ç‚¹ä¸Šçš„éšå¼é›†åˆï¼Œè¿™äº›éšå¼é›†åˆåªèƒ½ç”±å…¶ç»„ç»‡è¯»å–ã€‚ä½¿ç”¨éšå¼æ•°æ®é›†çš„ä¾‹å­å¯ä»¥çœ‹Secured asset transfer in Fabricã€‚ The asset transfer private data example contains a collections_config.json file that defines three private data collection definitions: assetCollection, Org1MSPPrivateCollection, and Org2MSPPrivateCollection. èµ„äº§è½¬ç§»ç§æœ‰æ•°æ®çš„ç¤ºä¾‹åŒ…å«ä¸€ä¸ªcollections_config.jsonæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å®šä¹‰äº†ä¸‰ä¸ªç§æœ‰æ•°æ®é›†åˆå®šä¹‰ï¼šassetCollection, Org1MSPPrivateCollection, and Org2MSPPrivateCollectionã€‚ 12345678910111213141516171819202122232425262728293031323334353637// collections_config.json[ &#123; &quot;name&quot;: &quot;assetCollection&quot;, &quot;policy&quot;: &quot;OR(&#x27;Org1MSP.member&#x27;, &#x27;Org2MSP.member&#x27;)&quot;, &quot;requiredPeerCount&quot;: 1, &quot;maxPeerCount&quot;: 1, &quot;blockToLive&quot;:1000000, &quot;memberOnlyRead&quot;: true, &quot;memberOnlyWrite&quot;: true &#125;, &#123; &quot;name&quot;: &quot;Org1MSPPrivateCollection&quot;, &quot;policy&quot;: &quot;OR(&#x27;Org1MSP.member&#x27;)&quot;, &quot;requiredPeerCount&quot;: 0, &quot;maxPeerCount&quot;: 1, &quot;blockToLive&quot;:3, &quot;memberOnlyRead&quot;: true, &quot;memberOnlyWrite&quot;: false, &quot;endorsementPolicy&quot;: &#123; &quot;signaturePolicy&quot;: &quot;OR(&#x27;Org1MSP.member&#x27;)&quot; &#125; &#125;, &#123; &quot;name&quot;: &quot;Org2MSPPrivateCollection&quot;, &quot;policy&quot;: &quot;OR(&#x27;Org2MSP.member&#x27;)&quot;, &quot;requiredPeerCount&quot;: 0, &quot;maxPeerCount&quot;: 1, &quot;blockToLive&quot;:3, &quot;memberOnlyRead&quot;: true, &quot;memberOnlyWrite&quot;: false, &quot;endorsementPolicy&quot;: &#123; &quot;signaturePolicy&quot;: &quot;OR(&#x27;Org2MSP.member&#x27;)&quot; &#125; &#125;] The policy property in the assetCollection definition specifies that both Org1 and Org2 can store the collection on their peers. The memberOnlyRead and memberOnlyWrite parameters are used to specify that only Org1 and Org2 clients can read and write to this collection. assetCollectionå®šä¹‰ä¸­çš„policyå±æ€§æŒ‡å®šOrg1å’ŒOrg2éƒ½å¯ä»¥åœ¨å…¶peerèŠ‚ç‚¹ä¸Šå­˜å‚¨é›†åˆã€‚ memberOnlyRead å’Œ memberOnlyWrite å‚æ•°è¢«ç”¨äºæŒ‡å®šåªæœ‰Org1å’ŒOrg2çš„å®¢æˆ·ç«¯å¯ä»¥è¯»å†™è¿™ä¸ªé›†åˆã€‚ The Org1MSPPrivateCollection collection allows only peers of Org1 to have the private data in their private database, while the Org2MSPPrivateCollection collection can only be stored by the peers of Org2. The endorsementPolicy parameter is used to create a collection specific endorsement policy. Each update to Org1MSPPrivateCollection or Org2MSPPrivateCollection needs to be endorsed by the organization that stores the collection on their peers. We will see how these collections are used to transfer the asset in the course of the tutorial. Org1MSPPrivateCollection é›†åˆåªå…è®¸Org1çš„peerèŠ‚ç‚¹åœ¨ä»–ä»¬çš„ç§æœ‰æ•°æ®åº“ä¸­æ‹¥æœ‰ç§æœ‰æ•°æ®ï¼Œè€ŒOrg2MSPPrivateCollectioné›†åˆåªèƒ½ç”±Org2çš„peerèŠ‚ç‚¹å­˜å‚¨ã€‚ endorsementPolicy å‚æ•°ç”¨äºåˆ›å»ºç‰¹å®šé›†åˆçš„è®¤å¯ç­–ç•¥ã€‚å¯¹Org1MSPPrivateCollectionæˆ–Org2MSPPrivateCollectionçš„æ¯æ¬¡æ›´æ–°éƒ½éœ€è¦ç”±å°†é›†åˆå­˜å‚¨åœ¨å…¶peerèŠ‚ç‚¹çš„ç»„ç»‡è®¤å¯ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨è¿™äº›é›†åˆæ¥è½¬ç§»èµ„äº§ã€‚ This collection definition file is deployed when the chaincode definition is committed to the channel using the peer lifecycle chaincode commit command. More details on this process are provided in Section 3 below. è¿™ä¸ªé›†åˆå®šä¹‰æ–‡ä»¶æ˜¯åœ¨ä½¿ç”¨peer lifecycle chaincode commit commandæŠŠé“¾ç å®šä¹‰æäº¤åˆ°é€šé“æ—¶è¢«éƒ¨ç½²çš„ã€‚ Read and Write private data using chaincode APIsï¼ˆä½¿ç”¨chaincode APIè¯»å†™ç§æœ‰æ•°æ®ï¼‰ The next step in understanding how to privatize data on a channel is to build the data definition in the chaincode. The asset transfer private data sample divides the private data into three separate data definitions according to how the data will be accessed. ä¸‹ä¸€æ­¥æ˜¯äº†è§£å¦‚ä½•åœ¨é“¾ç ä¸­å»ºç«‹æ•°æ®å®šä¹‰æ¥å¯¹é€šé“ä¸Šçš„æ•°æ®è¿›è¡Œç§æœ‰åŒ–ã€‚èµ„äº§è½¬ç§»ç§æœ‰æ•°æ®å®ä¾‹æ ¹æ®è®¿é—®æ•°æ®çš„æ–¹å¼å°†ç§æœ‰æ•°æ®åˆ†ä¸ºä¸‰ä¸ªå•ç‹¬çš„æ•°æ®å®šä¹‰ã€‚ 12345678910111213141516171819202122// Peers in Org1 and Org2 will have this private data in a side databasetype Asset struct &#123; Type string `json:&quot;objectType&quot;` //Type is used to distinguish the various types of objects in state database ID string `json:&quot;assetID&quot;` Color string `json:&quot;color&quot;` Size int `json:&quot;size&quot;` Owner string `json:&quot;owner&quot;`&#125;// AssetPrivateDetails describes details that are private to owners// Only peers in Org1 will have this private data in a side databasetype AssetPrivateDetails struct &#123; ID string `json:&quot;assetID&quot;` AppraisedValue int `json:&quot;appraisedValue&quot;`&#125;// Only peers in Org2 will have this private data in a side databasetype AssetPrivateDetails struct &#123; ID string `json:&quot;assetID&quot;` AppraisedValue int `json:&quot;appraisedValue&quot;`&#125; Specifically, access to the private data will be restricted as follows: objectType, color, size, and owner are stored in assetCollection and hence will be visible to members of the channel per the definition in the collection policy (Org1 and Org2). AppraisedValue of an asset is stored in collection Org1MSPPrivateCollection or Org2MSPPrivateCollection , depending on the owner of the asset. The value is only accessible to the users who belong to the organization that can store the collection. å…·ä½“æ¥è¯´ï¼Œå¯¹ç§æœ‰æ•°æ®çš„è®¿é—®å°†å—åˆ°ä»¥ä¸‹é™åˆ¶ï¼š objectType, color, size, and owner è¢«å­˜å‚¨åœ¨ assetCollection å› æ­¤ï¼Œæ ¹æ®é›†åˆç­–ç•¥ä¸­çš„å®šä¹‰ï¼Œè¿™äº›æ•°æ®å¯¹é€šé“ä¸Šçš„Org1å’ŒOrg2æ˜¯å¯ä»¥è®¿é—®çš„ã€‚ èµ„äº§çš„è¯„ä¼°ä»·å€¼è¢«å­˜å‚¨åœ¨ Org1MSPPrivateCollection æˆ– Org2MSPPrivateCollection é›†åˆä¸­ï¼Œå–å†³äºèµ„äº§çš„æ‰€æœ‰è€…ã€‚åªæœ‰å±äºå¯ä»¥å­˜å‚¨é›†åˆçš„ç»„ç»‡çš„ç”¨æˆ·æ‰èƒ½è®¿é—®è¯¥è¯„ä¼°å€¼ã€‚","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"Secured","slug":"Secured","permalink":"https://guozhe001.github.io/tags/Secured/"},{"name":"Private Data","slug":"Private-Data","permalink":"https://guozhe001.github.io/tags/Private-Data/"}]},{"title":"åœ¨Fabricä¸­äº¤æ˜“å—ä¿æŠ¤çš„èµ„äº§","slug":"blockchain/fabric/åœ¨Fabricä¸­äº¤æ˜“å—ä¿æŠ¤çš„èµ„äº§","date":"2021-04-01T10:18:21.485Z","updated":"2021-04-01T10:18:21.486Z","comments":true,"path":"2021/04/01/blockchain/fabric/åœ¨Fabricä¸­äº¤æ˜“å—ä¿æŠ¤çš„èµ„äº§/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E5%9C%A8Fabric%E4%B8%AD%E4%BA%A4%E6%98%93%E5%8F%97%E4%BF%9D%E6%8A%A4%E7%9A%84%E8%B5%84%E4%BA%A7/","excerpt":"","text":"åœ¨Fabricä¸­äº¤æ˜“å—ä¿æŠ¤çš„èµ„äº§ å®˜æ–¹æ–‡æ¡£ï¼šSecured asset transfer in Fabric This tutorial will demonstrate how an asset can be represented and traded between organizations in a Hyperledger Fabric blockchain channel, while keeping details of the asset and transaction private using private data. Each on-chain asset is a non-fungible token (NFT) that represents a specific asset having certain immutable metadata properties (such as size and color) with a unique owner. When the owner wants to sell the asset, both parties need to agree to the same price before the asset is transferred. The private asset transfer smart contract enforces that only the owner of the asset can transfer the asset. In the course of this tutorial, you will learn how Fabric features such as state based endorsement, private data, and access control come together to provide secured transactions that are both private and verifiable. æœ¬æ–‡æ¡£ä¼šæ¼”ç¤ºå¦‚ä½•åœ¨Hyperledger FabricåŒºå—é“¾çš„é€šé“ä¸­çš„ç»„ç»‡ä¹‹é—´è¡¨ç¤ºå’Œäº¤æ˜“èµ„äº§ï¼ŒåŒæ—¶ä¿æŒèµ„äº§å’Œäº¤æ˜“çš„ç§æœ‰æ€§ã€‚é“¾ä¸Šçš„æ¯ä¸ªèµ„äº§éƒ½æ˜¯ä¸€ä¸ªNFTï¼ˆnon-fungible tokenï¼Œä¸å¯æ›¿ä»£ä»¤ç‰Œï¼‰ï¼Œè¿™ä¸ªNFTä»£è¡¨å…·æœ‰å”¯ä¸€æ‹¥æœ‰è€…ã€å…·æœ‰æŸäº›ä¸å˜çš„å…ƒæ•°æ®å±æ€§ï¼ˆä¾‹å¦‚å¤§å°å’Œé¢œè‰²ï¼‰çš„ç‰¹å®šèµ„äº§ã€‚å½“æ‰€æœ‰è€…æƒ³è¦å‡ºå”®èµ„äº§æ—¶ï¼ŒåŒæ–¹éœ€è¦åœ¨è½¬è®©èµ„äº§ä¹‹å‰è¾¾æˆä¸€è‡´çš„ä»·æ ¼ã€‚ç§æœ‰èµ„äº§è½¬è®©æ™ºèƒ½åˆçº¦å¼ºåˆ¶è§„å®šåªæœ‰èµ„äº§æ‰€æœ‰è€…æ‰èƒ½è½¬è®©èµ„äº§ã€‚åœ¨æœ¬æ•™ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•æŠŠFabricçš„ç‰¹æ€§ï¼ˆå¦‚åŸºäºçŠ¶æ€çš„èƒŒä¹¦ã€ç§æœ‰æ•°æ®å’Œè®¿é—®æ§åˆ¶ï¼‰ç»„åˆåœ¨ä¸€èµ·ï¼Œä»¥æä¾›ç§æœ‰ä¸”å¯éªŒè¯çš„å®‰å…¨äº¤æ˜“ã€‚ This tutorial will deploy the secured asset transfer sample to demonstrate how to transfer a private asset between two organizations without publicly sharing data. You should have completed the task Install Samples, Binaries, and Docker Images. æœ¬æ•™ç¨‹ä¼šéƒ¨ç½² secured asset transfer sample æ¥æ¼”ç¤ºå¦‚ä½•åœ¨ä¸¤ä¸ªç»„ç»‡ä¹‹é—´è½¬ç§»ç§æœ‰èµ„äº§è€Œä¸å…¬å¼€å…±äº«æ•°æ®ã€‚ Scenario requirementsï¼ˆæ–¹æ¡ˆè¦æ±‚ï¼‰ The private asset transfer scenario is bound by the following requirements: An asset may be issued by the first ownerâ€™s organization (in the real world issuance may be restricted to some authority that certifies an assetâ€™s properties). Ownership is managed at the organization level (the Fabric permissioning scheme would equally support ownership at an individual identity level within an organization). The asset identifier and owner is stored as public channel data for all channel members to see. The asset metadata properties however are private information known only to the asset owner (and prior owners). An interested buyer will want to verify an assetâ€™s private properties. An interested buyer will want to verify an assetâ€™s provenance, specifically the assetâ€™s origin and chain of custody. They will also want to verify that the asset has not changed since issuance, and that all prior transfers have been legitimate. To transfer an asset, a buyer and seller must first agree on the sales price. Only the current owner may transfer their asset to another organization. The actual private asset transfer must verify that the legitimate asset is being transferred, and verify that the price has been agreed to. Both buyer and seller must endorse the transfer. ç§æœ‰èµ„äº§äº¤æ˜“æ–¹æ¡ˆå—ä»¥ä¸‹è¦æ±‚çº¦æŸï¼š ä¸€ä¸ªèµ„äº§å¯èƒ½ç”±ç¬¬ä¸€ä¸ªæ‹¥æœ‰è€…çš„ç»„ç»‡å‘è¡Œï¼ˆåœ¨ç°å®ä¸–ç•Œä¸­ï¼Œå¯èƒ½åªèƒ½ç”±æŸä¸ªæƒå¨çš„å¯ä»¥è¯æ˜èµ„äº§å±æ€§çš„ç»„ç»‡æ¥å‘è¡Œï¼‰ã€‚ æ‰€æœ‰æƒæ˜¯åœ¨ç»„ç»‡çº§åˆ«è¿›è¡Œç®¡ç†çš„ï¼ˆFabricè®¸å¯æ–¹æ¡ˆå°†åŒæ ·æ”¯æŒç»„ç»‡å†…ä¸ªäººèº«ä»½çº§åˆ«çš„æ‰€æœ‰æƒï¼‰ã€‚ èµ„äº§çš„IDå’Œæ‰€æœ‰äººä½œä¸ºå¯ä»¥è¢«channelä¸Šçš„æ‰€æœ‰æˆå‘˜å¯è§çš„å…¬å…±æ•°æ®è¢«å­˜å‚¨ã€‚ ä½†æ˜¯èµ„äº§çš„å…ƒæ•°æ®ä½œä¸ºç§æœ‰ä¿¡æ¯ï¼Œåªèƒ½è¢«èµ„äº§çš„æ‰€æœ‰è€…çœ‹åˆ°ï¼ˆä¹ŸåŒ…æ‹¬å‰æ‰€æœ‰è€…ï¼‰ã€‚ æœ‰å…´è¶£çš„ä¹°å®¶å°†å¸Œæœ›éªŒè¯èµ„äº§çš„ç§æœ‰å±æ€§ã€‚ æœ‰å…´è¶£çš„ä¹°å®¶å°†å¸Œæœ›éªŒè¯èµ„äº§çš„å‡ºå¤„ï¼Œç‰¹åˆ«æ˜¯èµ„äº§çš„æ¥æºå’Œäº§é”€ç›‘ç®¡é“¾ã€‚ä»–ä»¬è¿˜å¸Œæœ›éªŒè¯èµ„äº§è‡ªä»å‘è¡Œä¹‹åæ²¡æœ‰è¢«ç¯¡æ”¹è¿‡ï¼Œå¹¶ä¸”è¿™ä¸ªèµ„äº§çš„å‰é¢çš„æ‰€æœ‰äº¤æ˜“éƒ½æ˜¯åˆæ³•çš„ã€‚ åœ¨èµ„äº§äº¤æ˜“ä¹‹å‰ï¼Œä¹°å–åŒæ–¹å¿…é¡»å¯¹èµ„äº§çš„ä»·æ ¼è¾¾æˆä¸€è‡´ã€‚ åªæœ‰å½“å‰æ‹¥æœ‰è€…å¯ä»¥æŠŠä»–ä»¬çš„èµ„äº§è½¬è®©ç»™å¦ä¸€ä¸ªç»„ç»‡ã€‚ å®é™…çš„ç§æœ‰èµ„äº§äº¤æ˜“å¿…é¡»ç¡®è®¤åˆæ³•èµ„äº§æ­£åœ¨è½¬è®©ï¼Œå¹¶ç¡®è®¤åŒæ–¹å·²ç»å¯¹ä»·æ ¼è¾¾æˆä¸€è‡´ã€‚ä¹°å–åŒæ–¹éƒ½å¿…é¡»å¯¹äº¤æ˜“è¿›è¡ŒèƒŒä¹¦ã€‚ How privacy is maintainedï¼ˆå¦‚ä½•ä¿æŒéšç§æ€§ï¼‰ The smart contract uses the following techniques to ensure that the asset properties remain private: The asset metadata properties are stored in the current owning organizationâ€™s implicit private data collection on the organizationâ€™s peers only. Each organization on a Fabric channel has a private data collection that their own organization can use. This collection is implicit because it does not need to be explicitly defined in the chaincode. Although a hash of the private properties is automatically stored on-chain for all channel members to see, a random salt is included in the private properties so that other channel members cannot guess the private data pre-image through a dictionary attack. Smart contract requests utilize the transient field for private data so that private data does not get included in the final on-chain transaction. Private data queries must originate from a client whose org id matches the peerâ€™s org id, which must be the same as the asset ownerâ€™s org id. æ™ºèƒ½åˆçº¦ä½¿ç”¨ä»¥ä¸‹æŠ€æœ¯æ¥ç¡®ä¿èµ„äº§å±æ€§ä¿æŒéšç§ï¼š èµ„äº§å…ƒæ•°æ®å±æ€§ä»…å­˜å‚¨åœ¨å½“å‰æ‹¥æœ‰ç»„ç»‡çš„èŠ‚ç‚¹çš„éšå¼ç§æœ‰æ•°æ®é›†åˆä¸­ã€‚æ¯ä¸ªç»„ç»‡åœ¨Fabricé€šé“ä¸Šéƒ½æœ‰ä¸€ä¸ªåªèƒ½ç”±ç»„ç»‡è‡ªå·±å¯ä»¥ä½¿ç”¨çš„ç§æœ‰æ•°æ®é›†åˆã€‚è¯¥é›†åˆæ˜¯éšå¼çš„ï¼Œå› ä¸ºä¸éœ€è¦åœ¨é“¾ç ä¸­æ˜¾å¼å®šä¹‰å®ƒã€‚ è™½ç„¶ç§æœ‰å±æ€§çš„hashå€¼è¢«è‡ªåŠ¨ä¿å­˜åœ¨é“¾ä¸Šç„¶åé€šé“ä¸Šæ‰€æœ‰æˆå‘˜éƒ½å¯ä»¥çœ‹åˆ°ï¼Œä½†æ˜¯ç§æœ‰å±æ€§ä¸­åŒ…å«éšæœºç›ï¼Œå› æ­¤å…¶ä»–çš„é€šé“æˆå‘˜æ— æ³•é€šè¿‡å­—å…¸æ”»å‡»çŒœæµ‹ç§æœ‰æ•°æ®åŸåƒã€‚ æ™ºèƒ½åˆçº¦è¯·æ±‚å°†ç¬æ€å­—æ®µç”¨äºç§æœ‰æ•°æ®ï¼Œå› æ­¤ç§æœ‰æ•°æ®ä¸ä¼šåŒ…å«åœ¨æœ€ç»ˆçš„é“¾ä¸Šäº¤æ˜“ä¸­ã€‚ å¯¹ç§æœ‰æ•°æ®çš„æŸ¥è¯¢å¿…é¡»æ¥è‡ªç»„ç»‡IDä¸peerçš„ç»„ç»‡IDä¸€è‡´çš„å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”è¯¥å®¢æˆ·ç«¯çš„IDå¿…é¡»ä¸èµ„äº§æ‰€æœ‰è€…çš„ç»„ç»‡IDç›¸åŒã€‚ How the transfer is implementedï¼ˆäº¤æ˜“æ˜¯å¦‚ä½•å®æ–½çš„ï¼‰ Before we start using the private asset transfer smart contract we will provide an overview of the transaction flow and how Fabric features are used to protect the asset created on the blockchain: åœ¨æˆ‘ä»¬å¼€å§‹ä½¿ç”¨ç§æœ‰èµ„äº§äº¤æ˜“çš„æ™ºèƒ½åˆçº¦ä¹‹å‰ï¼Œæˆ‘ä»¬å°†æ¦‚è¿°äº¤æ˜“æµç¨‹ä»¥åŠå¦‚ä½•ä½¿ç”¨FabricåŠŸèƒ½æ¥ä¿æŠ¤åœ¨åŒºå—é“¾ä¸Šåˆ›å»ºçš„èµ„äº§ï¼š Creating the assetï¼ˆåˆ›å»ºèµ„äº§ï¼‰ The private asset transfer smart contract is deployed with an endorsement policy that requires an endorsement from any channel member. This allows any organization to create an asset that they own without requiring an endorsement from other channel members. The creation of the asset is the only transaction that uses the chaincode level endorsement policy. Transactions that update or transfer existing assets will be governed by state based endorsement policies or the endorsement policies of private data collections. Note that in other scenarios, you may want an issuing authority to also endorse create transactions. ç§æœ‰èµ„äº§äº¤æ˜“æ™ºèƒ½åˆçº¦åœ¨éƒ¨ç½²æ—¶æœ‰ä¸€ä¸ªèƒŒä¹¦ç­–ç•¥ï¼Œè¿™ä¸ªèƒŒä¹¦ç­–ç•¥æ˜¯ï¼šä¸éœ€è¦ä»»ä½•æ¸ é“æˆå‘˜çš„è®¤å¯ã€‚è¿™æ ·ä»»ä½•ç»„ç»‡éƒ½å¯ä»¥åˆ›å»ºå±äºä»–ä»¬è‡ªå·±çš„èµ„äº§ï¼Œè€Œä¸éœ€è¦å…¶ä»–çš„é€šé“æˆå‘˜æ‰¹å‡†ã€‚èµ„äº§çš„åˆ›å»ºæ˜¯å”¯ä¸€ä½¿ç”¨é“¾ç çº§èƒŒä¹¦ç­–ç•¥çš„äº¤æ˜“ã€‚æ›´æ–°æˆ–äº¤æ˜“ç°æœ‰èµ„äº§çš„äº¤æ˜“å°†å—åŸºäºçŠ¶æ€è®¤å¯æ”¿ç­–æˆ–ç§æœ‰æ•°æ®é›†åˆè®¤å¯æ”¿ç­–çš„çº¦æŸã€‚æ³¨æ„åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½æƒ³è¦ä¸€ä¸ªå‘è¡Œæœºæ„ä¹Ÿè®¤å¯åˆ›å»ºäº¤æ˜“ã€‚ The smart contract uses the following Fabric features to ensure that the asset can only be updated or transferred by the organization that owns the asset: When the asset is created, the smart contract gets the MSP ID of the organization that submitted the request, and stores the MSP ID as the owner in the asset key/value in the public chaincode world state. Subsequent smart contract requests to update or transfer the asset will use access control logic to verify that the requesting client is from the same organization. Note that in other scenarios, the ownership could be based on a specific client identity within an organization, rather than an organization itself. Also when the asset is created, the smart contract sets a state based endorsement policy for the asset key. The state based policy specifies that a peer from the organization that owns the asset must endorse a subsequent request to update or transfer the asset. This prevents any other organization from updating or transferring the asset using a smart contract that has been maliciously altered on their own peers. æ™ºèƒ½åˆçº¦ä½¿ç”¨ä»¥ä¸‹çš„FabricåŠŸèƒ½æ¥ç¡®ä¿èµ„äº§åªèƒ½ç”±æ‹¥æœ‰å®ƒçš„ç»„ç»‡è¿›è¡Œæ›´æ–°å’Œäº¤æ˜“ï¼š åœ¨èµ„äº§åˆ›å»ºåï¼Œæ™ºèƒ½åˆçº¦ä¼šè·å–æäº¤è¯·æ±‚çš„ç»„ç»‡çš„MSP ID ï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªMSP IDä½œä¸ºèµ„äº§çš„æ‹¥æœ‰è€…å­˜å‚¨åœ¨å…¬å…±é“¾ç ä¸–ç•ŒçŠ¶æ€çš„key/valueä¸­ã€‚åç»­çš„æ›´æ–°æˆ–äº¤æ˜“èµ„äº§çš„æ™ºèƒ½åˆçº¦è¯·æ±‚å°†ä¼šä½¿ç”¨è®¿é—®æ§åˆ¶é€»è¾‘æ¥éªŒè¯å‘å‡ºè¯·æ±‚çš„å®¢æˆ·ç«¯æ¥è‡ªåŒä¸€ä¸ªç»„ç»‡ã€‚è¯·æ³¨æ„åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æƒå¯ä»¥åŸºäºç»„ç»‡å†…çš„ç‰¹å®šå®¢æˆ·ç«¯èº«ä»½ï¼Œè€Œä¸æ˜¯ç»„ç»‡æœ¬èº«ã€‚ åŒæ ·ï¼Œåœ¨åˆ›å»ºèµ„äº§æ—¶ï¼Œæ™ºèƒ½åˆçº¦ä¼šä¸ºèµ„äº§å¯†é’¥è®¾ç½®åŸºäºçŠ¶æ€çš„èƒŒä¹¦ç­–ç•¥ã€‚åŸºäºçŠ¶æ€çš„ç­–ç•¥æŒ‡å®šæ‹¥æœ‰èµ„äº§çš„ç»„ç»‡ä¸­çš„peerèŠ‚ç‚¹å¿…é¡»è®¤å¯åç»­çš„æ›´æ–°æˆ–è½¬è®©èµ„äº§çš„è¯·æ±‚ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢ä»»ä½•å…¶ä»–ç»„ç»‡åˆ©ç”¨æ¶æ„æ›´æ”¹çš„æ™ºèƒ½åˆçº¦æ¥æ›´æ”¹å’Œäº¤æ˜“èµ„äº§ã€‚ Agreeing to the transferï¼ˆåŒæ„äº¤æ˜“ï¼‰ After a asset is created, channel members can use the smart contract to agree to transfer the asset: The owner of the asset can change the description in the public ownership record, for example to advertise that the asset is for sale. Smart contract access control enforces that this change needs to be submitted from a member of the asset owner organization. The state based endorsement policy enforces that this description change must be endorsed by a peer from the ownerâ€™s organization. åœ¨èµ„äº§åˆ›å»ºä¹‹åï¼Œé€šé“ä¸Šçš„æˆå‘˜å¯ä»¥ä½¿ç”¨æ™ºèƒ½åˆçº¦æ¥åŒæ„äº¤æ˜“èµ„äº§ï¼š èµ„äº§çš„æ‹¥æœ‰è€…å¯ä»¥æ›´æ”¹å…¬å…±è®°å½•ä¸Šçš„æè¿°ï¼Œä¾‹å¦‚å¹¿å‘Šè¯´è¿™ä¸ªèµ„äº§è¦å–å‡ºã€‚æ™ºèƒ½åˆçº¦è®¿é—®æ§åˆ¶å¼ºåˆ¶è¦æ±‚æ­¤æ›´æ”¹éœ€è¦ä»æ‹¥æœ‰æ­¤èµ„äº§çš„ç»„ç»‡çš„æˆå‘˜æäº¤ã€‚åŸºäºçŠ¶æ€çš„èƒŒä¹¦ç­–ç•¥è§„å®šï¼Œæ­¤æè¿°æ›´æ”¹å¿…é¡»å¾—åˆ°æ‹¥æœ‰èµ„äº§çš„ç»„ç»‡çš„æˆå‘˜ç¡®è®¤ã€‚ The asset owner and the asset buyer agree to transfer the asset for a certain price: The price agreed to by the buyer and the seller is stored in each organizationâ€™s implicit private data collection. The private data collection keeps the agreed price secret from other members of the channel. The endorsement policy of the private data collection ensures that the respective organizationâ€™s peer endorsed the price agreement, and the smart contract access control logic ensures that the price agreement was submitted by a client of the associated organization. A hash of each price agreement is stored on the ledger. The two hashes will match only if the two organizations have agreed to the same price. This allows the organizations to verify that they have come to agreement on the transfer details before the transfer takes place. A random trade id is added to the price agreement, which serves as a salt to ensure that other channel members can not use the hash on the ledger to guess the price. èµ„äº§æ‰€æœ‰è€…å’Œèµ„äº§è´­ä¹°è€…åŒæ„ä»¥ä¸€å®šä»·æ ¼äº¤æ˜“èµ„äº§ï¼š ä¹°å–åŒæ–¹éƒ½åŒæ„çš„ä»·æ ¼è¢«å­˜å‚¨åœ¨ä»–ä»¬å„è‡ªçš„éšå¼ç§æœ‰æ•°æ®é›†åˆä¸­ã€‚ç§æœ‰æ•°æ®é›†åˆä¿è¯æˆäº¤ä»·æ ¼å¯¹é€šé“ä¸Šçš„å…¶ä»–æˆå‘˜æ¥è¯´æ˜¯ç§å¯†çš„ã€‚ç§æœ‰æ•°æ®é›†åˆèƒŒä¹¦ç­–ç•¥ç¡®ä¿å„è‡ªç»„ç»‡çš„peerèŠ‚ç‚¹å¯¹ä»·æ ¼è¾¾æˆäº†ä¸€è‡´ï¼Œæ™ºèƒ½åˆçº¦è®¿é—®æ§åˆ¶é€»è¾‘ç¡®ä¿ä»·æ ¼åè®®æ˜¯ç”±ä¸ç»„ç»‡æœ‰å…³è”çš„å®¢æˆ·ç«¯æäº¤çš„ã€‚ äº¤æ˜“åŒæ–¹ç”Ÿæˆçš„ä»·æ ¼åè®®çš„hashå€¼è¢«å­˜å‚¨åœ¨äº†è´¦æœ¬ä¸Šã€‚åªæœ‰åœ¨ä¸¤ä¸ªç»„ç»‡åŒæ„åŒä¸€ä¸ªä»·æ ¼æ—¶ï¼Œè¿™ä¸¤ä¸ªhashå€¼æ‰ä¼šåŒ¹é…ã€‚è¿™ä½¿ç»„ç»‡èƒ½å¤Ÿåœ¨è½¬ç§»å‘ç”Ÿä¹‹å‰éªŒè¯ä»–ä»¬å·²å°±è½¬ç§»ç»†èŠ‚è¾¾æˆåè®®ã€‚ä»·æ ¼åè®®ä¸­æ·»åŠ äº†éšæœºäº¤æ˜“IDï¼Œè¿™æ˜¯ç¡®ä¿é€šé“å…¶ä»–æˆå‘˜ä¸èƒ½ä½¿ç”¨è´¦æœ¬ä¸Šçš„å“ˆå¸Œå€¼æ¥çŒœæµ‹ä»·æ ¼çš„ä¸€ç§ç›ã€‚ Transferring the assetï¼ˆäº¤æ˜“èµ„äº§ï¼‰ After the two organizations have agreed to the same price, the asset owner can use the transfer function to transfer the asset to the buyer: Smart contract access control ensures that the transfer must be initiated by a member of the organization that owns the asset. The transfer function verifies that the assetâ€™s private immutable properties passed to the transfer function matches the on chain hash of the asset data in private collection, to ensure that the asset owner is selling the same asset that they own. The transfer function uses the hash of the price agreement on the ledger to ensure that both organizations have agreed to the same price. If the transfer conditions are met, the transfer function adds the asset to the implicit private data collection of the buyer, and deletes the asset from the collection of the seller. The transfer also updates the owner in the public ownership record. Because of the endorsement policies of the seller and buyer implicit data collections, and the state based endorsement policy of the public record (requiring the seller to endorse), the transfer needs to be endorsed by peers from both buyer and seller. The state based endorsement policy of the public asset record is updated so that only a peer of the new owner of the asset can update or sell their new asset. The price agreements are also deleted from both the seller and buyer implicit private data collection, and a sales receipt is created in each private data collection. åœ¨ä¸¤ä¸ªç»„ç»‡å·²ç»å¯¹ç›¸åŒçš„ä»·æ ¼è¾¾æˆä¸€è‡´ä¹‹åï¼Œèµ„äº§çš„æ‹¥æœ‰è€…å¯ä»¥ä½¿ç”¨è½¬è®©æ–¹æ³•æ¥æŠŠèµ„äº§è½¬è®©ç»™ä¹°æ–¹ï¼š æ™ºèƒ½åˆçº¦è®¿é—®æ§åˆ¶ç¡®ä¿è½¬è´¦å¿…é¡»ç”±æ‹¥æœ‰èµ„äº§çš„ç»„ç»‡çš„æˆå‘˜æ¥å‘èµ· è½¬è´¦æ–¹æ³•éªŒè¯ä¼ é€’ç»™å®ƒçš„èµ„äº§çš„ç§æœ‰ä¸å¯å˜å±æ€§æ˜¯å¦ä¸ç§æœ‰é›†åˆä¸­èµ„äº§æ•°æ®çš„é“¾ä¸Šå“ˆå¸ŒåŒ¹é…ï¼Œç¡®ä¿èµ„äº§æ‰€æœ‰è€…åœ¨å‡ºå”®ä»–ä»¬æ‹¥æœ‰çš„ç›¸åŒçš„èµ„äº§ã€‚ è½¬è´¦æ–¹æ³•ä½¿ç”¨è´¦æœ¬ä¸Šçš„ä»·æ ¼åè®®çš„hashå€¼æ¥ç¡®ä¿ä¸¤ä¸ªç»„ç»‡å·²ç»åŒæ„äº†ç›¸åŒçš„ä»·æ ¼ã€‚ å¦‚æœæ»¡è¶³è½¬è®©æ¡ä»¶ï¼Œåˆ™è½¬è´¦å‡½æ•°ä¼šå°†èµ„äº§æ·»åŠ åˆ°ä¹°æ–¹çš„éšå¼ç§æœ‰æ•°æ®é›†åˆä¸­ï¼Œå¹¶ä¸”ä»å–æ–¹çš„é›†åˆä¸­åˆ é™¤è¿™ä¸ªèµ„äº§ã€‚è½¬è®©è¿˜ä¼šæ›´æ–°å…¬å…±æ‰€æœ‰æƒè®°å½•ä¸­çš„èµ„äº§çš„æ‰€æœ‰è€…ã€‚ å› ä¸ºä¹°å–åŒæ–¹éšå¼æ•°æ®é›†åˆçš„èƒŒä¹¦ç­–ç•¥å’Œå…¬å…±æ•°æ®çš„åŸºäºçŠ¶æ€çš„èƒŒä¹¦ç­–ç•¥ï¼ˆè¦æ±‚å–æ–¹ç¡®è®¤ï¼‰ï¼Œæ‰€ä»¥äº¤æ˜“éœ€è¦å¾—åˆ°ä¹°å–åŒæ–¹èŠ‚ç‚¹çš„è®¤å¯ã€‚ å…¬å…±èµ„äº§è®°å½•çš„åŸºäºçŠ¶æ€çš„èƒŒä¹¦ç­–ç•¥éœ€è¦æ›´æ–°ï¼Œè¿™æ ·åªæœ‰æ–°çš„æ‰€æœ‰è€…çš„peerèŠ‚ç‚¹æ‰èƒ½å¤Ÿæ›´æ–°å’Œå‡ºå”®ä»–ä»¬çš„æ–°èµ„äº§ã€‚ ä»·æ ¼åè®®ä¹Ÿä»ä¹°å–åŒæ–¹éšå¼ç§äººæ•°æ®é›†åˆä¸­åˆ é™¤ï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªç§äººæ•°æ®é›†åˆä¸­åˆ›å»ºé”€å”®æ”¶æ®ã€‚ Running the private asset transfer smart contractï¼ˆè¿è¡Œç§æœ‰èµ„äº§è½¬è´¦æ™ºèƒ½åˆçº¦ï¼‰ You can use the Fabric test network to run the private asset transfer smart contract. The test network contains two peer organizations, Org1 and Org1, that operate one peer each. In this tutorial, we will deploy the smart contract to a channel of the test network joined by both organizations. We will first create an asset that is owned by Org1. After the two organizations agree on the price, we will transfer the asset from Org1 to Org2. æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Fabricçš„testç½‘ç»œæ¥è¿è¡Œç§æœ‰èµ„äº§è½¬è´¦æ™ºèƒ½åˆçº¦ã€‚ï¼ˆçœç•¥ã€‚ã€‚ã€‚ï¼‰æˆ‘ä»¬å…ˆé€šè¿‡Org1ç»„ç»‡åˆ›å»ºä¸€ä¸ªèµ„äº§ï¼Œåœ¨ä¸¤ä¸ªç»„ç»‡å¯¹ä»·æ ¼è¾¾æˆä¸€è‡´ä¹‹åï¼Œæˆ‘ä»¬æŠŠèµ„äº§ç”±Org1ç»„ç»‡äº¤æ˜“åˆ°Org2ç»„ç»‡ã€‚ Deploy the test networkï¼ˆéƒ¨ç½²æµ‹è¯•ç½‘ç»œï¼‰ è¯·å‚è€ƒï¼šFabricæµ‹è¯•ç½‘ç»œä½¿ç”¨ Deploy the smart contract(éƒ¨ç½²æ™ºèƒ½åˆçº¦) You can use the test network script to deploy the secured asset transfer smart contract to the channel. Run the following command to deploy the smart contract to mychannel: ä½ å¯ä»¥ä½¿ç”¨æµ‹è¯•ç½‘ç»œè„šæœ¬æ¥éƒ¨ç½²å®‰å…¨èµ„äº§äº¤æ˜“æ™ºèƒ½åˆçº¦åˆ°é€šé“ä¸Šã€‚è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥éƒ¨ç½²æ™ºèƒ½åˆçº¦åˆ°mychannelï¼š 1.&#x2F;network.sh deployCC -ccn secured -ccp ..&#x2F;asset-transfer-secured-agreement&#x2F;chaincode-go&#x2F; -ccl go -ccep &quot;OR(&#39;Org1MSP.peer&#39;,&#39;Org2MSP.peer&#39;)&quot; Note that we are using the -ccep flag to deploy the smart contract with an endorsement policy of &quot;OR('Org1MSP.peer','Org2MSP.peer')&quot;. This allows either organization to create an asset without receiving an endorsement from the other organization. æ³¨æ„æˆ‘ä»¬ä½¿ç”¨-ccepæ ‡å¿—æ¥éƒ¨ç½²æ™ºèƒ½åˆçº¦ï¼Œè¿™ä¸ªæ™ºèƒ½åˆçº¦æœ‰ä¸€ä¸ªèƒŒä¹¦ç­–ç•¥&quot;OR('Org1MSP.peer','Org2MSP.peer')&quot;ã€‚è€…å…è®¸ä»»æ„ä¸€ä¸ªç»„ç»‡åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„äº§æ—¶ä¸éœ€è¦å…¶ä»–ç»„ç»‡çš„ç¡®è®¤ã€‚ Set the environment variables to operate as Org2ï¼ˆè®¾ç½®ç¯å¢ƒå˜é‡ä»¥Org2çš„ç®¡ç†å‘˜èº«ä»½æ“ä½œï¼‰ ç•¥ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªç»ˆç«¯åˆ†åˆ«ä»¥Org1å’ŒOrg2ç»„ç»‡ç®¡ç†å‘˜çš„èº«ä»½æ“ä½œpeerã€‚ç¯å¢ƒå˜é‡è®¾ç½®å‚è€ƒï¼š[Fabricæµ‹è¯•ç½‘ç»œä½¿ç”¨](https://guozhe001.github.io/2021/04/01/blockchain/fabric/Fabricæµ‹è¯•ç½‘ç»œä½¿ç”¨/ [) Create an assetï¼ˆåˆ›å»ºä¸€ä¸ªèµ„äº§ï¼‰ Any channel member can use the smart contract to create an asset that is owned by their organization. The details of the asset will be stored in a private data collection, and can only accessed by the organization that owns the asset. A public record of the asset, its owner, and a public description is stored on the channel ledger. Any channel member can access the public ownership record to see who owns the asset, and can read the description to see if the asset is for sale. ä»»ä½•ä¸€ä¸ªé€šé“æˆå‘˜éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ™ºèƒ½åˆçº¦æ¥åˆ›å»ºä¸€ä¸ªå±äºç»„ç»‡è‡ªå·±çš„èµ„äº§ã€‚èµ„äº§çš„è¯¦æƒ…ä¼šå­˜å‚¨åœ¨ç§æœ‰æ•°æ®é›†åˆä¸­ï¼Œå¹¶ä¸”åªèƒ½ç”±æ‹¥æœ‰èµ„äº§çš„ç»„ç»‡è®¿é—®ã€‚èµ„äº§ï¼Œå…¶æ‰€æœ‰è€…å’Œå…¬å…±æè¿°çš„å…¬å…±è®°å½•å­˜å‚¨åœ¨é€šé“è´¦æœ¬ä¸­ã€‚ä»»ä½•é€šé“æˆå‘˜éƒ½å¯ä»¥è®¿é—®å…¬å…±è®°å½•æ¥æŸ¥çœ‹è°æ‹¥æœ‰è¿™ä¸ªèµ„äº§ï¼Œå¹¶ä¸”å¯ä»¥æŸ¥çœ‹æè¿°æ¥åˆ¤æ–­èµ„äº§æ˜¯å¦åœ¨å‡ºå”®ã€‚ Operate from the Org1 terminalï¼ˆé€šè¿‡Org1çš„ç»ˆç«¯æ“ä½œï¼‰ Before we create the asset, we need to specify the details of what our asset will be. Issue the following command to create a JSON that will describe the asset. The &quot;salt&quot; parameter is a random string that would prevent another member of the channel from guessing the asset using the hash on the ledger. If there was no salt, a user could theoretically guess asset parameters until the hash of the of the guess and the hash on the ledger matched (this is known as a dictionary attack). This string is encoded in Base64 format so that it can be passed to the creation transaction as transient data. åœ¨åˆ›å»ºèµ„äº§ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šèµ„äº§çš„è¯¦ç»†ä¿¡æ¯ã€‚é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªJSONæ¥æè¿°èµ„äº§ã€‚&quot;salt&quot;å‚æ•°æ˜¯ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²æ¥é˜²æ­¢é€šé“ä¸Šçš„å¦ä¸€ä¸ªæˆå‘˜é€šè¿‡è´¦æœ¬ä¸Šçš„hashå€¼æ¥çŒœæµ‹è¿™ä¸ªèµ„äº§ã€‚å¦‚æœæ²¡æœ‰ç›ï¼Œç†è®ºä¸Šç”¨æˆ·å¯ä»¥çŒœæµ‹èµ„äº§å‚æ•°ï¼Œç›´åˆ°çŒœæµ‹çš„å“ˆå¸Œå€¼å’Œè´¦æœ¬çš„å“ˆå¸Œå€¼åŒ¹é…ï¼ˆè¿™ç§°ä¸ºå­—å…¸æ”»å‡»ï¼‰ä¸ºæ­¢ã€‚è¯¥å­—ç¬¦ä¸²ä»¥Base64æ ¼å¼ç¼–ç ï¼Œå› æ­¤å¯ä»¥ä½œä¸ºä¸´æ—¶æ•°æ®ä¼ é€’ç»™åˆ›å»ºäº¤æ˜“ã€‚ 1export ASSET_PROPERTIES=$(echo -n &quot;&#123;\\&quot;object_type\\&quot;:\\&quot;asset_properties\\&quot;,\\&quot;asset_id\\&quot;:\\&quot;asset1\\&quot;,\\&quot;color\\&quot;:\\&quot;blue\\&quot;,\\&quot;size\\&quot;:35,\\&quot;salt\\&quot;:\\&quot;a94a8fe5ccb19ba61c4c0873d391e987982fbbd3\\&quot;&#125;&quot; | base64 | tr -d \\\\n) We can now use the following command to create a asset that belongs to Org1: æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªå±äºOrg1ç»„ç»‡çš„èµ„äº§ï¼š 1peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;CreateAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;, &quot;A new asset for Org1MSP&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_properties\\&quot;:\\&quot;$ASSET_PROPERTIES\\&quot;&#125;&quot; We can can query the Org1 implicit data collection to see the asset that was created: æˆ‘ä»¬å¯ä»¥æŸ¥è¯¢Org1ç»„ç»‡çš„éšç§æ•°æ®é›†åˆæ¥æŸ¥çœ‹åˆ›å»ºçš„èµ„äº§ï¼š 1peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; When successful, the command will return the following result: å¦‚æœæˆåŠŸï¼Œå‘½ä»¤ä¼šè¿”å›ä¸‹é¢çš„ç»“æœï¼š 1234567&#123; &quot;object_type&quot;: &quot;asset_properties&quot;, &quot;asset_id&quot;: &quot;asset1&quot;, &quot;color&quot;: &quot;blue&quot;, &quot;size&quot;: 35, &quot;salt&quot;: &quot;a94a8fe5ccb19ba61c4c0873d391e987982fbbd3&quot;&#125; We can also query the ledger to see the public ownership record: æˆ‘ä»¬è¿˜å¯ä»¥æŸ¥è¯¢è´¦æœ¬æ¥æŸ¥çœ‹å…¬å…±è®°å½•ï¼š 1peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; The command will return the record that the asset1 is owned by Org1: è¿™ä¸ªå‘½ä»¤ä¼šè¿”å›æ•°æ®è¯´æ˜èµ„äº§asset1å±äºOrg1ï¼š 123456&#123; &quot;objectType&quot;: &quot;asset&quot;, &quot;assetID&quot;: &quot;asset1&quot;, &quot;ownerOrg&quot;: &quot;Org1MSP&quot;, &quot;publicDescription&quot;: &quot;A new asset for Org1MSP&quot;&#125; Because the market for assets is hot, Org1 wants to flip this asset and put it up for sale. As the asset owner, Org1 can update the public description to advertise that the asset is for sale. Run the following command to change the asset description: å› ä¸ºèµ„äº§å¸‚åœºå¾ˆçƒ­ï¼Œæ‰€ä»¥Org1å¸Œæœ›ç¿»è½¬è¯¥èµ„äº§å¹¶å°†å…¶å‡ºå”®ã€‚ä½œä¸ºèµ„äº§çš„æ‹¥æœ‰è€…ï¼ŒOrg1ç»„ç»‡å¯ä»¥æ›´æ–°å…¬å…±æè¿°æ¥å¹¿å‘Šè¯´èµ„äº§åœ¨å‡ºå”®ã€‚è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æ›´æ–°èµ„äº§æè¿°ï¼š 1peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset1&quot;,&quot;This asset is for sale&quot;]&#125;&#x27; Query the ledger again to see the updated description: é‡æ–°æŸ¥è¯¢è´¦æœ¬æ¥æŸ¥çœ‹æ›´æ–°åçš„æè¿°ï¼š 1peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; We can now see that the asset is for sale: æˆ‘ä»¬ç°åœ¨å¯ä»¥çœ‹åˆ°è¿™ä¸ªèµ„äº§åœ¨å‡ºå”®ï¼š 123456&#123; &quot;objectType&quot;: &quot;asset&quot;, &quot;assetID&quot;: &quot;asset1&quot;, &quot;ownerOrg&quot;: &quot;Org1MSP&quot;, &quot;publicDescription&quot;: &quot;This asset is for sale&quot;&#125; Figure 1: When Org1 creates an asset that they own, the asset details are stored in the Org1 implicit data collection on the Org1 peer. The public ownership record is stored in the channel world state, and is stored on both the Org1 and Org2 peers. A hash of the asset key and a hash the asset details are also visible in the channel world state and are stored on the peers of both organizations. å›¾ç‰‡1:å½“ç»„ç»‡Org1åˆ›å»ºäº†ä¸€ä¸ªå±äºä»–ä»¬çš„èµ„äº§æ—¶ï¼Œèµ„äº§çš„ç»†èŠ‚ä¿å­˜åœ¨å±äºç»„ç»‡Org1çš„peerçš„éšå¼æ•°æ®é›†åˆä¸­ã€‚å…¬å…±çš„è®°å½•è¢«ä¿å­˜åœ¨é€šé“çš„ä¸–ç•ŒçŠ¶æ€ï¼Œå¹¶ä¸”ä¿å­˜åœ¨ç»„ç»‡Org1å’ŒOrg2çš„peerèŠ‚ç‚¹ã€‚èµ„äº§çš„keyçš„hashå’Œèµ„äº§è¯¦æƒ…çš„hashåœ¨é€šé“çš„ä¸–ç•ŒçŠ¶æ€æ˜¯å¯è®¿é—®çš„ï¼Œå¹¶ä¸”å­˜å‚¨åœ¨æ‰€æœ‰ç»„ç»‡çš„peerèŠ‚ç‚¹ã€‚ Operate from the Org2 terminalï¼ˆé€šè¿‡ç»„ç»‡Org2çš„ç»ˆç«¯æ“ä½œï¼‰ If we operate from the Org2 terminal, we can use the smart contract query the public asset data: å¦‚æœæˆ‘ä»¬é€šè¿‡ç»„ç»‡Org2çš„ç»ˆç«¯æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ™ºèƒ½åˆçº¦æ¥æŸ¥è¯¢å…¬å…±çš„èµ„äº§æ•°æ®ï¼š 1peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; From this query, Org2 learns that asset1 is for saleï¼ˆé€šè¿‡è¿™ä¸ªæŸ¥è¯¢ï¼Œç»„ç»‡Org2çŸ¥é“äº†èµ„äº§asset1æ­£åœ¨å‡ºå”®ï¼‰: 123456&#123; &quot;objectType&quot;: &quot;asset&quot;, &quot;assetID&quot;: &quot;asset1&quot;, &quot;ownerOrg&quot;: &quot;Org1MSP&quot;, &quot;publicDescription&quot;: &quot;This asset is for sale&quot;&#125; In a real chaincode you may want to query for all assets for sale, by using a JSON query, or by creating a different sale key and using a key range query to find the assets currently for sale. Any changes to the public description of the asset owned by Org1 needs to be endorsed by Org1. The endorsement policy is reinforced by an access control policy within the chaincode that any update needs to be submitted by the organization that owns the asset. Lets see what happens if Org2 tried to change the public description as a prank: *åœ¨çœŸå®çš„é“¾ç ä¸­ï¼Œæ‚¨å¯èƒ½å¸Œæœ›é€šè¿‡ä½¿ç”¨JSONæŸ¥è¯¢æˆ–é€šè¿‡åˆ›å»ºå…¶ä»–é”€å”®å¯†é’¥å¹¶ä½¿ç”¨å¯†é’¥çš„èŒƒå›´æ¥æŸ¥æ‰¾å½“å‰å¾…å”®èµ„äº§ï¼Œä»¥æŸ¥è¯¢æ‰€æœ‰å¾…å”®èµ„äº§ã€‚*æ‰€æœ‰å±äºç»„ç»‡Org1çš„èµ„äº§çš„å…¬å…±æè¿°åœ¨è¿›è¡Œä»»ä½•æ›´æ”¹æ—¶éƒ½å¿…é¡»å¾—åˆ°ç»„ç»‡Org1çš„è®¤å¯ã€‚é“¾ç ä¸­çš„è®¿é—®æ§åˆ¶ç­–ç•¥åŠ å¼ºäº†èƒŒä¹¦ç­–ç•¥ï¼Œä»»ä½•æ›´æ–°éƒ½å¿…é¡»ç”±æ¥è‡ªäºèµ„äº§æ‹¥æœ‰è€…çš„ç»„ç»‡æ¥æäº¤ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚æœOrg2è¯•å›¾ä»¥æ¶ä½œå‰§æ–¹å¼æ›´æ”¹å…¬å…±æè¿°ä¼šå‘ç”Ÿä»€ä¹ˆï¼š 1peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset1&quot;,&quot;the worst asset&quot;]&#125;&#x27; The smart contract does not allow Org2 to access the public description of the asset. æ™ºèƒ½åˆçº¦ä¸å…è®¸ç»„ç»‡Org2è®¿é—®è¿™ä¸ªèµ„äº§çš„å…¬å…±æè¿°ã€‚ 1Error: endorsement failure during invoke. response: status:500 message:&quot;a client from Org2MSP cannot update the description of a asset owned by Org1MSP&quot; Agree to sell the asset(å…è®¸å‡ºå”®èµ„äº§) To sell an asset, both the buyer and the seller must agree on an asset price. Each party stores the price that they agree to in their own private data collection. The private asset transfer smart contract enforces that both parties need to agree to the same price before the asset can be transferred. ä¸ºäº†å‡ºå”®èµ„äº§ã€‚ä¹°å–åŒæ–¹éƒ½å¿…é¡»åŒæ„ç›¸åŒçš„èµ„äº§ä»·æ ¼ã€‚æ¯ä¸€æ–¹éƒ½éœ€è¦åœ¨ä»–ä»¬çš„ç§æœ‰æ•°æ®é›†åˆä¸­ä¿å­˜ä»–ä»¬åŒæ„çš„ä»·æ ¼ã€‚ç§æœ‰èµ„äº§äº¤æ˜“æ™ºèƒ½åˆçº¦å¼ºåˆ¶åŒæ–¹å¿…é¡»åŒæ„ç›¸åŒçš„ä»·æ ¼æ‰èƒ½è½¬è®©èµ„äº§ã€‚ Agree to sell as Org1ï¼ˆä»¥Org1çš„èº«ä»½åŒæ„å‡ºå”®ï¼‰ Operate from the Org1 terminal. Org1 will agree to set the asset price as 110 dollars. The trade_id is used as salt to prevent a channel member that is not a buyer or a seller from guessing the price. This value needs to be passed out of band, through email or other communication, between the buyer and the seller. The buyer and the seller can also add salt to the asset key to prevent other members of the channel from guessing which asset is for sale. é€šè¿‡ç»„ç»‡Org1çš„ç»ˆç«¯è¿›è¡Œæ“ä½œã€‚Org1åŒæ„å°†èµ„äº§ä»·æ ¼è®¾ç½®ä¸º110ç¾å…ƒã€‚trade_idç”¨ä½œç›ä»¥é˜²æ­¢ä¸æ˜¯ä¹°å®¶æˆ–å–å®¶çš„é€šé“æˆå‘˜çŒœæµ‹ä»·æ ¼ã€‚è¿™ä¸ªä»·æ ¼éœ€è¦é€šè¿‡ä¹°å–åŒæ–¹ä¹‹é—´ä»¥ç”µå­é‚®ä»¶æˆ–å…¶ä»–é€šä¿¡æ–¹å¼åœ¨è´¦æœ¬å¤–ä¼ é€’ã€‚ä¹°å–åŒæ–¹è¿˜å¯ä»¥å¯¹èµ„äº§çš„keyè¿›è¡Œâ€œåŠ ç›â€ï¼Œä»¥é˜²æ­¢æ¸ é“çš„å…¶ä»–æˆå‘˜çŒœæµ‹è¦å‡ºå”®çš„èµ„äº§ã€‚ 12export ASSET_PRICE=$(echo -n &quot;&#123;\\&quot;asset_id\\&quot;:\\&quot;asset1\\&quot;,\\&quot;trade_id\\&quot;:\\&quot;109f4b3c50d7b0df729d299bc6f8e9ef9066971f\\&quot;,\\&quot;price\\&quot;:110&#125;&quot; | base64)peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToSell&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_price\\&quot;:\\&quot;$ASSET_PRICE\\&quot;&#125;&quot; We can query the Org1 private data collection to read the agreed to selling price: æˆ‘ä»¬å¯ä»¥æŸ¥è¯¢ç»„ç»‡Org1çš„ç§æœ‰æ•°æ®é›†åˆæ¥è¯»å–åŒæ„çš„é”€å”®ä»·æ ¼ï¼š 1peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetSalesPrice&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; Agree to buy as Org2(ä»¥Org2çš„èº«ä»½åŒæ„è´­ä¹°) Operate from the Org2 terminal. Run the following command to verify the asset properties before agreeing to buy. The asset properties and salt would be passed out of band, through email or other communication, between the buyer and seller. é€šè¿‡Org2çš„ç»ˆç«¯æ“ä½œã€‚è¿è¡Œä¸‹é¢çš„å‘½ä»¤åœ¨åŒæ„è´­ä¹°ä¹‹å‰éªŒè¯èµ„äº§çš„å±æ€§ã€‚èµ„äº§çš„å±æ€§å’Œç›ä¼šåœ¨åŒºå—é“¾è´¦æœ¬å¤–åœ¨ä¹°å–åŒæ–¹ä¹‹é—´é€šè¿‡é‚®ä»¶æˆ–è€…å…¶ä»–æ–¹å¼è¿›è¡Œä¼ é€’ã€‚ 12export ASSET_PROPERTIES=$(echo -n &quot;&#123;\\&quot;object_type\\&quot;:\\&quot;asset_properties\\&quot;,\\&quot;asset_id\\&quot;:\\&quot;asset1\\&quot;,\\&quot;color\\&quot;:\\&quot;blue\\&quot;,\\&quot;size\\&quot;:35,\\&quot;salt\\&quot;:\\&quot;a94a8fe5ccb19ba61c4c0873d391e987982fbbd3\\&quot;&#125;&quot; | base64)peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;VerifyAssetProperties&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_properties\\&quot;:\\&quot;$ASSET_PROPERTIES\\&quot;&#125;&quot; Run the following command to agree to buy asset1 for 100 dollars. As of now, Org2 will agree to a different price than Org2. Donâ€™t worry, the two organizations will agree to the same price in a future step. However, we we can use this temporary disagreement as a test of what happens if the buyer and the seller agree to a different price. Org2 needs to use the same trade_id as Org1. ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥åŒæ„ä»¥100åˆ€çš„ä»·æ ¼è´­ä¹°asset1ã€‚ç°åœ¨Org2åŒæ„äº†ä¸€ä¸ªä¸Org1ä¸åŒçš„ä»·æ ¼ã€‚ä¸è¦æ‹…å¿ƒï¼Œè¿™ä¸¤ä¸ªç»„ç»‡ä¼šåœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤åŒæ„ç›¸åŒçš„ä»·æ ¼ã€‚ä½†æ˜¯æˆ‘ä»¬é€šè¿‡ä¸´æ—¶çš„åˆ†æ­§æ¥æµ‹è¯•å¦‚æœä¹°æ–¹å’Œå–æ–¹åŒæ„äº†ä¸åŒçš„ä»·æ ¼å°†ä¼šå‘ç”Ÿä»€ä¹ˆã€‚Org2éœ€è¦ä½¿ç”¨ä¸Org1ç›¸åŒçš„ trade_id ã€‚ 12export ASSET_PRICE=$(echo -n &quot;&#123;\\&quot;asset_id\\&quot;:\\&quot;asset1\\&quot;,\\&quot;trade_id\\&quot;:\\&quot;109f4b3c50d7b0df729d299bc6f8e9ef9066971f\\&quot;,\\&quot;price\\&quot;:100&#125;&quot; | base64)peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToBuy&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_price\\&quot;:\\&quot;$ASSET_PRICE\\&quot;&#125;&quot; You can read the agreed purchase price from the Org2 implicit data collection: æ‚¨å¯ä»¥ä»Org2éšå¼æ•°æ®é›†åˆä¸­è¯»å–çº¦å®šçš„è´­ä¹°ä»·æ ¼ï¼š 1peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetBidPrice&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; Figure 2: After Org1 and Org2 agree to transfer the asset, the price agreed to by each organization is stored in their private data collections. A composite key for the seller and the buyer is used to prevent a collision with the asset details and asset ownership record. The price that is agreed to is only stored on the peers of each organization. However, the hash of both agreements is stored in the channel world state on every peer joined to the channel. å›¾2:åœ¨Org1å’ŒOrg2åŒæ„äº¤æ˜“è¿™ä¸ªèµ„äº§ï¼Œæ¯ä¸ªç»„ç»‡çš„åŒæ„çš„ä»·æ ¼è¢«å­˜å‚¨åœ¨ä»–ä»¬çš„ç§æœ‰æ•°æ®é›†åˆä¸­ã€‚ä¹°å–åŒæ–¹çš„ç»„åˆé”®ç”¨äºé˜²æ­¢ä¸èµ„äº§è¯¦ç»†ä¿¡æ¯å’Œèµ„äº§æ‰€æœ‰æƒè®°å½•å‘ç”Ÿå†²çªã€‚å·²ç»åŒæ„çš„ä»·æ ¼åªæ˜¯å­˜å‚¨åœ¨åŒæ–¹ç»„ç»‡çš„peerèŠ‚ç‚¹ã€‚ä½†æ˜¯ä¸¤ä¸ªåè®®çš„hashå€¼è¢«å­˜å‚¨åœ¨åŠ å…¥é€šé“çš„æ‰€æœ‰peerèŠ‚ç‚¹çš„é€šé“çš„ä¸–ç•ŒçŠ¶æ€ä¸­ã€‚ Transfer the asset from Org1 to Org2ï¼ˆæŠŠèµ„äº§ä»Org1äº¤æ˜“åˆ°Org2ï¼‰ After both organizations have agreed to their price, Org1 can attempt to transfer the asset to Org2. The private asset transfer function in the smart contract uses the hash on the ledger to check that both organizations have agreed to the same price. The function will also use the hash of the private asset details to check that the asset that is transferred is the same asset that Org1 owns. åœ¨åŒæ–¹ç»„ç»‡éƒ½åŒæ„äº†ä»–ä»¬çš„ä»·æ ¼ä¹‹åï¼ŒOrg1å¯ä»¥å°è¯•å°†èµ„äº§äº¤æ˜“ç»™Org2ã€‚åœ¨æ™ºèƒ½åˆçº¦ä¸­çš„ç§æœ‰èµ„äº§äº¤æ˜“æ–¹æ³•ä½¿ç”¨è´¦æœ¬ä¸Šçš„hashæ¥æ£€æŸ¥ä¸¤ä¸ªç»„ç»‡æ˜¯å¦åŒæ„äº†ç›¸åŒçš„ä»·æ ¼ã€‚è¿™ä¸ªæ–¹æ³•ä¹Ÿä¼šä½¿ç”¨ç§æœ‰èµ„äº§è¯¦æƒ…çš„hashå€¼æ¥æ£€æŸ¥è¢«äº¤æ˜“çš„èµ„äº§ä¸å±äºOrg1çš„èµ„äº§æ˜¯åŒä¸€ç¬”èµ„äº§ã€‚ Transfer the asset as Org1ï¼ˆä»¥Org1çš„èº«ä»½äº¤æ˜“èµ„äº§ï¼‰ Operate from the Org1 terminal. The owner of the asset needs to initiate the transfer. Note that the command below uses the --peerAddresses flag to target the peers of both Org1 and Org2. Both organizations need to endorse the transfer. Also note that the asset properties and price are passed in the transfer request as transient properties. These are passed so that the current owner can be sure that the correct asset is transferred for the correct price. These properties will be checked against the on-chain hashes by both endorsers. é€šè¿‡Org1çš„ç»ˆç«¯æ“ä½œã€‚èµ„äº§çš„æ‰€æœ‰è€…éœ€è¦å‘èµ·è¿™ä¸ªäº¤æ˜“ã€‚æ³¨æ„ä¸‹é¢çš„å‘½ä»¤ä½¿ç”¨--peerAddresses æ ‡å¿—æ¥æŒ‡å®šOrg1å’ŒOrg2çš„peerèŠ‚ç‚¹ã€‚ä¸¤ä¸ªç»„ç»‡éƒ½éœ€è¦ç¡®è®¤è¿™ä¸ªäº¤æ˜“ã€‚å¦å¤–è¯·æ³¨æ„ï¼Œèµ„äº§å±æ€§å’Œä»·æ ¼åœ¨äº¤æ˜“è¯·æ±‚ä¸­ä½œä¸ºä¸´æ—¶å±æ€§ä¼ é€’ã€‚ä¼ é€’è¿™äº›æ˜¯ä¸ºäº†å½“å‰çš„æ‹¥æœ‰è€…å¯ä»¥ç¡®ä¿ä»¥å½“å‰çš„ä»·æ ¼æ¥è½¬è®©å½“å‰çš„èµ„äº§ã€‚ä¸¤ä¸ªèƒŒä¹¦è€…å°†å¯¹ç…§é“¾ä¸Šå“ˆå¸Œæ£€æŸ¥è¿™äº›å±æ€§ã€‚ 1peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;TransferAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;,&quot;Org2MSP&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_properties\\&quot;:\\&quot;$ASSET_PROPERTIES\\&quot;,\\&quot;asset_price\\&quot;:\\&quot;$ASSET_PRICE\\&quot;&#125;&quot; --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt Because the two organizations have not agreed to the same price, the transfer cannot be completed: å› ä¸ºä¸¤ä¸ªç»„ç»‡åŒæ„çš„ä»·æ ¼ä¸ä¸€è‡´ï¼Œè¿™ä¸ªäº¤æ˜“ä¸èƒ½å®Œæˆï¼š 1Error: endorsement failure during invoke. response: status:500 message:&quot;failed transfer verification: hash 0fc413250501855af7c9896af00993b973510995fb10d56cddbb85ca47bd5dba for passed price JSON &#123;\\&quot;asset_id\\&quot;:\\&quot;asset1\\&quot;,\\&quot;trade_id\\&quot;:\\&quot;109f4b3c50d7b0df729d299bc6f8e9ef9066971f\\&quot;,\\&quot;price\\&quot;:110&#125; does not match on-chain hash 84b0d57eaa5c77076483ae8f482c96a64912c47df5541451e94fb7698bf37ee9, buyer hasn&#x27;t agreed to the passed trade id and price&quot; As a result, Org1 and Org2 come to a new agreement on the price at which the asset will be purchased. Org1 drops the price of the asset to 100: ç»“æœï¼ŒOrg1å’ŒOrg2å°±è´­ä¹°èµ„äº§çš„ä»·æ ¼è¾¾æˆäº†æ–°åè®®ã€‚ Org1å°†èµ„äº§ä»·æ ¼é™è‡³100ï¼š 12export ASSET_PRICE=$(echo -n &quot;&#123;\\&quot;asset_id\\&quot;:\\&quot;asset1\\&quot;,\\&quot;trade_id\\&quot;:\\&quot;109f4b3c50d7b0df729d299bc6f8e9ef9066971f\\&quot;,\\&quot;price\\&quot;:100&#125;&quot; | base64)peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;AgreeToSell&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_price\\&quot;:\\&quot;$ASSET_PRICE\\&quot;&#125;&quot; Now that the buyer and seller have agreed to the same price, Org1 can transfer the asset to Org2. ç°åœ¨ä¹°å–åŒæ–¹å·²ç»åŒæ„äº†ç›¸åŒçš„ä»·æ ¼ï¼ŒOrg1å¯ä»¥å°†èµ„äº§äº¤æ˜“ç»™Org2ã€‚ 1peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;TransferAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;,&quot;Org2MSP&quot;]&#125;&#x27; --transient &quot;&#123;\\&quot;asset_properties\\&quot;:\\&quot;$ASSET_PROPERTIES\\&quot;,\\&quot;asset_price\\&quot;:\\&quot;$ASSET_PRICE\\&quot;&#125;&quot; --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt You can query the asset ownership record to verify that the transfer was successful. ä½ å¯ä»¥æŸ¥è¯¢èµ„äº§çš„å½’å±ä¿¡æ¯æ¥éªŒè¯äº¤æ˜“å·²ç»æˆåŠŸ. 1peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; The record now lists Org2 as the asset owner: 123456&#123; &quot;objectType&quot;: &quot;asset&quot;, &quot;assetID&quot;: &quot;asset1&quot;, &quot;ownerOrg&quot;: &quot;Org2MSP&quot;, &quot;publicDescription&quot;: &quot;This asset is for sale&quot;&#125; Figure 3: After the asset is transferred, the asset details are placed in the Org2 implicit data collection and deleted from the Org1 implicit data collection. As a result, the asset details are now only stored on the Org2 peer. The asset ownership record on the ledger is updated to reflect that the asset is owned by Org1. å›¾3:åœ¨èµ„äº§äº¤æ˜“ä¹‹åï¼Œèµ„äº§ç»†èŠ‚å­˜åœ¨äºOrg2çš„éšå¼æ•°æ®é›†åˆå¹¶ä¸”ä»Org1çš„éšå¼æ•°æ®é›†åˆä¸­è¢«åˆ é™¤ã€‚ç»“æœï¼Œèµ„äº§çš„ç§æœ‰ä¿¡æ¯å€¼ä¿å­˜åœ¨Org2çš„peerèŠ‚ç‚¹ã€‚åœ¨è´¦æœ¬ä¸Šçš„èµ„äº§çš„å½’å±ä¿¡æ¯ä¹Ÿè¢«æ›´æ–°ï¼Œä»¥åæ˜ èµ„äº§å½’Org2æ‰€æœ‰ã€‚ Update the asset description as Org2ï¼ˆä»¥Org2çš„èº«ä»½æ›´æ–°èµ„äº§æè¿°ï¼‰ Operate from the Org2 terminal. Now that Org2 owns the asset, we can read the asset details from the Org2 implicit data collection: é€šè¿‡Org2çš„ç»ˆç«¯æ“ä½œï¼Œç°åœ¨Org2æ‹¥æœ‰è¿™ä¸ªèµ„äº§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Org2çš„éšå¼æ•°æ®é›†åˆè¯»å–èµ„äº§çš„è¯¦æƒ…ï¼š 1peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;GetAssetPrivateProperties&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; Org2 can now update the asset public descriptionï¼ˆOrg2ç°åœ¨å¯ä»¥æ›´æ–°èµ„äº§çš„å…¬å…±æè¿°ï¼‰: 1peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ChangePublicDescription&quot;,&quot;Args&quot;:[&quot;asset1&quot;,&quot;This asset is not for sale&quot;]&#125;&#x27; Query the ledger to verify that the asset is no longer for sale: 1peer chaincode query -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n secured -c &#x27;&#123;&quot;function&quot;:&quot;ReadAsset&quot;,&quot;Args&quot;:[&quot;asset1&quot;]&#125;&#x27; Clean up When you are finished transferring assets, you can bring down the test network. The command will remove all the nodes of the test network, and delete any ledger data that you created: 1.&#x2F;network.sh down æµç¨‹å›¾ è‡ªå·±çš„ç†è§£ç”»çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"Secured","slug":"Secured","permalink":"https://guozhe001.github.io/tags/Secured/"}]},{"title":"åˆ›å»ºä¸€ä¸ªæ–°çš„channel","slug":"blockchain/fabric/åˆ›å»ºä¸€ä¸ªæ–°çš„channel","date":"2021-04-01T10:18:21.484Z","updated":"2021-04-01T10:18:21.485Z","comments":true,"path":"2021/04/01/blockchain/fabric/åˆ›å»ºä¸€ä¸ªæ–°çš„channel/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84channel/","excerpt":"","text":"åˆ›å»ºä¸€ä¸ªæ–°çš„channel å®˜æ–¹æ–‡æ¡£ You can use this tutorial to learn how to create new channels using the configtxgen CLI tool and then use the peer channel commands to join a channel with your peers. While this tutorial will leverage the Fabric test network to create the new channel, the steps in this tutorial can also be used by network operators in a production environment. ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªæ•™ç¨‹æ¥å­¦ä¹ é€šè¿‡ configtxgenCLIå·¥å…·æ¥åˆ›å»ºæ–°çš„é€šé“ï¼Œç„¶åé€šè¿‡ peer channel å‘½ä»¤å°†peerèŠ‚ç‚¹åŠ å…¥é€šé“ã€‚å°½ç®¡æœ¬æ•™ç¨‹å°†åˆ©ç”¨Fabricæµ‹è¯•ç½‘ç»œæ¥åˆ›å»ºæ–°æ¸ é“ï¼Œç½‘ç»œæ“ä½œäººå‘˜ä¹Ÿå¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æœ¬æ•™ç¨‹ä¸­çš„æ­¥éª¤ã€‚ In the process of creating the channel, this tutorial will take you through the following steps and concepts: åœ¨åˆ›å»ºé¢‘é“çš„è¿‡ç¨‹ä¸­ï¼Œæœ¬æ•™ç¨‹å°†å¸¦æ‚¨å®Œæˆä»¥ä¸‹æ­¥éª¤å’Œæ¦‚å¿µï¼š Setting up the configtxgen toolï¼šè®¾ç½®configtxgenå·¥å…· Using the configtx.yaml fileï¼šä½¿ç”¨configtx.yamlé…ç½®æ–‡ä»¶ The orderer system channelï¼šæ’åºçš„ç³»ç»Ÿé€šé“ä»‹ç» Creating an application channelï¼šåˆ›å»ºä¸€ä¸ªåº”ç”¨é€šé“ Joining peers to the channelï¼šå°†peerèŠ‚ç‚¹åŠ å…¥é€šé“ Setting anchor peersï¼šè®¾ç½®é”šèŠ‚ç‚¹ Setting up the configtxgen toolï¼ˆè®¾ç½®configtxgenå·¥å…·ï¼‰ Channels are created by building a channel creation transaction and submitting the transaction to the ordering service. The channel creation transaction specifies the initial configuration of the channel and is used by the ordering service to write the channel genesis block. While it is possible to build the channel creation transaction file manually, it is easier to use the configtxgen tool. The tool works by reading a configtx.yaml file that defines the configuration of your channel, and then writing the relevant information into the channel creation transaction. Before we discuss the configtx.yaml file in the next section, we can get started by downloading and setting up the configtxgen tool. é€šé“çš„åˆ›å»ºæ˜¯é€šè¿‡æ„å»ºä¸€ä¸ªåˆ›å»ºé€šé“çš„äº¤æ˜“ç„¶åå°†æ­¤äº¤æ˜“æäº¤ç»™æ’åºæœåŠ¡æ¥å®Œæˆçš„ã€‚â€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€æŒ‡æ˜äº†æ­¤é€šé“çš„åˆå§‹åŒ–é…ç½®å¹¶ä¸”ç”±æ’åºæœåŠ¡å†™å…¥é€šé“çš„åˆ›ä¸–çºªåŒºå—ä¸­ã€‚å°½ç®¡å¯ä»¥æ‰‹åŠ¨æ„å»ºâ€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€ï¼Œä½†ä½¿ç”¨configtxgenå·¥å…·æ›´å®¹æ˜“ã€‚configtxgenå·¥å…·è¯»å–å®šä¹‰äº†channleé…ç½®çš„configtx.yamlæ–‡ä»¶ï¼Œç„¶åå°†ç›¸å…³ä¿¡æ¯å†™å…¥â€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€ä¸­ã€‚åœ¨æˆ‘ä»¬è®¨è®º configtx.yaml æ–‡ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¼€å§‹ä¸‹è½½å¹¶è®¾ç½®configtxgen å·¥å…·ã€‚ You can download the configtxgen binaries by following the steps to install the samples, binaries and Docker images. configtxgen will be downloaded to the bin folder of your local clone of the fabric-samples repository along with other Fabric tools. ä½ å¯ä»¥è·Ÿç€ install the samples, binaries and Docker imagesçš„æ­¥éª¤æ¥ä¸‹è½½ configtxgen ã€‚ configtxgen ä¼šä¸‹è½½åˆ°fabric-samplesä»“åº“çš„binç›®å½•ä¸‹ã€‚ For the purposes of this tutorial, we will want to operate from the test-network directory inside fabric-samples. Navigate to that directory using the following command: ä¸ºäº†æœ¬æ•™ç¨‹çš„ç›®çš„ï¼Œæˆ‘ä»¬ä¼šæƒ³è¦åœ¨fabric-samplesä¸‹é¢çš„ test-network ç›®å½•ä¸‹è¿›è¡Œæ“ä½œï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åˆ‡æ¢åˆ°æ­¤ç›®å½•ï¼š 1cd fabric-samples/test-network We will operate from the test-network directory for the remainder of the tutorial. Use the following command to add the configtxgen tool to your CLI path: åœ¨æœ¬æ•™ç¨‹çš„å…¶ä½™éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ä»test-networkç›®å½•è¿›è¡Œæ“ä½œã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†configtxgenå·¥å…·æ·»åŠ åˆ°æ‚¨çš„CLIè·¯å¾„ï¼š 1export PATH=$&#123;PWD&#125;/../bin:$PATH In order to use configtxgen, you need to the set the FABRIC_CFG_PATH environment variable to the path of the directory that contains your local copy of the configtx.yaml file. For this tutorial, we will reference the configtx.yaml used to setup the Fabric test network in the configtx folder: ä¸ºäº†ä½¿ç”¨configtxgenï¼Œæ‚¨éœ€è¦å°†FABRIC_CFG_PATHç¯å¢ƒå˜é‡è®¾ç½®ä¸ºåŒ…å«configtx.yamlçš„æœ¬åœ°ç›®å½•ã€‚å¯¹äºæœ¬æ•™ç¨‹ï¼Œæˆ‘ä»¬å°†åœ¨æ­¤ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºåœ¨Fabric test networkç›®å½•ä¸‹çš„åŒ…å«configtx.yamlçš„configtx ç›®å½•ï¼š 1export FABRIC_CFG_PATH=$&#123;PWD&#125;/configtx You can check that you can are able to use the tool by printing the configtxgen help text: ä½ å¯ä»¥é€šè¿‡æ‰“å° configtxgenå·¥å…·çš„helpæ¥æ£€æŸ¥æ˜¯å¦å·²ç»è®¾ç½®å¥½: 1configtxgen --help The configtx.yaml fileï¼ˆconfigtx.yamlæ–‡ä»¶ï¼‰ The configtx.yaml file specifies the channel configuration of new channels. The information that is required to build the channel configuration is specified in a readable and editable form in the configtx.yaml file. The configtxgen tool uses the channel profiles defined in the configtx.yaml file to create the channel configuration and write it to the protobuf format that can be read by Fabric. configtx.yaml æ–‡ä»¶æŒ‡æ˜äº†ä¸€ä¸ªæ–°çš„é€šé“çš„é€šé“é…ç½®ã€‚åœ¨configtx.yamlæ–‡ä»¶ä¸­å¯ä»¥è¯»å–å’Œç¼–è¾‘æ„å»ºé€šé“é…ç½®æ‰€éœ€çš„ä¿¡æ¯ã€‚ configtxgen å·¥å…·é€šè¿‡ä½¿ç”¨ configtx.yamlæ–‡ä»¶ä¸­çš„é€šé“å±æ€§çš„å®šä¹‰æ¥åˆ›å»ºé€šé“é…ç½®ï¼Œå¹¶å°†å…¶å†™å…¥å¯ç”±Fabricè¯»å–çš„ protobufæ ¼å¼ã€‚ You can find the configtx.yaml file that is used to deploy the test network in the configtx folder in the test-network directory. The file contains the following information that we will use to create our new channel: ä½ å¯ä»¥åœ¨test-networkç›®å½•çš„configtx æ–‡ä»¶å¤¹ä¸‹é¢çœ‹åˆ° configtx.yaml æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åŒ…å«åœ¨åˆ›å»ºæ–°é€šé“æ—¶ä¼šç”¨åˆ°çš„ä¸‹é¢çš„ä¿¡æ¯ï¼š Organizations: The organizations that can become members of your channel. Each organization has a reference to the cryptographic material that is used to build the channel MSP. å¯ä»¥æˆä¸ºä½ çš„é€šé“æˆå‘˜çš„ç»„ç»‡ä¿¡æ¯ï¼Œæ¯ä¸€ä¸ªç»„ç»‡éƒ½æœ‰å¯¹ç”¨äºæ„å»ºé€šé“MSPçš„åŠ å¯†ææ–™çš„å¼•ç”¨ã€‚ Ordering service: Which ordering nodes will form the ordering service of the network, and consensus method they will use to agree to a common order of transactions. The file also contains the organizations that will become the ordering service administrators. å“ªäº›æ’åºèŠ‚ç‚¹å°†å½¢æˆç½‘ç»œä¸­çš„æ’åºæœåŠ¡ï¼Œä»¥åŠå®ƒä»¬ç”¨äºåŒæ„äº¤æ˜“é¡ºåºçš„å…±è¯†æ–¹æ³•ã€‚æ­¤æ–‡ä»¶è¿˜åŒ…å«äº†ä¼šæˆä¸ºæ’åºæœåŠ¡ç®¡ç†å‘˜çš„ç»„ç»‡çš„ä¿¡æ¯ã€‚ Channel policiesï¼š Different sections of the file work together to define the policies that will govern how organizations interact with the channel and which organizations need to approve channel updates. For the purposes of this tutorial, we will use the default policies used by Fabric. æ–‡ä»¶çš„ä¸åŒéƒ¨åˆ†ä¸€èµ·å®šä¹‰é€šé“ç­–ç•¥ï¼Œè¿™äº›ç­–ç•¥å°†æ§åˆ¶ç»„ç»‡ä¸é€šé“çš„äº¤äº’æ–¹å¼ä»¥åŠå“ªäº›ç»„ç»‡éœ€è¦æ‰¹å‡†æ¸ é“æ›´æ–°ã€‚å°±æœ¬æ•™ç¨‹è€Œè¨€ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Fabricä½¿ç”¨çš„é»˜è®¤ç­–ç•¥ã€‚ Channel profiles Each channel profile references information from other sections of the configtx.yaml file to build a channel configuration. The profiles are used the create the genesis block of the orderer system channel and the channels that will be used by peer organizations. To distinguish them from the system channel, the channels used by peer organizations are often referred to as application channels. æ¯ä¸ªé€šé“çš„é…ç½®ä¿¡æ¯éƒ½å¼•ç”¨configtx.yamlæ–‡ä»¶çš„å…¶ä»–éƒ¨åˆ†æ¥æ„å»ºé€šé“é…ç½®ã€‚è¿™äº›é…ç½®ä¿¡æ¯æ˜¯ç”¨æ¥åˆ›å»ºorderer system channel çš„åˆ›ä¸–çºªåŒºå—çš„ï¼Œç„¶åé€šé“ä¼šè¢«åŒç­‰çš„å…¶ä»–ç»„ç»‡æ‰€ä½¿ç”¨ã€‚ä¸ºäº†å°†å®ƒä»¬ï¼ˆorderer system channelï¼‰ä¸ç³»ç»Ÿé€šé“åŒºåˆ†å¼€æ¥ï¼Œç»„ç»‡ä½¿ç”¨çš„é€šé“é€šå¸¸ç§°ä¸ºåº”ç”¨ç¨‹åºé€šé“ã€‚ The configtxgen tool uses configtx.yaml file to create a complete genesis block for the system channel. As a result, the system channel profile needs to specify the full system channel configuration. The channel profile used to create the channel creation transaction only needs to contain the additional configuration information required to create an application channel. configtxgenå·¥å…·ä½¿ç”¨configtx.yamlæ–‡ä»¶ä¸ºç³»ç»Ÿé€šé“åˆ›å»ºå®Œæ•´çš„åˆ›ä¸–å—ã€‚ç»“æœï¼Œç³»ç»Ÿé€šé“é…ç½®æ–‡ä»¶éœ€è¦æŒ‡å®šå®Œæ•´çš„ç³»ç»Ÿé€šé“é…ç½®ã€‚ç”¨äºåˆ›å»ºâ€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€ä½¿ç”¨çš„é€šé“é…ç½®ä»…éœ€è¦åŒ…å«åˆ›å»ºåº”ç”¨ç¨‹åºé€šé“æ‰€éœ€çš„å…¶ä»–é…ç½®ä¿¡æ¯ã€‚ You can visit the Using configtx.yaml to create a channel genesis block tutorial to learn more about this file. For now, we will return to the operational aspects of creating the channel, though we will reference parts of this file in future steps. ä½ å¯ä»¥è®¿é—® Using configtx.yaml to create a channel genesis block æ•™ç¨‹æ¥å­¦ä¹ æ­¤æ–‡ä»¶çš„æ›´å¤šä¿¡æ¯ã€‚ç°åœ¨æˆ‘ä»¬å›åˆ°åˆ›å»ºé€šé“çš„æ“ä½œæ–¹é¢ã€‚ Start the networkï¼ˆå¯åŠ¨ç½‘ç»œï¼‰ å‚è€ƒFabricæµ‹è¯•ç½‘ç»œä½¿ç”¨ Our instance of the test network was deployed without creating an application channel. However, the test network script creates the system channel when you issue the ./network.sh up command. Under the covers, the script uses the configtxgen tool and the configtx.yaml file to build the genesis block of the system channel. Because the system channel is used to create other channels, we need to take some time to understand the orderer system channel before we can create an application channel. æˆ‘ä»¬éƒ¨ç½²çš„æµ‹è¯•ç½‘ç»œå®ä¾‹æœªåˆ›å»ºåº”ç”¨ç¨‹åºé€šé“ã€‚ä½†æ˜¯æµ‹è¯•ç½‘ç»œè„šæœ¬åœ¨ä½ è¿è¡Œ./network.sh up å‘½ä»¤æ—¶åˆ›å»ºäº†ç³»ç»Ÿé€šé“ã€‚åœ¨å¹•åï¼Œè„šæœ¬ä½¿ç”¨configtxgenå·¥å…·å’Œconfigtx.yamlæ–‡ä»¶æ¥æ„å»ºç³»ç»Ÿé€šé“çš„åˆ›ä¸–çºªå—ã€‚å› ä¸ºç³»ç»Ÿé€šé“æ˜¯ç”¨æ¥åˆ›å»ºå…¶ä»–é€šé“çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åˆ›å»ºä¸€ä¸ªåº”ç”¨é€šé“ä¹‹å‰éœ€è¦èŠ±ä¸€äº›æ—¶é—´å»äº†è§£æ’åºç³»ç»Ÿé€šé“ï¼ˆ orderer system channel ï¼‰ The orderer system channelï¼ˆæ’åºç³»ç»Ÿé€šé“ï¼‰ ç•¥ Creating an application channelï¼ˆåˆ›å»ºä¸€ä¸ªåº”ç”¨é€šé“ï¼‰ Now that we have deployed the nodes of the network and created the orderer system channel using the network.sh script, we can start the process of creating a new channel for our peer organizations. We have already set the environment variables that are required to use the configtxgen tool. Run the following command to create a channel creation transaction for channel1: ç°åœ¨æˆ‘ä»¬å·²ç»ä½¿ç”¨network.shè„šæœ¬åœ¨æµ‹è¯•ç½‘ç»œä¸­éƒ¨ç½²äº†èŠ‚ç‚¹ï¼Œå¹¶ä¸”åˆ›å»ºäº†æ’åºç³»ç»Ÿé€šé“ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥å¼€å§‹ä¸ºæˆ‘ä»¬çš„ç»„ç»‡åˆ›å»ºä¸€ä¸ªæ–°é€šé“çš„ç¨‹åºäº†ã€‚æˆ‘ä»¬å·²ç»è®¾ç½®äº†ä½¿ç”¨configtxgenå·¥å…·æ‰€éœ€çš„ç¯å¢ƒå˜é‡ã€‚è¿è¡Œä¸‹é¢çš„ç¨‹åºæ¥ä¸ºchannel1é€šé“åˆ›å»ºä¸€ä¸ªâ€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€ï¼š 1configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel1.tx -channelID channel1 The -channelID will be the name of the future channel. Channel names must be all lower case, less than 250 characters long and match the regular expression [a-z][a-z0-9.-]*. The command uses the uses the -profile flag to reference the TwoOrgsChannel: profile from configtx.yaml that is used by the test network to create application channels: -channelIDæ ‡å¿—åˆ¶å®šäº†åˆ›å»ºçš„é€šé“çš„åç§°ï¼Œé€šé“çš„åç§°å¿…é¡»å…¨æ˜¯å°å†™ï¼Œä¸è¶…è¿‡250ä¸ªå­—ç¬¦å¹¶ä¸”ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼[a-z][a-z0-9.-]*ã€‚è¯¥å‘½ä»¤ä½¿ç”¨-profileæ ‡å¿—æ¥å¼•ç”¨configtx.yamlæ–‡ä»¶ä¸­çš„TwoOrgsChannelï¼šé…ç½®ï¼Œæµ‹è¯•ç½‘ç»œä½¿ç”¨å®ƒæ¥åˆ›å»ºåº”ç”¨ç¨‹åºé€šé“ï¼š 12345678910TwoOrgsChannel: Consortium: SampleConsortium &lt;&lt;: *ChannelDefaults Application: &lt;&lt;: *ApplicationDefaults Organizations: - *Org1 - *Org2 Capabilities: &lt;&lt;: *ApplicationCapabilities The profile references the name of the SampleConsortium from the system channel, and includes both peer organizations from the consortium as channel members. Because the system channel is used as a template to create the application channel, the ordering nodes defined in the system channel become the default consenter set of the new channel, while the administrators of the ordering service become the orderer administrators of the channel. Ordering nodes and ordering organizations can be added or removed from the consenter set using channel updates. è¯¥é…ç½®æ–‡ä»¶ä»ç³»ç»Ÿé€šé“å¼•ç”¨SampleConsortiumçš„åç§°ï¼Œå¹¶ä¸”åŒ…å«æ¥è‡ªè¯¥è”ç›Ÿçš„ä¸¤ä¸ªç»„ç»‡ä½œä¸ºé€šé“æˆå‘˜ã€‚å› ä¸ºç³»ç»Ÿé€šé“è¢«ç”¨ä½œæ¨¡ç‰ˆæ¥åˆ›å»ºåº”ç”¨é€šé“ï¼Œç³»ç»Ÿé€šé“ä¸­å®šä¹‰çš„æ’åºèŠ‚ç‚¹æˆä¸ºæ–°æ¸ é“çš„é»˜è®¤consenter setï¼Œè€Œæ’åºæœåŠ¡çš„ç®¡ç†å‘˜å°†æˆä¸ºæ–°æ¸ é“çš„æ’åºç®¡ç†å‘˜ã€‚å¯ä»¥ä½¿ç”¨é€šé“æ›´æ–°åœ¨consenter setä¸­æ·»åŠ æˆ–åˆ é™¤æ’åºèŠ‚ç‚¹å’Œæ’åºç»„ç»‡ã€‚ If the command successful, you will see logs of configtxgen loading the configtx.yaml file and printing a channel creation transaction: å¦‚æœä¸Šé¢çš„å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œä½ ä¼šçœ‹åˆ°configtxgen å·¥å…·åŠ è½½ configtx.yaml æ–‡ä»¶å¹¶ä¸”æ‰“å°äº†ä¸€ä¸ªåˆ›å»ºé€šé“çš„äº¤æ˜“ï¼š 12342020-12-23 14:25:49.175 CST [common.tools.configtxgen] main -&gt; INFO 001 Loading configuration2020-12-23 14:25:49.185 CST [common.tools.configtxgen.localconfig] Load -&gt; INFO 002 Loaded configuration: /Users/apple/code/open-source/blockchain/hyperledger/fabric-samples/test-network/configtx/configtx.yaml2020-12-23 14:25:49.185 CST [common.tools.configtxgen] doOutputChannelCreateTx -&gt; INFO 003 Generating new channel configtx2020-12-23 14:25:49.188 CST [common.tools.configtxgen] doOutputChannelCreateTx -&gt; INFO 004 Writing new channel tx We can use the peer CLI to submit the channel creation transaction to the ordering service. To use the peer CLI, we need to set the FABRIC_CFG_PATH to the core.yaml file located in the fabric-samples/config directory. Set the FABRIC_CFG_PATH environment variable by running the following command: ä½ å¯ä»¥ä½¿ç”¨ peerCLIæ¥æŠŠè¿™ä¸ªâ€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€æäº¤åˆ°æ’åºæœåŠ¡ã€‚ä¸ºäº†ä½¿ç”¨peer CLIï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡FABRIC_CFG_PATHä¸º fabric-samples/config ç›®å½•ä¸‹çš„core.yamlæ–‡ä»¶ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥è®¾ç½®FABRIC_CFG_PATHç¯å¢ƒå˜é‡ï¼š 1export FABRIC_CFG_PATH=$PWD/../config/ Before the ordering service creates the channel, the ordering service will check the permission of the identity that submitted the request. By default, only admin identities of organizations that belong to the system channel consortium can create a new channel. Issue the commands below to operate the peer CLI as the admin user from Org1: åœ¨æ’åºæœåŠ¡åˆ›å»ºé€šé“æ—¶ï¼Œæ’åºæœåŠ¡ä¼šæ£€æŸ¥æäº¤è¯·æ±‚çš„èº«ä»½çš„æƒé™ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰å±äºç³»ç»Ÿé€šé“è”ç›Ÿçš„ç»„ç»‡çš„ç®¡ç†å‘˜èº«ä»½æ‰èƒ½åˆ›å»ºæ–°çš„é€šé“ã€‚è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥ä»¥Org1çš„ç®¡ç†å‘˜èº«ä»½æ“ä½œ peer CLI: 12345export CORE_PEER_TLS_ENABLED=trueexport CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crtexport CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/mspexport CORE_PEER_ADDRESS=localhost:7051 You can now create the channel by using the following command: ä½ ç°åœ¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥åˆ›å»ºé€šé“äº†ï¼š 1peer channel create -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com -c channel1 -f ./channel-artifacts/channel1.tx --outputBlock ./channel-artifacts/channel1.block --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem The command above provides the path to the channel creation transaction file using the -f flag and uses the -c flag to specify the channel name. The -o flag is used to select the ordering node that will be used to create the channel. The --cafile is the path to the TLS certificate of the ordering node. When you run the peer channel create command, the peer CLI will generate the following response: ä¸Šé¢çš„å‘½ä»¤ä½¿ç”¨ -fæ ‡å¿—æ¥æŒ‡å®šâ€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€çš„æ–‡ä»¶ï¼Œå¹¶ä¸”ä½¿ç”¨ -c æ ‡å¿—æ¥æŒ‡å®šé€šé“åç§°ã€‚-oæ ‡å¿—æ˜¯ç”¨æ¥é€‰æ‹©ç”¨æ¥åˆ›å»ºé€šé“çš„æ’åºèŠ‚ç‚¹çš„ã€‚--cafile æ ‡å¿—æ˜¯æ’åºèŠ‚ç‚¹çš„TLSè¯ä¹¦è·¯å¾„ã€‚å½“ä½ è¿è¡Œ peer channel createå‘½ä»¤æ—¶ï¼Œ peer CLIä¼šç”Ÿæˆä¸‹é¢çš„å“åº”ï¼š 122020-12-23 14:36:09.386 CST [channelCmd] InitCmdFactory -&gt; INFO 00b Endorser and orderer connections initialized2020-12-23 14:36:09.595 CST [cli.common] readBlock -&gt; INFO 00c Received block: 0 Because we are using a Raft ordering service, you may get some status unavailable messages that you can safely ignore. The command will return the genesis block of the new channel to the location specified by the --outputBlock flag. å› ä¸ºæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªRaftç­–ç•¥çš„æ’åºæœåŠ¡ï¼Œä½ å¯èƒ½ä¼šæ”¶åˆ°ä¸€äº›çŠ¶æ€ä¸å¯ç”¨çš„ä¿¡æ¯ä½ å¯ä»¥æ”¾å¿ƒçš„å¿½ç•¥ä»–ä»¬ã€‚è¯¥å‘½ä»¤ä¼šå°†æ–°é€šé“çš„åˆ›ä¸–çºªåŒºå—è¾“å‡ºåˆ°--outputBlockæ ‡å¿—æŒ‡å®šçš„ä½ç½®ã€‚ Join peers to the channelï¼ˆæŠŠèŠ‚ç‚¹åŠ å…¥é€šé“ä¸­ï¼‰ After the channel has been created, we can join the channel with our peers. Organizations that are members of the channel can fetch the channel genesis block from the ordering service using the peer channel fetch command. The organization can then use the genesis block to join the peer to the channel using the peer channel join command. Once the peer is joined to the channel, the peer will build the blockchain ledger by retrieving the other blocks on the channel from the ordering service. åœ¨é€šé“åˆ›å»ºä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæˆ‘ä»¬çš„peerèŠ‚ç‚¹åŠ å…¥åˆ°é€šé“ã€‚å±äºé€šé“æˆå‘˜çš„ç»„ç»‡å¯ä»¥ä½¿ç”¨ peer channel fetchå‘½ä»¤ä»æ’åºæœåŠ¡é‚£é‡Œè·å–é€šé“çš„åˆ›ä¸–çºªåŒºå—ã€‚ç„¶åè¿™ä¸ªç»„ç»‡å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªåˆ›ä¸–çºªåŒºå—æ¥é€šè¿‡ peer channel join å‘½ä»¤å°†peerèŠ‚ç‚¹åŠ å…¥åˆ°é€šé“äº†ã€‚ä¸€æ—¦peerèŠ‚ç‚¹åŠ å…¥äº†é€šé“ï¼ŒpeerèŠ‚ç‚¹å°†é€šè¿‡ä»æ’åºæœåŠ¡ä¸­æ£€ç´¢å…¶ä»–åŒºå—æ¥æ„å»ºåŒºå—é“¾è´¦æœ¬äº†ã€‚ Since we are already operating the peer CLI as the Org1 admin, letâ€™s join the Org1 peer to the channel. Since Org1 submitted the channel creation transaction, we already have the channel genesis block on our file system. Join the Org1 peer to the channel using the command below. å› ä¸ºæˆ‘ä»¬å·²ç»é€šè¿‡Org1çš„ç®¡ç†å‘˜æ“ä½œäº† peer CLI ï¼Œè®©æˆ‘ä»¬æŠŠOrg1çš„peerèŠ‚ç‚¹åŠ å…¥åˆ°é€šé“ã€‚å› ä¸ºæ˜¯Org1ç»„ç»‡æäº¤çš„â€œåˆ›å»ºé€šé“çš„äº¤æ˜“â€ï¼Œæˆ‘ä»¬å·²ç»åœ¨æˆ‘ä»¬æœ¬åœ°çš„æ–‡ä»¶ç³»ç»Ÿä¸­æ‹¥æœ‰äº†é€šé“çš„åˆ›ä¸–çºªåŒºå—ã€‚ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°†ç»„ç»‡Org1çš„peerèŠ‚ç‚¹åŠ å…¥åˆ°é€šé“ä¸­ï¼š 1peer channel join -b ./channel-artifacts/channel1.block The CORE_PEER_ADDRESS environment variable has been set to target peer0.org1.example.com. A successful command will generate a response from peer0.org1.example.com joining the channel: ç¯å¢ƒå˜é‡CORE_PEER_ADDRESSå·²ç»è®¾ç½®ä¸ºæŒ‡å‘äº†peer0.org1.example.comï¼Œå¦‚æœå‘½ä»¤æˆåŠŸçš„è¯ä¼šè·å– peer0.org1.example.com åŠ å…¥é€šé“çš„å“åº”ï¼š 122020-03-06 17:49:09.903 EST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized2020-03-06 17:49:10.060 EST [channelCmd] executeJoin -&gt; INFO 002 Successfully submitted proposal to join channel æˆ‘æœ¬åœ°çš„è¿è¡ŒæŠ¥é”™å¦‚ä¸‹ï¼Œè®°å½•TODOï¼Œæœ€ç»ˆä½¿ç”¨æœ€æ–°2.3.0çš„ç‰ˆæœ¬å°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚2.2.0ç‰ˆæœ¬æ²¡æœ‰æˆåŠŸå¯åŠ¨org1çš„peerã€‚ 12345(base) apple@WHOAMIdeMacBook-Pro:~/code/open-source/blockchain/hyperledger/fabric-samples/test-network$ peer channel join -b ./channel-artifacts/channel1.block2020-12-23 14:59:02.760 CST [comm.tls] ClientHandshake -&gt; ERRO 001 Client TLS handshake failed after 2.782623ms with error: EOF remoteaddress=[::1]:70512020-12-23 14:59:03.768 CST [comm.tls] ClientHandshake -&gt; ERRO 002 Client TLS handshake failed after 2.438885ms with error: EOF remoteaddress=[::1]:70512020-12-23 14:59:05.075 CST [comm.tls] ClientHandshake -&gt; ERRO 003 Client TLS handshake failed after 1.857716ms with error: EOF remoteaddress=[::1]:7051Error: error getting endorser client for channel: endorser client failed to connect to localhost:7051: failed to create new connection: context deadline exceeded You can verify that the peer has joined the channel using the peer channel getinfo command: ä½ å¯ä»¥ä½¿ç”¨ peer channel getinfo å‘½ä»¤æ¥éªŒè¯peerèŠ‚ç‚¹å·²ç»åŠ å…¥äº†é€šé“ï¼š 1peer channel getinfo -c channel1 The command will list the block height of the channel and the hash of the most recent block. Because the genesis block is the only block on the channel, the height of the channel will be 1: è¿™ä¸ªå‘½ä»¤ä¼šåˆ—å‡ºé€šé“åŒºå—çš„é«˜åº¦å’Œæœ€æ–°çš„åŒºå—çš„hashå€¼ï¼Œå› ä¸ºè¿™ä¸ªé€šé“ä¸Šåªæœ‰ä¸€ä¸ªåˆ›ä¸–çºªåŒºå—ï¼Œæ‰€ä»¥è¿™ä¸ªé€šé“ä¸Šçš„åŒºå—é«˜åº¦æ˜¯1: 122020-03-13 10:50:06.978 EDT [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initializedBlockchain info: &#123;&quot;height&quot;:1,&quot;currentBlockHash&quot;:&quot;kvtQYYEL2tz0kDCNttPFNC4e6HVUFOGMTIDxZ+DeNQM=&quot;&#125; We can now join the Org2 peer to the channel. Set the following environment variables to operate the peer CLI as the Org2 admin. The environment variables will also set the Org2 peer, peer0.org1.example.com, as the target peer. æˆ‘ä»¬ç°åœ¨å¯ä»¥æŠŠç»„ç»‡Org2çš„peerèŠ‚ç‚¹åŠ å…¥é€šé“äº†ã€‚è®¾ç½®ä¸‹é¢çš„ç¯å¢ƒå˜é‡æ¥ä½¿ç”¨Org2çš„ç®¡ç†å‘˜æ“ä½œpeer CLIã€‚ 12345export CORE_PEER_TLS_ENABLED=trueexport CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crtexport CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/mspexport CORE_PEER_ADDRESS=localhost:9051 While we still have the channel genesis block on our file system, in a more realistic scenario, Org2 would have the fetch the block from the ordering service. As an example, we will use the peer channel fetch command to get the genesis block for Org2: ç„¶è€Œåœ¨æˆ‘ä»¬æœ¬åœ°ç³»ç»Ÿä¸­ä»ç„¶å­˜åœ¨é€šé“çš„åˆ›ä¸–çºªåŒºå—ï¼Œåœ¨ä¸€ä¸ªæ›´çœŸå®çš„æƒ…å½¢ä¸­ï¼Œç»„ç»‡Org2åº”è¯¥ä»æ’åºæœåŠ¡è·å–è¿™ä¸ªåŒºå—ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ peer channel fetchå‘½ä»¤æ¥ä¸ºç»„ç»‡Org2è·å–åˆ›ä¸–çºªåŒºå—ï¼š 1peer channel fetch 0 ./channel-artifacts/channel_org2.block -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com -c channel1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem The command uses 0 to specify that it needs to fetch the genesis block that is required to join the channel. If the command is successful, you should see the following output: è¯¥å‘½ä»¤ä½¿ç”¨0æ¥æŒ‡æ˜å®ƒéœ€è¦è·å–åˆ›ä¸–çºªå—ï¼Œè¯¥åˆ›ä¸–çºªåŒºå—ç”¨äºåŠ å…¥é€šé“ã€‚å¦‚æœå‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼Œä½ ä¼šçœ‹åˆ°ä¸‹é¢çš„è¾“å‡ºï¼š 122020-03-13 11:32:06.309 EDT [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized2020-03-13 11:32:06.336 EDT [cli.common] readBlock -&gt; INFO 002 Received block: 0 The command returns the channel genesis block and names it channel_org2.block to distinguish it from the block pulled by org1. You can now use the block to join the Org2 peer to the channel: è¿™ä¸ªå‘½ä»¤ä¼šè·å–åˆ°åä¸º channel_org2.block çš„é€šé“åˆ›ä¸–çºªåŒºå—ï¼Œä»¥ä¸Org1çš„åŒºå—ä½œåŒºåˆ†ã€‚ä½ ç°åœ¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªåŒºå—æŠŠOrg2çš„peerèŠ‚ç‚¹åŠ å…¥åˆ°é€šé“ï¼š 1peer channel join -b ./channel-artifacts/channel_org2.block Set anchor peersï¼ˆè®¾ç½®é”šèŠ‚ç‚¹ï¼‰ After an organizations has joined their peers to the channel, they should select at least one of their peers to become an anchor peer. Anchor peers are required in order to take advantage of features such as private data and service discovery. Each organization should set multiple anchor peers on a channel for redundancy. For more information about gossip and anchor peers, see the Gossip data dissemination protocol. åœ¨ä¸€ä¸ªç»„ç»‡å°†ä»–ä»¬çš„peerèŠ‚ç‚¹åŠ å…¥åˆ°é€šé“ä¹‹åï¼Œä»–ä»¬è¿˜éœ€è¦åœ¨ä»–ä»¬çš„ç»„ç»‡å†…éƒ¨é€‰æ‹©è‡³å°‘ä¸€ä¸ªpeerèŠ‚ç‚¹ä½œä¸ºé”šèŠ‚ç‚¹ã€‚Anchor peers éœ€è¦é”šèŠ‚ç‚¹çš„å¥½å¤„æ˜¯ä»–èƒ½å¤Ÿåˆ©ç”¨ç§æœ‰æ•°æ®ä»¥åŠåšæœåŠ¡å‘ç°ã€‚æ¯ä¸ªç»„ç»‡éƒ½åº”åœ¨ä¸€ä¸ªé€šé“ä¸Šè®¾ç½®å¤šä¸ªé”šèŠ‚ç‚¹ä»¥å®ç°å†—ä½™ã€‚ The endpoint information of the anchor peers of each organization is included in the channel configuration. Each channel member can specify their anchor peers by updating the channel. We will use the configtxlator tool to update the channel configuration and select an anchor peer for Org1 and Org2. The process for setting an anchor peer is similar to the steps that are required to make other channel updates and provides an introduction to how to use configtxlator to update a channel configuration. You will also need to install the jq tool on your local machine. é€šé“é…ç½®ä¸­åŒ…å«æ¯ä¸ªç»„ç»‡çš„é”šèŠ‚ç‚¹çš„ç»ˆç‚¹ä¿¡æ¯ã€‚æ¯ä¸ªç»„ç»‡éƒ½å¯ä»¥é€šè¿‡æ›´æ–°é€šé“é…ç½®æ¥çŸ¥åä»–ä»¬çš„é”šèŠ‚ç‚¹ã€‚æˆ‘ä»¬ä¼šä½¿ç”¨ configtxlatorå·¥å…·æ¥æ›´æ–°é€šé“é…ç½®å¹¶ä¸”ä¸ºç»„ç»‡Org1å’ŒOrg2å„é€‰æ‹©ä¸€ä¸ªé”šèŠ‚ç‚¹ã€‚è®¾ç½®é”šèŠ‚ç‚¹çš„æµç¨‹ä¸æ•™ç¨‹update a channel configurationçš„æ­¥éª¤å¾ˆç±»ä¼¼ã€‚ä½ è¿˜éœ€è¦åœ¨ä½ çš„æœ¬åœ°å®‰è£…jq å·¥å…·ã€‚ We will start by selecting an anchor peer as Org1. The first step is to pull the most recent channel configuration block using the peer channel fetch command. Set the following environment variables to operate the peer CLI as the Org1 admin: æˆ‘ä»¬å…ˆä»¥Org1çš„èº«ä»½æ¥é€‰æ‹©ä¸€ä¸ªé”šèŠ‚ç‚¹ã€‚ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨peer channel fetch å‘½ä»¤æ‹‰å»æœ€æ–°çš„é€šé“é…ç½®åŒºå—ã€‚è®¾ç½®ç¯å¢ƒå˜é‡ä»¥Org1ç®¡ç†å‘˜çš„èº«ä»½æ“ä½œ peer CLI ï¼š 123456export FABRIC_CFG_PATH=$PWD/../config/export CORE_PEER_TLS_ENABLED=trueexport CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crtexport CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/mspexport CORE_PEER_ADDRESS=localhost:7051 You can use the following command to fetch the channel configuration: ä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥è·å–é€šé“é…ç½®ï¼š 1peer channel fetch config channel-artifacts/config_block.pb -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com -c channel1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem Because the most recent channel configuration block is the channel genesis block, you will see the command return block 0 from the channel. å› ä¸ºæœ€æ–°çš„é€šé“é…ç½®åŒºå—æ˜¯é€šé“çš„åˆ›ä¸–çºªåŒºå—ï¼Œä½ ä¼šçœ‹åˆ°è¯¥å‘½ä»¤ä¼šè¿”å›é€šé“ä¸Šçš„0åŒºå—ã€‚ 12342020-12-23 16:37:33.686 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized2020-12-23 16:37:33.689 CST [cli.common] readBlock -&gt; INFO 002 Received block: 02020-12-23 16:37:33.689 CST [channelCmd] fetch -&gt; INFO 003 Retrieving last config block: 02020-12-23 16:37:33.693 CST [cli.common] readBlock -&gt; INFO 004 Received block: 0 The channel configuration block was stored in the channel-artifacts folder to keep the update process separate from other artifacts. Change into the channel-artifacts folder to complete the next steps: é€šé“é…ç½®åŒºå—è¢«å­˜å‚¨åœ¨channel-artifactsç›®å½•ä¸‹ï¼Œä»¥ä½¿æ›´æ–°æµç¨‹ä¸å…¶ä»–çš„ç»„ä»¶åŒºåˆ†å¼€ã€‚è¿›å…¥ channel-artifacts ç›®å½•ä¸‹æ¥å®Œæˆæ¥ä¸‹æ¥çš„æ­¥éª¤ï¼š 1cd channel-artifacts We can now start using the configtxlator tool to start working with the channel configuration. The first step is to decode the block from protobuf into a JSON object that can be read and edited. We also strip away the unnecessary block data, leaving only the channel configuration. æˆ‘ä»¬ç°åœ¨å¼€å§‹ä½¿ç”¨ configtxlator å·¥å…·å’Œé€šé“é…ç½®ä¸€èµ·å·¥ä½œã€‚ç¬¬ä¸€æ­¥æ˜¯å°†æ¥è‡ªåŒºå—çš„protobufæ ¼å¼è§£ç ä¸ºå¯ä»¥è¯»å–å’Œç¼–è¾‘çš„JSONæ ¼å¼ã€‚æˆ‘ä»¬è¿˜å°†å»é™¤ä¸å¿…è¦çš„å—æ•°æ®ï¼Œä»…ä¿ç•™é€šé“é…ç½®ã€‚ 12configtxlator proto_decode --input config_block.pb --type common.Block --output config_block.jsonjq .data.data[0].payload.data.config config_block.json &gt; config.json These commands convert the channel configuration block into a streamlined JSON, config.json, that will serve as the baseline for our update. Because we donâ€™t want to edit this file directly, we will make a copy that we can edit. We will use the original channel config in a future step. è¿™äº›å‘½ä»¤å°†é€šé“é…ç½®åŒºå—è½¬æ¢ä¸ºç®€åŒ–çš„JSONæ ¼å¼çš„æ–‡ä»¶config.jsonï¼Œå®ƒå°†ä½œä¸ºæˆ‘ä»¬æ›´æ–°çš„åŸºå‡†ã€‚å› ä¸ºæˆ‘ä»¬ä¸æƒ³ç›´æ¥ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬ä¼šå…ˆåˆ›å»ºä¸€ä¸ªå¯ä»¥ç¼–è¾‘çš„å‰¯æœ¬ã€‚æˆ‘ä»¬å°†åœ¨ä»¥åçš„æ­¥éª¤ä¸­ä½¿ç”¨åŸå§‹çš„é€šé“é…ç½®ã€‚ 1cp config.json config_copy.json You can use the jq tool to add the Org1 anchor peer to the channel configuration. ä½ å¯ä»¥ä½¿ç”¨jq å·¥å…·æ¥æ·»åŠ Org1ç»„ç»‡çš„é”šèŠ‚ç‚¹åˆ°é€šé“é…ç½®ã€‚ 1jq &#x27;.channel_group.groups.Application.groups.Org1MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.org1.example.com&quot;,&quot;port&quot;: 7051&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; config_copy.json &gt; modified_config.json After this step, we have an updated version of channel configuration in JSON format in the modified_config.json file. We can now convert both the original and modified channel configurations back into protobuf format and calculate the difference between them. å®Œæˆæ­¤æ­¥éª¤åï¼Œæˆ‘ä»¬åœ¨modified_config.jsonæ–‡ä»¶ä¸­ä»¥JSONæ ¼å¼è·å–äº†é€šé“é…ç½®çš„æ›´æ–°ç‰ˆæœ¬ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚ 123configtxlator proto_encode --input config.json --type common.Config --output config.pbconfigtxlator proto_encode --input modified_config.json --type common.Config --output modified_config.pbconfigtxlator compute_update --channel_id channel1 --original config.pb --updated modified_config.pb --output config_update.pb The new protobuf named channel_update.pb contains the anchor peer update that we need to apply to the channel configuration. We can wrap the configuration update in a transaction envelope to create the channel configuration update transaction. æ ¼å¼ä¸ºprotobufçš„æ–°çš„channel_update.pbæ–‡ä»¶åŒ…å«æˆ‘ä»¬éœ€è¦åº”ç”¨äºé€šé“é…ç½®ä¸Šçš„é”šèŠ‚ç‚¹æ›´æ–°ã€‚æˆ‘ä»¬å¯ä»¥å°†é…ç½®æ›´æ–°åŒ…è£…åœ¨äº¤æ˜“ä¿¡å°ä¸­ä»¥åˆ›å»ºé€šé“é…ç½®æ›´æ–°äº¤æ˜“ã€‚ 123configtxlator proto_decode --input config_update.pb --type common.ConfigUpdate --output config_update.jsonecho &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;channel1&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; config_update_in_envelope.jsonconfigtxlator proto_encode --input config_update_in_envelope.json --type common.Envelope --output config_update_in_envelope.pb We can now use the final artifact, config_update_in_envelope.pb, that can be used to update the channel. Navigate back to the test-network directory: ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ€ç»ˆå·¥ä»¶config_update_in_envelope.pbï¼Œè¯¥å·¥ä»¶å¯ä»¥ç”¨äºæ›´æ–°é€šé“ã€‚å›åˆ°test-network ç›®å½•ï¼š 1cd .. We can add the anchor peer by providing the new channel configuration to the peer channel update command. Because we are updating a section of the channel configuration that only affects Org1, other channel members do not need to approve the channel update. æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘peer channel updateå‘½ä»¤æä¾›æ–°çš„é€šé“é…ç½®æ¥æ·»åŠ é”šèŠ‚ç‚¹ã€‚å› ä¸ºæˆ‘ä»¬æ­£åœ¨æ›´æ–°ä»…å½±å“Org1çš„éƒ¨åˆ†é€šé“é…ç½®ï¼Œæ‰€ä»¥å…¶ä»–é€šé“æˆå‘˜ä¸éœ€è¦æ‰¹å‡†é€šé“æ›´æ–°ã€‚ 1peer channel update -f channel-artifacts/config_update_in_envelope.pb -c channel1 -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem When the channel update is successful, you should see the following response: å½“æ¸ é“æ›´æ–°æˆåŠŸåï¼Œä½ ä¼šçœ‹åˆ°ä¸‹é¢çš„å“åº”ï¼š 122020-12-23 17:05:48.187 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initialized2020-12-23 17:05:48.222 CST [channelCmd] update -&gt; INFO 002 Successfully submitted channel update We can set the anchor peers for Org2. Because we are going through the process a second time, we will go through the steps more quickly. Set the environment variables to operate the peer CLI as the Org2 admin: æˆ‘ä»¬å¯ä»¥ä¸ºOrg2è®¾ç½®é”šèŠ‚ç‚¹ã€‚å› ä¸ºæˆ‘ä»¬æ˜¯ç¬¬äºŒæ¬¡è¿›è¡Œè¯¥è¿‡ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æ›´å¿«åœ°å®Œæˆè¿™äº›æ­¥éª¤ã€‚è®¾ç½®ç¯å¢ƒå˜é‡ä»¥Org2ç®¡ç†å‘˜çš„èº«ä»½æ“ä½œ peer CLI ï¼š 12345export CORE_PEER_TLS_ENABLED=trueexport CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crtexport CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/mspexport CORE_PEER_ADDRESS=localhost:9051 Pull the latest channel configuration block, which is now the second block on the channel: æ‹‰å»æœ€æ–°çš„é€šé“é…ç½®åŒºå—ï¼Œå³ç›®å‰é€šé“ä¸Šçš„ç¬¬äºŒä¸ªåŒºå—ï¼š 1peer channel fetch config channel-artifacts/config_block.pb -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com -c channel1 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem Navigate back to the channel-artifacts directoryï¼ˆåˆ‡æ¢å› channel-artifacts ç›®å½•ï¼‰: 1cd channel-artifacts You can then decode and copy the configuration block.ï¼ˆä½ å¯ä»¥è§£ç å¹¶å¤åˆ¶é…ç½®åŒºå—ï¼‰ 123configtxlator proto_decode --input config_block.pb --type common.Block --output config_block.jsonjq .data.data[0].payload.data.config config_block.json &gt; config.jsoncp config.json config_copy.json Add the Org2 peer that is joined to the channel as the anchor peer in the channel configuration: åœ¨é€šé“é…ç½®ä¸­æ·»åŠ Org2çš„å·²ç»åŠ å…¥é€šé“çš„èŠ‚ç‚¹ä½œä¸ºé”šèŠ‚ç‚¹: 1jq &#x27;.channel_group.groups.Application.groups.Org2MSP.values += &#123;&quot;AnchorPeers&quot;:&#123;&quot;mod_policy&quot;: &quot;Admins&quot;,&quot;value&quot;:&#123;&quot;anchor_peers&quot;: [&#123;&quot;host&quot;: &quot;peer0.org2.example.com&quot;,&quot;port&quot;: 9051&#125;]&#125;,&quot;version&quot;: &quot;0&quot;&#125;&#125;&#x27; config_copy.json &gt; modified_config.json We can now convert both the original and updated channel configurations back into protobuf format and calculate the difference between them. æˆ‘ä»¬å¯ä»¥å°†åŸå§‹çš„å’Œä¿®æ”¹åçš„é€šé“é…ç½®éƒ½è½¬æ¢å›protobufæ ¼å¼ï¼Œå¹¶è®¡ç®—å®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚ 123configtxlator proto_encode --input config.json --type common.Config --output config.pbconfigtxlator proto_encode --input modified_config.json --type common.Config --output modified_config.pbconfigtxlator compute_update --channel_id channel1 --original config.pb --updated modified_config.pb --output config_update.pb Wrap the configuration update in a transaction envelope to create the channel configuration update transaction: å°†é…ç½®æ›´æ–°åŒ…è£…åœ¨äº¤æ˜“ä¿¡å°ä¸­ä»¥åˆ›å»ºé€šé“é…ç½®æ›´æ–°äº¤æ˜“ï¼š 123configtxlator proto_decode --input config_update.pb --type common.ConfigUpdate --output config_update.jsonecho &#x27;&#123;&quot;payload&quot;:&#123;&quot;header&quot;:&#123;&quot;channel_header&quot;:&#123;&quot;channel_id&quot;:&quot;channel1&quot;, &quot;type&quot;:2&#125;&#125;,&quot;data&quot;:&#123;&quot;config_update&quot;:&#x27;$(cat config_update.json)&#x27;&#125;&#125;&#125;&#x27; | jq . &gt; config_update_in_envelope.jsonconfigtxlator proto_encode --input config_update_in_envelope.json --type common.Envelope --output config_update_in_envelope.pb Navigate back to the test-network directory. 1cd .. Update the channel and set the Org2 anchor peer by issuing the following command: 1peer channel update -f channel-artifacts/config_update_in_envelope.pb -c channel1 -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem You can confirm that the channel has been updated successfully by running the peer channel info command: ä½ å¯ä»¥ä½¿ç”¨ peer channel infoå‘½ä»¤æ¥ç¡®è®¤é€šé“å·²ç»æˆåŠŸæ›´æ–°ã€‚ 1peer channel getinfo -c channel1 Now that the channel has been updated by adding two channel configuration blocks to the channel genesis block, the height of the channel will have grown to three: ç°åœ¨å·²ç»é€šè¿‡åœ¨åˆ›ä¸–çºªåŒºå—ä¸Šæ·»åŠ ä¸¤ä¸ªé€šé“é…ç½®åŒºå—æ›´æ–°äº†é€šé“ï¼Œé€šé“çš„åŒºå—é«˜åº¦ä¼šå¢é•¿åˆ°3: 122020-12-23 17:19:08.620 CST [channelCmd] InitCmdFactory -&gt; INFO 001 Endorser and orderer connections initializedBlockchain info: &#123;&quot;height&quot;:3,&quot;currentBlockHash&quot;:&quot;0xMLgGnvbUE+gfDpxjbfB1OsxROF3djLzPX9S76ai2I=&quot;,&quot;previousBlockHash&quot;:&quot;6oIrHH8zjeOuhlj2/rrpzxh0pNmGOdPTDjiphJwCXcQ=&quot;&#125; Deploy a chaincode to the new channelï¼ˆéƒ¨ç½²é“¾ç åˆ°æ–°é€šé“ä¸Šï¼‰ We can confirm that the channel was created successfully by deploying a chaincode to the channel. We can use the network.sh script to deploy the Basic asset transfer chaincode to any test network channel. Deploy a chaincode to our new channel using the following command: æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨é€šé“ä¸Šéƒ¨ç½²é“¾ç æ¥ç¡®è®¤é€šé“å·²ç»åˆ›å»ºæˆåŠŸã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ network.sh è„šæœ¬éƒ¨ç½²Basic asset transfer é“¾ç åˆ°ä»»ä½•æµ‹è¯•é€šé“ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°†é“¾ç éƒ¨ç½²åˆ°æ–°é€šé“ä¸Šï¼š 1./network.sh deployCC -ccn basic -ccp ../asset-transfer-basic/chaincode-go/ -ccl go -c channel1 -cci InitLedger After you run the command, you should see the chaincode being deployed to the channel in your logs. The chaincode is invoked to add data to the channel ledger. è¿è¡Œå‘½ä»¤åï¼Œæ‚¨åº”è¯¥åœ¨æ—¥å¿—ä¸­çœ‹åˆ°é“¾ç å·²éƒ¨ç½²åˆ°é€šé“ã€‚è°ƒç”¨é“¾ç å°†æ•°æ®æ·»åŠ åˆ°é€šé“è´¦æœ¬ã€‚ 1peer chaincode query -C channel1 -n basic -c &#x27;&#123;&quot;Args&quot;:[&quot;getAllAssets&quot;]&#125;&#x27; After you run the query, you should see the assets that were added to the channel ledger. åœ¨è¿è¡ŒæŸ¥è¯¢ä¹‹åï¼Œä½ ä¼šçœ‹åˆ°å·²ç»æ·»åŠ åˆ°é€šé“è´¦æœ¬ä¸Šçš„èµ„äº§åˆ—è¡¨ã€‚ 1[&#123;&quot;ID&quot;:&quot;asset1&quot;,&quot;color&quot;:&quot;blue&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Tomoko&quot;,&quot;appraisedValue&quot;:300&#125;,&#123;&quot;ID&quot;:&quot;asset2&quot;,&quot;color&quot;:&quot;red&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Brad&quot;,&quot;appraisedValue&quot;:400&#125;,&#123;&quot;ID&quot;:&quot;asset3&quot;,&quot;color&quot;:&quot;green&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Jin Soo&quot;,&quot;appraisedValue&quot;:500&#125;,&#123;&quot;ID&quot;:&quot;asset4&quot;,&quot;color&quot;:&quot;yellow&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Max&quot;,&quot;appraisedValue&quot;:600&#125;,&#123;&quot;ID&quot;:&quot;asset5&quot;,&quot;color&quot;:&quot;black&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Adriana&quot;,&quot;appraisedValue&quot;:700&#125;,&#123;&quot;ID&quot;:&quot;asset6&quot;,&quot;color&quot;:&quot;white&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Michel&quot;,&quot;appraisedValue&quot;:800&#125;]","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"channel","slug":"åŒºå—é“¾/Hyperledger-Fabric/channel","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/channel/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"channel","slug":"channel","permalink":"https://guozhe001.github.io/tags/channel/"}]},{"title":"èº«ä»½è¯†åˆ«","slug":"blockchain/fabric/å…³é”®æ¦‚å¿µ/èº«åˆ†è¯†åˆ«","date":"2021-04-01T10:18:21.483Z","updated":"2021-04-01T10:18:21.484Z","comments":true,"path":"2021/04/01/blockchain/fabric/å…³é”®æ¦‚å¿µ/èº«åˆ†è¯†åˆ«/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/%E8%BA%AB%E5%88%86%E8%AF%86%E5%88%AB/","excerpt":"","text":"å®˜æ–¹æ–‡æ¡£Identity What is an Identity?ï¼ˆä»€ä¹ˆæ˜¯èº«ä»½è¯†åˆ«ï¼‰ The different actors in a blockchain network include peers, orderers, client applications, administrators and more. Each of these actors â€” active elements inside or outside a network able to consume services â€” has a digital identity encapsulated in an X.509 digital certificate. These identities really matter because they determine the exact permissions over resources and access to information that actors have in a blockchain network. åŒºå—é“¾ç½‘ç»œä¸­åŒ…å«ä¸åŒçš„æˆå‘˜ï¼ŒåŒ…æ‹¬peersã€orderersã€client applicationsã€administratorsç­‰ã€‚è¿™äº›å‚ä¸è€…ï¼ˆç½‘ç»œå†…éƒ¨æˆ–å¤–éƒ¨èƒ½å¤Ÿä½¿ç”¨æœåŠ¡çš„æ´»åŠ¨å…ƒç´ ï¼‰ä¸­çš„æ¯ä¸€ä¸ªéƒ½æœ‰å°è£…åœ¨X.509æ•°å­—è¯ä¹¦ä¸­çš„æ•°å­—èº«ä»½ã€‚è¿™äº›èº«ä»½ç¡®å®å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒä»¬ç¡®å®šäº†å¯¹èµ„æºçš„ç¡®åˆ‡æƒé™ä»¥åŠå¯¹å‚ä¸è€…åœ¨åŒºå—é“¾ç½‘ç»œä¸­æ‹¥æœ‰çš„è®¿é—®ä¿¡æ¯çš„æƒé™ã€‚ A digital identity furthermore has some additional attributes that Fabric uses to determine permissions, and it gives the union of an identity and the associated attributes a special name â€” principal. Principals are just like userIDs or groupIDs, but a little more flexible because they can include a wide range of properties of an actorâ€™s identity, such as the actorâ€™s organization, organizational unit, role or even the actorâ€™s specific identity. When we talk about principals, they are the properties which determine their permissions. æ­¤å¤–ï¼Œæ•°å­—èº«ä»½è¿˜å…·æœ‰Fabricç”¨æ¥ç¡®å®šæƒé™çš„å…¶ä»–ä¸€äº›å±æ€§ï¼Œå®ƒä¸ºèº«ä»½å’Œç›¸å…³å±æ€§çš„å¹¶é›†æä¾›äº†ä¸€ä¸ªç‰¹æ®Šåç§°-ä¸»ä½“ã€‚ä¸»ä½“å°±åƒæ˜¯userIDsæˆ–groupIDsï¼Œä½†æ›´åŠ çµæ´»ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥åŒ…å«æˆå‘˜èº«ä»½çš„å„ç§å±æ€§ï¼Œä¾‹å¦‚æˆå‘˜çš„ç»„ç»‡ï¼Œç»„ç»‡å•ä½ï¼Œè§’è‰²ï¼Œç”šè‡³æˆå‘˜çš„ç‰¹å®šèº«ä»½ã€‚å½“æˆ‘ä»¬è°ˆè®ºä¸»ä½“æ—¶ï¼Œå®ƒä»¬æ˜¯ç¡®å®šå…¶æƒé™çš„å±æ€§ã€‚ For an identity to be verifiable, it must come from a trusted authority. A membership service provider (MSP) is that trusted authority in Fabric. More specifically, an MSP is a component that defines the rules that govern the valid identities for this organization. The default MSP implementation in Fabric uses X.509 certificates as identities, adopting a traditional Public Key Infrastructure (PKI) hierarchical model (more on PKI later). ä¸ºäº†ä½¿èº«ä»½å¯éªŒè¯ï¼Œå®ƒå¿…é¡»æ¥è‡ªå—ä¿¡ä»»çš„æƒå¨ã€‚ membership service provider (MSP)å°±æ˜¯ä¸€ä¸ªåœ¨Fabricä¸­çš„å—ä¿¡ä»»çš„æƒå¨ã€‚æ›´å…·ä½“åœ°è¯´ï¼ŒMSPæ˜¯å®šä¹‰ç”¨äºç®¡ç†è¯¥ç»„ç»‡è§’è‰²çš„æœ‰æ•ˆèº«ä»½çš„ç»„ä»¶ã€‚ã€‚ Fabricä¸­çš„é»˜è®¤MSPå®ç°æ˜¯ä½¿ç”¨X.509è¯ä¹¦ä½œä¸ºèº«ä»½ï¼Œå¹¶é‡‡ç”¨ä¼ ç»Ÿçš„å…¬å…±å¯†é’¥åŸºç¡€ç»“æ„ï¼ˆPKIï¼‰å±‚æ¬¡æ¨¡å‹ï¼ˆç¨åå°†åœ¨PKIä¸Šè¿›è¡Œä»‹ç»ï¼‰ã€‚ A Simple Scenario to Explain the Use of an Identityï¼ˆé€šè¿‡ä¸€ä¸ªç®€å•çš„æ–¹æ¡ˆæ¥è§£é‡Šèº«ä»½è¯†åˆ«çš„ç”¨æ³•ï¼‰ Imagine that you visit a supermarket to buy some groceries. At the checkout you see a sign that says that only Visa, Mastercard and AMEX cards are accepted. If you try to pay with a different card â€” letâ€™s call it an â€œImagineCardâ€ â€” it doesnâ€™t matter whether the card is authentic and you have sufficient funds in your account. It will be not be accepted. æƒ³è±¡ä¸€ä¸‹ä½ å»ä¸€ä¸ªè¶…çº§å¸‚åœºå»ä¹°ä¸€äº›æ‚è´§ã€‚åœ¨ç»“è´¦æ—¶ä½ çœ‹åˆ°ä¸€ä¸ªæ ‡å¿—è¯´åªæ”¯æŒVisaã€Mastercardå’ŒAMEXé“¶è¡Œå¡ã€‚å¦‚æœä½ å°è¯•ä½¿ç”¨å…¶ä»–é“¶è¡Œå¡-è®©æˆ‘ä»¬å«å®ƒâ€œæƒ³è±¡çš„å¡ç‰‡â€-é“¶è¡Œå¡æ˜¯å¦çœŸå®å’Œå¸æˆ·ä¸­æ˜¯å¦æœ‰è¶³å¤Ÿçš„èµ„é‡‘éƒ½æ²¡å…³ç³»ã€‚å®ƒå°†ä¸è¢«æ¥å—ã€‚ Having a valid credit card is not enough â€” it must also be accepted by the store! PKIs and MSPs work together in the same way â€” a PKI provides a list of identities, and an MSP says which of these are members of a given organization that participates in the network. æ‹¥æœ‰ä¸€ä¸ªåˆæ³•çš„ä¿¡ç”¨å¡è¿˜ä¸å¤Ÿï¼Œä»–è¿˜å¿…é¡»è¢«å•†åº—æ¥å—ï¼PKIså’ŒMSPsä»¥ç›¸åŒçš„æ–¹å¼ä¸€èµ·å·¥ä½œ-PKIæä¾›äº†èº«ä»½è¯†åˆ«çš„åˆ—è¡¨ï¼ŒMSPæŒ‡å‡ºå…¶ä¸­çš„å“ªäº›æ˜¯å‚ä¸è¯¥ç½‘ç»œçš„ç»™å®šç»„ç»‡çš„æˆå‘˜ã€‚ PKI certificate authorities and MSPs provide a similar combination of functionalities. A PKI is like a card provider â€” it dispenses many different types of verifiable identities. An MSP, on the other hand, is like the list of card providers accepted by the store, determining which identities are the trusted members (actors) of the store payment network. MSPs turn verifiable identities into the members of a blockchain network. PKIè¯ä¹¦é¢å‘æœºæ„å’ŒMSPæä¾›äº†ç±»ä¼¼çš„åŠŸèƒ½ç»„åˆã€‚PKIå°±åƒé“¶è¡Œå¡å‘å¡ç»„ç»‡ä¸€æ ·ï¼Œå®ƒåˆ†é…è®¸å¤šä¸åŒç±»å‹çš„å¯éªŒè¯èº«ä»½ã€‚å¦ä¸€æ–¹é¢ï¼ŒMSPå°±åƒå•†åº—æ¥å—çš„å‘å¡ç»„ç»‡åˆ—è¡¨ä¸€æ ·ï¼Œç¡®å®šå“ªäº›èº«ä»½æ˜¯å•†åº—æ”¯ä»˜ç½‘ç»œçš„å—ä¿¡ä»»æˆå‘˜ï¼ˆå‚ä¸è€…ï¼‰ã€‚MSPå°†å¯éªŒè¯èº«ä»½è½¬æ¢ä¸ºåŒºå—é“¾ç½‘ç»œçš„æˆå‘˜ã€‚ Letâ€™s drill into these concepts in a little more detail. è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°ç ”ç©¶è¿™äº›æ¦‚å¿µã€‚ What are PKIs?ï¼ˆä»€ä¹ˆæ˜¯PKIsï¼Ÿï¼‰ A public key infrastructure (PKI) is a collection of internet technologies that provides secure communications in a network. Itâ€™s PKI that puts the S in HTTPS â€” and if youâ€™re reading this documentation on a web browser, youâ€™re probably using a PKI to make sure it comes from a verified source. å…¬é’¥åŸºç¡€ç»“æ„ï¼ˆPKIï¼‰æ˜¯ç½‘ç»œæŠ€æœ¯çš„é›†åˆï¼Œè¿™äº›æŠ€æœ¯åœ¨ç½‘ç»œä¸­æä¾›å®‰å…¨çš„é€šä¿¡ã€‚æ˜¯PKIå°†Sç½®äºHTTPSä¸­-å¦‚æœæ‚¨æ­£åœ¨ç½‘ç»œæµè§ˆå™¨ä¸Šé˜…è¯»æ­¤æ–‡æ¡£ï¼Œæ‚¨å¯èƒ½æ­£åœ¨ä½¿ç”¨PKIæ¥ç¡®ä¿å®ƒæ¥è‡ªç»è¿‡éªŒè¯çš„æ¥æºã€‚ The elements of Public Key Infrastructure (PKI). A PKI is comprised of Certificate Authorities who issue digital certificates to parties (e.g., users of a service, service provider), who then use them to authenticate themselves in the messages they exchange in their environment. A CAâ€™s Certificate Revocation List (CRL) constitutes a reference for the certificates that are no longer valid. Revocation of a certificate can happen for a number of reasons. For example, a certificate may be revoked because the cryptographic private material associated to the certificate has been exposed. å…¬é’¥åŸºç¡€ç»“æ„ï¼ˆPKIï¼‰çš„å…ƒç´ ã€‚PKIç”±è¯ä¹¦é¢å‘æœºæ„ç»„æˆï¼Œè¯ä¹¦é¢å‘æœºæ„å‘å„æ–¹é¢å‘æ•°å­—è¯ä¹¦ï¼Œç„¶åä»–ä»¬ä½¿ç”¨å®ƒä»¬åœ¨ç¯å¢ƒä¸­äº¤æ¢çš„æ¶ˆæ¯ä¸­å¯¹è‡ªå·±è¿›è¡Œèº«ä»½éªŒè¯ã€‚CAçš„è¯ä¹¦åŠé”€åˆ—è¡¨ï¼ˆCRLï¼‰æ„æˆäº†ä¸å†æœ‰æ•ˆçš„è¯ä¹¦çš„å‚è€ƒã€‚åŠé”€è¯ä¹¦çš„åŸå› æœ‰å¾ˆå¤šã€‚ä¾‹å¦‚ï¼Œç”±äºä¸è¯ä¹¦å…³è”çš„åŠ å¯†ç§æœ‰ææ–™å·²è¢«æš´éœ²ï¼Œå› æ­¤è¯ä¹¦å¯èƒ½è¢«åŠé”€ã€‚ Although a blockchain network is more than a communications network, it relies on the PKI standard to ensure secure communication between various network participants, and to ensure that messages posted on the blockchain are properly authenticated. Itâ€™s therefore important to understand the basics of PKI and then why MSPs are so important. å°½ç®¡åŒºå—é“¾ç½‘ç»œä¸ä»…ä»…æ˜¯é€šä¿¡ç½‘ç»œï¼Œä½†å®ƒä¾èµ–äºPKIæ ‡å‡†æ¥ç¡®ä¿å„ç§ç½‘ç»œå‚ä¸è€…ä¹‹é—´çš„å®‰å…¨é€šä¿¡ï¼Œå¹¶ç¡®ä¿æ­£ç¡®éªŒè¯å‘å¸ƒåœ¨åŒºå—é“¾ä¸Šçš„æ¶ˆæ¯ã€‚å› æ­¤ï¼Œé‡è¦çš„æ˜¯è¦äº†è§£PKIçš„åŸºç¡€çŸ¥è¯†ï¼Œç„¶åç†è§£MSPä¸ºä½•å¦‚æ­¤é‡è¦ã€‚ There are four key elements to PKIï¼ŒPKIæœ‰å››ä¸ªå…³é”®å…ƒç´ : Digital Certificatesï¼ˆæ•°å­—è¯ä¹¦ï¼‰ Public and Private Keysï¼ˆå…¬ç§é’¥å¯¹ï¼‰ Certificate Authoritiesï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰ Certificate Revocation Listsï¼ˆè¯ä¹¦åŠé”€åˆ—è¡¨ï¼‰ Letâ€™s quickly describe these PKI basics, and if you want to know more details, Wikipedia is a good place to start. è®©æˆ‘ä»¬å¿«é€Ÿä»‹ç»ä¸€ä¸‹è¿™äº›PKIåŸºç¡€çŸ¥è¯†ï¼Œå¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œé‚£ä¹ˆPublic_key_infrastructureæ˜¯ä¸€ä¸ªä¸é”™çš„èµ·ç‚¹ã€‚ Digital Certificates(æ•°å­—è¯ä¹¦) A digital certificate is a document which holds a set of attributes relating to the holder of the certificate. The most common type of certificate is the one compliant with the X.509 standard, which allows the encoding of a partyâ€™s identifying details in its structure. æ•°å­—è¯ä¹¦æ˜¯ä¸€ç§æ–‡æ¡£ï¼Œå…¶ä¸­åŒ…å«ä¸è¯ä¹¦æŒæœ‰è€…æœ‰å…³çš„ä¸€ç»„å±æ€§ã€‚æœ€å¸¸è§çš„è¯ä¹¦ç±»å‹æ˜¯ç¬¦åˆX.509æ ‡å‡†çš„è¯ä¹¦ï¼Œè¯¥è¯ä¹¦å…è®¸åœ¨å…¶ç»“æ„ä¸­å¯¹å‚ä¸æ–¹çš„æ ‡è¯†è¯¦ç»†ä¿¡æ¯è¿›è¡Œç¼–ç ã€‚ For example, Mary Morris in the Manufacturing Division of Mitchell Cars in Detroit, Michigan might have a digital certificate with a SUBJECT attribute of C=US, ST=Michigan, L=Detroit, O=Mitchell Cars, OU=Manufacturing, CN=Mary Morris /UID=123456. Maryâ€™s certificate is similar to her government identity card â€” it provides information about Mary which she can use to prove key facts about her. There are many other attributes in an X.509 certificate, but letâ€™s concentrate on just these for now. ä¾‹å¦‚ï¼Œåº•ç‰¹å¾‹Mitchellæ±½è½¦åˆ¶é€ éƒ¨é—¨çš„Mary Morrisï¼Œå¯†æ­‡æ ¹å·å¯èƒ½æœ‰ä¸€ä¸ªæ•°å­—è¯ä¹¦ï¼Œå…¶SUBJECTå±æ€§ä¸ºC = USï¼ŒST = Michiganï¼ŒL = Detroitï¼ŒO = Mitchell Carsï¼ŒOU = Manufacturingï¼ŒCN = Mary Morris / UID = 123456ã€‚Maryçš„è¯ä¹¦ç±»ä¼¼äºå¥¹çš„æ”¿åºœèº«ä»½è¯ï¼Œå®ƒæä¾›äº†æœ‰å…³ç›ä¸½çš„ä¿¡æ¯ï¼Œå¥¹å¯ä»¥ç”¨æ¥è¯æ˜æœ‰å…³å¥¹çš„å…³é”®äº‹å®ã€‚X.509è¯ä¹¦ä¸­è¿˜æœ‰è®¸å¤šå…¶ä»–å±æ€§ï¼Œä½†ç°åœ¨è®©æˆ‘ä»¬ä»…å…³æ³¨è¿™äº›å±æ€§ã€‚ A digital certificate describing a party called Mary Morris. Mary is the SUBJECT of the certificate, and the highlighted SUBJECT text shows key facts about Mary. The certificate also holds many more pieces of information, as you can see. Most importantly, Maryâ€™s public key is distributed within her certificate, whereas her private signing key is not. This signing key must be kept private. æ•°å­—è¯ä¹¦æè¿°äº†ä¸€ä¸ªå«åšMary Morrisçš„å½“äº‹äººï¼ŒMaryæ˜¯è¯ä¹¦çš„SUBJECT ï¼Œçªå‡ºæ˜¾ç¤ºçš„SUBJECT æ–‡æœ¬æ˜¾ç¤ºäº†æœ‰å…³Maryçš„å…³é”®äº‹å®ã€‚å¦‚æ‚¨æ‰€è§ï¼Œè¯¥è¯ä¹¦è¿˜åŒ…å«æ›´å¤šä¿¡æ¯ã€‚æœ€é‡è¦çš„æ˜¯ï¼ŒMaryçš„å…¬é’¥åœ¨è¯ä¹¦ä¸­æè¿°ï¼Œä½†æ˜¯ç§é’¥æ²¡æœ‰åœ¨è¯ä¹¦ä¸­ã€‚ç­¾åç”¨çš„ç§é’¥å¿…é¡»ä¿å¯†ã€‚ What is important is that all of Maryâ€™s attributes can be recorded using a mathematical technique called cryptography (literally, â€œsecret writingâ€) so that tampering will invalidate the certificate. Cryptography allows Mary to present her certificate to others to prove her identity so long as the other party trusts the certificate issuer, known as a Certificate Authority (CA). As long as the CA keeps certain cryptographic information securely (meaning, its own private signing key), anyone reading the certificate can be sure that the information about Mary has not been tampered with â€” it will always have those particular attributes for Mary Morris. Think of Maryâ€™s X.509 certificate as a digital identity card that is impossible to change. é‡è¦çš„æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨ç§°ä¸ºåŠ å¯†çš„æ•°å­¦æŠ€æœ¯æ¥è®°å½•Maryçš„æ‰€æœ‰å±æ€§ï¼Œä»¥å…ç¯¡æ”¹è¯ä¹¦ã€‚åªè¦å¯¹æ–¹ä¿¡ä»»è¯ä¹¦é¢å‘è€…ï¼ˆCertificate Authority (CA)ï¼‰ï¼Œå¯†ç å­¦å°±å¯ä»¥å…è®¸Maryå‘ä»–äººå‡ºç¤ºå¥¹çš„è¯ä¹¦ä»¥è¯æ˜è‡ªå·±çš„èº«ä»½ã€‚åªè¦CAå®‰å…¨åœ°ä¿å­˜æŸäº›åŠ å¯†ä¿¡æ¯ï¼ˆå³å…¶è‡ªå·±çš„ä¸“ç”¨ç­¾åå¯†é’¥ï¼‰ï¼Œä»»ä½•é˜…è¯»è¯ä¹¦çš„äººéƒ½å¯ä»¥ç¡®ä¿æœ‰å…³Maryçš„ä¿¡æ¯æœªè¢«ç¯¡æ”¹-å®ƒå§‹ç»ˆå…·æœ‰Mary Morrisçš„é‚£äº›ç‰¹å®šå±æ€§ã€‚å°†Maryçš„X.509è¯ä¹¦è§†ä¸ºæ— æ³•æ›´æ”¹çš„æ•°å­—èº«ä»½è¯ã€‚ Authentication, Public keys, and Private Keysï¼ˆè®¤è¯æ–¹å¼ï¼Œå…¬é’¥å’Œç§é’¥ï¼‰ Authentication and message integrity are important concepts in secure communications. Authentication requires that parties who exchange messages are assured of the identity that created a specific message. For a message to have â€œintegrityâ€ means that cannot have been modified during its transmission. For example, you might want to be sure youâ€™re communicating with the real Mary Morris rather than an impersonator. Or if Mary has sent you a message, you might want to be sure that it hasnâ€™t been tampered with by anyone else during transmission. èº«ä»½éªŒè¯å’Œæ¶ˆæ¯å®Œæ•´æ€§æ˜¯å®‰å…¨é€šä¿¡ä¸­çš„é‡è¦æ¦‚å¿µã€‚èº«ä»½éªŒè¯è¦æ±‚äº¤æ¢æ¶ˆæ¯çš„å„æ–¹ç¡®ä¿åˆ›å»ºäº†ç‰¹å®šæ¶ˆæ¯çš„èº«ä»½ã€‚æ¶ˆæ¯å…·æœ‰â€œå®Œæ•´æ€§â€æ„å‘³ç€ä¸èƒ½åœ¨å…¶ä¼ è¾“è¿‡ç¨‹ä¸­å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½è¦ç¡®ä¿ä¸çœŸå®çš„ç›ä¸½Â·è«é‡Œæ–¯ï¼ˆMary Morrisï¼‰è€Œéæ¨¡ä»¿è€…è¿›è¡Œäº¤æµã€‚æˆ–è€…å¦‚æœMaryå·²ç»ç»™ä½ å‘é€äº†ä¸€ä¸ªæ¶ˆæ¯ï¼Œä½ å¯èƒ½æƒ³è¦ç¡®ä¿åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«å…¶ä»–ä»»ä½•äººç¯¡æ”¹è¿‡è¯¥æ¶ˆæ¯ã€‚ Traditional authentication mechanisms rely on digital signatures that, as the name suggests, allow a party to digitally sign its messages. Digital signatures also provide guarantees on the integrity of the signed message. Technically speaking, digital signature mechanisms require each party to hold two cryptographically connected keys: a public key that is made widely available and acts as authentication anchor, and a private key that is used to produce digital signatures on messages. Recipients of digitally signed messages can verify the origin and integrity of a received message by checking that the attached signature is valid under the public key of the expected sender. The unique relationship between a private key and the respective public key is the cryptographic magic that makes secure communications possible. The unique mathematical relationship between the keys is such that the private key can be used to produce a signature on a message that only the corresponding public key can match, and only on the same message. In the example above, Mary uses her private key to sign the message. The signature can be verified by anyone who sees the signed message using her public key. Certificate Authoritiesï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰ As youâ€™ve seen, an actor or a node is able to participate in the blockchain network, via the means of a digital identity issued for it by an authority trusted by the system. In the most common case, digital identities (or simply identities) have the form of cryptographically validated digital certificates that comply with X.509 standard and are issued by a Certificate Authority (CA). CAs are a common part of internet security protocols, and youâ€™ve probably heard of some of the more popular ones: Symantec (originally Verisign), GeoTrust, DigiCert, GoDaddy, and Comodo, among others. A Certificate Authority dispenses certificates to different actors. These certificates are digitally signed by the CA and bind together the actor with the actorâ€™s public key (and optionally with a comprehensive list of properties). As a result, if one trusts the CA (and knows its public key), it can trust that the specific actor is bound to the public key included in the certificate, and owns the included attributes, by validating the CAâ€™s signature on the actorâ€™s certificate. Certificates can be widely disseminated, as they do not include either the actorsâ€™ nor the CAâ€™s private keys. As such they can be used as anchor of trusts for authenticating messages coming from different actors. CAs also have a certificate, which they make widely available. This allows the consumers of identities issued by a given CA to verify them by checking that the certificate could only have been generated by the holder of the corresponding private key (the CA). In a blockchain setting, every actor who wishes to interact with the network needs an identity. In this setting, you might say that one or more CAs can be used to define the members of an organizationâ€™s from a digital perspective. Itâ€™s the CA that provides the basis for an organizationâ€™s actors to have a verifiable digital identity. Root CAs, Intermediate CAs and Chains of Trustï¼ˆæ ¹CAã€ä¸­çº§CAå’Œä¿¡ä»»é“¾ï¼‰ CAs come in two flavors: Root CAs and Intermediate CAs. Because Root CAs (Symantec, Geotrust, etc) have to securely distribute hundreds of millions of certificates to internet users, it makes sense to spread this process out across what are called Intermediate CAs. These Intermediate CAs have their certificates issued by the root CA or another intermediate authority, allowing the establishment of a â€œchain of trustâ€ for any certificate that is issued by any CA in the chain. This ability to track back to the Root CA not only allows the function of CAs to scale while still providing security â€” allowing organizations that consume certificates to use Intermediate CAs with confidence â€” it limits the exposure of the Root CA, which, if compromised, would endanger the entire chain of trust. If an Intermediate CA is compromised, on the other hand, there will be a much smaller exposure. A chain of trust is established between a Root CA and a set of Intermediate CAs as long as the issuing CA for the certificate of each of these Intermediate CAs is either the Root CA itself or has a chain of trust to the Root CA. Intermediate CAs provide a huge amount of flexibility when it comes to the issuance of certificates across multiple organizations, and thatâ€™s very helpful in a permissioned blockchain system (like Fabric). For example, youâ€™ll see that different organizations may use different Root CAs, or the same Root CA with different Intermediate CAs â€” it really does depend on the needs of the network. Fabric CA Itâ€™s because CAs are so important that Fabric provides a built-in CA component to allow you to create CAs in the blockchain networks you form. This component â€” known as Fabric CA is a private root CA provider capable of managing digital identities of Fabric participants that have the form of X.509 certificates. Because Fabric CA is a custom CA targeting the Root CA needs of Fabric, it is inherently not capable of providing SSL certificates for general/automatic use in browsers. However, because some CA must be used to manage identity (even in a test environment), Fabric CA can be used to provide and manage certificates. It is also possible â€” and fully appropriate â€” to use a public/commercial root or intermediate CA to provide identification. å› ä¸ºCAéå¸¸é‡è¦ï¼Œæ‰€ä»¥Fabricæä¾›äº†å†…ç½®çš„CAç»„ä»¶ï¼Œå¯è®©æ‚¨åœ¨å½¢æˆçš„åŒºå—é“¾ç½‘ç»œä¸­åˆ›å»ºCAã€‚è¯¥ç»„ä»¶ï¼ˆç§°ä¸ºFabric CAï¼‰æ˜¯ç§æœ‰çš„æ ¹CAæä¾›è€…ï¼Œèƒ½å¤Ÿç®¡ç†å…·æœ‰X.509è¯ä¹¦å½¢å¼çš„Fabricå‚ä¸è€…çš„æ•°å­—èº«ä»½ã€‚ç”±äºFabric CAæ˜¯é’ˆå¯¹Fabricçš„æ ¹CAéœ€æ±‚çš„è‡ªå®šä¹‰CAï¼Œå› æ­¤å®ƒå›ºæœ‰åœ°æ— æ³•æä¾›SSLè¯ä¹¦ä¾›æµè§ˆå™¨ä¸­çš„å¸¸è§„/è‡ªåŠ¨ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œç”±äºå¿…é¡»ä½¿ç”¨æŸäº›CAæ¥ç®¡ç†èº«ä»½ï¼ˆå³ä½¿åœ¨æµ‹è¯•ç¯å¢ƒä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ï¼Œå› æ­¤å¯ä»¥å°†Fabric CAç”¨äºæä¾›å’Œç®¡ç†è¯ä¹¦ã€‚ä½¿ç”¨å…¬å…±/å•†ä¸šæ ¹æˆ–ä¸­é—´CAè¿›è¡Œæ ‡è¯†ä¹Ÿæ˜¯å¯èƒ½çš„ï¼Œå¹¶ä¸”æ˜¯å®Œå…¨åˆé€‚çš„ã€‚ If youâ€™re interested, you can read a lot more about Fabric CA in the CA documentation section. å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥ åœ¨the CA documentation sectionæ–‡æ¡£ä¸­é˜…è¯»æ›´å¤šçš„å…³äº Fabric CAçš„å†…å®¹ã€‚ Certificate Revocation Listsï¼ˆè¯ä¹¦åŠé”€åˆ—è¡¨ï¼‰ A Certificate Revocation List (CRL) is easy to understand â€” itâ€™s just a list of references to certificates that a CA knows to be revoked for one reason or another. If you recall the store scenario, a CRL would be like a list of stolen credit cards. When a third party wants to verify another partyâ€™s identity, it first checks the issuing CAâ€™s CRL to make sure that the certificate has not been revoked. A verifier doesnâ€™t have to check the CRL, but if they donâ€™t they run the risk of accepting a compromised identity. Using a CRL to check that a certificate is still valid. If an impersonator tries to pass a compromised digital certificate to a validating party, it can be first checked against the issuing CAâ€™s CRL to make sure itâ€™s not listed as no longer valid. Note that a certificate being revoked is very different from a certificate expiring. Revoked certificates have not expired â€” they are, by every other measure, a fully valid certificate. For more in-depth information about CRLs, click here. Now that youâ€™ve seen how a PKI can provide verifiable identities through a chain of trust, the next step is to see how these identities can be used to represent the trusted members of a blockchain network. Thatâ€™s where a Membership Service Provider (MSP) comes into play â€” it identifies the parties who are the members of a given organization in the blockchain network. To learn more about membership, check out the conceptual documentation on MSPs.","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"Key Concepts","slug":"åŒºå—é“¾/Hyperledger-Fabric/Key-Concepts","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/Key-Concepts/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"Identity","slug":"Identity","permalink":"https://guozhe001.github.io/tags/Identity/"}]},{"title":"The Ordering Service","slug":"blockchain/fabric/å…³é”®æ¦‚å¿µ/The-Ordering-Service","date":"2021-04-01T10:18:21.482Z","updated":"2021-04-01T10:18:21.483Z","comments":true,"path":"2021/04/01/blockchain/fabric/å…³é”®æ¦‚å¿µ/The-Ordering-Service/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/The-Ordering-Service/","excerpt":"","text":"æœ¬æ–‡æ¡£æ¥è‡ªThe Ordering Service,æœ‰æ‰€ç®€åŒ–ã€‚ What is ordering? Many distributed blockchains, such as Ethereum and Bitcoin, are not permissioned, which means that any node can participate in the consensus process, wherein transactions are ordered and bundled into blocks. Because of this fact, these systems rely on probabilistic consensus algorithms which eventually guarantee ledger consistency to a high degree of probability, but which are still vulnerable to divergent ledgers (also known as a ledger â€œforkâ€), where different participants in the network have a different view of the accepted order of transactions. è®¸å¤šçš„åˆ†å¸ƒå¼åŒºå—é“¾ç³»ç»Ÿï¼Œä¾‹å¦‚ä»¥å¤ªåŠå’Œæ¯”ç‰¹å¸éƒ½æ˜¯ä¸éœ€è¦è®¤å¯çš„ï¼›è¿™æ„å‘³ç€ä»»ä½•èŠ‚ç‚¹éƒ½å¯ä»¥å‚ä¸å…±è¯†è¿‡ç¨‹ï¼Œè¿™ä¸ªå…±è¯†å°±æ˜¯æŠŠäº¤æ˜“æ’åºå¹¶æ‰“åŒ…æˆåŒºå—ã€‚ç”±äºè¿™ä¸ªäº‹å®ï¼Œè¿™äº›ç³»ç»Ÿä¾èµ–äºæ¦‚ç‡å…±è¯†ç®—æ³•ï¼ˆç›®å‰æ˜¯Powå…±è¯†ç®—æ³•ï¼‰ï¼Œè¯¥ç®—æ³•æœ€ç»ˆå¯ä»¥ç¡®ä¿åˆ†ç±»å¸çš„ä¸€è‡´æ€§å…·æœ‰å¾ˆé«˜çš„æ¦‚ç‡ï¼Œä½†æ˜¯å®ƒä»¬ä»ç„¶å®¹æ˜“æ”¶åˆ°åˆ†å‰çš„å½±å“ï¼Œåœ¨åˆ†å‰çš„åˆ†ç±»è´¦ä¸­ï¼Œç½‘ç»œä¸­çš„ä¸åŒå‚ä¸è€…å¯¹æ¥å—çš„äº¤æ˜“é¡ºåºæœ‰ä¸åŒçš„çœ‹æ³•ã€‚ Hyperledger Fabric works differently. It features a node called an orderer (itâ€™s also known as an â€œordering nodeâ€) that does this transaction ordering, which along with other orderer nodes forms an ordering service. Because Fabricâ€™s design relies on deterministic consensus algorithms, any block validated by the peer is guaranteed to be final and correct. Ledgers cannot fork the way they do in many other distributed and permissionless blockchain networks. Hyperledger Fabricçš„å·¥ä½œæ–¹å¼æœ‰æ‰€ä¸åŒã€‚å®ƒå…·æœ‰ä¸€ä¸ªç§°ä¸ºâ€œæ’åºè€…â€çš„èŠ‚ç‚¹ï¼ˆä¹Ÿç§°ä¸ºâ€œæ’åºèŠ‚ç‚¹â€ï¼‰æ¥æ‰§è¡Œæ­¤äº¤æ˜“çš„æ’åºï¼Œè¯¥èŠ‚ç‚¹ä¸å…¶ä»–æ’åºèŠ‚ç‚¹ä¸€èµ·æ„æˆæ’åºæœåŠ¡ã€‚ç”±äºFabricçš„è®¾è®¡ä¾èµ–äºç¡®å®šæ€§å…±è¯†ç®—æ³•ï¼Œå› æ­¤å¯ä»¥ä¿è¯peeréªŒè¯çš„ä»»ä½•å—éƒ½æ˜¯æœ€ç»ˆçš„å’Œæ­£ç¡®çš„ã€‚è´¦æœ¬ä¹Ÿä¸ä¼šåƒä»¥å¤ªåŠå’Œæ¯”ç‰¹å¸é‚£æ ·å‡ºç°åˆ†å‰ã€‚ In addition to promoting finality, separating the endorsement of chaincode execution (which happens at the peers) from ordering gives Fabric advantages in performance and scalability, eliminating bottlenecks which can occur when execution and ordering are performed by the same nodes. é™¤äº†ä¿ƒè¿›ä¸å¯å˜æ€§ä¹‹å¤–ï¼Œå°†é“¾ç æ‰§è¡Œçš„èƒŒä¹¦ï¼ˆåœ¨åŒçº§ä¸­å‘ç”Ÿï¼‰ä¸æ’åºåˆ†å¼€å¯ä»¥ä½¿Fabricåœ¨æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§æ–¹é¢å…·æœ‰ä¼˜åŠ¿ï¼Œæ¶ˆé™¤äº†ç”±ç›¸åŒèŠ‚ç‚¹æ‰§è¡Œå’Œæ’åºæ—¶å¯èƒ½å‘ç”Ÿçš„ç“¶é¢ˆã€‚ Orderer nodes and channel configuration In addition to their ordering role, orderers also maintain the list of organizations that are allowed to create channels. This list of organizations is known as the â€œconsortiumâ€, and the list itself is kept in the configuration of the â€œorderer system channelâ€ (also known as the â€œordering system channelâ€). By default, this list, and the channel it lives on, can only be edited by the orderer admin. Note that it is possible for an ordering service to hold several of these lists, which makes the consortium a vehicle for Fabric multi-tenancy. é™¤äº†ä½œä¸ºæ’åºçš„è§’è‰²ä¹‹å¤–ï¼Œorderersè¿˜ç»´æŠ¤å…è®¸åˆ›å»ºé€šé“çš„ç»„ç»‡çš„åˆ—è¡¨ã€‚è¿™ä¸ªç»„ç»‡çš„åˆ—è¡¨è¢«ç§°ä¸ºâ€œè”ç›Ÿâ€ï¼Œå¹¶ä¸”è¿™ä¸ªåˆ—è¡¨è¢«ä¿å­˜åœ¨ â€œorderer system channelâ€ çš„é…ç½®ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤åˆ—è¡¨åŠå…¶æ‰€å¤„çš„é€šé“åªèƒ½ç”±ordererçš„ç®¡ç†å‘˜è¿›è¡Œç¼–è¾‘ã€‚ Orderers also enforce basic access control for channels, restricting who can read and write data to them, and who can configure them. Remember that who is authorized to modify a configuration element in a channel is subject to the policies that the relevant administrators set when they created the consortium or the channel. Configuration transactions are processed by the orderer, as it needs to know the current set of policies to execute its basic form of access control. In this case, the orderer processes the configuration update to make sure that the requestor has the proper administrative rights. If so, the orderer validates the update request against the existing configuration, generates a new configuration transaction, and packages it into a block that is relayed to all peers on the channel. The peers then process the configuration transactions in order to verify that the modifications approved by the orderer do indeed satisfy the policies defined in the channel. Orderersè¿˜å¯¹é€šé“å®æ–½åŸºæœ¬è®¿é—®æ§åˆ¶ï¼Œé™åˆ¶è°å¯ä»¥å‘é€šé“è¯»å–å’Œå†™å…¥æ•°æ®ä»¥åŠè°å¯ä»¥å¯¹å…¶è¿›è¡Œé…ç½®ã€‚ Orderer nodes and identity Everything that interacts with a blockchain network, including peers, applications, admins, and orderers, acquires their organizational identity from their digital certificate and their Membership Service Provider (MSP) definition. For more information about identities and MSPs, check out our documentation on Identity and Membership. Just like peers, ordering nodes belong to an organization. And similar to peers, a separate Certificate Authority (CA) should be used for each organization. Whether this CA will function as the root CA, or whether you choose to deploy a root CA and then intermediate CAs associated with that root CA, is up to you. Orderers and the transaction flow Phase one: Proposal Weâ€™ve seen from our topic on Peers that they form the basis for a blockchain network, hosting ledgers, which can be queried and updated by applications through smart contracts. Specifically, applications that want to update the ledger are involved in a process with three phases that ensures all of the peers in a blockchain network keep their ledgers consistent with each other. å…·ä½“æ¥è¯´ï¼Œåº”ç”¨ç¨‹åºæƒ³è¦æ›´æ–°è´¦æœ¬éœ€è¦æ¶‰åŠä¸‰ä¸ªé˜¶æ®µçš„è¿‡ç¨‹æ¥ç¡®ä¿åŒºå—é“¾ç½‘ç»œä¸­çš„æ‰€æœ‰peerèŠ‚ç‚¹ä¿æŒè´¦æœ¬å½¼æ­¤ä¸€è‡´ã€‚ In the first phase, a client application sends a transaction proposal to a subset of peers that will invoke a smart contract to produce a proposed ledger update and then endorse the results. The endorsing peers do not apply the proposed update to their copy of the ledger at this time. Instead, the endorsing peers return a proposal response to the client application. The endorsed transaction proposals will ultimately be ordered into blocks in phase two, and then distributed to all peers for final validation and commit in phase three. åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µä¸­ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå°†äº¤æ˜“å»ºè®®å‘é€ç»™ä¸€äº›peerèŠ‚ç‚¹ï¼Œè¿™äº›peerèŠ‚ç‚¹å°†è°ƒç”¨æ™ºèƒ½åˆçº¦ä»¥äº§ç”Ÿæè®®çš„è´¦æœ¬æ›´æ–°ï¼Œç„¶åå¯¹ç»“æœè¿›è¡ŒèƒŒä¹¦ã€‚èƒŒä¹¦çš„peerèŠ‚ç‚¹æ­¤æ—¶ä¸å°†å»ºè®®çš„æ›´æ–°åº”ç”¨äºå…¶è´¦æœ¬å‰¯æœ¬ã€‚ç›¸åï¼ŒèƒŒä¹¦çš„å¯¹ç­‰æ–¹å°†æè®®å“åº”è¿”å›åˆ°å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚ç„¶åè®¤å¯çš„äº¤æ˜“å»ºè®®å°†æœ€ç»ˆåœ¨ç¬¬äºŒé˜¶æ®µæŒ‰é¡ºåºæ’åˆ—ï¼Œç„¶ååˆ†å‘ç»™æ‰€æœ‰peerèŠ‚ç‚¹ä»¥è¿›è¡Œæœ€ç»ˆéªŒè¯å¹¶åœ¨ç¬¬ä¸‰é˜¶æ®µè¿›è¡Œæäº¤ã€‚ For an in-depth look at the first phase, refer back to the Peers topic. Phase two: Ordering and packaging transactions into blocks After the completion of the first phase of a transaction, a client application has received an endorsed transaction proposal response from a set of peers. Itâ€™s now time for the second phase of a transaction. åœ¨å®Œæˆäº¤æ˜“çš„ç¬¬ä¸€é˜¶æ®µä¹‹åï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå·²ç»æ¥æ”¶åˆ°æ¥è‡ªä¸€ç¾¤peerèŠ‚ç‚¹çš„å·²ç»èƒŒä¹¦çš„äº¤æ˜“æè®®å“åº”ã€‚*** In this phase, application clients submit transactions containing endorsed transaction proposal responses to an ordering service node. The ordering service creates blocks of transactions which will ultimately be distributed to all peers on the channel for final validation and commit in phase three. åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæäº¤åŒ…å«å·²ç»èƒŒä¹¦çš„äº¤æ˜“æè®®å“åº”çš„äº¤æ˜“åˆ°ä¸€ä¸ªæ’åºæœåŠ¡èŠ‚ç‚¹ã€‚æ’åºæœåŠ¡åˆ›å»ºåŒ…å«äº¤æ˜“çš„åŒºå—ï¼Œè¿™ä¸ªåŒºå—æœ€ç»ˆå°†åˆ†å‘ç»™é€šé“ä¸Šçš„æ‰€æœ‰peerèŠ‚ç‚¹ï¼Œä»¥è¿›è¡Œæœ€ç»ˆéªŒè¯å¹¶åœ¨ç¬¬ä¸‰é˜¶æ®µè¿›è¡Œæäº¤ã€‚ Ordering service nodes receive transactions from many different application clients concurrently. These ordering service nodes work together to collectively form the ordering service. Its job is to arrange batches of submitted transactions into a well-defined sequence and package them into blocks. These blocks will become the blocks of the blockchain! æ’åºæœåŠ¡èŠ‚ç‚¹åŒæ—¶æ¥æ”¶æ¥è‡ªè®¸å¤šä¸åŒåº”ç”¨ç¨‹åºå®¢æˆ·ç«¯çš„äº¤æ˜“ã€‚è¿™äº›æ’åºæœåŠ¡èŠ‚ç‚¹ä¸€èµ·å·¥ä½œä»¥å…±åŒå½¢æˆæ’åºæœåŠ¡ã€‚æ’åºæœåŠ¡çš„å·¥ä½œæ˜¯å¯¹æäº¤è¿‡æ¥çš„æ‰¹é‡çš„äº¤æ˜“å®‰æ’ä¸€ä¸ªæ˜ç¡®å®šä¹‰çš„é¡ºåºï¼Œå¹¶å°†å®ƒä»¬æ‰“åŒ…æˆåŒºå—ã€‚è¿™äº›åŒºå—å°†æˆä¸ºåŒºå—é“¾çš„åŒºå—ï¼ The number of transactions in a block depends on channel configuration parameters related to the desired size and maximum elapsed duration for a block (BatchSize and BatchTimeout parameters, to be exact). The blocks are then saved to the ordererâ€™s ledger and distributed to all peers that have joined the channel. If a peer happens to be down at this time, or joins the channel later, it will receive the blocks after reconnecting to an ordering service node, or by gossiping with another peer. Weâ€™ll see how this block is processed by peers in the third phase. åŒºå—ä¸­çš„äº¤æ˜“æ•°é‡å–å†³äºé€šé“é…ç½®å‚æ•°ï¼Œä¸åŒºå—çš„æ‰€éœ€å¤§å°å’Œæœ€å¤§ç»è¿‡æ—¶é—´æœ‰å…³ï¼ˆæ›´ç²¾ç¡®çš„è¯´æ˜¯BatchSize å’Œ BatchTimeout ä¸¤ä¸ªå‚æ•°ï¼‰ã€‚ç„¶åè¿™ä¸ªåŒºå—è¢«ä¿å­˜åˆ°æ’åºè€…çš„è´¦æœ¬ä¸­å¹¶åˆ†å‘ç»™åŠ å…¥åˆ°é€šé“çš„æ‰€æœ‰peerèŠ‚ç‚¹ã€‚å¦‚æœæŸä¸ªpeerèŠ‚ç‚¹åœ¨è¿™æ—¶å‘ç”Ÿäº†å®•æœºæˆ–è€…åœ¨è¿™ä»¥ååŠ å…¥åˆ°é€šé“ï¼Œä»–ä¼šåœ¨é‡æ–°è¿æ¥åˆ°æ’åºæœåŠ¡èŠ‚ç‚¹ä¹‹åæ”¶åˆ°æ­¤åŒºå—ï¼Œæˆ–è€…é€šè¿‡gossipingä»å…¶ä»–peerè·å–ã€‚ The first role of an ordering node is to package proposed ledger updates. In this example, application A1 sends a transaction T1 endorsed by E1 and E2 to the orderer O1. In parallel, Application A2 sends transaction T2 endorsed by E1 to the orderer O1. O1 packages transaction T1 from application A1 and transaction T2 from application A2 together with other transactions from other applications in the network into block B2. We can see that in B2, the transaction order is T1,T2,T3,T4,T6,T5 â€“ which may not be the order in which these transactions arrived at the orderer! (This example shows a very simplified ordering service configuration with only one ordering node.) æ’åºèŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªè§’è‰²æ—¶æ‰“åŒ…æè®®çš„è´¦æœ¬æ›´æ–°ã€‚ Itâ€™s worth noting that the sequencing of transactions in a block is not necessarily the same as the order received by the ordering service, since there can be multiple ordering service nodes that receive transactions at approximately the same time. Whatâ€™s important is that the ordering service puts the transactions into a strict order, and peers will use this order when validating and committing transactions. å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ªåŒºå—ä¸­çš„äº¤æ˜“é¡ºåºä¸ä¸€å®šä¸æ’åºæœåŠ¡æ‰€æ¥æ”¶çš„è®¢å•é¡ºåºç›¸åŒï¼Œå› ä¸ºå¯èƒ½æœ‰å¤šä¸ªæ’åºæœåŠ¡èŠ‚ç‚¹å¤§çº¦åœ¨åŒä¸€æ—¶é—´æ¥æ”¶äº¤æ˜“ã€‚é‡è¦çš„æ˜¯æ’åºæœåŠ¡å°†äº¤æ˜“ç½®äºä¸¥æ ¼çš„é¡ºåºä¸­ï¼Œå¹¶ä¸”peerèŠ‚ç‚¹åœ¨éªŒè¯å’Œæäº¤äº¤æ˜“æ—¶å°†ä½¿ç”¨è¯¥é¡ºåºã€‚ ä¸ªäººç†è§£ï¼šçœ‹ç¬¬ä¸€éæ—¶è§‰å¾—å¤šä¸ªæ’åºæœåŠ¡èŠ‚ç‚¹æ”¶åˆ°ä¸åŒçš„äº¤æ˜“è¿›è¡Œæ’åºï¼Œè¿™äº›æ’åºæœåŠ¡æ˜¯å¦‚ä½•ä¿æŒäº¤æ˜“é¡ºåºçš„ä¸€è‡´æ€§çš„å‘¢ï¼Ÿå¦‚æœæŠŠæ’åºæœåŠ¡çœ‹ä½œä¸€ä¸ªæ•´ä½“è¿™ä¸ªé—®é¢˜å°±è§£å†³äº†ï¼Œä¸åŒçš„æ’åºæœåŠ¡èŠ‚ç‚¹æ¥æ”¶åˆ°äº¤æ˜“ä¹‹åè¿˜ä¼šå¯¹æ‰€æœ‰çš„æ¥æ”¶åˆ°çš„äº¤æ˜“åšä¸€ä¸ªæ±‡æ€»ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªæ’åºæœåŠ¡èŠ‚ç‚¹éƒ½å¯¹äº¤æ˜“è¿›è¡Œæ’åºã€‚å†µä¸”æ¯ä¸ªæ’åºæœåŠ¡èŠ‚ç‚¹åªæ˜¯æ¥æ”¶è¿æ¥åˆ°è¿™ä¸ªæ’åºæœåŠ¡èŠ‚ç‚¹çš„åº”ç”¨ç¨‹åºçš„äº¤æ˜“ï¼Œæ‰€ä»¥æ¥æ”¶åˆ°çš„äº¤æ˜“å¹¶ä¸æ˜¯æ•´ä¸ªé€šé“ä¸Šçš„æ‰€æœ‰çš„äº¤æ˜“å†…å®¹ï¼Œå› æ­¤è‚¯å®šæ˜¯ä¸èƒ½å¤Ÿç”±æ’åºæœåŠ¡èŠ‚ç‚¹è¿›è¡Œå•ç‹¬æ’åºçš„ã€‚ This strict ordering of transactions within blocks makes Hyperledger Fabric a little different from other blockchains where the same transaction can be packaged into multiple different blocks that compete to form a chain. In Hyperledger Fabric, the blocks generated by the ordering service are final. Once a transaction has been written to a block, its position in the ledger is immutably assured. As we said earlier, Hyperledger Fabricâ€™s finality means that there are no ledger forks â€” validated transactions will never be reverted or dropped. è¿™ç§åŒºå—å†…çš„äº¤æ˜“å…·æœ‰ä¸¥æ ¼çš„é¡ºåºä½¿Hyperledger Fabricå’Œå…¶ä»–çš„åŒºå—é“¾ç³»ç»Ÿæœ‰ä¸€ç‚¹ä¸åŒï¼Œå…¶ä»–çš„åŒºå—é“¾ç³»ç»Ÿç›¸åŒçš„äº¤æ˜“å¯ä»¥è¢«æ‰“åŒ…åˆ°ä¸åŒåŒºå—ä¸­ç„¶åç«äº‰å½¢æˆä¸€ä¸ªé“¾ã€‚åœ¨ Hyperledger Fabricä¸­ï¼Œç”±æ’åºæœåŠ¡ç”Ÿæˆçš„åŒºå—æ˜¯æœ€ç»ˆçš„ã€‚ä¸€æ—¦ä¸€ä¸ªäº¤æ˜“è¢«å†™å…¥ä¸€ä¸ªåŒºå—ï¼Œå®ƒåœ¨è´¦æœ¬ä¸­çš„ä½ç½®å°±æ°¸è¿œä¸å˜äº†ã€‚åƒæˆ‘ä»¬ä¹‹å‰è¯´çš„ï¼Œ Hyperledger Fabricçš„æœ€ç»ˆæ€§æ„å‘³ç€æ²¡æœ‰è´¦æœ¬åˆ†å‰ â€“ ç»éªŒè¯çš„äº¤æ˜“å°†æ°¸è¿œä¸ä¼šè¢«å›æ»šæˆ–ä¸¢å¼ƒã€‚ We can also see that, whereas peers execute smart contracts and process transactions, orderers most definitely do not. Every authorized transaction that arrives at an orderer is mechanically packaged in a block â€” the orderer makes no judgement as to the content of a transaction (except for channel configuration transactions, as mentioned earlier). æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ï¼ŒpeerèŠ‚ç‚¹æ‰§è¡Œæ™ºèƒ½åˆçº¦å¹¶å¤„ç†äº¤æ˜“ï¼Œè€Œæ’åºè€…ç»å¯¹ä¸ä¼šåšè¿™äº›ã€‚åˆ°è¾¾æ’åºè€…çš„æ¯ç¬”å·²ç»æˆæƒäº¤æ˜“ä»¥æœºæ¢°æ–¹å¼æ‰“åŒ…åœ¨ä¸€ä¸ªåŒºå—ä¸­ â€“ æ’åºè€…ä¸å¯¹äº¤æ˜“çš„å†…å®¹åšå‡ºåˆ¤æ–­ï¼ˆé™¤äº†å‰é¢æ‰€è¿°çš„é€šé“é…ç½®äº¤æ˜“ï¼‰ã€‚ At the end of phase two, we see that orderers have been responsible for the simple but vital processes of collecting proposed transaction updates, ordering them, and packaging them into blocks, ready for distribution. åœ¨ç¬¬äºŒé˜¶æ®µçš„æœ€åï¼Œæˆ‘ä»¬çœ‹åˆ°æ’åºè€…è´Ÿè´£ç®€å•ä½†è‡³å…³é‡è¦çš„è¿‡ç¨‹ï¼Œè¿™äº›è¿‡ç¨‹åŒ…æ‹¬æ”¶é›†æè®®çš„äº¤æ˜“æ›´æ–°ï¼Œè¿›è¡Œæ’åºå¹¶å°†å®ƒä»¬æ‰“åŒ…æˆåŒºå—ä»¥ä¾¿åˆ†å‘ã€‚ Phase three: Validation and commit The third phase of the transaction workflow involves the distribution and subsequent validation of blocks from the orderer to the peers, where they can be committed to the ledger. Phase 3 begins with the orderer distributing blocks to all peers connected to it. Itâ€™s also worth noting that not every peer needs to be connected to an orderer â€” peers can cascade blocks to other peers using the gossip protocol. Each peer will validate distributed blocks independently, but in a deterministic fashion, ensuring that ledgers remain consistent. Specifically, each peer in the channel will validate each transaction in the block to ensure it has been endorsed by the required organizationâ€™s peers, that its endorsements match, and that it hasnâ€™t become invalidated by other recently committed transactions which may have been in-flight when the transaction was originally endorsed. Invalidated transactions are still retained in the immutable block created by the orderer, but they are marked as invalid by the peer and do not update the ledgerâ€™s state. The second role of an ordering node is to distribute blocks to peers. In this example, orderer O1 distributes block B2 to peer P1 and peer P2. Peer P1 processes block B2, resulting in a new block being added to ledger L1 on P1. In parallel, peer P2 processes block B2, resulting in a new block being added to ledger L1 on P2. Once this process is complete, the ledger L1 has been consistently updated on peers P1 and P2, and each may inform connected applications that the transaction has been processed. In summary, phase three sees the blocks generated by the ordering service applied consistently to the ledger. The strict ordering of transactions into blocks allows each peer to validate that transaction updates are consistently applied across the blockchain network. For a deeper look at phase 3, refer back to the Peers topic. Ordering service implementations While every ordering service currently available handles transactions and configuration updates the same way, there are nevertheless several different implementations for achieving consensus on the strict ordering of transactions between ordering service nodes. å½“å‰å¯ç”¨çš„æ¯ä¸ªæ’åºæœåŠ¡éƒ½ä»¥ç›¸åŒçš„æ–¹å¼å¤„ç†äº¤æ˜“å’Œé…ç½®æ›´æ–°ï¼Œä½†æ˜¯æœ‰å‡ ç§ä¸åŒçš„å®ç°æ–¹å¼å¯ç”¨äºåœ¨æ’åºæœåŠ¡èŠ‚ç‚¹ä¹‹é—´å¯¹ä¸¥æ ¼çš„äº¤æ˜“é¡ºåºè¾¾æˆå…±è¯†ã€‚ For information about how to stand up an ordering node (regardless of the implementation the node will be used in), check out our documentation on standing up an ordering node. Raft (recommended) New as of v1.4.1, Raft is a crash fault tolerant (CFT) ordering service based on an implementation of Raft protocol in etcd. Raft follows a â€œleader and followerâ€ model, where a leader node is elected (per channel) and its decisions are replicated by the followers. Raft ordering services should be easier to set up and manage than Kafka-based ordering services, and their design allows different organizations to contribute nodes to a distributed ordering service. è‡ªv1.4.1èµ·æ–°å¢ï¼ŒRaftæ˜¯åŸºäºetcdçš„ Raft åè®® å®ç°çš„æ•…éšœå®¹é”™æ’åºæœåŠ¡ã€‚Raftéµä»â€œé¢†å¯¼è€…å’Œè·Ÿéšè€…â€æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹æ˜¯é¢†å¯¼è€…èŠ‚ç‚¹ï¼ˆæŒ‰é€šé“ï¼‰è¢«é€‰å‡ºå¹¶ç”±è·Ÿéšè€…å¤åˆ¶å…¶å†³ç­–ã€‚Raftåè®®æ’åºæœåŠ¡ç›¸è¾ƒäºåŸºäºKafkaçš„æ’åºæœåŠ¡æ›´å®¹æ˜“è®¾ç½®å’Œç®¡ç†ï¼Œå…¶è®¾è®¡å…è®¸ä¸åŒçš„ç»„ç»‡å°†èŠ‚ç‚¹è´¡çŒ®ç»™åˆ†å¸ƒå¼æ’åºæœåŠ¡ã€‚ï¼ˆä¸ªäººç†è§£æœ€åä¸€å¥è¯æ˜¯è¯´æ’åºæœåŠ¡æ˜¯ç”±ä¸åŒç»„ç»‡çš„æ’åºæœåŠ¡èŠ‚ç‚¹ç»„æˆï¼‰ Kafka (deprecated in v2.x) Similar to Raft-based ordering, Apache Kafka is a CFT implementation that uses a â€œleader and followerâ€ node configuration. Kafka utilizes a ZooKeeper ensemble for management purposes. The Kafka based ordering service has been available since Fabric v1.0, but many users may find the additional administrative overhead of managing a Kafka cluster intimidating or undesirable. ä¸åŸºäºRaftçš„æ’åºç±»ä¼¼ï¼ŒApache Kafkaæ˜¯ä½¿ç”¨â€œé¢†å¯¼è€…å’Œè·Ÿéšè€…â€èŠ‚ç‚¹é…ç½®çš„CFTå®ç°ã€‚Kafkaåˆ©ç”¨ZooKeeperé›†åˆè¿›è¡Œç®¡ç†ã€‚ä»Fabric v1.0å¼€å§‹æä¾›åŸºäºKafkaçš„æ’åºæœåŠ¡ï¼Œä½†æ˜¯è®¸å¤šç”¨æˆ·å¯èƒ½ä¼šå‘ç°ç®¡ç†Kafkaç¾¤é›†çš„é¢å¤–ç®¡ç†å¼€é”€ä»¤äººç”Ÿç•æˆ–ä¸å—æ¬¢è¿ã€‚ Solo (deprecated in v2.x) The Solo implementation of the ordering service is intended for test only and consists only of a single ordering node. It has been deprecated and may be removed entirely in a future release. Existing users of Solo should move to a single node Raft network for equivalent function. æ’åºæœåŠ¡çš„Soloå®ç°ä»…ç”¨äºæµ‹è¯•ï¼Œå¹¶ä¸”ä»…åŒ…å«ä¸€ä¸ªè®¢è´­èŠ‚ç‚¹ã€‚å®ƒå·²è¢«å¼ƒç”¨ï¼Œåœ¨å°†æ¥çš„å‘è¡Œç‰ˆä¸­å¯èƒ½ä¼šå®Œå…¨åˆ é™¤ã€‚Soloçš„ç°æœ‰ç”¨æˆ·åº”ç§»è‡³å•èŠ‚ç‚¹Raftç½‘ç»œä»¥å®ç°ç­‰æ•ˆåŠŸèƒ½ã€‚ Raft For information on how to configure a Raft ordering service, check out our documentation on configuring a Raft ordering service. The go-to ordering service choice for production networks, the Fabric implementation of the established Raft protocol uses a â€œleader and followerâ€ model, in which a leader is dynamically elected among the ordering nodes in a channel (this collection of nodes is known as the â€œconsenter setâ€), and that leader replicates messages to the follower nodes. Because the system can sustain the loss of nodes, including leader nodes, as long as there is a majority of ordering nodes (whatâ€™s known as a â€œquorumâ€) remaining, Raft is said to be â€œcrash fault tolerantâ€ (CFT). In other words, if there are three nodes in a channel, it can withstand the loss of one node (leaving two remaining). If you have five nodes in a channel, you can lose two nodes (leaving three remaining nodes). This feature of a Raft ordering service is a factor in the establishment of a high availability strategy for your ordering service. Additionally, in a production environment, you would want to spread these nodes across data centers and even locations. For example, by putting one node in three different data centers. That way, if a data center or entire location becomes unavailable, the nodes in the other data centers continue to operate. ç”Ÿäº§ç½‘ç»œçš„é¦–é€‰æ’åºæœåŠ¡å®ç°æ–¹å¼ï¼ŒFabricä¸­å·²å»ºç«‹çš„Raftåè®®çš„å®ç°æ˜¯ä½¿ç”¨â€œé¢†å¯¼è€…å’Œè·Ÿéšè€…â€æ¨¡å‹ï¼Œå…¶ä¸­é¢†å¯¼è€…æ˜¯åœ¨é€šé“ä¸­çš„æ’åºèŠ‚ç‚¹ä¹‹é—´åŠ¨æ€é€‰ä¸¾çš„ï¼ˆè¯¥èŠ‚ç‚¹é›†åˆç§°ä¸ºâ€œåŒæ„è€…é›†â€ï¼‰ï¼Œé¢†å¯¼è€…å°†æ¶ˆæ¯å¤åˆ¶åˆ°è·Ÿéšè€…èŠ‚ç‚¹ã€‚å› ä¸ºç³»ç»Ÿå¯ä»¥æ‰¿å—åŒ…æ‹¬é¢†å¯¼èŠ‚ç‚¹åœ¨å†…çš„èŠ‚ç‚¹çš„ä¸¢å¤±ï¼Œæ‰€ä»¥åªè¦å‰©ä¸‹å¤§å¤šæ•°æ’åºèŠ‚ç‚¹ï¼ˆæ‰€è°“çš„â€œæ³•å®šäººæ•°â€ï¼‰å³å¯ï¼Œå› æ­¤Raftè¢«ç§°ä¸ºâ€œæ•…éšœå®¹é”™â€ï¼ˆCFTï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœé€šé“ä¸­æœ‰ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥æ‰¿å—ä¸€ä¸ªèŠ‚ç‚¹çš„æŸå¤±ï¼ˆå‰©ä¸‹ä¸¤ä¸ªæ´»ç€çš„èŠ‚ç‚¹ï¼‰ã€‚å¦‚æœé€šé“ä¸­æœ‰äº”ä¸ªèŠ‚ç‚¹ï¼Œåˆ™å…è®¸ä¸¢å¤±ä¸¤ä¸ªèŠ‚ç‚¹ï¼ˆå‰©ä¸‹ä¸‰ä¸ªå‰©ä½™èŠ‚ç‚¹ï¼‰ã€‚Raftæ’åºæœåŠ¡çš„æ­¤åŠŸèƒ½æ˜¯ä¸ºæ‚¨çš„æ’åºæœåŠ¡å»ºç«‹é«˜å¯ç”¨æ€§ç­–ç•¥çš„ä¸€ä¸ªå› ç´ ã€‚æ­¤å¤–ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å°†è¿™äº›èŠ‚ç‚¹åˆ†å¸ƒåœ¨æ•°æ®ä¸­å¿ƒç”šè‡³æœ¬åœ°ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡å°†èŠ‚ç‚¹æ”¾ç½®åœ¨ä¸‰ä¸ªä¸åŒçš„æ•°æ®ä¸­å¿ƒä¸­ã€‚è¿™æ ·ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®ä¸­å¿ƒæˆ–æ•´ä¸ªä½ç½®ä¸å¯ç”¨ï¼Œåˆ™å…¶ä»–æ•°æ®ä¸­å¿ƒä¸­çš„èŠ‚ç‚¹å°†ç»§ç»­è¿è¡Œã€‚ From the perspective of the service they provide to a network or a channel, Raft and the existing Kafka-based ordering service (which weâ€™ll talk about later) are similar. Theyâ€™re both CFT ordering services using the leader and follower design. If you are an application developer, smart contract developer, or peer administrator, you will not notice a functional difference between an ordering service based on Raft versus Kafka. However, there are a few major differences worth considering, especially if you intend to manage an ordering service: ä»å®ƒä»¬æä¾›ç»™ç½‘ç»œæˆ–é€šé“çš„æœåŠ¡çš„è§’åº¦æ¥çœ‹ï¼ŒRaftä¸ç°æœ‰çš„åŸºäºKafkaçš„æ’åºæœåŠ¡ï¼ˆæˆ‘ä»¬å°†åœ¨åé¢è®¨è®ºï¼‰å¾ˆç›¸ä¼¼ã€‚ å®ƒä»¬éƒ½æ˜¯é‡‡ç”¨é¢†å¯¼è€…å’Œè·Ÿéšè€…è®¾è®¡çš„CFTæ’åºæœåŠ¡ã€‚å¦‚æœä½ æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºå¼€å‘è€…ã€æ™ºèƒ½åˆçº¦å¼€å‘è€…æˆ–è€…æ˜¯peerç»©ç‚¹ç®¡ç†å‘˜ï¼Œæ‚¨ä¸ä¼šæ³¨æ„åˆ°åŸºäºRaftå’ŒKafkaçš„æ’åºæœåŠ¡ä¹‹é—´çš„åŠŸèƒ½å·®å¼‚ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸€äº›ä¸»è¦å·®å¼‚å€¼å¾—è€ƒè™‘ï¼Œå°¤å…¶æ˜¯å¦‚æœæ‚¨æ‰“ç®—ç®¡ç†æ’åºæœåŠ¡ï¼š Raft is easier to set up. Although Kafka has many admirers, even those admirers will (usually) admit that deploying a Kafka cluster and its ZooKeeper ensemble can be tricky, requiring a high level of expertise in Kafka infrastructure and settings. Additionally, there are many more components to manage with Kafka than with Raft, which means that there are more places where things can go wrong. And Kafka has its own versions, which must be coordinated with your orderers. With Raft, everything is embedded into your ordering node. Raftçš„æ’åºæœåŠ¡æ›´å®¹æ˜“æ­å»ºã€‚ Kafka and Zookeeper are not designed to be run across large networks. While Kafka is CFT, it should be run in a tight group of hosts. This means that practically speaking you need to have one organization run the Kafka cluster. Given that, having ordering nodes run by different organizations when using Kafka (which Fabric supports) doesnâ€™t give you much in terms of decentralization because the nodes will all go to the same Kafka cluster which is under the control of a single organization. With Raft, each organization can have its own ordering nodes, participating in the ordering service, which leads to a more decentralized system. Kafkaå’ŒZookeeperå¹¶éæ˜¯ä¸ºäº†è·¨å¤§å‹ç½‘ç»œè¿è¡Œè€Œè®¾è®¡çš„ã€‚ Raft is supported natively, which means that users are required to get the requisite images and learn how to use Kafka and ZooKeeper on their own. Likewise, support for Kafka-related issues is handled through Apache, the open-source developer of Kafka, not Hyperledger Fabric. The Fabric Raft implementation, on the other hand, has been developed and will be supported within the Fabric developer community and its support apparatus. Where Kafka uses a pool of servers (called â€œKafka brokersâ€) and the admin of the orderer organization specifies how many nodes they want to use on a particular channel, Raft allows the users to specify which ordering nodes will be deployed to which channel. In this way, peer organizations can make sure that, if they also own an orderer, this node will be made a part of a ordering service of that channel, rather than trusting and depending on a central admin to manage the Kafka nodes. Raft is the first step toward Fabricâ€™s development of a byzantine fault tolerant (BFT) ordering service. As weâ€™ll see, some decisions in the development of Raft were driven by this. If you are interested in BFT, learning how to use Raft should ease the transition. Raftæ˜¯Fabricå¼€å‘æ‹œå åº­å¼å®¹é”™ï¼ˆBFTï¼‰æ’åºæœåŠ¡çš„ç¬¬ä¸€æ­¥ã€‚ Note: Similar to Solo and Kafka, a Raft ordering service can lose transactions after acknowledgement of receipt has been sent to a client. For example, if the leader crashes at approximately the same time as a follower provides acknowledgement of receipt. Therefore, application clients should listen on peers for transaction commit events regardless (to check for transaction validity), but extra care should be taken to ensure that the client also gracefully tolerates a timeout in which the transaction does not get committed in a configured timeframe. Depending on the application, it may be desirable to resubmit the transaction or collect a new set of endorsements upon such a timeout. åœ¨å·²å°†å›æ‰§ç¡®è®¤å‘é€ç»™å®¢æˆ·ä¹‹åï¼ŒRaftæ’åºæœåŠ¡å¯èƒ½ä¼šä¸¢å¤±äº¤æ˜“ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé¢†å¯¼è€…å¤§çº¦åœ¨è¿½éšè€…æä¾›å›æ‰§ç¡®è®¤çš„åŒæ—¶å´©æºƒã€‚å› æ­¤ï¼Œæ— è®ºå¦‚ä½•åº”ç”¨ç¨‹åºå®¢æˆ·ç«¯éƒ½åº”åœ¨peerä¸Šä¾¦å¬äº¤æ˜“æäº¤äº‹ä»¶ï¼ˆä»¥æ£€æŸ¥äº¤æ˜“æœ‰æ•ˆæ€§ï¼‰ï¼Œä½†åº”æ ¼å¤–å°å¿ƒï¼Œä»¥ç¡®ä¿å®¢æˆ·ç«¯ä¹Ÿèƒ½å®¹å¿è¶…æ—¶ï¼Œåœ¨è¯¥è¶…æ—¶ä¸­ä¸ä¼šåœ¨é…ç½®çš„æ—¶é—´èŒƒå›´å†…æäº¤äº‹åŠ¡ã€‚ Raft concepts While Raft offers many of the same features as Kafka â€” albeit in a simpler and easier-to-use package â€” it functions substantially different under the covers from Kafka and introduces a number of new concepts, or twists on existing concepts, to Fabric. å°½ç®¡Raftæä¾›äº†è®¸å¤šä¸Kafkaç›¸åŒçš„åŠŸèƒ½ â€“ å°½ç®¡é‡‡ç”¨äº†æ›´ç®€å•æ˜“ç”¨çš„è½¯ä»¶åŒ… â€“ å®ƒçš„åŠŸèƒ½ä¸Kafkaçš„è¡¨é¢å¤§ä¸ç›¸åŒï¼Œå¹¶ä¸ºFabricå¼•å…¥äº†è®¸å¤šæ–°æ¦‚å¿µæˆ–æ‰­æ›²ç°æœ‰çš„æ¦‚å¿µã€‚ Log entry. The primary unit of work in a Raft ordering service is a â€œlog entryâ€, with the full sequence of such entries known as the â€œlogâ€. We consider the log consistent if a majority (a quorum, in other words) of members agree on the entries and their order, making the logs on the various orderers replicated. Raftæ’åºæœåŠ¡çš„ä¸»è¦å·¥ä½œå•å…ƒæ˜¯ â€œlog entryâ€ï¼Œè¿™äº›æ¡ç›®çš„å®Œæ•´åºåˆ—ç§°ä¸ºâ€œlogâ€ã€‚å¦‚æœå¤šæ•°æˆå‘˜ï¼ˆæ¢è¨€ä¹‹ï¼Œä¸ºæ³•å®šäººæ•°ï¼‰åŒæ„æ¡ç›®åŠå…¶é¡ºåºï¼Œåˆ™æˆ‘ä»¬è®¤ä¸ºæ—¥å¿—æ˜¯ä¸€è‡´çš„ï¼Œä½¿æ—¥å¿—å¤åˆ¶åˆ°å„ä¸ªæ’åºè€…ä¸Šã€‚ Consenter set. The ordering nodes actively participating in the consensus mechanism for a given channel and receiving replicated logs for the channel. This can be all of the nodes available (either in a single cluster or in multiple clusters contributing to the system channel), or a subset of those nodes. åŒæ„è€…é›†ã€‚æ’åºèŠ‚ç‚¹ç§¯æå‚ä¸ç»™å®šé€šé“çš„å…±è¯†æœºåˆ¶ï¼Œå¹¶æ¥æ”¶è¯¥é€šé“çš„å¤åˆ¶æ—¥å¿—ã€‚è¿™å¯ä»¥æ˜¯æ‰€æœ‰å¯ç”¨èŠ‚ç‚¹ï¼ˆåœ¨å•ä¸ªç¾¤é›†ä¸­æˆ–åœ¨ç»„æˆç³»ç»Ÿé€šé“çš„å¤šä¸ªç¾¤é›†ä¸­ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯é‚£äº›èŠ‚ç‚¹çš„å­é›†ã€‚ Finite-State Machine (FSM). Every ordering node in Raft has an FSM and collectively theyâ€™re used to ensure that the sequence of logs in the various ordering nodes is deterministic (written in the same sequence). æœ‰é™çŠ¶æ€æœºã€‚Raftä¸­çš„æ¯ä¸ªæ’åºèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªFSMï¼Œå¹¶å…±åŒä½¿ç”¨å®ƒä»¬æ¥ç¡®ä¿å„ä¸ªæ’åºèŠ‚ç‚¹ä¸­çš„æ—¥å¿—é¡ºåºæ˜¯ç¡®å®šçš„ï¼ˆä»¥ç›¸åŒçš„é¡ºåºå†™å…¥ï¼‰ã€‚ Quorum. Describes the minimum number of consenters that need to affirm a proposal so that transactions can be ordered. For every consenter set, this is a majority of nodes. In a cluster with five nodes, three must be available for there to be a quorum. If a quorum of nodes is unavailable for any reason, the ordering service cluster becomes unavailable for both read and write operations on the channel, and no new logs can be committed. æ³•å®šäººæ•°ã€‚æè¿°éœ€è¦ç¡®è®¤æè®®ä»¥ä¾¿å¯ä»¥æ’åºäº¤æ˜“çš„åŒæ„è€…çš„æœ€å°æ•°é‡ã€‚å¯¹äºæ¯ä¸ªåŒæ„é›†ï¼Œè¿™æ˜¯å¤§å¤šæ•°èŠ‚ç‚¹ã€‚åœ¨ä¸€ä¸ªç”±äº”ä¸ªèŠ‚ç‚¹ç»„æˆçš„é›†ç¾¤ä¸­ï¼Œå¿…é¡»æœ‰ä¸‰ä¸ªèŠ‚ç‚¹å¯ç”¨æ‰èƒ½è¾¾åˆ°æ³•å®šäººæ•°ã€‚å¦‚æœç”±äºä»»ä½•åŸå› æ— æ³•è¾¾åˆ°æ³•å®šæ•°é‡çš„èŠ‚ç‚¹ï¼Œæ’åºæœåŠ¡ç¾¤é›†å°†æ— æ³•ç”¨äºé€šé“ä¸Šçš„è¯»å–å’Œå†™å…¥æ“ä½œï¼Œå¹¶ä¸”æ— æ³•æäº¤ä»»ä½•æ–°æ—¥å¿—ã€‚ Leader. This is not a new concept â€” Kafka also uses leaders, as weâ€™ve said â€” but itâ€™s critical to understand that at any given time, a channelâ€™s consenter set elects a single node to be the leader (weâ€™ll describe how this happens in Raft later). The leader is responsible for ingesting new log entries, replicating them to follower ordering nodes, and managing when an entry is considered committed. This is not a special type of orderer. It is only a role that an orderer may have at certain times, and then not others, as circumstances determine. é¢†å¯¼è€…ã€‚ è¿™ä¸æ˜¯ä¸€ä¸ªæ–°æ¦‚å¿µ â€“ æ­£å¦‚æˆ‘ä»¬æ‰€è¯´çš„ï¼ŒKafkaä¹Ÿä½¿ç”¨é¢†å¯¼è€… â€“ ä½†è‡³å…³é‡è¦çš„æ˜¯è¦äº†è§£ï¼Œåœ¨ä»»ä½•ç»™å®šæ—¶é—´ï¼Œé€šé“çš„åŒæ„è€…é›†ä¼šé€‰ä¸¾ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºé¢†å¯¼è€…ï¼ˆæˆ‘ä»¬ç¨åå°†æè¿°åœ¨Raftä¸­å¦‚ä½•å‘ç”Ÿï¼‰ã€‚é¢†å¯¼è€…è´Ÿè´£è·å–æ–°çš„æ—¥å¿—æ¡ç›®ï¼Œå°†å®ƒä»¬å¤åˆ¶åˆ°è·Ÿéšè€…æ’åºèŠ‚ç‚¹ï¼Œå¹¶ç®¡ç†ä½•æ—¶å°†æ¡ç›®è§†ä¸ºå·²æäº¤ã€‚è¿™ä¸æ˜¯æ’åºè€…çš„ç‰¹æ®Šç±»å‹ã€‚è¿™åªæ˜¯æ’åºè€…å¯èƒ½åœ¨æŸäº›æ—¶å€™æ‰®æ¼”çš„è§’è‰²ï¼Œ***ã€‚ Follower. Again, not a new concept, but whatâ€™s critical to understand about followers is that the followers receive the logs from the leader and replicate them deterministically, ensuring that logs remain consistent. As weâ€™ll see in our section on leader election, the followers also receive â€œheartbeatâ€ messages from the leader. In the event that the leader stops sending those message for a configurable amount of time, the followers will initiate a leader election and one of them will be elected the new leader. è¿½éšè€…ã€‚äº†è§£è¿½éšè€…çš„å…³é”®æ˜¯è¿½éšè€…ä»é¢†å¯¼è€…é‚£é‡Œæ¥æ”¶æ—¥å¿—å¹¶ç¡®å®šæ€§åœ°å¤åˆ¶å®ƒä»¬ï¼Œä»¥ç¡®ä¿æ—¥å¿—ä¿æŒä¸€è‡´ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨é¢†å¯¼è€…é€‰ä¸¾éƒ¨åˆ†ä¸­æ‰€çœ‹åˆ°çš„é‚£æ ·ï¼Œè¿½éšè€…è¿˜ä¼šä»é¢†å¯¼è€…é‚£é‡Œæ¥æ”¶â€œå¿ƒè·³â€æ¶ˆæ¯ã€‚å¦‚æœé¢†å¯¼è€…åœ¨å¯é…ç½®çš„æ—¶é—´å†…åœæ­¢å‘é€è¿™äº›æ¶ˆæ¯ï¼Œåˆ™è·Ÿéšè€…å°†å‘èµ·é¢†å¯¼è€…é€‰ä¸¾ï¼Œå…¶ä¸­ä¸€ä¸ªå°†è¢«é€‰ä¸¾ä¸ºæ–°é¢†å¯¼è€…ã€‚ Raft in a transaction flow Every channel runs on a separate instance of the Raft protocol, which allows each instance to elect a different leader. This configuration also allows further decentralization of the service in use cases where clusters are made up of ordering nodes controlled by different organizations. While all Raft nodes must be part of the system channel, they do not necessarily have to be part of all application channels. Channel creators (and channel admins) have the ability to pick a subset of the available orderers and to add or remove ordering nodes as needed (as long as only a single node is added or removed at a time). æ¯ä¸ªé€šé“éƒ½è¿è¡Œä¸€ä¸ªå•ç‹¬çš„Raftåè®®å®ä¾‹ï¼Œè¿™å…è®¸æ¯ä¸ªå®ä¾‹é€‰æ‹©ä¸åŒçš„é¢†å¯¼è€…ã€‚åœ¨ç”±ä¸åŒç»„ç»‡æ§åˆ¶çš„æ’åºèŠ‚ç‚¹ç»„æˆçš„ç¾¤é›†ç”¨ä¾‹ä¸­ï¼Œæ­¤é…ç½®è¿˜å…è®¸è¿›ä¸€æ­¥åˆ†æ•£æœåŠ¡ã€‚å°½ç®¡æ‰€æœ‰RaftèŠ‚ç‚¹éƒ½å¿…é¡»æ˜¯ç³»ç»Ÿé€šé“çš„ä¸€éƒ¨åˆ†ï¼Œä½†ä¸ä¸€å®šå¿…é¡»æ˜¯æ‰€æœ‰åº”ç”¨ç¨‹åºé€šé“çš„ä¸€éƒ¨åˆ†ã€‚é€šé“åˆ›å»ºè€…ï¼ˆå’Œé€šé“ç®¡ç†å‘˜ï¼‰å¯ä»¥é€‰æ‹©å¯ç”¨è®¢è´­è€…çš„å­é›†ï¼Œå¹¶æ ¹æ®éœ€è¦æ·»åŠ æˆ–åˆ é™¤è®¢è´­èŠ‚ç‚¹ï¼ˆåªè¦ä¸€æ¬¡ä»…æ·»åŠ æˆ–åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ã€‚ While this configuration creates more overhead in the form of redundant heartbeat messages and goroutines, it lays necessary groundwork for BFT. è™½ç„¶æ­¤é…ç½®ä»¥å†—ä½™å¿ƒè·³æ¶ˆæ¯å’Œgoroutineçš„å½¢å¼åˆ›å»ºäº†æ›´å¤šå¼€é”€ï¼Œä½†ä¸ºBFTå¥ å®šäº†å¿…è¦çš„åŸºç¡€ã€‚ In Raft, transactions (in the form of proposals or configuration updates) are automatically routed by the ordering node that receives the transaction to the current leader of that channel. This means that peers and applications do not need to know who the leader node is at any particular time. Only the ordering nodes need to know. åœ¨Raftä¸­ï¼Œäº¤æ˜“ï¼ˆä»¥å»ºè®®ä¹¦æˆ–é…ç½®æ›´æ–°çš„å½¢å¼ï¼‰ç”±æ¥æ”¶äº¤æ˜“çš„æ’åºèŠ‚ç‚¹è‡ªåŠ¨è·¯ç”±åˆ°è¯¥é€šé“çš„å½“å‰leaderèŠ‚ç‚¹ã€‚è¿™æ„å‘³ç€peerèŠ‚ç‚¹å’Œåº”ç”¨ç¨‹åºèŠ‚ç‚¹ä¸éœ€è¦çŸ¥é“å½“å‰æ—¶é—´è°æ˜¯leaderèŠ‚ç‚¹ã€‚åªæœ‰æ’åºæœåŠ¡èŠ‚ç‚¹éœ€è¦çŸ¥é“ã€‚ When the orderer validation checks have been completed, the transactions are ordered, packaged into blocks, consented on, and distributed, as described in phase two of our transaction flow. Architectural notes How leader election works in Raft Although the process of electing a leader happens within the ordererâ€™s internal processes, itâ€™s worth noting how the process works. Raft nodes are always in one of three states: follower, candidate, or leader. All nodes initially start out as a follower. In this state, they can accept log entries from a leader (if one has been elected), or cast votes for leader. If no log entries or heartbeats are received for a set amount of time (for example, five seconds), nodes self-promote to the candidate state. In the candidate state, nodes request votes from other nodes. If a candidate receives a quorum of votes, then it is promoted to a leader. The leader must accept new log entries and replicate them to the followers. Raftçš„èŠ‚ç‚¹ä¸€ç›´å¤„äºä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼šfollowerï¼Œcandidateï¼ˆå€™é€‰ï¼‰ï¼Œæˆ–leaderã€‚æ‰€æœ‰çš„èŠ‚ç‚¹çš„æœ€åˆçŠ¶æ€éƒ½æ˜¯followerã€‚åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼Œä»–ä»¬å¯ä»¥ä»leaderæ¥æ”¶æ—¥å¿—æ¡ç›®ï¼Œæˆ–è€…æŠ•ç¥¨é€‰ä¸¾leaderã€‚å¦‚æœåœ¨è®¾ç½®çš„æ—¶é—´æ®µå†…ï¼ˆä¾‹å¦‚ï¼Œäº”ç§’é’Ÿï¼‰æœªæ¥æ”¶åˆ°æ—¥å¿—æ¡ç›®æˆ–å¿ƒè·³ï¼Œåˆ™èŠ‚ç‚¹ä¼šè‡ªåŠ¨å‡çº§ä¸º candidate çŠ¶æ€ã€‚åœ¨å€™é€‰çŠ¶æ€ä¸‹ï¼ŒèŠ‚ç‚¹ä¼šå‘å…¶ä»–èŠ‚ç‚¹è¯·æ±‚æŠ•ç¥¨ã€‚å¦‚æœå€™é€‰äººè·å¾—æ³•å®šäººæ•°çš„é€‰ç¥¨ï¼Œåˆ™å°†å…¶æ™‹å‡ä¸º leaderã€‚leaderèŠ‚ç‚¹å¿…é¡»æ¥å—æ–°çš„æ—¥å¿—æ¡ç›®å¹¶ä¸”å°†å…¶å¤åˆ¶åˆ°followersã€‚ For a visual representation of how the leader election process works, check out The Secret Lives of Data. Snapshots If an ordering node goes down, how does it get the logs it missed when it is restarted? å¦‚æœä¸€ä¸ªæ’åºèŠ‚ç‚¹å®•æœºäº†ï¼Œå®ƒå¦‚ä½•åœ¨é‡æ–°å¯åŠ¨æ—¶è·å–ä¸¢å¤±çš„æ—¥å¿—ä¿¡æ¯å‘¢ï¼Ÿ While itâ€™s possible to keep all logs indefinitely, in order to save disk space, Raft uses a process called â€œsnapshottingâ€, in which users can define how many bytes of data will be kept in the log. This amount of data will conform to a certain number of blocks (which depends on the amount of data in the blocks. Note that only full blocks are stored in a snapshot). å°½ç®¡å¯ä»¥æ— é™æœŸä¿ç•™æ‰€æœ‰æ—¥å¿—ï¼Œä½†æ˜¯ä¸ºäº†èŠ‚çœç£ç›˜ç©ºé—´ï¼ŒRaftä½¿ç”¨äº†ä¸€ç§ç§°ä¸ºâ€œsnapshottingâ€çš„ç¨‹åºï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­å®šä¹‰å°†åœ¨æ—¥å¿—ä¸­ä¿ç•™å¤šå°‘å­—èŠ‚çš„æ•°æ®ã€‚æ­¤æ•°æ®é‡å°†ç¬¦åˆä¸€å®šæ•°é‡çš„åŒºå—ï¼ˆè¿™å–å†³äºå—ä¸­çš„æ•°æ®é‡ï¼Œè¯·æ³¨æ„ï¼Œå¿«ç…§ä¸­ä»…å­˜å‚¨å®Œæ•´å—ï¼‰ã€‚ For example, letâ€™s say lagging replica R1 was just reconnected to the network. Its latest block is 100. Leader L is at block 196, and is configured to snapshot at amount of data that in this case represents 20 blocks. R1 would therefore receive block 180 from L and then make a Deliver request for blocks 101 to 180. Blocks 180 to 196 would then be replicated to R1 through the normal Raft protocol. ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æ»åçš„å‰¯æœ¬R1åˆšåˆšé‡æ–°è¿æ¥åˆ°ç½‘ç»œã€‚å®ƒçš„æœ€åä¸€ä¸ªåŒºå—æ˜¯100.LeaderèŠ‚ç‚¹Læœ€åä¸€ä¸ªåŒºå—æ˜¯196ï¼Œå¹¶ä¸”è®¾ç½®å¿«ç…§çš„æ•°é‡ä»£è¡¨20ä¸ªåŒºå—ã€‚å› æ­¤ï¼ŒR1å°†ä»Læ¥æ”¶åŒºå—180ä¸ªï¼Œç„¶åå¯¹åŒºå—101åˆ°180å‘å‡º Deliver è¯·æ±‚ã€‚180åˆ°196ä¹‹é—´çš„åŒºå—ä¼šä½¿ç”¨å¸¸è§„çš„Raftåè®®å¤åˆ¶åˆ°R1ã€‚ Kafka (deprecated in v2.x) The other crash fault tolerant ordering service supported by Fabric is an adaptation of a Kafka distributed streaming platform for use as a cluster of ordering nodes. You can read more about Kafka at the Apache Kafka Web site, but at a high level, Kafka uses the same conceptual â€œleader and followerâ€ configuration used by Raft, in which transactions (which Kafka calls â€œmessagesâ€) are replicated from the leader node to the follower nodes. In the event the leader node goes down, one of the followers becomes the leader and ordering can continue, ensuring fault tolerance, just as with Raft. The management of the Kafka cluster, including the coordination of tasks, cluster membership, access control, and controller election, among others, is handled by a ZooKeeper ensemble and its related APIs. Kafka clusters and ZooKeeper ensembles are notoriously tricky to set up, so our documentation assumes a working knowledge of Kafka and ZooKeeper. If you decide to use Kafka without having this expertise, you should complete, at a minimum, the first six steps of the Kafka Quickstart guide before experimenting with the Kafka-based ordering service. You can also consult this sample configuration file for a brief explanation of the sensible defaults for Kafka and ZooKeeper. To learn how to bring up a Kafka-based ordering service, check out our documentation on Kafka.","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"Key Concepts","slug":"åŒºå—é“¾/Hyperledger-Fabric/Key-Concepts","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/Key-Concepts/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"Ordering Service","slug":"Ordering-Service","permalink":"https://guozhe001.github.io/tags/Ordering-Service/"}]},{"title":"Private data","slug":"blockchain/fabric/å…³é”®æ¦‚å¿µ/Private data","date":"2021-04-01T10:18:21.481Z","updated":"2021-04-01T10:18:21.481Z","comments":true,"path":"2021/04/01/blockchain/fabric/å…³é”®æ¦‚å¿µ/Private data/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Private%20data/","excerpt":"","text":"å®˜æ–¹æ–‡æ¡£ï¼šPrivate data What is a private data collection? A collection is the combination of two elements: The actual private data, sent peer-to-peer via gossip protocol to only the organization(s) authorized to see it. This data is stored in a private state database on the peers of authorized organizations, which can be accessed from chaincode on these authorized peers. The ordering service is not involved here and does not see the private data. Note that because gossip distributes the private data peer-to-peer across authorized organizations, it is required to set up anchor peers on the channel, and configure CORE_PEER_GOSSIP_EXTERNALENDPOINT on each peer, in order to bootstrap cross-organization communication. A hash of that data, which is endorsed, ordered, and written to the ledgers of every peer on the channel. The hash serves as evidence of the transaction and is used for state validation and can be used for audit purposes. The following diagram illustrates the ledger contents of a peer authorized to have private data and one which is not. Collection members may decide to share the private data with other parties if they get into a dispute or if they want to transfer the asset to a third party. The third party can then compute the hash of the private data and see if it matches the state on the channel ledger, proving that the state existed between the collection members at a certain point in time. In some cases, you may decide to have a set of collections each comprised of a single organization. For example an organization may record private data in their own collection, which could later be shared with other channel members and referenced in chaincode transactions. Weâ€™ll see examples of this in the sharing private data topic below.","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"Key Concepts","slug":"åŒºå—é“¾/Hyperledger-Fabric/Key-Concepts","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/Key-Concepts/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"Private data","slug":"Private-data","permalink":"https://guozhe001.github.io/tags/Private-data/"}]},{"title":"Smart Contracts and Chaincode","slug":"blockchain/fabric/å…³é”®æ¦‚å¿µ/Smart Contracts and Chaincode","date":"2021-04-01T10:18:21.481Z","updated":"2021-04-01T10:18:21.482Z","comments":true,"path":"2021/04/01/blockchain/fabric/å…³é”®æ¦‚å¿µ/Smart Contracts and Chaincode/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Smart%20Contracts%20and%20Chaincode/","excerpt":"","text":"å®˜æ–¹æ–‡æ¡£ï¼šSmart Contracts and Chaincode TODO ä¸‹å›¾å±•ç¤ºFabricæ˜¯å¦‚ä½•å¤„ç†éªŒè¯æˆåŠŸçš„äº¤æ˜“å’ŒéªŒè¯ä¸æˆåŠŸçš„äº¤æ˜“çš„ã€‚ All transactions have an identifier, a proposal, and a response signed by a set of organizations. All transactions are recorded on the blockchain, whether valid or invalid, but only valid transactions contribute to the world state. Intercommunication A Smart Contract can call other smart contracts both within the same channel and across different channels. It this way, they can read and write world state data to which they would not otherwise have access due to smart contract namespaces. There are limitations to this inter-contract communication, which are described fully in the chaincode namespace topic.","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"Key Concepts","slug":"åŒºå—é“¾/Hyperledger-Fabric/Key-Concepts","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/Key-Concepts/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"Smart Contracts and Chaincode","slug":"Smart-Contracts-and-Chaincode","permalink":"https://guozhe001.github.io/tags/Smart-Contracts-and-Chaincode/"}]},{"title":"Policies(ç­–ç•¥)","slug":"blockchain/fabric/å…³é”®æ¦‚å¿µ/Policies","date":"2021-04-01T10:18:21.480Z","updated":"2021-04-01T10:18:21.481Z","comments":true,"path":"2021/04/01/blockchain/fabric/å…³é”®æ¦‚å¿µ/Policies/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Policies/","excerpt":"","text":"What is a policy At its most basic level, a policy is a set of rules that define the structure for how decisions are made and specific outcomes are reached. To that end, policies typically describe a who and a what, such as the access or rights that an individual has over an asset. We can see that policies are used throughout our daily lives to protect assets of value to us, from car rentals, health, our homes, and many more. åœ¨æœ€åŸºæœ¬çš„çº§åˆ«ä¸Šï¼Œç­–ç•¥æ˜¯ä¸€ç»„è§„åˆ™ï¼Œè¿™äº›è§„åˆ™å®šä¹‰äº†å¦‚ä½•åˆ¶å®šå†³ç­–å’Œè¾¾åˆ°ç‰¹å®šç»“æœçš„ç»“æ„ã€‚ä¸ºæ­¤ï¼Œç­–ç•¥é€šå¸¸æè¿°WHOå’ŒWHATï¼Œä¾‹å¦‚ä¸ªäººå¯¹ASSETçš„è®¿é—®æˆ–æƒåˆ©ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç­–ç•¥åœ¨æˆ‘ä»¬çš„æ—¥å¸¸ç”Ÿæ´»ä¸­ä¸€ç›´è¢«ç”¨æ¥ä¿æŠ¤å¯¹æˆ‘ä»¬æœ‰ä»·å€¼çš„èµ„äº§ï¼Œä½¿å…¶å…å—æ±½è½¦ç§Ÿèµï¼ŒåŒ»ç–—ï¼Œæˆ¿å±‹ç­‰çš„ä¾µå®³ã€‚ For example, an insurance policy defines the conditions, terms, limits, and expiration under which an insurance payout will be made. The policy is agreed to by the policy holder and the insurance company, and defines the rights and responsibilities of each party. ä¾‹å¦‚ï¼Œä¿é™©å•å®šä¹‰äº†å°†è¦æ”¯ä»˜ä¿é™©é‡‘çš„æ¡ä»¶ï¼Œæ¡æ¬¾ï¼Œé™é¢å’Œæœ‰æ•ˆæœŸã€‚è¯¥ä¿å•ç»ä¿å•æŒæœ‰äººå’Œä¿é™©å…¬å¸åŒæ„ï¼Œå¹¶å®šä¹‰äº†åŒæ–¹çš„æƒåˆ©å’Œè´£ä»»ã€‚ Whereas an insurance policy is put in place for risk management, in Hyperledger Fabric, policies are the mechanism for infrastructure management. Fabric policies represent how members come to agreement on accepting or rejecting changes to the network, a channel, or a smart contract. Policies are agreed to by the consortium members when a network is originally configured, but they can also be modified as the network evolves. For example, they describe the criteria for adding or removing members from a channel, change how blocks are formed, or specify the number of organizations required to endorse a smart contract. All of these actions are described by a policy which defines who can perform the action. Simply put, everything you want to do on a Fabric network is controlled by a policy. å°½ç®¡å·²ä¸ºé£é™©ç®¡ç†åˆ¶å®šäº†ä¿é™©å•ï¼Œä½†åœ¨Hyperledger Fabricä¸­ï¼Œé£é™©ç®¡ç†æ˜¯åŸºç¡€æ¶æ„ç®¡ç†çš„æœºåˆ¶ã€‚Fabricçš„ç­–ç•¥ä»£è¡¨æˆå‘˜å¦‚ä½•å°±æ¥å—æˆ–æ‹’ç»å¯¹ç½‘ç»œï¼Œæ¸ é“æˆ–æ™ºèƒ½åˆçº¦çš„æ›´æ”¹è¾¾æˆåè®®ã€‚æœ€åˆé…ç½®ç½‘ç»œæ—¶ï¼Œç­–ç•¥æ˜¯ç”±è”ç›Ÿæˆå‘˜åŒæ„çš„ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥éšç€ç½‘ç»œçš„å‘å±•è€Œä¿®æ”¹ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œå®ƒä»¬æè¿°äº†åœ¨é€šé“ä¸­æ·»åŠ æˆ–åˆ é™¤æˆå‘˜ï¼Œæ›´æ”¹åŒºå—çš„å½¢æˆæ–¹å¼æˆ–æŒ‡å®šè®¤å¯æ™ºèƒ½åˆçº¦æ‰€éœ€çš„ç»„ç»‡æ•°é‡çš„æ ‡å‡†ã€‚æ‰€æœ‰è¿™äº›åŠ¨ä½œå‡ç”±å®šä¹‰äº†è°å¯ä»¥æ‰§è¡Œè¯¥åŠ¨ä½œçš„ç­–ç•¥æ¥æè¿°ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæ‚¨è¦åœ¨Fabricç½‘ç»œä¸Šæ‰§è¡Œçš„æ‰€æœ‰æ“ä½œå‡å—ç­–ç•¥æ§åˆ¶ã€‚ Why are policies needed Policies are one of the things that make Hyperledger Fabric different from other blockchains like Ethereum or Bitcoin. In those systems, transactions can be generated and validated by any node in the network. The policies that govern the network are fixed at any point in time and can only be changed using the same process that governs the code. Because Fabric is a permissioned blockchain whose users are recognized by the underlying infrastructure, those users have the ability to decide on the governance of the network before it is launched, and change the governance of a running network. ç­–ç•¥æ˜¯ä½¿Hyperledger Fabricä¸ä»¥å¤ªåŠæˆ–æ¯”ç‰¹å¸ç­‰å…¶ä»–åŒºå—é“¾ä¸åŒçš„åŸå› ä¹‹ä¸€ã€‚åœ¨æ¯”ç‰¹å¸æˆ–ä»¥å¤ªåŠç³»ç»Ÿä¸­ï¼Œäº¤æ˜“å¯ä»¥ç”±ç½‘ç»œä¸Šçš„ä»»æ„èŠ‚ç‚¹ç”Ÿæˆå’ŒéªŒè¯ã€‚æ”¯é…ç½‘ç»œçš„ç­–ç•¥åœ¨ä»»ä½•æ—¶é—´éƒ½æ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸”åªèƒ½ä½¿ç”¨æ”¯é…ä»£ç çš„ç›¸åŒè¿‡ç¨‹è¿›è¡Œæ›´æ”¹ã€‚ç”±äºFabricæ˜¯è®¸å¯çš„åŒºå—é“¾ï¼Œå…¶ç”¨æˆ·è¢«åŸºç¡€æ¶æ„æ‰€è¯†åˆ«ï¼Œå› æ­¤è¿™äº›ç”¨æˆ·å…·æœ‰åœ¨å¯åŠ¨ç½‘ç»œä¹‹å‰å†³å®šç½‘ç»œæ²»ç†çš„èƒ½åŠ›ï¼Œå¹¶ä¸”ä¹Ÿå…·æœ‰æ›´æ”¹è¿è¡Œä¸­ç½‘ç»œçš„æ²»ç†çš„èƒ½åŠ›ã€‚ Policies allow members to decide which organizations can access or update a Fabric network, and provide the mechanism to enforce those decisions. Policies contain the lists of organizations that have access to a given resource, such as a user or system chaincode. They also specify how many organizations need to agree on a proposal to update a resource, such as a channel or smart contracts. Once they are written, policies evaluate the collection of signatures attached to transactions and proposals and validate if the signatures fulfill the governance agreed to by the network. ç­–ç•¥å…è®¸æˆå‘˜å†³å®šå“ªäº›ç»„ç»‡å¯ä»¥è®¿é—®æˆ–æ›´æ–°ä¸€ä¸ªFabricç½‘ç»œï¼Œå¹¶æä¾›æ‰§è¡Œè¿™äº›å†³å®šçš„æœºåˆ¶ã€‚ç­–ç•¥åŒ…å«å¯¹ç»™å®šçš„èµ„æºçš„æœ‰è®¿é—®æƒé™çš„ç»„ç»‡çš„åˆ—è¡¨ï¼Œæ¯”å¦‚ä¸€ä¸ªç”¨æˆ·æˆ–è€…ç³»ç»Ÿé“¾ç ã€‚ç­–ç•¥è¿˜æŒ‡å®šæœ‰å¤šå°‘ç»„ç»‡éœ€è¦å°±æ›´æ–°èµ„æºï¼ˆä¾‹å¦‚é€šé“æˆ–æ™ºèƒ½åˆçº¦ï¼‰çš„ææ¡ˆè¾¾æˆåè®®ã€‚ä¸€æ—¦å†™å…¥ï¼Œç­–ç•¥å°†è¯„ä¼°é™„åŠ åœ¨äº¤æ˜“å’Œæè®®ä¸­çš„ç­¾åçš„é›†åˆï¼Œå¹¶éªŒè¯ç­¾åæ˜¯å¦æ»¡è¶³ç½‘ç»œæ‰€åŒæ„çš„æ²»ç†ã€‚ How are policies implemented throughout Fabric Policies are implemented at different levels of a Fabric network. Each policy domain governs different aspects of how a network operates. ç­–ç•¥æ˜¯åœ¨Fabricç½‘ç»œçš„ä¸åŒçº§åˆ«ä¸Šå®ç°çš„ã€‚æ¯ä¸ªç­–ç•¥åŸŸç®¡ç†ç½‘ç»œè¿è¡Œçš„ä¸åŒæ–¹é¢ã€‚ A visual representation of the Fabric policy hierarchy. Fabricç­–ç•¥å±‚æ¬¡ç»“æ„çš„ç›´è§‚è¡¨ç¤ºã€‚ System channel configuration Every network begins with an ordering system channel. There must be exactly one ordering system channel for an ordering service, and it is the first channel to be created. The system channel also contains the organizations who are the members of the ordering service (ordering organizations) and those that are on the networks to transact (consortium organizations). æ¯ä¸ªç½‘ç»œéƒ½ä»ä¸€ä¸ªæ’åºç³»ç»Ÿé€šé“å¼€å§‹ã€‚å¯¹æ’åºæœæ¥è¯´ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªç¡®å®šçš„æ’åºç³»ç»Ÿé€šé“ï¼Œå¹¶ä¸”ä»–æ˜¯ç¬¬ä¸€ä¸ªéœ€è¦åˆ›å»ºçš„é€šé“ã€‚ç³»ç»Ÿé€šé“è¿˜åŒ…å«ä½œä¸ºæ’åºæœåŠ¡æˆå‘˜çš„ç»„ç»‡ï¼ˆæ’åºç»„ç»‡ï¼‰å’Œåœ¨ç½‘ç»œä¸Šè¿›è¡Œäº¤æ˜“çš„ç»„ç»‡ï¼ˆè”ç›Ÿç»„ç»‡ï¼‰ã€‚ The policies in the ordering system channel configuration blocks govern the consensus used by the ordering service and define how new blocks are created. The system channel also governs which members of the consortium are allowed to create new channels. æ’åºç³»ç»Ÿé€šé“é…ç½®åŒºå—ä¸­çš„ç­–ç•¥æ§åˆ¶æ’åºæœåŠ¡ä½¿ç”¨çš„å…±è¯†ï¼Œå¹¶å®šä¹‰å¦‚ä½•åˆ›å»ºæ–°åŒºå—ã€‚ç³»ç»Ÿé€šé“ä¹Ÿæ§åˆ¶è”ç›Ÿä¸­çš„å“ªäº›æˆå‘˜å…è®¸åˆ›å»ºæ–°çš„é€šé“ã€‚ Application channel configuration Application channels are used to provide a private communication mechanism between organizations in the consortium. åº”ç”¨ç¨‹åºé€šé“ç”¨äºåœ¨è”ç›Ÿä¸­çš„ç»„ç»‡ä¹‹é—´æä¾›ä¸“ç”¨çš„é€šä¿¡æœºåˆ¶ã€‚ The policies in an application channel govern the ability to add or remove members from the channel. Application channels also govern which organizations are required to approve a chaincode before the chaincode is defined and committed to a channel using the Fabric chaincode lifecycle. When an application channel is initially created, it inherits all the ordering service parameters from the orderer system channel by default. However, those parameters (and the policies governing them) can be customized in each channel. åº”ç”¨ç¨‹åºé€šé“ä¸­çš„ç­–ç•¥æ§åˆ¶äº†ä»é€šé“ä¸­æ·»åŠ æˆ–è€…ç§»é™¤æˆå‘˜çš„èƒ½åŠ›ã€‚åº”ç”¨ç¨‹åºé€šé“ä¹Ÿæ§åˆ¶äº†åœ¨ä½¿ç”¨Fabricé“¾ç ç”Ÿå‘½å‘¨æœŸå®šä¹‰é“¾ç å¹¶å°†å…¶æäº¤ç»™é€šé“ä¹‹å‰ï¼Œéœ€è¦å“ªäº›æˆå‘˜éœ€è¦ã€‚æœ€åˆåˆ›å»ºåº”ç”¨ç¨‹åºé€šé“æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒå°†ä»æ’åºç³»ç»Ÿé€šé“ç»§æ‰¿æ‰€æœ‰æ’åºæœåŠ¡å‚æ•°ã€‚ä½†æ˜¯ï¼Œå¯ä»¥åœ¨æ¯ä¸ªé€šé“ä¸­è‡ªå®šä¹‰è¿™äº›å‚æ•°ï¼ˆä»¥åŠæ§åˆ¶å®ƒä»¬çš„ç­–ç•¥ï¼‰ã€‚ Access control lists (ACLs) Network administrators will be especially interested in the Fabric use of ACLs, which provide the ability to configure access to resources by associating those resources with existing policies. These â€œresourcesâ€ could be functions on system chaincode (e.g., â€œGetBlockByNumberâ€ on the â€œqsccâ€ system chaincode) or other resources (e.g.,who can receive Block events). ACLs refer to policies defined in an application channel configuration and extends them to control additional resources. The default set of Fabric ACLs is visible in the configtx.yaml file under the Application: &amp;ApplicationDefaults section but they can and should be overridden in a production environment. The list of resources named in configtx.yaml is the complete set of all internal resources currently defined by Fabric. ç½‘ç»œç®¡ç†å‘˜å¯èƒ½å¯¹Fabricä½¿ç”¨çš„ACç‰¹åˆ«æ„Ÿå…´è¶£ï¼ŒACLå¯ä»¥é€šè¿‡å°†èµ„æºä¸ç°æœ‰ç­–ç•¥ç›¸å…³è”æ¥é…ç½®å¯¹èµ„æºçš„è®¿é—®ã€‚è¿™äº›â€œèµ„æºâ€å¯ä»¥æ˜¯ç³»ç»Ÿé“¾ç ä¸Šçš„åŠŸèƒ½ï¼ˆå¦‚ï¼Œåœ¨â€œ qsccâ€ç³»ç»Ÿé“¾ç ä¸Šçš„â€œ GetBlockByNumberâ€ï¼‰æˆ–å…¶ä»–èµ„æºï¼ˆå¦‚è°å¯ä»¥æ¥æ”¶Blockäº‹ä»¶ï¼‰ã€‚ACLå¼•ç”¨åœ¨åº”ç”¨ç¨‹åºé€šé“é…ç½®ä¸­å®šä¹‰çš„ç­–ç•¥ï¼Œå¹¶å°†å…¶æ‰©å±•ä»¥æ§åˆ¶å…¶ä»–èµ„æºã€‚é»˜è®¤çš„Fabric ACLé›†åœ¨configtx.yamlæ–‡ä»¶é‡Œçš„ Application: &amp;ApplicationDefaults éƒ¨åˆ†ä¸‹çš„å¯è§ï¼Œä½†æ˜¯å¯ä»¥å¹¶ä¸”åº”è¯¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¦†ç›–å®ƒä»¬ã€‚configtx.yamlä¸­å‘½åçš„èµ„æºåˆ—è¡¨æ˜¯Fabricå½“å‰å®šä¹‰çš„æ‰€æœ‰å†…éƒ¨èµ„æºçš„å®Œæ•´é›†åˆã€‚ In that file, ACLs are expressed using the following format: åœ¨è¯¥æ–‡ä»¶ä¸­ï¼ŒACLä½¿ç”¨ä»¥ä¸‹æ ¼å¼è¡¨ç¤ºï¼š 12# ACL policy for chaincode to chaincode invocationpeer/ChaincodeToChaincode: /Channel/Application/Readers Where peer/ChaincodeToChaincode represents the resource being secured and /Channel/Application/Readers refers to the policy which must be satisfied for the associated transaction to be considered valid. å…¶ä¸­ peer/ChaincodeToChaincode è¡¨ç¤ºå—ä¿æŠ¤çš„èµ„æºï¼Œ /Channel/Application/Readersæ˜¯æŒ‡å¿…é¡»æ»¡è¶³çš„ç­–ç•¥ï¼Œå…³è”äº¤æ˜“æ‰è¢«è§†ä¸ºæœ‰æ•ˆã€‚ For a deeper dive into ACLS, refer to the topic in the Operations Guide on ACLs. è¦æ·±å…¥äº†è§£ACLSï¼Œè¯·å‚é˜…ACLsçš„æ“ä½œæŒ‡å—ä¸­çš„ä¸»é¢˜ã€‚ Smart contract endorsement policiesï¼ˆæ™ºèƒ½åˆçº¦çš„èƒŒä¹¦ç­–ç•¥ï¼‰ Every smart contract inside a chaincode package has an endorsement policy that specifies how many peers belonging to different channel members need to execute and validate a transaction against a given smart contract in order for the transaction to be considered valid. Hence, the endorsement policies define the organizations (through their peers) who must â€œendorseâ€ (i.e., approve of) the execution of a proposal. é“¾ç åŒ…é‡Œé¢çš„æ¯ä¸ªæ™ºèƒ½åˆçº¦éƒ½æœ‰ä¸€ä¸ªèƒŒä¹¦ç­–ç•¥ï¼Œè¿™ä¸ªèƒŒä¹¦ç­–ç•¥æŒ‡å®šäº†éœ€è¦å¤šå°‘ä¸ªæ¥è‡ªä¸åŒé€šé“æˆå‘˜çš„peerèŠ‚ç‚¹éœ€è¦é’ˆå¯¹ç»™å®šçš„æ™ºèƒ½åˆçº¦æ‰§è¡Œå’ŒéªŒè¯äº¤æ˜“ï¼Œä»¥ä¾¿è¯¥äº¤æ˜“è¢«è§†ä¸ºæœ‰æ•ˆã€‚å› æ­¤ï¼ŒèƒŒä¹¦æ”¿ç­–å®šä¹‰äº†å¿…é¡»â€œèƒŒä¹¦â€ï¼ˆå³æ‰¹å‡†ï¼‰ææ¡ˆæ‰§è¡Œçš„ç»„ç»‡ï¼ˆé€šè¿‡å…¶peerï¼‰ã€‚ Modification policiesï¼ˆä¿®æ”¹æ”¿ç­–ï¼‰ There is one last type of policy that is crucial to how policies work in Fabric, the Modification policy. Modification policies specify the group of identities required to sign (approve) any configuration update. It is the policy that defines how the policy is updated. Thus, each channel configuration element includes a reference to a policy which governs its modification. æœ€åä¸€ç§ç­–ç•¥å¯¹äºFabricä¸­çš„ç­–ç•¥å·¥ä½œè‡³å…³é‡è¦ï¼Œå³Modification policyã€‚ä¿®æ”¹ç­–ç•¥æŒ‡å®šäº†ä»»ä½•é…ç½®æ›´æ–°æ—¶éœ€è¦ç­¾åï¼ˆæ‰¹å‡†ï¼‰çš„ä¸€ç»„èº«ä»½ã€‚è¯¥ç­–ç•¥å®šä¹‰äº†å¦‚ä½•æ›´æ–°ç­–ç•¥ã€‚å› æ­¤ï¼Œæ¯ä¸ªé€šé“é…ç½®å…ƒç´ éƒ½åŒ…å«ä¸€ä¸ªå¯¹ç®¡ç†å…¶ä¿®æ”¹çš„ç­–ç•¥çš„å¼•ç”¨ã€‚ The Fabric policy domains While Fabric policies are flexible and can be configured to meet the needs of a network, the policy structure naturally leads to a division between the domains governed by either the Ordering Service organizations or the members of the consortium. In the following diagram you can see how the default policies implement control over the Fabric policy domains below. è™½ç„¶Fabricçš„ç­–ç•¥æ˜¯çµæ´»çš„ï¼Œå¯ä»¥é…ç½®ä¸ºæ»¡è¶³ç½‘ç»œéœ€æ±‚ï¼Œä½†æ˜¯ç­–ç•¥ç»“æ„è‡ªç„¶ä¼šå¯¼è‡´ç”±æ’åºæœåŠ¡ç»„ç»‡æˆ–è”ç›Ÿæˆå‘˜ç®¡ç†çš„åŸŸä¹‹é—´çš„åˆ’åˆ†ã€‚åœ¨ä¸‹å›¾ä¸­ä½ ä¼šçœ‹åˆ°é»˜è®¤ç­–ç•¥æ˜¯å¦‚ä½•å®ç°å¯¹ç»“æ„ç­–ç•¥åŸŸçš„æ§åˆ¶ã€‚ A more detailed look at the policy domains governed by the Orderer organizations and consortium organizations. æ›´è¯¦ç»†åœ°äº†è§£ç”±è®¢è´­è€…ç»„ç»‡å’Œè´¢å›¢ç»„ç»‡ç®¡ç†çš„ç­–ç•¥åŸŸã€‚ A fully functional Fabric network can feature many organizations with different responsibilities. The domains provide the ability to extend different privileges and roles to different organizations by allowing the founders of the ordering service the ability to establish the initial rules and membership of the consortium. They also allow the organizations that join the consortium to create private application channels, govern their own business logic, and restrict access to the data that is put on the network. åŠŸèƒ½é½å…¨çš„Fabricç½‘ç»œå¯ä»¥ä½¿è®¸å¤šä¸ªç»„ç»‡æ‰¿æ‹…ä¸åŒçš„èŒè´£ã€‚åŸŸé€šè¿‡å…è®¸æ’åºæœåŠ¡çš„åˆ›å»ºè€…å»ºç«‹è”ç›Ÿçš„åˆå§‹è§„åˆ™å’Œæˆå‘˜èµ„æ ¼çš„èƒ½åŠ›æ¥æä¾›å°†ä¸åŒçš„ç‰¹æƒå’Œè§’è‰²æ‰©å±•åˆ°ä¸åŒç»„ç»‡çš„èƒ½åŠ›ã€‚åŸŸè¿˜å…è®¸åŠ å…¥è¯¥è”ç›Ÿçš„ç»„ç»‡åˆ›å»ºç§æœ‰åº”ç”¨ç¨‹åºé€šé“ï¼Œç®¡ç†ä»–ä»¬è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶é™åˆ¶å¯¹ç½‘ç»œä¸Šæ”¾ç½®çš„æ•°æ®çš„è®¿é—®ã€‚ The system channel configuration and a portion of each application channel configuration provides the ordering organizations control over which organizations are members of the consortium, how blocks are delivered to channels, and the consensus mechanism used by the nodes of the ordering service. ç³»ç»Ÿé€šé“é…ç½®å’Œæ¯ä¸ªåº”ç”¨ç¨‹åºé€šé“é…ç½®çš„ä¸€éƒ¨åˆ†ä¸ºæ’åºç»„ç»‡æä¾›äº†æ§åˆ¶ï¼Œè¿™äº›ç»„ç»‡å¯ä»¥æ§åˆ¶å“ªäº›ç»„ç»‡æ˜¯è”ç›Ÿçš„æˆå‘˜ï¼Œå¦‚ä½•å°†åŒºå—äº¤ä»˜åˆ°æ¸ é“ä»¥åŠæ’åºæœåŠ¡çš„èŠ‚ç‚¹æ‰€ä½¿ç”¨çš„å…±è¯†æœºåˆ¶ã€‚ The system channel configuration provides members of the consortium the ability to create channels. Application channels and ACLs are the mechanism that consortium organizations use to add or remove members from a channel and restrict access to data and smart contracts on a channel. ç³»ç»Ÿé€šé“æä¾›äº†å“ªäº›è”ç›Ÿçš„æˆå‘˜æœ‰èƒ½åŠ›åˆ›å»ºé€šé“ã€‚ç³»ç»Ÿé€šé“å’ŒACLæ˜¯è”ç›Ÿç»„ç»‡ç”¨äºåœ¨é€šé“ä¸­æ·»åŠ æˆ–åˆ é™¤æˆå‘˜å¹¶é™åˆ¶å¯¹é€šé“ä¸Šæ•°æ®å’Œæ™ºèƒ½åˆçº¦çš„è®¿é—®çš„æœºåˆ¶ã€‚ How do you write a policy in Fabric If you want to change anything in Fabric, the policy associated with the resource describes who needs to approve it, either with an explicit sign off from individuals, or an implicit sign off by a group. In the insurance domain, an explicit sign off could be a single member of the homeowners insurance agents group. And an implicit sign off would be analogous to requiring approval from a majority of the managerial members of the homeowners insurance group. This is particularly useful because the members of that group can change over time without requiring that the policy be updated. In Hyperledger Fabric, explicit sign offs in policies are expressed using the Signature syntax and implicit sign offs use the ImplicitMeta syntax. å¦‚æœè¦æ›´æ”¹Fabricä¸­çš„ä»»ä½•å†…å®¹ï¼Œåˆ™ä¸èµ„æºç›¸å…³è”çš„ç­–ç•¥æè¿°äº†è°éœ€è¦æ‰¹å‡†å®ƒï¼Œå¯ä»¥æ˜¯ä¸ªäººçš„æ˜¾ç¤ºç­¾åï¼Œä¹Ÿå¯ä»¥æ˜¯ç»„çš„éšå¼ç­¾åã€‚åœ¨ä¿é™©é¢†åŸŸï¼Œæ˜¾ç¤ºç­¾åå¯ä»¥æ˜¯æˆ¿ä¸»ä¿é™©ä»£ç†äººç»„çš„å•ä¸ªæˆå‘˜ã€‚éšå¼ç­¾åç±»ä¼¼äºè¦æ±‚æˆ¿ä¸»ä¿é™©é›†å›¢çš„å¤§å¤šæ•°ç®¡ç†äººå‘˜æ‰¹å‡†ã€‚è¿™ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºè¯¥ç»„çš„æˆå‘˜å¯ä»¥éšæ—¶é—´å˜åŒ–è€Œæ— éœ€æ›´æ–°ç­–ç•¥ã€‚åœ¨Hyperledger Fabricä¸­ï¼Œç­–ç•¥ä¸­çš„æ˜¾å¼ç­¾åä½¿ç”¨Signatureè¯­æ³•è¡¨ç¤ºï¼Œè€Œéšå¼ç­¾åä½¿ç”¨ImplicitMetaè¯­æ³•ã€‚ Signature policies Signature policies define specific types of users who must sign in order for a policy to be satisfied such as OR('Org1.peer', 'Org2.peer'). These policies are considered the most versatile because they allow for the construction of extremely specific rules like: â€œAn admin of org A and 2 other admins, or 5 of 6 organization adminsâ€. The syntax supports arbitrary combinations of AND, OR and NOutOf. For example, a policy can be easily expressed by using AND('Org1.member', 'Org2.member') which means that a signature from at least one member in Org1 AND one member in Org2 is required for the policy to be satisfied. Signature ç­–ç•¥å®šä¹‰äº†å¿…é¡»ç”±æŒ‡å®šç±»å‹çš„ç”¨æˆ·ç­¾åæ‰èƒ½æ»¡è¶³ç­–ç•¥ï¼Œä¾‹å¦‚ OR('Org1.peer', 'Org2.peer')ã€‚è¿™äº›ç­–ç•¥è¢«è®¤ä¸ºæ˜¯æœ€é€šç”¨çš„ï¼Œå› ä¸ºå®ƒä»¬å…è®¸æ„å»ºæå…¶ç‰¹å®šçš„è§„åˆ™ï¼Œä¾‹å¦‚ï¼šâ€œç»„ç»‡Açš„ä¸€ä¸ªç®¡ç†å‘˜å’Œ2ä¸ªå…¶ä»–ç®¡ç†å‘˜ï¼Œæˆ–6ä¸ªç»„ç»‡ä¸­çš„5ä¸ªç®¡ç†å‘˜â€ã€‚ ImplicitMeta policies ImplicitMeta policies are only valid in the context of channel configuration which is based on a tiered hierarchy of policies in a configuration tree. ImplicitMeta policies aggregate the result of policies deeper in the configuration tree that are ultimately defined by Signature policies. They are Implicit because they are constructed implicitly based on the current organizations in the channel configuration, and they are Meta because their evaluation is not against specific MSP principals, but rather against other sub-policies below them in the configuration tree. ImplicitMeta ç­–ç•¥ä»…åœ¨é€šé“é…ç½®çš„ä¸Šä¸‹æ–‡ä¸­æœ‰æ•ˆï¼Œè¯¥é…ç½®åŸºäºé…ç½®æ ‘ä¸­ç­–ç•¥çš„åˆ†å±‚å±‚æ¬¡ç»“æ„ã€‚ ImplicitMetaç­–ç•¥å°†åœ¨é…ç½®æ ‘ä¸­æ›´æ·±çš„ç­–ç•¥çš„ç»“æœæ±‡æ€»åœ¨ä¸€èµ·ï¼Œè¿™äº›ç­–ç•¥æœ€ç»ˆç”±ç­¾åç­–ç•¥å®šä¹‰ã€‚å®ƒä»¬æ˜¯Implicitçš„ï¼Œå› ä¸ºå®ƒä»¬æ˜¯åŸºäºæ¸ é“é…ç½®ä¸­çš„å½“å‰ç»„ç»‡éšå¼æ„é€ çš„ï¼Œä¹‹æ‰€ä»¥ç§°ä¸ºMetaï¼Œæ˜¯å› ä¸ºå®ƒä»¬çš„è¯„ä¼°ä¸æ˜¯é’ˆå¯¹ç‰¹å®šçš„MSPä¸»ä½“ï¼Œè€Œæ˜¯é’ˆå¯¹é…ç½®æ ‘ä¸­ä½äºå…¶ä¸‹æ–¹çš„å…¶ä»–å­ç­–ç•¥ã€‚ The following diagram illustrates the tiered policy structure for an application channel and shows how the ImplicitMeta channel configuration admins policy, named /Channel/Admins, is resolved when the sub-policies named Admins below it in the configuration hierarchy are satisfied where each check mark represents that the conditions of the sub-policy were satisfied. ä¸‹å›¾è¯´æ˜äº†åº”ç”¨ç¨‹åºé€šé“çš„åˆ†å±‚ç­–ç•¥ç»“æ„,å¹¶æ˜¾ç¤ºåä¸º /Channel/Adminsçš„ ImplicitMeta é€šé“é…ç½®ç®¡ç†å‘˜ç­–ç•¥ï¼Œå½“æ»¡è¶³é…ç½®å±‚æ¬¡ç»“æ„ä¸­ä½äºå…¶ä¸‹æ–¹çš„åä¸ºAdminsçš„å­ç­–ç•¥æ—¶ï¼Œå°†è§£å†³æ­¤é—®é¢˜ï¼Œå…¶ä¸­æ¯ä¸ªå¤é€‰æ ‡è®°è¡¨ç¤ºå·²æ»¡è¶³è¯¥å­ç­–ç•¥çš„æ¡ä»¶ã€‚ As you can see in the diagram above, ImplicitMeta policies, Type = 3, use a different syntax, &quot;&lt;ANY|ALL|MAJORITY&gt; &lt;SubPolicyName&gt;&quot;, for example: å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒImplicitMeta ç­–ç•¥ï¼Œ Type = 3ï¼Œä½¿ç”¨ä¸åŒçš„è¯­æ³•&quot;&lt;ANY|ALL|MAJORITY&gt; &lt;SubPolicyName&gt;&quot;ï¼Œä¾‹å¦‚ï¼š 1&#96;MAJORITY sub policy: Admins&#96; The diagram shows a sub-policy Admins, which refers to all the Admins policy below it in the configuration tree. You can create your own sub-policies and name them whatever you want and then define them in each of your organizations. è¯¥å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªå­ç­–ç•¥Adminsï¼Œå®ƒå¼•ç”¨é…ç½®æ ‘ä¸­å…¶ä¸‹æ–¹çš„æ‰€æœ‰Adminsç­–ç•¥ã€‚æ‚¨å¯ä»¥åˆ›å»ºè‡ªå·±çš„å­ç­–ç•¥ï¼Œå¹¶æ ¹æ®éœ€è¦å‘½åå®ƒä»¬ï¼Œç„¶ååœ¨ä½ çš„æ¯ä¸ªç»„ç»‡ä¸­å¯¹å…¶è¿›è¡Œå®šä¹‰ã€‚ As mentioned above, a key benefit of an ImplicitMeta policy such as MAJORITY Admins is that when you add a new admin organization to the channel, you do not have to update the channel policy. Therefore ImplicitMeta policies are considered to be more flexible as the consortium members change. The consortium on the orderer can change as new members are added or an existing member leaves with the consortium members agreeing to the changes, but no policy updates are required. Recall that ImplicitMeta policies ultimately resolve the Signature sub-policies underneath them in the configuration tree as the diagram shows. å¦‚ä¸Šæ‰€è¿°ï¼ŒImplicitMetaç­–ç•¥ï¼ˆä¾‹å¦‚MAJORITY Adminsï¼‰çš„ä¸»è¦ä¼˜åŠ¿åœ¨äºï¼Œå½“æ‚¨å‘é€šé“æ·»åŠ æ–°çš„ç®¡ç†å‘˜ç»„ç»‡æ—¶ï¼Œä¸å¿…æ›´æ–°é¢‘é“ç­–ç•¥ã€‚å› æ­¤ï¼Œéšç€è”ç›Ÿæˆå‘˜çš„å˜åŒ–ï¼ŒImplicitMetaç­–ç•¥è¢«è®¤ä¸ºæ›´åŠ çµæ´»ã€‚å½“æ·»åŠ æ–°æˆå‘˜æˆ–ç°æœ‰æˆå‘˜ç¦»å¼€æ—¶ï¼Œæ’åºè€…ä¸Šçš„è”ç›Ÿå¯ä»¥æ›´æ”¹ï¼Œè”ç›Ÿæˆå‘˜åŒæ„æ›´æ”¹ï¼Œä½†æ˜¯ä¸éœ€è¦æ›´æ–°ç­–ç•¥ã€‚å›æƒ³ä¸€ä¸‹ï¼ŒImplicitMetaç­–ç•¥æœ€ç»ˆåœ¨é…ç½®æ ‘ä¸­è§£å†³äº†å…¶ä¸‹æ–¹çš„Signatureå­ç­–ç•¥ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚ You can also define an application level implicit policy to operate across organizations, in a channel for example, and either require that ANY of them are satisfied, that ALL are satisfied, or that a MAJORITY are satisfied. This format lends itself to much better, more natural defaults, so that each organization can decide what it means for a valid endorsement. æ‚¨è¿˜å¯ä»¥å®šä¹‰ä¸€ä¸ªåº”ç”¨ç¨‹åºçº§åˆ«çš„éšå¼ç­–ç•¥ï¼Œä»¥åœ¨ç»„ç»‡ä¸­ï¼ˆä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªé€šé“ä¸­ï¼‰è¿›è¡Œæ“ä½œï¼Œå¹¶è¦æ±‚æ»¡è¶³å®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œæ»¡è¶³æ‰€æœ‰æ¡ä»¶æˆ–æ»¡è¶³å¤§å¤šæ•°æ¡ä»¶ã€‚è¿™ç§æ ¼å¼é€‚åˆäºæ›´å¥½ï¼Œæ›´è‡ªç„¶çš„é»˜è®¤è®¾ç½®ï¼Œä»¥ä¾¿æ¯ä¸ªç»„ç»‡å¯ä»¥å†³å®šå¯¹æœ‰æ•ˆèƒŒä¹¦çš„å«ä¹‰ã€‚ Further granularity and control can be achieved if you include NodeOUs in your organization definition. Organization Units (OUs) are defined in the Fabric CA client configuration file and can be associated with an identity when it is created. In Fabric, NodeOUs provide a way to classify identities in a digital certificate hierarchy. For instance, an organization having specific NodeOUs enabled could require that a â€˜peerâ€™ sign for it to be a valid endorsement, whereas an organization without any might simply require that any member can sign. å¦‚æœåœ¨ç»„ç»‡å®šä¹‰ä¸­åŒ…å«NodeOUï¼Œåˆ™å¯ä»¥å®ç°è¿›ä¸€æ­¥çš„ç²’åº¦å’Œæ§åˆ¶ã€‚ç»„ç»‡å•ä½ï¼ˆOUï¼‰åœ¨Fabric CAå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ï¼Œå¹¶ä¸”åœ¨åˆ›å»ºæ—¶å¯ä»¥ä¸èº«ä»½ç›¸å…³è”ã€‚NodeOUæä¾›äº†ä¸€ç§åœ¨æ•°å­—è¯ä¹¦å±‚æ¬¡ç»“æ„ä¸­å¯¹èº«ä»½è¿›è¡Œåˆ†ç±»çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¯ç”¨äº†ç‰¹å®šNodeOUçš„ç»„ç»‡å¯èƒ½è¦æ±‚â€œpeerâ€æ ‡å¿—æ‰èƒ½æœ‰æ•ˆåœ°èƒŒä¹¦ï¼Œè€Œåªæœ‰ç»„ç»‡è€Œä¸åŒ…å«ä»»ä½•å…¶ä»–å¯èƒ½åªè¦æ±‚ä»»ä½•æˆå‘˜éƒ½å¯ä»¥ç­¾åã€‚ An example: channel configuration policy Understanding policies begins with examining the configtx.yaml where the channel policies are defined. We can use the configtx.yaml file in the Fabric test network to see examples of both policy syntax types. We are going to examine the configtx.yaml file used by the fabric-samples/test-network sample. The first section of the file defines the organizations of the network. Inside each organization definition are the default policies for that organization, Readers, Writers, Admins, and Endorsement, although you can name your policies anything you want. Each policy has a Type which describes how the policy is expressed (Signature or ImplicitMeta) and a Rule. The test network example below shows the Org1 organization definition in the system channel, where the policy Type is Signature and the endorsement policy rule is defined as &quot;OR('Org1MSP.peer')&quot;. This policy specifies that a peer that is a member of Org1MSP is required to sign. It is these signature policies that become the sub-policies that the ImplicitMeta policies point to. 123456789101112131415161718192021222324252627282930313233################################################################################## SECTION: Application## - This section defines the values to encode into a config transaction or# genesis block for application related parameters#################################################################################Application: &amp;ApplicationDefaults # Organizations is the list of orgs which are defined as participants on # the application side of the network Organizations: # Policies defines the set of policies at this level of the config tree # For Application policies, their canonical path is # /Channel/Application/&lt;PolicyName&gt; Policies: Readers: Type: ImplicitMeta Rule: &quot;ANY Readers&quot; Writers: Type: ImplicitMeta Rule: &quot;ANY Writers&quot; Admins: Type: ImplicitMeta Rule: &quot;MAJORITY Admins&quot; LifecycleEndorsement: Type: ImplicitMeta Rule: &quot;MAJORITY Endorsement&quot; Endorsement: Type: ImplicitMeta Rule: &quot;MAJORITY Endorsement&quot; The next example shows the ImplicitMeta policy type used in the Application section of the configtx.yaml. These set of policies lie on the /Channel/Application/ path. If you use the default set of Fabric ACLs, these policies define the behavior of many important features of application channels, such as who can query the channel ledger, invoke a chaincode, or update a channel config. These policies point to the sub-policies defined for each organization. The Org1 defined in the section above contains Reader, Writer, and Admin sub-policies that are evaluated by the Reader, Writer, and Admin ImplicitMeta policies in the Application section. Because the test network is built with the default policies, you can use the example Org1 to query the channel ledger, invoke a chaincode, and approve channel updates for any test network channel that you create. 123456789101112131415161718192021222324252627282930313233################################################################################## SECTION: Application## - This section defines the values to encode into a config transaction or# genesis block for application related parameters#################################################################################Application: &amp;ApplicationDefaults # Organizations is the list of orgs which are defined as participants on # the application side of the network Organizations: # Policies defines the set of policies at this level of the config tree # For Application policies, their canonical path is # /Channel/Application/&lt;PolicyName&gt; Policies: Readers: Type: ImplicitMeta Rule: &quot;ANY Readers&quot; Writers: Type: ImplicitMeta Rule: &quot;ANY Writers&quot; Admins: Type: ImplicitMeta Rule: &quot;MAJORITY Admins&quot; LifecycleEndorsement: Type: ImplicitMeta Rule: &quot;MAJORITY Endorsement&quot; Endorsement: Type: ImplicitMeta Rule: &quot;MAJORITY Endorsement&quot; Fabric chaincode lifecycle In the Fabric 2.0 release, a new chaincode lifecycle process was introduced, whereby a more democratic process is used to govern chaincode on the network. The new process allows multiple organizations to vote on how a chaincode will be operated before it can be used on a channel. This is significant because it is the combination of this new lifecycle process and the policies that are specified during that process that dictate the security across the network. More details on the flow are available in the Fabric chaincode lifecycle concept topic, but for purposes of this topic you should understand how policies are used in this flow. The new flow includes two steps where policies are specified: when chaincode is approved by organization members, and when it is committed to the channel. The Application section of the configtx.yaml file includes the default chaincode lifecycle endorsement policy. In a production environment you would customize this definition for your own use case. 123456789101112131415161718192021222324252627282930313233################################################################################## SECTION: Application## - This section defines the values to encode into a config transaction or# genesis block for application related parameters#################################################################################Application: &amp;ApplicationDefaults # Organizations is the list of orgs which are defined as participants on # the application side of the network Organizations: # Policies defines the set of policies at this level of the config tree # For Application policies, their canonical path is # /Channel/Application/&lt;PolicyName&gt; Policies: Readers: Type: ImplicitMeta Rule: &quot;ANY Readers&quot; Writers: Type: ImplicitMeta Rule: &quot;ANY Writers&quot; Admins: Type: ImplicitMeta Rule: &quot;MAJORITY Admins&quot; LifecycleEndorsement: Type: ImplicitMeta Rule: &quot;MAJORITY Endorsement&quot; Endorsement: Type: ImplicitMeta Rule: &quot;MAJORITY Endorsement&quot; The LifecycleEndorsement policy governs who needs to approve a chaincode definition. LifecycleEndorsement ç­–ç•¥ç®¡ç†è°éœ€è¦æ‰¹å‡†é“¾ç å®šä¹‰ The Endorsement policy is the default endorsement policy for a chaincode. More on this below. Endorsementç­–ç•¥æ˜¯é“¾ç çš„é»˜è®¤èƒŒä¹¦ç­–ç•¥ï¼Œè¯¦æƒ…åœ¨ä¸‹é¢ã€‚ Chaincode endorsement policies The endorsement policy is specified for a chaincode when it is approved and committed to the channel using the Fabric chaincode lifecycle (that is, one endorsement policy covers all of the state associated with a chaincode). The endorsement policy can be specified either by reference to an endorsement policy defined in the channel configuration or by explicitly specifying a Signature policy. åœ¨ä½¿ç”¨Fabricé“¾ç ç”Ÿå‘½å‘¨æœŸæ‰¹å‡†é“¾ç å¹¶å°†å…¶æäº¤ç»™é€šé“æ—¶ä¾¿æŒ‡å®šäº†é“¾ç çš„èƒŒä¹¦ç­–ç•¥ï¼ˆå³ï¼Œä¸€ç§èƒŒä¹¦ç­–ç•¥æ¶µç›–äº†ä¸é“¾ç ç›¸å…³è”çš„æ‰€æœ‰çŠ¶æ€ï¼‰ã€‚å¯ä»¥é€šè¿‡å‚è€ƒåœ¨é€šé“é…ç½®ä¸­å®šä¹‰çš„èƒŒä¹¦ç­–ç•¥æ¥æŒ‡å®šèƒŒä¹¦ç­–ç•¥ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ˜¾å¼æŒ‡å®šç­¾åç­–ç•¥æ¥æŒ‡å®šèƒŒä¹¦ç­–ç•¥ã€‚ If an endorsement policy is not explicitly specified during the approval step, the default Endorsement policy &quot;MAJORITY Endorsement&quot; is used which means that a majority of the peers belonging to the different channel members (organizations) need to execute and validate a transaction against the chaincode in order for the transaction to be considered valid. This default policy allows organizations that join the channel to become automatically added to the chaincode endorsement policy. If you donâ€™t want to use the default endorsement policy, use the Signature policy format to specify a more complex endorsement policy (such as requiring that a chaincode be endorsed by one organization, and then one of the other organizations on the channel). Signature policies also allow you to include principals which are simply a way of matching an identity to a role. Principals are just like user IDs or group IDs, but they are more versatile because they can include a wide range of properties of an actorâ€™s identity, such as the actorâ€™s organization, organizational unit, role or even the actorâ€™s specific identity. When we talk about principals, they are the properties which determine their permissions. Principals are described as â€˜MSP.ROLEâ€™, where MSP represents the required MSP ID (the organization), and ROLE represents one of the four accepted roles: Member, Admin, Client, and Peer. A role is associated to an identity when a user enrolls with a CA. You can customize the list of roles available on your Fabric CA. Some examples of valid principals are: â€˜Org0.Adminâ€™: an administrator of the Org0 MSP â€˜Org1.Memberâ€™: a member of the Org1 MSP â€˜Org1.Clientâ€™: a client of the Org1 MSP â€˜Org1.Peerâ€™: a peer of the Org1 MSP â€˜OrdererOrg.Ordererâ€™: an orderer in the OrdererOrg MSP There are cases where it may be necessary for a particular state (a particular key-value pair, in other words) to have a different endorsement policy. This state-based endorsement allows the default chaincode-level endorsement policies to be overridden by a different policy for the specified keys. For a deeper dive on how to write an endorsement policy refer to the topic on Endorsement policies in the Operations Guide. Note: Policies work differently depending on which version of Fabric you are using: In Fabric releases prior to 2.0, chaincode endorsement policies can be updated during chaincode instantiation or by using the chaincode lifecycle commands. If not specified at instantiation time, the endorsement policy defaults to â€œany member of the organizations in the channelâ€. For example, a channel with â€œOrg1â€ and â€œOrg2â€ would have a default endorsement policy of â€œOR(â€˜Org1.memberâ€™, â€˜Org2.memberâ€™)â€. Starting with Fabric 2.0, Fabric introduced a new chaincode lifecycle process that allows multiple organizations to agree on how a chaincode will be operated before it can be used on a channel. The new process requires that organizations agree to the parameters that define a chaincode, such as name, version, and the chaincode endorsement policy. Overriding policy definitions Hyperledger Fabric includes default policies which are useful for getting started, developing, and testing your blockchain, but they are meant to be customized in a production environment. You should be aware of the default policies in the configtx.yaml file. Channel configuration policies can be extended with arbitrary verbs, beyond the default Readers, Writers, Admins in configtx.yaml. The orderer system and application channels are overridden by issuing a config update when you override the default policies by editing the configtx.yaml for the orderer system channel or the configtx.yaml for a specific channel. See the topic on Updating a channel configuration for more information.","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"Key Concepts","slug":"åŒºå—é“¾/Hyperledger-Fabric/Key-Concepts","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/Key-Concepts/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"Policies","slug":"Policies","permalink":"https://guozhe001.github.io/tags/Policies/"}]},{"title":"Peers","slug":"blockchain/fabric/å…³é”®æ¦‚å¿µ/Peers","date":"2021-04-01T10:18:21.479Z","updated":"2021-04-01T10:18:21.480Z","comments":true,"path":"2021/04/01/blockchain/fabric/å…³é”®æ¦‚å¿µ/Peers/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Peers/","excerpt":"","text":"å®˜æ–¹æ–‡æ¡£ï¼šPeers Peers A blockchain network is comprised primarily of a set of peer nodes (or, simply, peers). Peers are a fundamental element of the network because they host ledgers and smart contracts. Recall that a ledger immutably records all the transactions generated by smart contracts (which in Hyperledger Fabric are contained in a chaincode, more on this later). Smart contracts and ledgers are used to encapsulate the shared processes and shared information in a network, respectively. These aspects of a peer make them a good starting point to understand a Fabric network. åŒºå—é“¾ç½‘ç»œä¸»è¦ç”±ä¸€ç»„peerèŠ‚ç‚¹ç»„æˆï¼ˆç®€ç§°peersï¼‰ã€‚peersæ˜¯ç½‘ç»œçš„åŸºæœ¬å…ƒç´ ï¼Œæ˜¯å› ä¸ºå®ƒä»¬æ‰˜ç®¡è´¦æœ¬å’Œæ™ºèƒ½åˆçº¦ã€‚å›æƒ³ä¸€ä¸‹ï¼Œè´¦æœ¬ä¸€æˆä¸å˜åœ°è®°å½•äº†æ™ºèƒ½åˆçº¦ç”Ÿæˆçš„æ‰€æœ‰äº¤æ˜“ã€‚æ™ºèƒ½åˆçº¦å’Œè´¦æœ¬åˆ†åˆ«ç”¨äºå°è£…ç½‘ç»œä¸­çš„å…±äº«ç¨‹åºå’Œå…±äº«ä¿¡æ¯ã€‚peersçš„è¿™äº›æ–¹é¢ä½¿å®ƒä»¬æˆä¸ºäº†è§£Fabricç½‘ç»œçš„è‰¯å¥½èµ·ç‚¹ã€‚ Other elements of the blockchain network are of course important: ledgers and smart contracts, orderers, policies, channels, applications, organizations, identities, and membership, and you can read more about them in their own dedicated sections. This section focusses on peers, and their relationship to those other elements in a Fabric network. ç»„æˆåŒºå—é“¾ç½‘ç»œçš„å…¶ä»–å…ƒç´ å½“ç„¶ä¹Ÿå¾ˆé‡è¦ï¼šè´¦æœ¬å’Œæ™ºèƒ½åˆçº¦ã€orderersã€ç­–ç•¥ã€é€šé“ã€åº”ç”¨ç¨‹åºã€ç»„ç»‡ã€èº«ä»½è¯†åˆ«ï¼Œä»¥åŠè”ç›Ÿæˆå‘˜ï¼Œæ‚¨å¯ä»¥åœ¨ä»–ä»¬è‡ªå·±çš„ä¸“ç”¨éƒ¨åˆ†ä¸­é˜…è¯»æœ‰å…³å®ƒä»¬çš„æ›´å¤šä¿¡æ¯ã€‚æœ¬èŠ‚é‡ç‚¹ä»‹ç»peersåŠå…¶ä¸Fabricç½‘ç»œä¸­å…¶ä»–å…ƒç´ çš„å…³ç³»ã€‚ A blockchain network is comprised of peer nodes, each of which can hold copies of ledgers and copies of smart contracts. In this example, the network N consists of peers P1, P2 and P3, each of which maintain their own instance of the distributed ledger L1. P1, P2 and P3 use the same chaincode, S1, to access their copy of that distributed ledger. æ™ºèƒ½åˆçº¦çš„ç½‘ç»œæ˜¯ç”±peerèŠ‚ç‚¹æ„æˆï¼Œæ¯ä¸ªpeerèŠ‚ç‚¹éƒ½æ‰˜ç®¡è´¦æœ¬çš„å‰¯æœ¬ä»¥åŠæ™ºèƒ½åˆçº¦çš„å‰¯æœ¬ã€‚ç•¥ã€‚ã€‚ã€‚ Peers can be created, started, stopped, reconfigured, and even deleted. They expose a set of APIs that enable administrators and applications to interact with the services that they provide. Weâ€™ll learn more about these services in this section. Peerså¯ä»¥è¢«åˆ é™¤ã€å¯åŠ¨ã€åœæ­¢ã€é‡æ–°é…ç½®ç”šè‡³åˆ é™¤ã€‚å®ƒä»¬æš´éœ²äº†ä¸€ç»„APIï¼Œä½¿ç®¡ç†å‘˜å’Œåº”ç”¨ç¨‹åºå¯ä»¥ä¸å…¶æä¾›çš„æœåŠ¡è¿›è¡Œäº¤äº’ã€‚æˆ‘ä»¬å°†åœ¨æœ¬èŠ‚ä¸­è¯¦ç»†äº†è§£è¿™äº›æœåŠ¡ã€‚ A word on terminologyï¼ˆæœ¯è¯­ï¼‰ Fabric implements smart contracts with a technology concept it calls chaincode â€” simply a piece of code that accesses the ledger, written in one of the supported programming languages. In this topic, weâ€™ll usually use the term chaincode, but feel free to read it as smart contract if youâ€™re more used to that term. Itâ€™s the same thing! If you want to learn more about chaincode and smart contracts, check out our documentation on smart contracts and chaincode. Fabricé€šè¿‡ç§°ä¸ºé“¾ç çš„æŠ€æœ¯æ¦‚å¿µå®ç°æ™ºèƒ½åˆçº¦ï¼Œchaincodeæ˜¯ç”¨ä¸€ç§ä½¿ç”¨Fabricæ”¯æŒçš„ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„è®¿é—®è´¦æœ¬çš„ä¸€æ®µä»£ç ã€‚åœ¨æœ¬ä¸»é¢˜ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨chaincodeä¸€è¯ï¼Œä½†å¦‚æœæ‚¨æ›´ä¹ æƒ¯smart contractæœ¯è¯­ï¼Œä¹Ÿå¯ä»¥å°†å…¶ä½œä¸ºæ™ºèƒ½åˆçº¦é˜…è¯»ã€‚Itâ€™s the same thing! If you want to learn more about chaincode and smart contracts, check out our documentation on smart contracts and chaincode. Ledgers and Chaincode Letâ€™s look at a peer in a little more detail. We can see that itâ€™s the peer that hosts both the ledger and chaincode. More accurately, the peer actually hosts instances of the ledger, and instances of chaincode. Note that this provides a deliberate redundancy in a Fabric network â€” it avoids single points of failure. Weâ€™ll learn more about the distributed and decentralized nature of a blockchain network later in this section. è®©æˆ‘ä»¬å†è¯¦ç»†çš„çœ‹ä¸€ä¸‹peerã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°peeræ—¢æ‰˜ç®¡äº†è´¦æœ¬ä¹Ÿæ‰˜ç®¡äº†é“¾ç ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œpeerå®é™…ä¸Šæ‰˜ç®¡è´¦æœ¬å®ä¾‹å’Œé“¾ç å®ä¾‹ã€‚è¯·æ³¨æ„ï¼Œè¿™åœ¨Fabricç½‘ç»œä¸­æä¾›äº†æœ‰æ„çš„å†—ä½™-é¿å…äº†å•ç‚¹æ•…éšœã€‚åœ¨æœ¬èŠ‚çš„åé¢ï¼Œæˆ‘ä»¬å°†è¯¦ç»†äº†è§£åŒºå—é“¾ç½‘ç»œçš„åˆ†å¸ƒå¼å’Œåˆ†æ•£å¼æ€§è´¨ã€‚ A peer hosts instances of ledgers and instances of chaincodes. In this example, P1 hosts an instance of ledger L1 and an instance of chaincode S1. There can be many ledgers and chaincodes hosted on an individual peer. Because a peer is a host for ledgers and chaincodes, applications and administrators must interact with a peer if they want to access these resources. Thatâ€™s why peers are considered the most fundamental building blocks of a Fabric network. When a peer is first created, it has neither ledgers nor chaincodes. Weâ€™ll see later how ledgers get created, and how chaincodes get installed, on peers. å› ä¸ºpeeræ‰˜ç®¡äº†è´¦æœ¬å’Œé“¾ç ï¼Œå› æ­¤åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿç®¡ç†å‘˜å¦‚æœæƒ³è¦è·å–è¿™äº›èµ„æºå¿…é¡»ä¸peerè¿›è¡Œäº¤äº’ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå°†peerè§†ä¸ºFabricç½‘ç»œçš„æœ€åŸºæœ¬ç»„æˆéƒ¨åˆ†ã€‚å½“peeråœ¨ä¸€å¼€å§‹è¢«åˆ›å»ºæ—¶ï¼Œå®ƒæ—¢æ²¡æœ‰è´¦æœ¬ä¹Ÿæ²¡æœ‰é“¾ç ã€‚æˆ‘ä»¬ä¼šåœ¨åé¢çœ‹åˆ°åœ¨peersä¸Šè´¦æœ¬æ˜¯å¦‚ä½•åˆ›å»ºçš„ä»¥åŠé“¾ç æ˜¯å¦‚ä½•å®‰è£…çš„ã€‚ Multiple Ledgers A peer is able to host more than one ledger, which is helpful because it allows for a flexible system design. The simplest configuration is for a peer to manage a single ledger, but itâ€™s absolutely appropriate for a peer to host two or more ledgers when required. A peer hosting multiple ledgers. Peers host one or more ledgers, and each ledger has zero or more chaincodes that apply to them. In this example, we can see that the peer P1 hosts ledgers L1 and L2. Ledger L1 is accessed using chaincode S1. Ledger L2 on the other hand can be accessed using chaincodes S1 and S2. peeræ‰˜ç®¡äº†ä¸€ä¸ªæˆ–å¤šä¸ªè´¦æœ¬ï¼Œå¹¶ä¸”æ‰˜ç®¡äº†0ä¸ªæˆ–æ›´å¤šçš„é“¾ç  Although it is perfectly possible for a peer to host a ledger instance without hosting any chaincodes which access that ledger, itâ€™s rare that peers are configured this way. The vast majority of peers will have at least one chaincode installed on it which can query or update the peerâ€™s ledger instances. Itâ€™s worth mentioning in passing that, whether or not users have installed chaincodes for use by external applications, peers also have special system chaincodes that are always present. These are not discussed in detail in this topic. å°½ç®¡å¯¹ç­‰ç‚¹å®Œå…¨æœ‰å¯èƒ½æ‰˜ç®¡ä¸€ä¸ªè´¦æœ¬å®ä¾‹è€Œä¸æ‰˜ç®¡ä»»ä½•è®¿é—®è¯¥è´¦æœ¬çš„é“¾ç ï¼Œä½†å¾ˆå°‘æœ‰peerä»¥è¿™ç§æ–¹å¼é…ç½®ã€‚ç»å¤§å¤šæ•°å¯¹ç­‰ç‚¹å°†è‡³å°‘å®‰è£…ä¸€ä¸ªé“¾ç ï¼Œå¯ä»¥æŸ¥è¯¢æˆ–æ›´æ–°peerçš„è´¦æœ¬å®ä¾‹ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ— è®ºç”¨æˆ·æ˜¯å¦å®‰è£…äº†ä¾›å¤–éƒ¨åº”ç”¨ç¨‹åºä½¿ç”¨çš„é“¾ç ï¼Œpeeréƒ½æœ‰å§‹ç»ˆå­˜åœ¨çš„ç‰¹æ®Šçš„ç³»ç»Ÿé“¾ç ã€‚è¿™äº›å°†ä¸åœ¨æœ¬ä¸»é¢˜ä¸­è¯¦ç»†è®¨è®ºã€‚ Multiple Chaincodes There isnâ€™t a fixed relationship between the number of ledgers a peer has and the number of chaincodes that can access that ledger. A peer might have many chaincodes and many ledgers available to it. Peeræ‹¥æœ‰çš„è´¦æœ¬æ•°é‡ä¸å¯ä»¥è®¿é—®è¯¥è´¦æœ¬çš„é“¾ç æ•°é‡ä¹‹é—´çš„å…³ç³»ä¸æ˜¯å›ºå®šçš„ã€‚ä¸€ä¸ªpeerå¯èƒ½æœ‰è®¸å¤šå¯ç”¨çš„é“¾ç å’Œåˆ†ç±»å¸ã€‚ An example of a peer hosting multiple chaincodes. Each ledger can have many chaincodes which access it. In this example, we can see that peer P1 hosts ledgers L1 and L2, where L1 is accessed by chaincodes S1 and S2, and L2 is accessed by S1 and S3. We can see that S1 can access both L1 and L2. å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ—¢å¯ä»¥æœ‰å¤šä¸ªé“¾ç è®¿é—®åŒä¸€ä¸ªè´¦æœ¬ï¼›ä¹Ÿå¯ä»¥ä¸€ä¸ªé“¾ç è®¿é—®å¤šä¸ªè´¦æœ¬ã€‚ Weâ€™ll see a little later why the concept of channels in Fabric is important when hosting multiple ledgers or multiple chaincodes on a peer. æˆ‘ä»¬ç¨åå†çœ‹åˆ°å½“åœ¨peerä¸Šæ‰˜ç®¡å¤šä¸ªåˆ†ç±»å¸æˆ–å¤šä¸ªé“¾ç æ—¶ï¼ŒFabricä¸­çš„é€šé“æ¦‚å¿µé‡è¦çš„åŸå› ã€‚ Applications and Peers Weâ€™re now going to show how applications interact with peers to access the ledger. Ledger-query interactions involve a simple three-step dialogue between an application and a peer; ledger-update interactions are a little more involved, and require two extra steps. Weâ€™ve simplified these steps a little to help you get started with Fabric, but donâ€™t worry â€” whatâ€™s most important to understand is the difference in application-peer interactions for ledger-query compared to ledger-update transaction styles. ç°åœ¨ï¼Œæˆ‘ä»¬å°†å±•ç¤ºåº”ç”¨ç¨‹åºå¦‚ä½•ä¸peeräº¤äº’ä»¥è®¿é—®è´¦æœ¬ã€‚è´¦æœ¬æŸ¥è¯¢äº¤äº’åŒ…æ‹¬åº”ç”¨ç¨‹åºå’Œpeerä¹‹é—´ç®€å•çš„ä¸‰æ­¥å¯¹è¯ï¼›è´¦æœ¬æ›´æ–°çš„äº¤äº’è¦å¤æ‚å¾—å¤šï¼Œå¹¶ä¸”éœ€è¦ä¸¤ä¸ªé¢å¤–çš„æ­¥éª¤ã€‚æˆ‘ä»¬å·²ç®€åŒ–äº†è¿™äº›æ­¥éª¤ï¼Œä»¥å¸®åŠ©æ‚¨å¼€å§‹ä½¿ç”¨Fabricï¼Œä½†è¯·æ”¾å¿ƒï¼Œæœ€é‡è¦çš„æ˜¯è¦äº†è§£è´¦æœ¬æŸ¥è¯¢ä¸è´¦æœ¬æ›´æ–°ä¸¤ç§äº¤æ˜“æ–¹å¼ä¹‹é—´çš„åº”ç”¨ç¨‹åºå’Œpeeräº¤äº’çš„å·®å¼‚ã€‚ Applications always connect to peers when they need to access ledgers and chaincodes. The Fabric Software Development Kit (SDK) makes this easy for programmers â€” its APIs enable applications to connect to peers, invoke chaincodes to generate transactions, submit transactions to the network that will get ordered, validated and committed to the distributed ledger, and receive events when this process is complete. å½“åº”ç”¨ç¨‹åºéœ€è¦è®¿é—®è´¦æœ¬å’Œé“¾ç æ—¶æ€»æ˜¯ä¸peeré“¾æ¥ã€‚Fabricçš„SDKè®©è¿™å˜å¾—ç®€å•ï¼Œå®ƒçš„APIå¯ä»¥è®©åº”ç”¨ç¨‹åºé“¾æ¥åˆ°peersï¼Œè°ƒç”¨é“¾ç æ¥ç”Ÿæˆäº¤æ˜“ï¼Œæäº¤äº¤æ˜“åˆ°ç½‘ç»œå¹¶ä¸”è·å¾—æ’åºï¼ŒéªŒè¯å’Œæäº¤åˆ°åˆ†å¸ƒå¼è´¦æœ¬ä»¥åŠå½“è¿™äº›ç¨‹åºç»“æŸæ—¶æ¥æ”¶äº‹ä»¶ã€‚ Through a peer connection, applications can execute chaincodes to query or update a ledger. The result of a ledger query transaction is returned immediately, whereas ledger updates involve a more complex interaction between applications, peers and orderers. Letâ€™s investigate this in a little more detail. é€šè¿‡è¿æ¥åˆ°ä¸€ä¸ªpeerï¼Œåº”ç”¨ç¨‹åºå¯ä»¥æ‰§è¡Œé“¾ç æ¥æŸ¥è¯¢æˆ–è€…æ›´æ–°è´¦æœ¬ã€‚è´¦æœ¬çš„æŸ¥è¯¢äº¤æ˜“ç»“æœå°†ç«‹å³è¿”å›ï¼Œä½†æ˜¯è´¦æœ¬çš„æ›´æ–°å°†æ¶‰åŠåº”ç”¨ç¨‹åºã€peerså’Œorderersä¹‹é—´çš„æ›´å¤æ‚çš„çš„äº¤äº’ã€‚è®©æˆ‘ä»¬å¯¹æ­¤è¿›è¡Œæ›´è¯¦ç»†çš„ç ”ç©¶ã€‚ Peers, in conjunction with orderers, ensure that the ledger is kept up-to-date on every peer. In this example, application A connects to P1 and invokes chaincode S1 to query or update the ledger L1. P1 invokes S1 to generate a proposal response that contains a query result or a proposed ledger update. Application A receives the proposal response and, for queries, the process is now complete. For updates, A builds a transaction from all of the responses, which it sends to O1 for ordering. O1 collects transactions from across the network into blocks, and distributes these to all peers, including P1. P1 validates the transaction before committing to L1. Once L1 is updated, P1 generates an event, received by A, to signify completion. æŸ¥è¯¢æ—¶æœ‰å›¾ä¸­çš„1ã€2ã€3ä¸‰ä¸ªæ­¥éª¤ã€‚æ›´æ–°æ—¶éœ€è¦é¢å¤–çš„4ã€5ä¸¤ä¸ªæ­¥éª¤çš„æ“ä½œã€‚ 1 åº”ç”¨ç¨‹åºé“¾æ¥åˆ°peer 2 åº”ç”¨ç¨‹åºï¼ˆå¸¦ç€äº¤æ˜“æè®®ï¼‰è°ƒç”¨é“¾ç  2.1 peerï¼ˆå¸¦ç€äº¤æ˜“æè®®ï¼‰è°ƒç”¨æ‰˜ç®¡åœ¨peerä¸Šçš„é“¾ç  2.2 é“¾ç ç”ŸæˆæŸ¥è¯¢æˆ–æ›´æ–°çš„æè®®å“åº” 3 peeræŠŠæè®®å“åº”è¿”å›ç»™åº”ç”¨ç¨‹åº 4 åº”ç”¨ç¨‹åºè¯·æ±‚æ’åºèŠ‚ç‚¹å¯¹äº¤æ˜“è¿›è¡Œæ’åº 4.1 æ’åºèŠ‚ç‚¹æŠŠæ’å¥½åºå¹¶æ‰“åŒ…åœ¨åŒºå—ä¸­äº¤æ˜“å‘é€ç»™peers 4.2 peerä½¿ç”¨äº¤æ˜“åŒºå—æ›´æ–°æœ¬åœ°çš„è´¦æœ¬ 5 peerå‘å‡ºè´¦æœ¬æ›´æ–°çš„äº‹ä»¶ A peer can return the results of a query to an application immediately since all of the information required to satisfy the query is in the peerâ€™s local copy of the ledger. Peers never consult with other peers in order to respond to a query from an application. Applications can, however, connect to one or more peers to issue a query; for example, to corroborate a result between multiple peers, or retrieve a more up-to-date result from a different peer if thereâ€™s a suspicion that information might be out of date. In the diagram, you can see that ledger query is a simple three-step process. peerå¯ä»¥é©¬ä¸ŠæŠŠæŸ¥è¯¢ç»“æœè¿”å›ç»™åº”ç”¨ç¨‹åºæ˜¯å› ä¸ºæŸ¥è¯¢çš„æ‰€æœ‰ä¿¡æ¯éƒ½å­˜åœ¨äºpeerèŠ‚ç‚¹çš„æœ¬åœ°è´¦æœ¬å‰¯æœ¬ä¸­ã€‚Peersä»ä¸ä¸å…¶ä»–peeråå•†ä»¥å“åº”æ¥è‡ªåº”ç”¨ç¨‹åºçš„æŸ¥è¯¢ã€‚ä½†æ˜¯åº”ç”¨ç¨‹åºå¯ä»¥é“¾æ¥ä¸€ä¸ªæˆ–å¤šä¸ªpeeræ¥å‘å‡ºæŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼Œåœ¨å¤šä¸ªpeerä¹‹é—´ç¡®è®¤ç»“æœï¼Œæˆ–è€…å¦‚æœæ€€ç–‘ä¿¡æ¯å¯èƒ½å·²è¿‡æ—¶ï¼Œåˆ™ä»å¦ä¸€ä¸ªpeeræ£€ç´¢æœ€æ–°ç»“æœã€‚ An update transaction starts in the same way as a query transaction, but has two extra steps. Although ledger-updating applications also connect to peers to invoke a chaincode, unlike with ledger-querying applications, an individual peer cannot perform a ledger update at this time, because other peers must first agree to the change â€” a process called consensus. Therefore, peers return to the application a proposed update â€” one that this peer would apply subject to other peersâ€™ prior agreement. The first extra step â€” step four â€” requires that applications send an appropriate set of matching proposed updates to the entire network of peers as a transaction for commitment to their respective ledgers. This is achieved by the application by using an orderer to package transactions into blocks, and distributing them to the entire network of peers, where they can be verified before being applied to each peerâ€™s local copy of the ledger. As this whole ordering processing takes some time to complete (seconds), the application is notified asynchronously, as shown in step five. Later in this section, youâ€™ll learn more about the detailed nature of this ordering process â€” and for a really detailed look at this process see the Transaction Flow topic. Peers and Channels Although this section is about peers rather than channels, itâ€™s worth spending a little time understanding how peers interact with each other, and with applications, via channels â€” a mechanism by which a set of components within a blockchain network can communicate and transact privately. å°½ç®¡æœ¬éƒ¨åˆ†ä»‹ç»çš„æ˜¯peerè€Œä¸æ˜¯é€šé“ï¼Œä½†æ˜¯å€¼å¾—èŠ±ä¸€äº›æ—¶é—´æ¥äº†è§£peerå¦‚ä½•é€šè¿‡é€šé“ä¸å…¶ä»–peerä»¥åŠåº”ç”¨ç¨‹åºè¿›è¡Œäº¤äº’ã€‚é€šé“æ˜¯ä¸€ç§æœºåˆ¶ï¼ŒåŒºå—é“¾ç½‘ç»œä¸­çš„ä¸€ç»„ç»„ä»¶å¯ä»¥é€šè¿‡è¯¥æœºåˆ¶è¿›è¡Œç§ä¸‹é€šä¿¡å’Œäº¤æ˜“ã€‚ These components are typically peer nodes, orderer nodes and applications and, by joining a channel, they agree to collaborate to collectively share and manage identical copies of the ledger associated with that channel. Conceptually, you can think of channels as being similar to groups of friends (though the members of a channel certainly donâ€™t need to be friends!). A person might have several groups of friends, with each group having activities they do together. These groups might be totally separate (a group of work friends as compared to a group of hobby friends), or there can be some crossover between them. Nevertheless, each group is its own entity, with â€œrulesâ€ of a kind. è¿™äº›ç»„ä»¶é€šå¸¸æ˜¯peerèŠ‚ç‚¹ï¼ŒordererèŠ‚ç‚¹å’Œåº”ç”¨ç¨‹åºï¼Œé€šè¿‡åŠ å…¥é€šé“ï¼Œå®ƒä»¬åŒæ„åä½œä»¥å…±åŒå…±äº«å’Œç®¡ç†ä¸è¯¥é€šé“å…³è”çš„è´¦æœ¬çš„ç›¸åŒå‰¯æœ¬ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œæ‚¨å¯ä»¥å°†é€šé“è§†ä¸ºä¸æœ‹å‹ç»„ç›¸ä¼¼ã€‚ä¸€ä¸ªäººå¯èƒ½æœ‰å¤šç»„æœ‹å‹ï¼Œæ¯ç»„éƒ½æœ‰ä»–ä»¬ä¸€èµ·åšçš„æ´»åŠ¨ã€‚è¿™äº›ç»„å¯èƒ½å®Œå…¨åˆ†å¼€ï¼Œå®ƒä»¬ä¹‹é—´ä¹Ÿå¯èƒ½ä¼šæœ‰äº¤å‰ã€‚ä½†æ˜¯ï¼Œæ¯ä¸ªç»„éƒ½æ˜¯å…¶è‡ªå·±çš„å®ä½“ï¼Œå…·æœ‰æŸç§â€œè§„åˆ™â€ã€‚ Channels allow a specific set of peers and applications to communicate with each other within a blockchain network. In this example, application A can communicate directly with peers P1 and P2 using channel C. You can think of the channel as a pathway for communications between particular applications and peers. (For simplicity, orderers are not shown in this diagram, but must be present in a functioning network.) åœ¨åŒºå—é“¾ç½‘ç»œä¸­é€šé“å…è®¸æŒ‡å®šçš„ä¸€ç»„peerå’Œåº”ç”¨ç¨‹åºè¿›è¡Œé€šä¿¡ã€‚ We see that channels donâ€™t exist in the same way that peers do â€” itâ€™s more appropriate to think of a channel as a logical structure that is formed by a collection of physical peers. It is vital to understand this point â€” peers provide the control point for access to, and management of, channels. é€šé“æ˜¯ä¸€ç»„ç‰©ç†peerçš„é€»è¾‘ç»“æ„ï¼Œpeeræä¾›äº†å¯¹é€šé“çš„è®¿é—®ä¸ç®¡ç†æƒé™ã€‚ Peers and Organizations Now that you understand peers and their relationship to ledgers, chaincodes and channels, youâ€™ll be able to see how multiple organizations come together to form a blockchain network. Blockchain networks are administered by a collection of organizations rather than a single organization. Peers are central to how this kind of distributed network is built because they are owned by â€” and are the connection points to the network for â€” these organizations. åŒºå—é“¾ç½‘ç»œç”±å¤šä¸ªç»„ç»‡ç®¡ç†ï¼Œè€Œä¸æ˜¯å•ä¸ªç»„ç»‡ç®¡ç†ã€‚peerså¯¹äºè¿™ç§åˆ†å¸ƒå¼ç½‘ç»œçš„æ„å»ºè‡³å…³é‡è¦å› ä¸ºä»–ä»¬å±äºä»–ä»¬çš„ç»„ç»‡ï¼Œå¹¶ä¸”ä»–ä»¬æ˜¯ä»–ä»¬ç»„ç»‡çš„ç½‘ç»œè¿æ¥ç‚¹ã€‚ Peers in a blockchain network with multiple organizations. The blockchain network is built up from the peers owned and contributed by the different organizations. In this example, we see four organizations contributing eight peers to form a network. The channel C connects five of these peers in the network N â€” P1, P3, P5, P7 and P8. The other peers owned by these organizations have not been joined to this channel, but are typically joined to at least one other channel. Applications that have been developed by a particular organization will connect to their own organizationâ€™s peers as well as those of different organizations. Again, for simplicity, an orderer node is not shown in this diagram. Itâ€™s really important that you can see whatâ€™s happening in the formation of a blockchain network. The network is both formed and managed by the multiple organizations who contribute resources to it. Peers are the resources that weâ€™re discussing in this topic, but the resources an organization provides are more than just peers. Thereâ€™s a principle at work here â€” the network literally does not exist without organizations contributing their individual resources to the collective network. Moreover, the network grows and shrinks with the resources that are provided by these collaborating organizations. åŒºå—é“¾ç”±å‘å…¶è´¡çŒ®èµ„æºçš„å¤šä¸ªç»„ç»‡ç»„æˆå’Œç®¡ç†ã€‚ You can see that (other than the ordering service) there are no centralized resources â€” in the example above, the network, N, would not exist if the organizations did not contribute their peers. This reflects the fact that the network does not exist in any meaningful sense unless and until organizations contribute the resources that form it. Moreover, the network does not depend on any individual organization â€” it will continue to exist as long as one organization remains, no matter which other organizations may come and go. This is at the heart of what it means for a network to be decentralized. Applications in different organizations, as in the example above, may or may not be the same. Thatâ€™s because itâ€™s entirely up to an organization as to how its applications process their peersâ€™ copies of the ledger. This means that both application and presentation logic may vary from organization to organization even though their respective peers host exactly the same ledger data. å¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œä¸åŒç»„ç»‡ä¸­çš„åº”ç”¨ç¨‹åºå¯èƒ½ç›¸åŒï¼Œä¹Ÿå¯èƒ½ä¸åŒã€‚ Applications connect either to peers in their organization, or peers in another organization, depending on the nature of the ledger interaction thatâ€™s required. For ledger-query interactions, applications typically connect to their own organizationâ€™s peers. For ledger-update interactions, weâ€™ll see later why applications need to connect to peers representing every organization that is required to endorse the ledger update. åº”ç”¨ç¨‹åºå¯ä»¥è¿æ¥åˆ°è‡ªå·±ç»„ç»‡çš„peerèŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥è¿æ¥åˆ°å…¶ä»–ç»„ç»‡çš„peerèŠ‚ç‚¹ï¼Œå…·ä½“å–å†³äºæ‰€éœ€çš„è´¦æœ¬äº¤äº’çš„æ€§è´¨ã€‚å¯¹äºè´¦æœ¬æŸ¥è¯¢äº¤äº’ï¼Œåº”ç”¨ç¨‹åºé€šå¸¸ä¼šè¿æ¥åˆ°è‡ªå·±ç»„ç»‡çš„peerèŠ‚ç‚¹ã€‚å¯¹äºè´¦æœ¬æ›´æ–°äº¤äº’ï¼Œæˆ‘ä»¬å°†åœ¨åé¢çœ‹åˆ°ä¸ºä»€ä¹ˆåº”ç”¨ç¨‹åºéœ€è¦è¿æ¥åˆ°ä»£è¡¨è®¤å¯è´¦æœ¬æ›´æ–°æ‰€éœ€çš„æ¯ä¸ªç»„ç»‡çš„peerã€‚ Peers and Identity Now that youâ€™ve seen how peers from different organizations come together to form a blockchain network, itâ€™s worth spending a few moments understanding how peers get assigned to organizations by their administrators. Peers have an identity assigned to them via a digital certificate from a particular certificate authority. You can read lots more about how X.509 digital certificates work elsewhere in this guide but, for now, think of a digital certificate as being like an ID card that provides lots of verifiable information about a peer. Each and every peer in the network is assigned a digital certificate by an administrator from its owning organization. Peerså…·æœ‰é€šè¿‡ç‰¹å®šè¯ä¹¦é¢å‘æœºæ„é€šè¿‡æ•°å­—è¯ä¹¦åˆ†é…ç»™ä»–ä»¬çš„èº«ä»½ã€‚***ã€‚ç½‘ç»œä¸­çš„æ¯ä¸ªpeerèŠ‚ç‚¹éƒ½ç”±å…¶æ‰€å±ç»„ç»‡çš„ç®¡ç†å‘˜åˆ†é…çš„æ•°å­—è¯ä¹¦ã€‚ When a peer connects to a channel, its digital certificate identifies its owning organization via a channel MSP. In this example, P1 and P2 have identities issued by CA1. Channel C determines from a policy in its channel configuration that identities from CA1 should be associated with Org1 using ORG1.MSP. Similarly, P3 and P4 are identified by ORG2.MSP as being part of Org2. å½“peerè¿æ¥åˆ°é€šé“æ—¶ï¼Œå…¶æ•°å­—è¯ä¹¦é€šè¿‡é€šé“MSPæ ‡è¯†å…¶å½’å±çš„ç»„ç»‡ã€‚ Whenever a peer connects using a channel to a blockchain network, a policy in the channel configuration uses the peerâ€™s identity to determine its rights. The mapping of identity to organization is provided by a component called a Membership Service Provider (MSP) â€” it determines how a peer gets assigned to a specific role in a particular organization and accordingly gains appropriate access to blockchain resources. Moreover, a peer can be owned only by a single organization, and is therefore associated with a single MSP. Weâ€™ll learn more about peer access control later in this section, and thereâ€™s an entire section on MSPs and access control policies elsewhere in this guide. But for now, think of an MSP as providing linkage between an individual identity and a particular organizational role in a blockchain network. æ¯å½“peerä½¿ç”¨é€šé“è¿æ¥åˆ°åŒºå—é“¾ç½‘ç»œæ—¶ï¼Œé€šé“é…ç½®ä¸­çš„ç­–ç•¥éƒ½ä¼šä½¿ç”¨peerçš„èº«ä»½æ¥ç¡®å®šå…¶æƒåˆ©ã€‚*** To digress for a moment, peers as well as everything that interacts with a blockchain network acquire their organizational identity from their digital certificate and an MSP. Peers, applications, end users, administrators and orderers must have an identity and an associated MSP if they want to interact with a blockchain network. We give a name to every entity that interacts with a blockchain network using an identity â€” a principal. You can learn lots more about principals and organizations elsewhere in this guide, but for now you know more than enough to continue your understanding of peers! Peersä»¥åŠä¸åŒºå—é“¾ç½‘ç»œäº¤äº’çš„æ‰€æœ‰äº‹ç‰©å‡ä»å…¶æ•°å­—è¯ä¹¦å’ŒMSPè·å–å…¶ç»„ç»‡èº«ä»½ã€‚*** Finally, note that itâ€™s not really important where the peer is physically located â€” it could reside in the cloud, or in a data centre owned by one of the organizations, or on a local machine â€” itâ€™s the digital certificate associated with it that identifies it as being owned by a particular organization. In our example above, P3 could be hosted in Org1â€™s data center, but as long as the digital certificate associated with it is issued by CA2, then itâ€™s owned by Org2. æœ€åï¼Œæ³¨æ„peerçš„ç‰©ç†ä½ç½®ä¸æ˜¯å¾ˆé‡è¦ï¼Œå®ƒå¯ä»¥éƒ¨ç½²åœ¨äº‘ä¸Šï¼Œä¹Ÿå¯ä»¥éƒ¨ç½²åœ¨æœ¬åœ°ç‰©ç†æœºä¸Šï¼›ä¸ç®¡å®ƒåœ¨å“ªé‡Œï¼Œä¹‹ç›¸å…³è”çš„æ•°å­—è¯ä¹¦å°†å…¶æ ‡è¯†ä¸ºç‰¹å®šç»„ç»‡æ‰€æ‹¥æœ‰ã€‚*** Peers and Orderers Weâ€™ve seen that peers form the basis for a blockchain network, hosting ledgers and smart contracts which can be queried and updated by peer-connected applications. However, the mechanism by which applications and peers interact with each other to ensure that every peerâ€™s ledger is kept consistent with each other is mediated by special nodes called orderers, and itâ€™s to these nodes we now turn our attention. An update transaction is quite different from a query transaction because a single peer cannot, on its own, update the ledger â€” updating requires the consent of other peers in the network. A peer requires other peers in the network to approve a ledger update before it can be applied to a peerâ€™s local ledger. This process is called consensus, which takes much longer to complete than a simple query. But when all the peers required to approve the transaction do so, and the transaction is committed to the ledger, peers will notify their connected applications that the ledger has been updated. Youâ€™re about to be shown a lot more detail about how peers and orderers manage the consensus process in this section. æ›´æ–°äº¤æ˜“ä¸æŸ¥è¯¢äº¤æ˜“æ˜¯æœ‰å¾ˆå¤§åŒºåˆ«çš„ï¼Œå› ä¸ºå•ç‹¬çš„peerä¸å¯ä»¥è‡ªå·±å®Œæˆæ›´æ–°è´¦æœ¬çš„å·¥ä½œã€‚æ›´æ–°è´¦æœ¬çš„æ“ä½œéœ€è¦ç½‘ç»œä¸­å…¶ä»–peerçš„åŒæ„ã€‚peeréœ€è¦ç½‘ç»œä¸­çš„å…¶ä»–peeræ‰¹å‡†è´¦æœ¬æ›´æ–°ï¼Œç„¶åæ‰èƒ½å°†å…¶åº”ç”¨äºpeerä¸Šçš„æœ¬åœ°è´¦æœ¬ã€‚æ­¤è¿‡ç¨‹ç§°ä¸ºå…±è¯†ï¼Œä¸ç®€å•çš„æŸ¥è¯¢ç›¸æ¯”ï¼Œæ­¤è¿‡ç¨‹éœ€è¦æ›´é•¿çš„æ—¶é—´æ‰èƒ½å®Œæˆã€‚ä½†æ˜¯ï¼Œå½“æ‰€æœ‰éœ€è¦æ‰¹å‡†äº¤æ˜“çš„peerèŠ‚ç‚¹éƒ½æ‰¹å‡†äº†è¯¥äº¤æ˜“å¹¶å°†äº¤æ˜“æäº¤åˆ°è´¦æœ¬æ—¶ï¼Œpeerå°†é€šçŸ¥å…¶è¿æ¥çš„åº”ç”¨ç¨‹åºè´¦æœ¬å·²æ›´æ–°ã€‚åœ¨æœ¬éƒ¨åˆ†ä¸­ï¼Œæ‚¨å°†è·å¾—æœ‰å…³peerså’Œpeerså¦‚ä½•ç®¡ç†å…±è¯†è¿‡ç¨‹çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚ Specifically, applications that want to update the ledger are involved in a 3-phase process, which ensures that all the peers in a blockchain network keep their ledgers consistent with each other. å…·ä½“æ¥è¯´ï¼Œæƒ³è¦æ›´æ–°è´¦æœ¬çš„åº”ç”¨ç¨‹åºéœ€è¦3ä¸ªé˜¶æ®µçš„è¿‡ç¨‹ï¼Œè¿™ç¡®ä¿äº†åŒºå—é“¾ç½‘ç»œä¸­çš„æ‰€æœ‰peerä¿æŒè´¦æœ¬å½¼æ­¤ä¸€è‡´ã€‚ In the first phase, applications work with a subset of endorsing peers, each of which provide an endorsement of the proposed ledger update to the application, but do not apply the proposed update to their copy of the ledger. åœ¨ç¬¬ä¸€ä¸ªé˜¶æ®µï¼Œåº”ç”¨ç¨‹åºä¸ä¸€äº›èƒŒä¹¦peerèŠ‚ç‚¹ä¸€èµ·å·¥ä½œï¼Œæ¯ä¸ªèƒŒä¹¦peerèŠ‚ç‚¹éƒ½å‘åº”ç”¨ç¨‹åºæä¾›å¯¹æè®®çš„è´¦æœ¬æ›´æ–°çš„èƒŒä¹¦ï¼Œä½†ä¸å°†æè®®çš„æ›´æ–°åº”ç”¨äºå…¶è´¦æœ¬çš„å‰¯æœ¬ã€‚ In the second phase, these separate endorsements are collected together as transactions and packaged into blocks. åœ¨ç¬¬äºŒé˜¶æ®µï¼Œè¿™äº›å•ç‹¬çš„èƒŒä¹¦å°†ä½œä¸ºäº¤æ˜“æ”¶é›†åœ¨ä¸€èµ·ï¼Œå¹¶æ‰“åŒ…æˆå—ã€‚ In the third and final phase, these blocks are distributed back to every peer where each transaction is validated before being committed to that peerâ€™s copy of the ledger. åœ¨ç¬¬ä¸‰é˜¶æ®µï¼ˆä¹Ÿæ˜¯æœ€åé˜¶æ®µï¼‰ï¼Œè¿™äº›åŒºå—ä¼šé‡æ–°åˆ†é…ç»™æ¯ä¸ªpeerèŠ‚ç‚¹ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæ¯ä¸ªäº¤æ˜“å‡ç»è¿‡éªŒè¯ï¼Œç„¶åå†æäº¤ç»™è¯¥peerçš„è´¦æœ¬å‰¯æœ¬ã€‚ As you will see, orderer nodes are central to this process, so letâ€™s investigate in a little more detail how applications and peers use orderers to generate ledger updates that can be consistently applied to a distributed, replicated ledger. å¦‚æ‚¨æ‰€è§ï¼Œæ’åºè€…èŠ‚ç‚¹æ˜¯æ­¤è¿‡ç¨‹çš„æ ¸å¿ƒï¼Œå› æ­¤ï¼Œè®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°ç ”ç©¶ä¸€ä¸‹åº”ç”¨ç¨‹åºå’Œpeerå¦‚ä½•ä½¿ç”¨æ’åºæœåŠ¡æ¥ç”Ÿæˆè´¦æœ¬æ›´æ–°ï¼Œè¯¥æ›´æ–°å¯å§‹ç»ˆåº”ç”¨äºåˆ†å¸ƒå¼å¤åˆ¶åˆ†ç±»å¸ã€‚ Phase 1: Proposal Phase 1 of the transaction workflow involves an interaction between an application and a set of peers â€” it does not involve orderers. Phase 1 is only concerned with an application asking different organizationsâ€™ endorsing peers to agree to the results of the proposed chaincode invocation. äº¤æ˜“æµç¨‹çš„ç¬¬ä¸€é˜¶æ®µæ¶‰åŠåº”ç”¨ç¨‹åºä¸ä¸€ç»„peerä¹‹é—´çš„äº¤äº’-å®ƒä¸æ¶‰åŠæ’åºè€…ã€‚ç¬¬ä¸€é˜¶æ®µåªå…³å¿ƒåº”ç”¨ç¨‹åºè¦æ±‚ä¸åŒç»„ç»‡çš„èƒŒä¹¦èŠ‚ç‚¹åŒæ„æè®®çš„é“¾ç è°ƒç”¨çš„ç»“æœã€‚ To start phase 1, applications generate a transaction proposal which they send to each of the required set of peers for endorsement. Each of these endorsing peers then independently executes a chaincode using the transaction proposal to generate a transaction proposal response. It does not apply this update to the ledger, but rather simply signs it and returns it to the application. Once the application has received a sufficient number of signed proposal responses, the first phase of the transaction flow is complete. Letâ€™s examine this phase in a little more detail. ä¸ºäº†å¼€å§‹ç¬¬ä¸€é˜¶æ®µï¼Œåº”ç”¨ç¨‹åºç”Ÿæˆä¸€ä¸ªäº¤æ˜“æè®®ï¼Œç„¶åå‘é€è¿™ä¸ªäº¤æ˜“æè®®åˆ°æ¯ä¸ªéœ€è¦èƒŒä¹¦çš„peeråˆ—è¡¨ã€‚ç„¶åæ¯ä¸ªèƒŒä¹¦èŠ‚ç‚¹ä½¿ç”¨äº¤æ˜“æè®®æ‰§è¡Œé“¾ç æ¥ç”Ÿæˆäº¤æ˜“æè®®å“åº”ã€‚å®ƒä¸ä¼šå°†æ­¤æ›´æ–°åº”ç”¨äºè´¦æœ¬ï¼Œè€Œåªæ˜¯å¯¹å…¶è¿›è¡Œç­¾åå¹¶å°†å…¶è¿”å›ç»™åº”ç”¨ç¨‹åºã€‚ä¸€æ—¦åº”ç”¨ç¨‹åºæ”¶åˆ°è¶³å¤Ÿæ•°é‡çš„å·²ç­¾åææ¡ˆå“åº”åï¼Œäº¤æ˜“æµç¨‹çš„ç¬¬ä¸€é˜¶æ®µå°±å®Œæˆäº†ã€‚è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°ç ”ç©¶è¿™ä¸ªé˜¶æ®µã€‚ Transaction proposals are independently executed by peers who return endorsed proposal responses. In this example, application A1 generates transaction T1 proposal P which it sends to both peer P1 and peer P2 on channel C. P1 executes S1 using transaction T1 proposal P generating transaction T1 response R1 which it endorses with E1. Independently, P2 executes S1 using transaction T1 proposal P generating transaction T1 response R2 which it endorses with E2. Application A1 receives two endorsed responses for transaction T1, namely E1 and E2. äº¤æ˜“æè®®è¢«æ¯ä¸ªpeerèŠ‚ç‚¹ç‹¬ç«‹çš„æ‰§è¡Œç„¶åè¿”å›èƒŒä¹¦æè®®å“åº”ã€‚ Initially, a set of peers are chosen by the application to generate a set of proposed ledger updates. Which peers are chosen by the application? Well, that depends on the endorsement policy (defined for a chaincode), which defines the set of organizations that need to endorse a proposed ledger change before it can be accepted by the network. This is literally what it means to achieve consensus â€” every organization who matters must have endorsed the proposed ledger change before it will be accepted onto any peerâ€™s ledger. æœ€åˆåº”ç”¨ç¨‹åºé€‰æ‹©ä¸€ç»„peerèŠ‚ç‚¹æ¥ç”Ÿæˆä¸€ç»„æè®®çš„è´¦æœ¬æ›´æ–°ã€‚åº”ç”¨ç¨‹åºä¼šé€‰æ‹©å“ªäº›peerèŠ‚ç‚¹å‘¢ï¼Ÿè¿™å–å†³äºï¼ˆä¸ºé“¾ç å®šä¹‰çš„ï¼‰èƒŒä¹¦ç­–ç•¥ï¼Œè¯¥ç­–ç•¥å®šä¹‰äº†ä¸€ä¸ªéœ€è¦åœ¨ç½‘ç»œæ¥å—ä¹‹å‰æ‰¹å‡†æè®®çš„è´¦æœ¬æ›´æ–°çš„ç»„ç»‡åˆ—è¡¨ã€‚ä»å­—é¢ä¸Šçœ‹ï¼Œè¿™æ˜¯è¾¾æˆå…±è¯†çš„æ„æ€ â€“ æ¯ä¸ªé‡è¦çš„ç»„ç»‡éƒ½å¿…é¡»å·²ç»æ‰¹å‡†æè®®çš„è´¦æœ¬æ›´æ–°ï¼Œç„¶åè¯¥æ›´æ”¹æ‰ä¼šè¢«æ¥å—åˆ°å…¶ä»–peerçš„è´¦æœ¬ä¸­ã€‚ A peer endorses a proposal response by adding its digital signature, and signing the entire payload using its private key. This endorsement can be subsequently used to prove that this organizationâ€™s peer generated a particular response. In our example, if peer P1 is owned by organization Org1, endorsement E1 corresponds to a digital proof that â€œTransaction T1 response R1 on ledger L1 has been provided by Org1â€™s peer P1!â€. peerèŠ‚ç‚¹é€šè¿‡æ·»åŠ æ•°å­—ç­¾åæ¥è®¤å¯æè®®å“åº”ï¼Œå¹¶ä¸”ä½¿ç”¨å®ƒçš„ç§é’¥å¯¹æ•´ä¸ªè´Ÿè½½çš„æ•°æ®è¿›è¡Œç­¾åã€‚è¿™ä¸ªèƒŒä¹¦éšåå¯ä»¥è¢«ç”¨äºè¯æ˜è¿™ä¸ªç»„ç»‡çš„peerç”Ÿæˆäº†å“åº”ã€‚*** Phase 1 ends when the application receives signed proposal responses from sufficient peers. We note that different peers can return different and therefore inconsistent transaction responses to the application for the same transaction proposal. It might simply be that the result was generated at different times on different peers with ledgers at different states, in which case an application can simply request a more up-to-date proposal response. Less likely, but much more seriously, results might be different because the chaincode is non-deterministic. Non-determinism is the enemy of chaincodes and ledgers and if it occurs it indicates a serious problem with the proposed transaction, as inconsistent results cannot, obviously, be applied to ledgers. An individual peer cannot know that their transaction result is non-deterministic â€” transaction responses must be gathered together for comparison before non-determinism can be detected. (Strictly speaking, even this is not enough, but we defer this discussion to the transaction section, where non-determinism is discussed in detail.) å½“åº”ç”¨ç¨‹åºæ”¶åˆ°è¶³å¤Ÿçš„peerç­¾ç½²çš„æè®®å“åº”æ—¶ï¼Œé˜¶æ®µä¸€å°±ç»“æŸäº†ã€‚å¯¹äºåŒä¸€äº¤æ˜“æè®®ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¯èƒ½æ”¶åˆ°ä¸ä¸€è‡´çš„äº¤æ˜“å“åº”ã€‚è¿™å¯èƒ½åªæ˜¯ç®€å•çš„å› ä¸ºç»“æœæ˜¯åœ¨ä¸åŒçš„æ—¶é—´ã€ä¸åŒçš„peerèŠ‚ç‚¹ä½¿ç”¨ä¸åŒçš„è´¦æœ¬çŠ¶æ€ä¸‹ç”Ÿæˆçš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ç®€å•åœ°è¯·æ±‚æœ€æ–°çš„æè®®å“åº”ã€‚å¯èƒ½æ€§è¾ƒå°ä½†æ˜¯æ›´ä¸¥é‡çš„æ˜¯ï¼Œç»“æœå¯èƒ½ä¼šå› ä¸ºé“¾ç æ˜¯ä¸ç¡®å®šçš„è€Œæœ‰æ‰€ä¸åŒã€‚éç¡®å®šæ€§æ˜¯é“¾ç å’Œè´¦æœ¬çš„æ•Œäººï¼Œå¦‚æœå‘ç”Ÿï¼Œåˆ™è¡¨æ˜æè®®äº¤æ˜“å­˜åœ¨ä¸¥é‡é—®é¢˜ï¼Œå› ä¸ºä¸ä¸€è‡´çš„ç»“æœæ˜¾ç„¶ä¸èƒ½åº”ç”¨äºè´¦æœ¬ã€‚å•ä¸ªpeeræ— æ³•çŸ¥é“å…¶äº¤æ˜“ç»“æœæ˜¯ä¸ç¡®å®šçš„ â€“ å¿…é¡»å…ˆæ”¶é›†äº¤æ˜“å“åº”ä»¥è¿›è¡Œæ¯”è¾ƒï¼Œç„¶åæ‰èƒ½æ£€æµ‹åˆ°ä¸ç¡®å®šæ€§ã€‚ï¼ˆä¸¥æ ¼è¯´æ¥ï¼Œè¿™è¿˜ä¸å¤Ÿï¼Œä½†æ˜¯æˆ‘ä»¬å°†è®¨è®ºæ¨è¿Ÿåˆ°äº¤æ˜“éƒ¨åˆ†ï¼Œåœ¨æ­¤éƒ¨åˆ†å°†è¯¦ç»†è®¨è®ºä¸ç¡®å®šæ€§ã€‚ï¼‰ At the end of phase 1, the application is free to discard inconsistent transaction responses if it wishes to do so, effectively terminating the transaction workflow early. Weâ€™ll see later that if an application tries to use an inconsistent set of transaction responses to update the ledger, it will be rejected. åœ¨é˜¶æ®µä¸€ç»“æŸæ—¶ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥éšæ„ä¸¢å¼ƒä¸ä¸€è‡´çš„äº¤æ˜“å“åº”ï¼Œä»è€Œæœ‰æ•ˆåœ°å°½æ—©ç»ˆæ­¢äº¤æ˜“æµç¨‹ã€‚ç¨åæˆ‘ä»¬å°†çœ‹åˆ°ï¼Œå¦‚æœåº”ç”¨ç¨‹åºå°è¯•ä½¿ç”¨ä¸€ç»„ä¸ä¸€è‡´çš„äº¤æ˜“å“åº”æ¥æ›´æ–°è´¦æœ¬ï¼Œå®ƒå°†è¢«æ‹’ç»ã€‚ Phase 2: Ordering and packaging transactions into blocks The second phase of the transaction workflow is the packaging phase. The orderer is pivotal to this process â€” it receives transactions containing endorsed transaction proposal responses from many applications, and orders the transactions into blocks. For more details about the ordering and packaging phase, check out our conceptual information about the ordering phase. äº¤æ˜“æµç¨‹çš„ç¬¬äºŒä¸ªé˜¶æ®µæ˜¯æ‰“åŒ…é˜¶æ®µã€‚æ’åºè€…å¯¹äºæ­¤è¿‡ç¨‹è‡³å…³é‡è¦-å®ƒä»è®¸å¤šåº”ç”¨ç¨‹åºæ¥æ”¶åŒ…å«èƒŒä¹¦çš„äº¤æ˜“æè®®å“åº”çš„äº¤æ˜“ï¼Œå¹¶å°†äº¤æ˜“æ’åºæ‰“åŒ…æˆåŒºå—ã€‚*** Phase 3: Validation and commit At the end of phase 2, we see that orderers have been responsible for the simple but vital processes of collecting proposed transaction updates, ordering them, and packaging them into blocks, ready for distribution to the peers. The final phase of the transaction workflow involves the distribution and subsequent validation of blocks from the orderer to the peers, where they can be committed to the ledger. Specifically, at each peer, every transaction within a block is validated to ensure that it has been consistently endorsed by all relevant organizations before it is committed to the ledger. Failed transactions are retained for audit, but are not committed to the ledger. äº¤æ˜“æµç¨‹çš„æœ€åé˜¶æ®µæ¶‰åŠä»æ’åºè€…åˆ°peerèŠ‚ç‚¹çš„åŒºå—åˆ†é…å’Œåç»­éªŒè¯ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µå¯ä»¥å°†å®ƒä»¬æäº¤åˆ°è´¦æœ¬ã€‚å…·ä½“æ¥è¯´ï¼Œæ¯ä¸ªpeerèŠ‚ç‚¹å¯¹åŒºå—ä¸­çš„æ¯ä¸ªäº¤æ˜“éƒ½è¿›è¡ŒéªŒè¯ï¼Œä»¥ç¡®ä¿åœ¨å°†å…¶æäº¤åˆ°è´¦æœ¬ä¹‹å‰æ‰€æœ‰ç›¸å…³ç»„ç»‡éƒ½ä¸€è‡´è®¤å¯è¯¥äº¤æ˜“ã€‚å¤±è´¥çš„äº¤æ˜“å°†ä¿ç•™ä»¥è¿›è¡Œå®¡æ ¸ï¼Œä½†ä¸ä¼šæäº¤åˆ°åˆ†ç±»è´¦ã€‚ The second role of an orderer node is to distribute blocks to peers. In this example, orderer O1 distributes block B2 to peer P1 and peer P2. Peer P1 processes block B2, resulting in a new block being added to ledger L1 on P1. In parallel, peer P2 processes block B2, resulting in a new block being added to ledger L1 on P2. Once this process is complete, the ledger L1 has been consistently updated on peers P1 and P2, and each may inform connected applications that the transaction has been processed. æ’åºè€…èŠ‚ç‚¹çš„ç¬¬äºŒä¸ªæŒ‡è´£æ˜¯å°†åŒºå—åˆ†å‘åˆ°peerèŠ‚ç‚¹ã€‚ Phase 3 begins with the orderer distributing blocks to all peers connected to it. Peers are connected to orderers on channels such that when a new block is generated, all of the peers connected to the orderer will be sent a copy of the new block. Each peer will process this block independently, but in exactly the same way as every other peer on the channel. In this way, weâ€™ll see that the ledger can be kept consistent. Itâ€™s also worth noting that not every peer needs to be connected to an orderer â€” peers can cascade blocks to other peers using the gossip protocol, who also can process them independently. But letâ€™s leave that discussion to another time! ç¬¬ä¸‰é˜¶æ®µå¼€å§‹äºæ’åºè€…åˆ†å‘åŒºå—åˆ°é“¾æ¥å®ƒçš„æ‰€æœ‰peerèŠ‚ç‚¹ä¸Šã€‚peerèŠ‚ç‚¹é“¾æ¥åˆ°é€šé“ä¸Šçš„æ’åºèŠ‚ç‚¹ï¼Œè¿™æ ·å½“ä¸€ä¸ªæ–°çš„åŒºå—ç”Ÿæˆæ˜¯ï¼Œæ‰€æœ‰çš„é“¾æ¥åˆ°æ’åºèŠ‚ç‚¹çš„peeréƒ½ä¼šæ”¶åˆ°ä¸€ä¸ªæ–°åŒºå—çš„å‰¯æœ¬ã€‚æ¯ä¸ªpeeréƒ½ä½¿ç”¨ä¸é€šé“ä¸Šçš„å…¶ä»–èŠ‚ç‚¹ä¸€æ ·çš„æ–¹å¼æ¥ç‹¬ç«‹å¤„ç†è¿™ä¸ªåŒºå—ã€‚é€šè¿‡è¿™ç§æ–¹å¼è´¦æœ¬å°±å¯ä»¥ä¿æŒä¸€è‡´äº†ã€‚è¿˜å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¹¶éæ¯ä¸ªpeerèŠ‚ç‚¹éƒ½éœ€è¦è¿æ¥åˆ°æ’åºè€… â€“ peerèŠ‚ç‚¹å¯ä»¥ä½¿ç”¨å…«å¦åè®®å°†å—çº§è”åˆ°å…¶ä»–peerï¼Œè¿™äº›peerä¹Ÿå¯ä»¥ç‹¬ç«‹å¤„ç†åŒºå—ã€‚ Upon receipt of a block, a peer will process each transaction in the sequence in which it appears in the block. For every transaction, each peer will verify that the transaction has been endorsed by the required organizations according to the endorsement policy of the chaincode which generated the transaction. For example, some transactions may only need to be endorsed by a single organization, whereas others may require multiple endorsements before they are considered valid. This process of validation verifies that all relevant organizations have generated the same outcome or result. Also note that this validation is different than the endorsement check in phase 1, where it is the application that receives the response from endorsing peers and makes the decision to send the proposal transactions. In case the application violates the endorsement policy by sending wrong transactions, the peer is still able to reject the transaction in the validation process of phase 3. æ”¶åˆ°åŒºå—ä¹‹ååï¼ŒpeerèŠ‚ç‚¹å°†æŒ‰ç…§åŒºå—å—ä¸­çš„é¡ºåºå¤„ç†æ¯ä¸ªäº¤æ˜“ã€‚å¯¹äºæ¯ç¬”äº¤æ˜“ï¼Œæ¯ä¸ªpeerèŠ‚ç‚¹éƒ½å°†æ ¹æ®äº§ç”Ÿäº¤æ˜“çš„é“¾ç çš„èƒŒä¹¦æ”¿ç­–æ¥éªŒè¯è¯¥äº¤æ˜“æ˜¯å¦å·²è¢«æ‰€éœ€çš„ç»„ç»‡èƒŒä¹¦ã€‚ä¾‹å¦‚ï¼ŒæŸäº›äº¤æ˜“å¯èƒ½åªéœ€è¦ç”±å•ä¸ªç»„ç»‡èƒŒä¹¦ï¼Œè€Œå…¶ä»–äº¤æ˜“å¯èƒ½éœ€è¦å¤šä¸ªèƒŒä¹¦æ‰èƒ½è¢«è§†ä¸ºæœ‰æ•ˆã€‚è¿™ä¸ªéªŒè¯è¿‡ç¨‹éªŒè¯æ‰€æœ‰ç›¸å…³çš„ç»„ç»‡éƒ½ç”Ÿæˆç›¸åŒçš„äº§ç‰©æˆ–ç»“æœã€‚å¦è¯·æ³¨æ„ï¼Œæ­¤éªŒè¯ä¸ç¬¬ä¸€é˜¶æ®µä¸­çš„èƒŒä¹¦æ£€æŸ¥ä¸åŒï¼Œç¬¬ä¸€é˜¶æ®µçš„èƒŒä¹¦æ£€æŸ¥æ˜¯åº”ç”¨ç¨‹åºåœ¨æ¥æ”¶åˆ°æ¥è‡ªèƒŒä¹¦èŠ‚ç‚¹çš„å“åº”å¹¶åšå‡ºå‘é€æè®®äº¤æ˜“çš„å†³å®šã€‚å¦‚æœåº”ç”¨ç¨‹åºå‘é€äº†é”™è¯¯çš„äº¤æ˜“è¿åäº†èƒŒä¹¦ç­–ç•¥ï¼Œåœ¨ç¬¬ä¸‰é˜¶æ®µçš„éªŒè¯ç¨‹åºä¸­peerèŠ‚ç‚¹ä»ç„¶æœ‰èƒ½åŠ›æ‹’ç»æ­¤äº¤æ˜“ã€‚ If a transaction has been endorsed correctly, the peer will attempt to apply it to the ledger. To do this, a peer must perform a ledger consistency check to verify that the current state of the ledger is compatible with the state of the ledger when the proposed update was generated. This may not always be possible, even when the transaction has been fully endorsed. For example, another transaction may have updated the same asset in the ledger such that the transaction update is no longer valid and therefore can no longer be applied. In this way, the ledger is kept consistent across each peer in the channel because they each follow the same rules for validation. å¦‚æœäº¤æ˜“å·²è¢«æ­£ç¡®çš„è®¤å¯ï¼Œåˆ™peerèŠ‚ç‚¹å°†å°è¯•å°†å…¶åº”ç”¨äºè´¦æœ¬ã€‚ä¸ºæ­¤ï¼ŒpeerèŠ‚ç‚¹å¿…é¡»æ‰§è¡Œè´¦æœ¬ä¸€è‡´æ€§æ£€æŸ¥ï¼Œä»¥éªŒè¯ç”Ÿæˆæè®®çš„æ›´æ–°æ—¶è´¦æœ¬çš„çŠ¶æ€ä¸å½“å‰è´¦æœ¬çš„çŠ¶æ€ä¸€è‡´ã€‚å³ä½¿äº¤æ˜“å·²å¾—åˆ°å®Œå…¨è®¤å¯ï¼Œè¿™ä¹Ÿä¸æ€»æ˜¯ä¸€è‡´çš„ã€‚ä¾‹å¦‚ï¼Œå¦ä¸€ç¬”äº¤æ˜“å¯èƒ½å·²æ›´æ–°è´¦æœ¬ä¸­çš„åŒä¸€èµ„äº§ï¼Œå› æ­¤è¯¥äº¤æ˜“æ›´æ–°ä¸å†æœ‰æ•ˆï¼Œå› æ­¤æ— æ³•å†åº”ç”¨ã€‚è¿™æ ·ï¼Œè´¦æœ¬åœ¨é€šé“ä¸­çš„æ¯ä¸ªpeerèŠ‚ç‚¹ä¹‹é—´ä¿æŒä¸€è‡´ï¼Œå› ä¸ºå®ƒä»¬éƒ½éµå¾ªç›¸åŒçš„éªŒè¯è§„åˆ™ã€‚ After a peer has successfully validated each individual transaction, it updates the ledger. Failed transactions are not applied to the ledger, but they are retained for audit purposes, as are successful transactions. This means that peer blocks are almost exactly the same as the blocks received from the orderer, except for a valid or invalid indicator on each transaction in the block. åœ¨peerèŠ‚ç‚¹æˆåŠŸéªŒè¯äº†æ¯ä¸ªå•ç‹¬çš„äº¤æ˜“åï¼Œå®ƒå°†æ›´æ–°åˆ†ç±»å¸ã€‚å¤±è´¥çš„äº¤æ˜“ä¸ä¼šè¢«åº”ç”¨äºè´¦æœ¬ï¼Œä½†ä¿ç•™å®ƒä»¬ä»¥è¿›è¡Œå®¡è®¡ï¼Œå°±åƒæˆåŠŸäº¤æ˜“ä¸€æ ·ã€‚è¿™æ„å‘³ç€peerèŠ‚ç‚¹çš„åŒºå—å‡ ä¹ä¸ä»æ’åºè€…æ¥æ”¶åˆ°çš„åŒºå—å®Œå…¨ç›¸åŒï¼Œé™¤äº†è¯¥å—ä¸­æ¯ä¸ªäº¤æ˜“çš„æœ‰æ•ˆæˆ–æ— æ•ˆæŒ‡ç¤ºç¬¦ã€‚ We also note that phase 3 does not require the running of chaincodes â€” this is done only during phase 1, and thatâ€™s important. It means that chaincodes only have to be available on endorsing nodes, rather than throughout the blockchain network. This is often helpful as it keeps the logic of the chaincode confidential to endorsing organizations. This is in contrast to the output of the chaincodes (the transaction proposal responses) which are shared with every peer in the channel, whether or not they endorsed the transaction. This specialization of endorsing peers is designed to help scalability and confidentiality. æˆ‘ä»¬è¿˜æ³¨æ„åˆ°ï¼Œç¬¬3é˜¶æ®µä¸éœ€è¦è¿è¡ŒChaincodeï¼Œè¿™ä»…åœ¨ç¬¬1é˜¶æ®µæ‰åšï¼Œè¿™ä¸€ç‚¹å¾ˆé‡è¦ã€‚è¿™æ„å‘³ç€é“¾ç ä»…åœ¨èƒŒä¹¦èŠ‚ç‚¹ä¸Šå¯ç”¨ï¼Œè€Œä¸æ˜¯åœ¨æ•´ä¸ªåŒºå—é“¾ç½‘ç»œä¸Šå¯ç”¨ã€‚è¿™é€šå¸¸å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥ä½¿èƒŒä¹¦ç»„ç»‡çš„é“¾ç é€»è¾‘ä¿æŒç§å¯†ã€‚è¿™ä¸é“¾ç çš„è¾“å‡ºï¼ˆäº¤æ˜“æè®®å“åº”ï¼‰ç›¸åï¼Œé“¾ç çš„è¾“å‡ºä¸é€šé“ä¸­çš„æ¯ä¸ªpeerèŠ‚ç‚¹å…±äº«ï¼Œæ— è®ºä»–ä»¬æ˜¯å¦è®¤å¯äº¤æ˜“ã€‚è¿™ç§èƒŒä¹¦èŠ‚ç‚¹çš„ä¸“ä¸šåŒ–æ—¨åœ¨å¸®åŠ©æé«˜å¯ä¼¸ç¼©æ€§å’Œæœºå¯†æ€§ã€‚ Finally, every time a block is committed to a peerâ€™s ledger, that peer generates an appropriate event. Block events include the full block content, while block transaction events include summary information only, such as whether each transaction in the block has been validated or invalidated. Chaincode events that the chaincode execution has produced can also be published at this time. Applications can register for these event types so that they can be notified when they occur. These notifications conclude the third and final phase of the transaction workflow. æœ€åï¼Œæ¯æ¬¡å°†ä¸€ä¸ªåŒºå—æäº¤ç»™peerèŠ‚ç‚¹çš„è´¦æœ¬ä¹‹åï¼Œè¯¥peerèŠ‚ç‚¹éƒ½ä¼šç”Ÿæˆä¸€ä¸ªé€‚å½“çš„eventã€‚ Block events åŒ…å«æ‰€æœ‰çš„åŒºå—å†…å®¹ï¼Œ block transaction events åªåŒ…å«æ‘˜è¦ä¿¡æ¯ï¼ˆä¾‹å¦‚åŒºå—ä¸­çš„æ¯ç¬”äº¤æ˜“æ˜¯å¦å·²é€šè¿‡éªŒè¯æˆ–æ— æ•ˆï¼‰ Chaincode events é“¾ç æ‰§è¡Œæ—¶äº§ç”Ÿçš„Chaincode eventsä¹Ÿå¯ä»¥åœ¨æ­¤æ—¶å‘å¸ƒ åº”ç”¨ç¨‹åºå¯ä»¥æ³¨å†Œè¿™äº›äº‹ä»¶ç±»å‹ï¼Œä»¥ä¾¿åœ¨äº‹ä»¶å‘ç”Ÿæ—¶å¾—åˆ°é€šçŸ¥ã€‚è¿™äº›é€šçŸ¥ç»“æŸäº†äº¤æ˜“æµç¨‹çš„ç¬¬ä¸‰é˜¶æ®µä¹Ÿå°±æ˜¯æœ€åé˜¶æ®µã€‚ In summary, phase 3 sees the blocks which are generated by the orderer consistently applied to the ledger. The strict ordering of transactions into blocks allows each peer to validate that transaction updates are consistently applied across the blockchain network. æ€»ç»“æ¥è¯´ï¼Œç¬¬ä¸‰é˜¶æ®µå°†çœ‹åˆ°æ’åºè€…ç”Ÿæˆçš„åŒºå—ä¸€è‡´çš„åº”ç”¨äºè´¦æœ¬ã€‚ä¸¥æ ¼çš„å°†äº¤æ˜“æ’åºç„¶åæ‰“åŒ…åˆ°åŒºå—ä½¿æ¯ä¸ªpeerèŠ‚ç‚¹éªŒè¯äº¤æ˜“æ›´æ–°è¢«ä¸€è‡´åº”ç”¨åˆ°blockchainç½‘ç»œä¸­ã€‚ Orderers and Consensus This entire transaction workflow process is called consensus because all peers have reached agreement on the order and content of transactions, in a process that is mediated by orderers. Consensus is a multi-step process and applications are only notified of ledger updates when the process is complete â€” which may happen at slightly different times on different peers. æ•´ä¸ªäº¤æ˜“æµç¨‹è¢«ç§°ä¸ºå…±è¯†ï¼Œæ˜¯å› ä¸ºåœ¨æ’åºèŠ‚ç‚¹çš„è°ƒè§£ä¸‹æ‰€æœ‰peerèŠ‚ç‚¹éƒ½å·²å°±äº¤æ˜“çš„é¡ºåºå’Œå†…å®¹è¾¾æˆå…±è¯†ã€‚å…±è¯†æ˜¯ä¸€ä¸ªå¤šæ­¥éª¤çš„è¿‡ç¨‹ï¼Œåªæœ‰åœ¨è¯¥è¿‡ç¨‹å®Œæˆåï¼Œæ‰å°†è´¦æœ¬æ›´æ–°é€šçŸ¥åº”ç”¨ç¨‹åº â€“ åœ¨ä¸åŒçš„peerä¸Šï¼Œå‘ç”Ÿæ—¶é—´å¯èƒ½ç•¥æœ‰ä¸åŒã€‚ We will discuss orderers in a lot more detail in a future orderer topic, but for now, think of orderers as nodes which collect and distribute proposed ledger updates from applications for peers to validate and include on the ledger. Thatâ€™s it! Weâ€™ve now finished our tour of peers and the other components that they relate to in Fabric. Weâ€™ve seen that peers are in many ways the most fundamental element â€” they form the network, host chaincodes and the ledger, handle transaction proposals and responses, and keep the ledger up-to-date by consistently applying transaction updates to it.","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"Key Concepts","slug":"åŒºå—é“¾/Hyperledger-Fabric/Key-Concepts","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/Key-Concepts/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"Peers","slug":"Peers","permalink":"https://guozhe001.github.io/tags/Peers/"}]},{"title":"Ledger(è´¦æœ¬)","slug":"blockchain/fabric/å…³é”®æ¦‚å¿µ/Ledger","date":"2021-04-01T10:18:21.477Z","updated":"2021-04-01T10:18:21.477Z","comments":true,"path":"2021/04/01/blockchain/fabric/å…³é”®æ¦‚å¿µ/Ledger/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Ledger/","excerpt":"","text":"æœ¬æ–‡æ¡£æ¥è‡ªäºLedgerï¼Œä¸ºäº†æé«˜å­¦ä¹ æ•ˆç‡è€Œåšäº†ç®€åŒ–ã€‚ The Ledger Ledgerï¼šç”±World Stateå’ŒBlockchainç»„æˆ World Stateï¼šæ˜¯ä¿å­˜è´¦æœ¬stateçš„å½“å‰çŠ¶æ€çš„æ•°æ®åº“ï¼ˆä¸ªäººç†è§£ï¼šå¯ä»¥ç±»æ¯”æ¯”ç‰¹å¸çš„UTXOï¼‰ Blockchainï¼šè®°å½•æ‰€æœ‰å¯¼è‡´å½“å‰World Stateå‘ç”Ÿçš„æ›´æ”¹çš„äº‹åŠ¡æ—¥å¿—ï¼ˆä¸ªäººç†è§£ï¼šä¸æ¯”ç‰¹å¸çš„åŒºå—é“¾åŸºæœ¬ä¸€è‡´ï¼‰ World State ä¸–ç•ŒçŠ¶æ€æ˜¯ä¸€äº›äº‹å®çš„é”®å€¼å¯¹ ä¸–ç•ŒçŠ¶æ€æ˜¯é€šè¿‡æ•°æ®åº“å®ç°çš„ åº”ç”¨ç¨‹åºæäº¤æ”¹å˜ä¸–ç•ŒçŠ¶æ€çš„äº¤æ˜“ï¼Œè¿™äº›äº¤æ˜“æœ€ç»ˆè¢«æäº¤åˆ°è´¦æœ¬çš„åŒºå—é“¾ ä¸–ç•ŒçŠ¶æ€è®°å½•çš„äº‹å®éƒ½æœ‰ç‰ˆæœ¬ï¼Œä¾›Hyperledger Fabricå†…éƒ¨ä½¿ç”¨ï¼Œå¹¶ä¸”æ¯æ¬¡çŠ¶æ€æ›´æ”¹æ—¶éƒ½ä¼šé€’å¢ å½“é¦–æ¬¡åˆ›å»ºåˆ†ç±»å¸æ—¶ï¼Œä¸–ç•ŒçŠ¶æ€ä¸ºç©º Blockchain Blockchainæ˜¯æœ‰å…³ä¸–ç•ŒçŠ¶æ€ä¸­çš„stateæ˜¯å¦‚ä½•åˆ°è¾¾å…¶å½“å‰çŠ¶æ€çš„äº‹å®çš„å†å²è®°å½• Fabricä¸­çš„Blockchainæ˜¯ç”±æ–‡ä»¶å®ç° Blockchainç”±Blockç»„æˆ BlockåŒ…å«Block headerã€Block dataå’ŒBlock metadata Block headerä¸­åŒ…å«Block dataçš„hashå€¼å’Œä¸Šä¸€ä¸ªåŒºå—çš„hashå€¼ Block dataä¸­åŒ…å«äº¤æ˜“åˆ—è¡¨ Blocks Block Header Block number: ä»é›¶å¼€å§‹çš„æ•°å­—ï¼Œåˆ›ä¸–åŒºå—æ˜¯0ï¼Œæ¯æ¬¡è¿½åŠ ä¸€ä¸ªæ–°çš„åŒºå—è¿™ä¸ªBlock numberè‡ªå¢1 Current Block Hash: å½“å‰åŒºå—åŒ…å«çš„æ‰€æœ‰çš„äº¤æ˜“çš„hashå€¼ Previous Block Header Hash: ä¸Šä¸€ä¸ªåŒºå—çš„Block Headerä¸­çš„hashå€¼ Block Data Block DataåŒ…å«å·²ç»æ’å¥½åºçš„äº¤æ˜“åˆ—è¡¨ï¼Œè¿™äº›äº¤æ˜“åœ¨æ’åºæœåŠ¡åˆ›å»ºåŒºå—æ—¶å†™å…¥åˆ°Block Data Block Metadata Block MetadataåŒ…å«åŒºå—åˆ›å»ºè€…çš„è¯ä¹¦å’Œç­¾åï¼Œç”¨äºé€šè¿‡ç½‘ç»œèŠ‚ç‚¹éªŒè¯å—ã€‚ åŒºå—æäº¤è€…å°†æ¯ä¸ªäº¤æ˜“çš„æœ‰æ•ˆ/æ— æ•ˆæŒ‡ç¤ºç¬¦æ·»åŠ åˆ°Block Metadataçš„bitmapä¸­ ç›´åˆ°ï¼ˆåŒ…æ‹¬ï¼‰è¯¥å—ä¸ºæ­¢çš„ç´¯ç§¯çŠ¶æ€çš„å“ˆå¸Œå€¼ï¼Œä»¥ä¾¿æ£€æµ‹çŠ¶æ€æ´¾ç”Ÿï¼ˆè¿™æ˜¯ä¸ºäº†åœ¨æäº¤ä¹‹å‰éªŒè¯çŠ¶æ€æœ‰æ²¡æœ‰è¢«å…¶ä»–çš„äº¤æ˜“æ›´æ”¹ï¼‰ Transactions æ¯ä¸ªäº¤æ˜“éƒ½åŒ…å«ä»¥ä¸‹å››éƒ¨åˆ†ï¼š Header å–å¾—æœ‰å…³äº¤æ˜“çš„ä¸€äº›åŸºæœ¬å…ƒæ•°æ®-ä¾‹å¦‚ç›¸å…³é“¾ç çš„åç§°åŠå…¶ç‰ˆæœ¬ã€‚ Signature åŒ…å«å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºçš„ç­¾åï¼›æ­¤å­—æ®µç”¨äºæ£€æŸ¥äº¤æ˜“æ˜ç»†æ˜¯å¦æœªè¢«ç¯¡æ”¹ï¼Œå› ä¸ºå®ƒéœ€è¦åº”ç”¨ç¨‹åºçš„ç§é’¥æ¥ç”Ÿæˆã€‚ Proposal ä¿å­˜ç¼–ç åçš„åº”ç”¨ç¨‹åºæä¾›ç»™æ™ºèƒ½åˆçº¦çš„è¾“å…¥å‚æ•°ï¼Œä½¿ç”¨è¿™äº›å‚æ•°æ¥åˆ›å»ºæ›´æ–°è´¦æœ¬çš„æè®®ã€‚å½“æ™ºèƒ½åˆçº¦è¿è¡Œæ—¶ï¼Œè¯¥æè®®æä¾›äº†ä¸€ç»„è¾“å…¥å‚æ•°ï¼Œè¿™äº›è¾“å…¥å‚æ•°ä¸å½“å‰çš„ä¸–ç•ŒçŠ¶æ€ä¸€èµ·ç¡®å®šäº†æ–°çš„ä¸–ç•ŒçŠ¶æ€ã€‚ Response è·å–ä¸–ç•ŒçŠ¶æ€çš„å‰åå€¼ï¼Œä½œä¸ºè¯»å†™é›†ï¼ˆRW-setï¼‰ã€‚å®ƒæ˜¯æ™ºèƒ½åˆçº¦çš„è¾“å‡ºï¼Œå¦‚æœäº¤æ˜“æˆåŠŸé€šè¿‡éªŒè¯ï¼Œå®ƒå°†åº”ç”¨äºè´¦æœ¬æ¥æ›´æ–°ä¸–ç•ŒçŠ¶æ€ã€‚ Endorsements è¿™æ˜¯æ»¡è¶³èƒŒä¹¦ç­–ç•¥çš„ç»„ç»‡çš„ç­¾ååˆ—è¡¨ã€‚äº¤æ˜“å“åº”åŒ…å«äº†èƒŒä¹¦åˆ—è¡¨ï¼Œå¹¶ä¸”åªæœ‰æ»¡è¶³äº¤æ˜“èƒŒä¹¦ç­–ç•¥çš„èƒŒä¹¦åˆ—è¡¨æ‰ä¼šå­˜åœ¨åœ¨æ­¤ï¼Œå¦‚æœä¸æ»¡è¶³èƒŒä¹¦ç­–ç•¥åˆ™ä¸åœ¨æ­¤è®°å½•ï¼Œå› ä¸ºä¹Ÿä¸ä¼šæ›´æ–°ä¸–ç•ŒçŠ¶æ€ã€‚ World State database options The world state is physically implemented as a database, to provide simple and efficient storage and retrieval of ledger states. As weâ€™ve seen, ledger states can have simple or compound values, and to accommodate this, the world state database implementation can vary, allowing these values to be efficiently implemented. Options for the world state database currently include LevelDB and CouchDB. ä¸–ç•ŒçŠ¶æ€åœ¨ç‰©ç†ä¸Šæ˜¯ä½¿ç”¨æ•°æ®åº“å®ç°çš„ï¼Œä»¥æä¾›ç®€å•æœ‰æ•ˆçš„å­˜å‚¨å’Œè´¦æœ¬çŠ¶æ€æ£€ç´¢ã€‚å¦‚æˆ‘ä»¬æ‰€è§ï¼Œè´¦æœ¬çŠ¶æ€å¯ä»¥å…·æœ‰ç®€å•å€¼æˆ–å¤åˆå€¼ï¼Œä¸ºäº†é€‚åº”è¿™ç§æƒ…å†µï¼Œä¸–ç•ŒçŠ¶æ€æ•°æ®åº“çš„å®ç°æ–¹å¼å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œä»è€Œå¯ä»¥æœ‰æ•ˆåœ°å®ç°è¿™äº›æƒ…å†µã€‚ä¸–ç•ŒçŠ¶æ€æ•°æ®åº“çš„é€‰é¡¹å½“å‰åŒ…æ‹¬LevelDBå’ŒCouchDBã€‚ LevelDB is the default and is particularly appropriate when ledger states are simple key-value pairs. A LevelDB database is co-located with the peer node â€“ it is embedded within the same operating system process. LevelDBæ˜¯é»˜è®¤å€¼ï¼Œå½“è´¦æœ¬çŠ¶æ€ä¸ºç®€å•é”®/å€¼å¯¹æ—¶å°¤å…¶é€‚ç”¨ã€‚LevelDBæ•°æ®åº“ä¸peerèŠ‚ç‚¹ä½äºåŒä¸€ä½ç½®éƒ½åµŒå…¥åœ¨åŒä¸€æ“ä½œç³»ç»Ÿè¿›ç¨‹ä¸­ã€‚ CouchDB is a particularly appropriate choice when ledger states are structured as JSON documents because CouchDB supports the rich queries and update of richer data types often found in business transactions. Implementation-wise, CouchDB runs in a separate operating system process, but there is still a 1:1 relation between a peer node and a CouchDB instance. All of this is invisible to a smart contract. See CouchDB as the StateDatabase for more information on CouchDB. å½“è´¦æœ¬çŠ¶æ€è¢«æ„é€ ä¸ºJSONæ ¼å¼çš„æ–‡æ¡£æ—¶ï¼ŒCouchDBæ˜¯ä¸€ä¸ªç‰¹åˆ«åˆé€‚çš„é€‰æ‹©ï¼Œå› ä¸ºCouchDBæ”¯æŒä¸°å¯Œçš„æŸ¥è¯¢å’Œä¸šåŠ¡äº¤æ˜“ä¸­ç»å¸¸å‘ç”Ÿçš„ä¸°å¯Œæ•°æ®ç±»å‹çš„æ›´æ–°ã€‚åœ¨å®ç°æ–¹é¢ï¼ŒCouchDBåœ¨å•ç‹¬çš„æ“ä½œç³»ç»Ÿè¿›ç¨‹ä¸­è¿è¡Œï¼Œä½†æ˜¯peerèŠ‚ç‚¹å’ŒCouchDBå®ä¾‹ä¹‹é—´ä»ç„¶å­˜åœ¨1æ¯”1çš„å…³ç³»ã€‚ In LevelDB and CouchDB, we see an important aspect of Hyperledger Fabric â€“ it is pluggable. The world state database could be a relational data store, or a graph store, or a temporal database. This provides great flexibility in the types of ledger states that can be efficiently accessed, allowing Hyperledger Fabric to address many different types of problems. åœ¨LevelDBå’ŒCouchDBä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†Hyperledger Fabricçš„é‡è¦æ–¹é¢â€“å®ƒæ˜¯æ’ä»¶åŒ–çš„ã€‚ä¸–ç•ŒçŠ¶æ€æ•°æ®åº“å¯ä»¥æ˜¯å…³ç³»æ•°æ®å­˜å‚¨ï¼Œå›¾å½¢å­˜å‚¨æˆ–æ—¶æ€æ•°æ®åº“ã€‚è¿™ä¸ºå¯ä»¥æœ‰æ•ˆè®¿é—®çš„è´¦æœ¬çŠ¶æ€ç±»å‹æä¾›äº†æå¤§çš„çµæ´»æ€§ï¼Œä»è€Œä½¿Hyperledger Fabricå¯ä»¥è§£å†³è®¸å¤šä¸åŒç±»å‹çš„é—®é¢˜ã€‚ Example Ledger: Basic Asset Transfer ä½¿ç”¨åŒä¸€ä¸ªèº«ä»½åˆ›å»ºå››ä¸ªèµ„äº§ï¼Œè´¦æœ¬ä¼šå˜æˆä¸‹é¢è¿™æ ·ï¼š Namespaces Even though we have presented the ledger as though it were a single world state and single blockchain, thatâ€™s a little bit of an over-simplification. In reality, each chaincode has its own world state that is separate from all other chaincodes. World states are in a namespace so that only smart contracts within the same chaincode can access a given namespace. å³ä½¿æˆ‘ä»¬å·²ç»å°†è´¦æœ¬å‘ˆç°ä¸ºä¸€ä¸ªå•ä¸€çš„ä¸–ç•ŒçŠ¶æ€å’Œå•ä¸ªåŒºå—é“¾ï¼Œä½†è¿™è¿˜æ˜¯æœ‰ç‚¹è¿‡åˆ†ç®€åŒ–äº†ã€‚å®é™…ä¸Šï¼Œæ¯ä¸ªé“¾ç éƒ½æœ‰å…¶è‡ªå·±çš„ä¸–ç•ŒçŠ¶æ€ï¼Œè¯¥çŠ¶æ€ä¸æ‰€æœ‰å…¶ä»–é“¾ç åˆ†å¼€ã€‚ä¸–ç•ŒçŠ¶æ€ä½äºåç§°ç©ºé—´ä¸­ï¼Œå› æ­¤åªæœ‰ç›¸åŒé“¾ç å†…çš„æ™ºèƒ½åˆçº¦æ‰èƒ½è®¿é—®ç»™å®šçš„åç§°ç©ºé—´ã€‚ A blockchain is not namespaced. It contains transactions from many different smart contract namespaces. You can read more about chaincode namespaces in this topic. åŒºå—é“¾æ²¡æœ‰å‘½åç©ºé—´ã€‚å®ƒåŒ…å«æ¥è‡ªè®¸å¤šä¸åŒçš„æ™ºèƒ½åˆçº¦å‘½åç©ºé—´çš„äº¤æ˜“ã€‚æ‚¨å¯ä»¥åœ¨Chaincode namespaceä¸­é˜…è¯»æœ‰å…³é“¾ç åç§°ç©ºé—´çš„æ›´å¤šä¿¡æ¯ã€‚ Channels In Hyperledger Fabric, each channel has a completely separate ledger. This means a completely separate blockchain, and completely separate world states, including namespaces. It is possible for applications and smart contracts to communicate between channels so that ledger information can be accessed between them. åœ¨Hyperledger Fabricä¸­ï¼Œæ¯ä¸ªé€šé“éƒ½æœ‰ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„è´¦æœ¬ã€‚è¿™æ„å‘³ç€å®Œå…¨ç‹¬ç«‹çš„åŒºå—é“¾ï¼Œä»¥åŠå®Œå…¨ç‹¬ç«‹çš„ä¸–ç•ŒçŠ¶æ€ä»¥åŠåç§°ç©ºé—´ã€‚åº”ç”¨ç¨‹åºå’Œæ™ºèƒ½åˆçº¦å¯ä»¥åœ¨é€šé“ä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œä»¥ä¾¿å¯ä»¥åœ¨å®ƒä»¬ä¹‹é—´è®¿é—®åˆ†ç±»å¸ä¿¡æ¯ã€‚","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"Key Concepts","slug":"åŒºå—é“¾/Hyperledger-Fabric/Key-Concepts","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/Key-Concepts/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"Ledger","slug":"Ledger","permalink":"https://guozhe001.github.io/tags/Ledger/"}]},{"title":"Membership Service Provider (MSP)","slug":"blockchain/fabric/å…³é”®æ¦‚å¿µ/MSP","date":"2021-04-01T10:18:21.477Z","updated":"2021-04-01T10:18:21.478Z","comments":true,"path":"2021/04/01/blockchain/fabric/å…³é”®æ¦‚å¿µ/MSP/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/MSP/","excerpt":"","text":"Why do I need an MSP?ï¼ˆä¸ºä»€ä¹ˆæˆ‘éœ€è¦MSPï¼‰ Because Fabric is a permissioned network, blockchain participants need a way to prove their identity to the rest of the network in order to transact on the network. If youâ€™ve read through the documentation on Identity youâ€™ve seen how a Public Key Infrastructure (PKI) can provide verifiable identities through a chain of trust. How is that chain of trust used by the blockchain network? å› ä¸ºFabricæ˜¯ä¸€ä¸ªè®¸å¯å½¢å¼çš„ç½‘ç»œï¼ŒåŒºå—é“¾å‚ä¸è€…éœ€è¦ä¸€ç§å‘ç½‘ç»œå…¶ä»–æˆå‘˜è¯æ˜è‡ªå·±èº«ä»½çš„æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨ç½‘ç»œä¸Šè¿›è¡Œäº¤æ˜“ã€‚å¦‚æœä½ å·²ç»é˜…è¯»äº† Identity æ–‡æ¡£ï¼Œä½ å·²ç»çœ‹åˆ°PKIå¦‚ä½•é€šè¿‡ä¿¡ä»»é“¾æä¾›å¯éªŒè¯çš„èº«ä»½ã€‚åŒºå—é“¾ç½‘ç»œå¦‚ä½•ä½¿ç”¨è¯¥ä¿¡ä»»é“¾ï¼Ÿ Certificate Authorities issue identities by generating a public and private key which forms a key-pair that can be used to prove identity. Because a private key can never be shared publicly, a mechanism is required to enable that proof which is where the MSP comes in. For example, a peer uses its private key to digitally sign, or endorse, a transaction. The MSP on the ordering service contains the peerâ€™s public key which is then used to verify that the signature attached to the transaction is valid. The private key is used to produce a signature on a transaction that only the corresponding public key, that is part of an MSP, can match. Thus, the MSP is the mechanism that allows that identity to be trusted and recognized by the rest of the network without ever revealing the memberâ€™s private key. è¯ä¹¦é¢å‘æœºæ„é€šè¿‡ç”Ÿæˆå…¬é’¥å’Œç§é’¥æ¥é¢å‘èº«ä»½ï¼Œè¯¥å…¬é’¥å’Œç§é’¥å½¢æˆå¯ç”¨äºè¯æ˜èº«ä»½çš„å¯†é’¥å¯¹ã€‚ç”±äºæ°¸è¿œä¸èƒ½å…¬å¼€å…±äº«ç§é’¥ï¼Œå› æ­¤éœ€è¦ä¸€ç§æœºåˆ¶æ¥è¯æ˜ä»–æ˜¯è°ï¼Œç„¶åMSPå°±æ˜¯åšè¿™ä»¶äº‹çš„ã€‚ä¾‹å¦‚ä¸€ä¸ªpeerèŠ‚ç‚¹æ˜¯ç”¨ä»–è‡ªå·±çš„ç§é’¥æ¥ç­¾åæˆ–è€…èƒŒä¹¦ä¸€ä¸ªäº¤æ˜“ã€‚æ’åºæœåŠ¡çš„MSPåŒ…å«äº†peerèŠ‚ç‚¹çš„å…¬é’¥ï¼Œè¯¥å…¬é’¥éšåç”¨äºéªŒè¯é™„åŠ åˆ°äº¤æ˜“çš„ç­¾åæ˜¯å¦æœ‰æ•ˆã€‚ç§é’¥ç”¨äºåœ¨äº¤æ˜“ä¸Šäº§ç”Ÿç­¾åï¼Œåªæœ‰ç›¸åº”çš„å…¬é’¥ï¼ˆMSPçš„ä¸€éƒ¨åˆ†ï¼‰æ‰èƒ½åŒ¹é…è¯¥ç­¾åã€‚å› æ­¤ï¼ŒMSPæ˜¯ä¸€ç§å…è®¸èº«ä»½ç”±ç½‘ç»œçš„å…¶ä½™éƒ¨åˆ†ä¿¡ä»»å’Œè¯†åˆ«ï¼Œè€Œæ— éœ€é€éœ²æˆå‘˜çš„ç§é’¥çš„æœºåˆ¶ã€‚ Recall from the credit card scenario in the Identity topic that the Certificate Authority is like a card provider â€” it dispenses many different types of verifiable identities. An MSP, on the other hand, determines which credit card providers are accepted at the store. In this way, the MSP turns an identity (the credit card) into a role (the ability to buy things at the store). ä»â€œèº«ä»½â€ä¸»é¢˜ä¸­çš„ä¿¡ç”¨å¡ä¸šåŠ¡æƒ…æ™¯ä¸­å›æƒ³èµ·ï¼Œè¯ä¹¦é¢å‘æœºæ„å°±åƒå‘å¡ç»„ç»‡ä¸€æ ·-å®ƒåˆ†é…äº†è®¸å¤šä¸åŒç±»å‹çš„å¯éªŒè¯èº«ä»½ã€‚å¦ä¸€æ–¹é¢ï¼ŒMSPç¡®å®šå•†åº—æ¥å—å“ªäº›ä¿¡ç”¨å¡å‘å¡ç»„ç»‡ã€‚è¿™æ ·ï¼ŒMSPå°†èº«ä»½ï¼ˆä¿¡ç”¨å¡ï¼‰è½¬å˜ä¸ºè§’è‰²ï¼ˆåœ¨å•†åº—è´­ä¹°å•†å“çš„èƒ½åŠ›ï¼‰ã€‚ This ability to turn verifiable identities into roles is fundamental to the way Fabric networks function, since it allows organizations, nodes, and channels the ability establish MSPs that determine who is allowed to do what at the organization, node, and channel level. è¿™ç§å°†å¯éªŒè¯èº«ä»½è½¬æ¢ä¸ºè§’è‰²çš„èƒ½åŠ›æ˜¯Fabricç½‘ç»œè¿è¡Œæ–¹å¼çš„åŸºç¡€ï¼Œå› ä¸ºå®ƒå…è®¸ç»„ç»‡ï¼ŒèŠ‚ç‚¹å’Œæ¸ é“å…·å¤‡å»ºç«‹MSPçš„èƒ½åŠ›ï¼Œä»è€Œç¡®å®šå…è®¸è°åœ¨ç»„ç»‡ï¼ŒèŠ‚ç‚¹å’Œæ¸ é“çº§åˆ«ä¸Šåšä»€ä¹ˆã€‚ Identities are similar to your credit cards that are used to prove you can pay. The MSP is similar to the list of accepted credit cards. Consider a consortium of banks that operate a blockchain network. Each bank operates peer and ordering nodes, and the peers endorse transactions submitted to the network. However, each bank would also have departments and account holders. The account holders would belong to each organization, but would not run nodes on the network. They would only interact with the system from their mobile or web application. So how does the network recognize and differentiate these identities? A CA was used to create the identities, but like the card example, those identities canâ€™t just be issued, they need to be recognized by the network. MSPs are used to define the organizations that are trusted by the network members. MSPs are also the mechanism that provide members with a set of roles and permissions within the network. Because the MSPs defining these organizations are known to the members of a network, they can then be used to validate that network entities that attempt to perform actions are allowed to. è€ƒè™‘ä¸€ä¸ªç»è¥åŒºå—é“¾ç½‘ç»œçš„é“¶è¡Œè”ç›Ÿã€‚æ¯ä¸ªé“¶è¡Œéƒ½æ“ä½œpeerèŠ‚ç‚¹å’Œæ’åºèŠ‚ç‚¹ï¼Œå¹¶ä¸”peerèŠ‚ç‚¹è®¤å¯æäº¤ç»™ç½‘ç»œçš„äº¤æ˜“ã€‚ä½†æ˜¯æ¯ä¸ªé“¶è¡Œä¹ŸåŒæ ·æœ‰éƒ¨é—¨å’Œè´¦æˆ·æŒæœ‰è€…ã€‚å¸æˆ·æŒæœ‰è€…å°†å±äºå„è‡ªçš„ç»„ç»‡ï¼Œä½†ä¸ä¼šåœ¨ç½‘ç»œä¸Šè¿è¡ŒèŠ‚ç‚¹ã€‚ä»–ä»¬åªèƒ½é€šè¿‡å…¶ç§»åŠ¨æˆ–Webåº”ç”¨ç¨‹åºä¸ç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚é‚£ä¹ˆç½‘ç»œå¦‚ä½•è¯†åˆ«å’ŒåŒºåˆ†è¿™äº›èº«ä»½å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨CAæ¥åˆ›å»ºèº«ä»½ï¼Œä½†æ˜¯å°±åƒå¡ç‰‡ç¤ºä¾‹ä¸€æ ·ï¼Œä¸èƒ½ä»…ä»…æ˜¯é¢å‘äº†èº«ä»½ï¼Œè¿˜å¿…é¡»ç”±ç½‘ç»œæ¥è¯†åˆ«è¿™äº›èº«ä»½ã€‚MSPç”¨äºå®šä¹‰ç½‘ç»œæˆå‘˜ä¿¡ä»»çš„ç»„ç»‡ã€‚MSPè¿˜æ˜¯ä¸€ä¸ªæœºåˆ¶ï¼Œè¿™ä¸ªæœºåˆ¶ä¸ºæˆå‘˜æä¾›ç½‘ç»œä¸­çš„ä¸€ç»„è§’è‰²å’Œæƒé™ã€‚ç”±äºMSPå®šä¹‰çš„è¿™äº›ç»„ç»‡å¯¹ç½‘ç»œæˆå‘˜è€Œè¨€æ˜¯å·²çŸ¥çš„ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥ç”¨äºéªŒè¯å…è®¸å°è¯•æ‰§è¡Œæ“ä½œçš„ç½‘ç»œå®ä½“ã€‚ Finally, consider if you want to join an existing network, you need a way to turn your identity into something that is recognized by the network. The MSP is the mechanism that enables you to participate on a permissioned blockchain network. To transact on a Fabric network a member needs to: Have an identity issued by a CA that is trusted by the network. Become a member of an organization that is recognized and approved by the network members. The MSP is how the identity is linked to the membership of an organization. Membership is achieved by adding the memberâ€™s public key (also known as certificate, signing cert, or signcert) to the organizationâ€™s MSP. Add the MSP to either a consortium on the network or a channel. Ensure the MSP is included in the policy definitions on the network. æœ€åï¼Œè€ƒè™‘å¦‚æœä½ æƒ³è¦åŠ å…¥ä¸€ä¸ªç°æœ‰ç½‘ç»œï¼Œä½ éœ€è¦ä¸€ä¸ªæ–¹æ³•æ¥å°†ä½ çš„èº«ä»½è½¬æ¢ä¸ºç½‘ç»œå¯è¯†åˆ«çš„å†…å®¹ã€‚MSPæ˜¯ä½¿æ‚¨èƒ½å¤Ÿå‚ä¸è®¸å¯çš„åŒºå—é“¾ç½‘ç»œçš„æœºåˆ¶ã€‚ä¸ºäº†åœ¨Fabricçš„ç½‘ç»œä¸Šè¿›è¡Œäº¤æ˜“ï¼Œä¸€ä¸ªæˆå‘˜éœ€è¦ï¼š å…·æœ‰ç”±ç½‘ç»œä¿¡ä»»çš„CAé¢å‘çš„èº«ä»½ã€‚ æˆä¸ºç”±ç½‘ç»œæˆå‘˜è®¤å¯å¹¶æ‰¹å‡†çš„ç»„ç»‡çš„æˆå‘˜ã€‚MSPæ˜¯å°†èº«ä»½é“¾æ¥åˆ°ç»„ç»‡æˆå‘˜çš„æ–¹å¼ã€‚æˆå‘˜èµ„æ ¼æ˜¯é€šè¿‡å°†æˆå‘˜çš„å…¬é’¥ï¼ˆä¹Ÿç§°ä¸ºè¯ä¹¦ï¼Œç­¾åè¯ä¹¦æˆ–signcertï¼‰æ·»åŠ åˆ°ç»„ç»‡çš„MSPä¸­æ¥å®ç°çš„ã€‚ å°†MSPæ·»åŠ åˆ°ç½‘ç»œä¸Šçš„è”ç›Ÿæˆ–é€šé“ä¸Šã€‚ ç¡®ä¿MSPåŒ…å«åœ¨ç½‘ç»œä¸Šå®šä¹‰çš„ç­–ç•¥ã€‚ What is an MSP? Despite its name, the Membership Service Provider does not actually provide anything. Rather, the implementation of the MSP requirement is a set of folders that are added to the configuration of the network and is used to define an organization both inwardly (organizations decide who its admins are) and outwardly (by allowing other organizations to validate that entities have the authority to do what they are attempting to do). Whereas Certificate Authorities generate the certificates that represent identities, the MSP contains a list of permissioned identities. The MSP identifies which Root CAs and Intermediate CAs are accepted to define the members of a trust domain by listing the identities of their members, or by identifying which CAs are authorized to issue valid identities for their members. But the power of an MSP goes beyond simply listing who is a network participant or member of a channel. It is the MSP that turns an identity into a role by identifying specific privileges an actor has on a node or channel. Note that when a user is registered with a Fabric CA, a role of admin, peer, client, orderer, or member must be associated with the user. For example, identities registered with the â€œpeerâ€ role should, naturally, be given to a peer. Similarly, identities registered with the â€œadminâ€ role should be given to organization admins. Weâ€™ll delve more into the significance of these roles later in the topic. In addition, an MSP can allow for the identification of a list of identities that have been revoked â€” as discussed in the Identity documentation â€” but we will talk about how that process also extends to an MSP. MSP domains MSPs occur in two domains in a blockchain network: Locally on an actorâ€™s node (local MSP) In channel configuration (channel MSP) The key difference between local and channel MSPs is not how they function â€“ both turn identities into roles â€“ but their scope. Each MSP lists roles and permissions at a particular level of administration. æœ¬åœ°MSPå’Œé€šé“MSPä¹‹é—´çš„ä¸»è¦åŒºåˆ«ä¸æ˜¯å®ƒä»¬çš„åŠŸèƒ½ï¼ˆä¸¤è€…éƒ½å°†èº«ä»½è½¬æ¢ä¸ºè§’è‰²ï¼‰ï¼Œè€Œæ˜¯å®ƒä»¬çš„èŒƒå›´ã€‚æ¯ä¸ªMSPéƒ½åˆ—å‡ºç‰¹å®šç®¡ç†çº§åˆ«çš„è§’è‰²å’Œæƒé™ã€‚ Local MSPs Local MSPs are defined for clients and for nodes (peers and orderers). Local MSPs define the permissions for a node (who are the peer admins who can operate the node, for example). The local MSPs of clients (the account holders in the banking scenario above), allow the user to authenticate itself in its transactions as a member of a channel (e.g. in chaincode transactions), or as the owner of a specific role into the system such as an organization admin, for example, in configuration transactions. Local MSPsæ˜¯ä¸ºå®¢æˆ·ç«¯å’ŒèŠ‚ç‚¹ï¼ˆpeerså’Œè®¢orderersï¼‰å®šä¹‰çš„ã€‚æœ¬åœ°MSPå®šä¹‰äº†ä¸€ä¸ªèŠ‚ç‚¹çš„æƒé™ï¼ˆä¾‹å¦‚è°æ˜¯peerçš„ç®¡ç†å‘˜ï¼Œè°å¯ä»¥æ“ä½œè¿™ä¸ªèŠ‚ç‚¹ï¼‰ã€‚å®¢æˆ·ç«¯çš„æœ¬åœ°MSPï¼ˆä¸Šè¿°é“¶è¡Œä¸šåŠ¡åœºæ™¯ä¸­çš„å¸æˆ·æŒæœ‰äººï¼‰å…è®¸ç”¨æˆ·åœ¨è‡ªèº«äº¤æ˜“ä¸­ä½œä¸ºé€šé“æˆå‘˜è¿›è¡Œèº«ä»½éªŒè¯ï¼ˆä¾‹å¦‚åœ¨é“¾ç ä¸­äº¤æ˜“ä¸­ï¼‰ï¼Œæˆ–è€…ä½œä¸ºç³»ç»Ÿä¸­ç‰¹å®šè§’è‰²ï¼ˆä¾‹å¦‚ç»„ç»‡ç®¡ç†å‘˜ï¼‰çš„æ‰€æœ‰è€…ï¼Œä¾‹å¦‚ï¼Œåœ¨é…ç½®äº‹åŠ¡ä¸­ã€‚ Every node must have a local MSP defined, as it defines who has administrative or participatory rights at that level (peer admins will not necessarily be channel admins, and vice versa). This allows for authenticating member messages outside the context of a channel and to define the permissions over a particular node (who has the ability to install chaincode on a peer, for example). Note that one or more nodes can be owned by an organization. An MSP defines the organization admins. And the organization, the admin of the organization, the admin of the node, and the node itself should all have the same root of trust. æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦å®šä¹‰ä¸€ä¸ªæœ¬åœ°çš„MSPï¼Œå› ä¸ºå®ƒå®šä¹‰äº†åœ¨è¯¥çº§åˆ«å…·æœ‰ç®¡ç†æˆ–å‚ä¸æƒçš„äººï¼ˆpeerç®¡ç†å‘˜ä¸ä¸€å®šæ˜¯é€šé“ç®¡ç†å‘˜ï¼Œåä¹‹äº¦ç„¶ï¼‰ã€‚è¿™å…è®¸åœ¨é€šé“ä¸Šä¸‹æ–‡ä¹‹å¤–å¯¹æˆå‘˜æ¶ˆæ¯è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå¹¶å®šä¹‰å¯¹ç‰¹å®šèŠ‚ç‚¹çš„æƒé™ï¼ˆå¦‚è°æœ‰èƒ½åŠ›åœ¨peerä¸Šå®‰è£…é“¾ç ï¼‰ã€‚è¯·æ³¨æ„ï¼Œä¸€ä¸ªç»„ç»‡å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ã€‚MSPå®šä¹‰ç»„ç»‡ç®¡ç†å‘˜ã€‚ç»„ç»‡ã€ç»„ç»‡çš„ç®¡ç†å‘˜ã€èŠ‚ç‚¹çš„ç®¡ç†å‘˜ä»¥åŠèŠ‚ç‚¹æœ¬èº«éƒ½åº”å…·æœ‰ç›¸åŒçš„æ ¹CAã€‚ An orderer local MSP is also defined on the file system of the node and only applies to that node. Like peer nodes, orderers are also owned by a single organization and therefore have a single MSP to list the actors or nodes it trusts. åœ¨æ’åºè€…èŠ‚ç‚¹çš„æ–‡ä»¶ç³»ç»Ÿä¸Šä¹Ÿå®šä¹‰äº†æœ¬åœ°MSPï¼Œå®ƒä»…é€‚ç”¨äºè¯¥èŠ‚ç‚¹ã€‚å°±åƒpeerèŠ‚ç‚¹ä¸€æ ·ï¼Œæ’åºè€…ç”±å•ä¸ªç»„ç»‡æ‹¥æœ‰ï¼Œå› æ­¤æœ‰ä¸€ä¸ªMSPåˆ—å‡ºå…¶ä¿¡ä»»çš„å‚ä¸è€…æˆ–èŠ‚ç‚¹ã€‚ Channel MSPs In contrast, channel MSPs define administrative and participatory rights at the channel level. Peers and ordering nodes on an application channel share the same view of channel MSPs, and will therefore be able to correctly authenticate the channel participants. This means that if an organization wishes to join the channel, an MSP incorporating the chain of trust for the organizationâ€™s members would need to be included in the channel configuration. Otherwise transactions originating from this organizationâ€™s identities will be rejected. Whereas local MSPs are represented as a folder structure on the file system, channel MSPs are described in a channel configuration. ç›¸åï¼Œé€šé“MSPåœ¨é€šé“çº§åˆ«å®šä¹‰äº†ç®¡ç†æƒå’Œå‚ä¸æƒã€‚åº”ç”¨ç¨‹åºé€šé“ä¸Šçš„peerèŠ‚ç‚¹å’Œæ’åºèŠ‚ç‚¹å…±äº«é€šé“MSPçš„ç›¸åŒè§†å›¾ï¼Œå› æ­¤å°†èƒ½å¤Ÿæ­£ç¡®åœ°éªŒè¯é€šé“å‚ä¸è€…ã€‚è¿™æ„å‘³ç€å¦‚æœç»„ç»‡å¸Œæœ›åŠ å…¥é€šé“ï¼Œåˆ™éœ€è¦åœ¨é€šé“é…ç½®ä¸­åŒ…å«ä¸€ä¸ªåŒ…å«ç»„ç»‡æˆå‘˜ä¿¡ä»»é“¾çš„MSPã€‚å¦åˆ™ï¼Œæ¥è‡ªè¯¥ç»„ç»‡èº«ä»½çš„äº¤æ˜“å°†è¢«æ‹’ç»ã€‚æœ¬åœ°MSPåœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šè¡¨ç¤ºä¸ºæ–‡ä»¶å¤¹ç»“æ„ï¼Œè€Œé€šé“MSPåˆ™åœ¨é€šé“é…ç½®ä¸­æè¿°ã€‚ Snippet from a channel config.json file that includes two organization MSPs. Channel MSPs identify who has authorities at a channel level. The channel MSP defines the relationship between the identities of channel members (which themselves are MSPs) and the enforcement of channel level policies. Channel MSPs contain the MSPs of the organizations of the channel members. **é€šé“MSPè¯†åˆ«è°æ‹¥æœ‰é€šé“çº§åˆ«çš„æƒé™ã€‚**é€šé“MSPå®šä¹‰äº†é€šé“æˆå‘˜èº«ä»½ï¼ˆæœ¬èº«å°±æ˜¯MSPï¼‰å’Œé€šé“çº§ç­–ç•¥æ‰§è¡Œä¹‹é—´çš„å…³ç³»ã€‚é€šé“MSPåŒ…å«é€šé“æˆå‘˜ç»„ç»‡çš„MSPã€‚ Every organization participating in a channel must have an MSP defined for it. In fact, it is recommended that there is a one-to-one mapping between organizations and MSPs. The MSP defines which members are empowered to act on behalf of the organization. This includes configuration of the MSP itself as well as approving administrative tasks that the organization has role, such as adding new members to a channel. If all network members were part of a single organization or MSP, data privacy is sacrificed. Multiple organizations facilitate privacy by segregating ledger data to only channel members. If more granularity is required within an organization, the organization can be further divided into organizational units (OUs) which we describe in more detail later in this topic. **æ¯ä¸ªå‚ä¸æ¸ é“çš„ç»„ç»‡éƒ½å¿…é¡»ä¸ºå…¶å®šä¹‰MSPã€‚**å®é™…ä¸Šï¼Œå»ºè®®ç»„ç»‡ä¸MSPä¹‹é—´å­˜åœ¨ä¸€å¯¹ä¸€çš„æ˜ å°„ã€‚MSPå®šä¹‰äº†å“ªäº›æˆå‘˜æœ‰æƒä»£è¡¨ç»„ç»‡è¡Œäº‹ã€‚è¿™åŒ…æ‹¬MSPæœ¬èº«çš„é…ç½®ä»¥åŠæ‰¹å‡†ç»„ç»‡æ‰€æ‰®æ¼”çš„ç®¡ç†ä»»åŠ¡ï¼Œä¾‹å¦‚å°†æ–°æˆå‘˜æ·»åŠ åˆ°æ¸ é“ã€‚å¦‚æœæ‰€æœ‰ç½‘ç»œæˆå‘˜éƒ½æ˜¯å•ä¸ªç»„ç»‡æˆ–MSPçš„ä¸€éƒ¨åˆ†ï¼Œåˆ™ä¼šç‰ºç‰²æ•°æ®éšç§ã€‚å¤šä¸ªç»„ç»‡é€šè¿‡å°†è´¦æœ¬æ•°æ®ä»…éš”ç¦»åˆ°é€šé“æˆå‘˜æ¥ä¿ƒæˆéšç§ã€‚å¦‚æœåœ¨ç»„ç»‡å†…éœ€è¦æ›´å¤šçš„ç²’åº¦ï¼Œåˆ™å¯ä»¥å°†ç»„ç»‡è¿›ä¸€æ­¥åˆ’åˆ†ä¸ºç»„ç»‡å•ä½ï¼ˆOUï¼‰ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬ä¸»é¢˜çš„åé¢éƒ¨åˆ†å¯¹æ­¤è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚ The system channel MSP includes the MSPs of all the organizations that participate in an ordering service. An ordering service will likely include ordering nodes from multiple organizations and collectively these organizations run the ordering service, most importantly managing the consortium of organizations and the default policies that are inherited by the application channels. **ç³»ç»Ÿé€šé“MSPåŒ…æ‹¬åŠ å…¥æ’åºæœåŠ¡çš„æ‰€æœ‰ç»„ç»‡çš„MSPã€‚**æ’åºæœåŠ¡å¯èƒ½ä¼šåŒ…æ‹¬æ¥è‡ªå¤šä¸ªç»„ç»‡çš„æ’åºèŠ‚ç‚¹ï¼Œå¹¶ä¸”è¿™äº›ç»„ç»‡å…±åŒè¿è¡Œæ’åºæœåŠ¡ï¼Œæœ€é‡è¦çš„æ˜¯ç®¡ç†ç»„ç»‡è”ç›Ÿå’Œåº”ç”¨ç¨‹åºé€šé“ç»§æ‰¿çš„é»˜è®¤ç­–ç•¥ã€‚ Local MSPs are only defined on the file system of the node or user to which they apply. Therefore, physically and logically there is only one local MSP per node. However, as channel MSPs are available to all nodes in the channel, they are logically defined once in the channel configuration. However, a channel MSP is also instantiated on the file system of every node in the channel and kept synchronized via consensus. So while there is a copy of each channel MSP on the local file system of every node, logically a channel MSP resides on and is maintained by the channel or the network. **æœ¬åœ°MSPä»…åœ¨å®ƒä»¬åº”ç”¨åˆ°çš„èŠ‚ç‚¹æˆ–ç”¨æˆ·çš„æ–‡ä»¶ç³»ç»Ÿä¸Šå®šä¹‰ã€‚**å› æ­¤ï¼Œåœ¨ç‰©ç†ä¸Šå’Œé€»è¾‘ä¸Šæ¯ä¸ªèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªæœ¬åœ°MSPã€‚ä½†æ˜¯ï¼Œç”±äºé€šé“MSPå¯ç”¨äºé€šé“ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œå› æ­¤å®ƒä»¬åœ¨é€šé“é…ç½®ä¸­è¢«é€»è¾‘å®šä¹‰ä¸€æ¬¡ã€‚ä½†æ˜¯ï¼Œé€šé“MSPä¹Ÿä¼šåœ¨è¯¥é€šé“ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„æ–‡ä»¶ç³»ç»Ÿä¸Šå®ä¾‹åŒ–ï¼Œå¹¶é€šè¿‡å…±è¯†ä¿æŒåŒæ­¥ã€‚å› æ­¤ï¼Œå°½ç®¡æ¯ä¸ªèŠ‚ç‚¹çš„æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸Šéƒ½æœ‰æ¯ä¸ªé€šé“MSPçš„å‰¯æœ¬ï¼Œä½†ä»é€»è¾‘ä¸Šè®²ï¼Œé€šé“MSPé©»ç•™åœ¨é€šé“æˆ–ç½‘ç»œä¸Šå¹¶ç”±é€šé“æˆ–ç½‘ç»œç»´æŠ¤ã€‚ The following diagram illustrates how local and channel MSPs coexist on the network: ä¸‹å›¾è¯´æ˜äº†æœ¬åœ°å’Œé€šé“MSPåœ¨ç½‘ç»œä¸Šå¦‚ä½•å…±å­˜ï¼š The MSPs for the peer and orderer are local, whereas the MSPs for a channel (including the network configuration channel, also known as the system channel) are global, shared across all participants of that channel. In this figure, the network system channel is administered by ORG1, but another application channel can be managed by ORG1 and ORG2. The peer is a member of and managed by ORG2, whereas ORG1 manages the orderer of the figure. ORG1 trusts identities from RCA1, whereas ORG2 trusts identities from RCA2. It is important to note that these are administration identities, reflecting who can administer these components. So while ORG1 administers the network, ORG2.MSP does exist in the network definition. What role does an organization play in an MSP?ï¼ˆç»„ç»‡åœ¨MSPä¸­æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Ÿï¼‰ An organization is a logical managed group of members. This can be something as big as a multinational corporation or a small as a flower shop. Whatâ€™s most important about organizations (or orgs) is that they manage their members under a single MSP. The MSP allows an identity to be linked to an organization. Note that this is different from the organization concept defined in an X.509 certificate, which we mentioned above. ç»„ç»‡æ˜¯æˆå‘˜çš„é€»è¾‘æ‰˜ç®¡ç»„ã€‚å®ƒå¯ä»¥åƒè·¨å›½å…¬å¸ä¸€æ ·å¤§ï¼Œä¹Ÿå¯ä»¥åƒèŠ±åº—ä¸€æ ·å°ã€‚å¯¹äºç»„ç»‡è€Œè¨€æœ€é‡è¦çš„æ˜¯ä»–ä»¬åœ¨å•ä¸ªMSPä¸‹ç®¡ç†æˆå‘˜ã€‚MSPå…è®¸å°†èº«ä»½é“¾æ¥åˆ°ç»„ç»‡ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸æˆ‘ä»¬ä¸Šé¢æåˆ°çš„X.509è¯ä¹¦ä¸­å®šä¹‰çš„ç»„ç»‡æ¦‚å¿µä¸åŒã€‚ The exclusive relationship between an organization and its MSP makes it sensible to name the MSP after the organization, a convention youâ€™ll find adopted in most policy configurations. For example, organization ORG1 would likely have an MSP called something like ORG1-MSP. In some cases an organization may require multiple membership groups â€” for example, where channels are used to perform very different business functions between organizations. In these cases it makes sense to have multiple MSPs and name them accordingly, e.g., ORG2-MSP-NATIONAL and ORG2-MSP-GOVERNMENT, reflecting the different membership roots of trust within ORG2 in the NATIONAL sales channel compared to the GOVERNMENT regulatory channel. ç”±äºç»„ç»‡åŠå…¶MSPä¹‹é—´çš„æ’ä»–å…³ç³»ï¼Œå› æ­¤ç”¨ç»„ç»‡åç§°æ¥å‘½åMSPæ˜¯å¾ˆæ˜æ™ºçš„ï¼Œè¿™æ˜¯å¤§å¤šæ•°ç­–ç•¥é…ç½®ä¸­éƒ½ä¼šé‡‡ç”¨çš„çº¦å®šã€‚ä¾‹å¦‚ç»„ç»‡ORG1 ä¼šæœ‰ä¸€ä¸ªåä¸ºORG1-MSPçš„MSPã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ç»„ç»‡å¯èƒ½éœ€è¦å¤šä¸ªæˆå‘˜ç»„ï¼›ä¾‹å¦‚ï¼Œåœ¨ç»„ç»‡ä¹‹é—´ä½¿ç”¨é€šé“æ‰§è¡Œéå¸¸ä¸åŒçš„ä¸šåŠ¡åŠŸèƒ½çš„æƒ…å†µã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ‹¥æœ‰å¤šä¸ªMSPå¹¶ç›¸åº”åœ°å‘½åå®ƒä»¬æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ï¼Œï¼Œä¾‹å¦‚ORG2-MSP-NATIONALå’ŒORG2-MSP-GOVERNMENTï¼Œä½“ç°å‡ºORG2å†…éƒ¨åœ¨äº¤æ˜“é€šé“å’Œç›‘ç®¡é€šé“çš„ä¸¤ä¸ªä¸åŒçš„ä¿¡ä»»æ ¹æºã€‚ Organizational Units (OUs) and MSPsï¼ˆç»„ç»‡å•ä½ï¼ˆOUï¼‰å’ŒMSPï¼‰ An organization can also be divided into multiple organizational units, each of which has a certain set of responsibilities, also referred to as affiliations. Think of an OU as a department inside an organization. For example, the ORG1 organization might have both ORG1.MANUFACTURING and ORG1.DISTRIBUTION OUs to reflect these separate lines of business. When a CA issues X.509 certificates, the OU field in the certificate specifies the line of business to which the identity belongs. A benefit of using OUs like this is that these values can then be used in policy definitions in order to restrict access or in smart contracts for attribute-based access control. Otherwise, separate MSPs would need to be created for each organization. ä¸€ä¸ªç»„ç»‡ä¹Ÿå¯ä»¥åˆ†ä¸ºå¤šä¸ªç»„ç»‡å•ä½ï¼Œæ¯ä¸ªç»„ç»‡å•ä½éƒ½æœ‰ä¸€å®šçš„èŒè´£é›†ï¼Œä¹Ÿç§°ä¸ºä»å±å…³ç³»ã€‚å°†OUè§†ä¸ºç»„ç»‡å†…éƒ¨çš„ä¸€ä¸ªéƒ¨é—¨ã€‚ä¾‹å¦‚ï¼ŒORG1ç»„ç»‡å¯èƒ½åŒæ—¶å…·æœ‰ORG1.MANUFACTURINGå’ŒORG1.DISTRIBUTION ä¸¤ä¸ªç»„ç»‡å•ä½ï¼Œä»¥åæ˜ è¿™äº›å•ç‹¬çš„ä¸šåŠ¡çº¿ã€‚å½“CAé¢å‘X.509è¯ä¹¦æ—¶ï¼Œè¯ä¹¦ä¸­çš„OUå­—æ®µä¼šæŒ‡å®šèº«ä»½æ‰€å±çš„ä¸šåŠ¡èŒƒå›´ã€‚ä½¿ç”¨è¿™æ ·çš„OUçš„å¥½å¤„æ˜¯ï¼Œå¯å°†å…¶ç”¨äºç­–ç•¥å®šä¹‰ä¸­ä»¥é™åˆ¶è®¿é—®ï¼Œæˆ–ç”¨äºåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶çš„æ™ºèƒ½åˆçº¦ä¸­ã€‚å¦åˆ™ï¼Œå°†éœ€è¦ä¸ºæ¯ä¸ªç»„ç»‡åˆ›å»ºå•ç‹¬çš„MSPã€‚ Specifying OUs is optional. If OUs are not used, all of the identities that are part of an MSP â€” as identified by the Root CA and Intermediate CA folders â€” will be considered members of the organization. æŒ‡å®šOUæ˜¯å¯é€‰çš„ã€‚å¦‚æœä¸ä½¿ç”¨OUï¼Œåˆ™MSPéƒ¨åˆ†çš„æ‰€æœ‰èº«ä»½ï¼ˆç”±æ ¹CAå’Œä¸­çº§CAæ–‡ä»¶å¤¹æ ‡è¯†ï¼‰å°†è¢«è§†ä¸ºç»„ç»‡çš„æˆå‘˜ã€‚ Node OU Roles and MSPs Additionally, there is a special kind of OU, sometimes referred to as a Node OU, that can be used to confer a role onto an identity. These Node OU roles are defined in the $FABRIC_CFG_PATH/msp/config.yaml file and contain a list of organizational units whose members are considered to be part of the organization represented by this MSP. This is particularly useful when you want to restrict the members of an organization to the ones holding an identity (signed by one of MSP designated CAs) with a specific Node OU role in it. For example, with node OUâ€™s you can implement a more granular endorsement policy that requires Org1 peers to endorse a transaction, rather than any member of Org1. æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç§ç‰¹æ®Šçš„OUï¼Œæœ‰æ—¶ä¹Ÿç§°ä¸ºèŠ‚ç‚¹OUï¼Œå¯ç”¨äºå°†è§’è‰²èµ‹äºˆèº«ä»½ã€‚è¿™äº›èŠ‚ç‚¹OUè§’è‰²åœ¨$FABRIC_CFG_PATH/msp/config.yamlæ–‡ä»¶ä¸­å®šä¹‰ï¼Œå¹¶ä¸”åŒ…å«ä¸€ä¸ªç»„ç»‡å•ä½åˆ—è¡¨ï¼Œå…¶æˆå‘˜è¢«è§†ä¸ºæ­¤MSPä»£è¡¨çš„ç»„ç»‡çš„ä¸€éƒ¨åˆ†ã€‚å½“æ‚¨å¸Œæœ›å°†ç»„ç»‡çš„æˆå‘˜é™åˆ¶ä¸ºæŒæœ‰å…·æœ‰ç‰¹å®šNode OUè§’è‰²çš„èº«ä»½ï¼ˆç”±MSPæŒ‡å®šçš„CAä¹‹ä¸€ç­¾åï¼‰çš„æˆå‘˜æ—¶ï¼Œæ­¤åŠŸèƒ½ç‰¹åˆ«æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡èŠ‚ç‚¹OUï¼Œæ‚¨å¯ä»¥å®æ–½æ›´ç²¾ç»†çš„è®¤å¯æ”¿ç­–ï¼Œè¯¥æ”¿ç­–è¦æ±‚Org1peerè®¤å¯äº¤æ˜“ï¼Œè€Œä¸æ˜¯Org1çš„ä»»ä½•æˆå‘˜ã€‚ In order to use the Node OU roles, the â€œidentity classificationâ€ feature must be enabled for the network. When using the folder-based MSP structure, this is accomplished by enabling â€œNode OUsâ€ in the config.yaml file which resides in the root of the MSP folder: ä¸ºäº†ä½¿ç”¨èŠ‚ç‚¹OUè§’è‰²ï¼Œå¿…é¡»ä¸ºç½‘ç»œå¯ç”¨â€œèº«ä»½åˆ†ç±»â€åŠŸèƒ½ã€‚å½“ä½¿ç”¨åŸºäºæ–‡ä»¶å¤¹çš„MSPç»“æ„æ—¶ï¼Œå¯é€šè¿‡å¯ç”¨ä½äºMSPæ–‡ä»¶å¤¹æ ¹ç›®å½•ä¸­çš„config.yamlæ–‡ä»¶ä¸­çš„ â€œNode OUsâ€æ¥å®ç° 1234567891011121314NodeOUs: Enable: true ClientOUIdentifier: Certificate: cacerts/ca.sampleorg-cert.pem OrganizationalUnitIdentifier: client PeerOUIdentifier: Certificate: cacerts/ca.sampleorg-cert.pem OrganizationalUnitIdentifier: peer AdminOUIdentifier: Certificate: cacerts/ca.sampleorg-cert.pem OrganizationalUnitIdentifier: admin OrdererOUIdentifier: Certificate: cacerts/ca.sampleorg-cert.pem OrganizationalUnitIdentifier: orderer In the example above, there are 4 possible Node OU ROLES for the MSP: client peer admin orderer This convention allows you to distinguish MSP roles by the OU present in the CommonName attribute of the X509 certificate. The example above says that any certificate issued by cacerts/ca.sampleorg-cert.pem in which OU=client will identified as a client, OU=peer as a peer, etc. Starting with Fabric v1.4.3, there is also an OU for the orderer and for admins. The new admins role means that you no longer have to explicitly place certs in the admincerts folder of the MSP directory. Rather, the admin role present in the userâ€™s signcert qualifies the identity as an admin user. æ­¤çº¦å®šå…è®¸æ‚¨é€šè¿‡X509è¯ä¹¦çš„CommonNameå±æ€§ä¸­å­˜åœ¨çš„OUåŒºåˆ†MSPè§’è‰²ã€‚ä¸Šé¢çš„ç¤ºä¾‹è¡¨æ˜ï¼Œç”±cacerts/ca.sampleorg-cert.pemé¢å‘çš„è¯ä¹¦ä¸­ï¼ŒOU=client å°†è¢«æ ‡è¯†ä¸ºå®¢æˆ·ç«¯ï¼ŒOU=peer å°†è¢«æ ‡è¯†ä¸ºpeerã€‚ä»Fabric v1.4.3å¼€å§‹ï¼Œæ’åºè€…å’Œç®¡ç†å‘˜ä¹Ÿæœ‰å¯¹åº”çš„OUã€‚æ–°çš„ç®¡ç†å‘˜è§’è‰²æ„å‘³ç€æ‚¨ä¸å†éœ€è¦å°†è¯ä¹¦æ˜ç¡®æ”¾ç½®åœ¨MSPç›®å½•çš„admincertsæ–‡ä»¶å¤¹ä¸­ï¼›è€Œæ˜¯ç”¨æˆ·ç­¾åè¯ä¹¦ä¸­çš„ç®¡ç†å‘˜è§’è‰²å¯ä»¥å°†èº«ä»½æ ‡è¯†ä¸ºç®¡ç†å‘˜ç”¨æˆ·ã€‚ These Role and OU attributes are assigned to an identity when the Fabric CA or SDK is used to register a user with the CA. It is the subsequent enroll user command that generates the certificates in the usersâ€™ /msp folder. å½“ä½¿ç”¨Fabricçš„CAæˆ–SDKå‘CAæ³¨å†Œç”¨æˆ·æ—¶ï¼Œè¿™äº›è§’è‰²å’ŒOUå±æ€§å°†åˆ†é…ç»™ä¸€ä¸ªèº«ä»½ã€‚éšåä½¿ç”¨ç”¨æˆ·å‘½ä»¤enroll åœ¨ç”¨æˆ· /msp æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆè¯ä¹¦ã€‚ The resulting ROLE and OU attributes are visible inside the X.509 signing certificate located in the /signcerts folder. The ROLE attribute is identified as hf.Type and refers to an actorâ€™s role within its organization, (specifying, for example, that an actor is a peer). See the following snippet from a signing certificate shows how the Roles and OUs are represented in the certificate. ç”Ÿæˆçš„ROLEå’ŒOUå±æ€§åœ¨/signcerts æ–‡ä»¶å¤¹ä¸­çš„X.509ç­¾åè¯ä¹¦ä¸­å¯ä»¥çœ‹åˆ°ã€‚ROLEå±æ€§æ ‡è¯†ä¸ºhf.Typeï¼Œæ˜¯æŒ‡å‚ä¸è€…åœ¨å…¶ç»„ç»‡ä¸­çš„è§’è‰²(ä¾‹å¦‚æŒ‡å®šæ˜¯ä¸€ä¸ªpeer)ã€‚è¯·å‚é˜…ç­¾åè¯ä¹¦ä¸­çš„ä»¥ä¸‹ç‰‡æ®µï¼Œä»¥æ˜¾ç¤ºè§’è‰²å’ŒOUå¦‚ä½•åœ¨è¯ä¹¦ä¸­è¡¨ç¤ºã€‚ Note: For Channel MSPs, just because an actor has the role of an administrator it doesnâ€™t mean that they can administer particular resources. The actual power a given identity has with respect to administering the system is determined by the policies that manage system resources. For example, a channel policy might specify that ORG1-MANUFACTURING administrators, meaning identities with a role of admin and a Node OU of ORG1-MANUFACTURING, have the rights to add new organizations to the channel, whereas the ORG1-DISTRIBUTION administrators have no such rights. **æ³¨æ„ï¼š**å¯¹äºé€šé“MSPï¼Œä»…ä»…å› ä¸ºå‚ä¸è€…å…·æœ‰ç®¡ç†å‘˜è§’è‰²ï¼Œå¹¶ä¸æ„å‘³ç€ä»–ä»¬å¯ä»¥ç®¡ç†ç‰¹å®šèµ„æºã€‚ç»™å®šèº«ä»½åœ¨ç®¡ç†ç³»ç»Ÿæ–¹é¢çš„å®é™…èƒ½åŠ›ç”±ç®¡ç†ç³»ç»Ÿèµ„æºçš„ç­–ç•¥ç¡®å®šã€‚ä¾‹å¦‚ï¼Œæ¸ é“ç­–ç•¥å¯èƒ½æŒ‡å®šORG1-MANUFACTURINGç®¡ç†å‘˜ï¼Œå³å…·æœ‰adminè§’è‰²å’ŒORG1-MANUFACTURINGçš„èŠ‚ç‚¹OUçš„èº«ä»½ï¼Œæœ‰æƒå‘é¢‘é“æ·»åŠ æ–°ç»„ç»‡ï¼Œè€ŒORG1-DISTRIBUTIONç®¡ç†å‘˜åˆ™æ— æ­¤æƒåˆ©ã€‚ Finally, OUs could be used by different organizations in a consortium to distinguish each other. But in such cases, the different organizations have to use the same Root CAs and Intermediate CAs for their chain of trust, and assign the OU field to identify members of each organization. When every organization has the same CA or chain of trust, this makes the system more centralized than what might be desirable and therefore deserves careful consideration on a blockchain network. æœ€åï¼Œè”ç›Ÿä¸­çš„ä¸åŒç»„ç»‡å¯ä»¥ä½¿ç”¨OUæ¥åŒºåˆ†å½¼æ­¤ã€‚ä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸åŒçš„ç»„ç»‡å¿…é¡»ä¸ºå®ƒä»¬çš„ä¿¡ä»»é“¾ä½¿ç”¨ç›¸åŒçš„æ ¹CAå’Œä¸­é—´CAï¼Œå¹¶åˆ†é…OUå­—æ®µä»¥æ ‡è¯†æ¯ä¸ªç»„ç»‡çš„æˆå‘˜ã€‚å½“æ¯ä¸ªç»„ç»‡éƒ½å…·æœ‰ç›¸åŒçš„CAæˆ–ä¿¡ä»»é“¾æ—¶ï¼Œè¿™ä¼šä½¿ç³»ç»Ÿæ¯”å¯èƒ½éœ€è¦çš„ç³»ç»Ÿæ›´åŠ é›†ä¸­ï¼Œå› æ­¤åœ¨åŒºå—é“¾ç½‘ç»œä¸Šå€¼å¾—ä»”ç»†è€ƒè™‘ã€‚ MSP Structure Letâ€™s explore the MSP elements that render the functionality weâ€™ve described so far. è®©æˆ‘ä»¬æ¢ç´¢MSPçš„å…ƒç´ å‘ˆç°æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢æ‰€æè¿°çš„åŠŸèƒ½ã€‚ A local MSP folder contains the following sub-folders: æœ¬åœ°MSPæ–‡ä»¶å¤¹åŒ…å«ä»¥ä¸‹å­æ–‡ä»¶å¤¹ï¼š The figure above shows the subfolders in a local MSP on the file system ä¸Šå›¾æ˜¾ç¤ºäº†æ–‡ä»¶ç³»ç»Ÿä¸Šæœ¬åœ°MSPä¸­çš„å­æ–‡ä»¶å¤¹ config.yaml: Used to configure the identity classification feature in Fabric by enabling â€œNode OUsâ€ and defining the accepted roles. ç”¨äºé€šè¿‡å¯ç”¨â€œNode OUsâ€å¹¶å®šä¹‰æ¥å—çš„è§’è‰²æ¥åœ¨Fabricä¸­é…ç½®èº«ä»½åˆ†ç±»åŠŸèƒ½ã€‚ cacerts: This folder contains a list of self-signed X.509 certificates of the Root CAs trusted by the organization represented by this MSP. There must be at least one Root CA certificate in this MSP folder. æ­¤æ–‡ä»¶å¤¹åŒ…å«ç”±æ­¤MSPä»£è¡¨çš„ç»„ç»‡ä¿¡ä»»çš„æ ¹CAçš„è‡ªç­¾åX.509è¯ä¹¦çš„åˆ—è¡¨ã€‚æ­¤MSPæ–‡ä»¶å¤¹ä¸­è‡³å°‘å¿…é¡»æœ‰ä¸€ä¸ªæ ¹CAè¯ä¹¦ã€‚ This is the most important folder because it identifies the CAs from which all other certificates must be derived to be considered members of the corresponding organization to form the chain of trust. è¿™æ˜¯æœ€é‡è¦çš„æ–‡ä»¶å¤¹ï¼Œå®ƒæ ‡è¯†äº†å¿…é¡»ä»ä¸­å¯¼å‡ºæ‰€æœ‰å…¶ä»–è¯ä¹¦çš„CAï¼Œæ‰èƒ½å°†å…¶è§†ä¸ºç›¸åº”ç»„ç»‡çš„æˆå‘˜ä»¥å½¢æˆä¿¡ä»»é“¾ã€‚ intermediatecerts: This folder contains a list of X.509 certificates of the Intermediate CAs trusted by this organization. Each certificate must be signed by one of the Root CAs in the MSP or by any Intermediate CA whose issuing CA chain ultimately leads back to a trusted Root CA. æ­¤æ–‡ä»¶å¤¹åŒ…å«æ­¤ç»„ç»‡ä¿¡ä»»çš„ä¸­é—´CAçš„X.509è¯ä¹¦çš„åˆ—è¡¨ã€‚æ¯ä¸ªè¯ä¹¦å¿…é¡»ç”±MSPä¸­çš„ä¸€ä¸ªæ ¹CAç­¾åï¼Œæˆ–ç”±å…¶å‘è¡ŒCAé“¾æœ€ç»ˆå¼•å›åˆ°å—ä¿¡ä»»çš„æ ¹CAçš„ä»»ä½•ä¸­é—´CAã€‚ An intermediate CA may represent a different subdivision of the organization (like ORG1-MANUFACTURING and ORG1-DISTRIBUTION do for ORG1), or the organization itself (as may be the case if a commercial CA is leveraged for the organizationâ€™s identity management). In the latter case intermediate CAs can be used to represent organization subdivisions. Here you may find more information on best practices for MSP configuration. Notice, that it is possible to have a functioning network that does not have an Intermediate CA, in which case this folder would be empty. ä¸­é—´CAå¯èƒ½ä»£è¡¨ç»„ç»‡çš„ä¸åŒéƒ¨é—¨ï¼ˆä¾‹å¦‚ORG1çš„ORG1-MANUFACTURINGå’ŒORG1-DISTRIBUTIONï¼‰ï¼Œæˆ–è€…æ˜¯ç»„ç»‡æœ¬èº«ï¼ˆå¦‚æœåˆ©ç”¨å•†ä¸šCAæ¥è¿›è¡Œç»„ç»‡çš„èº«ä»½ç®¡ç†ï¼Œå¯èƒ½å°±æ˜¯è¿™ç§æƒ…å†µï¼‰ã€‚åœ¨åä¸€ç§æƒ…å†µä¸‹ï¼Œä¸­é—´CAå¯ä»¥ç”¨æ¥è¡¨ç¤ºç»„ç»‡ç»†åˆ†ã€‚è¯·æ³¨æ„ï¼Œä¸€ä¸ªæ­£å¸¸è¿è¡Œçš„ç½‘ç»œå¯èƒ½æ²¡æœ‰ä¸­é—´ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ­¤æ–‡ä»¶å¤¹å°†ä¸ºç©ºã€‚ Like the Root CA folder, this folder defines the CAs from which certificates must be issued to be considered members of the organization. ä¸â€œæ ¹CAâ€æ–‡ä»¶å¤¹ç±»ä¼¼ï¼Œæ­¤æ–‡ä»¶å¤¹å®šä¹‰çš„è¯ä¹¦å¿…é¡»æ˜¯ç”±å½“å‰ç»„ç»‡çš„æˆå‘˜æ‰€é¢å‘çš„ã€‚ admincerts (Deprecated from Fabric v1.4.3 and higher): This folder contains a list of identities that define the actors who have the role of administrators for this organization. In general, there should be one or more X.509 certificates in this list. è¯¥æ–‡ä»¶å¤¹åŒ…å«ä¸€ä¸ªèº«ä»½åˆ—è¡¨ï¼Œè¿™äº›èº«ä»½å®šä¹‰äº†å“ªäº›å‚ä¸è€…å…·æœ‰è¯¥ç»„ç»‡çš„ç®¡ç†å‘˜è§’è‰²ã€‚é€šå¸¸ï¼Œæ­¤åˆ—è¡¨ä¸­åº”è¯¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªX.509è¯ä¹¦ã€‚ Note: Prior to Fabric v1.4.3, admins were defined by explicitly putting certs in the admincerts folder in the local MSP directory of your peer. With Fabric v1.4.3 or higher, certificates in this folder are no longer required. Instead, it is recommended that when the user is registered with the CA, that the admin role is used to designate the node administrator. Then, the identity is recognized as an admin by the Node OU role value in their signcert. As a reminder, in order to leverage the admin role, the â€œidentity classificationâ€ feature must be enabled in the config.yaml above by setting â€œNode OUsâ€ to Enable: true. Weâ€™ll explore this more later. æ³¨æ„ï¼š åœ¨Fabric v1.4.3ä¹‹å‰ï¼Œé€šè¿‡æ˜¾å¼å°†è¯ä¹¦æ”¾å…¥peerçš„æœ¬åœ°MSPç›®å½•ä¸‹çš„admincertsæ–‡ä»¶å¤¹ä¸­æ¥å®šä¹‰ç®¡ç†å‘˜ã€‚å¯¹äºFabric v1.4.3æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œä¸å†éœ€è¦æ­¤æ–‡ä»¶å¤¹ä¸­çš„è¯ä¹¦ã€‚ç›¸åï¼Œå»ºè®®åœ¨å‘CAæ³¨å†Œç”¨æˆ·åï¼Œä½¿ç”¨adminè§’è‰²æŒ‡å®šèŠ‚ç‚¹ç®¡ç†å‘˜ã€‚ç„¶åé€šè¿‡å…¶ç­¾åè¯ä¹¦ä¸­çš„èŠ‚ç‚¹OUè§’è‰²å€¼å°†èº«ä»½è¯†åˆ«ä¸ºç®¡ç†å‘˜ã€‚æé†’ä¸€ä¸‹ï¼Œä¸ºäº†åˆ©ç”¨ç®¡ç†å‘˜è§’è‰²ï¼Œå¿…é¡»åœ¨ä¸Šé¢çš„config.yamlä¸­é€šè¿‡å°†â€œNode OUsâ€è®¾ç½®ä¸ºEnableï¼štrueæ¥å¯ç”¨â€œèº«ä»½åˆ†ç±»â€åŠŸèƒ½ã€‚æˆ‘ä»¬å°†åœ¨ä»¥åè¿›è¡Œæ¢è®¨ã€‚ And as a reminder, for Channel MSPs, just because an actor has the role of an administrator it doesnâ€™t mean that they can administer particular resources. The actual power a given identity has with respect to administering the system is determined by the policies that manage system resources. For example, a channel policy might specify that ORG1-MANUFACTURING administrators have the rights to add new organizations to the channel, whereas the ORG1-DISTRIBUTION administrators have no such rights. æé†’ä¸€ä¸‹ï¼Œå¯¹äºé€šé“MSPï¼Œä»…ä»…å› ä¸ºå‚ä¸è€…å…·æœ‰ç®¡ç†å‘˜è§’è‰²ï¼Œå¹¶ä¸æ„å‘³ç€ä»–ä»¬å¯ä»¥ç®¡ç†ç‰¹å®šèµ„æºã€‚ç»™å®šèº«ä»½åœ¨ç®¡ç†ç³»ç»Ÿæ–¹é¢çš„å®é™…èƒ½åŠ›ç”±ç®¡ç†ç³»ç»Ÿèµ„æºçš„ç­–ç•¥ç¡®å®šã€‚ä¾‹å¦‚ï¼Œé€šé“æ”¿ç­–å¯èƒ½æŒ‡å®šORG1-MANUFACTURINGç®¡ç†å‘˜æœ‰æƒå‘è¯¥æ¸ é“æ·»åŠ æ–°ç»„ç»‡ï¼Œè€ŒORG1-DISTRIBUTIONç®¡ç†å‘˜æ²¡æœ‰è¿™ç§æƒåˆ©ã€‚ keystore: (private Key) This folder is defined for the local MSP of a peer or orderer node (or in a clientâ€™s local MSP), and contains the nodeâ€™s private key. This key is used to sign data â€” for example to sign a transaction proposal response, as part of the endorsement phase. æ­¤æ–‡ä»¶å¤¹æ˜¯ä¸ºpeerèŠ‚ç‚¹æˆ–ordererèŠ‚ç‚¹çš„æœ¬åœ°MSPï¼ˆæˆ–åœ¨å®¢æˆ·ç«¯çš„æœ¬åœ°MSPä¸­ï¼‰å®šä¹‰çš„ï¼Œå®ƒåŒ…å«èŠ‚ç‚¹çš„ç§é’¥ã€‚è¿™ä¸ªç§é’¥ç”¨äºç­¾åæ•°æ® - ä¾‹å¦‚åœ¨èƒŒä¹¦é˜¶æ®µç­¾ç½²äº¤æ˜“å»ºè®®å“åº”ã€‚ This folder is mandatory for local MSPs, and must contain exactly one private key. Obviously, access to this folder must be limited only to the identities of users who have administrative responsibility on the peer. å¯¹äºæœ¬åœ°MSPï¼Œæ­¤æ–‡ä»¶å¤¹æ˜¯å¿…éœ€çš„ï¼Œå¹¶ä¸”å¿…é¡»ä»…åŒ…å«ä¸€ä¸ªç§é’¥ã€‚æ˜¾ç„¶ï¼Œå¯¹æ­¤æ–‡ä»¶å¤¹çš„è®¿é—®å¿…é¡»ä»…é™äºå¯¹peerå…·æœ‰ç®¡ç†è´£ä»»çš„ç”¨æˆ·çš„èº«ä»½ã€‚ The channel MSP configuration does not include this folder, because channel MSPs solely aim to offer identity validation functionalities and not signing abilities. é€šé“MSPé…ç½®ä¸åŒ…æ‹¬æ­¤æ–‡ä»¶å¤¹ï¼Œå› ä¸ºé€šé“MSPä»…æ—¨åœ¨æä¾›èº«ä»½éªŒè¯åŠŸèƒ½è€Œä¸æ˜¯ç­¾ååŠŸèƒ½ã€‚ Note: If you are using a Hardware Security Module(HSM) for key management, this folder is empty because the private key is generated by and stored in the HSM. æ³¨æ„ï¼š å¦‚æœä½ ä½¿ç”¨ç¡¬ä»¶çº§åˆ«çš„å®‰å…¨æ¨¡å—(HSM) æ¥ç®¡ç†keyï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹æ˜¯ç©ºçš„å› ä¸ºç§é’¥å·²ç»è¢«ç”Ÿæˆå¹¶å­˜å‚¨åœ¨HSMã€‚ signcert: For a peer or orderer node (or in a clientâ€™s local MSP) this folder contains the nodeâ€™s certificate issued by CA. The certificate represents the nodeâ€™s identity, and this certificateâ€™s corresponding private key can be used to generate signatures which may be verified by anyone with a copy of this certificate. å¯¹äºpeerèŠ‚ç‚¹orderedèŠ‚ç‚¹ï¼ˆæˆ–åœ¨å®¢æˆ·ç«¯çš„æœ¬åœ°MSPä¸­ï¼‰ï¼Œæ­¤æ–‡ä»¶å¤¹åŒ…å«CAé¢å‘çš„èŠ‚ç‚¹çš„è¯ä¹¦ã€‚è¯¥è¯ä¹¦ä»£è¡¨èŠ‚ç‚¹çš„èº«ä»½ï¼Œå¹¶ä¸”è¯¥è¯ä¹¦çš„ç›¸åº”ç§é’¥å¯ç”¨äºç”Ÿæˆç­¾åï¼Œä»»ä½•æ‹¥æœ‰æ­¤è¯ä¹¦å‰¯æœ¬çš„äººéƒ½å¯ä»¥å¯¹å…¶è¿›è¡ŒéªŒè¯ã€‚ This folder is mandatory for local MSPs, and must contain exactly one public key. Obviously, access to this folder must be limited only to the identities of users who have administrative responsibility on the peer. æ­¤æ–‡ä»¶å¤¹å¯¹äºæœ¬åœ°MSPæ˜¯å¿…éœ€çš„ï¼Œå¹¶ä¸”å¿…é¡»ä»…åŒ…å«ä¸€ä¸ªå…¬å…±å¯†é’¥ã€‚æ˜¾ç„¶ï¼Œå¯¹æ­¤æ–‡ä»¶å¤¹çš„è®¿é—®å¿…é¡»ä»…é™äºå¯¹peerå…·æœ‰ç®¡ç†è´£ä»»çš„ç”¨æˆ·çš„èº«ä»½ã€‚ Configuration of a channel MSP does not include this folder, as channel MSPs solely aim to offer identity validation functionalities and not signing abilities. é€šé“MSPçš„é…ç½®ä¸åŒ…æ‹¬æ­¤æ–‡ä»¶å¤¹ï¼Œå› ä¸ºé€šé“MSPä»…æ—¨åœ¨æä¾›èº«ä»½éªŒè¯åŠŸèƒ½è€Œä¸æ˜¯ç­¾ååŠŸèƒ½ã€‚ tlscacerts: This folder contains a list of self-signed X.509 certificates of the Root CAs trusted by this organization for secure communications between nodes using TLS. An example of a TLS communication would be when a peer needs to connect to an orderer so that it can receive ledger updates. æ­¤æ–‡ä»¶å¤¹åŒ…å«æ­¤ç»„ç»‡ä¿¡ä»»çš„æ ¹CAçš„è‡ªç­¾åX.509è¯ä¹¦åˆ—è¡¨ï¼Œä»¥ä½¿ç”¨TLSåœ¨èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œå®‰å…¨é€šä¿¡ã€‚TLSé€šä¿¡çš„ä¸€ä¸ªç¤ºä¾‹æ˜¯peeréœ€è¦è¿æ¥åˆ°orderedä»¥ä¾¿æ¥æ”¶è´¦æœ¬æ›´æ–°ã€‚ MSP TLS information relates to the nodes inside the network â€” the peers and the orderers, in other words, rather than the applications and administrations that consume the network. MSP TLSä¿¡æ¯ä¸ç½‘ç»œå†…éƒ¨çš„èŠ‚ç‚¹æœ‰å…³ï¼ˆpeerså’Œorderersï¼‰ï¼Œæ¢å¥è¯è¯´ï¼Œè€Œä¸æ˜¯æ¶ˆè€—ç½‘ç»œçš„åº”ç”¨ç¨‹åºå’Œç®¡ç†ã€‚ There must be at least one TLS Root CA certificate in this folder. For more information about TLS, see Securing Communication with Transport Layer Security (TLS). æ­¤æ–‡ä»¶å¤¹ä¸­è‡³å°‘å¿…é¡»æœ‰ä¸€ä¸ªTLSæ ¹CAè¯ä¹¦ï¼Œ æœ‰å…³TLSçš„æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ Securing Communication with Transport Layer Security (TLS)ã€‚ tlsintermediatecacerts: This folder contains a list intermediate CA certificates CAs trusted by the organization represented by this MSP for secure communications between nodes using TLS. This folder is specifically useful when commercial CAs are used for TLS certificates of an organization. Similar to membership intermediate CAs, specifying intermediate TLS CAs is optional. æ­¤æ–‡ä»¶å¤¹åŒ…å«æ­¤MSPä»£è¡¨çš„ç»„ç»‡ä¿¡ä»»çš„ä¸­é—´CAè¯ä¹¦CAåˆ—è¡¨ï¼Œç”¨äºä½¿ç”¨TLSçš„èŠ‚ç‚¹ä¹‹é—´çš„å®‰å…¨é€šä¿¡ã€‚å½“ç»„ç»‡ä½¿ç”¨å•†ä¸šCAä½œä¸ºTLSè¯ä¹¦æ—¶ï¼Œæ­¤æ–‡ä»¶å¤¹ç‰¹åˆ«æœ‰ç”¨ã€‚ä¸æˆå‘˜èµ„æ ¼ä¸­é—´CAç›¸ä¼¼ï¼ŒæŒ‡å®šä¸­é—´TLS CAæ˜¯å¯é€‰çš„ã€‚ operationscerts: This folder contains the certificates required to communicate with the Fabric Operations Service API. è¯¥æ–‡ä»¶å¤¹åŒ…å«ä¸ Fabric Operations Service APIé€šä¿¡æ‰€éœ€çš„è¯ä¹¦ã€‚ A channel MSP includes the following additional folder: é€šé“MSPåŒ…æ‹¬ä»¥ä¸‹é¢å¤–çš„æ–‡ä»¶å¤¹ï¼š Revoked Certificates: If the identity of an actor has been revoked, identifying information about the identity â€” not the identity itself â€” is held in this folder. For X.509-based identities, these identifiers are pairs of strings known as Subject Key Identifier (SKI) and Authority Access Identifier (AKI), and are checked whenever the certificate is being used to make sure the certificate has not been revoked. å¦‚æœå‚ä¸è€…çš„èº«ä»½å·²è¢«æ’¤é”€ï¼Œåˆ™æœ‰å…³è¯¥èº«ä»½çš„è¯†åˆ«ä¿¡æ¯ï¼ˆè€Œä¸æ˜¯èº«ä»½æœ¬èº«ï¼‰å°†ä¿å­˜åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­ã€‚å¯¹äºåŸºäºX.509çš„èº«ä»½ï¼Œè¿™äº›æ ‡è¯†ç¬¦æ˜¯ç§°ä¸ºSubject Key Identifierï¼ˆSKIï¼‰å’Œæˆæƒè®¿é—®æ ‡è¯†ç¬¦ï¼ˆAKIï¼‰çš„å­—ç¬¦ä¸²å¯¹ï¼Œå¹¶åœ¨ä½¿ç”¨è¯ä¹¦æ—¶è¿›è¡Œæ£€æŸ¥ï¼Œä»¥ç¡®ä¿è¯ä¹¦æœªè¢«åŠé”€ã€‚ This list is conceptually the same as a CAâ€™s Certificate Revocation List (CRL), but it also relates to revocation of membership from the organization. As a result, the administrator of a channel MSP can quickly revoke an actor or node from an organization by advertising the updated CRL of the CA. This â€œlist of listsâ€ is optional. It will only become populated as certificates are revoked. æ­¤åˆ—è¡¨åœ¨æ¦‚å¿µä¸Šä¸CAçš„è¯ä¹¦åŠé”€åˆ—è¡¨ï¼ˆCRLï¼‰ç›¸åŒï¼Œä½†ä¹Ÿä¸ç»„ç»‡çš„æˆå‘˜èµ„æ ¼åŠé”€æœ‰å…³ã€‚ç»“æœï¼Œé€šé“MSPçš„ç®¡ç†å‘˜å¯ä»¥é€šè¿‡å‘å¸ƒCAçš„æ›´æ–°çš„CRLæ¥å¿«é€Ÿä»ç»„ç»‡æ’¤æ¶ˆå‚ä¸è€…æˆ–èŠ‚ç‚¹ã€‚æ­¤â€œåˆ—è¡¨â€æ˜¯å¯é€‰çš„ã€‚ä»…å½“è¯ä¹¦è¢«åŠé”€æ—¶ï¼Œå®ƒæ‰ä¼šè¢«å¡«å……ã€‚ If youâ€™ve read this doc as well as our doc on Identity, you should now have a pretty good grasp of how identities and MSPs work in Hyperledger Fabric. Youâ€™ve seen how a PKI and MSPs are used to identify the actors collaborating in a blockchain network. Youâ€™ve learned how certificates, public/private keys, and roots of trust work, in addition to how MSPs are physically and logically structured. å¦‚æœä½ å·²ç»é˜…è¯»è¿‡æˆ‘ä»¬çš„Identityæ–‡æ¡£ï¼Œæ‚¨ç°åœ¨åº”è¯¥å¯¹èº«ä»½å’ŒMSPåœ¨Hyperledger Fabricä¸­çš„å·¥ä½œæ–¹å¼æœ‰äº†å¾ˆå¥½çš„äº†è§£ã€‚æ‚¨å·²ç»äº†è§£äº†å¦‚ä½•ä½¿ç”¨PKIå’ŒMSPæ¥è¯†åˆ«åœ¨åŒºå—é“¾ç½‘ç»œä¸­è¿›è¡Œåä½œçš„å‚ä¸è€…ã€‚æ‚¨å·²ç»äº†è§£äº†è¯ä¹¦ã€å…¬é’¥/ç§é’¥å’Œä¿¡ä»»æ ¹çš„å·¥ä½œåŸç†ï¼Œä»¥åŠMSPçš„ç‰©ç†å’Œé€»è¾‘ç»“æ„ã€‚","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"Key Concepts","slug":"åŒºå—é“¾/Hyperledger-Fabric/Key-Concepts","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/Key-Concepts/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"MSP","slug":"MSP","permalink":"https://guozhe001.github.io/tags/MSP/"},{"name":"Membership Service Provider","slug":"Membership-Service-Provider","permalink":"https://guozhe001.github.io/tags/Membership-Service-Provider/"}]},{"title":"Hyperledger-Fabricæ¨¡å‹","slug":"blockchain/fabric/å…³é”®æ¦‚å¿µ/Hyperledger-Fabricæ¨¡å‹","date":"2021-04-01T10:18:21.476Z","updated":"2021-04-01T10:18:21.477Z","comments":true,"path":"2021/04/01/blockchain/fabric/å…³é”®æ¦‚å¿µ/Hyperledger-Fabricæ¨¡å‹/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Hyperledger-Fabric%E6%A8%A1%E5%9E%8B/","excerpt":"","text":"Hyperledger-Fabricæ¨¡å‹ This section outlines the key design features woven into Hyperledger Fabric that fulfill its promise of a comprehensive, yet customizable, enterprise blockchain solution: æœ¬èŠ‚æ¦‚è¿°äº†ç¼–ç»‡åˆ°Hyperledger Fabricä¸­çš„å…³é”®è®¾è®¡åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½å®ç°äº†å…¶å…¨é¢ï¼Œå¯å®šåˆ¶çš„ä¼ä¸šåŒºå—é“¾è§£å†³æ–¹æ¡ˆçš„æ‰¿è¯ºï¼š Assets â€” Asset definitions enable the exchange of almost anything with monetary value over the network, from whole foods to antique cars to currency futures. èµ„äº§å®šä¹‰äº†å…è®¸é€šè¿‡ç½‘ç»œäº¤æ¢çš„å‡ ä¹æ‰€æœ‰å…·æœ‰è´§å¸ä»·å€¼çš„ä¸œè¥¿ï¼Œä»é£Ÿå“åˆ°å¤è‘£è½¦å†åˆ°è´§å¸æœŸè´§ã€‚ Chaincode â€” Chaincode execution is partitioned from transaction ordering, limiting the required levels of trust and verification across node types, and optimizing network scalability and performance. é“¾ç æ‰§è¡Œä»äº¤æ˜“é¡ºåºä¸­åˆ’åˆ†å‡ºæ¥ï¼Œä»è€Œé™åˆ¶äº†è·¨èŠ‚ç‚¹ç±»å‹æ‰€éœ€çš„ä¿¡ä»»å’ŒéªŒè¯çº§åˆ«ï¼Œå¹¶ä¼˜åŒ–ç½‘ç»œå¯ä¼¸ç¼©å’Œæ€§èƒ½ã€‚ Ledger Features â€” The immutable, shared ledger encodes the entire transaction history for each channel, and includes SQL-like query capability for efficient auditing and dispute resolution. ä¸å˜çš„ï¼Œå…±äº«çš„è´¦æœ¬å¯¹æ¯ä¸ªé€šé“çš„æ•´ä¸ªäº¤æ˜“å†å²è¿›è¡Œç¼–ç ï¼Œå¹¶åŒ…æ‹¬ç±»ä¼¼SQLçš„æŸ¥è¯¢åŠŸèƒ½ï¼Œä»¥è¿›è¡Œæœ‰æ•ˆçš„å®¡è®¡å’Œäº‰è®®è§£å†³ã€‚ Privacy â€” Channels and private data collections enable private and confidential multi-lateral transactions that are usually required by competing businesses and regulated industries that exchange assets on a common network. é€šé“å’Œéšç§æ•°æ®æ”¶é›†å¯å®ç°ç§äººå’Œæœºå¯†çš„å¤šè¾¹äº¤æ˜“ï¼Œé€šå¸¸æ˜¯åœ¨ç«äº‰ä¼ä¸šå’Œå—ç®¡åˆ¶çš„è¡Œä¸šï¼ˆåœ¨åŒä¸€ç½‘ç»œä¸Šäº¤æ¢èµ„äº§ï¼‰æ‰€éœ€è¦ã€‚ Security &amp; Membership Services â€” Permissioned membership provides a trusted blockchain network, where participants know that all transactions can be detected and traced by authorized regulators and auditors. è·å¾—è®¸å¯çš„æˆå‘˜èµ„æ ¼æä¾›äº†ä¸€ä¸ªå—ä¿¡ä»»çš„åŒºå—é“¾ç½‘ç»œï¼Œå‚ä¸è€…çŸ¥é“æ‰€æœ‰äº¤æ˜“éƒ½å¯ä»¥ç”±æˆæƒçš„ç›‘ç®¡æœºæ„å’Œå®¡è®¡å¸ˆæ£€æµ‹å’Œè¿½è¸ªã€‚ Consensus â€” A unique approach to consensus enables the flexibility and scalability needed for the enterprise. ä¸€ç§å”¯ä¸€çš„å…±è¯†æ–¹æ³•å¯ä»¥å®ç°ä¼ä¸šæ‰€éœ€çš„çµæ´»æ€§å’Œå¯ä¼¸ç¼©æ€§ã€‚ Assets Assets can range from the tangible (real estate and hardware) to the intangible (contracts and intellectual property). Hyperledger Fabric provides the ability to modify assets using chaincode transactions. èµ„äº§èŒƒå›´ä»æœ‰å½¢èµ„äº§ï¼ˆæˆ¿åœ°äº§å’Œç¡¬ä»¶ï¼‰åˆ°æ— å½¢èµ„äº§ï¼ˆåˆåŒå’ŒçŸ¥è¯†äº§æƒï¼‰ã€‚Hyperledger Fabricæä¾›äº†ä½¿ç”¨é“¾ç äº¤æ˜“ä¿®æ”¹èµ„äº§çš„åŠŸèƒ½ã€‚ Assets are represented in Hyperledger Fabric as a collection of key-value pairs, with state changes recorded as transactions on a Channel ledger. Assets can be represented in binary and/or JSON form. èµ„äº§åœ¨Hyperledger Fabricä¸­è¡¨ç¤ºä¸ºé”®å€¼å¯¹çš„é›†åˆï¼ŒçŠ¶æ€æ›´æ”¹è®°å½•ä¸ºé€šé“è´¦æœ¬ä¸­çš„äº¤æ˜“ã€‚èµ„äº§å¯ä»¥äºŒè¿›åˆ¶å’Œ/æˆ–JSONå½¢å¼è¡¨ç¤ºã€‚ Chaincode Chaincode is software defining an asset or assets, and the transaction instructions for modifying the asset(s); in other words, itâ€™s the business logic. Chaincode enforces the rules for reading or altering key-value pairs or other state database information. Chaincode functions execute against the ledgerâ€™s current state database and are initiated through a transaction proposal. Chaincode execution results in a set of key-value writes (write set) that can be submitted to the network and applied to the ledger on all peers. é“¾ç æ˜¯å®šä¹‰äº†ä¸€ä¸ªæˆ–å¤šä¸ªèµ„äº§çš„è½¯ä»¶ï¼Œä»¥åŠç”¨äºä¿®æ”¹èµ„äº§çš„äº¤æ˜“æŒ‡ä»¤ï¼›Chaincodeå¼ºåˆ¶æ‰§è¡Œç”¨äºè¯»å–æˆ–æ›´æ”¹é”®å€¼å¯¹æˆ–å…¶ä»–çŠ¶æ€æ•°æ®åº“ä¿¡æ¯çš„è§„åˆ™ã€‚é“¾ç åŠŸèƒ½é’ˆå¯¹è´¦æœ¬çš„å½“å‰çŠ¶æ€æ•°æ®åº“æ‰§è¡Œï¼Œå¹¶é€šè¿‡äº¤æ˜“æè®®å¯åŠ¨ã€‚é“¾ç æ‰§è¡Œäº§ç”Ÿçš„ä¸€ç»„é”®å€¼å†™æ“ä½œï¼ˆå†™é›†ï¼‰ï¼Œè¿™äº›é”®å€¼å†™æ“ä½œå¯ä»¥æäº¤ç»™ç½‘ç»œï¼Œå¹¶åº”ç”¨äºæ‰€æœ‰peerçš„è´¦æœ¬ä¸­ã€‚ Ledger Features The ledger is the sequenced, tamper-resistant record of all state transitions in the fabric. State transitions are a result of chaincode invocations (â€˜transactionsâ€™) submitted by participating parties. Each transaction results in a set of asset key-value pairs that are committed to the ledger as creates, updates, or deletes. è´¦æœ¬æ˜¯Fabricä¸­æ‰€æœ‰æœ‰åºçš„ã€é˜²ç¯¡æ”¹çš„çŠ¶æ€è½¬æ¢ã€‚çŠ¶æ€è½¬æ¢æ˜¯å‚ä¸æ–¹æäº¤çš„é“¾ç è°ƒç”¨ï¼ˆâ€œäº¤æ˜“â€ï¼‰çš„ç»“æœã€‚æ¯ä¸ªäº¤æ˜“éƒ½ä¼šäº§ç”Ÿä¸€ç»„èµ„äº§é”®å€¼å¯¹ï¼Œè¿™äº›é”®å€¼å¯¹ä¼šåœ¨åˆ›å»ºï¼Œæ›´æ–°æˆ–åˆ é™¤æ—¶æäº¤åˆ°è´¦æœ¬ä¸­ã€‚ The ledger is comprised of a blockchain (â€˜chainâ€™) to store the immutable, sequenced record in blocks, as well as a state database to maintain current fabric state. There is one ledger per channel. Each peer maintains a copy of the ledger for each channel of which they are a member. è´¦æœ¬ç”±åŒºå—é“¾ç»„æˆï¼Œä»¥åŒºå—å½¢å¼å­˜å‚¨ä¸å¯å˜çš„ã€æœ‰åºçš„è®°å½•ï¼Œä»¥åŠç”¨äºç»´æŠ¤å½“å‰ç»“æ„çŠ¶æ€çš„çŠ¶æ€æ•°æ®åº“ã€‚æ¯ä¸ªé€šé“æœ‰ä¸€ä¸ªè´¦æœ¬ã€‚æ¯ä¸ªpeeréƒ½ä¸ºå…¶æ‰€å±çš„æ¯ä¸ªé€šé“ç»´æŠ¤ä¸€ä¸ªè´¦æœ¬çš„å‰¯æœ¬ã€‚ Some features of a Fabric ledgerï¼ˆFabricè´¦æœ¬çš„ä¸€äº›åŠŸèƒ½ï¼‰: Query and update ledger using key-based lookups, range queries, and composite key queries ä½¿ç”¨åŸºäºé”®çš„æŸ¥æ‰¾ï¼ŒèŒƒå›´æŸ¥è¯¢å’Œç»„åˆé”®æŸ¥è¯¢æ¥æŸ¥è¯¢å’Œæ›´æ–°åˆ†ç±»å¸ Read-only queries using a rich query language (if using CouchDB as state database) ä½¿ç”¨ä¸°å¯ŒæŸ¥è¯¢è¯­è¨€çš„åªè¯»æŸ¥è¯¢ï¼ˆå¦‚æœä½¿ç”¨CouchDBä½œä¸ºçŠ¶æ€æ•°æ®åº“ï¼‰ Read-only history queries â€” Query ledger history for a key, enabling data provenance scenarios åªè¯»å†å²è®°å½•æŸ¥è¯¢â€”ä¸ºä¸€ä¸ªkeyæŸ¥è¯¢å²è®°å½•ï¼Œä»è€Œå¯ç”¨æ•°æ®å‡ºå¤„åœºæ™¯ Transactions consist of the versions of keys/values that were read in chaincode (read set) and keys/values that were written in chaincode (write set) äº¤æ˜“ç”±é“¾ç ä¸­è¯»å–çš„é”®/å€¼çš„ç‰ˆæœ¬ (è¯»å–é›†)å’Œç”¨é“¾ç ç¼–å†™çš„é”®/å€¼ï¼ˆå†™å…¥é›†ï¼‰æ‰€ç»„æˆã€‚ Transactions contain signatures of every endorsing peer and are submitted to ordering service äº¤æ˜“åŒ…å«æ¯ä¸ªèƒŒä¹¦peerçš„ç­¾åï¼Œå¹¶æäº¤ç»™æ’åºæœåŠ¡ Transactions are ordered into blocks and are â€œdeliveredâ€ from an ordering service to peers on a channel äº¤æ˜“è¢«æ’åºå¹¶æ‰“åŒ…æˆåŒºå—ï¼Œå¹¶ä»æ’åºæœåŠ¡â€œäº¤ä»˜â€åˆ°é€šé“ä¸Šçš„peerèŠ‚ç‚¹ Peers validate transactions against endorsement policies and enforce the policies Peeræ ¹æ®èƒŒä¹¦ç­–ç•¥éªŒè¯äº¤æ˜“å¹¶æ‰§è¡Œæ”¿ç­– Prior to appending a block, a versioning check is performed to ensure that states for assets that were read have not changed since chaincode execution time åœ¨è¿½åŠ åŒºå—ä¹‹å‰ï¼Œæ‰§è¡Œç‰ˆæœ¬æ£€æŸ¥ï¼Œä»¥ç¡®ä¿è‡ªé“¾ç æ‰§è¡Œä»¥æ¥ï¼Œå·²è¯»å–èµ„äº§çš„çŠ¶æ€æœªå‘ç”Ÿå˜åŒ– There is immutability once a transaction is validated and committed äº¤æ˜“ä¸€æ—¦ç»è¿‡éªŒè¯å¹¶æäº¤ï¼Œä¾¿å…·æœ‰ä¸å˜æ€§ A channelâ€™s ledger contains a configuration block defining policies, access control lists, and other pertinent information é€šé“çš„è´¦æœ¬åŒ…å«ä¸€ä¸ªé…ç½®å—ï¼Œç”¨äºå®šä¹‰ç­–ç•¥ã€è®¿é—®æ§åˆ¶åˆ—è¡¨å’Œå…¶ä»–ç›¸å…³ä¿¡æ¯ Channels contain Membership Service Provider instances allowing for crypto materials to be derived from different certificate authorities é€šé“åŒ…å«MSPå®ä¾‹ï¼Œå…è®¸ä»ä¸åŒçš„è¯ä¹¦é¢å‘æœºæ„ç”ŸæˆåŠ å¯†ææ–™ See the Ledger topic for a deeper dive on the databases, storage structure, and â€œquery-ability.â€ æœ‰å…³æ•°æ®åº“ï¼Œå­˜å‚¨ç»“æ„å’Œâ€œæŸ¥è¯¢èƒ½åŠ›â€çš„æ›´æ·±å…¥äº†è§£ï¼Œè¯·å‚é˜…è´¦æœ¬ä¸»é¢˜ã€‚ Privacy Hyperledger Fabric employs an immutable ledger on a per-channel basis, as well as chaincode that can manipulate and modify the current state of assets (i.e. update key-value pairs). A ledger exists in the scope of a channel â€” it can be shared across the entire network (assuming every participant is operating on one common channel) â€” or it can be privatized to include only a specific set of participants. Hyperledger Fabricåœ¨æ¯ä¸ªé€šé“çš„åŸºç¡€ä¸Šä½¿ç”¨ä¸å˜çš„è´¦æœ¬ï¼Œä»¥åŠå¯ä»¥æ“çºµå’Œä¿®æ”¹èµ„äº§å½“å‰çŠ¶æ€çš„é“¾ç ã€‚è´¦æœ¬å­˜åœ¨äºé€šé“èŒƒå›´å†…-å¯ä»¥åœ¨æ•´ä¸ªç½‘ç»œä¸­å…±äº«ï¼ˆå‡è®¾æ¯ä¸ªå‚ä¸è€…éƒ½åœ¨ä¸€ä¸ªå…¬å…±é¢‘é“ä¸Šè¿›è¡Œæ“ä½œï¼‰ä¹Ÿå¯ä»¥ä»…åŒ…æ‹¬ä¸€ç»„ç‰¹å®šçš„å‚ä¸è€…ä»¥å°†å…¶ç§æœ‰åŒ–ã€‚ In the latter scenario, these participants would create a separate channel and thereby isolate/segregate their transactions and ledger. In order to solve scenarios that want to bridge the gap between total transparency and privacy, chaincode can be installed only on peers that need to access the asset states to perform reads and writes (in other words, if a chaincode is not installed on a peer, it will not be able to properly interface with the ledger). åœ¨åä¸€ç§æƒ…å†µä¸‹ï¼Œè¿™äº›å‚ä¸è€…å°†åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„é€šé“ï¼Œä»è€Œéš”ç¦»/åˆ†ç¦»ä»–ä»¬çš„äº¤æ˜“å’Œè´¦æœ¬ã€‚ä¸ºäº†è§£å†³æ€»ä½“é€æ˜åº¦å’Œéšç§ä¹‹é—´å­˜åœ¨é—´éš™çš„åœºæ™¯ï¼Œé“¾ç åªèƒ½å®‰è£…åœ¨éœ€è¦è®¿é—®èµ„äº§çŠ¶æ€ä»¥æ‰§è¡Œè¯»å†™çš„peerèŠ‚ç‚¹ä¸Šï¼ˆæ¢å¥è¯è¯´ï¼Œå¦‚æœæœªåœ¨peerèŠ‚ç‚¹ä¸Šå®‰è£…é“¾ç ï¼Œåˆ™å®ƒå°†æ— æ³•ä¸è´¦æœ¬æ­£ç¡®è¿æ¥ï¼‰ã€‚ When a subset of organizations on that channel need to keep their transaction data confidential, a private data collection (collection) is used to segregate this data in a private database, logically separate from the channel ledger, accessible only to the authorized subset of organizations. å½“è¯¥æ¸ é“ä¸Šçš„éƒ¨åˆ†ç»„ç»‡éœ€è¦å¯¹å…¶äº¤æ˜“æ•°æ®ä¿å¯†æ—¶ï¼Œç§æœ‰æ•°æ®é›†åˆç”¨äºå°†è¿™äº›æ•°æ®éš”ç¦»åœ¨ç§æœ‰æ•°æ®åº“ä¸­ï¼Œä»é€»è¾‘ä¸Šä¸é€šé“è´¦æœ¬éš”ç¦»ï¼Œå¹¶ä»…å…è®¸ç»„ç»‡çš„æˆæƒå­é›†è®¿é—®ã€‚ Thus, channels keep transactions private from the broader network whereas collections keep data private between subsets of organizations on the channel. å› æ­¤ï¼Œé€šé“ä½¿äº¤æ˜“å¯¹äºæ›´å¹¿æ³›çš„ç½‘ç»œè€Œè¨€æ˜¯ä¸å…¬å¼€çš„ï¼Œè€Œé›†åˆåˆ™å¯¹é€šé“ä¸Šçš„ç»„ç»‡å­é›†ä¹‹é—´çš„æ•°æ®ä¸å…¬å¼€ã€‚ To further obfuscate the data, values within chaincode can be encrypted (in part or in total) using common cryptographic algorithms such as AES before sending transactions to the ordering service and appending blocks to the ledger. Once encrypted data has been written to the ledger, it can be decrypted only by a user in possession of the corresponding key that was used to generate the cipher text. ä¸ºäº†è¿›ä¸€æ­¥æ··æ·†æ•°æ®ï¼Œåœ¨å°†chaincodeä¸­çš„æ•°æ®å‘é€ç»™æ’åºæœåŠ¡å’Œè¿½åŠ åˆ°è´¦æœ¬åŒºå—ä¸Šä¹‹å‰å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„åŠ å¯†ç®—æ³•ï¼ˆå¦‚AESï¼‰è¿›è¡ŒåŠ å¯†ã€‚åŠ å¯†æ•°æ®ä¸€æ—¦å†™å…¥åˆ†ç±»å¸ï¼Œåˆ™åªæœ‰æ‹¥æœ‰ç”¨äºç”Ÿæˆå¯†æ–‡çš„å¯†é’¥çš„ç”¨æˆ·æ‰èƒ½å¯¹å…¶è§£å¯†ã€‚ See the Private Data topic for more details on how to achieve privacy on your blockchain network. æœ‰å…³å¦‚ä½•åœ¨åŒºå—é“¾ç½‘ç»œä¸Šå®ç°éšç§çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ç§æœ‰æ•°æ®ä¸»é¢˜ã€‚ Security &amp; Membership Services Hyperledger Fabric underpins a transactional network where all participants have known identities. Public Key Infrastructure is used to generate cryptographic certificates which are tied to organizations, network components, and end users or client applications. As a result, data access control can be manipulated and governed on the broader network and on channel levels. This â€œpermissionedâ€ notion of Hyperledger Fabric, coupled with the existence and capabilities of channels, helps address scenarios where privacy and confidentiality are paramount concerns. Hyperledger Fabricæ”¯æŒæ‰€æœ‰å‚ä¸è€…éƒ½å…·æœ‰å·²çŸ¥èº«ä»½çš„äº¤æ˜“ç½‘ç»œã€‚å…¬é’¥åŸºç¡€ç»“æ„ç”¨äºç”Ÿæˆä¸ç»„ç»‡ï¼Œç½‘ç»œç»„ä»¶ä»¥åŠæœ€ç»ˆç”¨æˆ·æˆ–å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºç»‘å®šçš„åŠ å¯†è¯ä¹¦ã€‚ç»“æœï¼Œå¯ä»¥åœ¨æ›´å¹¿æ³›çš„ç½‘ç»œå’Œé€šé“çº§åˆ«ä¸Šæ“çºµå’Œæ§åˆ¶æ•°æ®è®¿é—®æ§åˆ¶ã€‚Hyperledger Fabricçš„â€œè®¸å¯â€æ¦‚å¿µä»¥åŠé€šé“çš„å­˜åœ¨å’ŒåŠŸèƒ½ï¼Œå¸®åŠ©è§£å†³éšç§å’Œæœºå¯†è‡³å…³é‡è¦çš„æƒ…å†µã€‚ See the Membership Service Providers (MSP) topic to better understand cryptographic implementations, and the sign, verify, authenticate approach used in Hyperledger Fabric. Consensus In distributed ledger technology, consensus has recently become synonymous with a specific algorithm, within a single function. However, consensus encompasses more than simply agreeing upon the order of transactions, and this differentiation is highlighted in Hyperledger Fabric through its fundamental role in the entire transaction flow, from proposal and endorsement, to ordering, validation and commitment. In a nutshell, consensus is defined as the full-circle verification of the correctness of a set of transactions comprising a block. åœ¨åˆ†å¸ƒå¼åˆ†ç±»å¸æŠ€æœ¯ä¸­ï¼Œå…±è¯†æœ€è¿‘å·²æˆä¸ºå•ä¸€åŠŸèƒ½å†…ç‰¹å®šç®—æ³•çš„åŒä¹‰è¯ã€‚ä½†æ˜¯ï¼Œå…±è¯†ä¸åªæ˜¯ç®€å•åœ°çº¦å®šäº¤æ˜“é¡ºåºï¼ŒHyperledger Fabricé€šè¿‡åœ¨æ•´ä¸ªäº¤æ˜“æµç¨‹ï¼ˆä»ææ¡ˆå’Œè®¤å¯ï¼Œåˆ°æ’åºï¼ŒéªŒè¯å’Œæäº¤ï¼‰ä¸­çš„åŸºæœ¬ä½œç”¨ï¼Œçªæ˜¾äº†è¿™ç§å·®å¼‚ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå…±è¯†è¢«å®šä¹‰ä¸ºå¯¹åŒ…å«ä¸€ä¸ªåŒºå—çš„ä¸€ç»„äº¤æ˜“çš„æ­£ç¡®æ€§çš„å…¨é¢éªŒè¯ã€‚ Consensus is achieved ultimately when the order and results of a blockâ€™s transactions have met the explicit policy criteria checks. These checks and balances take place during the lifecycle of a transaction, and include the usage of endorsement policies to dictate which specific members must endorse a certain transaction class, as well as system chaincodes to ensure that these policies are enforced and upheld. Prior to commitment, the peers will employ these system chaincodes to make sure that enough endorsements are present, and that they were derived from the appropriate entities. Moreover, a versioning check will take place during which the current state of the ledger is agreed or consented upon, before any blocks containing transactions are appended to the ledger. This final check provides protection against double spend operations and other threats that might compromise data integrity, and allows for functions to be executed against non-static variables. åŒºå—äº¤æ˜“çš„é¡ºåºå’Œç»“æœæ»¡è¶³æ˜ç¡®çš„ç­–ç•¥æ ‡å‡†æ£€æŸ¥åï¼Œæ‰èƒ½æœ€ç»ˆè¾¾æˆå…±è¯†ã€‚è¿™äº›æ£€æŸ¥å’Œå¹³è¡¡å‘ç”Ÿåœ¨äº¤æ˜“çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå¹¶åŒ…æ‹¬ä½¿ç”¨èƒŒä¹¦ç­–ç•¥è§„å®šå“ªäº›ç‰¹å®šæˆå‘˜å¿…é¡»èƒŒä¹¦æŸä¸ªäº¤æ˜“ç±»åˆ«ï¼Œä»¥åŠç³»ç»Ÿé“¾ç ç¡®ä¿è¿™äº›ç­–ç•¥å¾—åˆ°å®æ–½å’Œç»´æŠ¤ã€‚åœ¨ä½œå‡ºæ‰¿è¯ºä¹‹å‰ï¼Œpeerå°†ä½¿ç”¨è¿™äº›ç³»ç»Ÿé“¾ç æ¥ç¡®ä¿å­˜åœ¨è¶³å¤Ÿçš„èƒŒä¹¦ï¼Œå¹¶ä¸”èƒŒä¹¦æ¥è‡ªé€‚å½“çš„å®ä½“ã€‚æ­¤å¤–ï¼Œåœ¨å°†åŒ…å«äº¤æ˜“çš„ä»»ä½•å—è¿½åŠ åˆ°è´¦æœ¬ä¹‹å‰ï¼Œå°†è¿›è¡Œç‰ˆæœ¬æ§åˆ¶æ£€æŸ¥ï¼Œåœ¨æ­¤æœŸé—´å°†å¯¹è´¦æœ¬çš„å½“å‰çŠ¶æ€è¿›è¡Œè¢«åŒæ„æˆ–åŒæ„ã€‚æœ€ç»ˆæ£€æŸ¥å¯ä»¥é˜²æ­¢é‡å¤ä½¿ç”¨æ“ä½œå’Œå…¶ä»–å¯èƒ½å±å®³æ•°æ®å®Œæ•´æ€§çš„å¨èƒï¼Œå¹¶å…è®¸é’ˆå¯¹éé™æ€å˜é‡æ‰§è¡ŒåŠŸèƒ½ã€‚ In addition to the multitude of endorsement, validity and versioning checks that take place, there are also ongoing identity verifications happening in all directions of the transaction flow. Access control lists are implemented on hierarchical layers of the network (ordering service down to channels), and payloads are repeatedly signed, verified and authenticated as a transaction proposal passes through the different architectural components. To conclude, consensus is not merely limited to the agreed upon order of a batch of transactions; rather, it is an overarching characterization that is achieved as a byproduct of the ongoing verifications that take place during a transactionâ€™s journey from proposal to commitment. é™¤äº†è¿›è¡Œå¤§é‡çš„èƒŒä¹¦ï¼Œæœ‰æ•ˆæ€§å’Œç‰ˆæœ¬æ£€æŸ¥å¤–ï¼Œè¿˜åœ¨äº¤æ˜“æµç¨‹çš„å„ä¸ªæ–¹å‘ä¸Šéƒ½åœ¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚è®¿é—®æ§åˆ¶åˆ—è¡¨æ˜¯åœ¨ç½‘ç»œçš„åˆ†å±‚çš„å±‚é¢å®ç°çš„ï¼Œå½“äº¤æ˜“æè®®é€šè¿‡ä¸åŒçš„æ¶æ„ç»„ä»¶æ—¶ï¼Œæœ‰æ•ˆè½½è·å°†è¢«åå¤ç­¾åï¼ŒéªŒè¯å’Œè®¤è¯ã€‚æ€»è€Œè¨€ä¹‹ï¼Œå…±è¯†ä¸ä»…é™äºä¸€æ‰¹äº¤æ˜“çš„å•†å®šé¡ºåºï¼›å®ƒæ›´æ˜¯ä¸€é¡¹æ€»ä½“ç‰¹å¾ï¼Œå®ƒæ˜¯äº¤æ˜“ä»ææ¡ˆåˆ°æ‰¿è¯ºè¿‡ç¨‹ä¸­ä¸æ–­è¿›è¡Œçš„éªŒè¯çš„å‰¯äº§å“ã€‚ Check out the Transaction Flow diagram for a visual representation of consensus. æŸ¥çœ‹äº¤æ˜“æµç¨‹å›¾ä»¥ç›´è§‚è¡¨ç¤ºå…±è¯†ã€‚","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"Key Concepts","slug":"åŒºå—é“¾/Hyperledger-Fabric/Key-Concepts","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/Key-Concepts/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"Model","slug":"Model","permalink":"https://guozhe001.github.io/tags/Model/"}]},{"title":"Fabricçš„ç½‘ç»œ","slug":"blockchain/fabric/å…³é”®æ¦‚å¿µ/Fabricçš„ç½‘ç»œ","date":"2021-04-01T10:18:21.473Z","updated":"2021-04-01T10:18:21.476Z","comments":true,"path":"2021/04/01/blockchain/fabric/å…³é”®æ¦‚å¿µ/Fabricçš„ç½‘ç»œ/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Fabric%E7%9A%84%E7%BD%91%E7%BB%9C/","excerpt":"","text":"Blockchain network(Fabricçš„ç½‘ç»œ) åŸå§‹å®˜æ–¹æ–‡æ¡£ï¼šhttps://hyperledger-fabric.readthedocs.io/en/release-2.2/network/network.html Creating the Network ä»åˆ›å»ºåŸºç¡€ç½‘ç»œå¼€å§‹ï¼š åœ¨ordererå¯åŠ¨ä¹‹åç½‘ç»œå°±å½¢æˆäº†ï¼Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ç½‘ç»œNä¸­ï¼ŒåŒ…æ‹¬å•ä¸ªèŠ‚ç‚¹O4çš„ordered serviceæ˜¯æ ¹æ®ç½‘ç»œé…ç½®NC4é…ç½®çš„ï¼Œè¯¥ç½‘ç»œé…ç½®å‘ç»„ç»‡R4æä¾›ç®¡ç†æƒé™ã€‚åœ¨ç½‘ç»œçº§åˆ«ï¼Œè¯ä¹¦é¢å‘æœºæ„CA4ç”¨äºå‘R4ç»„ç»‡çš„ç®¡ç†å‘˜å’Œç½‘ç»œèŠ‚ç‚¹åˆ†é…èº«ä»½ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®šä¹‰ç½‘ç»œNçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯ordering service ï¼ŒO4ã€‚å°†è®¢è´­æœåŠ¡è§†ä¸ºç½‘ç»œçš„åˆå§‹ç®¡ç†ç‚¹å¾ˆæœ‰å¸®åŠ©ã€‚å°†ordering serviceè§†ä¸ºç½‘ç»œçš„åˆå§‹ç®¡ç†ç‚¹å¾ˆæœ‰å¸®åŠ©ã€‚æŒ‰ç…§äº‹å…ˆçº¦å®šï¼ŒO4æœ€åˆç”±ç»„ç»‡R4ä¸­çš„ç®¡ç†å‘˜é…ç½®å’Œå¯åŠ¨ï¼Œå¹¶æ‰˜ç®¡åœ¨R4ä¸­ã€‚é…ç½®NC4åŒ…å«æè¿°ç½‘ç»œç®¡ç†åŠŸèƒ½çš„åˆå§‹çš„ç­–ç•¥é›†åˆã€‚æœ€åˆï¼Œå°†å…¶è®¾ç½®ä¸ºä»…é€šè¿‡ç½‘ç»œæˆäºˆR4æƒé™ã€‚è¿™å°†æ”¹å˜ï¼Œæˆ‘ä»¬å°†åœ¨åé¢çœ‹åˆ°ï¼Œä½†ç›®å‰R4æ˜¯ç½‘ç»œçš„å”¯ä¸€æˆå‘˜ã€‚ Certificate Authoritiesï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰ æ‚¨è¿˜å¯ä»¥çœ‹åˆ°è¯ä¹¦é¢å‘æœºæ„CA4ï¼Œç”¨äºå‘ç®¡ç†å‘˜å’Œç½‘ç»œèŠ‚ç‚¹é¢å‘è¯ä¹¦ã€‚CA4åœ¨æˆ‘ä»¬çš„ç½‘ç»œä¸­èµ·ç€å…³é”®ä½œç”¨ï¼Œå› ä¸ºå®ƒé¢å‘X.509è¯ä¹¦ï¼Œè¯¥è¯ä¹¦å¯ç”¨äºå°†ç»„ä»¶æ ‡è¯†ä¸ºå±äºç»„ç»‡R4ã€‚ç”±CAé¢å‘çš„è¯ä¹¦ä¹Ÿå¯ä»¥ç”¨äºç­¾ç½²äº¤æ˜“ï¼Œä»¥è¡¨æ˜ç»„ç»‡è®¤å¯äº¤æ˜“ç»“æœâ€“è¿™æ˜¯å…è®¸äº¤æ˜“æäº¤åˆ°åˆ†ç±»å¸çš„å‰æã€‚è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°ç ”ç©¶CAçš„è¿™ä¸¤ä¸ªæ–¹é¢ã€‚ é¦–å…ˆï¼ŒåŒºå—é“¾ç½‘ç»œçš„ä¸åŒç»„ä»¶ä½¿ç”¨è¯ä¹¦å°†è‡ªå·±æ ‡è¯†ä¸ºæ¥è‡ªç‰¹å®šç»„ç»‡ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆé€šå¸¸æœ‰ä¸æ­¢ä¸€ä¸ªCAæ”¯æŒä¸€ä¸ªåŒºå—é“¾ç½‘ç»œ-ä¸åŒçš„ç»„ç»‡ç»å¸¸ä½¿ç”¨ä¸åŒçš„CAã€‚ è¯ä¹¦åˆ°æˆå‘˜ç»„ç»‡çš„æ˜ å°„æ˜¯é€šè¿‡ç§°ä¸ºMembership Services Provider (MSP)çš„ç»“æ„å®ç°çš„ã€‚ç½‘ç»œé…ç½®NC4ä½¿ç”¨MSPæ¥æ ‡è¯†ç”±CA4åˆ†é…çš„è¯ä¹¦çš„å±æ€§ï¼Œè¯¥è¯ä¹¦å°†è¯ä¹¦æŒæœ‰è€…ä¸ç»„ç»‡R4ç›¸å…³è”ã€‚ç„¶åï¼ŒNC4å¯ä»¥åœ¨ç­–ç•¥ä¸­ä½¿ç”¨æ­¤MSPå‘R4çš„å‚ä¸è€…æˆäºˆå¯¹ç½‘ç»œèµ„æºçš„ç‰¹å®šæƒé™ã€‚è¿™ç§ç­–ç•¥çš„ä¸€ä¸ªç¤ºä¾‹æ˜¯R4ä¸­çš„ç®¡ç†å‘˜å¯ä»¥å‘ç½‘ç»œæ·»åŠ çš„æ–°æˆå‘˜ã€‚ å…¶æ¬¡ï¼Œç¨åæˆ‘ä»¬å°†çœ‹åˆ°CAé¢å‘çš„è¯ä¹¦å¦‚ä½•æˆä¸ºäº¤æ˜“ç”Ÿæˆå’ŒéªŒè¯è¿‡ç¨‹çš„æ ¸å¿ƒã€‚å…·ä½“æ¥è¯´ï¼ŒX.509è¯ä¹¦ç”¨äºå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºäº¤æ˜“å»ºè®®å’Œæ™ºèƒ½åˆçº¦äº¤æ˜“å“åº”ä¸­ä»¥è¿›è¡Œæ•°å­—ç­¾åäº¤æ˜“ã€‚éšåï¼Œæ‰˜ç®¡è´¦æœ¬çš„ç½‘ç»œèŠ‚ç‚¹åœ¨æ¥å—äº¤æ˜“è®°å½•åˆ°è´¦æœ¬ä¹‹å‰ä¼šéªŒè¯äº¤æ˜“çš„ç­¾åæ˜¯å¦æœ‰æ•ˆã€‚ è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ç¤ºä¾‹åŒºå—é“¾ç½‘ç»œçš„åŸºæœ¬ç»“æ„ï¼šè¯ä¹¦é¢å‘æœºæ„CA4å®šä¹‰äº†ä¸€ç»„ç”¨æˆ·ï¼Œå¯ä»¥è®¿é—®ç½‘ç»œNï¼›è¿™äº›ç”¨æˆ·å¯¹ç½‘ç»œNä¸­èµ„æºçš„æƒé™è¢«ç½‘ç»œé…ç½®NC4ä¸­åŒ…å«çš„ç­–ç•¥æ‰€æè¿°ã€‚åœ¨æˆ‘ä»¬é…ç½®å¹¶å¯åŠ¨ordering serviceèŠ‚ç‚¹O4æ—¶ï¼Œæ‰€æœ‰è¿™äº›éƒ½å˜ä¸ºç°å®ã€‚ Adding Network Administratorsï¼ˆæ·»åŠ ç½‘ç»œç®¡ç†å‘˜ï¼‰ NC4åªé…ç½®äº†R4çš„ç”¨æˆ·åœ¨ç½‘ç»œä¸Šçš„æƒé™ã€‚åœ¨ä¸‹ä¸€ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬å°†å…è®¸ç»„ç»‡R1ç”¨æˆ·ç®¡ç†ç½‘ç»œã€‚è®©æˆ‘ä»¬çœ‹çœ‹ç½‘ç»œå¦‚ä½•å‘å±•ï¼š ç»„ç»‡R4æ›´æ–°ç½‘ç»œé…ç½®ä»¥ä½¿ç»„ç»‡R1ä¹Ÿæˆä¸ºç®¡ç†å‘˜ã€‚æ­¤åï¼ŒR1å’ŒR4åœ¨ç½‘ç»œé…ç½®ä¸Šäº«æœ‰åŒç­‰çš„æƒåˆ©ã€‚ å°½ç®¡è®¢è´­è€…èŠ‚ç‚¹O4åœ¨R4çš„åŸºç¡€ç»“æ„ä¸Šè¿è¡Œï¼Œä½†R1æ‹¥æœ‰å…±äº«çš„ç®¡ç†æƒé™ï¼Œåªè¦å®ƒå¯ä»¥è®¿é—®ç½‘ç»œå³å¯ã€‚è¿™æ„å‘³ç€R1æˆ–R4å¯ä»¥æ›´æ–°ç½‘ç»œé…ç½®NC4ï¼Œä»¥å…è®¸R2ç»„ç»‡è¿›è¡Œç½‘ç»œæ“ä½œçš„å­é›†ã€‚è¿™æ ·ï¼Œå³ä½¿R4åœ¨è¿è¡Œè®¢è´­æœåŠ¡ï¼ŒR1ä¹Ÿå¯¹å…¶æ‹¥æœ‰å®Œå…¨çš„ç®¡ç†æƒé™ï¼Œå¹¶ä¸”R2å…·æœ‰åˆ›å»ºæ–°è”åˆä½“çš„éƒ¨åˆ†æƒé™ã€‚ ä½ åœ¨ç¤ºä¾‹ä¸­çœ‹åˆ°çš„ordering serviceæ˜¯ç½‘ç»œä¸­çš„å•ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ˜¯æœ€ç®€å•çš„å½¢å¼ã€‚ordering serviceé€šå¸¸æ˜¯å¤šèŠ‚ç‚¹çš„ï¼Œå¯ä»¥é…ç½®ä¸ºåœ¨ä¸åŒç»„ç»‡çš„ä¸åŒèŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½åœ¨R4ä¸­è¿è¡ŒO4å¹¶å°†å…¶è¿æ¥åˆ°ç»„ç»‡R1ä¸­å•ç‹¬çš„è®¢è´­è€…èŠ‚ç‚¹O2ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°†æ‹¥æœ‰ä¸€ä¸ªå¤šç«™ç‚¹ï¼Œå¤šç»„ç»‡çš„ç®¡ç†ç»“æ„ã€‚ æˆ‘ä»¬å°†åœ¨æœ¬ä¸»é¢˜çš„ç¨åéƒ¨åˆ†è®¨è®ºordering serviceï¼Œä½†æ˜¯ç°åœ¨ï¼Œä»…å°†ordering serviceè§†ä¸ºä¸€ä¸ªå¯ä¸ºä¸åŒç»„ç»‡æä¾›å¯¹ç½‘ç»œå—æ§è®¿é—®çš„ç®¡ç†ç‚¹ã€‚ Defining a Consortium(å®šä¹‰ä¸€ä¸ªè”ç›Ÿ) å°½ç®¡ç°åœ¨å¯ä»¥é€šè¿‡R1å’ŒR4ç®¡ç†ç½‘ç»œï¼Œä½†æ˜¯å‡ ä¹æ²¡æœ‰ä»€ä¹ˆäº‹æƒ…å¯åšã€‚æˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å®šä¹‰ä¸€ä¸ªè”ç›Ÿã€‚è¿™ä¸ªè¯çš„å­—é¢æ„æ€æ˜¯â€œæ‹¥æœ‰å…±åŒå‘½è¿çš„å›¢ä½“â€ï¼Œå› æ­¤å¯¹äºåŒºå—é“¾ç½‘ç»œä¸­çš„ä¸€ç»„ç»„ç»‡æ¥è¯´æ˜¯ä¸€ä¸ªåˆé€‚çš„é€‰æ‹©ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹è”ç›Ÿçš„å®šä¹‰ï¼š ç½‘ç»œç®¡ç†å‘˜å®šä¹‰äº†ä¸€ä¸ªè”ç›ŸX1ï¼Œè¯¥è”ç›ŸåŒ…å«ä¸¤ä¸ªæˆå‘˜ï¼Œç»„ç»‡R1å’ŒR2ã€‚è¯¥è”ç›Ÿçš„å®šä¹‰å­˜å‚¨åœ¨ç½‘ç»œé…ç½®NC4ä¸­ï¼Œå¹¶å°†åœ¨ç½‘ç»œå¼€å‘çš„ä¸‹ä¸€é˜¶æ®µä½¿ç”¨ã€‚CA1å’ŒCA2æ˜¯è¿™äº›ç»„ç»‡çš„å„è‡ªçš„è¯ä¹¦é¢å‘æœºæ„ã€‚ å› ä¸ºNC4é…ç½®çš„æ˜¯åªå…è®¸R1æˆ–R4å¯ä»¥åˆ›å»ºæ–°çš„è”ç›Ÿã€‚è¯¥å›¾æ˜¾ç¤ºäº†æ·»åŠ çš„æ–°è”ç›ŸX1ï¼Œè¯¥è”ç›Ÿå°†R1å’ŒR2å®šä¹‰ä¸ºå…¶ç»„æˆç»„ç»‡ã€‚æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°å·²ç»æ·»åŠ äº†CA2ç”¨ä»¥è®¤è¯R2çš„ç”¨æˆ·ã€‚è¯·æ³¨æ„ï¼Œä¸€ä¸ªè”ç›Ÿå¯ä»¥æœ‰ä»»æ„æ•°é‡çš„ç»„ç»‡æˆå‘˜â€“æˆ‘ä»¬åˆšåˆšæ˜¾ç¤ºäº†ä¸¤ä¸ªï¼Œå› ä¸ºå®ƒæ˜¯æœ€ç®€å•çš„é…ç½®ã€‚ ä¸ºä»€ä¹ˆè”ç›Ÿå¦‚æ­¤é‡è¦ï¼Ÿæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªè”ç›Ÿå®šä¹‰äº†ç½‘ç»œä¸­å½¼æ­¤éœ€è¦å…±äº«äº¤æ˜“çš„ç»„ç»‡é›†åˆï¼Œåœ¨æœ¬ä¾‹ä¸­R1å’Œ R2ã€‚å¦‚æœç»„ç»‡æœ‰å…±åŒçš„ç›®æ ‡ï¼Œå°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·çœŸçš„å¾ˆæœ‰æ„ä¹‰ï¼Œè€Œè¿™æ­£ä¸Šé¢çš„è”ç›Ÿå®šä¹‰ã€‚ è¯¥ç½‘ç»œè™½ç„¶ç”±å•ä¸ªç»„ç»‡å¯åŠ¨ï¼Œä½†ç°åœ¨ç”±è¾ƒå¤§çš„ä¸€ç»„ç»„ç»‡æ§åˆ¶ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è”ç›ŸX1åˆ›å»ºHyperledger FabricåŒºå—é“¾çš„ä¸€ä¸ªéå¸¸é‡è¦çš„éƒ¨åˆ†-ä¸€ä¸ªé€šé“ã€‚ Creating a channel for a consortium(ä¸ºè”ç›Ÿåˆ›å»ºä¸€ä¸ªé€šé“) channelæ˜¯ä¸»è¦çš„é€šä¿¡æœºåˆ¶ï¼Œè”ç›Ÿçš„æˆå‘˜å¯ä»¥é€šè¿‡channelç›¸äº’é€šä¿¡ã€‚ç½‘ç»œä¸­å¯ä»¥æœ‰å¤šä¸ªé€šé“ï¼Œæˆ‘ä»¬å…ˆä»ä¸€ä¸ªæ¸ é“å¼€å§‹ã€‚ è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å°†ç¬¬ä¸€ä¸ªchannelæ·»åŠ åˆ°ç½‘ç»œä¸­ï¼š ä½¿ç”¨è”ç›Ÿå®šä¹‰X1ä¸ºR1å’ŒR2åˆ›å»ºäº†é€šé“C1ã€‚é€šé“ç”±é€šé“é…ç½®CC1è¿›è¡Œæ²»ç†ï¼Œå®Œå…¨ç‹¬ç«‹äºç½‘ç»œé…ç½®ã€‚CC1ç”±å¯¹C1æ‹¥æœ‰åŒç­‰æƒåˆ©çš„R1å’ŒR2ç®¡ç†ã€‚ R4åœ¨CC1ä¸­æ²¡æœ‰ä»»ä½•æƒåˆ©ã€‚ é€šé“C1ä¸ºè´¢å›¢X1æä¾›äº†ä¸“ç”¨çš„é€šä¿¡æœºåˆ¶ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é€šé“C1å·²è¿æ¥åˆ°ordersing service(O4)ï¼Œä½†æ²¡æœ‰é™„åŠ ä»»ä½•å†…å®¹ã€‚åœ¨ç½‘ç»œå¼€å‘çš„ä¸‹ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬å°†è¿æ¥ç»„ä»¶ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå’ŒpeerèŠ‚ç‚¹ã€‚ä½†æ˜¯ï¼Œæ¸ é“ä»£è¡¨ç€æœªæ¥è¿æ¥çš„æ½œåŠ›ã€‚ å³ä½¿é€šé“C1æ˜¯ç½‘ç»œNçš„ä¸€éƒ¨åˆ†ï¼Œä½†ä¹Ÿå¯ä»¥ä¸å®ƒå®Œå…¨åŒºåˆ†å¼€ã€‚æ³¨æ„ç»„ç»‡R3å’ŒR4ä¸åœ¨æ­¤é€šé“ä¸­ï¼ŒC1åªç”¨äºR1å’ŒR2ä¹‹é—´çš„äº¤æ˜“å¤„ç†ã€‚åœ¨ä¸Šä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†R4å¦‚ä½•æˆäºˆR1åˆ›å»ºæ–°è”ç›Ÿçš„æƒé™ã€‚å€¼å¾—ä¸€æçš„æ˜¯R4è¿˜å…è®¸R1åˆ›å»ºchannelï¼åœ¨æ­¤å›¾ä¸­ï¼Œå¯èƒ½æ˜¯ç»„ç»‡R1æˆ–R4åˆ›å»ºäº†é€šé“C1ã€‚ å†æ¬¡æ³¨æ„é€šé“C1å¯¹äºç½‘ç»œé…ç½®NC4å¦‚ä½•å…·æœ‰å®Œå…¨ç‹¬ç«‹çš„é…ç½®CC1ã€‚CC1åŒ…å«ç”¨äºæ§åˆ¶R1å’ŒR2åœ¨é€šé“C1ä¸Šçš„æƒé™çš„ç­–ç•¥-æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼ŒR3å’ŒR4åœ¨æ­¤é€šé“ä¸Šæ²¡æœ‰æƒé™ã€‚R3å’ŒR4åªèƒ½åœ¨R1æˆ–R2å°†å…¶æ·»åŠ é€‚å½“ç­–ç•¥åˆ°é€šé“é…ç½®CC1ä¸­ï¼Œæ‰å¯ä»¥ä¸C1äº¤äº’ã€‚ä¸€ä¸ªç¤ºä¾‹æ˜¯å®šä¹‰è°å¯ä»¥å‘channelæ·»åŠ æ–°ç»„ç»‡ã€‚ç‰¹åˆ«è¦æ³¨æ„çš„æ˜¯ï¼ŒR4ä¸èƒ½å°†è‡ªèº«æ·»åŠ åˆ°é€šé“C1ä¸­-å®ƒå¿…é¡»å¹¶ä¸”åªèƒ½ç”±R1æˆ–R2æˆæƒã€‚ ä¸ºä»€ä¹ˆchannelå¦‚æ­¤é‡è¦ï¼Ÿchannelsä¹‹æ‰€ä»¥æœ‰ç”¨ï¼Œæ˜¯å› ä¸ºå®ƒä»¬ä¸ºè”ç›Ÿæˆå‘˜ä¹‹é—´çš„ç§æœ‰é€šä¿¡å’Œç§æœ‰æ•°æ®æä¾›äº†ä¸€ç§æœºåˆ¶ã€‚channelæä¾›äº†éšç§æ€§ä¿æŠ¤ï¼Œå¯¹äºå…¶ä»–çš„channelså’Œæ•´ä¸ªç½‘ç»œã€‚Hyperledger Fabricåœ¨è¿™æ–¹é¢å¾ˆå¼ºå¤§ï¼Œå› ä¸ºå®ƒå…è®¸ç»„ç»‡å…±äº«åŸºç¡€ç»“æ„å¹¶åŒæ—¶ä¿æŒç§æœ‰çŠ¶æ€ã€‚è¿™é‡Œæ²¡æœ‰çŸ›ç›¾-ç½‘ç»œä¸­çš„ä¸åŒè”ç›Ÿéœ€è¦é€‚å½“å…±äº«ä¸åŒçš„ä¿¡æ¯å’Œæµç¨‹ï¼Œè€Œæ¸ é“åˆ™æä¾›äº†ä¸€ç§æœ‰æ•ˆçš„æœºåˆ¶æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚é€šé“å¯æœ‰æ•ˆå…±äº«åŸºç¡€æ¶æ„ï¼ŒåŒæ—¶ä¿æŒæ•°æ®å’Œé€šä¿¡çš„éšç§ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ï¼Œä¸€æ—¦åˆ›å»ºäº†ä¸€ä¸ªchannelï¼Œå®ƒå®é™…ä¸Šå°±æ˜¯â€œè„±ç¦»ç½‘ç»œâ€ã€‚ä»åˆ›å»ºå¼€å§‹åˆ°æœªæ¥ï¼Œåªæœ‰åœ¨channelé…ç½®ä¸­æ˜ç¡®æŒ‡å®šçš„ç»„ç»‡æ‰èƒ½å¯¹å…¶è¿›è¡Œæ§åˆ¶ã€‚åŒæ ·ï¼Œä»æ­¤æ—¶å¼€å§‹å¯¹ç½‘ç»œé…ç½®NC4çš„ä»»ä½•æ›´æ–°éƒ½ä¸ä¼šç›´æ¥å½±å“channelé…ç½®CC1ï¼›ä¾‹å¦‚ï¼Œå¦‚æœè”ç›Ÿå®šä¹‰X1æ›´æ”¹ï¼Œå®ƒå°†ä¸ä¼šå½±å“é€šé“C1çš„æˆå‘˜ã€‚é€šé“ä¹‹æ‰€ä»¥æœ‰ç”¨ï¼Œæ˜¯å› ä¸ºå®ƒä»¬å…è®¸æ„æˆé€šé“çš„ç»„ç»‡ä¹‹é—´è¿›è¡Œç§äººé€šä¿¡ã€‚æ­¤å¤–ï¼Œé€šé“ä¸­çš„æ•°æ®ä¸ç½‘ç»œçš„å…¶ä½™éƒ¨åˆ†ï¼ˆåŒ…æ‹¬å…¶ä»–é€šé“ï¼‰å®Œå…¨éš”ç¦»ã€‚ é¡ºä¾¿è¯´ä¸€å¥ï¼Œè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç³»ç»Ÿé€šé“ï¼ˆsystem channelï¼‰çš„å®šä¹‰ï¼Œæ˜¯ä¸ºäº†ç»™æ’åºæœåŠ¡ï¼ˆordering serviceï¼‰ä½¿ç”¨çš„ã€‚å®ƒçš„è¡Œä¸ºä¸å¸¸è§„channelå®Œå…¨ç›¸åŒï¼Œå› æ­¤ï¼Œæœ‰æ—¶ä¹Ÿç§°ä¸ºåº”ç”¨ç¨‹åºé€šé“ï¼ˆapplication channelsï¼‰ã€‚ Peers and Ledgersï¼ˆèŠ‚ç‚¹ä¸è´¦å•ï¼‰ ç°åœ¨å¼€å§‹ä½¿ç”¨æ¸ é“å°†åŒºå—é“¾ç½‘ç»œå’Œç»„ç»‡ç»„ä»¶è¿æ¥åœ¨ä¸€èµ·ã€‚åœ¨ç½‘ç»œå¼€å‘çš„ä¸‹ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ç½‘ç»œNåˆšåˆšè·å¾—äº†ä¸¤ä¸ªæ–°ç»„ä»¶ï¼Œå³peerèŠ‚ç‚¹P1å’Œè´¦æœ¬å®ä¾‹L1ã€‚ peerèŠ‚ç‚¹P1å·²åŠ å…¥é€šé“C1ã€‚ P1ç‰©ç†ä¸Šå­˜å‚¨è´¦æœ¬L1çš„å‰¯æœ¬ã€‚ P1å’ŒO4å¯ä»¥ä½¿ç”¨é€šé“C1ç›¸äº’é€šä¿¡ã€‚ peerèŠ‚ç‚¹æ˜¯æ‰˜ç®¡åŒºå—é“¾è´¦æœ¬å‰¯æœ¬çš„ç½‘ç»œç»„ä»¶ï¼Œæœ€åï¼Œæˆ‘ä»¬å¼€å§‹çœ‹åˆ°ä¸€äº›å¯è¯†åˆ«çš„åŒºå—é“¾ç»„ä»¶ã€‚P1åœ¨ç½‘ç»œä¸­çš„ç›®çš„çº¯ç²¹æ˜¯æ‰˜ç®¡è´¦æœ¬L1çš„å‰¯æœ¬ï¼Œä»¥ä¾›å…¶ä»–äººè®¿é—®ã€‚æˆ‘ä»¬å¯ä»¥è®¤ä¸ºL1ç‰©ç†ä¸Šæ‰˜ç®¡åœ¨P1ä¸Šï¼Œä½†é€»è¾‘ä¸Šæ‰˜ç®¡åœ¨é€šé“C1ä¸Šã€‚å½“æˆ‘ä»¬å‘channelæ·»åŠ æ›´å¤špeeræ—¶ï¼Œæˆ‘ä»¬ä¼šæ›´æ¸…æ¥šåœ°çœ‹åˆ°è¿™ä¸ªæƒ³æ³•ã€‚ P1é…ç½®çš„å…³é”®éƒ¨åˆ†æ˜¯CA1å‘å‡ºçš„X.509èº«ä»½ï¼Œè¯¥èº«ä»½å°†P1ä¸ç»„ç»‡R1ç›¸å…³è”ã€‚å½“R1ç»„ç»‡çš„ç®¡ç†å‘˜å°†peerèŠ‚ç‚¹P1åŠ å…¥é€šé“C1å¹¶ä¸”P1å¼€å§‹ä»æ’åºèŠ‚ç‚¹O4æ‹‰å–æ•°æ®å—çš„æ—¶å€™ï¼ŒO4ä½¿ç”¨é€šé“é…ç½®CC1æ¥ç¡®å®šP1åœ¨è¯¥é€šé“ä¸Šçš„æƒé™ã€‚ä¾‹å¦‚ï¼ŒCC1ä¸­çš„ç­–ç•¥ç¡®å®šP1ï¼ˆæˆ–ç»„ç»‡R1ï¼‰æ˜¯å¦å¯ä»¥åœ¨é€šé“C1ä¸Šè¯»å–ï¼ˆå’Œ/æˆ–ï¼‰å†™å…¥ã€‚ æ³¨æ„æ‹¥æœ‰peerçš„ç»„ç»‡æ˜¯å¦‚ä½•å°†peeråŠ å…¥æ¸ é“çš„ï¼Œå°½ç®¡æˆ‘ä»¬ä»…æ·»åŠ äº†ä¸€ä¸ªpeerï¼Œä½†æˆ‘ä»¬å°†çœ‹åˆ°ç½‘ç»œä¸­çš„å¤šä¸ªæ¸ é“ä¸Šå¦‚ä½•æœ‰å¤šä¸ªpeerèŠ‚ç‚¹ã€‚ç¨åæˆ‘ä»¬å°†çœ‹åˆ°peerå¯ä»¥æ‰®æ¼”çš„ä¸åŒè§’è‰²ã€‚ Applications and Smart Contract chaincodeï¼ˆåº”ç”¨ç¨‹åºå’Œæ™ºèƒ½åˆçº¦è”é“¾ç ï¼‰ ç°åœ¨ï¼Œé€šé“C1ä¸Šæœ‰ä¸€ä¸ªè´¦æœ¬L1ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹è¿æ¥å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œä»¥ä½¿ç”¨ä¸ºæ“ä½œè´¦æœ¬æä¾›æœåŠ¡çš„peerã€‚ è¯·æ³¨æ„ç½‘ç»œå·²ç»å¢é•¿äº†ï¼š å·²ç»æ™ºèƒ½åˆçº¦S5å·²ç»è¢«éƒ¨ç½²åˆ°äº†P1ï¼Œå±äºç»„ç»‡R1çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA1å¯ä»¥ä½¿ç”¨S5é€šè¿‡P1æ¥è®¿é—®è´¦æœ¬L1ã€‚A1ã€P1å’ŒO4éƒ½åŠ å…¥äº†é€šé“C1ï¼Œå¦‚å›¾æ‰€ç¤ºï¼ŒA1ã€P1å’ŒO4éƒ½åŠ å…¥äº†é€šé“C1ï¼Œå³å®ƒä»¬éƒ½å¯ä»¥åˆ©ç”¨è¯¥é€šé“æä¾›çš„é€šä¿¡è®¾æ–½ã€‚ åœ¨ç½‘ç»œå¼€å‘çš„ä¸‹ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA1å¯ä»¥ä½¿ç”¨é€šé“C1è¿æ¥åˆ°ç‰¹å®šçš„ç½‘ç»œèµ„æºâ€“åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒA1å¯ä»¥åŒæ—¶è¿æ¥åˆ°peerèŠ‚ç‚¹P1å’ŒorderedèŠ‚ç‚¹O4ã€‚è®©æˆ‘ä»¬åœ¨æ­¤ä¹‹å‰æŸ¥çœ‹æ¸ é“æ˜¯å¦‚ä½•æˆä¸ºç½‘ç»œå’Œç»„ç»‡ç»„ä»¶ä¹‹é—´é€šä¿¡æ ¸å¿ƒçš„ã€‚å°±åƒå¯¹peerèŠ‚ç‚¹å’ŒorderedèŠ‚ç‚¹ä¸€æ ·ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¹Ÿå…·æœ‰ä¸€ä¸ªå¯ä»¥å°†å…¶ä¸ç»„ç»‡å…³è”èµ·æ¥çš„èº«ä»½ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA1ä¸ç»„ç»‡R1å…³è”ï¼Œå°½ç®¡å®ƒåœ¨FabricåŒºå—é“¾ç½‘ç»œä¹‹å¤–ï¼Œä½†ä»ç„¶å¯ä»¥é€šè¿‡æ¸ é“C1è®¿é—®åˆ°åŒºå—é“¾ã€‚ ç°åœ¨çœ‹æ¥ï¼ŒA1å¯ä»¥ç›´æ¥é€šè¿‡P1è®¿é—®åˆ†ç±»å¸L1ï¼Œä½†å®é™…ä¸Šï¼Œæ‰€æœ‰è®¿é—®éƒ½æ˜¯é€šè¿‡ç§°ä¸ºæ™ºèƒ½åˆçº¦é“¾ç S5çš„ç‰¹æ®Šç¨‹åºè¿›è¡Œç®¡ç†çš„ã€‚å°†S5å®šä¹‰ä¸ºè´¦æœ¬çš„æ‰€æœ‰å¸¸è§è®¿é—®æ¨¡å¼ï¼› S5æä¾›äº†ä¸€å¥—æ˜ç¡®å®šä¹‰çš„æ–¹å¼ï¼Œå¯ç”¨æ¥æŸ¥è¯¢æˆ–æ›´æ–°è´¦æœ¬L1ã€‚ æ¯ä¸ªç»„ç»‡çš„å¼€å‘äººå‘˜éƒ½å¯ä»¥åˆ›å»ºæ™ºèƒ½åˆçº¦ï¼Œç„¶åå‘èµ·åœ¨è”ç›Ÿä¹‹é—´å…±äº«çš„ä¸šåŠ¡æµç¨‹ã€‚æ™ºèƒ½åˆçº¦ç”¨äºç”Ÿæˆå¯ä»¥åˆ†é…åˆ°ç½‘ç»œä¸­æ¯ä¸ªèŠ‚ç‚¹çš„äº¤æ˜“ã€‚æˆ‘ä»¬ç¨åå†è®¨è®ºè¿™ä¸ªæƒ³æ³•ï¼›å½“ç½‘ç»œæ›´å¤§æ—¶ï¼Œå°†æ›´å®¹æ˜“ç†è§£ã€‚ç°åœ¨ï¼Œéœ€è¦äº†è§£çš„é‡è¦ä¸€ç‚¹æ˜¯ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œå¿…é¡»åœ¨æ™ºèƒ½åˆçº¦ä¸Šæ‰§è¡Œä¸¤æ¬¡æ“ä½œã€‚ç›®å‰ä¸ºæ­¢ï¼Œéœ€è¦äº†è§£çš„é‡è¦ä¸€ç‚¹æ˜¯å¿…é¡»åœ¨æ™ºèƒ½åˆçº¦ä¸Šæ‰§è¡Œä¸¤æ¬¡æ“ä½œï¼š å®ƒå¿…é¡»å·²ç»å®‰è£…ï¼ˆinstalledï¼‰åœ¨peerä¸Š ç„¶åå·²ç»åœ¨é€šé“ä¸Šå®šä¹‰ï¼ˆdefinedï¼‰ Hyperledger Fabricç”¨æˆ·ç»å¸¸æŠŠæœ¯è¯­æ™ºèƒ½åˆçº¦ï¼ˆsmart contractï¼‰å’Œé“¾ç ï¼ˆchaincodeï¼‰è¿›è¡Œäº’æ¢ä½¿ç”¨ã€‚é€šå¸¸ï¼Œæ™ºèƒ½åˆçº¦å®šä¹‰äº†äº¤æ˜“é€»è¾‘ï¼ˆ transaction logic ï¼‰ï¼Œè¿™ä¸ªäº¤æ˜“é€»è¾‘æ§åˆ¶äº†ç°å®ä¸–ç•ŒçŠ¶æ€ä¸­åŒ…å«ä¸šåŠ¡å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚ç„¶åå°†å…¶æ‰“åŒ…æˆé“¾ç ï¼Œç„¶åå°†å…¶éƒ¨ç½²åˆ°åŒºå—é“¾ç½‘ç»œã€‚å¯ä»¥å°†æ™ºèƒ½åˆçº¦è§†ä¸ºæ”¯é…äº¤æ˜“ï¼Œè€Œé“¾ç åˆ™æ˜¯æ§åˆ¶å¦‚ä½•æ‰“åŒ…æ™ºèƒ½åˆçº¦ä»¥è¿›è¡Œéƒ¨ç½²ã€‚ Installing a chaincode packageï¼ˆå®‰è£…é“¾ç åŒ…ï¼‰ å¼€å‘äº†æ™ºèƒ½åˆçº¦S5ä¹‹åï¼Œç»„ç»‡R1ä¸­çš„ç®¡ç†å‘˜å¿…é¡»åˆ›å»ºä¸€ä¸ªé“¾ç åŒ…å¹¶å°†å…¶å®‰è£…åˆ°peerèŠ‚ç‚¹P1ä¸Šã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ“ä½œï¼›ä¸€æ—¦å®Œæˆï¼ŒP1å°±å®Œå…¨äº†è§£S5ã€‚å…·ä½“æ¥è¯´ï¼ŒP1å¯ä»¥çœ‹åˆ°S5çš„**å®ç°ï¼ˆimplementationï¼‰é€»è¾‘-å°±æ˜¯ç”¨äºè®¿é—®è´¦æœ¬L1çš„ä»£ç ã€‚æˆ‘ä»¬å°†æ­¤ä¸S5çš„æ¥å£ï¼ˆinterfaceï¼‰**è¿›è¡Œå¯¹æ¯”ï¼Œåè€…ä»…æè¿°S5çš„è¾“å…¥å’Œè¾“å‡ºï¼Œè€Œä¸å®ƒçš„å®ç°æ— å…³ã€‚ å½“ä¸€ä¸ªç»„ç»‡åœ¨ä¸€ä¸ªæ¸ é“ä¸­æœ‰å¤šä¸ªpeeræ—¶ï¼Œå®ƒå¯ä»¥é€‰æ‹©åœ¨å“ªäº›peerèŠ‚ç‚¹å®‰è£…æ™ºèƒ½åˆçº¦ã€‚å®ƒä¸éœ€è¦åœ¨æ¯ä¸ªpeerèŠ‚ç‚¹ä¸Šå®‰è£…æ™ºèƒ½åˆçº¦ã€‚ Defining a chaincodeï¼ˆå®šä¹‰é“¾ç ï¼‰ å°½ç®¡é“¾ç å·²å®‰è£…åœ¨å„ä¸ªç»„ç»‡çš„peerä¸Šï¼Œä½†å®ƒæ˜¯åœ¨channelèŒƒå›´å†…ç®¡ç†å’Œæ“ä½œçš„ã€‚æ¯ä¸ªç»„ç»‡éƒ½éœ€è¦æ‰¹å‡†é“¾ç å®šä¹‰ï¼ˆchaincode definitionï¼‰ï¼Œè¿™æ˜¯ä¸€ç»„å‚æ•°ï¼Œç”¨äºç¡®å®šå¦‚ä½•åœ¨æ¸ é“ä¸Šä½¿ç”¨é“¾ç ã€‚ç»„ç»‡å¿…é¡»æ‰¹å‡†é“¾ç å®šä¹‰ï¼Œæ‰èƒ½ä½¿ç”¨å·²å®‰è£…çš„æ™ºèƒ½åˆçº¦æ¥æŸ¥è¯¢è´¦æœ¬å¹¶è®¤å¯äº¤æ˜“ã€‚åœ¨æˆ‘ä»¬çš„åªæœ‰ä¸€ä¸ªpeerèŠ‚ç‚¹P1çš„ä¾‹å­ä¸­ï¼Œç»„ç»‡R1ä¸­çš„ç®¡ç†å‘˜å¿…é¡»æ‰¹å‡†S5çš„é“¾ç å®šä¹‰ï¼ˆchaincode definitionï¼‰ã€‚ éœ€è¦è¶³å¤Ÿæ•°é‡çš„ç»„ç»‡æ‰¹å‡†é“¾ç å®šä¹‰ï¼ˆchaincode definitionï¼‰ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¸ºæ‰¹å‡†ï¼‰ï¼Œç„¶åæ‰èƒ½å°†é“¾ç å®šä¹‰æäº¤ç»™æ¸ é“å¹¶ç”¨äºä¸æ¸ é“è´¦æœ¬è¿›è¡Œäº¤äº’ã€‚ç”±äºä¾‹å­ä¸­çš„é€šé“C1åªæœ‰ä¸€ä¸ªæˆå‘˜ï¼Œå› æ­¤R1çš„ç®¡ç†å‘˜å¯ä»¥å°†S5çš„é“¾ç å®šä¹‰æäº¤ç»™é€šé“C1ã€‚æäº¤é“¾ç çš„å®šä¹‰åï¼Œä¾¿å¯ä»¥ç”±å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA1è°ƒç”¨S5ï¼ è¯·æ³¨æ„ï¼Œå°½ç®¡é€šé“ä¸Šçš„æ¯ä¸ªç»„ä»¶ç°åœ¨éƒ½å¯ä»¥è®¿é—®S5ï¼Œä½†å®ƒä»¬æ— æ³•çœ‹åˆ°å…¶ç¨‹åºé€»è¾‘ã€‚å¯¹äºå®‰è£…å®ƒçš„é‚£äº›èŠ‚ç‚¹ï¼ˆæˆ‘ä»¬çš„ç¤ºä¾‹ä¸­æ˜¯P1ï¼‰ï¼Œå®ƒä»ç„¶æ˜¯ç§æœ‰çš„ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œè¿™æ„å‘³ç€å·²å®šä¹‰å¹¶æäº¤ç»™æ¸ é“çš„æ™ºèƒ½åˆçº¦æ¥å£ä¸å·²å®‰è£…çš„æ™ºèƒ½åˆçº¦å®ç°ç›¸åã€‚åŠ å¼ºè¿™ä¸ªæƒ³æ³•ï¼›å®‰è£…æ™ºèƒ½åˆçº¦æˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä¸ºç‰©ç†æ‰˜ç®¡ï¼ˆphysically hostedï¼‰åœ¨peerä¸Šï¼Œè€Œå·²åœ¨é€šé“ä¸Šå®šä¹‰çš„æ™ºèƒ½åˆçº¦æˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä¸ºé€»è¾‘æ‰˜ç®¡ï¼ˆ logically hostedï¼‰åœ¨é€šé“ä¸Šã€‚ Endorsement policyï¼ˆèƒŒä¹¦ç­–ç•¥ï¼‰ é“¾ç å®šä¹‰ä¸­æä¾›çš„æœ€é‡è¦çš„ä¿¡æ¯æ˜¯èƒŒä¹¦ç­–ç•¥ã€‚å®ƒæè¿°äº†å“ªäº›ç»„ç»‡å¿…é¡»æ‰¹å‡†äº¤æ˜“ç„¶åå…¶ä»–ç»„ç»‡æ‰èƒ½å°†å…¶æ¥å—åˆ°å…¶è´¦æœ¬å‰¯æœ¬ä¸Šã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ç½‘ç»œä¸­ï¼Œåªæœ‰R1æˆ–R2è®¤å¯äº¤æ˜“ï¼Œæ‰èƒ½å°†äº¤æ˜“æ¥å—åˆ°è´¦æœ¬L1ä¸Šã€‚ å°†é“¾ç å®šä¹‰æäº¤ç»™æ¸ é“ä¼šå°†èƒŒä¹¦ç­–ç•¥æ”¾åœ¨æ¸ é“çš„è´¦æœ¬ä¸Šï¼›å®ƒä½¿é€šé“çš„ä»»ä½•æˆå‘˜éƒ½å¯ä»¥è®¿é—®å®ƒã€‚æ‚¨å¯ä»¥åœ¨äº¤æ˜“æµä¸»é¢˜ä¸­é˜…è¯»æœ‰å…³èƒŒä¹¦ç­–ç•¥çš„æ›´å¤šä¿¡æ¯ã€‚ Invoking a smart contractï¼ˆè°ƒç”¨æ™ºèƒ½åˆçº¦ï¼‰ å°†æ™ºèƒ½åˆçº¦å®‰è£…åœ¨peerèŠ‚ç‚¹ä¸Šå¹¶åœ¨channelä¸Šå®šä¹‰åï¼Œå³å¯ç”±å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºè°ƒç”¨ã€‚ å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºé€šè¿‡å‘ç”±æ™ºèƒ½åˆçº¦èƒŒä¹¦ç­–ç•¥æŒ‡å®šçš„ç»„ç»‡æ‰€æ‹¥æœ‰çš„èŠ‚ç‚¹å‘èµ·äº¤æ˜“ææ¡ˆï¼›æ™ºèƒ½åˆçº¦ä½¿ç”¨äº¤æ˜“ææ¡ˆä½œä¸ºå®ƒçš„è¾“å…¥æ¥ç”Ÿæˆè®¤å¯çš„äº¤æ˜“å“åº”ï¼Œè¯¥å“åº”ç”±peerèŠ‚ç‚¹è¿”å›åˆ°å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚ è¿™äº›äº¤æ˜“å“åº”ä¸äº¤æ˜“æè®®æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå®Œå…¨è®¤å¯çš„äº¤æ˜“ï¼Œå¯ä»¥åˆ†æ•£åˆ°æ•´ä¸ªç½‘ç»œã€‚ç°åœ¨äº†è§£åº”ç”¨ç¨‹åºå¦‚ä½•è°ƒç”¨æ™ºèƒ½åˆçº¦ä»¥ç”Ÿæˆè®¤å¯çš„äº¤æ˜“å³å¯ï¼Œç¨åæˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œæ›´è¯¦ç»†çš„ä»‹ç»ã€‚ åœ¨ç½‘ç»œå¼€å‘çš„è¿™ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»„ç»‡R1æ­£åœ¨å®Œå…¨å‚ä¸ç½‘ç»œã€‚å®ƒçš„åº”ç”¨ç¨‹åº-ä»A1å¼€å§‹-å¯ä»¥é€šè¿‡æ™ºèƒ½åˆçº¦S5è®¿é—®è´¦æœ¬L1ï¼Œä»¥ç”Ÿæˆå°†ç”±R1è®¤å¯çš„äº¤æ˜“ï¼Œç”±äºå®ƒä»¬ç¬¦åˆè®¤å¯ç­–ç•¥å› æ­¤è¢«æ¥å—åˆ°è´¦æœ¬ä¸­ã€‚ Network completedï¼ˆç½‘ç»œå®Œæˆï¼‰ å›æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä¸ºè”ç›ŸX1ï¼ˆç»„ç»‡R1å’ŒR2ï¼‰åˆ›å»ºæ¸ é“ã€‚ç½‘ç»œå¼€å‘çš„ä¸‹ä¸€é˜¶æ®µå°†çœ‹åˆ°ç»„ç»‡R2å°†å…¶åŸºç¡€ç»“æ„æ·»åŠ åˆ°ç½‘ç»œä¸­ã€‚ è®©æˆ‘ä»¬æ¥çœ‹çœ‹ç½‘ç»œè¿›åŒ–æˆä»€ä¹ˆæ ·äº†ï¼š é€šè¿‡å¢åŠ ç»„ç»‡R2çš„åŸºç¡€ç»“æ„ï¼Œç½‘ç»œå¾—åˆ°äº†å‘å±•ã€‚å…·ä½“æ¥è¯´ï¼ŒR2æ·»åŠ äº†peerèŠ‚ç‚¹P2ï¼Œè¯¥peerèŠ‚ç‚¹æ‰˜ç®¡è´¦æœ¬L1çš„å‰¯æœ¬å’Œé“¾ç S5ã€‚R2æ‰¹å‡†ä¸R1ç›¸åŒçš„é“¾ç å®šä¹‰ã€‚P2ä¹Ÿä¸åº”ç”¨ç¨‹åºA2ä¸€æ ·åŠ å…¥äº†é€šé“C1ï¼ŒA2å’ŒP2é€šè¿‡CA2è¿›è¡Œèº«ä»½è®¤è¯ã€‚æ‰€æœ‰è¿™äº›æ„å‘³ç€åº”ç”¨ç¨‹åºA1å’ŒA2éƒ½å¯ä»¥ä½¿ç”¨peerèŠ‚ç‚¹P1æˆ–P2åœ¨C1ä¸Šè°ƒç”¨S5ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»„ç»‡R2åœ¨é€šé“C1ä¸Šæ·»åŠ äº†ä¸€ä¸ªpeerèŠ‚ç‚¹P2ã€‚ P2è¿˜æ‰˜ç®¡è´¦æœ¬L1çš„å‰¯æœ¬å’Œæ™ºèƒ½åˆçº¦S5ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°R2è¿˜æ·»åŠ äº†å¯ä»¥é€šè¿‡é€šé“C1è¿æ¥åˆ°ç½‘ç»œçš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA2ã€‚ä¸ºæ­¤ï¼Œç»„ç»‡R2ä¸­çš„ç®¡ç†å‘˜å·²åˆ›å»ºpeerèŠ‚ç‚¹P2ï¼Œå¹¶å°†å…¶ç”¨ä¸R1ä¸­çš„ç®¡ç†å‘˜ç›¸åŒçš„æ–¹å¼åŠ å…¥åˆ°é€šé“C1ã€‚ç®¡ç†å‘˜è¿˜å¿…é¡»æ‰¹å‡†ä¸R1ç›¸åŒçš„é“¾ç å®šä¹‰ã€‚ æˆ‘ä»¬å·²ç»å»ºç«‹äº†ç¬¬ä¸€ä¸ªè¿è¥ç½‘ç»œï¼åœ¨ç½‘ç»œå¼€å‘çš„ç°é˜¶æ®µï¼Œæˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªæ¸ é“ï¼Œåœ¨æ­¤é€šé“ä¸Šç»„ç»‡R1å’ŒR2å¯ä»¥å½¼æ­¤è¿›è¡Œäº¤æ˜“ã€‚å…·ä½“æ¥è¯´ï¼Œè¿™æ„å‘³ç€åº”ç”¨ç¨‹åºA1å’ŒA2å¯ä»¥ä½¿ç”¨æ™ºèƒ½åˆçº¦S5å’Œé€šé“C1ä¸Šçš„è´¦æœ¬L1ç”Ÿæˆäº¤æ˜“ã€‚ Generating and accepting transactionsï¼ˆç”Ÿæˆå’Œæ¥å—äº¤æ˜“ï¼‰ ä¸å§‹ç»ˆæ‰˜ç®¡ç€è´¦æœ¬å‰¯æœ¬çš„peerèŠ‚ç‚¹ç›¸åï¼Œæˆ‘ä»¬çœ‹åˆ°æœ‰ä¸¤ç§ä¸åŒçš„peerèŠ‚ç‚¹ï¼šæ‹¥æœ‰æ™ºèƒ½åˆçº¦çš„peerå’Œæ²¡æœ‰æ™ºèƒ½åˆçº¦çš„peerã€‚åœ¨æˆ‘ä»¬çš„ç½‘ç»œä¸­ï¼Œæ¯ä¸ªpeeréƒ½æ‰˜ç®¡ç€æ™ºèƒ½åˆçº¦çš„å‰¯æœ¬ï¼Œä½†æ˜¯åœ¨è¾ƒå¤§çš„ç½‘ç»œä¸­ï¼Œå°†æœ‰æ›´å¤šçš„peerèŠ‚ç‚¹ä¸æ‰˜ç®¡æ™ºèƒ½åˆçº¦çš„å‰¯æœ¬ã€‚peerèŠ‚ç‚¹åªèƒ½è¿è¡Œå®‰è£…åœ¨å…¶ä¸Šçš„æ™ºèƒ½åˆçº¦ï¼Œä½†æ˜¯å®ƒå¯ä»¥é€šè¿‡è¿æ¥åˆ°é€šé“æ¥çŸ¥é“æ™ºèƒ½åˆçº¦çš„æ¥å£ã€‚ æ‚¨ä¸åº”è¯¥å°†æ²¡æœ‰å®‰è£…æ™ºèƒ½åˆçº¦çš„peerèŠ‚ç‚¹è§†ä¸ºåŠ£ç­‰èŠ‚ç‚¹ã€‚å…·æœ‰æ™ºèƒ½åˆçº¦çš„peerèŠ‚ç‚¹æ›´å…·æœ‰ç‰¹æ®Šçš„åŠŸèƒ½-æœ‰åŠ©äº**ç”Ÿæˆï¼ˆgenerate ï¼‰äº¤æ˜“ã€‚è¯·æ³¨æ„ï¼Œæ‰€æœ‰peerèŠ‚ç‚¹éƒ½å¯ä»¥éªŒè¯ï¼ˆvalidateï¼‰å¹¶éšåæ¥å—ï¼ˆacceptï¼‰æˆ–æ‹’ç»ï¼ˆrejectï¼‰äº¤æ˜“åˆ°å…¶è´¦æœ¬L1çš„å‰¯æœ¬ä¸Šã€‚ä½†æ˜¯ï¼Œåªæœ‰å®‰è£…äº†æ™ºèƒ½åˆçº¦çš„peerèŠ‚ç‚¹æ‰èƒ½å‚ä¸äº¤æ˜“è®¤å¯ï¼ˆendorsementï¼‰**çš„è¿‡ç¨‹ï¼Œè¿™å¯¹ç”Ÿæˆåˆæ³•äº¤æ˜“è‡³å…³é‡è¦ã€‚ æˆ‘ä»¬æ— éœ€æ‹…å¿ƒæœ¬ä¸»é¢˜ä¸­å¦‚ä½•ç”Ÿæˆï¼Œåˆ†é…å’Œæ¥å—äº¤æ˜“çš„ç¡®åˆ‡ç»†èŠ‚â€“èƒ½å¤Ÿç†è§£æˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªåŒºå—é“¾ç½‘ç»œï¼Œç»„ç»‡R1å’ŒR2å¯ä»¥å…±äº«ä¿¡æ¯å’Œæµç¨‹ä½œä¸ºè´¦æœ¬æ¥å—ï¼ˆledger-capturedï¼‰çš„äº¤æ˜“ã€‚æˆ‘ä»¬å°†åœ¨å…¶ä»–ä¸»é¢˜ä¸­å­¦ä¹ æœ‰å…³äº¤æ˜“ï¼Œè´¦æœ¬ï¼Œæ™ºèƒ½åˆçº¦çš„æ›´å¤šä¿¡æ¯ã€‚ Types of peersï¼ˆpeerèŠ‚ç‚¹çš„ç±»å‹ï¼‰ åœ¨Hyperledger Fabricä¸­ï¼Œå°½ç®¡æ‰€æœ‰peeréƒ½ç›¸åŒï¼Œä½†å®ƒä»¬å¯ä»¥æ ¹æ®ç½‘ç»œçš„é…ç½®æ–¹å¼æ‰¿æ‹…å¤šä¸ªè§’è‰²ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯¹å…¸å‹çš„ç½‘ç»œæ‹“æ‰‘æœ‰äº†è¶³å¤Ÿçš„äº†è§£ï¼Œå¯ä»¥æè¿°è¿™äº›è§’è‰²ã€‚ Committing peerï¼šæäº¤peerèŠ‚ç‚¹ï¼Œé€šé“ä¸­çš„æ¯ä¸ªpeerèŠ‚ç‚¹éƒ½æ˜¯æäº¤peerèŠ‚ç‚¹ã€‚å®ƒæ¥æ”¶åŒ…å«å·²ç»ç”Ÿæˆçš„äº¤æ˜“çš„å—ï¼Œéšåå°†å…¶éªŒè¯ï¼Œç„¶åå†å°†å®ƒä»¬ä»¥è¿½åŠ çš„æ–¹å¼æäº¤åˆ°peerèŠ‚ç‚¹çš„è´¦æœ¬å‰¯æœ¬ä¸­ã€‚ Endorsing peerï¼šèƒŒä¹¦èŠ‚ç‚¹ï¼Œæ¯ä¸€ä¸ªå®‰è£…äº†æ™ºèƒ½åˆçº¦çš„peerèŠ‚ç‚¹éƒ½å¯ä»¥æˆä¸ºèƒŒä¹¦èŠ‚ç‚¹ã€‚ä½†æ˜¯è¦çœŸæ­£æˆä¸ºèƒŒä¹¦èŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¿…é¡»ä½¿ç”¨peerçš„æ™ºèƒ½åˆçº¦æ¥ç”Ÿæˆæ•°å­—ç­¾åçš„äº‹åŠ¡å“åº”ã€‚èƒŒä¹¦å¯¹ç­‰æ–¹ä¸€è¯æ˜¯å¯¹æ­¤äº‹å®çš„æ˜ç¡®å¼•ç”¨ã€‚ æ™ºèƒ½åˆçº¦çš„èƒŒä¹¦ç­–ç•¥ç¡®å®šç»„ç»‡çš„peeråº”å…ˆå¯¹ç”Ÿæˆçš„äº¤æ˜“è¿›è¡Œæ•°å­—ç­¾åï¼Œç„¶åæ‰èƒ½å°†å…¶æ¥å—åˆ°æäº¤peerçš„è´¦æœ¬å‰¯æœ¬ä¸­ã€‚ ä¸Šé¢æ˜¯peerèŠ‚ç‚¹çš„çš„ä¸¤ç§ä¸»è¦ç±»å‹ã€‚peerè¿˜å¯ä»¥é‡‡ç”¨å…¶ä»–ä¸¤ç§è§’è‰²ï¼š Leader peerï¼šé¢†å¯¼èŠ‚ç‚¹ï¼Œå½“ä¸€ä¸ªç»„ç»‡åœ¨åŒä¸€ä¸ªchannelä¸­æœ‰å¤šä¸ªpeerèŠ‚ç‚¹æ—¶ï¼Œé¢†å¯¼èŠ‚ç‚¹è´Ÿè´£å°†äº¤æ˜“ä»æ’åºèŠ‚ç‚¹åˆ†å‘åˆ°ç»„ç»‡å†…çš„å…¶ä»–æäº¤èŠ‚ç‚¹ã€‚ä¸€ä¸ªpeerå¯ä»¥é€‰æ‹©å‚ä¸é™æ€æˆ–åŠ¨æ€é¢†å¯¼é€‰æ‹©ã€‚ å› æ­¤ï¼Œä»é¢†å¯¼è€…çš„è§’åº¦è€ƒè™‘ä¸¤ç»„peeræ˜¯æœ‰å¸®åŠ©çš„-é‚£äº›å…·æœ‰é™æ€é¢†å¯¼è€…é€‰æ‹©çš„peerå’Œé‚£äº›å…·æœ‰åŠ¨æ€é¢†å¯¼è€…é€‰æ‹©çš„peerã€‚å¯¹äºé™æ€èŠ‚ç‚¹ï¼Œå¯ä»¥å°†é›¶ä¸ªæˆ–å¤šä¸ªpeeré…ç½®ä¸ºé¢†å¯¼èŠ‚ç‚¹ã€‚å¯¹äºåŠ¨æ€èŠ‚ç‚¹é›†åˆï¼Œå°†ç”±è¯¥é›†åˆé€‰å‡ºä¸€ä¸ªpeerä½œä¸ºé¢†å¯¼è€…ã€‚æ­¤å¤–ï¼Œåœ¨åŠ¨æ€é›†åˆä¸­ï¼Œå¦‚æœé¢†å¯¼èŠ‚ç‚¹å¤±è´¥äº†ï¼Œåˆ™å…¶ä½™peerå°†é‡æ–°é€‰ä¸¾é¢†å¯¼èŠ‚ç‚¹ã€‚ è¿™æ„å‘³ç€åŒä¸€ä¸ªç»„ç»‡çš„peerså¯ä»¥è®©ä¸€ä¸ªæˆ–å¤šä¸ªé¢†å¯¼èŠ‚ç‚¹è¿æ¥åˆ°æ’åºæœåŠ¡ã€‚è¿™å¯ä»¥å¸®åŠ©æé«˜å¤„ç†å¤§é‡äº‹åŠ¡çš„å¤§å‹ç½‘ç»œçš„å¼¹æ€§å’Œå¯ä¼¸ç¼©æ€§ã€‚ Anchor peer:é”šèŠ‚ç‚¹ï¼Œå¦‚æœpeeréœ€è¦ä¸å¦ä¸€ä¸ªç»„ç»‡ä¸­çš„peerè¿›è¡Œé€šä¿¡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¯¥ç»„ç»‡åœ¨é€šé“é…ç½®ä¸­å®šä¹‰çš„é”šèŠ‚ç‚¹ã€‚ä¸€ä¸ªç»„ç»‡å¯ä»¥ä¸ºå…¶å®šä¹‰é›¶ä¸ªæˆ–å¤šä¸ªé”šèŠ‚ç‚¹ï¼Œå¹¶ä¸”é”šèŠ‚ç‚¹å¯ä»¥å¸®åŠ©å¤„ç†è®¸å¤šä¸åŒçš„è·¨ç»„ç»‡é€šä¿¡åœºæ™¯ã€‚ æ³¨æ„ï¼Œä¸€ä¸ªpeerå¯ä»¥åŒæ—¶æ˜¯ä¸€ä¸ªæäº¤èŠ‚ç‚¹ã€èƒŒä¹¦èŠ‚ç‚¹ã€é¢†å¯¼èŠ‚ç‚¹å’Œé”šèŠ‚ç‚¹ï¼åœ¨ä¸€ä¸ªç»„ç»‡ä¸­å‡ºäºæ‰€æœ‰å®é™…ç›®çš„ï¼Œä»…é”šèŠ‚ç‚¹æ˜¯å¯é€‰çš„ï¼Œé¢†å¯¼èŠ‚ç‚¹ï¼ŒèƒŒä¹¦èŠ‚ç‚¹å’Œæäº¤èŠ‚ç‚¹éƒ½è‡³å°‘æœ‰ä¸€ä¸ªã€‚ Adding organizations and peers to the channelï¼ˆå°†ç»„ç»‡å’ŒèŠ‚ç‚¹æ·»åŠ åˆ°æ¸ é“ï¼‰ å½“ç»„ç»‡R2åŠ å…¥é€šé“æ—¶ï¼Œå®ƒå¿…é¡»åœ¨å…¶peerèŠ‚ç‚¹P2ä¸Šå®‰è£…æ™ºèƒ½åˆçº¦S5ã€‚è¿™å¾ˆæ˜æ˜¾â€“å¦‚æœåº”ç”¨ç¨‹åºA1æˆ–A2å¸Œæœ›åœ¨peerèŠ‚ç‚¹P2ä¸Šä½¿ç”¨S5æ¥ç”Ÿæˆäº¤æ˜“ï¼Œé¦–å…ˆS5å¿…é¡»å­˜åœ¨ï¼Œå®‰è£…æ™ºèƒ½åˆçº¦å¯ä»¥åšåˆ°è®©å…¶å­˜åœ¨ã€‚æ­¤æ—¶ï¼ŒpeerèŠ‚ç‚¹P2å…·æœ‰æ™ºèƒ½åˆçº¦å’Œè´¦æœ¬çš„ç‰©ç†å‰¯æœ¬ï¼›åƒP1ä¸€æ ·ï¼Œå®ƒå¯ä»¥åœ¨å…¶è´¦æœ¬L1çš„å‰¯æœ¬ä¸Šç”Ÿæˆå’Œæ¥å—äº¤æ˜“ã€‚ ä¸ºäº†ä½¿ç”¨æ™ºèƒ½åˆçº¦S5ï¼ŒR2å¿…é¡»æ‰¹å‡†ä¸R1æ‰¹å‡†çš„ç›¸åŒçš„é“¾ç å®šä¹‰ã€‚ç”±äºé“¾ç å®šä¹‰å·²ç”±ç»„ç»‡R1æäº¤ç»™é€šé“ï¼Œå› æ­¤R2ç»„ç»‡æ‰¹å‡†é“¾ç å®šä¹‰å¹¶å®‰è£…é“¾ç è½¯ä»¶åŒ…åä¾¿å¯ä»¥ä½¿ç”¨é“¾ç äº†ã€‚æäº¤äº¤æ˜“åªéœ€å‘ç”Ÿä¸€æ¬¡ã€‚ä¸€ä¸ªæ–°çš„ç»„ç»‡è®¤å¯é“¾ç å‚æ•°çš„è¡Œä¸ºè¢«é€šé“å†…çš„å…¶ä»–ç»„ç»‡ç»Ÿä¸€åä¾¿å¯ä»¥ä½¿ç”¨é“¾ç ã€‚ç”±äºé“¾ç å®šä¹‰çš„è®¤å¯æ˜¯åœ¨ç»„ç»‡çº§åˆ«è¿›è¡Œçš„ï¼Œå› æ­¤R2è®¤å¯é“¾ç å®šä¹‰ä¸€æ¬¡ï¼Œç„¶åå°†å¤šä¸ªpeerèŠ‚ç‚¹åŠ å…¥å®‰è£…äº†é“¾ç åŒ…çš„æ¸ é“ã€‚ç„¶è€Œï¼Œå¦‚æœR2æƒ³è¦å¯¹é“¾ç å®šä¹‰è¿›è¡Œä¿®æ”¹çš„è¯ï¼Œåˆ™R1å’ŒR2éƒ½éœ€è¦åœ¨ç»„ç»‡å±‚é¢è®¤å¯è¿™ä¸ªæ–°çš„é“¾ç å®šä¹‰ï¼Œç„¶åéœ€è¦å…¶ä¸­ä¸€ä¸ªç»„ç»‡å°†å®šä¹‰æäº¤ç»™æ¸ é“ã€‚ åœ¨æˆ‘ä»¬çš„ç½‘ç»œä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é€šé“C1é“¾æ¥äº†ä¸¤ä¸ªå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œä¸¤ä¸ªpeerèŠ‚ç‚¹å’Œä¸€ä¸ªæ’åºæœåŠ¡ã€‚ç”±äºåªæœ‰ä¸€ä¸ªé€šé“ï¼Œå› æ­¤ä¹Ÿåªæœ‰ä¸€ä¸ªé€»è¾‘è´¦æœ¬å¯ä»¥ä¸è¿™äº›ç»„ä»¶è¿›è¡Œäº¤äº’ã€‚èŠ‚ç‚¹P1å’ŒP2æœ‰ç›¸åŒçš„è´¦æœ¬L1çš„å‰¯æœ¬ã€‚æ™ºèƒ½åˆçº¦S5çš„å‰¯æœ¬é€šå¸¸ä½¿ç”¨ç›¸åŒçš„ç¼–ç¨‹è¯­è¨€æ¥å®ç°ï¼Œä½†å¦‚æœä¸åŒï¼Œåˆ™ä»–ä»¬åœ¨è¯­ä¹‰ä¸Šå¿…é¡»ç­‰æ•ˆã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå°†å¯¹peerå°å¿ƒåœ°æ·»åŠ åˆ°ç½‘ç»œå¯ä»¥å¸®åŠ©æ”¯æŒå¢åŠ çš„ååé‡ï¼Œç¨³å®šæ€§å’Œå¼¹æ€§ã€‚ä¾‹å¦‚ï¼Œç½‘ç»œä¸­æ›´å¤šçš„peerèŠ‚ç‚¹å°†å…è®¸æ›´å¤šçš„åº”ç”¨ç¨‹åºè¿æ¥åˆ°å®ƒï¼›åœ¨é‡åˆ°è®¡åˆ’å†…æˆ–è®¡åˆ’å¤–çš„åœæœºæ—¶ç»„ç»‡ä¸­çš„å¤šä¸ªpeerå°†æä¾›é¢å¤–çš„å¼¹æ€§ã€‚ è¿™ä¸€åˆ‡éƒ½æ„å‘³ç€å¯ä»¥é…ç½®æ”¯æŒå„ç§æ“ä½œç›®æ ‡çš„å¤æ‚çš„æ‹“æ‰‘ç½‘ç»œï¼Œç½‘ç»œå¯ä»¥è¾¾åˆ°çš„è§„æ¨¡ä¸å­˜åœ¨ç†è®ºä¸Šçš„é™åˆ¶ã€‚æ­¤å¤–ï¼Œå•ä¸ªç»„ç»‡ä¸­çš„peerå¯ä»¥æœ‰æ•ˆåœ°å‘ç°å¹¶å½¼æ­¤é€šä¿¡çš„æŠ€æœ¯æœºåˆ¶-gossip protocol-å°†å®¹çº³å¤§é‡peerèŠ‚ç‚¹ä»¥æ”¯æŒæ­¤ç±»æ‹“æ‰‘ã€‚ ä»”ç»†ä½¿ç”¨ç½‘ç»œå’Œé€šé“ç­–ç•¥å¯ä»¥ä½¿å¤§å‹ç½‘ç»œå¾—åˆ°è‰¯å¥½ç®¡ç†ã€‚ç»„ç»‡å¯ä»¥è‡ªç”±åœ°å°†peerèŠ‚ç‚¹æ·»åŠ åˆ°ç½‘ç»œï¼Œåªè¦å®ƒä»¬ç¬¦åˆç½‘ç»œçº¦å®šçš„ç­–ç•¥å³å¯ã€‚ç½‘ç»œå’Œæ¸ é“ç­–ç•¥åœ¨è‡ªæ²»å’Œæ§åˆ¶ä¹‹é—´å»ºç«‹äº†å¹³è¡¡ï¼Œè¿™æ˜¯å»ä¸­å¿ƒåŒ–ç½‘ç»œçš„ç‰¹å¾ã€‚ Simplifying the visual vocabularyï¼ˆç®€åŒ–è§†è§‰è¯æ±‡ï¼‰ Weâ€™re now going to simplify the visual vocabulary used to represent our sample blockchain network. As the size of the network grows, the lines initially used to help us understand channels will become cumbersome. Imagine how complicated our diagram would be if we added another peer or client application, or another channel? ç°åœ¨ï¼Œæˆ‘ä»¬å°†ç®€åŒ–ç”¨äºè¡¨ç¤ºç¤ºä¾‹åŒºå—é“¾ç½‘ç»œçš„è§†è§‰è¯æ±‡ã€‚éšç€ç½‘ç»œè§„æ¨¡çš„æ‰©å¤§ï¼Œæœ€åˆç”¨äºå¸®åŠ©æˆ‘ä»¬äº†è§£æ¸ é“çš„çº¿è·¯å°†å˜å¾—å¾ˆç¹çã€‚æƒ³æƒ³ä¸€äº›å¦‚æœæˆ‘ä»¬æ·»åŠ å¦ä¸€ä¸ªpeerèŠ‚ç‚¹æˆ–è€…ä¸€ä¸ªå®¢æˆ·ç«¯æˆ–è€…å¦ä¸€ä¸ªchannelæˆ‘ä»¬çš„å›¾ç‰‡æœ‰å¤šå¤æ‚ï¼Ÿ Thatâ€™s what weâ€™re going to do in a minute, so before we do, letâ€™s simplify the visual vocabulary. Hereâ€™s a simplified representation of the network weâ€™ve developed so far: è¿™å°±æ˜¯æˆ‘ä»¬ç´§æ¥ç€è¦åšçš„äº‹æƒ…ï¼Œå› æ­¤åœ¨æˆ‘ä»¬è¿™æ ·åšä¹‹å‰ï¼Œè®©æˆ‘ä»¬ç®€åŒ–è§†è§‰è¯æ±‡ã€‚è¿™æ˜¯åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å¼€å‘çš„ç½‘ç»œçš„ç®€åŒ–è¡¨ç¤ºï¼š The diagram shows the facts relating to channel C1 in the network N as follows: Client applications A1 and A2 can use channel C1 for communication with peers P1 and P2, and orderer O4. Peer nodes P1 and P2 can use the communication services of channel C1. Ordering service O4 can make use of the communication services of channel C1. Channel configuration CC1 applies to channel C1. è¯¥å›¾æ˜¾ç¤ºäº†ä¸ç½‘ç»œNä¸­çš„é€šé“C1æœ‰å…³çš„äº‹å®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šå®¢æˆ·ç«¯ç¨‹åºA1å’ŒA2å¯ä»¥ä½¿ç”¨é€šé“C1æ¥ä¸peerèŠ‚ç‚¹P1å’ŒP2å’Œæ’åºèŠ‚ç‚¹O4è¿›è¡Œé€šä¿¡ã€‚peerèŠ‚ç‚¹P1å’ŒP2å¯ä»¥ä½¿ç”¨é€šé“C1çš„é€šä¿¡æœåŠ¡ã€‚æ’åºæœåŠ¡O4å¯ä»¥åˆ©ç”¨é€šé“C1çš„é€šä¿¡æœåŠ¡ã€‚é€šé“é…ç½®CC1é€‚ç”¨äºé€šé“C1ã€‚ Note that the network diagram has been simplified by replacing channel lines with connection points, shown as blue circles which include the channel number. No information has been lost. This representation is more scalable because it eliminates crossing lines. This allows us to more clearly represent larger networks. Weâ€™ve achieved this simplification by focusing on the connection points between components and a channel, rather than the channel itself. è¯·æ³¨æ„ï¼Œè¿™ä¸ªç½‘ç»œå›¾å·²ç»é€šè¿‡ç”¨è¿æ¥ç‚¹æ›¿æ¢é€šé“çº¿æ¥ç®€åŒ–äº†ï¼Œæ˜¾ç¤ºä¸ºå¸¦æœ‰é€šé“ç¼–å·çš„è“è‰²åœ†åœˆã€‚æ²¡æœ‰ä¿¡æ¯ä¸¢å¤±ã€‚æ­¤è¡¨ç¤ºå½¢å¼æ›´å…·ä¼¸ç¼©æ€§ï¼Œå› ä¸ºå®ƒæ¶ˆé™¤äº†äº¤å‰çº¿ã€‚è¿™ä½¿æˆ‘ä»¬å¯ä»¥æ›´æ¸…æ¥šåœ°è¡¨ç¤ºæ›´å¤§çš„ç½‘ç»œã€‚é€šè¿‡ä¸“æ³¨äºç»„ä»¶å’Œé€šé“ä¹‹é—´çš„è¿æ¥ç‚¹ï¼Œè€Œä¸æ˜¯é€šé“æœ¬èº«ï¼Œæˆ‘ä»¬å®ç°äº†è¿™ç§ç®€åŒ–ã€‚ Adding another consortium definitionï¼ˆæ·»åŠ å¦ä¸€ä¸ªè”ç›Ÿå®šä¹‰ï¼‰ In this next phase of network development, we introduce organization R3. Weâ€™re going to give organizations R2 and R3 a separate application channel which allows them to transact with each other. This application channel will be completely separate to that previously defined, so that R2 and R3 transactions can be kept private to them. åœ¨ç½‘ç»œå¼€å‘çš„ä¸‹ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬ä»‹ç»ç»„ç»‡R3ã€‚æˆ‘ä»¬å°†ä¸ºç»„ç»‡R2å’ŒR3æä¾›ä¸€ä¸ªå•ç‹¬çš„åº”ç”¨ç¨‹åºæ¸ é“ï¼Œä½¿ä»–ä»¬å¯ä»¥å½¼æ­¤è¿›è¡Œäº¤æ˜“ã€‚è¯¥åº”ç”¨ç¨‹åºé€šé“å°†ä¸å…ˆå‰å®šä¹‰çš„é€šé“å®Œå…¨åˆ†å¼€ï¼Œå› æ­¤å¯ä»¥ä½¿R2å’ŒR3çš„äº¤æ˜“ä¿æŒç§æœ‰ã€‚ Letâ€™s return to the network level and define a new consortium, X2, for R2 and R3: è®©æˆ‘ä»¬å›åˆ°ç½‘ç»œçº§åˆ«å¹¶ä¸”ä¸ºR2å’ŒR3å®šä¹‰ä¸€ä¸ªæ–°çš„è”ç›ŸX2ï¼š A network administrator from organization R1 or R4 has added a new consortium definition, X2, which includes organizations R2 and R3. This will be used to define a new channel for X2. R1æˆ–è€…R4çš„ç½‘ç»œç®¡ç†å‘˜å·²ç»æ·»åŠ äº†ä¸€ä¸ªæ–°çš„è”ç›Ÿå®šä¹‰X2ï¼Œè¿™ä¸ªè”ç›Ÿå®šä¹‰åŒ…å«äº†R2å’ŒR3ä¸¤ä¸ªç»„ç»‡ã€‚è¿™å°†è¢«ç”¨äºä¸ºX2å®šä¹‰ä¸€ä¸ªæ–°çš„é€šé“ã€‚ Notice that the network now has two consortia defined: X1 for organizations R1 and R2 and X2 for organizations R2 and R3. Consortium X2 has been introduced in order to be able to create a new channel for R2 and R3. æ³¨æ„ç½‘ç»œä¸­ç°åœ¨å·²ç»æœ‰ä¸¤ä¸ªè”ç›Ÿå®šä¹‰ï¼Œç»„ç»‡R1ä¸R2çš„è”ç›ŸX1å’Œç»„ç»‡R2ä¸R3çš„è”ç›ŸX2ã€‚è”ç›ŸX2å·²ç»è¢«å¼•è¿›ä»¥ä¾¿ä¸ºR2å’ŒR3åˆ›å»ºæ–°çš„é€šé“ã€‚ A new channel can only be created by those organizations specifically identified in the network configuration policy, NC4, as having the appropriate rights to do so, i.e. R1 or R4. This is an example of a policy which separates organizations that can manage resources at the network level versus those who can manage resources at the channel level. Seeing these policies at work helps us understand why Hyperledger Fabric has a sophisticated tiered policy structure. æ–°æ¸ é“åªèƒ½ç”±ç½‘ç»œé…ç½®ç­–ç•¥ä¸­æ˜ç¡®æ ‡è¯†çš„ç»„ç»‡åˆ›å»ºï¼Œç½‘ç»œä¸­NC4å…·æœ‰é€‚å½“æƒé™çš„ï¼Œå³R1æˆ–R4ã€‚è¿™æ˜¯ç­–ç•¥çš„ç¤ºä¾‹ï¼Œè¯¥ç­–ç•¥å°†å¯ä»¥åœ¨ç½‘ç»œçº§åˆ«ç®¡ç†èµ„æºçš„ç»„ç»‡ä¸å¯ä»¥åœ¨é€šé“çº§åˆ«ç®¡ç†èµ„æºçš„ç»„ç»‡åŒºåˆ†å¼€æ¥ã€‚çœ‹åˆ°è¿™äº›ç­–ç•¥åœ¨èµ·ä½œç”¨ï¼Œæœ‰åŠ©äºæˆ‘ä»¬ç†è§£ä¸ºä»€ä¹ˆHyperledger Fabricå…·æœ‰å¤æ‚çš„åˆ†å±‚ç­–ç•¥ç»“æ„ã€‚ In practice, consortium definition X2 has been added to the network configuration NC4. We discuss the exact mechanics of this operation elsewhere in the documentation. å®é™…ä¸Šï¼Œè”ç›Ÿå®šä¹‰X2å·²æ·»åŠ åˆ°ç½‘ç»œé…ç½®NC4ã€‚æˆ‘ä»¬å°†åœ¨æ–‡æ¡£çš„å…¶ä»–åœ°æ–¹è®¨è®ºæ­¤æ“ä½œçš„ç¡®åˆ‡æœºåˆ¶ã€‚ Adding a new channelï¼ˆæ·»åŠ ä¸€ä¸ªæ–°çš„é€šé“ï¼‰ Letâ€™s now use this new consortium definition, X2, to create a new channel, C2. To help reinforce your understanding of the simpler channel notation, weâ€™ve used both visual styles â€“ channel C1 is represented with blue circular end points, whereas channel C2 is represented with red connecting lines: è®©æˆ‘ä»¬ä½¿ç”¨æ–°çš„X2è”ç›Ÿå®šä¹‰æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„é€šé“C2ã€‚ä¸ºäº†å¸®åŠ©æ‚¨è¿›ä¸€æ­¥ç†è§£æ›´ç®€å•çš„é€šé“ç¬¦å·ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸¤ç§è§†è§‰æ ·å¼-é€šé“C1ç”¨è“è‰²åœ†å½¢ç«¯ç‚¹è¡¨ç¤ºï¼Œè€Œé€šé“C2ç”¨çº¢è‰²è¿æ¥çº¿è¡¨ç¤ºï¼š A new channel C2 has been created for R2 and R3 using consortium definition X2. The channel has a channel configuration CC2, completely separate to the network configuration NC4, and the channel configuration CC1. Channel C2 is managed by R2 and R3 who have equal rights over C2 as defined by a policy in CC2. R1 and R4 have no rights defined in CC2 whatsoever. ä½¿ç”¨è”ç›Ÿå®šä¹‰X2ä¸ºR2å’ŒR3åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„é€šé“C2ã€‚è¿™ä¸ªé€šé“æœ‰ä¸€ä¸ªé€šé“é…ç½®CC2ï¼Œå®Œå…¨ç‹¬ç«‹äºç½‘ç»œé…ç½®NC4å’Œé€šé“é…ç½®CC1ã€‚é€šé“C2ç”±R2å’ŒR3ç®¡ç†ï¼Œå®ƒä»¬å…·æœ‰CC2ä¸­çš„ç­–ç•¥æ‰€å®šä¹‰çš„å¯¹C2ç›¸åŒçš„æƒé™ã€‚ R1å’ŒR4åœ¨CC2ä¸­å‡æœªå®šä¹‰ä»»ä½•æƒé™ã€‚ The channel C2 provides a private communications mechanism for the consortium X2. Again, notice how organizations united in a consortium are what form channels. The channel configuration CC2 now contains the policies that govern channel resources, assigning management rights to organizations R2 and R3 over channel C2. It is managed exclusively by R2 and R3; R1 and R4 have no power in channel C2. For example, channel configuration CC2 can subsequently be updated to add organizations to support network growth, but this can only be done by R2 or R3. é€šé“C2ä¸ºè”ç›ŸX2æä¾›äº†ä¸“ç”¨é€šä¿¡æœºåˆ¶ã€‚å†æ¬¡æ³¨æ„ï¼Œç»„ç»‡æ˜¯å¦‚ä½•é€šè¿‡é€šé“è¢«è”åˆèµ·æ¥çš„ã€‚é€šé“é…ç½®CC2ç°åœ¨åŒ…å«æ§åˆ¶é€šé“èµ„æºçš„ç­–ç•¥ï¼Œé€šè¿‡é€šé“C2å‘ç»„ç»‡R2å’ŒR3åˆ†é…ç®¡ç†æƒé™ã€‚å®ƒä»…ç”±R2å’ŒR3ç®¡ç†ï¼› R1å’ŒR4åœ¨é€šé“C2ä¸­æ²¡æœ‰æƒé™ã€‚ä¾‹å¦‚ï¼Œé€šé“é…ç½®CC2éšåå¯ä»¥æ›´æ–°ä»¥æ·»åŠ ç»„ç»‡æ¥æ”¯æŒç½‘ç»œå¢é•¿ï¼Œä½†è¿™åªèƒ½ç”±R2æˆ–R3å®Œæˆã€‚ Note how the channel configurations CC1 and CC2 remain completely separate from each other, and completely separate from the network configuration, NC4. Again weâ€™re seeing the de-centralized nature of a Hyperledger Fabric network; once channel C2 has been created, it is managed by organizations R2 and R3 independently to other network elements. Channel policies always remain separate from each other and can only be changed by the organizations authorized to do so in the channel. è¯·æ³¨æ„ï¼Œé€šé“é…ç½®CC1å’ŒCC2å¦‚ä½•ä¿æŒå½¼æ­¤å®Œå…¨ç‹¬ç«‹ï¼Œå¹¶ä¸ç½‘ç»œé…ç½®NC4å®Œå…¨ç‹¬ç«‹ã€‚å†æ¬¡ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†Hyperledger Fabricç½‘ç»œçš„å»ä¸­å¿ƒåŒ–æ€§è´¨ï¼›åˆ›å»ºé€šé“C2åï¼Œç»„ç»‡R2å’ŒR3ä¼šç‹¬ç«‹äºå…¶ä»–ç½‘ç»œå…ƒç´ æ¥ç®¡ç†å®ƒã€‚æ¸ é“ç­–ç•¥å§‹ç»ˆä¿æŒå½¼æ­¤ç‹¬ç«‹ï¼Œå¹¶ä¸”åªèƒ½ç”±æœ‰æƒåœ¨é€šé“ä¸­æ›´æ”¹çš„ç»„ç»‡è¿›è¡Œæ›´æ”¹ã€‚ As the network and channels evolve, so will the network and channel configurations. There is a process by which this is accomplished in a controlled manner â€“ involving configuration transactions which capture the change to these configurations. Every configuration change results in a new configuration block transaction being generated, and later in this topic, weâ€™ll see how these blocks are validated and accepted to create updated network and channel configurations respectively. éšç€ç½‘ç»œå’Œé€šé“çš„å‘å±•ï¼Œç½‘ç»œå’Œé€šé“çš„é…ç½®ä¹Ÿå°†éšä¹‹å‘å±•ã€‚æœ‰ä¸€ä¸ªè¿‡ç¨‹å¯ä»¥é€šè¿‡å—æ§çš„æ–¹å¼å®Œæˆæ­¤è¿‡ç¨‹-æ¶‰åŠé…ç½®äº‹åŠ¡ï¼Œè¿™äº›äº‹åŠ¡æ•è·å¯¹è¿™äº›é…ç½®çš„æ›´æ”¹ã€‚æ¯æ¬¡é…ç½®æ›´æ”¹éƒ½ä¼šå¯¼è‡´ç”Ÿæˆæ–°çš„é…ç½®å—äº‹åŠ¡ï¼Œæœ¬ä¸»é¢˜åé¢çš„å†…å®¹ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•éªŒè¯å’Œæ¥å—è¿™äº›åŒºå—ï¼Œä»¥åˆ†åˆ«åˆ›å»ºæ›´æ–°çš„ç½‘ç»œå’Œé€šé“é…ç½®ã€‚ Network and channel configurationsï¼ˆç½‘ç»œä¸é€šé“é…ç½®ï¼‰ Throughout our sample network, we see the importance of network and channel configurations. These configurations are important because they encapsulate the policies agreed by the network members, which provide a shared reference for controlling access to network resources. Network and channel configurations also contain facts about the network and channel composition, such as the name of consortia and its organizations. é€šè¿‡æˆ‘ä»¬ç®€å•çš„ç½‘ç»œï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ç½‘ç»œå’Œé€šé“é…ç½®çš„é‡è¦æ€§ã€‚è¿™äº›é…ç½®ä¹‹æ‰€ä»¥å¦‚æ­¤é‡è¦æ˜¯å› ä¸ºä»–ä»¬å°è£…äº†ç½‘ç»œæˆå‘˜çš„è®¤å¯ç­–ç•¥ï¼Œè¿™äº›ç­–ç•¥æä¾›äº†å¯¹ç½‘ç»œèµ„æºçš„å…±äº«çš„æ§åˆ¶ã€‚ç½‘ç»œå’Œé€šé“é…ç½®è¿˜åŒ…å«æœ‰å…³ç½‘ç»œå’Œé€šé“ç»„æˆçš„äº‹å®ï¼Œæ¯”å¦‚è”ç›Ÿä»¥åŠç»„æˆè”ç›Ÿçš„ç»„ç»‡ã€‚ For example, when the network is first formed using the ordering service node O4, its behaviour is governed by the network configuration NC4. The initial configuration of NC4 only contains policies that permit organization R4 to manage network resources. NC4 is subsequently updated to also allow R1 to manage network resources. Once this change is made, any administrator from organization R1 or R4 that connects to O4 will have network management rights because that is what the policy in the network configuration NC4 permits. Internally, each node in the ordering service records each channel in the network configuration, so that there is a record of each channel created, at the network level. ä¾‹å¦‚ï¼Œå½“é¦–å…ˆä½¿ç”¨æ’åºæœåŠ¡èŠ‚ç‚¹O4å½¢æˆç½‘ç»œæ—¶ï¼Œå…¶è¡Œä¸ºç”±ç½‘ç»œé…ç½®NC4æ§åˆ¶ã€‚NC4çš„åˆå§‹é…ç½®ä»…åŒ…å«å…è®¸ç»„ç»‡R4ç®¡ç†ç½‘ç»œèµ„æºçš„ç­–ç•¥ã€‚éšåå°†NC4æ›´æ–°ä¸ºè¿˜å…è®¸R1ç®¡ç†ç½‘ç»œèµ„æºã€‚ä¸€æ—¦åšäº†è¿™ä¸ªæ›´æ–°ï¼Œç»„ç»‡R1å’ŒR4çš„ç®¡ç†å‘˜éƒ½æ‹¥æœ‰äº†ç½‘ç»œç®¡ç†æƒé™äº†ï¼Œå› ä¸ºè¿™æ˜¯åœ¨ç½‘ç»œé…ç½®NC2çš„ç­–ç•¥ä¸­æŒ‡å®šçš„ã€‚åœ¨å†…éƒ¨ï¼Œæ’åºæœåŠ¡ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šè®°å½•ç½‘ç»œé…ç½®ä¸­çš„æ¯ä¸ªé€šé“ï¼Œä»¥ä¾¿åœ¨ç½‘ç»œçº§åˆ«ä¸Šè®°å½•æ¯ä¸ªåˆ›å»ºçš„é€šé“ã€‚ It means that although ordering service node O4 is the actor that created consortia X1 and X2 and channels C1 and C2, the intelligence of the network is contained in the network configuration NC4 that O4 is obeying. As long as O4 behaves as a good actor, and correctly implements the policies defined in NC4 whenever it is dealing with network resources, our network will behave as all organizations have agreed. In many ways NC4 can be considered more important than O4 because, ultimately, it controls network access. è¿™æ„å‘³ç€å°½ç®¡æ’åºæœåŠ¡èŠ‚ç‚¹O4æ˜¯åˆ›å»ºè”ç›ŸX1å’ŒX2ä»¥åŠæ¸ é“C1å’ŒC2çš„å‚ä¸è€…ï¼Œç½‘ç»œçš„æ™ºèƒ½åŒ…å«åœ¨O4éµå¾ªçš„ç½‘ç»œé…ç½®NC4ä¸­ã€‚åªè¦O4è¡¨ç°å‡ºè‰²ï¼Œå¹¶ä¸”åœ¨å¤„ç†ç½‘ç»œèµ„æºæ—¶æ­£ç¡®æ‰§è¡ŒNC4ä¸­å®šä¹‰çš„ç­–ç•¥ï¼Œæˆ‘ä»¬çš„ç½‘ç»œå°†æŒ‰ç…§æ‰€æœ‰ç»„ç»‡çš„åŒæ„è¡Œäº‹ã€‚åœ¨è®¸å¤šæ–¹é¢ï¼ŒNC4æ¯”O4æ›´é‡è¦ï¼Œå› ä¸ºå®ƒæœ€ç»ˆæ§åˆ¶äº†ç½‘ç»œè®¿é—®ã€‚ The same principles apply for channel configurations with respect to peers. In our network, P1 and P2 are likewise good actors. When peer nodes P1 and P2 are interacting with client applications A1 or A2 they are each using the policies defined within channel configuration CC1 to control access to the channel C1 resources. ç›¸åŒçš„åŸåˆ™é€‚ç”¨äºæœ‰å…³peerèŠ‚ç‚¹çš„é€šé“é…ç½®ã€‚åœ¨æˆ‘ä»¬çš„ç½‘ç»œä¸­ï¼ŒP1å’ŒP2åŒæ ·æ˜¯å¥½è§’è‰²ã€‚å½“peerèŠ‚ç‚¹P1å’ŒP2ä¸å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA1æˆ–A2äº¤äº’æ—¶ï¼Œå®ƒä»¬æ¯ä¸ªéƒ½ä½¿ç”¨åœ¨é€šé“é…ç½®CC1ä¸­å®šä¹‰çš„ç­–ç•¥æ¥æ§åˆ¶å¯¹é€šé“C1èµ„æºçš„è®¿é—®ã€‚ For example, if A1 wants to access the smart contract chaincode S5 on peer nodes P1 or P2, each peer node uses its copy of CC1 to determine the operations that A1 can perform. For example, A1 may be permitted to read or write data from the ledger L1 according to policies defined in CC1. Weâ€™ll see later the same pattern for actors in channel and its channel configuration CC2. Again, we can see that while the peers and applications are critical actors in the network, their behaviour in a channel is dictated more by the channel configuration policy than any other factor. ä¾‹å¦‚ï¼Œå¦‚æœA1æƒ³è¦åœ¨peerèŠ‚ç‚¹P1æˆ–P2ä¸Šè®¿é—®æ™ºèƒ½åˆçº¦S5ï¼Œæ¯ä¸ªå¯¹ç­‰èŠ‚ç‚¹ä½¿ç”¨å…¶CC1å‰¯æœ¬ç¡®å®šA1å¯ä»¥æ‰§è¡Œçš„æ“ä½œã€‚æ¯”å¦‚ï¼Œæ ¹æ®CC1ä¸­çš„ç­–ç•¥å®šä¹‰A1å¯ä»¥å¯èƒ½å¯ä»¥è¯»å†™è´¦æœ¬L1ã€‚ç¨åæˆ‘ä»¬å°†åœ¨é€šé“åŠå…¶é€šé“é…ç½®CC2ä¸­çœ‹åˆ°é’ˆå¯¹è§’è‰²çš„ç›¸åŒæ¨¡å¼ã€‚åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå°½ç®¡peerèŠ‚ç‚¹å’Œåº”ç”¨ç¨‹åºæ˜¯ç½‘ç»œä¸­çš„å…³é”®è§’è‰²ï¼Œå®ƒä»¬åœ¨é€šé“ä¸­çš„è¡Œä¸ºå—é€šé“é…ç½®ç­–ç•¥çš„æ”¯é…ï¼Œè€Œä¸æ˜¯å…¶ä»–ä»»ä½•å› ç´ ã€‚ Finally, it is helpful to understand how network and channel configurations are physically realized. We can see that network and channel configurations are logically singular â€“ there is one for the network, and one for each channel. This is important; every component that accesses the network or the channel must have a shared understanding of the permissions granted to different organizations. æœ€åï¼Œäº†è§£ç‰©ç†ä¸Šå¦‚ä½•å®ç°ç½‘ç»œå’Œé€šé“é…ç½®å°†å¾ˆæœ‰å¸®åŠ©ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç½‘ç»œå’Œé€šé“é…ç½®åœ¨é€»è¾‘ä¸Šæ˜¯å”¯ä¸€çš„ï¼Œç½‘ç»œæœ‰ä¸€ä¸ªé…ç½®ï¼Œæ¯ä¸ªé€šé“ä¹Ÿéƒ½æœ‰ä¸€ä¸ªé…ç½®ã€‚è¿™ä¸ªå¾ˆé‡è¦ï¼Œè®¿é—®ç½‘ç»œæˆ–é€šé“çš„æ¯ä¸ªç»„ä»¶éƒ½å¿…é¡»å¯¹æˆäºˆä¸åŒç»„ç»‡çš„æƒé™æœ‰å…±åŒçš„äº†è§£ã€‚ Even though there is logically a single configuration, it is actually replicated and kept consistent by every node that forms the network or channel. For example, in our network peer nodes P1 and P2 both have a copy of channel configuration CC1, and by the time the network is fully complete, peer nodes P2 and P3 will both have a copy of channel configuration CC2. Similarly ordering service node O4 has a copy of the network configuration, but in a multi-node configuration, every ordering service node will have its own copy of the network configuration. å³ä½¿ä»é€»è¾‘ä¸Šè®²åªæœ‰ä¸€ä¸ªé…ç½®ï¼Œä½†å®é™…ä¸Šå®ƒè¢«æ„æˆç½‘ç»œæˆ–é€šé“çš„æ¯ä¸ªèŠ‚ç‚¹å¤åˆ¶å¹¶ä¿æŒä¸€è‡´ã€‚ä¾‹å¦‚ï¼Œåœ¨æˆ‘ä»¬çš„ç½‘ç»œpeerèŠ‚ç‚¹P1å’ŒP2ä¸­éƒ½æœ‰ä¸€ä¸ªé€šé“é…ç½®CC1çš„å‰¯æœ¬ï¼Œåˆ°ç½‘ç»œå®Œå…¨å®Œæˆæ—¶ï¼ŒpeerèŠ‚ç‚¹P2å’ŒP3éƒ½å°†æ‹¥æœ‰é€šé“é…ç½®CC2çš„å‰¯æœ¬ã€‚ç±»ä¼¼çš„æ’åºæœåŠ¡èŠ‚ç‚¹O4æœ‰ä¸€ä¸ªç½‘ç»œé…ç½®çš„å‰¯æœ¬ï¼Œä½†æ˜¯åœ¨å¤šèŠ‚ç‚¹é…ç½®ä¸­ï¼Œæ¯ä¸ªè®¢è´­æœåŠ¡èŠ‚ç‚¹éƒ½å°†æ‹¥æœ‰è‡ªå·±çš„ç½‘ç»œé…ç½®å‰¯æœ¬ã€‚ Both network and channel configurations are kept consistent using the same blockchain technology that is used for user transactions â€“ but for configuration transactions. To change a network or channel configuration, an administrator must submit a configuration transaction to change the network or channel configuration. It must be signed by the organizations identified in the appropriate policy as being responsible for configuration change. This policy is called the mod_policy and weâ€™ll discuss it later. ç½‘ç»œå’Œé€šé“é…ç½®ä½¿ç”¨ä¸ç”¨æˆ·äº¤æ˜“ç›¸åŒçš„åŒºå—é“¾æŠ€æœ¯ä¿æŒä¸å¯ç¯¡æ”¹ï¼Œä½†æ˜¯è¿™é‡Œæ˜¯ç”¨çš„æ˜¯é…ç½®äº¤æ˜“ã€‚è¦ä¿®æ”¹ä¸€ä¸ªç½‘ç»œæˆ–è€…é€šé“çš„é…ç½®ï¼Œç®¡ç†å‘˜å¿…é¡»æäº¤ä¸€ä¸ªé…ç½®äº¤æ˜“æ¥æ›´æ”¹ç½‘ç»œæˆ–è€…é€šé“çš„é…ç½®ã€‚å¿…é¡»ç”±é€‚å½“ç­–ç•¥ä¸­ç¡®å®šè´Ÿè´£é…ç½®æ›´æ”¹çš„ç»„ç»‡ç­¾åã€‚è¿™é¡¹æ”¿ç­–ç§°ä¸ºmod_policyï¼Œæˆ‘ä»¬å°†åœ¨åé¢è®¨è®ºã€‚ Indeed, the ordering service nodes operate a mini-blockchain, connected via the system channel we mentioned earlier. Using the system channel ordering service nodes distribute network configuration transactions. These transactions are used to co-operatively maintain a consistent copy of the network configuration at each ordering service node. In a similar way, peer nodes in an application channel can distribute channel configuration transactions. Likewise, these transactions are used to maintain a consistent copy of the channel configuration at each peer node. çš„ç¡®ï¼Œæ’åºæœåŠ¡èŠ‚ç‚¹è¿è¡Œç€ä¸€ä¸ªå¾®å‹åŒºå—é“¾ï¼Œé€šè¿‡æˆ‘ä»¬å‰é¢æåˆ°çš„ç³»ç»Ÿé€šé“è¿æ¥ã€‚æ’åºæœåŠ¡èŠ‚ç‚¹ä½¿ç”¨ç³»ç»Ÿé€šé“æ¥åˆ†å‘ç½‘ç»œé…ç½®äº¤æ˜“ã€‚è¿™äº›äº¤æ˜“ç”¨äºä¿æŒæ¯ä¸ªæ’åºæœåŠ¡èŠ‚ç‚¹åˆä½œç»´æŠ¤ç½‘ç»œé…ç½®æœ‰ä¸€è‡´çš„å‰¯æœ¬ã€‚ä»¥ç±»ä¼¼çš„æ–¹å¼ï¼Œåº”ç”¨ç¨‹åºé€šé“ä¸­çš„peerèŠ‚ç‚¹å¯ä»¥åˆ†å‘é€šé“é…ç½®äº¤æ˜“ã€‚åŒæ ·ï¼Œè¿™äº›äº¤æ˜“ç”¨äºä¿æŒåœ¨æ¯ä¸ªpeerèŠ‚ç‚¹ä¸Šç»´æŠ¤çš„é€šé“é…ç½®çš„å‰¯æœ¬ä¸€è‡´ã€‚ This balance between objects that are logically singular, by being physically distributed is a common pattern in Hyperledger Fabric. Objects like network configurations, that are logically single, turn out to be physically replicated among a set of ordering services nodes for example. We also see it with channel configurations, ledgers, and to some extent smart contracts which are installed in multiple places but whose interfaces exist logically at the channel level. Itâ€™s a pattern you see repeated time and again in Hyperledger Fabric, and enables Hyperledger Fabric to be both de-centralized and yet manageable at the same time. ç‰©ç†æ˜¯åˆ†å¸ƒå¼çš„ï¼Œé€»è¾‘ä¸Šæ˜¯å•ä¸€çš„è¿™ç§å¯¹è±¡ä¹‹é—´çš„å¹³è¡¡æ˜¯Hyperledger Fabricä¸­çš„å¸¸è§æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œé€»è¾‘ä¸Šå•ä¸€çš„å¯¹è±¡ï¼ˆå¦‚ç½‘ç»œé…ç½®ï¼‰å®é™…ä¸Šæ˜¯åœ¨ä¸€ç»„æ’åºæœåŠ¡èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œç‰©ç†å¤åˆ¶çš„ã€‚æˆ‘ä»¬ä¼šåœ¨é€šé“é…ç½®ã€è´¦æœ¬å’Œåœ¨æŸç§ç¨‹åº¦ä¸Šå®‰è£…åœ¨å¤šä¸ªä½ç½®ä½†é€»è¾‘ä¸Šå­˜åœ¨äºé€šé“çº§åˆ«çš„æ™ºèƒ½åˆçº¦ä¸Šçœ‹åˆ°ç›¸åŒçš„æƒ…å†µã€‚æ‚¨åœ¨Hyperledger Fabricä¸­ä¸€æ¬¡åˆä¸€æ¬¡åœ°çœ‹åˆ°è¿™ç§æ¨¡å¼ï¼Œå¹¶ä½¿Hyperledger Fabricæ—¢å¯ä»¥åˆ†æ•£ç®¡ç†ï¼Œåˆå¯ä»¥åŒæ—¶è¿›è¡Œç®¡ç†ã€‚ Adding another peerï¼ˆæ·»åŠ å¦ä¸€ä¸ªpeerèŠ‚ç‚¹ï¼‰ Now that organization R3 is able to fully participate in channel C2, letâ€™s add its infrastructure components to the channel. Rather than do this one component at a time, weâ€™re going to add a peer, its local copy of a ledger, a smart contract and a client application all at once! ç°åœ¨ç»„ç»‡R3å¯ä»¥å®Œå…¨å‚ä¸æ¸ é“C2äº†ï¼Œè®©æˆ‘ä»¬å°†å…¶åŸºç¡€ç»“æ„ç»„ä»¶æ·»åŠ åˆ°æ¸ é“ä¸­ã€‚æˆ‘ä»¬ä¸ä¼šä¸€æ¬¡æ·»åŠ ä¸€ä¸ªç»„ä»¶ï¼Œè€Œæ˜¯ä¸€æ¬¡æ·»åŠ ä¸€ä¸ªpeerä»¥åŠå…¶è´¦æœ¬çš„æœ¬åœ°å‰¯æœ¬ã€æ™ºèƒ½åˆçº¦å’Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼ Letâ€™s see the network with organization R3â€™s components added: è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ·»åŠ äº†ç»„ç»‡R3ç»„ä»¶çš„ç½‘ç»œï¼š The diagram shows the facts relating to channels C1 and C2 in the network N as follows: Client applications A1 and A2 can use channel C1 for communication with peers P1 and P2, and ordering service O4; client applications A3 can use channel C2 for communication with peer P3 and ordering service O4. Ordering service O4 can make use of the communication services of channels C1 and C2. Channel configuration CC1 applies to channel C1, CC2 applies to channel C2. è¯¥å›¾æ˜¾ç¤ºäº†ä¸ç½‘ç»œNä¸­çš„é€šé“C1å’ŒC2æœ‰å…³çš„äº‹å®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA1å’ŒA2å¯ä»¥ä½¿ç”¨é€šé“C1æ¥ä¸peerèŠ‚ç‚¹P1å’ŒP2ä»¥åŠæ’åºæœåŠ¡O4è¿›è¡Œé€šä¿¡ï¼›å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA3å¯ä»¥ä½¿ç”¨é€šé“æ¥ä¸peerèŠ‚ç‚¹P3å’Œæ’åºæœåŠ¡O4è¿›è¡Œé€šä¿¡ã€‚æ’åºæœåŠ¡O4å¯ä»¥åˆ©ç”¨é€šé“C1å’ŒC2çš„é€šä¿¡æœåŠ¡ã€‚é€šé“é…ç½®CC1é€‚ç”¨äºé€šé“C1ï¼ŒCC2é€‚ç”¨äºé€šé“C2ã€‚ First of all, notice that because peer node P3 is connected to channel C2, it has a different ledger â€“ L2 â€“ to those peer nodes using channel C1. The ledger L2 is effectively scoped to channel C2. The ledger L1 is completely separate; it is scoped to channel C1. This makes sense â€“ the purpose of the channel C2 is to provide private communications between the members of the consortium X2, and the ledger L2 is the private store for their transactions. é¦–å…ˆï¼Œè¯·æ³¨æ„ï¼Œç”±äºpeerèŠ‚ç‚¹P3è¿æ¥åˆ°é€šé“C2ï¼Œä»–æ‹¥æœ‰ä¸€ä¸ªä¸é€šé“C1ä¸Šçš„èŠ‚ç‚¹ä¸ä¸€æ ·çš„è´¦æœ¬L2ã€‚è´¦æœ¬L2çš„æœ‰æ•ˆèŒƒå›´ä¸ºé€šé“C2ã€‚åˆ†ç±»å¸L1æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼›å®ƒçš„ä½œç”¨åŸŸæ˜¯é€šé“C1ã€‚è¿™æ˜¯æœ‰é“ç†çš„-é€šé“C2çš„ç›®çš„æ˜¯åœ¨è´¢å›¢X2çš„æˆå‘˜ä¹‹é—´æä¾›ç§äººé€šä¿¡ï¼Œè€Œåˆ†ç±»å¸L2æ˜¯å…¶äº¤æ˜“çš„ç§äººå•†åº—ã€‚ In a similar way, the smart contract S6, installed on peer node P3, and defined on channel C2, is used to provide controlled access to ledger L2. Application A3 can now use channel C2 to invoke the services provided by smart contract S6 to generate transactions that can be accepted onto every copy of the ledger L2 in the network. ä»¥ç±»ä¼¼çš„æ–¹å¼ï¼Œå®‰è£…åœ¨peerèŠ‚ç‚¹P3ä¸Šå¹¶å®šä¹‰åœ¨é€šé“C2ä¸Šçš„æ™ºèƒ½åˆçº¦S6ç”¨äºæä¾›å¯¹è´¦æœ¬L2çš„å—æ§è®¿é—®ã€‚åº”ç”¨ç¨‹åºA3ç°åœ¨å¯ä»¥ä½¿ç”¨é€šé“C2æ¥è°ƒç”¨æ™ºèƒ½åˆçº¦S6æä¾›çš„æœåŠ¡æ¥ç”Ÿæˆäº¤æ˜“ï¼Œä»¥ç”Ÿæˆå¯ä»¥è¢«æ¥å—åˆ°ç½‘ç»œä¸­è´¦æœ¬L2çš„æ¯ä¸ªå‰¯æœ¬ä¸Šçš„äº¤æ˜“ã€‚ At this point in time, we have a single network that has two completely separate channels defined within it. These channels provide independently managed facilities for organizations to transact with each other. Again, this is de-centralization at work; we have a balance between control and autonomy. This is achieved through policies which are applied to channels which are controlled by, and affect, different organizations. æ­¤æ—¶ï¼Œæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªç½‘ç»œï¼Œå…¶ä¸­å®šä¹‰äº†ä¸¤ä¸ªå®Œå…¨ç‹¬ç«‹çš„é€šé“ã€‚è¿™äº›é€šé“ä¸ºç»„ç»‡æä¾›äº†ç›¸äº’ç‹¬ç«‹ç®¡ç†çš„è®¾æ–½ï¼Œä»¥ä¾¿å½¼æ­¤è¿›è¡Œäº¤æ˜“ã€‚åŒæ ·ï¼Œè¿™æ˜¯å·¥ä½œä¸­çš„åˆ†æƒï¼›æˆ‘ä»¬åœ¨æ§åˆ¶å’Œè‡ªæ²»ä¹‹é—´å–å¾—å¹³è¡¡ã€‚è¿™æ˜¯é€šè¿‡å°†ç­–ç•¥åº”ç”¨åˆ°å—ä¸åŒç»„ç»‡æ§åˆ¶å¹¶å½±å“ä¸åŒç»„ç»‡çš„æ¸ é“æ¥å®ç°çš„ã€‚ Joining a peer to multiple channelsï¼ˆæŠŠä¸€ä¸ªpeerèŠ‚ç‚¹åŠ å…¥åˆ°ä¸åŒé€šé“ï¼‰ In this final stage of network development, letâ€™s return our focus to organization R2. We can exploit the fact that R2 is a member of both consortia X1 and X2 by joining it to multiple channels: åœ¨ç½‘ç»œå¼€å‘çš„æœ€åé˜¶æ®µï¼Œè®©æˆ‘ä»¬æŠŠé‡ç‚¹æ”¾å›åˆ°ç»„ç»‡R2ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨R2æ˜¯X1å’ŒX2è”ç›Ÿçš„æˆå‘˜è¿™ä¸€äº‹å®æ¥å°†R2åŠ å…¥å¤šä¸ªæ¸ é“ï¼š The diagram shows the facts relating to channels C1 and C2 in the network N as follows: Client applications A1 can use channel C1 for communication with peers P1 and P2, and ordering service O4; client application A2 can use channel C1 for communication with peers P1 and P2 and channel C2 for communication with peers P2 and P3 and ordering service O4; client application A3 can use channel C2 for communication with peer P3 and P2 and ordering service O4. Ordering service O4 can make use of the communication services of channels C1 and C2. Channel configuration CC1 applies to channel C1, CC2 applies to channel C2. è¯¥å›¾æ˜¾ç¤ºäº†ä¸ç½‘ç»œNä¸­çš„é€šé“C1å’ŒC2æœ‰å…³çš„ä¸‹é¢çš„äº‹å®ï¼šå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA1å¯ä»¥ä½¿ç”¨é€šé“C1æ¥ä¸peerèŠ‚ç‚¹P1å’ŒP2ä»¥åŠæ’åºæœåŠ¡O4è¿›è¡Œé€šä¿¡ï¼›å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA2å¯ä»¥ä½¿ç”¨é€šé“C1æ¥å’ŒpeerèŠ‚ç‚¹P1å’ŒP2é€šä¿¡ï¼Œå¹¶ä¸”ä½¿ç”¨C2æ¥ä¸peerèŠ‚ç‚¹P2å’ŒP3ä»¥åŠæ’åºæœåŠ¡O4è¿›è¡Œé€šä¿¡ï¼›å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA3å¯ä»¥ä½¿ç”¨é€šé“C2æ¥ä¸peerèŠ‚ç‚¹P3å’ŒP2ä»¥åŠæ’åºæœåŠ¡O4è¿›è¡Œé€šä¿¡ã€‚æ’åºæœåŠ¡O4å¯ä»¥ä½¿ç”¨é€šé“C1å’ŒC2ä¸Šçš„é€šä¿¡æœåŠ¡ã€‚é€šé“é…ç½®CC1æœåŠ¡äºé€šé“C1ã€CC2æœåŠ¡ä¸é€šé“C2ã€‚ We can see that R2 is a special organization in the network, because it is the only organization that is a member of two application channels! It is able to transact with organization R1 on channel C1, while at the same time it can also transact with organization R3 on a different channel, C2. æˆ‘ä»¬å¯ä»¥çœ‹åˆ°R2æ˜¯ç½‘ç»œä¸Šçš„ä¸€ä¸ªç‰¹æ®Šçš„ç»„ç»‡ï¼Œå› ä¸ºå®ƒæ˜¯ä¸¤ä¸ªåº”ç”¨ç¨‹åºé€šé“çš„æˆå‘˜çš„å”¯ä¸€ç»„ç»‡ï¼ä»–å¯ä»¥åœ¨é€šé“C1ä¸Šä¸ç»„ç»‡R1è¿›è¡Œäº¤æ˜“ï¼ŒåŒæ—¶å®ƒä¹Ÿå¯ä»¥åœ¨å¦ä¸€ä¸ªä¸åŒçš„é€šé“C2ä¸Šä¸ç»„ç»‡R3è¿›è¡Œäº¤æ˜“ã€‚ Notice how peer node P2 has smart contract S5 installed for channel C1 and smart contract S6 installed for channel C2. Peer node P2 is a full member of both channels at the same time via different smart contracts for different ledgers. è¯·æ³¨æ„ï¼ŒpeerèŠ‚ç‚¹P2å¦‚ä½•ä¸ºé€šé“C1å®‰è£…äº†æ™ºèƒ½åˆçº¦S5ï¼Œå¹¶ä¸ºé€šé“C2å®‰è£…äº†æ™ºèƒ½åˆçº¦S6ã€‚peerèŠ‚ç‚¹P2é€šè¿‡ä¸åŒè´¦æœ¬çš„ä¸åŒæ™ºèƒ½åˆçº¦åŒæ—¶æ˜¯ä¸¤ä¸ªæ¸ é“çš„æ­£å¼æˆå‘˜ã€‚ This is a very powerful concept â€“ channels provide both a mechanism for the separation of organizations, and a mechanism for collaboration between organizations. All the while, this infrastructure is provided by, and shared between, a set of independent organizations. è¿™æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æ¦‚å¿µ-æ¸ é“æ—¢æä¾›äº†ç»„ç»‡åˆ†ç¦»çš„æœºåˆ¶ï¼Œä¹Ÿæä¾›äº†ç»„ç»‡ä¹‹é—´åä½œçš„æœºåˆ¶ã€‚ä¸€ç›´ä»¥æ¥ï¼Œæ­¤åŸºç¡€ç»“æ„ï¼ˆå³é€šé“ï¼‰ç”±ä¸€ç»„ç‹¬ç«‹çš„ç»„ç»‡æä¾›å¹¶åœ¨å®ƒä»¬ä¹‹é—´å…±äº«ã€‚ It is also important to note that peer node P2â€™s behaviour is controlled very differently depending upon the channel in which it is transacting. Specifically, the policies contained in channel configuration CC1 dictate the operations available to P2 when it is transacting in channel C1, whereas it is the policies in channel configuration CC2 that control P2â€™s behaviour in channel C2. åŒæ ·é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼ŒpeerèŠ‚ç‚¹P2çš„è¡Œä¸ºå—å…¶è¿›è¡Œäº¤æ˜“çš„é€šé“çš„æ§åˆ¶éå¸¸ä¸åŒã€‚å…·ä½“è€Œè¨€ï¼Œé€šé“é…ç½®CC1ä¸­åŒ…å«çš„ç­–ç•¥è§„å®šäº†P2åœ¨é€šé“C1ä¸­è¿›è¡Œäº¤æ˜“æ—¶å¯ä½¿ç”¨çš„æ“ä½œï¼Œè€Œé€šé“é…ç½®CC2ä¸­çš„ç­–ç•¥æ§åˆ¶æ¸ é“P2åœ¨æ¸ é“C2ä¸­çš„è¡Œä¸ºã€‚ Again, this is desirable â€“ R2 and R1 agreed the rules for channel C1, whereas R2 and R3 agreed the rules for channel C2. These rules were captured in the respective channel policies â€“ they can and must be used by every component in a channel to enforce correct behaviour, as agreed. åŒæ ·ï¼ŒR2å’ŒR1åŒæ„é€šé“C1çš„è§„åˆ™ï¼Œè€ŒR2å’ŒR3åŒæ„äº†é€šé“C2çš„è§„åˆ™æ˜¯å¯å–çš„ã€‚è¿™äº›è§„åˆ™æ˜¯åœ¨å„è‡ªçš„é€šé“çš„æ”¿ç­–ä¸­è·å–çš„-æ¸ é“ä¸­çš„æ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥å¹¶ä¸”å¿…é¡»ä½¿ç”¨å®ƒä»¬æ¥å¼ºåˆ¶æ‰§è¡Œæ­£ç¡®çš„è¡Œä¸ºï¼Œè¿™å·²ç»è¾¾æˆå…±è¯†ã€‚ Similarly, we can see that client application A2 is now able to transact on channels C1 and C2. And likewise, it too will be governed by the policies in the appropriate channel configurations. As an aside, note that client application A2 and peer node P2 are using a mixed visual vocabulary â€“ both lines and connections. You can see that they are equivalent; they are visual synonyms. åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA2ç°åœ¨èƒ½å¤Ÿåœ¨é€šé“C1å’ŒC2ä¸Šè¿›è¡Œäº¤æ˜“ã€‚åŒæ ·ï¼Œå®ƒä¹Ÿå°†ç”±é€‚å½“çš„é€šé“é…ç½®ä¸­çš„ç­–ç•¥æ§åˆ¶ã€‚é¡ºä¾¿æä¸€å¥ï¼Œè¯·æ³¨æ„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA2å’ŒpeerèŠ‚ç‚¹P2æ­£åœ¨ä½¿ç”¨æ··åˆçš„å¯è§†è¯æ±‡è¡¨ï¼ˆåŒ…æ‹¬è¡Œå’Œè¿æ¥ï¼‰ã€‚æ‚¨å¯ä»¥çœ‹åˆ°å®ƒä»¬æ˜¯ç­‰æ•ˆçš„ã€‚å®ƒä»¬æ˜¯è§†è§‰åŒä¹‰è¯ã€‚ The ordering serviceï¼ˆæ’åºæœåŠ¡ï¼‰ The observant reader may notice that the ordering service node appears to be a centralized component; it was used to create the network initially, and connects to every channel in the network. Even though we added R1 and R4 to the network configuration policy NC4 which controls the orderer, the node was running on R4â€™s infrastructure. In a world of de-centralization, this looks wrong! ç»†å¿ƒçš„è¯»è€…å¯èƒ½ä¼šæ³¨æ„åˆ°æ’åºæœåŠ¡èŠ‚ç‚¹ä¼¼ä¹æ˜¯ä¸€ä¸ªé›†ä¸­å¼ç»„ä»¶ï¼Œä»–è¢«ç”¨äºåˆ›å»ºåˆå§‹åŒ–ç½‘ç»œï¼Œå¹¶ä¸”é“¾æ¥ç½‘ç»œä¸­çš„æ‰€æœ‰çš„é€šé“ã€‚å³ä½¿æˆ‘ä»¬åœ¨æ§åˆ¶æ’åºè€…çš„ç½‘ç»œé…ç½®ç­–ç•¥NC4ä¸­æ·»åŠ äº†R1å’ŒR4ï¼Œè¯¥èŠ‚ç‚¹ä»åœ¨R4çš„åŸºç¡€æ¶æ„ä¸Šè¿è¡Œã€‚åœ¨å»ä¸­å¿ƒåŒ–çš„ä¸–ç•Œä¸­ï¼Œè¿™çœ‹èµ·æ¥æ˜¯é”™è¯¯çš„ï¼ Donâ€™t worry! Our example network showed the simplest ordering service configuration to help you understand the idea of a network administration point. In fact, the ordering service can itself too be completely de-centralized! We mentioned earlier that an ordering service could be comprised of many individual nodes owned by different organizations, so letâ€™s see how that would be done in our sample network. ä¸è¦æ‹…å¿ƒï¼æˆ‘ä»¬çš„ç¤ºä¾‹ç½‘ç»œæ˜¾ç¤ºäº†æœ€ç®€å•çš„æ’åºæœåŠ¡é…ç½®ï¼Œä»¥å¸®åŠ©æ‚¨äº†è§£ç½‘ç»œç®¡ç†ç‚¹çš„æ¦‚å¿µã€‚äº‹å®ä¸Šï¼Œæ’åºæœåŠ¡è‡ªå·±ä¹Ÿæ˜¯å®Œå…¨å»ä¸­å¿ƒåŒ–çš„ã€‚å‰é¢æˆ‘ä»¬æåˆ°è¿‡ï¼Œæ’åºæœåŠ¡å¯ä»¥ç”±ä¸åŒç»„ç»‡æ‹¥æœ‰çš„è®¸å¤šå•ä¸ªèŠ‚ç‚¹ç»„æˆï¼Œå› æ­¤è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨ç¤ºä¾‹ç½‘ç»œä¸­å®Œæˆè¯¥å·¥ä½œã€‚ Letâ€™s have a look at a more realistic ordering service node configuration: è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªæ›´æ¥è¿‘ç°å®çš„æ’åºæœåŠ¡èŠ‚ç‚¹é…ç½®ï¼š A multi-organization ordering service. The ordering service comprises ordering service nodes O1 and O4. O1 is provided by organization R1 and node O4 is provided by organization R4. The network configuration NC4 defines network resource permissions for actors from both organizations R1 and R4. å¤šç»„ç»‡çš„æ’åºæœåŠ¡ã€‚æ’åºæœåŠ¡åŒ…å«æ’åºèŠ‚ç‚¹O1å’ŒO4ã€‚O1æ˜¯ç”±ç»„ç»‡R1æä¾›è€ŒèŠ‚ç‚¹O4æ˜¯ç”±ç»„ç»‡R4æä¾›ã€‚ç½‘ç»œé…ç½®NC4ä¸ºç»„ç»‡R1å’ŒR4çš„å‚ä¸è€…å®šä¹‰äº†ç½‘ç»œèµ„æºæƒé™ã€‚ We can see that this ordering service completely de-centralized â€“ it runs in organization R1 and it runs in organization R4. The network configuration policy, NC4, permits R1 and R4 equal rights over network resources. Client applications and peer nodes from organizations R1 and R4 can manage network resources by connecting to either node O1 or node O4, because both nodes behave the same way, as defined by the policies in network configuration NC4. In practice, actors from a particular organization tend to use infrastructure provided by their home organization, but thatâ€™s certainly not always the case. æˆ‘ä»¬çœ‹åˆ°æ’åºæœåŠ¡å·²ç»æ˜¯å®Œå…¨çš„å»ä¸­å¿ƒåŒ–äº†ï¼Œä»–è¿è¡Œåœ¨ç»„ç»‡R1å’ŒR4ä¸Šã€‚ç½‘ç»œé…ç½®ç­–ç•¥NC4ï¼Œå…è®¸R1å’ŒR4åœ¨ç½‘ç»œèµ„æºä¸Šäº«æœ‰åŒç­‰çš„æƒåˆ©ã€‚ç»„ç»‡R1å’ŒR4çš„å®¢æˆ·ç«¯ç¨‹åºå’ŒpeerèŠ‚ç‚¹å¯ä»¥é€šè¿‡O1å’ŒO4çš„ä»»æ„ä¸€ä¸ªæ¥ç®¡ç†ç½‘ç»œä¸Šçš„èµ„æºï¼Œå› ä¸ºä¸¤ä¸ªèŠ‚ç‚¹çš„è¡Œä¸ºæ–¹å¼å‡ä¸ç½‘ç»œé…ç½®NC4ä¸­çš„ç­–ç•¥æ‰€å®šä¹‰çš„æ–¹å¼ç›¸åŒã€‚å®é™…ä¸Šï¼Œæ¥è‡ªç‰¹å®šç»„ç»‡çš„å‚ä¸è€…å¾€å¾€ä¼šä½¿ç”¨å…¶ä¸Šçº§ç»„ç»‡æä¾›çš„åŸºç¡€æ¶æ„ï¼Œä½†è¿™å¹¶éæ€»æ˜¯å¦‚æ­¤ã€‚ De-centralized transaction distributionï¼ˆå»ä¸­å¿ƒåŒ–çš„äº¤æ˜“åˆ†å‘ï¼‰ As well as being the management point for the network, the ordering service also provides another key facility â€“ it is the distribution point for transactions. The ordering service is the component which gathers endorsed transactions from applications and orders them into transaction blocks, which are subsequently distributed to every peer node in the channel. At each of these committing peers, transactions are recorded, whether valid or invalid, and their local copy of the ledger updated appropriately. æ’åºæœåŠ¡ä¸ä»…æ˜¯ç½‘ç»œçš„ç®¡ç†ç‚¹ï¼Œè¿˜æä¾›äº†å¦ä¸€ä¸ªå…³é”®åŠŸèƒ½â€“å®ƒæ˜¯äº¤æ˜“çš„åˆ†å‘ç‚¹ã€‚æ’åºæœåŠ¡æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶ä»åº”ç”¨ç¨‹åºä¸­æ”¶é›†è®¤å¯äº¤æ˜“å¹¶å°†å…¶æ’åºåˆ°äº¤æ˜“å—ä¸­ï¼Œéšååˆ†å‘ç»™é€šé“ä¸­çš„æ¯ä¸ªpeerèŠ‚ç‚¹ã€‚åœ¨æ¯ä¸ªæäº¤èŠ‚ç‚¹ä¸­ï¼Œäº¤æ˜“ä¼šè¢«è®°å½•ï¼ˆä¸è®ºæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼‰ï¼Œå¹¶åœ¨æœ¬åœ°æ›´æ–°è´¦æœ¬ã€‚ Notice how the ordering service node O4 performs a very different role for the channel C1 than it does for the network N. When acting at the channel level, O4â€™s role is to gather transactions and distribute blocks inside channel C1. It does this according to the policies defined in channel configuration CC1. In contrast, when acting at the network level, O4â€™s role is to provide a management point for network resources according to the policies defined in network configuration NC4. Notice again how these roles are defined by different policies within the channel and network configurations respectively. This should reinforce to you the importance of declarative policy based configuration in Hyperledger Fabric. Policies both define, and are used to control, the agreed behaviours by each and every member of a consortium. è¯·æ³¨æ„ï¼Œæ’åºæœåŠ¡èŠ‚ç‚¹O4å¦‚ä½•å¯¹é€šé“C1èµ·åˆ°ä¸å¯¹ç½‘ç»œNå®Œå…¨ä¸åŒçš„ä½œç”¨ã€‚åœ¨ä½œç”¨äºé€šé“çº§åˆ«æ—¶ï¼ŒO4çš„ä½œç”¨æ˜¯åœ¨é€šé“C1é‡Œé¢æ”¶é›†å’Œåˆ†å‘åŒºå—çš„ã€‚å®ƒæ ¹æ®é€šé“é…ç½®CC1ä¸­å®šä¹‰çš„ç­–ç•¥æ‰§è¡Œæ­¤æ“ä½œã€‚ä½œä¸ºå¯¹æ¯”ï¼Œåœ¨ç½‘ç»œçº§åˆ«æ‰§è¡Œæ“ä½œæ—¶ï¼ŒO4çš„ä½œç”¨æ˜¯æ ¹æ®ç½‘ç»œé…ç½®NC4ä¸­å®šä¹‰çš„ç­–ç•¥ä¸ºç½‘ç»œèµ„æºæä¾›ç®¡ç†ç‚¹ã€‚å†æ¬¡æ³¨æ„ï¼Œè¿™äº›è§’è‰²æ˜¯å¦‚ä½•åˆ†åˆ«ç”±é€šé“å’Œç½‘ç»œé…ç½®ä¸­çš„ä¸åŒç­–ç•¥å®šä¹‰çš„ã€‚è¿™åº”è¯¥å‘æ‚¨å¼ºè°ƒHyperledger Fabricä¸­åŸºäºå£°æ˜ç­–ç•¥çš„é…ç½®çš„é‡è¦æ€§ã€‚ç­–ç•¥æ—¢å®šä¹‰äº†è”ç›Ÿçš„æ¯ä¸ªæˆå‘˜ï¼Œåˆç”¨äºæ§åˆ¶è”ç›Ÿçš„æ¯ä¸ªæˆå‘˜çš„è¡Œä¸ºã€‚ We can see that the ordering service, like the other components in Hyperledger Fabric, is a fully de-centralized component. Whether acting as a network management point, or as a distributor of blocks in a channel, its nodes can be distributed as required throughout the multiple organizations in a network. æˆ‘ä»¬çœ‹åˆ°åƒHyperledger Fabricä¸­çš„å…¶ä»–ç»„ä»¶ä¸€æ ·ï¼Œæ’åºæœåŠ¡æ˜¯ä¸€ä¸ªå®Œå…¨çš„å»ä¸­å¿ƒåŒ–çš„ç»„ä»¶ã€‚æ— è®ºæ˜¯å……å½“ç½‘ç»œç®¡ç†ç‚¹ï¼Œè¿˜æ˜¯å……å½“é€šé“ä¸­çš„åŒºå—åˆ†é…å™¨ï¼Œå®ƒçš„èŠ‚ç‚¹å¯ä»¥æ ¹æ®éœ€è¦åˆ†å¸ƒåœ¨ç½‘ç»œä¸­çš„å¤šä¸ªç»„ç»‡ä¸­ã€‚ Changing policyï¼ˆä¿®æ”¹ç­–ç•¥ï¼‰ Throughout our exploration of the sample network, weâ€™ve seen the importance of the policies to control the behaviour of the actors in the system. Weâ€™ve only discussed a few of the available policies, but there are many that can be declaratively defined to control every aspect of behaviour. These individual policies are discussed elsewhere in the documentation. åœ¨æ•´ä¸ªç¤ºä¾‹ç½‘ç»œçš„æ¢ç´¢è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†æ§åˆ¶ç³»ç»Ÿä¸­å‚ä¸è€…è¡Œä¸ºçš„ç­–ç•¥çš„é‡è¦æ€§ã€‚æˆ‘ä»¬ä»…è®¨è®ºäº†ä¸€äº›å¯ç”¨çš„ç­–ç•¥ï¼Œä½†æ˜¯å¯ä»¥å£°æ˜æ€§åœ°å®šä¹‰è®¸å¤šç­–ç•¥æ¥æ§åˆ¶è¡Œä¸ºçš„å„ä¸ªæ–¹é¢ã€‚è¿™äº›å•ç‹¬çš„ç­–ç•¥åœ¨æ–‡æ¡£çš„å…¶ä»–åœ°æ–¹è¿›è¡Œäº†è®¨è®ºã€‚ Most importantly of all, Hyperledger Fabric provides a uniquely powerful policy that allows network and channel administrators to manage policy change itself! The underlying philosophy is that policy change is a constant, whether it occurs within or between organizations, or whether it is imposed by external regulators. For example, new organizations may join a channel, or existing organizations may have their permissions increased or decreased. Letâ€™s investigate a little more how change policy is implemented in Hyperledger Fabric. æœ€é‡è¦çš„æ˜¯ï¼ŒHyperledger Fabric æä¾›äº†ç‹¬ç‰¹è€Œå¼ºå¤§çš„ç­–ç•¥ï¼Œå…è®¸ç½‘ç»œå’Œé€šé“ç®¡ç†å‘˜è‡ªè¡Œç®¡ç†ç­–ç•¥æ›´æ”¹ï¼åŸºæœ¬ç†å¿µæ˜¯æ”¿ç­–å˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­ä¸æ–­çš„è¿‡ç¨‹ï¼Œä¸è®ºå®ƒæ˜¯åœ¨ç»„ç»‡å†…éƒ¨è¿˜æ˜¯ç»„ç»‡ä¹‹é—´å‘ç”Ÿï¼Œè¿˜æ˜¯ç”±å¤–éƒ¨ç›‘ç®¡æœºæ„å¼ºåŠ ã€‚ä¾‹å¦‚ï¼Œæ–°ç»„ç»‡å¯ä»¥åŠ å…¥é€šé“ï¼Œæˆ–è€…ç°æœ‰ç»„ç»‡çš„æƒé™å¯ä»¥å¢åŠ æˆ–å‡å°‘ã€‚è®©æˆ‘ä»¬ç ”ç©¶ä¸€ä¸‹Hyperledger Fabricä¸­æ›´æ”¹ç­–ç•¥çš„å®ç°æ–¹å¼ã€‚ The key point of understanding is that policy change is managed by a policy within the policy itself. The modification policy, or mod_policy for short, is a first class policy within a network or channel configuration that manages change. Letâ€™s give two brief examples of how weâ€™ve already used mod_policy to manage change in our network! ç†è§£çš„å…³é”®ç‚¹æ˜¯ï¼Œç­–ç•¥æ›´æ”¹ç”±ç­–ç•¥æœ¬èº«å†…çš„ç­–ç•¥æ¥ç®¡ç†ã€‚modification policyï¼ˆä¿®æ”¹ç­–ç•¥ï¼‰æˆ–è€…ç®€ç§°ä¸ºmod_policyï¼Œæ˜¯ä¸€ä¸ªåœ¨ç½‘ç»œæˆ–æ¸ é“é…ç½®ä¸­ç®¡ç†å˜æ›´çš„å¤´ç­‰ä»“çš„ç­–ç•¥ã€‚è®©æˆ‘ä»¬ä¸¾ä¸¤ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¯´æ˜æˆ‘ä»¬æ˜¯å¦‚ä½•ä½¿ç”¨mod_policyæ¥ç®¡ç†ç½‘ç»œä¸­çš„æ›´æ”¹çš„ï¼ The first example was when the network was initially set up. At this time, only organization R4 was allowed to manage the network. In practice, this was achieved by making R4 the only organization defined in the network configuration NC4 with permissions to network resources. Moreover, the mod_policy for NC4 only mentioned organization R4 â€“ only R4 was allowed to change this configuration. ç¬¬ä¸€ä¸ªç¤ºä¾‹æ˜¯æœ€åˆå»ºç«‹ç½‘ç»œæ—¶ã€‚æ­¤æ—¶ï¼Œåªæœ‰ç»„ç»‡R4å…è®¸ç®¡ç†ç½‘ç»œã€‚åœ¨å®è·µä¸­ï¼Œè¿™æ˜¯é€šè¿‡ä½¿R4æˆä¸ºç½‘ç»œé…ç½®NC4ä¸­å®šä¹‰çš„å”¯ä¸€æ‹¥æœ‰ç½‘ç»œèµ„æºæƒé™çš„ç»„ç»‡æ¥å®ç°çš„ã€‚æ­¤å¤–ï¼ŒNC4çš„mod_policyä»…æåŠç»„ç»‡R4 â€“ä»…å…è®¸R4æ›´æ”¹æ­¤é…ç½®ã€‚ We then evolved the network N to also allow organization R1 to administer the network. R4 did this by adding R1 to the policies for channel creation and consortium creation. Because of this change, R1 was able to define the consortia X1 and X2, and create the channels C1 and C2. R1 had equal administrative rights over the channel and consortium policies in the network configuration. ç„¶åï¼Œæˆ‘ä»¬å¯¹ç½‘ç»œNè¿›è¡Œäº†æ¼”è¿›ï¼Œä»¥ä¹Ÿå…è®¸ç»„ç»‡R1ç®¡ç†ç½‘ç»œã€‚R4é€šè¿‡å°†R1æ·»åŠ åˆ°ç”¨äºé€šé“åˆ›å»ºå’Œè”ç›Ÿåˆ›å»ºçš„ç­–ç•¥ä¸­æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚å› ä¸ºè¿™ä¸ªå˜æ›´ï¼ŒR1å¯ä»¥å®šä¹‰è”ç›ŸX1å’ŒX2ï¼Œå¹¶ä¸”åˆ›å»ºäº†é€šé“C1å’ŒC2ã€‚ç½‘ç»œé…ç½®ä¸­ç­–ç•¥æŒ‡æ˜R1å¯¹é€šé“å’Œè”ç›Ÿå…·æœ‰åŒç­‰çš„ç®¡ç†æƒé™ã€‚ R4 however, could grant even more power over the network configuration to R1! R4 could add R1 to the mod_policy such that R1 would be able to manage change of the network policy too. ä½†æ˜¯ï¼ŒR4å¯ä»¥é€šè¿‡ç½‘ç»œé…ç½®å‘R1æˆäºˆæ›´å¤šæƒåˆ©ã€‚R4å¯ä»¥å°†R1æ·»åŠ åˆ°mod_policyä¸­ï¼Œä»¥ä¾¿R1ä¹Ÿèƒ½å¤Ÿç®¡ç†ç½‘ç»œç­–ç•¥çš„æ›´æ”¹ã€‚ This second power is much more powerful than the first, because R1 now has full control over the network configuration NC4! This means that R1 can, in principle remove R4â€™s management rights from the network. In practice, R4 would configure the mod_policy such that R4 would need to also approve the change, or that all organizations in the mod_policy would have to approve the change. Thereâ€™s lots of flexibility to make the mod_policy as sophisticated as it needs to be to support whatever change process is required. ç¬¬äºŒä¸ªæƒåˆ©ç›¸æ¯”äºç¬¬ä¸€ä¸ªæ¥è¯´å¼ºå¤§çš„å¤šï¼Œå› ä¸ºR1ç°åœ¨å¯ä»¥å®Œå…¨æ§åˆ¶ç½‘ç»œé…ç½®NC4ï¼è¿™æ„å‘³ç€R1åŸåˆ™ä¸Šå¯ä»¥ä»ç½‘ç»œä¸­åˆ é™¤R4çš„ç®¡ç†æƒé™ã€‚åœ¨å®è·µä¸­ï¼ŒR4å°†æŠŠmod_policyé…ç½®æˆä¸ºR4éœ€è¦æ‰¹å‡†é…ç½®æ›´æ”¹ï¼Œæˆ–è€…mod_policyä¸­çš„æ‰€æœ‰ç»„ç»‡éƒ½å¿…é¡»æ‰¹å‡†æ›´æ”¹ã€‚æœ‰è¶³å¤Ÿçš„çµæ´»æ€§å¯ä»¥ä½¿mod_policyå¤æ‚åˆ°å¯ä»¥æ”¯æŒæ‰€éœ€çš„ä»»ä½•æ›´æ”¹è¿‡ç¨‹ã€‚ This is mod_policy at work â€“ it has allowed the graceful evolution of a basic configuration into a sophisticated one. All the time this has occurred with the agreement of all organization involved. The mod_policy behaves like every other policy inside a network or channel configuration; it defines a set of organizations that are allowed to change the mod_policy itself. è¿™å°±æ˜¯mod_policyçš„ä½œç”¨ï¼Œå®ƒä½¿åŸºæœ¬é…ç½®å¯ä»¥ä¼˜é›…åœ°æ¼”å˜ä¸ºå¤æ‚çš„é…ç½®ã€‚åœ¨æ‰€æœ‰ç›¸å…³ç»„ç»‡è¾¾æˆä¸€è‡´ä¹‹åï¼Œè¿™ç§æƒ…å†µä¸€ç›´å­˜åœ¨ã€‚mod_policyçš„è¡Œä¸ºä¸ç½‘ç»œæˆ–é€šé“é…ç½®ä¸­çš„æ‰€æœ‰å…¶ä»–ç­–ç•¥ç›¸åŒï¼›å®ƒå®šä¹‰äº†ä¸€ç»„å…è®¸æ›´æ”¹mod_policyæœ¬èº«çš„ç»„ç»‡ã€‚ Weâ€™ve only scratched the surface of the power of policies and mod_policy in particular in this subsection. It is discussed at much more length in the policy topic, but for now letâ€™s return to our finished network! åœ¨æœ¬å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»…ä»‹ç»äº†ç­–ç•¥å’Œmod_policyçš„åŠŸèƒ½ã€‚åœ¨ç­–ç•¥ä¸»é¢˜ä¸­å°†å¯¹å®ƒè¿›è¡Œæ›´è¯¦ç»†çš„è®¨è®ºï¼Œä½†ç°åœ¨è®©æˆ‘ä»¬å›åˆ°å®Œæˆçš„ç½‘ç»œä¸­ï¼ Network fully formedï¼ˆç½‘ç»œå…¨é¢å½¢æˆï¼‰ Letâ€™s recap what our network looks like using a consistent visual vocabulary. Weâ€™ve re-organized it slightly using our more compact visual syntax, because it better accommodates larger topologies: è®©æˆ‘ä»¬ä½¿ç”¨ä¸€è‡´çš„è§†è§‰è¯æ±‡æ¥å›é¡¾ä¸€ä¸‹æˆ‘ä»¬çš„ç½‘ç»œã€‚æˆ‘ä»¬ä½¿ç”¨æ›´ç´§å‡‘çš„è§†è§‰è¯­æ³•å¯¹å…¶è¿›è¡Œäº†ç¨å¾®çš„é‡ç»„ï¼Œå› ä¸ºå®ƒå¯ä»¥æ›´å¥½åœ°é€‚åº”æ›´å¤§çš„æ‹“æ‰‘ï¼š In this diagram we see that the Fabric blockchain network consists of two application channels and one ordering channel. The organizations R1 and R4 are responsible for the ordering channel, R1 and R2 are responsible for the blue application channel while R2 and R3 are responsible for the red application channel. Client applications A1 is an element of organization R1, and CA1 is itâ€™s certificate authority. Note that peer P2 of organization R2 can use the communication facilities of the blue and the red application channel. Each application channel has its own channel configuration, in this case CC1 and CC2. The channel configuration of the system channel is part of the network configuration, NC4. åœ¨æˆ‘ä»¬çœ‹åˆ°çš„è¿™ä¸ªå›¾ç‰‡ä¸­ï¼ŒFabircåŒºå—é“¾ç½‘ç»œåŒ…å«ä¸¤ä¸ªåº”ç”¨ç¨‹åºé€šé“å’Œä¸€ä¸ªæ’åºé€šé“ã€‚ç»„ç»‡R1å’ŒR4è´Ÿè´£æ’åºé€šé“ï¼ŒR1å’ŒR2è´Ÿè´£è“è‰²åº”ç”¨ç¨‹åºé€šé“ï¼Œè€ŒR2å’ŒR3è´Ÿè´£çº¢è‰²åº”ç”¨ç¨‹åºé€šé“ã€‚å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºA1æ˜¯ç»„ç»‡R1çš„å…ƒç´ ï¼Œè€ŒCA1æ˜¯ç»„ç»‡çš„è¯ä¹¦é¢å‘æœºæ„ã€‚æ³¨æ„å±äºç»„ç»‡R2çš„PeerèŠ‚ç‚¹P2å¯ä»¥åŒæ—¶ä½¿ç”¨çº¢è‰²å’Œè“è‰²çš„åº”ç”¨ç¨‹åºé€šé“çš„é€šä¿¡è®¾æ–½ã€‚æ¯ä¸ªåº”ç”¨ç¨‹åºé€šé“éƒ½æœ‰è‡ªå·±çš„é€šé“é…ç½®ï¼Œä¾‹å¦‚CC1å’ŒCC2ã€‚ç³»ç»Ÿé€šé“çš„é€šé“é…ç½®æ˜¯ç½‘ç»œé…ç½®ï¼ˆNC4ï¼‰çš„ä¸€éƒ¨åˆ†ã€‚ Weâ€™re at the end of our conceptual journey to build a sample Hyperledger Fabric blockchain network. Weâ€™ve created a four organization network with two channels and three peer nodes, with two smart contracts and an ordering service. It is supported by four certificate authorities. It provides ledger and smart contract services to three client applications, who can interact with it via the two channels. Take a moment to look through the details of the network in the diagram, and feel free to read back through the topic to reinforce your knowledge, or go to a more detailed topic. æˆ‘ä»¬æ„å»ºç®€å•çš„Hyperledger FabricåŒºå—é“¾ç½‘ç»œçš„æ¦‚å¿µä¹‹æ—…å·²ç»“æŸã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªé€šé“å’Œä¸‰ä¸ªpeerèŠ‚ç‚¹ï¼Œä¸¤ä¸ªæ™ºèƒ½åˆçº¦å’Œä¸€ä¸ªæ’åºæœåŠ¡çš„å››ä¸ªç»„ç»‡çš„ç½‘ç»œã€‚è¿™ä¸ªç½‘ç»œç”±å››ä¸ªè¯ä¹¦é¢å‘æœºæ„æ”¯æŒã€‚è¿™ä¸ªç½‘ç»œå¯¹ä¸‰ä¸ªå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæä¾›è´¦æœ¬å’Œæ™ºèƒ½åˆçº¦æœåŠ¡ï¼Œä»–ä»¬å¯ä»¥é€šè¿‡ä¸¤ä¸ªé€šé“ä¸ä¹‹äº¤äº’ã€‚èŠ±ä¸€ç‚¹æ—¶é—´æµè§ˆå›¾ä¸­çš„ç½‘ç»œè¯¦ç»†ä¿¡æ¯ï¼Œå¹¶éšæ—¶é˜…è¯»æœ¬ä¸»é¢˜ä»¥å¢å¼ºæ‚¨çš„çŸ¥è¯†ï¼Œæˆ–è€…è½¬åˆ°æ›´è¯¦ç»†çš„ä¸»é¢˜ã€‚ Summary of network componentsï¼ˆç½‘ç»œç»„ä»¶çš„æ‘˜è¦ï¼‰ Hereâ€™s a quick summary of the network components weâ€™ve discussedï¼ˆä»¥ä¸‹æ˜¯æˆ‘ä»¬è®¨è®ºè¿‡çš„ç½‘ç»œç»„ä»¶çš„ç®€è¦æ‘˜è¦ï¼‰ï¼š Ledger. One per channel. Comprised of the Blockchain and the World stateï¼ˆæ¯ä¸ªé€šé“ä¸€ä¸ªã€‚ç”±åŒºå—é“¾å’Œä¸–ç•ŒçŠ¶æ€ç»„æˆï¼‰ Smart contract (aka chaincode)ï¼ˆAlso Known Asæ™ºèƒ½åˆçº¦ï¼‰ Peer nodesï¼ˆpeerèŠ‚ç‚¹ï¼‰ Ordering serviceï¼ˆæ’åºæœåŠ¡ï¼‰ Channelï¼ˆé€šé“ï¼‰ Certificate Authorityï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰ Network summaryï¼ˆç½‘ç»œæ€»ç»“ï¼‰ In this topic, weâ€™ve seen how different organizations share their infrastructure to provide an integrated Hyperledger Fabric blockchain network. Weâ€™ve seen how the collective infrastructure can be organized into channels that provide private communications mechanisms that are independently managed. Weâ€™ve seen how actors such as client applications, administrators, peers and orderers are identified as being from different organizations by their use of certificates from their respective certificate authorities. And in turn, weâ€™ve seen the importance of policy to define the agreed permissions that these organizational actors have over network and channel resources. åœ¨æœ¬ä¸»é¢˜ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä¸åŒçš„ç»„ç»‡å¦‚ä½•å…±äº«å…¶åŸºç¡€æ¶æ„ä»¥æä¾›é›†æˆHyperledger FabricåŒºå—é“¾ç½‘ç»œã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•å°†é›†ä½“åŸºç¡€ç»“æ„ç»„ç»‡ä¸ºæä¾›ç‹¬ç«‹ç®¡ç†çš„ç§æœ‰é€šä¿¡æœºåˆ¶çš„é€šé“ã€‚æˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä½•é€šè¿‡ä½¿ç”¨æ¥è‡ªå„è‡ªè¯ä¹¦é¢å‘æœºæ„çš„è¯ä¹¦å°†è¯¸å¦‚å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œç®¡ç†å‘˜ï¼ŒpeerèŠ‚ç‚¹å’Œæ’åºè€…ä¹‹ç±»çš„å‚ä¸è€…è¯†åˆ«ä¸ºæ¥è‡ªä¸åŒç»„ç»‡ã€‚åè¿‡æ¥ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å®šä¹‰è¿™äº›ç»„ç»‡å‚ä¸è€…å¯¹ç½‘ç»œå’Œé€šé“èµ„æºæ‹¥æœ‰çš„åŒæ„æƒé™çš„æ”¿ç­–çš„é‡è¦æ€§ã€‚","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"Key Concepts","slug":"åŒºå—é“¾/Hyperledger-Fabric/Key-Concepts","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/Key-Concepts/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"network","slug":"network","permalink":"https://guozhe001.github.io/tags/network/"}]},{"title":"Hyperledger-Fabricå¼€å‘ç¯å¢ƒå‡†å¤‡","slug":"blockchain/fabric/Hyperledger-Fabricå¼€å‘ç¯å¢ƒå‡†å¤‡","date":"2021-04-01T10:18:21.471Z","updated":"2021-04-01T10:18:21.471Z","comments":true,"path":"2021/04/01/blockchain/fabric/Hyperledger-Fabricå¼€å‘ç¯å¢ƒå‡†å¤‡/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/Hyperledger-Fabric%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/","excerpt":"","text":"å®‰è£…homebrew æŸ¥çœ‹æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™é…ç½®å›½å†…é•œåƒåŠ å¿«å®‰è£…è½¯ä»¶çš„é€Ÿåº¦ã€‚ å®‰è£…Fabricçš„ç¯å¢ƒä¾èµ– ä½¿ç”¨brewå®‰è£…gitã€goã€jqã€softhsmã€docker: 12brew install git go jq softhsmbrew cask install --appdir=&quot;/Applications&quot; docker æˆ‘åœ¨å®‰è£…çš„æ—¶å€™å› ä¸ºGreat Wallçš„åŸå› æœ‰ä¸ªgoçš„å·¥å…·æ²¡æœ‰ä¸‹è½½ä¸‹æ¥ï¼Œè®°å½•ä¸€ä¸‹ 123Failure while executing; `git clone --branch release-branch.go1.15 -c advice.detachedHead=false https://go.googlesource.com/tools.git /Users/apple/Library/Caches/Homebrew/go--gotools--git` exited with 128. Here&#x27;s the output:Cloning into &#x27;/Users/apple/Library/Caches/Homebrew/go--gotools--git&#x27;...fatal: unable to access &#x27;https://go.googlesource.com/tools.git/&#x27;: Failed to connect to go.googlesource.com port 443: Operation timed out fabricæºç ä¸‹è½½ ä¸ºäº†åŠ é€Ÿï¼Œåœ¨giteeä¸Šå¯¼å…¥é¡¹ç›®ï¼šhttps://github.com/hyperledger/fabricç„¶åcloneåˆ°æœ¬åœ°ã€‚ å®‰è£…å¼€å‘å·¥å…· 1ã€åœ¨fabricç›®å½•ä¸‹ï¼Œè¿è¡Œå‘½ä»¤ï¼š 1make gotools 2ã€å®‰è£…å®Œæˆå·¥å…·ä¹‹åï¼ŒéªŒè¯ç¯å¢ƒæ˜¯å¦æ­£å¸¸ 12make basic-checks integration-test-prereqsginkgo -r ./integration/nwo æˆ‘çš„ç¬¬äºŒéƒ¨æµ‹è¯•æ²¡æœ‰é€šè¿‡ï¼Œè®°å½•å¦‚ä¸‹ï¼š 12345678910111213141516171819202122(base) apple@WHOAMIdeMacBook-Pro:~/code/open-source/blockchain/hyperledger/fabric$ ginkgo -r ./integration/nwoRunning Suite: New World Order Suite====================================Random Seed: 1607936946Will run 4 of 4 specsFailure [0.011 seconds][BeforeSuite] BeforeSuite/Users/apple/code/open-source/blockchain/hyperledger/fabric/integration/nwo/nwo_suite_test.go:29 missing required image: hyperledger/fabric-ccenv:latest /Users/apple/code/open-source/blockchain/hyperledger/fabric/integration/nwo/buildserver.go:56------------------------------Ran 4 of 0 Specs in 0.512 secondsFAIL! -- 0 Passed | 4 Failed | 0 Pending | 0 Skipped--- FAIL: TestNewWorldOrder (0.51s)FAILGinkgo ran 1 suite in 3.561084735sTest Suite Failed 3ã€ä»è„šæœ¬è¿è¡Œä¸­çš„ä¿¡æ¯å¯ä»¥ç›´åˆ°ä¾èµ–äº†å“ªäº›è½¯ä»¶ï¼š library/alpine:3.12 hyperledger/fabric-baseos golang:1.14.12-alpine3.12 hyperledger/fabric-ccenv confluentinc/cp-zookeeper:5.3.1 confluentinc/cp-kafka:5.3.1 library/couchdb:3.1.1 5.æ·»åŠ æ›´å¤šçš„ä¾èµ– 123456# æ·»åŠ  gnu-tarbrew install gnu-tar --with-default-names# æ·»åŠ  libtoolbrew install libtool# ç¼–è¯‘ configtxgenmake configtxgen","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"}]},{"title":"Fabric chaincode lifecycle","slug":"blockchain/fabric/å…³é”®æ¦‚å¿µ/Fabric chaincode lifecycle","date":"2021-04-01T10:18:21.471Z","updated":"2021-04-01T10:18:21.473Z","comments":true,"path":"2021/04/01/blockchain/fabric/å…³é”®æ¦‚å¿µ/Fabric chaincode lifecycle/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5/Fabric%20chaincode%20lifecycle/","excerpt":"","text":"å®˜æ–¹æ–‡æ¡£ï¼šFabric chaincode lifecycle Install and define a chaincode Package the chaincode: This step can be completed by one organization or by each organization. Install the chaincode on your peers: Every organization that will use the chaincode to endorse a transaction or query the ledger needs to complete this step. Approve a chaincode definition for your organization: Every organization that will use the chaincode needs to complete this step. The chaincode definition needs to be approved by a sufficient number of organizations to satisfy the channelâ€™s LifecycleEndorsment policy (a majority, by default) before the chaincode can be started on the channel. Commit the chaincode definition to the channel: The commit transaction needs to be submitted by one organization once the required number of organizations on the channel have approved. The submitter first collects endorsements from enough peers of the organizations that have approved, and then submits the transaction to commit the chaincode definition. Upgrade a chaincode Repackage the chaincode: You only need to complete this step if you are upgrading the chaincode binaries. Org1 and Org2 upgrade the chaincode binaries and repackage the chaincode. Both organizations use a different package label. Install the new chaincode package on your peers: Once again, you only need to complete this step if you are upgrading the chaincode binaries. Installing the new chaincode package will generate a package ID, which you will need to pass to the new chaincode definition. You also need to change the chaincode version, which is used by the lifecycle process to track if the chaincode binaries have been upgraded. Org1 and Org2 install the new package on their peers. The installation creates a new packageID. Approve a new chaincode definition: If you are upgrading the chaincode binaries, you need to update the chaincode version and the package ID in the chaincode definition. You can also update your chaincode endorsement policy without having to repackage your chaincode binaries. Channel members simply need to approve a definition with the new policy. The new definition needs to increment the sequence variable in the definition by one. Organization administrators from Org1 and Org2 approve the new chaincode definition for their respective organizations. The new definition references the new packageID and changes the chaincode version. Since this is the first update of the chaincode, the sequence is incremented from one to two. Commit the definition to the channel: When a sufficient number of channel members have approved the new chaincode definition, one organization can commit the new definition to upgrade the chaincode definition to the channel. There is no separate upgrade command as part of the lifecycle process. An organization administrator from Org1 or Org2 commits the new chaincode definition to the channel. Organizations install different chaincode packages Each organization can use a different packageID when they approve a chaincode definition. This allows channel members to install different chaincode binaries that use the same endorsement policy and read and write to data in the same chaincode namespace. æ¯ä¸ªç»„ç»‡åœ¨æ‰¹å‡†é“¾ç å®šä¹‰æ—¶éƒ½å¯ä»¥ä½¿ç”¨ä¸åŒçš„packageIDã€‚è¿™å…è®¸é€šé“æˆå‘˜å®‰è£…ä½¿ç”¨ç›¸åŒèƒŒä¹¦ç­–ç•¥çš„ä¸åŒé“¾ä»£ç äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶åœ¨åŒä¸€é“¾ç åç§°ç©ºé—´ä¸­è¯»å–å’Œå†™å…¥æ•°æ®ã€‚ Organizations can use this capability to install smart contracts that contain business logic that is specific to their organization. Each organizationâ€™s smart contract could contain additional validation that the organization requires before their peers endorse a transaction. Each organization can also write code that helps integrate the smart contract with data from their existing systems. ç»„ç»‡å¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½æ¥å®‰è£…åŒ…å«å…¶ç»„ç»‡çš„ç‰¹æ®Šçš„ä¸šåŠ¡é€»è¾‘çš„æ™ºèƒ½åˆçº¦ã€‚æ¯ä¸ªç»„ç»‡çš„æ™ºèƒ½åˆçº¦éƒ½å¯ä»¥åŒ…å«ç»„ç»‡åœ¨å…¶peerè®¤å¯äº¤æ˜“ä¹‹å‰æ‰€éœ€çš„å…¶ä»–éªŒè¯ã€‚æ¯ä¸ªç»„ç»‡è¿˜å¯ä»¥ç¼–å†™ä»£ç å°†æ™ºèƒ½åˆçº¦ä¸ä»–ä»¬ç°æœ‰ç³»ç»Ÿä¸­çš„æ•°æ®é›†æˆåœ¨ä¸€èµ·ã€‚ Org1 and Org2 each install versions of the MYCC chaincode containing business logic that is specific to their organization. Creating multiple chaincodes using one package You can use one chaincode package to create multiple chaincode instances on a channel by approving and committing multiple chaincode definitions. Each definition needs to specify a different chaincode name. This allows you to run multiple instances of a smart contract on a channel, but have the contract be subject to different endorsement policies. æ‚¨å¯ä»¥é€šè¿‡æ‰¹å‡†å¹¶æäº¤å¤šä¸ªé“¾ç å®šä¹‰ï¼Œä½¿ç”¨ä¸€ä¸ªé“¾ç åŒ…åœ¨ä¸€ä¸ªé€šé“ä¸Šåˆ›å»ºå¤šä¸ªé“¾ç å®ä¾‹ã€‚æ¯ä¸ªå®šä¹‰éƒ½éœ€è¦æŒ‡å®šä¸€ä¸ªä¸åŒçš„é“¾ç åç§°ã€‚è¿™ä½¿æ‚¨å¯ä»¥åœ¨ä¸€ä¸ªé€šé“ä¸Šè¿è¡Œæ™ºèƒ½åˆçº¦çš„å¤šä¸ªå®ä¾‹ï¼Œä½†æ˜¯è¦è®©åˆçº¦éµå¾ªä¸åŒçš„èƒŒä¹¦ç­–ç•¥ã€‚ Org1 and Org2 use the MYCC_1 chaincode package to approve and commit two different chaincode definitions. As a result, both peers have two chaincode containers running on their peers. MYCC1 has an endorsement policy of 1 out of 2, while MYCC2 has an endorsement policy of 2 out of 2. ä¸ªäººç–‘é—®ï¼šéƒ¨ç½²ç›¸çš„é“¾ç ï¼Œä½¿ç”¨ä¸åŒçš„èƒŒä¹¦ç­–ç•¥ï¼Œè¿™ä¹ˆåšæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ Migrate to the new Fabric lifecycle For information about migrating to the new lifecycle, check out Considerations for getting to v2.0. If you need to update your channel configurations to enable the new lifecycle, check out Enabling the new chaincode lifecycle. More information You can watch video below to learn more about the motivation of the new Fabric chaincode lifecycle and how it is implemented.","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"Key Concepts","slug":"åŒºå—é“¾/Hyperledger-Fabric/Key-Concepts","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/Key-Concepts/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"Fabric chaincode lifecycle","slug":"Fabric-chaincode-lifecycle","permalink":"https://guozhe001.github.io/tags/Fabric-chaincode-lifecycle/"}]},{"title":"Hyberledger-Fabricå­¦ä¹ æ€»ç»“","slug":"blockchain/fabric/Hyberledger-Fabricå­¦ä¹ æ€»ç»“","date":"2021-04-01T10:18:21.470Z","updated":"2021-04-01T10:18:21.471Z","comments":true,"path":"2021/04/01/blockchain/fabric/Hyberledger-Fabricå­¦ä¹ æ€»ç»“/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/Hyberledger-Fabric%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/","excerpt":"","text":"Hyperledger-Fabricå¼€å‘ç¯å¢ƒå‡†å¤‡ Fabricæµ‹è¯•ç½‘ç»œä½¿ç”¨ å°†æ™ºèƒ½åˆçº¦éƒ¨ç½²åˆ°é€šé“ Frbircæµ‹è¯•ç¯å¢ƒé”™è¯¯è®°å½• ç¼–å†™æ‚¨çš„ç¬¬ä¸€ä¸ªChaincode [é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric](file://é€šè¿‡ä¾›åº”é“¾é‡‘èç»ƒä¹ Fabric/summary.md) [åœ¨Fabricä¸­äº¤æ˜“å—ä¿æŠ¤çš„èµ„äº§](file://åœ¨Fabricä¸­äº¤æ˜“å—ä¿æŠ¤çš„èµ„äº§.md) åœ¨Fabricä¸­ä½¿ç”¨ç§æœ‰æ•°æ® [èƒŒä¹¦ç­–ç•¥](file://Endorsement policiesèƒŒä¹¦ç­–ç•¥.md) Fabricæ™ºèƒ½åˆçº¦APIå­¦ä¹  èµ„æ–™æ•´ç† hyperledgerå®˜ç½‘ hyperledgerä¸­æ–‡æ–‡æ¡£ hyperladgerè‹±æ–‡æ–‡æ¡£","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"}]},{"title":"Hyperledger-Frbircæµ‹è¯•ç¯å¢ƒé”™è¯¯è®°å½•","slug":"blockchain/fabric/Frbircæµ‹è¯•ç¯å¢ƒé”™è¯¯è®°å½•","date":"2021-04-01T10:18:21.469Z","updated":"2021-04-01T10:18:21.470Z","comments":true,"path":"2021/04/01/blockchain/fabric/Frbircæµ‹è¯•ç¯å¢ƒé”™è¯¯è®°å½•/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/Frbirc%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95/","excerpt":"","text":"ç½‘ç»œ æµ‹è¯•ç½‘ç»œå…¶ä¸­ä¸€ä¸ªç»„ç»‡çš„peeræ— æ³•å¯åŠ¨ é”™è¯¯æè¿° åœ¨è¿è¡Œ./network.sh upæ—¶ï¼Œåªå¯åŠ¨äº†ä¸€ä¸ªç»„ç»‡çš„peerï¼Œå¦ä¸€ä¸ªæ— æ³•å¯åŠ¨ã€‚å¯¼è‡´åœ¨æ–°å»ºchannelæ—¶æŠ¥é”™å¦‚ä¸‹ï¼š 1234562021-01-04 10:49:22.575 CST [comm.tls] ClientHandshake -&gt; ERRO 001 Client TLS handshake failed after 2.157125ms with error: EOF remoteaddress=[::1]:70512021-01-04 10:49:23.582 CST [comm.tls] ClientHandshake -&gt; ERRO 002 Client TLS handshake failed after 3.12316ms with error: EOF remoteaddress=[::1]:70512021-01-04 10:49:25.157 CST [comm.tls] ClientHandshake -&gt; ERRO 003 Client TLS handshake failed after 4.29759ms with error: EOF remoteaddress=[::1]:7051Error: error getting endorser client for channel: endorser client failed to connect to localhost:7051: failed to create new connection: context deadline exceededAfter 5 attempts, peer0.org1 has failed to join channel &#x27;mychannel&#x27;Create channel failed å› ä¸ºè¿™ä¸ªé—®é¢˜å¯¼è‡´çš„é“¾ç æ— æ³•éƒ¨ç½²ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051(base) apple@WHOAMIdeMacBook-Pro:~/code/open-source/blockchain/hyperledger/fabric-samples/test-network$ ./network.sh deployCCdeploying chaincode on channel &#x27;mychannel&#x27;executing with the following- CHANNEL_NAME: mychannel- CC_NAME: basic- CC_SRC_PATH: NA- CC_SRC_LANGUAGE: go- CC_VERSION: 1.0- CC_SEQUENCE: 1- CC_END_POLICY: NA- CC_COLL_CONFIG: NA- CC_INIT_FCN: NA- DELAY: 3- MAX_RETRY: 5- VERBOSE: falseDetermining the path to the chaincodeasset-transfer-basicVendoring Go dependencies at ../asset-transfer-basic/chaincode-go/~/code/open-source/blockchain/hyperledger/fabric-samples/asset-transfer-basic/chaincode-go ~/code/open-source/blockchain/hyperledger/fabric-samples/test-network~/code/open-source/blockchain/hyperledger/fabric-samples/test-networkFinished vendoring Go dependencies+ peer lifecycle chaincode package basic.tar.gz --path ../asset-transfer-basic/chaincode-go/ --lang golang --label basic_1.0+ res=0Chaincode is packagedInstalling chaincode on peer0.org1...Using organization 1+ peer lifecycle chaincode install basic.tar.gz+ res=1Error: failed to retrieve endorser client for install: endorser client failed to connect to localhost:7051: failed to create new connection: context deadline exceededUsage: peer lifecycle chaincode install [flags]Flags: --connectionProfile string The fully qualified path to the connection profile that provides the necessary connection information for the network. Note: currently only supported for providing peer connection information -h, --help help for install --peerAddresses stringArray The addresses of the peers to connect to --tlsRootCertFiles stringArray If TLS is enabled, the paths to the TLS root cert files of the peers to connect to. The order and number of certs specified should match the --peerAddresses flagGlobal Flags: --cafile string Path to file containing PEM-encoded trusted certificate(s) for the ordering endpoint --certfile string Path to file containing PEM-encoded X509 public key to use for mutual TLS communication with the orderer endpoint --clientauth Use mutual TLS when communicating with the orderer endpoint --connTimeout duration Timeout for client to connect (default 3s) --keyfile string Path to file containing PEM-encoded private key to use for mutual TLS communication with the orderer endpoint -o, --orderer string Ordering service endpoint --ordererTLSHostnameOverride string The hostname override to use when validating the TLS connection to the orderer --tls Use TLS when communicating with the orderer endpoint --tlsHandshakeTimeShift duration The amount of time to shift backwards for certificate expiration checks during TLS handshakes with the orderer endpointChaincode installation on peer0.org1 has failedDeploying chaincode failed é”™è¯¯åŸå› å’Œè§£å†³æ–¹æ¡ˆ å¯èƒ½æ˜¯å› ä¸ºbinå’Œconfigç›®å½•ä¸­çš„ç‰ˆæœ¬ä¸å¯åŠ¨æ—¶æŒ‡å®šçš„ç‰ˆæœ¬ä¸ä¸€è‡´ï¼Œ./network.sh upå‘½ä»¤ä½¿ç”¨çš„åº”è¯¥æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼Œç¡®è®¤binå’Œconfigç›®å½•ä¸‹çš„ä¹Ÿåº”è¯¥æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ã€‚å¯ä»¥é‡æ–°æ›¿æ¢è¿™ä¸¤ä¸ªç›®å½•çš„ä»£ç ã€‚ é“¾ç  è°ƒç”¨é“¾ç  1peer chaincode invoke -o localhost:8050 --ordererTLSHostnameOverride orderer.supply.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem -C coreandfirstchannel -n supply --peerAddresses localhost:8051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/core.supply.com/peers/peer0.core.supply.com/tls/ca.crt --peerAddresses localhost:8053 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/f1.supply.com/peers/peer0.f1.supply.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;IssueVoucher&quot;,&quot;Args&quot;:[&quot;asset001&quot;, &quot;100&quot;, &quot;ä¸€çº§ä¾›åº”å•†&quot;]&#125;&#x27; æˆåŠŸä¿¡æ¯å¦‚ä¸‹ï¼š 12020-12-28 18:37:54.285 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200 é”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š 1Error: could not assemble transaction: proposal response was not successful, error code 500, msg Incorrect number of params. Expected 2, received 1 - proposal response: version:1 response:&lt;status:200 &gt; payload:&quot;\\n \\177\\017\\350[\\344G6\\010V\\331\\332\\377\\354\\216&amp;\\035\\317&amp;\\251[N`\\023\\036\\033\\237\\237A\\005\\3670\\260\\022\\266\\002\\n\\237\\002\\0227\\n\\n_lifecycle\\022)\\n&#x27;\\n!namespaces/fields/supply/Sequence\\022\\002\\010\\016\\022\\343\\001\\n\\006supply\\022\\330\\001\\n\\003\\n\\0011\\032\\320\\001\\n\\0011\\032\\312\\001&#123;\\&quot;ID\\&quot;:\\&quot;1\\&quot;,\\&quot;issuer\\&quot;:\\&quot;\\346\\240\\270\\345\\277\\203\\344\\274\\201\\344\\270\\232\\&quot;,\\&quot;owner\\&quot;:\\&quot;\\346\\240\\270\\345\\277\\203\\344\\274\\201\\344\\270\\232\\&quot;,\\&quot;amount\\&quot;:100,\\&quot;createDate\\&quot;:\\&quot;2020-12-28T10:02:30.578872398Z\\&quot;,\\&quot;endDate\\&quot;:\\&quot;2021-06-28T10:02:30.578872527Z\\&quot;,\\&quot;contractHash\\&quot;:\\&quot;test\\&quot;,\\&quot;invoiceHash\\&quot;:\\&quot;test\\&quot;&#125;\\032\\003\\010\\310\\001\\&quot;\\r\\022\\006supply\\032\\0033.0&quot; endorsement:&lt;endorser:&quot;\\n\\016GylCoreOrg1MSP\\022\\222\\006-----BEGIN CERTIFICATE-----\\nMIICFjCCAbygAwIBAgIQU43L5gjtXO+uCpRP2jG2AjAKBggqhkjOPQQDAjBxMQsw\\nCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMNU2FuIEZy\\nYW5jaXNjbzEYMBYGA1UEChMPY29yZS5zdXBwbHkuY29tMRswGQYDVQQDExJjYS5j\\nb3JlLnN1cHBseS5jb20wHhcNMjAxMjI1MDkxNzAwWhcNMzAxMjIzMDkxNzAwWjBa\\nMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMNU2Fu\\nIEZyYW5jaXNjbzEeMBwGA1UEAxMVcGVlcjAuY29yZS5zdXBwbHkuY29tMFkwEwYH\\nKoZIzj0CAQYIKoZIzj0DAQcDQgAErf3R+7XpNQpmTsMO+iM4WS7IrOoafiPbAS7Q\\nbuFFR3Qs4riIczgSmjh9rOA6I1q2q0CstLhfWDbqpf+8fXPUlKNNMEswDgYDVR0P\\nAQH/BAQDAgeAMAwGA1UdEwEB/wQCMAAwKwYDVR0jBCQwIoAguznqsTisa64dNvOR\\nvPwP0KGklWohNpbSe7VgIghx4L8wCgYIKoZIzj0EAwIDSAAwRQIhALIw1VMzezCg\\n9LONbO4+V+weY42HQLbShkTP/gCFnGRYAiARyLLSDJIC2wwzSvOHNdm+aDRtbqGC\\nNJenP9hmEbYsTw==\\n-----END CERTIFICATE-----\\n&quot; signature:&quot;0E\\002!\\000\\251\\370K6S\\020\\373\\242\\321\\000\\211\\312\\0001\\333\\365&gt;\\314\\324\\231\\020&gt;u;+\\243\\303dD\\023\\221\\237\\002 z \\224\\236R\\355Z\\251\\202\\363\\035\\304\\365\\212\\277\\235\\375?\\376\\030\\371\\236\\220\\354iG6\\244\\334M\\315\\331&quot; &gt; åŸå› æ˜¯å› ä¸ºä¸‹å›¾ï¼Œåªæœ‰ä¸€ä¸ªç»„ç»‡çš„é“¾ç æ›´æ–°åˆ°äº†æœ€æ–°çš„ç‰ˆæœ¬ã€‚ ![æˆªå±2020-12-28 18.03.06](/Users/apple/Desktop/æˆªå±2020-12-28 18.03.06.png) **è§£å†³æ–¹æ¡ˆï¼š**åŸå› æ˜¯å› ä¸ºè®¾ç½®ç¯å¢ƒå˜é‡CC_PACKAGE_IDæ—¶åªè®¾ç½®äº†ä¸€ä¸ªç»„ç»‡çš„peerï¼Œå¯¼è‡´æ—§çš„ç¯å¢ƒå˜é‡è¿˜åœ¨ç”Ÿæ•ˆï¼Œé‡æ–°æ“ä½œä¸€éé—®é¢˜è§£å†³ã€‚ è°ƒç”¨chaincodeæ—¶æŠ¥é”™VSCC errorå¦‚ä¸‹ï¼š 12342021-01-07 06:44:40.479 UTC [vscc] Validate -&gt; ERRO 62f VSCC error: stateBasedValidator.Validate failed, err validation of endorsement policy for chaincode secured_supply in tx 12:0 failed: implicit policy evaluation failed - 1 sub-policies were satisfied, but this policy requires 3 of the &#x27;Endorsement&#x27; sub-policies to be satisfied2021-01-07 06:44:40.479 UTC [committer.txvalidator] validateTx -&gt; ERRO 630 Dispatch for transaction txId = 101fe5e0aaaafbabcf31a5ce66fa48b92ab834456ba73cdb29730679bd637847 returned error: validation of endorsement policy for chaincode secured_supply in tx 12:0 failed: implicit policy evaluation failed - 1 sub-policies were satisfied, but this policy requires 3 of the &#x27;Endorsement&#x27; sub-policies to be satisfied2021-01-07 06:44:40.479 UTC [committer.txvalidator] Validate -&gt; INFO 631 [alljoinchannel] Validated block [12] in 2ms é”™è¯¯åŸå› ï¼š èƒŒæ™¯æ˜¯æˆ‘çš„æµ‹è¯•ç¯å¢ƒæœ‰å››ä¸ªç»„ç»‡å®‰è£…äº†ç›¸åŒçš„é“¾ç ï¼Œé“¾ç çš„èƒŒä¹¦ç­–ç•¥æ˜¯é»˜è®¤çš„\u0012 /Channel/Application/Endorsementæ‰€ä»¥è¦æ±‚å¤§å¤šæ•°èƒŒä¹¦ï¼Œè€Œæˆ‘åªè®©ä¸€ä¸ªç»„ç»‡ç­¾åï¼Œæ‰€ä»¥å¯¼è‡´é”™è¯¯ã€‚ æŸ¥è¯¢chaincodeæ˜¯å¦å¯ä»¥è¢«æäº¤æ—¶æŠ¥é”™ å†æ‰€æœ‰çš„ç»„ç»‡éƒ½æ‰¹å‡†äº†é“¾ç ä¹‹åï¼ŒæŸ¥è¯¢æ‰¹å‡†ç»“æœè¿”å›çš„å…¨éƒ¨æ˜¯falseã€‚ 123456789(base) w:supply-finance apple$ peer lifecycle chaincode checkcommitreadiness --channelID alljoinchannel --name secured_supply --version 2.0 --sequence 2 --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json&#123; &quot;approvals&quot;: &#123; &quot;GylCoreOrg1MSP&quot;: false, &quot;GylFOrg1MSP&quot;: false, &quot;GylSOrg1MSP&quot;: false, &quot;GylSOrg2MSP&quot;: false &#125;&#125; é”™è¯¯åŸå› åŠè§£å†³æ–¹æ¡ˆï¼š å› ä¸ºæ‰¹å‡†çš„æ—¶å€™åˆ¶å®šäº†ç­¾åç­–ç•¥ï¼Œä½†æ˜¯æŸ¥è¯¢çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šï¼›åœ¨æŸ¥è¯¢æ—¶æŒ‡å®šèƒŒä¹¦ç­–ç•¥å³å¯ã€‚ 123456789(base) w:supply-finance apple$ peer lifecycle chaincode checkcommitreadiness --channelID alljoinchannel --name secured_supply --version 2.0 --sequence 2 --signature-policy &quot;OR(&#x27;GylCoreOrg1MSP.peer&#x27;,&#x27;GylFOrg1MSP.peer&#x27;,&#x27;GylSOrg1MSP.peer&#x27;,&#x27;GylSOrg2MSP.peer&#x27;)&quot; --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/supply.com/orderers/orderer.supply.com/msp/tlscacerts/tlsca.supply.com-cert.pem --output json&#123; &quot;approvals&quot;: &#123; &quot;GylCoreOrg1MSP&quot;: true, &quot;GylFOrg1MSP&quot;: true, &quot;GylSOrg1MSP&quot;: true, &quot;GylSOrg2MSP&quot;: true &#125;&#125; signature set did not satisfy policy ç­¾åé›†åˆä¸ç­–ç•¥ä¸ä¸€è‡´ 122021-01-05 09:40:29.461 UTC [vscc] Validate -&gt; ERRO 3212 VSCC error: stateBasedValidator.Validate failed, err validation of key asset001 (coll&#x27;&#x27;:ns&#x27;secured_supply&#x27;) in tx 59:0 failed: signature set did not satisfy policy2021-01-05 09:40:29.461 UTC [committer.txvalidator] validateTx -&gt; ERRO 3213 Dispatch for transaction txId = 7d13143d4a24fe370528b0e47e6e8a71d7a8b660798c424769a57b67a9cb69ae returned error: validation of key asset001 (coll&#x27;&#x27;:ns&#x27;secured_supply&#x27;) in tx 59:0 failed: signature set did not satisfy policy åˆé‡åˆ°äº†ç­¾åå’ŒèƒŒä¹¦ç­–ç•¥ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ Troubleshootingç½‘ç«™ 1234567Why are my transactions returning an endorsement policy error: signature set did not satisfy policy?é—®é¢˜æƒ…å†µWhen I invoke a smart contract to submit a transaction, the transaction returns the following endorsement policy failure:returned error: VSCC error: endorsement policy failure, err: signature set did not satisfy policyé—®é¢˜åŸå› If you have recently joined a channel and installed the smart contract, this error occurs if you have not added your organization to the endorsement policy. Because your organization is not on the list of organizations who can endorse a transaction from the smart contract, the endorsement from your peers is rejected by the channel. If you encounter this problem, you can change the endorsement policy by upgrading the smart contract. For more information, see Specifying an endorsement policy and Upgrading a smart contract. é”™è¯¯åŸå› ä¸€çº§è§£å†³æ–¹æ¡ˆ è¿™ä¸ªé”™è¯¯çš„èƒŒæ™¯æ˜¯channelã€chaincodeå’Œkeyçš„èƒŒä¹¦ç­–ç•¥éƒ½ä¸ä¸€æ ·ï¼Œå…·ä½“å¦‚ä¸‹ï¼š channelï¼šé»˜è®¤çš„ï¼Œéœ€è¦å¤§å¤šæ•°ç­¾å chaincodeï¼šæŒ‡å®šäº†OR(â€˜GylCoreOrg1MSP.memberâ€™,â€˜GylFOrg1MSP.memberâ€™,â€˜GylSOrg1MSP.memberâ€™,â€˜GylSOrg2MSP.memberâ€™) keyï¼šè®¾ç½®äº†SetStateValidationParameterï¼Œåªéœ€è¦æ‹¥æœ‰è€…çš„ç­¾å å…·ä½“çš„è§£å†³æ–¹æ¡ˆéœ€è¦ç¡®è®¤é“¾ç çš„ç¼–å†™æ˜¯å¦æœ‰é—®é¢˜ã€‚","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"}]},{"title":"Fabricæµ‹è¯•ç½‘ç»œä½¿ç”¨","slug":"blockchain/fabric/Fabricæµ‹è¯•ç½‘ç»œä½¿ç”¨","date":"2021-04-01T10:18:21.468Z","updated":"2021-04-01T10:18:21.469Z","comments":true,"path":"2021/04/01/blockchain/fabric/Fabricæµ‹è¯•ç½‘ç»œä½¿ç”¨/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/Fabric%E6%B5%8B%E8%AF%95%E7%BD%91%E7%BB%9C%E4%BD%BF%E7%94%A8/","excerpt":"","text":"Fabricæµ‹è¯•ç½‘ç»œä½¿ç”¨ æµ‹è¯•ç½‘ç»œè®¾ç½®ç¯å¢ƒå˜é‡è®°å½• Org1ï¼š 1234567export PATH=$&#123;PWD&#125;/../bin:$&#123;PWD&#125;:$PATHexport FABRIC_CFG_PATH=$PWD/../config/export CORE_PEER_TLS_ENABLED=trueexport CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/mspexport CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crtexport CORE_PEER_ADDRESS=localhost:7051 Org2ï¼š 1234567export PATH=$&#123;PWD&#125;/../bin:$&#123;PWD&#125;:$PATHexport FABRIC_CFG_PATH=$PWD/../config/export CORE_PEER_TLS_ENABLED=trueexport CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;export CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/mspexport CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crtexport CORE_PEER_ADDRESS=localhost:9051 2.2.1ä¸‹è½½æ ·ä¾‹æºç  è¿è¡Œå‘½ä»¤ä¸‹è½½æœ€æ–°ç‰ˆçš„Fabricå’ŒFabric CAä»¥åŠ hyperledger/fabric-samples 1curl -sSL https://bit.ly/2ysbOFE | bash -s ä¸Šé¢çš„å‘½ä»¤å¹²äº†è¿™äº›äº‹æƒ…ï¼š ä¸‹è½½ hyperledger/fabric-samples ç­¾å‡ºé€‚å½“çš„ç‰ˆæœ¬æ ‡ç­¾ å°†Hyperledger Fabricå¹³å°ç‰¹å®šçš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶å®‰è£…åˆ°Fabric-samplesçš„/ binå’Œ/ configç›®å½•ä¸­æŒ‡å®šçš„ç‰ˆæœ¬ ä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„Hyperledger Fabric dockeré•œåƒï¼ŒåŒ…æ‹¬ï¼š hyperledger/fabric-peer hyperledger/fabric-orderer hyperledger/fabric-ccenv hyperledger/fabric-tools hyperledger/fabric-baseos hyperledger/fabric-ca 2.2.2ä½¿ç”¨Fabricæµ‹è¯•ç½‘ç»œ å¯åŠ¨Fabricæµ‹è¯•ç½‘ç»œ 1.è¿›å…¥fabric-samples/test-networkï¼Œå¯ä»¥çœ‹åˆ°network.shæ–‡ä»¶,å¯ä»¥è¿è¡Œ./network.sh -hæ¥æ˜¾ç¤ºå¸®åŠ© 1cd fabric-samples/test-network 1234567891011(base) apple@WHOAMIdeMacBook-Pro:~/code/open-source/blockchain/hyperledger/fabric-samples/test-network$ lltotal 72-rw-r--r-- 1 apple staff 777 Dec 14 18:36 README.mddrwxr-xr-x 12 apple staff 384 Dec 14 18:36 addOrg3drwxr-xr-x 3 apple staff 96 Dec 14 18:36 configtxdrwxr-xr-x 5 apple staff 160 Dec 14 18:36 docker-rwxr-xr-x 1 apple staff 18645 Dec 14 18:36 network.shdrwxr-xr-x 7 apple staff 224 Dec 14 18:36 organizations-rwxr-xr-x 1 apple staff 8202 Dec 14 18:36 scriptUtils.shdrwxr-xr-x 6 apple staff 192 Dec 14 18:36 scriptsdrwxr-xr-x 3 apple staff 96 Dec 14 18:36 system-genesis-block 2.åœæ­¢åŸæ¥æ­£åœ¨è¿è¡Œçš„dockerå®¹å™¨ 1./network.sh down 3.å¯åŠ¨ç½‘ç»œ **æ³¨æ„äº‹é¡¹ï¼š**å¿…é¡»åœ¨$USER/fabric-samples/test-networkç›®å½•ä¸‹æ‰§è¡Œæ­¤è„šæœ¬ï¼Œå¦åˆ™ä¼šæŠ¥é”™ 1./network.sh up è¿™ä¸ªè„šæœ¬å¯åŠ¨ä¸¤ä¸ªpeerèŠ‚ç‚¹ï¼Œä¸€ä¸ªorderingèŠ‚ç‚¹ã€‚è¿™ä¸ªè„šæœ¬ä¸ä¼šåˆ›å»ºchannelï¼Œæˆ‘çš„è„šæœ¬è¿è¡Œç»“æœå¦‚ä¸‹ï¼š 123456789101112131415Creating network &quot;net_test&quot; with the default driverCreating volume &quot;net_orderer.example.com&quot; with default driverCreating volume &quot;net_peer0.org1.example.com&quot; with default driverCreating volume &quot;net_peer0.org2.example.com&quot; with default driverCreating orderer.example.com ... doneCreating peer0.org1.example.com ... doneCreating peer0.org2.example.com ... doneCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES31c36a007eb0 hyperledger/fabric-peer:latest &quot;peer node start&quot; 1 second ago Up Less than a second 7051/tcp, 0.0.0.0:9051-&gt;9051/tcp peer0.org2.example.com42f314195c64 hyperledger/fabric-orderer:latest &quot;orderer&quot; 1 second ago Up Less than a second 0.0.0.0:7050-&gt;7050/tcp orderer.example.comde62f2f44a03 hyperledger/fabric-peer:latest &quot;peer node start&quot; 1 second ago Up Less than a second 0.0.0.0:7051-&gt;7051/tcp peer0.org1.example.come9af4c11538c cordite/network-map:latest &quot;/usr/bin/java -cp /â€¦&quot; 5 days ago Exited (143) 3 days ago network-map5128423bb8d7 redis:5.0 &quot;docker-entrypoint.sâ€¦&quot; 5 months ago Exited (0) 7 weeks ago redis6796aadc5173 mysql &quot;docker-entrypoint.sâ€¦&quot; 7 months ago Exited (0) 7 weeks ago mysql66c3ac55f920 neo4j &quot;/sbin/tini -g -- /dâ€¦&quot; 7 months ago Exited (0) 7 months ago dockeré¢æ¿æ˜¾ç¤ºå¦‚ä¸‹ï¼š Peersæ˜¯Fabric networkçš„ç»„æˆéƒ¨åˆ†ï¼ŒPeerså­˜å‚¨åŒºå—é“¾è´¦æœ¬å¹¶åœ¨æäº¤ä¹‹å‰éªŒè¯äº¤æ˜“ã€‚Peersè¿è¡ŒåŒ…å«ä¸šåŠ¡é€»è¾‘çš„æ™ºèƒ½åˆçº¦ï¼Œæ™ºèƒ½åˆçº¦ç”¨äºç®¡ç†åŒºå—é“¾ä¸Šçš„è´¦æœ¬ã€‚ åœ¨ç½‘ç»œä¸Šçš„æ¯ä¸ªPeeréƒ½å±äºä¸€ä¸ªå›¢ä½“ï¼Œä¸Šå›¾æ˜¾ç¤ºçš„æµ‹è¯•ç½‘ç»œä¸­çš„ä¸¤ä¸ªpeeråˆ†åˆ«å±äºç»„ç»‡peer0.org1.example.comå’Œç»„ç»‡peer0.org2.example.comã€‚ æ¯ä¸ªFabric networkåŒæ ·åŒ…å«ordering serviceï¼ŒPeersåœ¨éªŒè¯äº¤æ˜“å’Œæäº¤äº¤æ˜“åˆ°åŒºå—é“¾çš„æ—¶å€™ï¼Œä»–ä»¬ä¸è‡ªå·±å†³å®šäº¤æ˜“çš„é¡ºåºå’ŒåŒºå—ä¸­åŒ…å«å“ªäº›äº¤æ˜“ã€‚åœ¨åˆ†å¸ƒå¼ç½‘ç»œä¸­ï¼Œpeerså¯èƒ½åˆ†å¸ƒçš„ç‰¹åˆ«è¿œï¼Œæ‰€ä»¥è®©peerså¯¹äº¤æ˜“é¡ºåºè¾¾æˆå…±è¯†çš„æˆæœ¬æ˜¯å¾ˆé«˜çš„ã€‚ ordering serviceçš„å­˜åœ¨æ˜¯ä¸ºäº†è®©peersä¸“æ³¨äºäº¤æ˜“éªŒè¯å’Œæäº¤åˆ°è´¦æœ¬ä¸­ã€‚åœ¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯æäº¤çš„äº¤æ˜“æ—¶ï¼Œordering serviceä¼šå¯¹å…¶è¿›è¡Œæ’åºï¼Œç„¶åæŠŠè¿™äº›äº¤æ˜“æ·»åŠ åˆ°åŒºå—ä¸­ã€‚ç„¶åå°†è¿™äº›åŒºå—åˆ†å‘ç»™peerèŠ‚ç‚¹ï¼ŒpeerèŠ‚ç‚¹å†æŠŠåŒºå—å†™å…¥åŒºå—é“¾ã€‚OrderingèŠ‚ç‚¹è¿˜è¿è¡Œç³»ç»Ÿé€šé“ï¼Œè¯¥é€šé“å®šä¹‰äº†Fabric networkçš„èƒ½åŠ›ï¼Œåƒå¦‚ä½•åˆ¶ä½œåŒºå—ä»¥åŠèŠ‚ç‚¹å¯ä»¥ä½¿ç”¨å“ªäº›ç‰ˆæœ¬çš„Fabricã€‚ç³»ç»Ÿé€šé“è¿˜å®šä¹‰äº†å“ªäº›ç»„ç»‡æ˜¯å±äºè¯¥è”ç›Ÿçš„ã€‚ ä¸Šé¢çš„æµ‹è¯•ç½‘ç»œåªè¿è¡Œäº†ä¸€ä¸ªOrderingèŠ‚ç‚¹ï¼Œåœ¨å®é™…çš„ç½‘ç»œä¸­å¯èƒ½å­˜åœ¨å¤šä¸ªOrderingèŠ‚ç‚¹ï¼Œç”±ä¸€ä¸ªæˆ–å¤šä¸ªç»„ç»‡è¿›è¡Œæ“ä½œã€‚ä¸åŒçš„OrderingèŠ‚ç‚¹ä½¿ç”¨Raftå…±è¯†ç®—æ³•æ¥å°±ç½‘ç»œä¸Šçš„äº¤æ˜“é¡ºåºè¾¾æˆä¸€è‡´ã€‚ åˆ›å»ºchannel é€šé“æ˜¯ç‰¹å®šç½‘ç»œæˆå‘˜ä¹‹é—´çš„ä¸“ç”¨é€šä¿¡å±‚ã€‚é€šé“åªèƒ½ç”±è¢«é‚€è¯·åŠ å…¥é€šé“çš„çš„ç»„ç»‡ä½¿ç”¨ï¼Œå¹¶ä¸”å¯¹ç½‘ç»œä¸Šçš„å…¶ä»–æˆå‘˜ä¸å¯è§ã€‚æ¯ä¸ªé€šé“éƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„åŒºå—é“¾è´¦å•ï¼Œè¢«é‚€è¯·çš„ç»„ç»‡åŠ å…¥é€šé“ä¸Šçš„å…¶ä»–peerä»¥å­˜å‚¨channelè´¦æœ¬å’ŒéªŒè¯é€šé“ä¸Šçš„äº¤æ˜“ã€‚ åœ¨org2å’Œorg2ä¹‹é—´åˆ›å»ºé€šé“ï¼Œé»˜è®¤çš„channelåç§°ä¸ºmychannelã€‚ 1./network.sh createChannel å¦‚æœè¿è¡ŒæˆåŠŸï¼Œåˆ™ä¼šçœ‹åˆ°å¦‚ä¸‹æ—¥å¿— 1Channel successfully joined ä¹Ÿå¯ä»¥æŒ‡å®šchannelçš„åç§°ï¼Œå¹¶ä¸”ä½ å¯ä»¥åˆ›å»ºå¤šä¸ªchannelã€‚ 1./network.sh createChannel -c channel1 å¦‚æœä½ æƒ³ä¸€æ­¥å¯åŠ¨æµ‹è¯•ç½‘ç»œå¹¶åˆ›å»ºchannelï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ã€‚ 1./network.sh up createChannel åœ¨channelä¸Šå¯åŠ¨chaincode å¯åŠ¨æˆåŠŸä¹‹åï¼Œå°±å¯ä»¥å¼€å§‹ä½¿ç”¨æ™ºèƒ½åˆçº¦æ¥æ“ä½œchannelè´¦æœ¬äº†ã€‚æ™ºèƒ½åˆçº¦åŒ…å«äº†ç®¡ç†åŒºå—é“¾è´¦æœ¬ä¸Šèµ„äº§çš„ä¸šåŠ¡é€»è¾‘ã€‚è¿è¡Œåœ¨ç½‘ç»œä¸Šçš„ç¨‹åºå¯ä»¥è°ƒç”¨æ™ºèƒ½åˆçº¦åœ¨è´¦æœ¬ä¸Šåˆ›å»ºã€ä¿®æ”¹ã€äº¤æ˜“èµ„äº§ï¼Œè¿™äº›ç¨‹åºä¹ŸæŸ¥è¯¢æ™ºèƒ½åˆçº¦ä»¥è¯»å–è´¦æœ¬ä¸Šçš„æ•°æ®ã€‚ ä¸ºäº†ç¡®ä¿äº¤æ˜“çš„æœ‰æ•ˆæ€§ï¼Œä½¿ç”¨æ™ºèƒ½åˆçº¦åˆ›å»ºçš„äº¤æ˜“é€šå¸¸éœ€è¦é€šé“ä¸Šçš„å¤šä¸ªç»„ç»‡ç­¾åæ‰èƒ½è¢«æäº¤åˆ°channelè´¦æœ¬ã€‚äº¤æ˜“ä¹Ÿéœ€è¦å¤šæ¬¡èƒŒä¹¦ï¼Œæ¥é˜²æ­¢æ¸ é“ä¸Šçš„æŸä¸ªç»„ç»‡ç¯¡æ”¹è´¦æœ¬æˆ–ä½¿ç”¨æœªç»è¿‡åŒæ„çš„é€»è¾‘ã€‚è¦ç­¾ç½²äº¤æ˜“ï¼Œæ¯ä¸ªç»„ç»‡éƒ½éœ€è¦åœ¨å…¶peerä¸Šè°ƒç”¨å¹¶æ‰§è¡Œæ™ºèƒ½åˆçº¦ï¼Œç„¶åå†ç­¾ç½²äº¤æ˜“çš„outputã€‚å¦‚æœoutputä¸€è‡´å¹¶ä¸”æ”¶é›†åˆ°äº†è¶³å¤Ÿçš„ç­¾åï¼Œäº¤æ˜“å°±å¯ä»¥è¢«æäº¤åˆ°è´¦æœ¬ã€‚æŒ‡å®šéœ€è¦å“ªäº›ç»„ç»‡æ‰§è¡Œæ™ºèƒ½åˆçº¦çš„ç­–ç•¥å«åšèƒŒä¹¦ç­–ç•¥ï¼Œè¯¥ç­–ç•¥æ˜¯ä¸ºæ¯ä¸ªchaincodeè®¾ç½®çš„ï¼Œä½œä¸ºchaincodeå®šä¹‰çš„ä¸€éƒ¨åˆ†ã€‚ åœ¨Fabricä¸­ï¼Œæ™ºèƒ½åˆçº¦ä»¥ç§°ä¸ºchaincodeçš„è½¯ä»¶åŒ…éƒ¨ç½²åœ¨ç½‘ç»œä¸Šã€‚chaincodeå®‰è£…åœ¨ç»„ç»‡çš„peersä¸Šï¼Œç„¶åéƒ¨ç½²åˆ°channelï¼Œç„¶åå°±å¯ä»¥åœ¨è¯¥æ¸ é“ä¸­ç”¨äºè®¤å¯äº¤æ˜“å¹¶ä¸åŒºå—é“¾è´¦æœ¬è¿›è¡Œäº¤äº’ã€‚åœ¨è®²chaincodeéƒ¨ç½²åˆ°channelä¸Šä¹‹å‰ï¼Œchannelä¸Šçš„ç»„ç»‡éœ€è¦å¯¹chaincodeçš„å†…å®¹è¾¾æˆå…±è¯†ã€‚å½“æ‰€éœ€æ•°é‡çš„ç»„ç»‡è¾¾æˆå…±è¯†ä¹‹åï¼Œchaincodeå°±å¯ä»¥è¢«æäº¤åˆ°channelä¸Šï¼Œç„¶åchaincodeå°±å‡†å¤‡å¥½å¯ä»¥ä½¿ç”¨äº†ã€‚ æ­å»ºå®Œæˆæµ‹è¯•ç¯å¢ƒä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥å¯åŠ¨chaincodeï¼š 1./network.sh deployCC æˆ‘æœ¬åœ°çš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼š 123456789101112131415161718Chaincode definition committed on channel &#x27;mychannel&#x27;Using organization 1Querying chaincode definition on peer0.org1 on channel &#x27;mychannel&#x27;...Attempting to Query committed status on peer0.org1, Retry after 3 seconds.+ peer lifecycle chaincode querycommitted --channelID mychannel --name basic+ res=0Committed chaincode definition for chaincode &#x27;basic&#x27; on channel &#x27;mychannel&#x27;:Version: 1.0, Sequence: 1, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [Org1MSP: true, Org2MSP: true]Query chaincode definition successful on peer0.org1 on channel &#x27;mychannel&#x27;Using organization 2Querying chaincode definition on peer0.org2 on channel &#x27;mychannel&#x27;...Attempting to Query committed status on peer0.org2, Retry after 3 seconds.+ peer lifecycle chaincode querycommitted --channelID mychannel --name basic+ res=0Committed chaincode definition for chaincode &#x27;basic&#x27; on channel &#x27;mychannel&#x27;:Version: 1.0, Sequence: 1, Endorsement Plugin: escc, Validation Plugin: vscc, Approvals: [Org1MSP: true, Org2MSP: true]Query chaincode definition successful on peer0.org2 on channel &#x27;mychannel&#x27;Chaincode initialization is not required ä¸ç½‘ç»œäº’åŠ¨ åœ¨å¯ç”¨æµ‹è¯•ç½‘ç»œä¹‹åï¼Œä½ å¯ä»¥ä½¿ç”¨peerCLIä¸æµ‹è¯•ç½‘ç»œè¿›è¡Œäº’åŠ¨ã€‚peerCLIå…è®¸ä½ è°ƒç”¨å·²ç»éƒ¨ç½²çš„æ™ºèƒ½åˆçº¦ã€æ›´æ–°channelsï¼›ä¹Ÿå¯ä»¥é€šè¿‡CLIæ›´æ–°æˆ–è€…éƒ¨ç½²æ–°çš„æ™ºèƒ½åˆçº¦ã€‚ è¯·ç¡®ä¿ä½ çš„æ“ä½œåœ¨test-networkç›®å½•ä¸‹è¿›è¡Œã€‚ 1ã€æŠŠfabric-samplesçš„binç›®å½•ä¸‹çš„äºŒè¿›åˆ¶å‘½ä»¤å®‰è£…åˆ°ä½ çš„å®¢æˆ·ç«¯ç¯å¢ƒï¼š 1export PATH=$&#123;PWD&#125;/../bin:$PATH 2ã€è¿˜éœ€è¦å°†FABRIC_CFG_PATHè®¾ç½®ä¸ºæŒ‡å‘fabric-sampleså­˜å‚¨åº“ä¸­çš„core.yamlæ–‡ä»¶ï¼š 1export FABRIC_CFG_PATH=$PWD/../config/ 3ã€ç°åœ¨è®¾ç½®ç¯å¢ƒå˜é‡å…è®¸ä½ ä½¿ç”¨Org1çš„èº«ä»½æ“ä½œpeerCLIã€‚ 12345export CORE_PEER_TLS_ENABLED=trueexport CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crtexport CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/mspexport CORE_PEER_ADDRESS=localhost:7051 4ã€ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ç”¨èµ„äº§åˆå§‹åŒ–è´¦æœ¬ 1peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n basic --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;InitLedger&quot;,&quot;Args&quot;:[]&#125;&#x27; å¦‚æœæˆåŠŸä½ ä¼šçœ‹åˆ°åƒä¸‹é¢çš„ç»“æœï¼š 12020-12-16 15:35:41.511 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200 5ã€ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥è¯¢è´¦æœ¬ä¸Šçš„èµ„äº§ 1peer chaincode query -C mychannel -n basic -c &#x27;&#123;&quot;Args&quot;:[&quot;GetAllAssets&quot;]&#125;&#x27; å¦‚æœæˆåŠŸä½ ä¼šçœ‹åˆ°ä¸‹é¢çš„ç»“æœï¼š 12345678[ &#123;&quot;ID&quot;: &quot;asset1&quot;, &quot;color&quot;: &quot;blue&quot;, &quot;size&quot;: 5, &quot;owner&quot;: &quot;Tomoko&quot;, &quot;appraisedValue&quot;: 300&#125;, &#123;&quot;ID&quot;: &quot;asset2&quot;, &quot;color&quot;: &quot;red&quot;, &quot;size&quot;: 5, &quot;owner&quot;: &quot;Brad&quot;, &quot;appraisedValue&quot;: 400&#125;, &#123;&quot;ID&quot;: &quot;asset3&quot;, &quot;color&quot;: &quot;green&quot;, &quot;size&quot;: 10, &quot;owner&quot;: &quot;Jin Soo&quot;, &quot;appraisedValue&quot;: 500&#125;, &#123;&quot;ID&quot;: &quot;asset4&quot;, &quot;color&quot;: &quot;yellow&quot;, &quot;size&quot;: 10, &quot;owner&quot;: &quot;Max&quot;, &quot;appraisedValue&quot;: 600&#125;, &#123;&quot;ID&quot;: &quot;asset5&quot;, &quot;color&quot;: &quot;black&quot;, &quot;size&quot;: 15, &quot;owner&quot;: &quot;Adriana&quot;, &quot;appraisedValue&quot;: 700&#125;, &#123;&quot;ID&quot;: &quot;asset6&quot;, &quot;color&quot;: &quot;white&quot;, &quot;size&quot;: 15, &quot;owner&quot;: &quot;Michel&quot;, &quot;appraisedValue&quot;: 800&#125;] 6ã€ç½‘ç»œä¸Šçš„æˆå‘˜æƒ³è¦äº¤æ˜“èµ„äº§æˆ–è€…æ›´æ–°èµ„äº§æ—¶å°±ä¼šè°ƒç”¨chaincodeï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥è°ƒç”¨èµ„äº§è½¬ç§»chaincodeæ¥æ›´æ”¹èµ„äº§çš„ownerã€‚ 1peer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile $&#123;PWD&#125;/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n basic --peerAddresses localhost:7051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles $&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c &#x27;&#123;&quot;function&quot;:&quot;TransferAsset&quot;,&quot;Args&quot;:[&quot;asset6&quot;,&quot;Christopher&quot;]&#125;&#x27; å¦‚æœæˆåŠŸç»“æœå¦‚ä¸‹ï¼š 12020-12-16 15:43:18.062 CST [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 001 Chaincode invoke successful. result: status:200 é‡æ–°æŸ¥è¯¢å¯ä»¥å‘ç°asset6çš„ownerå·²ç»æ›´æ”¹ã€‚ 1234567[&#123;&quot;ID&quot;:&quot;asset1&quot;,&quot;color&quot;:&quot;blue&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Tomoko&quot;,&quot;appraisedValue&quot;:300&#125;,&#123;&quot;ID&quot;:&quot;asset2&quot;,&quot;color&quot;:&quot;red&quot;,&quot;size&quot;:5,&quot;owner&quot;:&quot;Brad&quot;,&quot;appraisedValue&quot;:400&#125;,&#123;&quot;ID&quot;:&quot;asset3&quot;,&quot;color&quot;:&quot;green&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Jin Soo&quot;,&quot;appraisedValue&quot;:500&#125;,&#123;&quot;ID&quot;:&quot;asset4&quot;,&quot;color&quot;:&quot;yellow&quot;,&quot;size&quot;:10,&quot;owner&quot;:&quot;Max&quot;,&quot;appraisedValue&quot;:600&#125;,&#123;&quot;ID&quot;:&quot;asset5&quot;,&quot;color&quot;:&quot;black&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Adriana&quot;,&quot;appraisedValue&quot;:700&#125;,&#123;&quot;ID&quot;:&quot;asset6&quot;,&quot;color&quot;:&quot;white&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Christopher&quot;,&quot;appraisedValue&quot;:800&#125;] 7ã€æˆ‘ä»¬åœ¨è°ƒç”¨chaincodeä¹‹åï¼Œæˆ‘ä»¬æ¥æŸ¥ä¸€ä¸‹è¿™ä¸ªè°ƒç”¨æ˜¯å¦‚ä½•æ”¹å˜èµ„äº§çš„ã€‚æˆ‘ä»¬ä½¿ç”¨Org2æ¥æ“ä½œï¼Œé…ç½®ç¯å¢ƒå˜é‡å¦‚ä¸‹ï¼š 12345export CORE_PEER_TLS_ENABLED=trueexport CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;export CORE_PEER_TLS_ROOTCERT_FILE=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crtexport CORE_PEER_MSPCONFIGPATH=$&#123;PWD&#125;/organizations/peerOrganizations/org2.example.com/users/Admin@org2.example.com/mspexport CORE_PEER_ADDRESS=localhost:9051 æ‰§è¡Œpeer chaincode query -C mychannel -n basic -c '&#123;&quot;Args&quot;:[&quot;ReadAsset&quot;,&quot;asset6&quot;]&#125;'å‘½ä»¤ç»“æœå¦‚ä¸‹ï¼š 1&#123;&quot;ID&quot;:&quot;asset6&quot;,&quot;color&quot;:&quot;white&quot;,&quot;size&quot;:15,&quot;owner&quot;:&quot;Christopher&quot;,&quot;appraisedValue&quot;:800&#125; ä¸­æ–­ç½‘ç»œ é€šè¿‡æ‰§è¡Œ./network.sh downæ¥ä¸­æ–­ç½‘ç»œï¼Œè¯¥å‘½ä»¤ä¼šåœæ­¢å¹¶åˆ é™¤peeræ²³chaincodeçš„å®¹å™¨ï¼›åˆ é™¤orgçš„å¯†é’¥ç­‰æ•°æ®å¹¶ä»Dockerä¸­removeæ‰chaincodeçš„é•œåƒã€‚è¯¥å‘½ä»¤è¿˜ä¼šåˆ é™¤ç½‘è·¯ä¸Šçš„channelï¼Œå¦‚æœæœ‰ä»»ä½•é—®é¢˜å¯ä»¥ç»§ç»­è¿è¡Œ./network.sh upã€‚ é—®é¢˜å¤„ç† åˆ›å»ºchannelå¤±è´¥ï¼Œæ—¥å¿—å¦‚ä¸‹ï¼š 1234567891011121314151617Channel &#x27;mychannel&#x27; createdJoin Org1 peers to the channel...Using organization 1+ peer channel join -b ./channel-artifacts/mychannel.block+ res=1+ peer channel join -b ./channel-artifacts/mychannel.block+ res=1+ peer channel join -b ./channel-artifacts/mychannel.block+ res=1+ peer channel join -b ./channel-artifacts/mychannel.block+ res=12020-12-21 11:22:02.781 CST [comm.tls] ClientHandshake -&gt; ERRO 001 Client TLS handshake failed after 1.769196ms with error: EOF remoteaddress=[::1]:70512020-12-21 11:22:03.785 CST [comm.tls] ClientHandshake -&gt; ERRO 002 Client TLS handshake failed after 2.054333ms with error: EOF remoteaddress=[::1]:70512020-12-21 11:22:05.113 CST [comm.tls] ClientHandshake -&gt; ERRO 003 Client TLS handshake failed after 2.849348ms with error: EOF remoteaddress=[::1]:7051Error: error getting endorser client for channel: endorser client failed to connect to localhost:7051: failed to create new connection: context deadline exceededAfter 5 attempts, peer0.org1 has failed to join channel &#x27;mychannel&#x27;Create channel failed è§£å†³æ–¹æ¡ˆï¼š åˆ é™¤æ‰€æœ‰çš„æµ‹è¯•ç½‘ç»œç›¸å…³çš„å®¹å™¨ è¿è¡Œ./network.sh down åˆ é™¤dockeræœ¬åœ°æœªä½¿ç”¨çš„volume é‡è¯•","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"}]},{"title":"Fabricå…³é”®é—®é¢˜20é—®","slug":"blockchain/fabric/Fabricå…³é”®é—®é¢˜20é—®","date":"2021-04-01T10:18:21.467Z","updated":"2021-04-01T10:18:21.468Z","comments":true,"path":"2021/04/01/blockchain/fabric/Fabricå…³é”®é—®é¢˜20é—®/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/Fabric%E5%85%B3%E9%94%AE%E9%97%AE%E9%A2%9820%E9%97%AE/","excerpt":"","text":"1ã€æ˜¯å¦æ‰€æœ‰çš„èƒŒä¹¦èŠ‚ç‚¹éƒ½æœ‰ç›¸åŒçš„åŠŸèƒ½ï¼Ÿä¸€ç¬”äº¤æ˜“æ˜¯ä¸æ˜¯ä»»æ„çš„èƒŒä¹¦èŠ‚ç‚¹éƒ½å¯ä»¥éªŒè¯ï¼Œè¿˜æ˜¯åªèƒ½ç”±æ”¯æŒæ­¤äº¤æ˜“çš„èƒŒä¹¦èŠ‚ç‚¹éªŒè¯ï¼Ÿ ç­”ï¼šåªæœ‰å®‰è£…äº†ç›¸åŒçš„chaincodeçš„peerèŠ‚ç‚¹æ‰å…·æœ‰èƒŒä¹¦çš„åŠŸèƒ½ã€‚æ‰€ä»¥ä¸€ä¸ªpeerèŠ‚ç‚¹æƒ³è¦æˆä¸ºèƒŒä¹¦èŠ‚ç‚¹ï¼Œå¿…é¡»å®‰è£…å¯¹åº”çš„chaincodeã€‚ ä¸€ç¬”äº¤æ˜“è‚¯å®šæ˜¯ç”±äºè°ƒç”¨äº†é“¾ç è€Œäº§ç”Ÿçš„ï¼Œæ‰€ä»¥è¿™ç¬”äº¤æ˜“å¿…é¡»ç”±å…¶ä»–çš„å®‰è£…äº†ç›¸åŒé“¾ç çš„èƒŒä¹¦èŠ‚ç‚¹è¿›è¡ŒéªŒè¯ã€‚ 2ã€èƒŒä¹¦èŠ‚ç‚¹åœ¨éªŒè¯çš„æ—¶å€™æ˜¯å¦çŸ¥é“äº†äº¤æ˜“çš„å…¨éƒ¨å†…å®¹ï¼Œå¦‚ä½•ä¿è¯æ•°æ®çš„éšç§çš„ï¼Ÿ ç­”ï¼šèƒŒä¹¦èŠ‚ç‚¹åœ¨éªŒè¯çš„æ—¶å€™å¯èƒ½å¹¶ä¸çŸ¥é“äº¤æ˜“çš„å…¨éƒ¨å†…å®¹ï¼ŒFabricæœ‰ä¸€ä¸ªåä¸ºâ€œtransientâ€çš„å­˜å‚¨ï¼Œè¿™ä¸ªå­˜å‚¨åªåœ¨å½“å‰peerèŠ‚ç‚¹ï¼›å¦‚æœæœ‰äº¤æ˜“çš„è¯â€œtransientâ€å­˜å‚¨çš„æ•°æ®ä¼šé€šè¿‡Gossipåè®®éšç§˜çš„ä¼ è¾“ç»™å¦ä¸€ä¸ªpeerèŠ‚ç‚¹ã€‚ç„¶åè¿™ä¸¤ä¸ªpeerèŠ‚ç‚¹éƒ½å¯ä»¥æŸ¥è¯¢åˆ°â€œtransientâ€å­˜å‚¨çš„æ•°æ®ã€‚è€Œchannelä¸Šçš„å…¶ä»–æˆå‘˜æ˜¯æ— æ³•çœ‹åˆ°è¿™äº›æ•°æ®çš„ï¼Œå› æ­¤å¹¶ä¸æ˜¯æ‰€æœ‰çš„èƒŒä¹¦èŠ‚ç‚¹éƒ½å¯ä»¥ç›´åˆ°äº¤æ˜“çš„å…¨éƒ¨å†…å®¹ã€‚ 2.1 è¿™ä¸ªé—®é¢˜ä¼šå¼•å‡ºå¦ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼ŒèƒŒä¹¦èŠ‚ç‚¹åœ¨ç¼ºå°‘æ•°æ®çš„æƒ…å†µä¸‹å¦‚ä½•è¿›è¡ŒèƒŒä¹¦å‘¢ï¼Ÿè¿™ä¸å°±å¯¼è‡´èƒŒä¹¦å¤±è´¥äº†å—ï¼Ÿ ç­”ï¼šæ˜¯çš„ï¼Œæ‹¿ä¸åˆ°â€œtransientâ€å­˜å‚¨çš„æ•°æ®çš„èƒŒä¹¦èŠ‚ç‚¹ä¼šèƒŒä¹¦å¤±è´¥ã€‚ä½†æ˜¯ç”±äºæˆ‘ä»¬å¯ä»¥è®¾ç½®chaincodeå’Œkeyçš„åŸºäºçŠ¶æ€çš„èƒŒä¹¦ç­–ç•¥ï¼Œå› æ­¤å°±ç®—æœ‰éƒ¨åˆ†èƒŒä¹¦èŠ‚ç‚¹èƒŒä¹¦å¤±è´¥äº†ï¼Œåªè¦èƒ½çœ‹åˆ°æ•°æ®çš„èƒŒä¹¦èŠ‚ç‚¹åšäº†èƒŒä¹¦å¹¶ç¬¦åˆèƒŒä¹¦ç­–ç•¥å³å¯è¾¾æˆå…±è¯†ã€‚ è¿™ä¸ªé—®é¢˜å¯ä»¥æŸ¥çœ‹åœ¨Fabricä¸­äº¤æ˜“å—ä¿æŠ¤çš„èµ„äº§ 3ã€åŒºå—æ•°æ®çš„æ•°æ®ç»“æ„å¦‚æœæ˜¯æ•°ç»„çš„è¯ï¼Œå¦‚ä½•åšåˆ°é˜²ç¯¡æ”¹ï¼Ÿ ç­”ï¼šæš‚æ—¶æ— æ³•å›ç­”æ­¤é—®é¢˜ï¼Œå¾…å®Œæˆã€‚ 4ã€ä¸»èŠ‚ç‚¹æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿä¸»èŠ‚ç‚¹å¯ä»¥äº¤æ˜“å—ï¼Ÿä¸»èŠ‚ç‚¹å’Œæ™®é€šçš„peerèŠ‚ç‚¹æœ‰ä»€ä¹ˆä¸ä¸€æ ·ï¼Ÿ ç­”ï¼šæ‰€è°“çš„ä¸»èŠ‚ç‚¹åº”è¯¥æ˜¯Orderï¼Œç›®å‰äº†è§£åˆ°çš„åªæ˜¯è´Ÿè´£äº¤æ˜“çš„æ’åºä»¥åŠä¿¡æ¯çš„è½¬å‘ã€‚æ›´å¤šå†…å®¹å¾…å­¦ä¹ ã€‚ 5ã€é“¾ç æ˜¯ä¸æ˜¯å°±æ˜¯æ™ºèƒ½åˆçº¦ï¼Ÿ ç­”ï¼šé“¾ç å°±æ˜¯æ™ºèƒ½åˆçº¦ï¼Œåªæœ‰è°ƒç”¨æ™ºèƒ½åˆçº¦æ‰å¯ä»¥æ›´æ”¹channelä¸Šçš„è´¦æœ¬ã€‚","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"}]},{"title":"èƒŒä¹¦ç­–ç•¥ï¼ˆEndorsement policiesï¼‰","slug":"blockchain/fabric/Endorsement policiesèƒŒä¹¦ç­–ç•¥","date":"2021-04-01T10:18:21.466Z","updated":"2021-04-01T10:18:21.467Z","comments":true,"path":"2021/04/01/blockchain/fabric/Endorsement policiesèƒŒä¹¦ç­–ç•¥/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/Endorsement%20policies%E8%83%8C%E4%B9%A6%E7%AD%96%E7%95%A5/","excerpt":"","text":"èƒŒä¹¦ç­–ç•¥ å®˜æ–¹æ–‡æ¡£ï¼šEndorsement policies ã€‚ã€‚ã€‚çœç•¥éƒ¨åˆ† Setting chaincode-level endorsement policies(è®¾ç½®é“¾ç çº§åˆ«çš„èƒŒä¹¦ç­–ç•¥) Chaincode-level endorsement policies are agreed to by channel members when they approve a chaincode definition for their organization. A sufficient number of channel members need to approve a chaincode definition to meet the Channel/Application/LifecycleEndorsement policy, which by default is set to a majority of channel members, before the definition can be committed to the channel. Once the definition has been committed, the chaincode is ready to use. Any invoke of the chaincode that writes data to the ledger will need to be validated by enough channel members to meet the endorsement policy. é€šé“æˆå‘˜åœ¨ä¸ºå…¶ç»„ç»‡æ‰¹å‡†é“¾ç å®šä¹‰æ—¶ï¼Œä¼šåŒæ„é“¾ç çº§è®¤å¯ç­–ç•¥ã€‚éœ€è¦è¶³å¤Ÿæ•°é‡çš„é€šé“æˆå‘˜æ‰¹å‡†é“¾ç å®šä¹‰æ‰èƒ½æ»¡è¶³Channel / Application / LifecycleEndorsementç­–ç•¥ï¼Œè¯¥ç­–ç•¥é»˜è®¤æƒ…å†µä¸‹è®¾ç½®ä¸ºå¤§å¤šæ•°é€šé“æˆå‘˜ï¼Œç„¶åæ‰èƒ½å°†é“¾ç å®šä¹‰æäº¤ç»™é€šé“ã€‚æäº¤å®šä¹‰åï¼Œä¾¿å¯ä»¥ä½¿ç”¨é“¾ç äº†ã€‚ä»»ä½•å°†æ•°æ®å†™å…¥è´¦æœ¬çš„é“¾ç çš„è°ƒç”¨éƒ½éœ€è¦ç”±è¶³å¤Ÿçš„é€šé“æˆå‘˜æ¥éªŒè¯ï¼Œä»¥æ»¡è¶³èƒŒä¹¦ç­–ç•¥ã€‚ You can specify an endorsement policy for a chaincode using the Fabric SDKs. For an example, visit the How to install and start your chaincode in the Node.js SDK documentation. You can also create an endorsement policy from your CLI when you approve and commit a chaincode definition with the Fabric peer binaries by using the --signature-policy flag. ä½ å¯ä»¥ä½¿ç”¨Fabric SDKsæ¥ä¸ºé“¾ç æŒ‡å®šèƒŒä¹¦ç­–ç•¥ï¼Œè®¿é—®How to install and start your chaincodeæ¥æŸ¥çœ‹ä½¿ç”¨Node.js SDKçš„æ–‡æ¡£ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡CLIåœ¨æ‰¹å‡†å’Œæäº¤é“¾ç å®šä¹‰æ—¶æ¥åˆ›å»ºèƒŒä¹¦ç­–ç•¥ï¼Œä½¿ç”¨Fabricçš„peerå¯æ‰§è¡Œç¨‹åºæ—¶ä½¿ç”¨ --signature-policy æ ‡å¿—æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ For exampleï¼š 1peer lifecycle chaincode approveformyorg --channelID mychannel --signature-policy &quot;AND(&#x27;Org1.member&#x27;, &#x27;Org2.member&#x27;)&quot; --name mycc --version 1.0 --package-id mycc_1:3a8c52d70c36313cfebbaf09d8616e7a6318ababa01c7cbe40603c373bcfe173 --sequence 1 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem --waitForEvent The above command approves the chaincode definition of mycc with the policy AND('Org1.member', 'Org2.member') which would require that a member of both Org1 and Org2 sign the transaction. After a sufficient number of channel members approve a chaincode definition for mycc, the definition and endorsement policy can be committed to the channel using the command below: ä¸Šé¢çš„å‘½ä»¤ä½¿ç”¨ AND('Org1.member', 'Org2.member') ç­–ç•¥æ¥æ‰¹å‡†myccçš„é“¾ç å®šä¹‰ï¼Œè¿™ä¸ªç­–ç•¥è¦æ±‚Org1å’ŒOrg2çš„æˆå‘˜éƒ½éœ€è¦å¯¹ä¸€ç¬”äº¤æ˜“è¿›è¡Œç­¾åã€‚åœ¨æœ‰è¶³å¤Ÿçš„é€šé“æˆå‘˜æ‰¹å‡†äº†myccçš„é“¾ç å®šä¹‰ä¹‹åï¼Œè¿™ä¸ªå®šä¹‰å’ŒèƒŒä¹¦ç­–ç•¥å°±å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¢«æäº¤åˆ°é€šé“äº†ï¼š 1peer lifecycle chaincode commit -o orderer.example.com:7050 --channelID mychannel --signature-policy &quot;AND(&#x27;Org1.member&#x27;, &#x27;Org2.member&#x27;)&quot; --name mycc --version 1.0 --sequence 1 --init-required --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem --waitForEvent --peerAddresses peer0.org1.example.com:7051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses peer0.org2.example.com:9051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt Notice that, if the identity classification is enabled (see Membership Service Providers (MSP)), one can use the PEER role to restrict endorsement to only peers. è¯·æ³¨æ„ï¼Œå¦‚æœå¯ç”¨äº†èº«ä»½åˆ†ç±»ï¼ˆè¯·å‚é˜… Membership Service Providers (MSP)ï¼‰ï¼Œåˆ™å¯ä»¥ä½¿ç”¨PEERè§’è‰²å°†èƒŒä¹¦é™åˆ¶ä¸ºä»…peerèŠ‚ç‚¹ã€‚ For example: 1peer lifecycle chaincode approveformyorg --channelID mychannel --signature-policy &quot;AND(&#x27;Org1.peer&#x27;, &#x27;Org2.peer&#x27;)&quot; --name mycc --version 1.0 --package-id mycc_1:3a8c52d70c36313cfebbaf09d8616e7a6318ababa01c7cbe40603c373bcfe173 --sequence 1 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem --waitForEvent In addition to the specifying an endorsement policy from the CLI or SDK, a chaincode can also use policies in the channel configuration as endorsement policies. You can use the --channel-config-policy flag to select a channel policy with format used by the channel configuration and by ACLs. é™¤äº†ä»CLIæˆ–SDKä¸­æŒ‡å®šèƒŒä¹¦ç­–ç•¥ä»¥å¤–ï¼Œé“¾ç è¿˜å¯ä»¥ä½¿ç”¨é€šé“é…ç½®ä¸­çš„ç­–ç•¥ä½œä¸ºèƒŒä¹¦ç­–ç•¥ã€‚ä½ å¯ä»¥ä½¿ç”¨--channel-config-policyæ ‡å¿—æ¥é€‰æ‹©ä¸€ä¸ªé€šé“ç­–ç•¥ï¼Œå…¶æ ¼å¼ç”±é€šé“é…ç½®å’ŒACLä½¿ç”¨ã€‚ For example: 1peer lifecycle chaincode approveformyorg --channelID mychannel --channel-config-policy Channel/Application/Admins --name mycc --version 1.0 --package-id mycc_1:3a8c52d70c36313cfebbaf09d8616e7a6318ababa01c7cbe40603c373bcfe173 --sequence 1 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem --waitForEvent If you do not specify a policy, the chaincode definition will use the Channel/Application/Endorsement policy by default, which requires that a transaction be validated by a majority of channel members. This policy depends on the membership of the channel, so it will be updated automatically when organizations are added or removed from a channel. One advantage of using channel policies is that they can be written to be updated automatically with channel membership. å¦‚æœä½ ä¸æŒ‡å®šèƒŒä¹¦ç­–ç•¥ï¼Œé“¾ç å®šä¹‰ä¼šä½¿ç”¨é»˜è®¤çš„ Channel/Application/Endorsementç­–ç•¥ï¼Œè¿™ä¸ªç­–ç•¥è¦æ±‚äº¤æ˜“å¿…é¡»ç»è¿‡å¤§å¤šæ•°é€šé“æˆå‘˜çš„éªŒè¯ã€‚è¯¥ç­–ç•¥å–å†³äºé€šé“æˆå‘˜ï¼Œå› æ­¤ä»é€šé“ä¸­æ·»åŠ æˆ–åˆ é™¤ç»„ç»‡æ—¶ï¼Œå®ƒå°†è‡ªåŠ¨æ›´æ–°ã€‚ä½¿ç”¨é€šé“ç­–ç•¥çš„ä¸€ä¸ªä¼˜åŠ¿æ˜¯ï¼Œå¯ä»¥å°†å…¶ç¼–å†™ä¸ºæ ¹æ®é€šé“æˆå‘˜æ•°é‡è‡ªåŠ¨æ›´æ–°ã€‚ If you specify an endorsement policy using the --signature-policy flag or the SDK, you will need to update the policy when organizations join or leave the channel. A new organization added to the channel after the chaincode has been defined will be able to query a chaincode (provided the query has appropriate authorization as defined by channel policies and any application level checks enforced by the chaincode) but will not be able to execute or endorse the chaincode. Only organizations listed in the endorsement policy syntax will be able sign transactions. å¦‚æœä½ ä½¿ç”¨ --signature-policy æ ‡å¿—æˆ–è€…SDKæŒ‡å®šäº†èƒŒä¹¦ç­–ç•¥ï¼Œä½ éœ€è¦åœ¨ç»„ç»‡åŠ å…¥æˆ–è€…ç¦»å¼€é€šé“æ—¶æ›´æ–°è¿™ä¸ªç­–ç•¥ã€‚ä¸€ä¸ªæ–°çš„ç»„ç»‡åœ¨é“¾ç è¢«å®šä¹‰å¥½ä¹‹ååŠ å…¥è¿™ä¸ªé€šé“ï¼Œè¿™ä¸ªç»„ç»‡å¯ä»¥æŸ¥è¯¢è¿™ä¸ªé“¾ç ï¼ˆæä¾›æŸ¥è¯¢å…·æœ‰é€šé“ç­–ç•¥å’Œé“¾ç å¼ºåˆ¶æ‰§è¡Œçš„ä»»ä½•åº”ç”¨ç¨‹åºçº§åˆ«æ£€æŸ¥æ‰€å®šä¹‰çš„é€‚å½“æˆæƒï¼‰ï¼Œä½†æ˜¯ä¸èƒ½å¤Ÿæ‰§è¡Œæˆ–è®¤å¯é“¾ç ã€‚åªæœ‰ç»„ç»‡åœ¨è®¤å¯ç­–ç•¥è¯­æ³•çš„åˆ—è¡¨ä¸­ä¹‹åï¼Œç»„ç»‡æ‰èƒ½ç­¾ç½²äº¤æ˜“ã€‚ ä¸ªäººéªŒè¯ chaincodeå¦‚æœä¸è®¾ç½®èƒŒä¹¦ç­–ç•¥ï¼Œåˆ™é»˜è®¤çš„èƒŒä¹¦ç­–ç•¥æ˜¯ï¼š\u0012 /Channel/Application/Endorsement 123456789101112131415apple$ peer lifecycle chaincode querycommitted --channelID alljoinchannel --name secured_supply --output json&#123; &quot;sequence&quot;: 6, &quot;version&quot;: &quot;3.0&quot;, &quot;endorsement_plugin&quot;: &quot;escc&quot;, &quot;validation_plugin&quot;: &quot;vscc&quot;, &quot;validation_parameter&quot;: &quot;EiAvQ2hhbm5lbC9BcHBsaWNhdGlvbi9FbmRvcnNlbWVudA==&quot;, &quot;collections&quot;: &#123;&#125;, &quot;approvals&quot;: &#123; &quot;GylCoreOrg1MSP&quot;: true, &quot;GylFOrg1MSP&quot;: true, &quot;GylSOrg1MSP&quot;: true, &quot;GylSOrg2MSP&quot;: true &#125;&#125; è®¾ç½®èƒŒä¹¦ç­–ç•¥ä¸º--signature-policy &quot;OR('GylCoreOrg1MSP.peer','GylFOrg1MSP.peer','GylSOrg1MSP.peer','GylSOrg2MSP.peer')&quot;ï¼Œå†æ¬¡æŸ¥è¯¢é“¾ç å®šä¹‰ï¼š 123456789101112131415apple$ peer lifecycle chaincode querycommitted --channelID alljoinchannel --name secured_supply --output json&#123; &quot;sequence&quot;: 7, &quot;version&quot;: &quot;3.0&quot;, &quot;endorsement_plugin&quot;: &quot;escc&quot;, &quot;validation_plugin&quot;: &quot;vscc&quot;, &quot;validation_parameter&quot;: &quot;CmUSFBISCAESAggAEgIIARICCAISAggDGhQSEgoOR3lsQ29yZU9yZzFNU1AQAxoREg8KC0d5bEZPcmcxTVNQEAMaERIPCgtHeWxTT3JnMU1TUBADGhESDwoLR3lsU09yZzJNU1AQAw==&quot;, &quot;collections&quot;: &#123;&#125;, &quot;approvals&quot;: &#123; &quot;GylCoreOrg1MSP&quot;: true, &quot;GylFOrg1MSP&quot;: true, &quot;GylSOrg1MSP&quot;: true, &quot;GylSOrg2MSP&quot;: true &#125;&#125; è§£ç ä¹‹åï¼š 12345e\u0012\u0014\u0012\u0012\b\u0001\u0012\u0002\b\u0012\u0002\b\u0001\u0012\u0002\b\u0002\u0012\u0002\b\u0003\u001a\u0014\u0012\u0012\u000eGylCoreOrg1MSP\u0010\u0003\u001a\u0011\u0012\u000f GylFOrg1MSP\u0010\u0003\u001a\u0011\u0012\u000f GylSOrg1MSP\u0010\u0003\u001a\u0011\u0012\u000f GylSOrg2MSP\u0010\u0003 Endorsement policy syntaxï¼ˆèƒŒä¹¦ç­–ç•¥çš„è¯­æ³•ï¼‰ As you can see above, policies are expressed in terms of principals (â€œprincipalsâ€ are identities matched to a role). Principals are described as 'MSP.ROLE', where MSP represents the required MSP ID and ROLE represents one of the four accepted roles: member, admin, client, and peer. æ­£å¦‚æ‚¨åœ¨ä¸Šé¢çœ‹åˆ°çš„é‚£æ ·ï¼Œç­–ç•¥æ˜¯æ ¹æ®ä¸»ä½“è¡¨è¾¾çš„ï¼ˆâ€œä¸»ä½“â€æ˜¯ä¸è§’è‰²åŒ¹é…çš„èº«ä»½ï¼‰ã€‚ä¸»ä½“è¢«æè¿°ä¸º'MSP.ROLE'ï¼Œå…¶ä¸­MSPä»£è¡¨æ‰€éœ€çš„MSP ID,ROLE ä»£è¡¨å››ä¸ªå…¬è®¤çš„è§’è‰²ä¹‹ä¸€ï¼šmember, admin, clientï¼Œå’Œ peerã€‚ Here are a few examples of valid principals: 'Org0.admin': any administrator of the Org0 MSP 'Org1.member': any member of the Org1 MSP 'Org1.client': any client of the Org1 MSP 'Org1.peer': any peer of the Org1 MSP The syntax of the language is: 1EXPR(E[, E...]) Where EXPR is either AND, OR, or OutOf, and E is either a principal (with the syntax described above) or another nested call to EXPR. EXPR å¯ä»¥ä¸ºAND, OR, or OutOfï¼ŒEå¯ä»¥æ˜¯ä¸€ä¸ªå…·æœ‰ä¸Šé¢è¯­æ³•çš„ä¸»ä½“ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹å¦ä¸€ä¸ªEXPRçš„åµŒå¥—è°ƒç”¨ã€‚ For example: AND('Org1.member', 'Org2.member', 'Org3.member') requests one signature from each of the three principals. OR('Org1.member', 'Org2.member') requests one signature from either one of the two principals. OR('Org1.member', AND('Org2.member', 'Org3.member')) requests either one signature from a member of the Org1 MSP or one signature from a member of the Org2 MSP and one signature from a member of the Org3 MSP. OutOf(1, 'Org1.member', 'Org2.member'), which resolves to the same thing as OR('Org1.member', 'Org2.member'). Similarly, OutOf(2, 'Org1.member', 'Org2.member') is equivalent to AND('Org1.member', 'Org2.member'), and OutOf(2, 'Org1.member', 'Org2.member', 'Org3.member') is equivalent to OR(AND('Org1.member', 'Org2.member'), AND('Org1.member', 'Org3.member'), AND('Org2.member', 'Org3.member')). ä¾‹å¦‚ï¼š AND('Org1.member', 'Org2.member', 'Org3.member') ä¸‰ä¸ªä¸»ä½“éƒ½éœ€è¦è¿›è¡Œç­¾åã€‚ OR('Org1.member', 'Org2.member') åªéœ€è¦ä¸¤ä¸ªä¸»ä½“çš„å…¶ä¸­ä¸€ä¸ªæä¾›ç­¾åã€‚ OR('Org1.member', AND('Org2.member', 'Org3.member')) éœ€è¦Org1æä¾›ç­¾åï¼Œæˆ–è€…éœ€è¦Org2å’ŒOrg3åŒæ—¶æä¾›ç­¾åã€‚ OutOf(1, 'Org1.member', 'Org2.member'), å’Œ OR('Org1.member', 'Org2.member')åšçš„äº‹æƒ…ä¸€æ ·ã€‚ ç›¸ä¼¼çš„, OutOf(2, 'Org1.member', 'Org2.member') ä¸ AND('Org1.member', 'Org2.member')ç›¸åŒ OutOf(2, 'Org1.member', 'Org2.member', 'Org3.member') ä¸ OR(AND('Org1.member', 'Org2.member'), AND('Org1.member', 'Org3.member'), AND('Org2.member', 'Org3.member'))ç›¸åŒã€‚","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"Endorsement policies","slug":"Endorsement-policies","permalink":"https://guozhe001.github.io/tags/Endorsement-policies/"}]},{"title":"Application","slug":"blockchain/fabric/Application","date":"2021-04-01T10:18:21.466Z","updated":"2021-04-01T10:18:21.466Z","comments":true,"path":"2021/04/01/blockchain/fabric/Application/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/fabric/Application/","excerpt":"","text":"å®˜æ–¹æ–‡æ¡£ï¼šApplication Basic Flow A PaperNet application invokes the commercial paper smart contract to submit an issue transaction request. An application has to follow six basic steps to submit a transaction: Select an identity from a wallet Connect to a gateway Access the desired network Construct a transaction request for a smart contract Submit the transaction to the network Process the response Wallet Think of a wallet holding the digital equivalents of your government ID, driving license or ATM card. The X.509 digital certificates within it will associate the holder with a organization, thereby entitling them to rights in a network channel. For example, Isabella might be an administrator in MagnetoCorp, and this could give her more privileges than a different user â€“ Balaji from DigiBank. Moreover, a smart contract can retrieve this identity during smart contract processing using the transaction context. é’±åŒ…æ˜¯ä¿ç®¡äº†å¾ˆå¤šèº«ä»½ä¿¡æ¯çš„é’±åŒ…ã€‚ ï¼ˆä¸ªäººç†è§£ï¼šå°±å¥½åƒè°æˆ˜ç”µå½±é‡Œé¢çš„é—´è°ï¼Œæ‰“å¼€ä¸€ä¸ªæŠ½å±‰é‡Œé¢æœ‰è¿™ä¸ªé—´è°çš„ä¸åŒèº«ä»½çš„æŠ¤ç…§ã€‚ï¼‰ Gateway The second key class is a Fabric Gateway. Most importantly, a gateway identifies one or more peers that provide access to a networkã€‚ in our case, PaperNet. See how issue.js connects to its gateway: ç½‘å…³æ ‡è¯†ä¸€ä¸ªæˆ–å¤šä¸ªæä¾›å¯¹ç½‘ç»œè®¿é—®çš„èŠ‚ç‚¹ã€‚ 1await gateway.connect(connectionProfile, connectionOptions); gateway.connect() has two important parameters: connectionProfile: the file system location of a connection profile that identifies a set of peers as a gateway to PaperNet è¿æ¥é…ç½®æ–‡ä»¶çš„æ–‡ä»¶ç³»ç»Ÿä½ç½®ï¼Œè¯¥æ–‡ä»¶å°†ä¸€ç»„peeræ ‡è¯†ä¸ºPaperNetçš„gateway connectionOptions: a set of options used to control how issue.js interacts with PaperNet See how the client application uses a gateway to insulate itself from the network topology, which might change. The gateway takes care of sending the transaction proposal to the right peer nodes in the network using the connection profile and connection options. Network channel The peers defined in the gateway connectionProfile.yaml provide issue.js with access to PaperNet. Because these peers can be joined to multiple network channels, the gateway actually provides the application with access to multiple network channels! We can see here a powerful feature of Hyperledger Fabric â€“ applications can participate in a network of networks, by connecting to multiple gateway peers, each of which is joined to multiple network channels. Applications will have different rights in different channels according to their wallet identity provided in gateway.connect(). Construct request The application is now ready to issue a commercial paper. To do this, itâ€™s going to use CommercialPaperContract and again, its fairly straightforward to access this smart contract: Submit transaction Note that the submitTransaction API includes a process for listening for transaction commits. Listening for commits is required because without it, you will not know whether your transaction has successfully been orderered, validated, and committed to the ledger. Process response","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"Application","slug":"Application","permalink":"https://guozhe001.github.io/tags/Application/"}]},{"title":"ä»¥å¤ªåŠå­¦ä¹ ä¸å®è·µ","slug":"blockchain/eth/ä»¥å¤ªåŠå­¦ä¹ ä¸å®è·µ","date":"2021-04-01T10:18:21.462Z","updated":"2021-04-01T10:18:21.462Z","comments":true,"path":"2021/04/01/blockchain/eth/ä»¥å¤ªåŠå­¦ä¹ ä¸å®è·µ/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/eth/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%AD%A6%E4%B9%A0%E4%B8%8E%E5%AE%9E%E8%B7%B5/","excerpt":"","text":"ä¸€äº›èµ„æ–™","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"ethereum","slug":"åŒºå—é“¾/ethereum","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/ethereum/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"ethereum","slug":"ethereum","permalink":"https://guozhe001.github.io/tags/ethereum/"}]},{"title":"ä»¥å¤ªåŠå¦‚ä½•ä½¿ç”¨solidityå¼€å‘æ™ºèƒ½åˆçº¦","slug":"blockchain/eth/å¦‚ä½•å¼€å‘ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦","date":"2021-04-01T10:18:21.462Z","updated":"2021-04-01T10:18:21.462Z","comments":true,"path":"2021/04/01/blockchain/eth/å¦‚ä½•å¼€å‘ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/eth/%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%BB%A5%E5%A4%AA%E5%9D%8A%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/","excerpt":"","text":"ä¸€äº›å¼€å‘åˆçº¦ç›¸å…³èµ„æ–™ åˆçº¦å¼€å‘è¯­è¨€ï¼šsoliditylangï¼›ä¸­æ–‡ç‰ˆ å¼€å‘å·¥å…·ï¼šremix-project å¼€å‘ç½‘ç»œï¼šganacheï¼Œhardhatï¼Œscaffold-eth:ä»¥å¤ªåŠå¼€å‘all in one solcç‰ˆæœ¬åˆ—è¡¨ ç¯å¢ƒæ­å»ºï¼ˆMACï¼‰ å®‰è£…solidity 1brew install solidity å®‰è£…truffle truffleæ˜¯é›†æˆå®‰è£…ã€éƒ¨ç½²ã€æµ‹è¯•åˆçº¦ä¸ºä¸€ä½“çš„å¼€å‘æ¡†æ¶ï¼›å¦‚æœæ²¡æœ‰nodeç¯å¢ƒéœ€è¦å…ˆå®‰è£…node:brew install node 1npm install truffle -g åˆçº¦å¼€å‘ åˆå§‹åŒ–é¡¹ç›®è·¯å¾„ 1truffle init åˆå§‹åŒ–npmç¯å¢ƒ åœ¨åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ä¼šè®©ä½ è¾“å…¥ä¸€äº›å‚æ•°çš„å€¼ï¼Œå¯ä»¥ä¸€è·¯æŒ‰å›è½¦å…¨éƒ¨ä½¿ç”¨é»˜è®¤å€¼å³å¯ 1npm init å®‰è£…npmä¾èµ–åº“ 1npm install dotenv truffle-wallet-provider ethereumjs-wallet é…ç½®ç½‘ç»œ 123456789101112131415161718192021222324module.exports = &#123; networks: &#123; localnode: &#123; network_id: &quot;*&quot;, host: &quot;localhost&quot;, port: &quot;8545&quot; &#125; &#125;, mocha: &#123; // timeout: 100000 &#125;, compilers: &#123; solc: &#123; version: &quot;0.8.0+commit.c7dfd78e&quot;, // Fetch exact version from solc-bin (default: truffle&#x27;s version) &#125; &#125;, db: &#123; enabled: false &#125;&#125;; å¼€å‘åˆçº¦ æŒ‰ç…§ã€Šç²¾é€šä»¥å¤ªåŠã€‹ä¹¦æœ¬çš„ä¾‹å­å†™äº†ä¸€ä¸ªâ€œæ°´é¾™å¤´â€çš„åˆçº¦ï¼Œåªæœ‰ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªæå–ä»¥å¤ªå¸ï¼ˆwithdrawï¼‰ï¼Œä¸€ä¸ªæ¥æ”¶ä»¥å¤ªå¸ï¼ˆreceiveï¼‰ã€‚åˆçº¦çš„ä»£ç æ”¾åœ¨é¡¹ç›®çš„contractsç›®å½•ä¸‹ã€‚ 12345678910111213141516171819202122&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0pragma solidity &gt;&#x3D;0.7.0 &lt;0.8.0;&#x2F;&#x2F; my first contractcontract Faucet &#123; &#x2F;&#x2F; Give out ether to anyone who asks function withdraw(uint withdraw_amount) public &#123; &#x2F;&#x2F; limit withdrawal amount require(withdraw_amount &lt;&#x3D; 1 * 1000 * 1000 * 1000 * 1000); msg.sender.transfer(withdraw_amount); &#125; &#x2F;&#x2F; Accept any incoming amount ä¸€ä¸ªé»˜è®¤çš„å‡½æ•° &#x2F;&#x2F; fallback () external payable &#123;&#125; &#x2F;&#x2F; æ¨èä½¿ç”¨receive()å‡½æ•°æ¥æ¥æ”¶ä»¥å¤ªå¸ receive() external payable&#123;&#125;&#125; ç¼–è¯‘åˆçº¦ 1truffle compile éƒ¨ç½²åˆçº¦ å‚è€ƒmigrations/1_initial_migration.jsæ–‡ä»¶ï¼Œæ–°å»ºä¸€ä¸ª``migrations/2_initial_migration.jsï¼›(*æ³¨æ„ï¼š2_initial_migration.jsè¿™ä¸ªåå­—ä¸èƒ½ä»¥0`å¼€å¤´ï¼Œå¦åˆ™éƒ¨ç½²çš„æ—¶å€™ä¼šå¿½ç•¥ã€‚ã€‚ã€‚*)ä¿®æ”¹æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 123456const Faucet = artifacts.require(&quot;Faucet&quot;);module.exports = function (deployer) &#123; deployer.deploy(Faucet);&#125;; ç„¶åéƒ¨ç½²åˆ°æœ¬åœ°çš„æµ‹è¯•ç½‘ç»œï¼ˆè¦åœ¨æœ¬åœ°å¯åŠ¨truffleçš„ethereumæµ‹è¯•ç½‘ç»œï¼‰ï¼š 1truffle migrate --network localnode æ‰§è¡Œå®Œæˆä¹‹åçš„æ—¥å¿—å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172(base) w:Faucet apple$ truffle migrate --network localnodeCompiling your contracts...===========================&gt; Compiling ./contracts/Faucet.sol&gt; Artifacts written to /Users/apple/code/open-source/my-projects/etherum/Faucet/build/contracts&gt; Compiled successfully using: - solc: 0.8.0+commit.c7dfd78e.Emscripten.clangStarting migrations...======================&gt; Network name: &#x27;localnode&#x27;&gt; Network id: 1337&gt; Block gas limit: 6721975 (0x6691b7)1_initial_migration.js====================== Replacing &#x27;Migrations&#x27; ---------------------- &gt; transaction hash: 0xaf813946c7470d83c7fb1e8b535efebcfdd90540c72ee9092ae9e04775bf56bc &gt; Blocks: 0 Seconds: 0 &gt; contract address: 0x4445151f84Fd5E71aB93f0d9A1AC93fd7a454c10 &gt; block number: 1 &gt; block timestamp: 1615445677 &gt; account: 0xc0F680767D4Ae17C7adaF8C6d0b4805Bc207805e &gt; balance: 99.99511424 &gt; gas used: 244288 (0x3ba40) &gt; gas price: 20 gwei &gt; value sent: 0 ETH &gt; total cost: 0.00488576 ETH &gt; Saving migration to chain. &gt; Saving artifacts ------------------------------------- &gt; Total cost: 0.00488576 ETH2_initial_migration.js====================== Replacing &#x27;Faucet&#x27; ------------------ &gt; transaction hash: 0xcb451bc9f9347fa9983e5182ccc4453f1a3c7ac74b5c7785679913a7325f7715 &gt; Blocks: 0 Seconds: 0 &gt; contract address: 0x6B7d6480BC95EF2C51d2Ae247bDd2aC3bBA5690c &gt; block number: 3 &gt; block timestamp: 1615445677 &gt; account: 0xc0F680767D4Ae17C7adaF8C6d0b4805Bc207805e &gt; balance: 99.9888339 &gt; gas used: 271504 (0x42490) &gt; gas price: 20 gwei &gt; value sent: 0 ETH &gt; total cost: 0.00543008 ETH &gt; Saving migration to chain. &gt; Saving artifacts ------------------------------------- &gt; Total cost: 0.00543008 ETHSummary=======&gt; Total deployments: 2&gt; Final cost: 0.01031584 ETH ä½¿ç”¨truffleéƒ¨ç½²æ™ºèƒ½åˆçº¦åˆ°ropstenæµ‹è¯•ç½‘ç»œ å¯ä»¥åœ¨https://infura.io/ç½‘ç«™å»ºç«‹è´¦å·ï¼Œå¯ä»¥æŠŠå®ƒçœ‹æˆä¸€ä¸ªgethèŠ‚ç‚¹ï¼Œç„¶åä»–æä¾›äº†rpcæ¥å£ã€‚ é¦–æ¬¡æ‰§è¡Œéƒ¨ç½²ï¼ŒæŠ¥é”™è¯´HDWalletProvideræ²¡æœ‰å®šä¹‰ 123456789101112131415161718192021$ truffle migrate --network ropstenCompiling your contracts...===========================&gt; Compiling ./contracts/GZToken.sol&gt; Compiling ./contracts/Token2.sol&gt; Compiling ./contracts/Token3.sol&gt; Artifacts written to /Users/apple/code/open-source/my-projects/etherum/Faucet/build/contracts&gt; Compiled successfully using: - solc: 0.8.0+commit.c7dfd78e.Emscripten.clangReferenceError: HDWalletProvider is not defined at Object.provider (/Users/apple/code/open-source/my-projects/etherum/Faucet/truffle-config.js:62:21) at Object.getProvider (/usr/local/lib/node_modules/truffle/build/webpack:/packages/provider/index.js:20:1) at Object.create (/usr/local/lib/node_modules/truffle/build/webpack:/packages/provider/index.js:13:1) at TruffleConfig.get [as provider] (/usr/local/lib/node_modules/truffle/build/webpack:/packages/config/dist/configDefaults.js:204:1) at Object.detect (/usr/local/lib/node_modules/truffle/build/webpack:/packages/environment/environment.js:19:1) at Object.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/core/lib/commands/migrate.js:206:1) at Command.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/core/lib/command.js:136:1)Truffle v5.2.3 (core: 5.2.3)Node v14.16.0 è§£å†³æ–¹æ¡ˆï¼š æ·»åŠ ä¾èµ–ï¼š 12npm install truffle-hdwallet-providernpm install dotenv åœ¨ä¸truffle-config.jsç›¸åŒçš„ç›®å½•ä¸‹æ·»åŠ .evnæ–‡ä»¶ï¼Œç„¶åå†™å…¥ä½ çš„åŠ©è®°è¯ï¼Œå¦‚ï¼š 1mnemonic&#x3D;topic foster find apple famous have bonus month remain middle funny smart æ³¨æ„åœ¨gitignoreæ–‡ä»¶ä¸­æŠŠè¿™ä¸ªæ–‡ä»¶ï¼ˆ.evnï¼‰å¿½ç•¥ï¼Œé¿å…ä¸Šä¼ åˆ°github ä¿®æ”¹truffle-config.jsï¼šåœ¨æœ€ä¸Šé¢æ·»åŠ ï¼š 12345678// åœ¨ä½¿ç”¨infuraä½œä¸ºrpc-apiçš„æä¾›æ–¹æ—¶ï¼Œå› ä¸ºinfuraä¸ç®¡ç†æˆ‘ä»¬çš„ç§é’¥æ‰€ä»¥è¦åœ¨æœ¬åœ°æœ‰ä¸€ä¸ªé’±åŒ…ç”¨äºç­¾åvar HDWalletProvider = require(&quot;truffle-hdwallet-provider&quot;);// é»˜è®¤è¯»å–é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„.envæ–‡ä»¶,ç”¨process.env.è°ƒç”¨const result = require(&#x27;dotenv&#x27;).config(); if (result.error) &#123; throw result.error;&#125; ä¿®æ”¹ropstençš„é…ç½®å¦‚ä¸‹ï¼š 12345678ropsten: &#123; provider: () =&gt; new HDWalletProvider(process.env.mnemonic, `https://ropsten.infura.io/v3/your-id`), network_id: 3, // Ropsten&#x27;s id gas: 5500000, // Ropsten has a lower block limit than mainnet confirmations: 2, // # of confs to wait between deployments. (default: 0) timeoutBlocks: 200, // # of blocks before a deployment times out (minimum/default: 50) skipDryRun: true // Skip dry run before migrations? (default: false for public nets ) &#125;, é‡æ–°éƒ¨ç½²ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142$truffle migrate --network ropstenCompiling your contracts...===========================&gt; Compiling ./contracts/GZToken.sol&gt; Compiling ./contracts/Token3.sol&gt; Artifacts written to /Users/apple/code/open-source/my-projects/etherum/Faucet/build/contracts&gt; Compiled successfully using: - solc: 0.8.0+commit.c7dfd78e.Emscripten.clangStarting migrations...======================&gt; Network name: &#x27;ropsten&#x27;&gt; Network id: 3&gt; Block gas limit: 8000000 (0x7a1200)1_initial_migration.js====================== Deploying &#x27;Migrations&#x27; ----------------------Error: *** Deployment Failed ***&quot;Migrations&quot; -- insufficient funds for gas * price + value. at /usr/local/lib/node_modules/truffle/build/webpack:/packages/deployer/src/deployment.js:365:1 at processTicksAndRejections (internal/process/task_queues.js:93:5) at Migration._deploy (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/Migration.js:74:1) at Migration._load (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/Migration.js:61:1) at Migration.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/Migration.js:212:1) at Object.runMigrations (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/index.js:150:1) at Object.runFrom (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/index.js:110:1) at Object.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/migrate/index.js:87:1) at runMigrations (/usr/local/lib/node_modules/truffle/build/webpack:/packages/core/lib/commands/migrate.js:263:1) at Object.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/core/lib/commands/migrate.js:228:1) at Command.run (/usr/local/lib/node_modules/truffle/build/webpack:/packages/core/lib/command.js:136:1)Truffle v5.2.3 (core: 5.2.3)Node v14.16.0 åŸå› æ˜¯æ²¡æœ‰è¶³å¤Ÿçš„æ±½æ²¹è´¹ï¼Œå»https://faucet.ropsten.be/è·å–å³å¯ã€‚ åœ¨æ­¤é‡æ–°éƒ¨ç½²ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105$ truffle migrate --network ropstenCompiling your contracts...===========================&gt; Compiling ./contracts/Token3.sol&gt; Artifacts written to /Users/apple/code/open-source/my-projects/etherum/Faucet/build/contracts&gt; Compiled successfully using: - solc: 0.8.0+commit.c7dfd78e.Emscripten.clangStarting migrations...======================&gt; Network name: &#x27;ropsten&#x27;&gt; Network id: 3&gt; Block gas limit: 8000000 (0x7a1200)1_initial_migration.js====================== Deploying &#x27;Migrations&#x27; ---------------------- &gt; transaction hash: 0x212e4eee81d5fc3024db8d6787b36a51f070f832b94961605de18675d8f597d3 &gt; Blocks: 2 Seconds: 13 &gt; contract address: 0x0d4f7ff83b66e1E3377aacE5EFA70d9E036890c2 &gt; block number: 9941219 &gt; block timestamp: 1617088554 &gt; account: 0x2560be5793F9AA00963e163A1287807Feb897e2F &gt; balance: 0.99508824 &gt; gas used: 245588 (0x3bf54) &gt; gas price: 20 gwei &gt; value sent: 0 ETH &gt; total cost: 0.00491176 ETH Pausing for 2 confirmations... ------------------------------ &gt; confirmation number: 2 (block: 9941221) &gt; Saving migration to chain. &gt; Saving artifacts ------------------------------------- &gt; Total cost: 0.00491176 ETH2_initial_migration.js====================== Deploying &#x27;Faucet&#x27; ------------------ &gt; transaction hash: 0x40ead4c9b0fa1efb90d551e43587c10457e0c99deeaf4f804222645395435090 &gt; Blocks: 2 Seconds: 21 &gt; contract address: 0xE18C40cEf01bEedA140033892b4638CFBc464BbD &gt; block number: 9941227 &gt; block timestamp: 1617088603 &gt; account: 0x2560be5793F9AA00963e163A1287807Feb897e2F &gt; balance: 0.9887139 &gt; gas used: 272804 (0x429a4) &gt; gas price: 20 gwei &gt; value sent: 0 ETH &gt; total cost: 0.00545608 ETH Pausing for 2 confirmations... ------------------------------ &gt; confirmation number: 1 (block: 9941229) &gt; confirmation number: 2 (block: 9941230) &gt; Saving migration to chain. &gt; Saving artifacts ------------------------------------- &gt; Total cost: 0.00545608 ETH3_initial_migration.js====================== Deploying &#x27;GZToken&#x27; ------------------- &gt; transaction hash: 0xf28b9b32e6cbf0b12a44249dd4c6eb914706820daafc671e43cabb4541d5396b &gt; Blocks: 2 Seconds: 25 &gt; contract address: 0xB8DfEe0D9aC703E75EE3D031148227B3BbB26524 &gt; block number: 9941234 &gt; block timestamp: 1617088662 &gt; account: 0x2560be5793F9AA00963e163A1287807Feb897e2F &gt; balance: 0.9713052 &gt; gas used: 841622 (0xcd796) &gt; gas price: 20 gwei &gt; value sent: 0 ETH &gt; total cost: 0.01683244 ETH Pausing for 2 confirmations... ------------------------------ &gt; confirmation number: 1 (block: 9941235) &gt; confirmation number: 2 (block: 9941236) &gt; Saving migration to chain. &gt; Saving artifacts ------------------------------------- &gt; Total cost: 0.01683244 ETHSummary=======&gt; Total deployments: 3&gt; Final cost: 0.02720028 ETH è°ƒç”¨åˆçº¦çš„æŠ¥é”™æ±‡æ€»ï¼š 12Received unexpected error: out of gas 1intrinsic gas too low: have 0, want 21420 (supplied gas 0) ä¸Šé¢è¿™äº›å…¨éƒ¨éƒ½æ˜¯å› ä¸ºgasè´¹è®¾ç½®çš„å¤ªå°‘å¯¼è‡´çš„ã€‚ ä¸åˆçº¦äº¤äº’ åœ¨remixä¸­è°ƒç”¨åˆçº¦ åœ¨remixç½‘é¡µä¸­éƒ¨ç½²å®Œæˆåˆçº¦ä¹‹åï¼Œåœ¨ä¸‹é¢å¯ä»¥çœ‹åˆ°withdrawå‡½æ•°ï¼Œè¾“å…¥æç°çš„é‡‘é¢ç„¶åç‚¹å‡»transactæŒ‰é’®ï¼Œå°±å¯ä»¥è°ƒèµ·MetaMaskè°ƒç”¨æ™ºèƒ½åˆçº¦ã€‚ ä½¿ç”¨truffleçš„å‘½ä»¤è°ƒç”¨åˆçº¦ å¯åŠ¨truffleçš„consoleæ§åˆ¶å°ï¼š 1truffle console --network localnode æ‰“å¼€ä¹‹ååŒå‡»ä¸¤æ¬¡tabé”®ä¼šæœ‰å‘½ä»¤æç¤ºï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹éƒ¨ç½²çš„Faucetåˆçº¦çš„åœ°å€ï¼š 12truffle(localnode)&gt; Faucet.address&#x27;0x6B7d6480BC95EF2C51d2Ae247bDd2aC3bBA5690c&#x27; æŸ¥çœ‹æˆ‘ä»¬åˆçº¦çš„è´¦æˆ·ä½™é¢ï¼š 12truffle(localnode)&gt; web3.eth.getBalance(Faucet.address)&#x27;0&#x27; truffle develop develop Open a console with a local development blockchain 123456789101112131415161718192021222324252627282930313233343536373839truffle(develop)&gt; Faucet.deployed().then(i =&gt; &#123;FaucetDeployed = i&#125;)// å‘é€ç»™åˆçº¦1ä¸ªethtruffle(develop)&gt; FaucetDeployed.send(web3.utils.toWei(&quot;1&quot;, &quot;ether&quot;)).then(res =&gt; &#123; console.log(res.logs[0].event, res.logs[0].args) &#125;)Deposit Result &#123; &#x27;0&#x27;: &#x27;0xAC3509D2d2746B6fEC873087AAB9394d03472131&#x27;, &#x27;1&#x27;: BN &#123; negative: 0, words: [ 56885248, 2993385, 222, &lt;1 empty item&gt; ], length: 3, red: null &#125;, __length__: 2, to: &#x27;0xAC3509D2d2746B6fEC873087AAB9394d03472131&#x27;, amount: BN &#123; negative: 0, words: [ 56885248, 2993385, 222, &lt;1 empty item&gt; ], length: 3, red: null &#125;&#125;// ä»åˆçº¦æå–0.1ethtruffle(develop)&gt; FaucetDeployed.withdraw(web3.utils.toWei(&quot;0.1&quot;, &quot;ether&quot;)).then(res =&gt; &#123; console.log(res.logs[0].event, res.logs[0].args) &#125;)Withdrawal Result &#123; &#x27;0&#x27;: &#x27;0xAC3509D2d2746B6fEC873087AAB9394d03472131&#x27;, &#x27;1&#x27;: BN &#123; negative: 0, words: [ 25821184, 13721111, 22, &lt;1 empty item&gt; ], length: 3, red: null &#125;, __length__: 2, to: &#x27;0xAC3509D2d2746B6fEC873087AAB9394d03472131&#x27;, amount: BN &#123; negative: 0, words: [ 25821184, 13721111, 22, &lt;1 empty item&gt; ], length: 3, red: null &#125;&#125; ä¸Gasè´¹ç›¸å…³çš„æ³¨æ„äº‹é¡¹ å¦‚æœåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­gasè´¹è€—å°½ï¼Œä¼šè§¦å‘å¦‚ä¸‹ä¸€ç³»åˆ—äº‹ä»¶ï¼š æŠ›å‡ºâ€œout of gasâ€å¼‚å¸¸ çŠ¶æ€è¢«æ¢å¤åˆ°æ‰§è¡Œå¼€å§‹ä¹‹å‰ æ‰€æœ‰åœ¨è¿™æ¬¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„gaså¼€é”€éƒ½ä¼šè¢«ä½œä¸ºäº¤æ˜“è´¹ç”¨ï¼Œä»¥å¤ªåŠä¸ä¼šå› ä¸ºäº¤æ˜“ä¸­æ­¢è€Œé€€å›gasæˆ–ä»¥å¤ªå¸ã€‚ å¦‚ä½•æŠŠåˆçº¦å‡½æ•°è°ƒç”¨çš„gasè´¹æ¶ˆè€—æœ€å°åŒ– é¿å…åŠ¨æ€å°ºå¯¸çš„æ•°ç»„ ä¾‹å¦‚å¯¹æ•°ç»„çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œæ“ä½œï¼Œæˆ–è€…é€šè¿‡éå†çš„æ–¹å¼æŸ¥æ‰¾æ•°ç»„ä¸­çš„æŸä¸ªå€¼ã€‚ é¿å…è°ƒç”¨å…¶ä»–åˆçº¦ è°ƒç”¨å…¶ä»–åˆçº¦ï¼Œç‰¹åˆ«æ˜¯é‚£äº›gasæ¶ˆè€—æœªçŸ¥çš„åˆçº¦ï¼Œå¯èƒ½ä¼šäº§ç”Ÿé«˜æ˜‚çš„gaså¼€é”€ã€‚ ä¼°è®¡gaså¼€é”€","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"ethereum","slug":"åŒºå—é“¾/ethereum","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/ethereum/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"ethereum","slug":"ethereum","permalink":"https://guozhe001.github.io/tags/ethereum/"},{"name":"æ™ºèƒ½åˆçº¦","slug":"æ™ºèƒ½åˆçº¦","permalink":"https://guozhe001.github.io/tags/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/"},{"name":"solidity","slug":"solidity","permalink":"https://guozhe001.github.io/tags/solidity/"}]},{"title":"ä»¥å¤ªåŠåˆçº¦å¼€å‘æœ€ä½³å®‰å…¨æŒ‡å—ä¸åæ¨¡å¼","slug":"blockchain/eth/ä»¥å¤ªåŠåˆçº¦å¼€å‘æœ€ä½³å®‰å…¨æŒ‡å—ä¸åæ¨¡å¼","date":"2021-04-01T10:18:21.461Z","updated":"2021-04-01T10:18:21.461Z","comments":true,"path":"2021/04/01/blockchain/eth/ä»¥å¤ªåŠåˆçº¦å¼€å‘æœ€ä½³å®‰å…¨æŒ‡å—ä¸åæ¨¡å¼/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/eth/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%90%88%E7%BA%A6%E5%BC%80%E5%8F%91%E6%9C%80%E4%BD%B3%E5%AE%89%E5%85%A8%E6%8C%87%E5%8D%97%E4%B8%8E%E5%8F%8D%E6%A8%A1%E5%BC%8F/","excerpt":"","text":"å®‰å…¨ ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦ â€”â€” æœ€ä½³å®‰å…¨å¼€å‘æŒ‡å—ï¼š æœ€ä½³å®è·µä¸­æ‰€ä½“ç°å‡ºçš„è¿™äº›ç‰¹æ€§ï¼Œå…¶å®æ˜¯æ‰€æœ‰è½¯ä»¶å¼€å‘ä¸­éƒ½éœ€è¦çš„ï¼›è€Œåœ¨æ™ºèƒ½åˆçº¦ä»£ç ä¸­å°¤å…¶é‡è¦æ˜¯å› ä¸ºåˆçº¦ä¸€æ—¦éƒ¨ç½²æ— æ³•å†åšä»»ä½•æ›´æ”¹ã€‚ æœ€å°åŒ–/ç®€å•åŒ– ä»£ç é‡ç”¨ ä»£ç è´¨é‡ å¯è¯»æ€§å’Œå¯å®¡è®¡æ€§ æµ‹è¯•è¦†ç›–ç‡ å®‰å…¨é£é™©å’Œåæ¨¡å¼ æœ‰æ¼æ´åˆçº¦çš„ä¾‹å­ é‡å…¥ æœ€æœ‰åçš„ä¾‹å­å°±æ˜¯The DAOï¼Œcodeï¼š 12345678910111213function getBalance(address user) constant returns(uint) &#123; return userBalances[user];&#125;function addToBalance() &#123; userBalances[msg.sender] +&#x3D; msg.amount;&#125;function withdrawBalance() &#123; amountToWithdraw &#x3D; userBalances[msg.sender]; if (!(msg.sender.call.value(amountToWithdraw)())) &#123; throw; &#125; userBalances[msg.sender] &#x3D; 0;&#125; é˜²èŒƒæŠ€æœ¯ ä½¿ç”¨transferæ–¹æ³•è½¬è´¦ï¼Œå› ä¸ºtransferæ–¹æ³•è½¬è´¦æ—¶åªä¼šå¸¦2300gasï¼Œè¿™äº›gasä¸è¶³ä»¥è®©å…¶ä»–åˆçº¦å†åšå…¶ä»–çš„æ“ä½œ åœ¨è½¬è´¦ä¹‹å‰å…ˆä¿®æ”¹çŠ¶æ€ï¼ˆæ£€æŸ¥-ä¿®æ”¹-äº¤äº’ï¼‰ ç®—æ•°æº¢å‡º 1234567891011121314151617181920212223242526&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0pragma solidity&#x3D;0.8.0;contract TimeLock &#123; mapping(address &#x3D;&gt; uint) public balances; mapping(address &#x3D;&gt; uint) public lockTime; function deposit() public payable &#123; balances[msg.sender] +&#x3D; msg.value; lockTime[msg.sender] &#x3D; block.timestamp + 1 weeks; &#125; function increaseLockTime(uint _secondsToIncrease) public &#123; lockTime[msg.sender] +&#x3D; _secondsToIncrease; &#125; function withdraw() public &#123; require(lockTime[msg.sender] &lt; block.timestamp); require(balances[msg.sender] &gt; 0); balances[msg.sender] &#x3D; 0; payable(msg.sender).transfer(balances[msg.sender]); &#125; &#125; é˜²èŒƒæŠ€æœ¯ ä½¿ç”¨SafeMathåº“ æ„å¤–çš„ä»¥å¤ªå¸ æœ‰ä¸¤ç§æ–¹å¼åœ¨åˆçº¦æ²¡æœ‰payableæ–¹æ³•æ—¶ä¹Ÿèƒ½å¤Ÿå¼ºåˆ¶ç»™åˆçº¦è½¬å…¥ä»¥å¤ªå¸ï¼š self-destructï¼šåœ¨ä¸€ä¸ªåˆçº¦ä½¿ç”¨selfdestructå‡½æ•°å°†ä»£ç æ¸…é™¤æ—¶ï¼Œå¯ä»¥æŠŠéœ€è¦è‡ªæ¯çš„åˆçº¦ä¸­çš„ä»¥å¤ªå¸è½¬å…¥åˆ°æŒ‡å®šçš„åœ°å€ é¢„å…ˆå‘é€çš„ä»¥å¤ªå¸ï¼šåˆçº¦çš„åœ°å€æ˜¯æ ¹æ®åˆ›å»ºè¿™ä¸ªåˆçº¦çš„è´¦æˆ·åœ°å€å’Œäº¤æ˜“nonceé€šè¿‡Keccak256è®¡ç®—å‡ºæ¥çš„ï¼Œæ‰€ä»¥å…¶å®æ˜¯å¯ä»¥é¢„å…ˆç»™ä¸€ä¸ªåˆçº¦å‘é€ä»¥å¤ªå¸çš„ è¿™ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ å¥½åƒæœ‰äººç»™æˆ‘çš„åˆçº¦å‘é€ä»¥å¤ªå¸å¹¶ä¸æ˜¯ä»€ä¹ˆåäº‹ï¼Œä¸æ˜¯å—ï¼Ÿ 1234567891011121314151617181920212223242526272829303132&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0pragma solidity&#x3D;0.8.0;contract EtherGame &#123; uint public constant three &#x3D; 3; uint public constant six &#x3D; 6; uint public constant nine &#x3D; 9; uint public constant finalAmount &#x3D; 10; mapping(address &#x3D;&gt; uint) public redeemableEther; function play() public payable &#123; require(msg.value &#x3D;&#x3D; 0.5 ether); uint currentBalance &#x3D; address(this).balance + msg.value; require(currentBalance &lt;&#x3D; finalAmount); if (currentBalance &#x3D;&#x3D; three || currentBalance &#x3D;&#x3D; six || currentBalance &#x3D;&#x3D; nine) &#123; redeemableEther[msg.sender] +&#x3D; currentBalance; &#125; &#125; function getRedeem() public &#123; require(address(this).balance &#x3D;&#x3D; finalAmount); uint transferValue &#x3D; redeemableEther[msg.sender]; require(transferValue &gt; 0); redeemableEther[msg.sender] &#x3D; 0; payable(msg.sender).transfer(transferValue); &#125; &#125; é˜²èŒƒæŠ€æœ¯ æ…ç”¨this.balance;å¦‚ä¸Šé¢çš„åˆçº¦å¯ä»¥æ”¹ä¸ºï¼š 1234567891011121314151617181920212223242526272829303132333435&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0pragma solidity&#x3D;0.8.0;contract EtherGame &#123; uint public constant three &#x3D; 3; uint public constant six &#x3D; 6; uint public constant nine &#x3D; 9; uint public constant finalAmount &#x3D; 10; uint public depositedWei; mapping(address &#x3D;&gt; uint) public redeemableEther; function play() public payable &#123; require(msg.value &#x3D;&#x3D; 0.5 ether); uint currentBalance &#x3D; depositedWei + msg.value; require(currentBalance &lt;&#x3D; finalAmount); if (currentBalance &#x3D;&#x3D; three || currentBalance &#x3D;&#x3D; six || currentBalance &#x3D;&#x3D; nine) &#123; redeemableEther[msg.sender] +&#x3D; currentBalance; &#125; depositedWei +&#x3D; msg.value; &#125; function getRedeem() public &#123; require(depositedWei &#x3D;&#x3D; finalAmount); uint transferValue &#x3D; redeemableEther[msg.sender]; require(transferValue &gt; 0); redeemableEther[msg.sender] &#x3D; 0; payable(msg.sender).transfer(transferValue); &#125; &#125; DELEGATECALL DELEGATECALLè°ƒç”¨æ˜¯ä½¿ç”¨å½“å‰çš„ä¸Šä¸‹æ–‡è°ƒç”¨ç›®æ ‡åˆçº¦ï¼Œå¹¶ä¸”ä¼šä»¥ä¸»è°ƒç”¨åˆçº¦çš„çŠ¶æ€æ¥è¿è¡Œã€‚ä¹Ÿå°±æ˜¯ç›®æ ‡åˆçº¦çš„çŠ¶æ€å­˜å‚¨æ§½çš„æ•°æ®ä¼šå˜æˆä¸»è°ƒç”¨åˆçº¦çš„çŠ¶æ€å­˜å‚¨æ§½çš„æ•°æ®ã€‚ é˜²èŒƒæŠ€æœ¯ DELEGATECALLè°ƒç”¨æ—¶è¦éå¸¸ä»”ç»†çš„æ³¨æ„è°ƒç”¨çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”å°½å¯èƒ½çš„æ„å»ºæ— çŠ¶æ€çš„åº“åˆçº¦ é»˜è®¤çš„å¯è§æ€§ å‡½æ•°çš„é»˜è®¤å¯è§æ€§æ˜¯public çŠ¶æ€å˜é‡é»˜è®¤å¯è§æ€§æ˜¯internal æ‰€ä»¥å¦‚æœä¸€ä¸ªå‡½æ•°å¿˜è®°äº†å†™å¯è§æ€§å…³é”®å­—ï¼Œåˆ™æ‰€æœ‰äººï¼ˆåŒ…æ‹¬å¤–éƒ¨è´¦æˆ·å’Œåˆçº¦è´¦æˆ·ï¼‰éƒ½å¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚ é˜²èŒƒæŠ€æœ¯ ä¸ºåˆçº¦ä¸­çš„æ‰€æœ‰å‡½æ•°éƒ½æ˜ç¡®æŒ‡å®šå¯è§æ€§æ—¶æœ€ä½³å®è·µã€‚ æ— åºé”™è§‰ ä»¥å¤ªåŠå†…éƒ¨å‡ ä¹æ²¡æœ‰éšæœºæ€§ï¼Œå¦‚æœåˆçº¦é€šè¿‡åˆ¤æ–­æœªæ¥çš„åŒºå—å¤§å°ã€hashã€gasä¸Šé™ã€æ—¶é—´æˆ³ç­‰æ¥è¿›è¡ŒçŠ¶æ€çš„å˜æ›´ï¼›è¿™äº›å˜é‡éƒ½å¯èƒ½è¢«çŸ¿å·¥æ‰€æ§åˆ¶ã€‚ é˜²èŒƒæŠ€æœ¯ ä½¿ç”¨å¤–éƒ¨çš„oracleæœ€ä¸ºéšæœºæºæ¥ä¿è¯éšæœºæ€§ã€‚å¦‚RANDAO å¤–éƒ¨åˆçº¦å¼•ç”¨ å¦‚æœä¸€ä¸ªåˆçº¦è¦å¼•ç”¨å…¶ä»–çš„å¤–éƒ¨åˆçº¦ï¼Œå¦‚ä½•å¼•ç”¨æ˜¯ä¸€ä¸ªé—®é¢˜ï¼›å¦‚æœåœ¨æ„é€ æ–¹æ³•ä¸­é€šè¿‡è¾“å…¥åœ°å€æ¥å¼•ç”¨ï¼Œåˆ™ä¼šæœ‰å¯èƒ½å› ä¸ºè¾“é”™åœ°å€è€Œå¯¼è‡´å¼•ç”¨é”™è¯¯ã€‚ èœœç½åˆçº¦ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172&#x2F;** *Submitted for verification at Etherscan.io on 2018-02-09*&#x2F;pragma solidity ^0.4.19;contract Private_Bank&#123; mapping (address &#x3D;&gt; uint) public balances; uint public MinDeposit &#x3D; 1 ether; Log TransferLog; function Private_Bank(address _log) &#123; TransferLog &#x3D; Log(_log); &#125; function Deposit() public payable &#123; if(msg.value &gt;&#x3D; MinDeposit) &#123; balances[msg.sender]+&#x3D;msg.value; TransferLog.AddMessage(msg.sender,msg.value,&quot;Deposit&quot;); &#125; &#125; function CashOut(uint _am) &#123; if(_am&lt;&#x3D;balances[msg.sender]) &#123; if(msg.sender.call.value(_am)()) &#123; balances[msg.sender]-&#x3D;_am; TransferLog.AddMessage(msg.sender,_am,&quot;CashOut&quot;); &#125; &#125; &#125; function() public payable&#123;&#125; &#125;contract Log &#123; struct Message &#123; address Sender; string Data; uint Val; uint Time; &#125; Message[] public History; Message LastMsg; function AddMessage(address _adr,uint _val,string _data) public &#123; LastMsg.Sender &#x3D; _adr; LastMsg.Time &#x3D; now; LastMsg.Val &#x3D; _val; LastMsg.Data &#x3D; _data; History.push(LastMsg); &#125;&#125; é˜²èŒƒæŠ€æœ¯ åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨newçš„æ–¹æ³•æ¥å¼•ç”¨å…¶ä»–åˆçº¦ åœ¨å¼•ç”¨å…¶ä»–åˆçº¦æ—¶å¯¹å¤–éƒ¨åˆçº¦åœ°å€è¿›è¡Œç¡¬ç¼–ç ï¼ˆå°±ç®—ç¡¬ç¼–ç ä¹Ÿä¸èƒ½100%å®Œå…¨çš„ä¸è¾“é”™ï¼Œä½†æ˜¯è¿™å¾ˆå®¹æ˜“å®¡æŸ¥ï¼‰ çŸ­åœ°å€/å‚æ•°æ”»å‡» æ¼æ´çš„ç»†èŠ‚ å½“æˆ‘ä»¬å‘æ™ºèƒ½åˆçº¦ä¼ é€’å‚æ•°æ—¶ï¼Œè¿™äº›å‚æ•°éœ€è¦ä¾ç…§ABIè§„èŒƒè¿›è¡Œç¼–ç ã€‚ä¸è¿‡å‘é€çš„å®é™…æ•°æ®é•¿åº¦å°äºæ ‡å‡†çš„å‚æ•°ç¼–ç é•¿åº¦ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒEVMä¼šåœ¨æ•°æ®çš„æœ«å°¾è¡¥0æ¥ä½¿æ•°æ®é•¿åº¦è¾¾åˆ°è¦æ±‚ã€‚ é˜²èŒƒæŠ€æœ¯ æ‰€æœ‰çš„å¤–éƒ¨åº”ç”¨åœ¨æŠŠè¾“å…¥å‚æ•°å‘é€åˆ°åŒºå—é“¾ä¹‹å‰éƒ½åº”è¯¥å¯¹ä»–ä»¬è¿›è¡Œæ ¡éªŒã€‚ æœªæ£€æŸ¥çš„è°ƒç”¨è¿”å›å€¼ åœ¨ä½¿ç”¨callæˆ–è€…sendè¿›è¡Œå¤–éƒ¨è°ƒç”¨æ—¶ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªboolç±»å‹çš„ç»“æœï¼Œå¦‚æœä¸æ£€æŸ¥è¿™ä¸ªç»“æœå°±ç»§ç»­å¾€ä¸‹è¿›è¡Œï¼Œæœ‰å¯èƒ½å¯¼è‡´callæˆ–sendçš„è°ƒç”¨å¤±è´¥ï¼Œè€Œä¹‹åçš„ä»£ç æ‰§è¡ŒæˆåŠŸã€‚ï¼ˆå¾ˆåƒæœ¬åº”è¯¥åœ¨åŒä¸€ä¸ªäº‹ç‰©ä¸­æ‰§è¡Œçš„ä¸¤ä¸ªæ“ä½œï¼Œç¬¬ä¸€ä¸ªæ“ä½œå¤±è´¥äº†ï¼Œç¬¬äºŒä¸ªæ“ä½œå´æˆåŠŸäº†ï¼Œæœ€ç»ˆå¯¼è‡´æœ‰é—®é¢˜ã€‚ï¼‰ 12345678910111213141516171819202122232425262728293031&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0pragma solidity&#x3D;0.8.0;contract Lotto &#123; address public winner; bool public payedOut &#x3D; false; uint public winAmount; function play() public payable &#123; winAmount +&#x3D; msg.value; if(msg.sender &#x3D;&#x3D; address(0x2560be5793F9AA00963e163A1287807Feb897e2F)) &#123; winner &#x3D; msg.sender; &#125; &#125; function sendToWinner() public &#123; require(!payedOut); payable(winner).send(winAmount); payedOut &#x3D; true; &#125; function withdrawLeftOver() public &#123; require(payedOut); payable(msg.sender).transfer(winAmount); &#125; &#125; é˜²èŒƒæŠ€æœ¯ å°½å¯èƒ½çš„ä½¿ç”¨transferå‡½æ•°è€Œä¸æ˜¯sendï¼Œå› ä¸ºtransferå‡½æ•°ä¼šåœ¨å¤–éƒ¨è°ƒç”¨å¤±è´¥æ—¶revertã€‚ ç«äº‰æ¡ä»¶/é¢„å…ˆäº¤æ˜“ åœ¨ç›®å‰Powçš„å…±è¯†æ–¹å¼ä¸‹ï¼Œä»¥å¤ªåŠç½‘ç»œä¸Šçš„æ‰€æœ‰çš„äº¤æ˜“éƒ½æ˜¯ç”±çŸ¿å·¥ä»äº¤æ˜“æ± ä¸­é€‰æ‹©éƒ¨åˆ†äº¤æ˜“æ‰“åŒ…æˆåŒºå—çš„ï¼Œè€ŒçŸ¿å·¥åœ¨æ‰“åŒ…åŒºå—çš„æ—¶å€™ä¼šä¼˜å…ˆæ‰“åŒ…gasè´¹å¤šçš„äº¤æ˜“ã€‚å› æ­¤å¦‚æœä¸€ä¸ªäººç›‘å¬äº†äº¤æ˜“æ± ä¸­æŸä¸ªåˆçº¦ï¼ˆå¦‚çŒœè°œè¯­ï¼‰çš„äº¤æ˜“ï¼Œé‚£ä¹ˆä»–åœ¨çœ‹åˆ°åˆ«äººçŒœä¸­çš„ç­”æ¡ˆæ—¶é©¬ä¸Šå‘å¸ƒä¸€ä¸ªgasè´¹æ›´é«˜çš„åŒæ ·ç­”æ¡ˆçš„äº¤æ˜“å°±å¾ˆæœ‰å¯èƒ½ä¼šæå‰è¢«ç¡®è®¤ã€‚ é˜²èŒƒæŠ€æœ¯ èƒ½å¤Ÿå‘èµ·è¿™ç§æ”»å‡»çš„äººæœ‰ä¸¤ç§ï¼š æ™®é€šç”¨æˆ·é€šè¿‡æé«˜äº¤æ˜“è´¹çš„æ–¹å¼è¿›è¡Œæ”»å‡» çŸ¿å·¥è‡ªå·±å¯¹äº¤æ˜“è¿›è¡Œæ”»å‡» ç¬¬ä¸€ç§é˜²èŒƒæ–¹æ³•æ˜¯è®¾ç½®gasè´¹çš„ä¸Šé™ï¼Œè¿™æ ·å°±èƒ½ä¸€å®šç¨‹åº¦çš„é¿å…ç”¨æˆ·é€šè¿‡æäº¤äº¤æ˜“è´¹æ¥è¿›è¡Œæå‰ç¡®è®¤ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼æ— æ³•é˜²èŒƒçŸ¿å·¥ã€‚ ç¬¬äºŒç§é˜²èŒƒæ–¹æ³•æ˜¯ï¼ˆæäº¤-æ­ç¤ºï¼‰ï¼Œå³å…ˆæäº¤ä¸€ä¸ªç­”æ¡ˆçš„hashï¼Œç„¶åå†æäº¤ç­”æ¡ˆã€‚ æ‹’ç»æœåŠ¡ åŸºäºå¯è¢«å¤–éƒ¨æ“çºµçš„æ˜ å°„æˆ–æ•°ç»„çš„å¾ªç¯ 12345678910111213141516171819202122232425262728&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0contract DistributeTokens &#123; address public owner; address[] investors; uint[] investorTokens; function inverst() public payable &#123; investors.push(msg.sender); investorTokens.push(msg.value * 5); &#125; modifier onlyOwner() &#123; require(address(msg.sender) &#x3D;&#x3D; owner); _; &#125; function distribute() public onlyOwner &#123; for (uint i &#x3D; 0; i &lt; investors.length; i++) &#123; transferToken(investors[i], investorTokens[i]); &#125; &#125;&#125; ä¸»äººçš„æ“ä½œ å¦‚æœä¸€ä¸ªåˆçº¦åªèƒ½ç”±åˆçº¦çš„ä¸»äººåšä¸€äº›æ“ä½œæ‰èƒ½è¿›å…¥ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œé‚£ä¹ˆå¦‚æœåˆçº¦çš„ä¸»äººå¤±å»äº†è¡Œä¸ºèƒ½åŠ›æˆ–è€…ä¸¢å¤±äº†ç§é’¥é‚£ä¹ˆè¿™ä¸ªåˆçº¦å°±æ°¸è¿œæ— æ³•è¿›å…¥ä¸‹ä¸€ä¸ªçŠ¶æ€äº†ã€‚ 12345678910111213141516171819202122232425262728293031&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0pragma solidity&#x3D;0.8.0;contract ICO &#123; bool public isFinalized &#x3D; false; address public owner; constructor () &#123; owner&#x3D; msg.sender; &#125; mapping(address &#x3D;&gt; uint) public monery; function giveMe() public payable &#123; monery[msg.sender] +&#x3D; msg.value; &#125; function finalize() public &#123; require(msg.sender &#x3D;&#x3D; owner); isFinalized &#x3D; true; &#125; function withdraw() public &#123; require(isFinalized); payable(msg.sender).transfer(monery[msg.sender]); &#125; &#125; åŸºäºå¤–éƒ¨è°ƒç”¨æ¥ä¿®æ”¹çŠ¶æ€ å¦‚æœä¸€ä¸ªåˆçº¦åªæœ‰æŠŠä½™é¢è½¬ç§»åˆ°å¤–éƒ¨çš„æŸä¸ªè´¦æˆ·æ—¶æ‰èƒ½å¤Ÿæ›´æ”¹çŠ¶æ€ï¼Œé‚£ä¹ˆå¤–éƒ¨çš„é‚£ä¸ªè´¦æˆ·å¦‚æœæ²¡æœ‰fallbackä¹‹ç±»çš„ç”¨äºæ¥æ”¶ä»¥å¤ªå¸çš„å‡½æ•°çš„è¯ï¼Œå½“å‰çš„å‡½æ•°æ°¸è¿œéƒ½æ— æ³•è¿›å…¥ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚ é˜²èŒƒæŠ€æœ¯ ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œåˆçº¦ä¸åº”è¯¥åŸºäºä¸€ä¸ªå¯ä»¥è¢«å¤–éƒ¨ç”¨æˆ·äººä¸ºæ“çºµçš„æ•°æ®ç»“æ„æ¥æ‰§è¡Œå¾ªç¯ã€‚æ¨èä½¿ç”¨å–å›æ¨¡å¼ï¼Œè®©æ¯ä¸ªå–æ¬¾äººå•ç‹¬çš„è°ƒç”¨withdrawå‡½æ•°æ¥å–å›ä»–ä»¬å„è‡ªçš„ä»£å¸ã€‚ ç¬¬äºŒä¸ªä¾‹å­ï¼Œå°†ä¸»äººè®¾å®šä¸ºå¤šé‡ç­¾ååˆçº¦ï¼›æˆ–è€…æ˜¯ä½¿ç”¨æ—¶é—´é”ï¼ˆrequire(msg.sender ==owner || block.timestamp &gt; unlockTime)ï¼‰ã€‚ åŒºå—æ—¶é—´æˆ³æ“çºµ ä¸‹é¢çš„ä»£ç ï¼Œå¦‚æœæ—¶é—´æˆ³æ˜¯15çš„å€æ•°åˆ™èƒ½å–èµ°å½“å‰åˆçº¦çš„æ‰€æœ‰ä½™é¢ã€‚ä½†æ˜¯æ—¶é—´æˆ³æ˜¯å¯ä»¥è¢«çŸ¿å·¥è½»å¾®çš„è°ƒæ•´çš„ã€‚ 123456789101112131415161718192021&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0pragma solidity&#x3D;0.8.0;contract Roulette &#123; uint public pastBlockTime; constructor() payable &#123; &#125; fallback() external payable &#123; require(msg.value &#x3D;&#x3D; 10 ether); require(block.timestamp !&#x3D; pastBlockTime); pastBlockTime &#x3D; block.timestamp; if (pastBlockTime % 15 &#x3D;&#x3D; 0) &#123; payable(msg.sender).transfer(address(this).balance); &#125; &#125;&#125; é˜²èŒƒæŠ€æœ¯ åŒºå—çš„æ—¶é—´æˆ³ä¸åº”è¯¥è¢«ç”¨æ¥ä½œä¸ºæ— åºæ•°æ®æˆ–ç”Ÿæˆéšæœºæ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»–ä»¬ä¸åº”è¯¥ç”¨æ¥ä½œä¸ºæ¸¸æˆçš„è·èƒœæ¡ä»¶æˆ–è€…ç”¨æ¥åˆ¤æ–­ä¸€ä¸ªé‡è¦çš„çŠ¶æ€å˜åŠ¨ã€‚ å¦‚æœåˆçº¦éœ€è¦æ„ŸçŸ¥æ—¶é—´çš„é€»è¾‘ï¼Œå¦‚è§£é”åˆçº¦ï¼ˆåŸºäºæ—¶é—´é”ï¼‰ï¼Œåœ¨ICOå¼€å§‹å‡ å‘¨ä¹‹åæ¥ç»“æŸå®ƒæˆ–è€…å¼ºåˆ¶æŒ‡å®šä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚æœ‰äº›æƒ…å†µæ¨èä½¿ç”¨block.numberå’Œå¹³å‡åŒºå—æ—¶é—´æ¥ä¼°ç®—æ—¶é—´æ¡ä»¶ã€‚ å°å¿ƒä½¿ç”¨æ„é€ å‡½æ•° åœ¨Solidity v0.4.22ä¹‹å‰ï¼Œå’Œåˆçº¦åç§°ç›¸åŒçš„å‡½æ•°å°±æ˜¯æ„é€ å‡½æ•°ã€‚å¦‚æœåˆçº¦ä¿®æ”¹äº†åç§°ä½†æ˜¯å¿˜äº†æ”¹æ„é€ å‡½æ•°çš„åç§°ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±å˜æˆäº†ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ã€‚ 123456789101112131415161718192021&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0pragma solidity&#x3D;0.4.1;contract OwnerWallet &#123; address public owner; function ownerWallet() &#123; owner &#x3D; msg.sender; &#125; function () public payable &#123; &#125; function withdraw() public &#123; require(msg.sender &#x3D;&#x3D; owner); msg.sender.transfer(this.balance); &#125; &#125; é˜²èŒƒæŠ€æœ¯ Solidity v0.4.22ä¹‹åçš„ç‰ˆæœ¬çš„æ„é€ å‡½æ•°æ˜¯é€šè¿‡constructorå…³é”®å­—ç”Ÿå‘½ï¼ŒSolidityçš„ç‰ˆæœ¬å˜åŒ–è¾ƒå¿«ï¼Œå°½é‡é€‰æ‹©è¾ƒæ–°çš„ç¨³å®šç‰ˆæœ¬ã€‚ æœªåˆå§‹åŒ–çš„å­˜å‚¨æŒ‡é’ˆ EVMæ˜¯ç”¨å­˜å‚¨ï¼ˆstoraegeï¼‰æˆ–å†…å­˜ï¼ˆmemoryï¼‰æ¥ä¿å­˜æ•°æ®çš„ã€‚å‡½æ•°ä¸­è½­å±€éƒ¨å˜é‡é»˜è®¤åœ¨å­˜å‚¨ä¸­è¿˜æ˜¯åœ¨å†…å­˜ä¸­ï¼Œå–å†³äºä»–ä»¬çš„ç±»å‹ã€‚ // TODO å­˜å‚¨æŒ‡é’ˆè¿™ä¸€å—è¿˜æ²¡æœ‰ææ‡‚ï¼Œåç»­å†è¡¥å……ã€‚ æµ®ç‚¹æ•°å’Œç²¾åº¦ ä¸‹é¢çš„åˆçº¦buyTokensæ–¹æ³•åœ¨æ”¯ä»˜çš„ä»¥å¤ªå¸å°äº1etheræ—¶ï¼Œå¾—åˆ°çš„tokenä¼šæ˜¯0ï¼›æˆ–è€…è¯´ä¼šæŠŠå°äº1etherçš„éƒ¨åˆ†å…¨éƒ¨èˆå»å¯¼è‡´å‡ºé”™ã€‚ 1234567891011121314151617181920212223242526&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0pragma solidity&#x3D;0.8.0;contract FunWithNumbers &#123; uint constant public tokensPerEth &#x3D; 10; uint constant public weiPerEth &#x3D; 1e18; mapping(address &#x3D;&gt; uint) public balances; function buyTokens() public payable &#123; uint tokens &#x3D; msg.value &#x2F; weiPerEth * tokensPerEth; balances[msg.sender] &#x3D; tokens; &#125; function sellTokens(uint tokens) public &#123; require(tokens &lt; balances[msg.sender]); balances[msg.sender] -&#x3D; tokens; payable(msg.sender).transfer(tokens &#x2F; tokensPerEth * weiPerEth); &#125; &#125; Tx.Origin é€šè¿‡tx.originå˜é‡æ¥åˆ¤æ–­ç”¨æˆ·æˆæƒçš„åˆçº¦ä¸€èˆ¬æ˜¯æ˜“å—é’“é±¼æ”»å‡»çš„ï¼Œè¿™ç§æ”»å‡»æ˜¯é€šè¿‡æ¬ºéª—ç”¨æˆ·å‘æœ‰æ¼æ´çš„åˆçº¦å‘é€éœ€è¦æˆæƒçš„æ“ä½œæ¥å®ç°çš„ã€‚ 123456789101112131415161718192021&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0pragma solidity &#x3D; 0.8.0;contract Phishable &#123; address public owner; constructor () &#123; owner &#x3D; msg.sender; &#125; receive() external payable&#123; &#125; function withdrawAll(address _recipient) public &#123; require(tx.origin &#x3D;&#x3D; owner); payable(_recipient).transfer(address(this).balance); &#125;&#125; æ”»å‡»åˆçº¦å¦‚ä¸‹,å¦‚æœæœ‰äººé€šè¿‡åšæ¸¸æˆç­‰æ–¹å¼è®©Phishableåˆçº¦çš„ownerç»™AccackContractåˆçº¦è½¬ä¸€å°éƒ¨åˆ†ä»¥å¤ªå¸ï¼Œé‚£ä¹ˆè¿™ä¸ªownerä¼šæŸå¤±Phishableåˆçº¦ä¸­çš„æ‰€æœ‰ä»¥å¤ªå¸ã€‚ 123456789101112131415161718192021222324&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0pragma solidity &#x3D; 0.8.0;import &quot;Phishable.sol&quot;;contract AccackContract &#123; Phishable phishableContract; address attacker; constructor(Phishable _phishableContract, address _attackerAddress) &#123; phishableContract &#x3D; _phishableContract; attacker &#x3D; _attackerAddress; &#125; fallback() external payable &#123; phishableContract.withdrawAll(_attackerAddress); &#125;&#125; é˜²èŒƒæŠ€æœ¯ æ™ºèƒ½åˆçº¦ä¸­ä¸åº”è¯¥ä½¿ç”¨tx.originæ¥è¿›è¡ŒéªŒè¯æˆæƒã€‚ tx.originçš„ä½¿ç”¨åœºæ™¯ï¼šå¦‚æœæŸäººæƒ³è¦æ‹’ç»å¤–éƒ¨åˆçº¦è°ƒç”¨å½“å‰åˆçº¦ï¼Œä»–ä»¬å¯ä»¥å®ç°ä¸€ä¸ªç±»ä¼¼require(tx.origin == msg.sender);è¿™æ ·çš„æ£€æŸ¥ï¼›è¿™æ ·å¯ä»¥é˜²æ­¢å½“å‰åˆçº¦è¢«å…¶ä»–ä¸­é—´åˆçº¦è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯ä»…å…è®¸å¤–éƒ¨è´¦æˆ·è°ƒç”¨å½“å‰åˆçº¦ã€‚","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"ethereum","slug":"åŒºå—é“¾/ethereum","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/ethereum/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"ethereum","slug":"ethereum","permalink":"https://guozhe001.github.io/tags/ethereum/"},{"name":"æ™ºèƒ½åˆçº¦","slug":"æ™ºèƒ½åˆçº¦","permalink":"https://guozhe001.github.io/tags/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/"},{"name":"solidity","slug":"solidity","permalink":"https://guozhe001.github.io/tags/solidity/"}]},{"title":"ä»¥å¤ªåŠä½¿ç”¨MetaMaské’±åŒ…å‘èµ·äº¤æ˜“","slug":"blockchain/eth/ä»¥å¤ªåŠä½¿ç”¨MetaMaské’±åŒ…å‘èµ·äº¤æ˜“","date":"2021-04-01T10:18:21.460Z","updated":"2021-04-01T10:18:21.461Z","comments":true,"path":"2021/04/01/blockchain/eth/ä»¥å¤ªåŠä½¿ç”¨MetaMaské’±åŒ…å‘èµ·äº¤æ˜“/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/eth/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%BD%BF%E7%94%A8MetaMask%E9%92%B1%E5%8C%85%E5%8F%91%E8%B5%B7%E4%BA%A4%E6%98%93/","excerpt":"","text":"é’±åŒ…è½¯ä»¶ MetaMaskï¼šå¯ä»¥é“¾æ¥æµ‹è¯•ç½‘ç»œrinkebyï¼Œç„¶ååœ¨ropstenï¼Œrinkebyè·å–ç›¸åº”çš„æµ‹è¯•ä»¥å¤ªå¸ã€‚ å‘èµ·äº¤æ˜“ å‘èµ·äº¤æ˜“å’Œæ™®é€šçš„é“¶è¡Œè½¬å¸ä¸€æ ·ï¼Œéœ€è¦æŒ‡å®šåœ°å€ï¼ˆé“¶è¡Œè´¦æˆ·ï¼‰å’Œè½¬è´¦æ•°é¢ï¼›äº¤æ˜“æ—¶ä¼šæœ‰æ‰‹ç»­è´¹ï¼ˆGas Feeï¼‰ï¼Œé’±åŒ…ä¼šæ˜¾ç¤ºå½“å‰çš„ä»·æ ¼ï¼Œè‡ªå·±å¯ä»¥è®¾ç½®Gas Feeçš„ä¸Šé™ã€‚ äº¤æ˜“çš„ç»“æ„ å¯ä»¥åœ¨https://ropsten.etherscan.io/æˆ–è€…https://www.rinkeby.io/#exploreræŸ¥çœ‹äº¤æ˜“è¯¦æƒ…ã€‚ å¥½ç©çš„æ˜¯ï¼Œå¯ä»¥è‡ªå·±ç»™è‡ªå·±è½¬è´¦ï¼Œå¦‚ä¸‹æ˜¯æˆ‘è‡ªå·±çš„æµ‹è¯•è´¦æˆ·ç»™è‡ªå·±è½¬è´¦çš„äº¤æ˜“æˆªå›¾ã€‚ï¼ˆWARNï¼šè¯·å‹¿ç»™æˆªå›¾ä¸­çš„åœ°å€è½¬è´¦ï¼Œè¿™æ˜¯æµ‹è¯•è´¦å·ï¼‰ï¼š éœ€è¦è¯´æ˜çš„åªæœ‰Nonceé‚£ä¸€è¡Œï¼š Nonceï¼š è¡¨ç¤ºçš„æ˜¯å½“å‰çš„è´¦æˆ·çš„ç¬¬ä¸€æ¬¡äº¤æ˜“ï¼Œæˆªå›¾çš„1è¡¨ç¤ºæ˜¯ç¬¬äºŒä¸ªäº¤æ˜“ï¼ˆäº¤æ˜“åºå·ä»0å¼€å§‹ï¼‰ Positionï¼šè¡¨ç¤ºå½“å‰çš„äº¤æ˜“åœ¨åŒºå—ä¸­çš„åºå·ã€‚ åŒºå—ä¸­çš„äº¤æ˜“åˆ—è¡¨ åŒºå—çš„ç»“æ„","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"ethereum","slug":"åŒºå—é“¾/ethereum","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/ethereum/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"ethereum","slug":"ethereum","permalink":"https://guozhe001.github.io/tags/ethereum/"},{"name":"MetaMask","slug":"MetaMask","permalink":"https://guozhe001.github.io/tags/MetaMask/"}]},{"title":"ä»¥å¤ªåŠå­¦ä¹ ä¸å®è·µ","slug":"blockchain/eth/ä»¥å¤ªåŠä¸­çš„token","date":"2021-04-01T10:18:21.459Z","updated":"2021-04-01T10:18:21.460Z","comments":true,"path":"2021/04/01/blockchain/eth/ä»¥å¤ªåŠä¸­çš„token/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/eth/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%B8%AD%E7%9A%84token/","excerpt":"","text":"ä»€ä¹ˆæ˜¯TOKENï¼ˆä»£å¸ï¼‰ é€šå¸¸æ˜¯æŒ‡ç§äººå‘è¡Œçš„ï¼Œç±»ä¼¼ç¡¬å¸å½¢çŠ¶çš„ç‰©ä½“ï¼Œå…·å¤‡å°‘é‡ä»·å€¼ï¼›å¦‚æ¸¸æˆå¸ ä»¥å¤ªåŠä¸Šçš„ä»£å¸æ˜¯æŒ‡åŸºäºåŒºå—é“¾çš„ä¸€ç§æŠ½è±¡çš„èµ„äº§ï¼Œå¯ä»¥è¢«æŒæœ‰å¹¶ä¸”ç”¨æ¥ä»£è¡¨èµ„äº§ã€ç°é‡‘ç­‰ ä»£å¸æœ‰å“ªäº›ä½¿ç”¨æ–¹å¼ è´§å¸ èµ„äº§ è®¿é—®æƒé™ æƒç›Šï¼ˆè‚¡ä¸œæƒç›Šï¼‰ æŠ•ç¥¨æƒ æ”¶è—å“ èº«ä»½ ã€‚ã€‚ã€‚ ä»£å¸æ ‡å‡† ERC20 ERC20æ¥å£å®šä¹‰ ERC20-OpenZeppelin implementation ERC20-ConsenSys implementation ERC20æ˜¯ä¸€ä¸ªtokenæ ‡å‡†ï¼Œä½“ç°åˆ°åˆçº¦ä¸Šæ˜¯ä¸€ä¸ªæ¥å£è§„èŒƒã€‚æ¥å£å¦‚ä¸‹ï¼ˆä¸åŒç¼–è¯‘ç‰ˆæœ¬çš„solidityçš„æ¥å£å¯èƒ½è¯­æ³•ä¸ä¸€æ ·ï¼Œä½†æ˜¯æè¿°çš„æ˜¯ä¸€æ ·çš„ï¼‰ï¼š æˆ‘çš„0.8.0ç‰ˆæœ¬æ¥å£å®šä¹‰ï¼š 123456789101112131415161718192021&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0pragma solidity&#x3D;0.8.0;interface ERC20Interface &#123; function balanceOf(address _owner) external view returns (uint256 balance); function transfer(address _to, uint256 _value) external returns (bool success); function transferFrom(address _from, address _to, uint256 _value) external returns (bool success); function approve(address _spender, uint256 _value) external returns (bool success); function allowance(address _owner, address _spender) external view returns (uint256 remaining); event Transfer(address indexed _from, address indexed _to, uint256 _value); event Approval(address indexed _owner, address indexed _spender, uint256 _value);&#125; ERC20-[ConsenSyså®šä¹‰] 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&#x2F;&#x2F; Abstract contract for the full ERC 20 Token standard&#x2F;&#x2F; https:&#x2F;&#x2F;github.com&#x2F;ethereum&#x2F;EIPs&#x2F;blob&#x2F;master&#x2F;EIPS&#x2F;eip-20.mdpragma solidity ^0.4.21;contract EIP20Interface &#123; &#x2F;* This is a slight change to the ERC20 base standard. function totalSupply() constant returns (uint256 supply); is replaced with: uint256 public totalSupply; This automatically creates a getter function for the totalSupply. This is moved to the base contract since public getter functions are not currently recognised as an implementation of the matching abstract function by the compiler. *&#x2F; &#x2F;&#x2F;&#x2F; total amount of tokens uint256 public totalSupply; &#x2F;&#x2F;&#x2F; @param _owner The address from which the balance will be retrieved &#x2F;&#x2F;&#x2F; @return The balance function balanceOf(address _owner) public view returns (uint256 balance); &#x2F;&#x2F;&#x2F; @notice send &#96;_value&#96; token to &#96;_to&#96; from &#96;msg.sender&#96; &#x2F;&#x2F;&#x2F; @param _to The address of the recipient &#x2F;&#x2F;&#x2F; @param _value The amount of token to be transferred &#x2F;&#x2F;&#x2F; @return Whether the transfer was successful or not function transfer(address _to, uint256 _value) public returns (bool success); &#x2F;&#x2F;&#x2F; @notice send &#96;_value&#96; token to &#96;_to&#96; from &#96;_from&#96; on the condition it is approved by &#96;_from&#96; &#x2F;&#x2F;&#x2F; @param _from The address of the sender &#x2F;&#x2F;&#x2F; @param _to The address of the recipient &#x2F;&#x2F;&#x2F; @param _value The amount of token to be transferred &#x2F;&#x2F;&#x2F; @return Whether the transfer was successful or not function transferFrom(address _from, address _to, uint256 _value) public returns (bool success); &#x2F;&#x2F;&#x2F; @notice &#96;msg.sender&#96; approves &#96;_spender&#96; to spend &#96;_value&#96; tokens &#x2F;&#x2F;&#x2F; @param _spender The address of the account able to transfer the tokens &#x2F;&#x2F;&#x2F; @param _value The amount of tokens to be approved for transfer &#x2F;&#x2F;&#x2F; @return Whether the approval was successful or not function approve(address _spender, uint256 _value) public returns (bool success); &#x2F;&#x2F;&#x2F; @param _owner The address of the account owning tokens &#x2F;&#x2F;&#x2F; @param _spender The address of the account able to transfer the tokens &#x2F;&#x2F;&#x2F; @return Amount of remaining tokens allowed to spent function allowance(address _owner, address _spender) public view returns (uint256 remaining); &#x2F;&#x2F; solhint-disable-next-line no-simple-event-func-name event Transfer(address indexed _from, address indexed _to, uint256 _value); event Approval(address indexed _owner, address indexed _spender, uint256 _value);&#125; ERC721 ERC721æ˜¯NFTï¼ˆNon-Fungible Tokenï¼‰çš„æ ‡å‡†ã€‚ç›´æ¥çœ‹å®˜æ–¹æ¥å£å®šä¹‰ERC721å’Œopenzeppelinçš„å®ç° ERC777 ä¸€ç§å…¼å®¹ERC20çš„ä»£å¸æ ‡å‡†ï¼Œè¿™ä¸ªæ ‡å‡†åœ¨è½¬è´¦çš„æ—¶å€™ä¼šæ£€æŸ¥æ¥æ”¶æ–¹æ”¯ä¸æ”¯æŒæ¥æ”¶å½“å‰ä»£å¸ï¼ˆå³æœ‰æ²¡æœ‰å®ç°æŸä¸ªæ¥å£ï¼‰ï¼›å¦‚æœæ²¡æœ‰å®ç°è½¬è´¦ä¼šå¤±è´¥ï¼Œè¿™å¯ä»¥é˜²æ­¢ä»£å¸è½¬å…¥ä¸€ä¸ªä¸æ”¯æŒçš„åˆçº¦ä¸­","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"ethereum","slug":"åŒºå—é“¾/ethereum","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/ethereum/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"ethereum","slug":"ethereum","permalink":"https://guozhe001.github.io/tags/ethereum/"},{"name":"token","slug":"token","permalink":"https://guozhe001.github.io/tags/token/"}]},{"title":"NFTåˆçº¦HashMaskæ™ºèƒ½åˆçº¦ä»£ç å­¦ä¹ ","slug":"blockchain/eth/NFTåˆçº¦HashMaskæ™ºèƒ½åˆçº¦ä»£ç å­¦ä¹ ","date":"2021-04-01T10:18:21.457Z","updated":"2021-04-01T10:18:21.459Z","comments":true,"path":"2021/04/01/blockchain/eth/NFTåˆçº¦HashMaskæ™ºèƒ½åˆçº¦ä»£ç å­¦ä¹ /","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/eth/NFT%E5%90%88%E7%BA%A6HashMask%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E4%BB%A3%E7%A0%81%E5%AD%A6%E4%B9%A0/","excerpt":"","text":"HashMask Verified Smart Contracts Hashmasks Contract: 0xc2c747e0f7004f9e8817db2ca4997657a7746928 NameChangeToken Contract: 0x8a9c4dfe8b9d8962b31e4e16f8321c44d48e246e Hashmasks Registry Contract: 0x185c8078285a3de3ec9a2c203ad12853f03c462d Hashmasks Datastore Contract: 0x7327DbF06b1FcB0D190533fDD244B52361f0d241","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"ethereum","slug":"åŒºå—é“¾/ethereum","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/ethereum/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"ethereum","slug":"ethereum","permalink":"https://guozhe001.github.io/tags/ethereum/"}]},{"title":"å¦‚ä½•å¼€å‘ä¸€ä¸ªCorDapp","slug":"blockchain/3å¦‚ä½•å¼€å‘ä¸€ä¸ªCorDapp","date":"2021-04-01T10:18:21.456Z","updated":"2021-04-01T10:18:21.456Z","comments":true,"path":"2021/04/01/blockchain/3å¦‚ä½•å¼€å‘ä¸€ä¸ªCorDapp/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/3%E5%A6%82%E4%BD%95%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AACorDapp/","excerpt":"","text":"ç¯å¢ƒå‡†å¤‡ JDKï¼ˆ8u131ä»¥ä¸Šï¼‰ cordaè®­ç»ƒè¥ ä»£ç åœ°å€ï¼š https://github.com/corda/bootcamp-cordapp ä¸ªäººgiteeé¡¹ç›®ï¼šhttps://gitee.com/zheshiyigegexingwangzhan/bootcamp-cordapp.git æ·»åŠ å›½å†…é•œåƒ å½“å‰é¡¹ç›®ä¿®æ”¹ ä¸‹è½½ä»£ç ä¹‹åä¸ºäº†æ›´å¿«çš„ä¸‹è½½ä¾èµ–ï¼Œæ·»åŠ å›½å†…çš„é•œåƒï¼š 1maven &#123; url &#39;http:&#x2F;&#x2F;maven.aliyun.com&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&#x2F;&#39;&#125; ç›´æ¥ä¿®æ”¹å…¨å±€çš„gradleé…ç½® åœ¨**~/.gradleç›®å½•ä¸‹æ–°å»ºinit.gradle**æ–‡ä»¶ï¼Œå†™å…¥ä»¥ä¸‹å†…å®¹ï¼š 1234567891011121314151617181920212223allprojects&#123; repositories &#123; def ALIYUN_REPOSITORY_URL &#x3D; &#39;http:&#x2F;&#x2F;maven.aliyun.com&#x2F;nexus&#x2F;content&#x2F;groups&#x2F;public&#39; def ALIYUN_JCENTER_URL &#x3D; &#39;http:&#x2F;&#x2F;maven.aliyun.com&#x2F;nexus&#x2F;content&#x2F;repositories&#x2F;jcenter&#39; all &#123; ArtifactRepository repo -&gt; if(repo instanceof MavenArtifactRepository)&#123; def url &#x3D; repo.url.toString() if (url.startsWith(&#39;https:&#x2F;&#x2F;repo1.maven.org&#x2F;maven2&#39;)) &#123; project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_REPOSITORY_URL.&quot; remove repo &#125; if (url.startsWith(&#39;https:&#x2F;&#x2F;jcenter.bintray.com&#x2F;&#39;)) &#123; project.logger.lifecycle &quot;Repository $&#123;repo.url&#125; replaced by $ALIYUN_JCENTER_URL.&quot; remove repo &#125; &#125; &#125; maven &#123; url ALIYUN_REPOSITORY_URL url ALIYUN_JCENTER_URL &#125; &#125;&#125; æµ‹è¯•ä»£ç  è¿è¡ŒProjectImportedOKTestå•æµ‹ï¼Œå¦‚æœé€šè¿‡è¯´æ˜ç¯å¢ƒæ²¡æœ‰é—®é¢˜ æˆ‘çš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼š 123456789&gt; Configure project :Repository https:&#x2F;&#x2F;jcenter.bintray.com&#x2F; replaced by http:&#x2F;&#x2F;maven.aliyun.com&#x2F;nexus&#x2F;content&#x2F;repositories&#x2F;jcenter.&gt; Task :compileJava&gt; Task :processResources NO-SOURCE&gt; Task :classes&gt; Task :compileTestJava&gt; Task :processTestResources NO-SOURCE&gt; Task :testClasses&gt; Task :test ä»£ç å¼€å‘ Stateå¼€å‘ ä¸€ä¸ªstateéœ€è¦å®ç°ContractStateï¼ŒContractStateä¸­æœ‰ä¸€ä¸ªæ–¹æ³•getParticipants()ï¼Œè¿”å›çš„æ˜¯List&lt;AbstractParty&gt;,è¡¨ç¤ºåœ¨è¿™ä¸ªstateå‘ç”Ÿäº†äº¤æ˜“æ—¶éœ€è¦é€šçŸ¥è°ï¼Œè®©è°çŸ¥é“ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package bootcamp;import com.google.common.collect.ImmutableList;import net.corda.core.contracts.ContractState;import net.corda.core.identity.AbstractParty;import net.corda.core.identity.Party;import org.jetbrains.annotations.NotNull;import java.util.List;public class IouState implements ContractState &#123; /** * å‘è¡Œäºº */ private Party issuer; /** * æ‹¥æœ‰è€… */ private Party owner; /** * é‡‘é¢ */ private int amount; public IouState(Party issuer, Party owner, int amount) &#123; this.issuer = issuer; this.owner = owner; this.amount = amount; &#125; @NotNull @Override public List&lt;AbstractParty&gt; getParticipants() &#123; return ImmutableList.of(issuer, owner); &#125; public Party getIssuer() &#123; return issuer; &#125; public Party getOwner() &#123; return owner; &#125; public int getAmount() &#123; return amount; &#125;&#125; Contractå¼€å‘ ä¸€ä¸ªcontractç®€å•çš„ç†è§£å°±æ˜¯ä¸€äº›æ ¡éªŒçš„è§„åˆ™ï¼Œéœ€è¦å®ç°Contractç±»ï¼ŒContractç±»å¦‚ä¸‹ï¼Œåªæœ‰ä¸€ä¸ªverifyæ–¹æ³•ï¼ŒéªŒè¯LedgerTransactionæ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœä¸æ­£ç¡®å°±æŠ›IllegalArgumentExceptionå¼‚å¸¸ã€‚ 12345678910interface Contract &#123; /** * Takes an object that represents a state transition, and ensures the inputs/outputs/commands make sense. * Must throw an exception if there&#x27;s a problem that should prevent state transition. Takes a single object * rather than an argument so that additional data can be added without breaking binary compatibility with * existing contract code. */ @Throws(IllegalArgumentException::class) fun verify(tx: LedgerTransaction)&#125; åœ¨å¼€å‘ä¸€ä¸ªcontractæ—¶ï¼ŒCordaæè®®çš„ä¸‰ä¸ªéªŒè¯çš„ç±»å‹ï¼š è¾“å…¥ä¸è¾“å‡ºä¸ªæ•°çš„æ ¡éªŒï¼ˆShape Constraintï¼ŒNo. input states, No. output states, commandï¼‰ è¾“å…¥ä¸è¾“å‡ºçš„å†…å®¹çš„æ ¡éªŒï¼ˆContext Constraintï¼‰ï¼Œä¸šåŠ¡æ ¡éªŒ éœ€è¦çš„ç­¾åçš„æ ¡éªŒï¼ˆRequired Singer Constraintï¼‰ æŒ‰ç…§ä¸Šå›¾çš„è§„åˆ™IouContractçš„å®ç°å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950package bootcamp;import net.corda.core.contracts.Command;import net.corda.core.contracts.CommandData;import net.corda.core.contracts.Contract;import net.corda.core.contracts.ContractState;import net.corda.core.transactions.LedgerTransaction;import org.apache.commons.collections4.CollectionUtils;public class IouContract implements Contract &#123; public static String ID = &quot;bootcamp.IouContract&quot;; @Override public void verify(LedgerTransaction tx) &#123; // 1ã€Shape Constraintï¼ŒNo. input states, No. output states, command if (tx.getCommands().size() != 1) &#123; throw new IllegalArgumentException(&quot;command size must be one&quot;); &#125; Command&lt;CommandData&gt; command = tx.getCommand(0); if (!(command.getValue() instanceof Commands.Issue)) &#123; throw new IllegalArgumentException(&quot;command must be Issue&quot;); &#125; if (CollectionUtils.isNotEmpty(tx.getInputs())) &#123; throw new IllegalArgumentException(&quot;Issue must be not inputs&quot;); &#125; if (tx.getOutputs().size() != 1) &#123; throw new IllegalArgumentException(&quot;Issue outputs must be one&quot;); &#125; ContractState output = tx.getOutput(0); // 2ã€Context Constraint if (!(output instanceof IouState)) &#123; throw new IllegalArgumentException(&quot;state must be IouState&quot;); &#125; IouState iouState = (IouState) output; if (iouState.getAmount() &lt;= 0) &#123; throw new IllegalArgumentException(&quot;issue amount must big than zero&quot;); &#125; // 3ã€Required Singer Constraint if (!command.getSigners().contains(iouState.getIssuer().getOwningKey())) &#123; throw new IllegalArgumentException(&quot;issue business must be sing by issuer&quot;); &#125; &#125; public interface Commands extends CommandData &#123; class Issue implements Commands &#123; &#125; &#125;&#125; Flowå¼€å‘ flowæœ‰ä¸¤ç§ å¯ä»¥åœ¨æœ¬åœ°ä¸»åŠ¨å¯åŠ¨çš„flow åªèƒ½é€šè¿‡å…¶ä»–çš„flowå¯åŠ¨çš„flow å‘èµ·ä¸€ä¸ªäº¤æ˜“çš„flowéƒ½æ˜¯å¯ä»¥åœ¨æœ¬åœ°ä¸»åŠ¨å¯åŠ¨çš„flowï¼Œæœ‰ä»¥ä¸‹ç‰¹ç‚¹ éœ€è¦æ·»åŠ æ³¨è§£@InitiatingFlowæ¥è¡¨ç¤ºä»–æ˜¯ä¸€ä¸ªå¯ä»¥åˆå§‹åŒ–çš„flow éœ€è¦æ·»åŠ æ³¨@StartableByRPCæˆ–è€…@StartableByServiceæ¥è¯´æ˜å¯åŠ¨çš„æ–¹å¼ flowéœ€è¦ç»§æ‰¿è‡ªFlowLogicï¼Œä¸šåŠ¡é€»è¾‘åœ¨callæ–¹æ³•ä¸­å®ç° callæ–¹æ³•éœ€è¦æ·»åŠ @Suspendableæ³¨è§£ æŒ‡å®šnotaryï¼Œæ ¡éªŒæ˜¯å¦åŒèŠ± åˆ›å»ºäº¤æ˜“ï¼Œäº¤æ˜“ä¸­å¿…é¡»åŒ…å«commandï¼Œå¦‚æœæœ‰outputå¿…é¡»æŒ‡å®šcontractæ¥è¿›è¡ŒéªŒè¯ï¼›å¯ä»¥æ²¡æœ‰input ç„¶åå°±æ˜¯é€šç”¨çš„æµç¨‹ï¼ŒéªŒè¯äº¤æ˜“ã€æ”¶é›†ç­¾åã€äº¤æ˜“å…¥åº“ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768package bootcamp;import co.paralleluniverse.fibers.Suspendable;import com.google.common.collect.ImmutableList;import net.corda.core.contracts.StateAndRef;import net.corda.core.flows.*;import net.corda.core.identity.Party;import net.corda.core.transactions.SignedTransaction;import net.corda.core.transactions.TransactionBuilder;import net.corda.core.utilities.ProgressTracker;import static java.util.Collections.singletonList;/** * * @author nicai */@InitiatingFlow@StartableByRPCpublic class IouIssueFlowInitiator extends FlowLogic&lt;SignedTransaction&gt; &#123; private final Party owner; private final int amount; public IouIssueFlowInitiator(Party owner, int amount) &#123; this.owner = owner; this.amount = amount; &#125; private final ProgressTracker progressTracker = new ProgressTracker(); @Override public ProgressTracker getProgressTracker() &#123; return progressTracker; &#125; @Suspendable @Override public SignedTransaction call() throws FlowException &#123; // We choose our transaction&#x27;s notary (the notary prevents double-spends). Party notary = getServiceHub().getNetworkMapCache().getNotaryIdentities().get(0); // We get a reference to our own identity. Party issuer = getOurIdentity(); // We create our new IouState. IouState iouState = new IouState(issuer, owner, amount); // We build our transaction. TransactionBuilder transactionBuilder = new TransactionBuilder(notary)// .addInputState() .addOutputState(iouState, IouContract.ID) .addCommand(new IouContract.Commands.Issue(), ImmutableList.of(issuer.getOwningKey(), owner.getOwningKey())); // We check our transaction is valid based on its contracts. transactionBuilder.verify(getServiceHub()); FlowSession session = initiateFlow(owner); // We sign the transaction with our private key, making it immutable. SignedTransaction signedTransaction = getServiceHub().signInitialTransaction(transactionBuilder); // The counterparty signs the transaction SignedTransaction fullySignedTransaction = subFlow(new CollectSignaturesFlow(signedTransaction, singletonList(session))); // We get the transaction notarised and recorded automatically by the platform. return subFlow(new FinalityFlow(fullySignedTransaction, singletonList(session))); &#125;&#125; è¢«åŠ¨å¯åŠ¨çš„flowæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š éœ€è¦æ³¨è§£@InitiatedBy(IouIssueFlowInitiator.class)æŒ‡å®šè°èƒ½å¯åŠ¨è¿™ä¸ªflow flowéœ€è¦ç»§æ‰¿è‡ªFlowLogicï¼Œä¸šåŠ¡é€»è¾‘åœ¨callæ–¹æ³•ä¸­å®ç° callæ–¹æ³•éœ€è¦æ·»åŠ @Suspendableæ³¨è§£ éœ€è¦æœ‰å®ä¾‹å˜é‡FlowSessionï¼Œä¿å­˜è°ƒç”¨è€…çš„FlowSession callæ–¹æ³•éœ€è¦éªŒè¯äº¤æ˜“ï¼Œç„¶åæ‰§è¡Œæ¥æ”¶äº¤æ˜“çš„æ ‡å‡†æµç¨‹ReceiveFinalityFlow 1234567891011121314151617181920212223242526272829package bootcamp;import co.paralleluniverse.fibers.Suspendable;import net.corda.core.flows.*;import net.corda.core.transactions.SignedTransaction;@InitiatedBy(IouIssueFlowInitiator.class)public class IouIssueFlowResponder extends FlowLogic&lt;Void&gt; &#123; private final FlowSession otherSide; public IouIssueFlowResponder(FlowSession otherSide) &#123; this.otherSide = otherSide; &#125; @Override @Suspendable public Void call() throws FlowException &#123; SignedTransaction signedTransaction = subFlow(new SignTransactionFlow(otherSide) &#123; @Suspendable @Override protected void checkTransaction(SignedTransaction stx) throws FlowException &#123; // Implement responder flow transaction checks here &#125; &#125;); subFlow(new ReceiveFinalityFlow(otherSide, signedTransaction.getId())); return null; &#125;&#125; è¿è¡Œ æ‰“åŒ… 1./gradlew deployNodes è¿è¡Œæ‰€æœ‰çš„èŠ‚ç‚¹ 1sudo ./build/nodes/runnodes å¯åŠ¨ä¸€ä¸ªæµç¨‹ 1flow start IouIssueFlow owner: PartyB, amount: 99 æˆ‘æœ¬åœ°æ—¥å¿—å¦‚ä¸‹ï¼š 1234567 âœ… Starting Requesting signature by notary service Requesting signature by Notary service Validating response from Notary service âœ… Broadcasting transaction to participantsâ¡ï¸ DoneFlow completed with result: SignedTransaction(id=14D268667D208D26BF92ADC1F58003DFC9EAF7E036ACB2C2CABC153E627500C0) æŸ¥è¯¢ç”Ÿæˆçš„æ•°æ® 1run vaultQuery contractStateType: bootcamp.IouState æˆ‘æœ¬åœ°çš„ç»“æœå¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233states:- state: data: !&lt;bootcamp.IouState&gt; issuer: &quot;O=PartyA, L=London, C=GB&quot; owner: &quot;O=PartyB, L=New York, C=US&quot; amount: 99 contract: &quot;bootcamp.IouContract&quot; notary: &quot;O=Notary, L=London, C=GB&quot; encumbrance: null constraint: !&lt;net.corda.core.contracts.SignatureAttachmentConstraint&gt; key: &quot;aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTEw3G5d2maAq8vtLE4kZHgCs5jcB1N31cx1hpsLeqG2ngSysVHqcXhbNts6SkRWDaV7xNcr6MtcbufGUchxredBb6&quot; ref: txhash: &quot;14D268667D208D26BF92ADC1F58003DFC9EAF7E036ACB2C2CABC153E627500C0&quot; index: 0statesMetadata:- ref: txhash: &quot;14D268667D208D26BF92ADC1F58003DFC9EAF7E036ACB2C2CABC153E627500C0&quot; index: 0 contractStateClassName: &quot;bootcamp.IouState&quot; recordedTime: &quot;2020-12-03T09:49:48.373Z&quot; consumedTime: null status: &quot;UNCONSUMED&quot; notary: &quot;O=Notary, L=London, C=GB&quot; lockId: null lockUpdateTime: null relevancyStatus: &quot;RELEVANT&quot; constraintInfo: constraint: key: &quot;aSq9DsNNvGhYxYyqA9wd2eduEAZ5AXWgJTbTEw3G5d2maAq8vtLE4kZHgCs5jcB1N31cx1hpsLeqG2ngSysVHqcXhbNts6SkRWDaV7xNcr6MtcbufGUchxredBb6&quot;totalStatesAvailable: -1stateTypes: &quot;UNCONSUMED&quot;otherResults: [] èŠ‚ç‚¹å¯è§†åŒ–å·¥å…· å‚è€ƒç½‘ç«™ï¼šhttps://docs.corda.net/docs/corda-os/4.6/node-explorer.html å¯ä»¥ä¸‹è½½node-exploreræ¥æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ã€‚ ç¬¬ä¸€æ¬¡æ‰“å¼€ç•Œé¢ Node Hostnameï¼šlocalhost Node Portï¼šRPC connection addresså¯ä»¥åœ¨å¯åŠ¨çš„çª—å£æŸ¥çœ‹ï¼Œæˆ–è€…é…ç½®æ–‡ä»¶æŸ¥çœ‹ RPC Usernameï¼šåœ¨é…ç½®æ–‡ä»¶ RPC Password:åœ¨é…ç½®æ–‡ä»¶æŸ¥çœ‹ ä½¿ç”¨springå¼€å‘cordaï¼š https://manosbatsis.github.io/corbeans/","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Corda","slug":"åŒºå—é“¾/Corda","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Corda/"},{"name":"CorDapp","slug":"åŒºå—é“¾/Corda/CorDapp","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Corda/CorDapp/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Corda","slug":"Corda","permalink":"https://guozhe001.github.io/tags/Corda/"},{"name":"CorDapp","slug":"CorDapp","permalink":"https://guozhe001.github.io/tags/CorDapp/"}]},{"title":"å¦‚ä½•æ­å»ºä¸€ä¸ªCordaç½‘ç»œ","slug":"blockchain/4å¦‚ä½•æ­å»ºä¸€ä¸ªCordaç½‘ç»œ","date":"2021-04-01T10:18:21.456Z","updated":"2021-04-01T10:18:21.456Z","comments":true,"path":"2021/04/01/blockchain/4å¦‚ä½•æ­å»ºä¸€ä¸ªCordaç½‘ç»œ/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/4%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AACorda%E7%BD%91%E7%BB%9C/","excerpt":"","text":"åœ¨æŸ¥çœ‹æ­¤æ–‡æ¡£ä¹‹å‰ï¼Œå…ˆæŸ¥çœ‹å¦‚ä½•å¼€å‘ä¸€ä¸ªCorDapp å‚è€ƒæ–‡æ¡£ï¼šNMSçš„FAQ.mdæ–‡ä»¶ 1ã€ç½‘ç»œæœåŠ¡å¯åŠ¨ï¼Œdockerç‰ˆçš„ç½‘ç»œæœåŠ¡å¯åŠ¨ï¼š 1docker run --name=network-map -e NMS_ROOT_CA_FILE_PATH=&quot;&quot; -p 8080:8080 cordite/network-map:latest 2ã€å¯åŠ¨åæ‰“å¼€æ¥å£æ–‡æ¡£ç”¨äºéªŒè¯å¯åŠ¨æ˜¯å¦æˆåŠŸ http://localhost:8080/swagger/#/ 3ã€buildå’Œé…ç½®CorDapp buildä¹‹å‰ä¿®æ”¹build.gradleçš„é…ç½®ï¼Œä¿®æ”¹cordappèŠ‚ç‚¹ä¸ç»™cordappç­¾å 123456cordapp &#123; signing &#123; enabled false &#125; // å…¶ä»–é…ç½®&#125; è¿è¡Œbuildå‘½ä»¤ 1./gradlew clean deployNodes ä¿®æ”¹é…ç½®åˆ é™¤è‡ªåŠ¨ç”Ÿæˆçš„keyç­‰æ–‡ä»¶ 123456789pushd build/nodesfor N in */; do echo &#x27;compatibilityZoneURL=&quot;http://localhost:8080&quot;&#x27; &gt;&gt; $N/node.conf echo &#x27;devModeOptions.allowCompatibilityZone=true&#x27; &gt;&gt; $N/node.conf pushd $N rm -rf network-parameters nodeInfo-* persistence.mv.db certificates additional-node-infos popddonepopd 4ã€æŠŠèŠ‚ç‚¹æ³¨å†Œåˆ°ç½‘ç»œ ä¸‹è½½ç½‘ç»œçš„truststore 1curl http://localhost:8080/network-map/truststore -o ~/tmp/network-truststore.jks æ¯ä¸ªèŠ‚ç‚¹éƒ½åˆå§‹åŒ–æ³¨å†Œ 1234567pushd build/nodesfor N in */; do pushd $N java -jar corda.jar --initial-registration --network-root-truststore ~/tmp/network-truststore.jks --network-root-truststore-password trustpass popddonepopd 5ã€æŒ‡å®šNotaryèŠ‚ç‚¹ å¯åŠ¨NotaryèŠ‚ç‚¹ è¿›åˆ°NotaryèŠ‚ç‚¹çš„ç›®å½•ä¸‹æ‰§è¡Œ,å¦‚æœæ²¡æœ‰æƒé™ 1java -jar corda.jar æ³¨æ„ï¼šå¦‚æœæŠ¥é”™ï¼šUnable to create logging directory /Users/apple/code/open-source/blockchain/my-corda/logs. Node will now shutdown.è¯´æ˜æ²¡æœ‰æƒé™ï¼Œåœ¨å‘½ä»¤å‰åŠ sudoå³å¯ æŒ‡å®šNotaryèŠ‚ç‚¹ 1ã€ç™»é™†NMSï¼ˆnetwork-map-serviceï¼‰å¹¶è·å–tokenä¿¡æ¯ 1TOKEN=`curl -X POST &quot;http://localhost:8080//admin/api/login&quot; -H &quot;accept: text/plain&quot; -H &quot;Content-Type: application/json&quot; -d &quot;&#123; \\&quot;user\\&quot;: \\&quot;sa\\&quot;, \\&quot;password\\&quot;: \\&quot;admin\\&quot;&#125;&quot;` 2ã€ä¸Šä¼ notary 1234pushd build/nodes/NotaryNODEINFO=`ls nodeInfo*`curl -X POST -H &quot;Authorization: Bearer $TOKEN&quot; -H &quot;accept: text/plain&quot; -H &quot;Content-Type: application/octet-stream&quot; --data-binary @$NODEINFO http://localhost:8080//admin/api/notaries/validatingpopd åœ¨æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤æ—¶ï¼Œæ³¨æ„è‡ªå·±å½“å‰çš„æ‰€åœ¨çš„ç›®å½•ï¼Œå¦‚æœå·²ç»åœ¨build/nodes/Notaryç›®å½•ä¸‹éœ€è¦é€€å‡ºåˆ°bootcamp-cordappç›®å½• 6ã€åœæ­¢NotaryèŠ‚ç‚¹ åœ¨notaryèŠ‚ç‚¹çš„shellå‘½ä»¤è¡Œæ‰§è¡Œ bye 7ã€ä¿®æ”¹notaryèŠ‚ç‚¹çš„validating å› ä¸ºåœ¨ç¬¬5æ­¥æŒ‡å®šNotaryçš„æ—¶å€™è°ƒç”¨çš„æ˜¯validatingæ¥å£ï¼Œæ‰€ä»¥ç¡®è®¤ä¸€ä¸‹notaryçš„é…ç½®æ˜¯çš„validatingæ˜¯å¦ä¸ºtrueï¼Œå¦‚ä¸‹ 123notary &#123; validating&#x3D;true&#125; å¦‚æœé…ç½®çš„æ˜¯validating=falseåˆ™ä¼šæŠ¥å¼‚å¸¸ï¼š [ERROR] 16:25:22+0800 [main] internal.NodeStartupLogging. - Exception during node startup: There is a discrepancy in the configured notary type and the one advertised in the network parameters - shutting down. Configured as validating: false. Advertised as validating: true [errorCode=r8le54, moreInformationAt=https://errors.corda.net/OS/4.3/r8le54] 8ã€åˆ é™¤NotaryèŠ‚ç‚¹çš„network-parametersæ–‡ä»¶ è¿›å…¥åˆ°notaryèŠ‚ç‚¹çš„ç›®å½•ï¼Œåˆ é™¤network-parametersæ–‡ä»¶ 9ã€å¯åŠ¨notaryèŠ‚ç‚¹å’Œå…¶ä»–èŠ‚ç‚¹ è¿›å…¥åˆ°å„ä¸ªèŠ‚ç‚¹çš„ç›®å½•ï¼Œå¯åŠ¨ï¼š 1java -jar corda.jar 10ã€å‘èµ·äº¤æ˜“æµ‹è¯• å¯ä»¥ä¸‹è½½node-exploreræ¥æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯å¹¶å‘èµ·äº¤æ˜“ï¼Œæˆ‘çš„æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š æ‰©å±• å› ä¸ºä¸Šé¢çš„æ–‡æ¡£æ˜¯æŒ‰ç…§","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Corda","slug":"åŒºå—é“¾/Corda","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Corda/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Corda","slug":"Corda","permalink":"https://guozhe001.github.io/tags/Corda/"}]},{"title":"Cordaèµ„æ–™æ•´ç†","slug":"blockchain/2åŒºå—é“¾å¼€å‘æ¡†æ¶-Cordaå­¦ä¹ æ€»ç»“","date":"2021-04-01T10:18:21.455Z","updated":"2021-04-01T10:18:21.455Z","comments":true,"path":"2021/04/01/blockchain/2åŒºå—é“¾å¼€å‘æ¡†æ¶-Cordaå­¦ä¹ æ€»ç»“/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/2%E5%8C%BA%E5%9D%97%E9%93%BE%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6-Corda%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/","excerpt":"","text":"0. Cordaèµ„æ–™æ•´ç† å®˜ç½‘ æ²¹ç®¡é¢‘é“ Cordaä¸­æ–‡æ–‡æ¡£ å¼€å‘æ–‡æ¡£ Cordaä¸­æ–‡ç¤¾åŒº Stack Overflowè®¨è®ºåŒº, cordaæ ‡ç­¾ Corda Training 1. Cordaæ˜¯ä»€ä¹ˆï¼Ÿ Cordaæ˜¯ä¸ºä¼ä¸šæ„å»ºçš„å¼€æºåŒºå—é“¾/åˆ†å¸ƒå¼è´¦æœ¬å¸å¹³å°ï¼›Cordaä½¿ä¼ä¸šå¯ä»¥ä½¿ç”¨æ™ºèƒ½åˆçº¦åœ¨ä¸¥æ ¼çš„éšç§ä¸‹ç›´æ¥è¿›è¡Œäº¤æ˜“ï¼Œä»è€Œé™ä½äº¤æ˜“å’Œè®°å½•ä¿å­˜æˆæœ¬ï¼Œå¹¶ç®€åŒ–ä¸šåŠ¡è¿è¥ã€‚ Cordaä¸ä¼šå®šæœŸå°†éœ€è¦ç¡®è®¤çš„äº¤æ˜“åˆ†æ‰¹å¤„ç†å†åˆ†æˆå—ä¹‹åä¸€æ¬¡æ€§ç¡®è®¤ã€‚ç›¸åï¼ŒCordaä¼šå®æ—¶ç¡®è®¤æ¯ç¬”äº¤æ˜“ã€‚ 1.0 Cordaæœ‰å“ªäº›æ¦‚å¿µ 1.0.1 ç½‘ç»œ ä¸€ä¸ªCordaç½‘ç»œç”±è¿è¡Œç€Cordaå’ŒCorDappsçš„èŠ‚ç‚¹æ„æˆçš„ ä¸åŒçš„èŠ‚ç‚¹é—´çš„æ²Ÿé€šæ˜¯ç‚¹å¯¹ç‚¹çš„ï¼Œä¸ä¾èµ–äºå…¨å±€å¹¿æ’­ æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ•°å­—è¯ä¹¦æ¥å°†çœŸå®ä¸–ç•Œä¸­çš„æ³•å¾‹èº«ä»½å’Œç½‘ç»œèº«ä»½ç›¸å…³è” è¿™ä¸ªç½‘ç»œæ˜¯ä¸€ä¸ªéœ€è¦è®¸å¯çš„ç½‘ç»œï¼Œéœ€è¦ä»ç½‘ç»œç»´æŠ¤è€…é‚£é‡Œç”³è¯·ä¸€ä¸ªæ•°å­—è¯ä¹¦æ¥è·å¾—è®¿é—®æƒé™ 1.0.2 è´¦æœ¬ æ¯ä¸ªè´¦æœ¬æ˜¯é’ˆå¯¹äºæ¯ä¸€ä¸ªèŠ‚ç‚¹çš„ å¯¹äºè´¦æœ¬ä¸Šçš„å…±äº«äº‹å®ï¼Œå…±äº«çš„ä¸¤æ–¹ï¼ˆæˆ–å¤šæ–¹ï¼‰æ€»æ˜¯èƒ½å¤Ÿä¿è¯å­˜åœ¨ä»–ä»¬è‡ªå·±çš„è´¦æœ¬ä¸­çš„äº‹å®æ˜¯å®Œå…¨ä¸€è‡´çš„ åœ¨ Corda ä¸­æ˜¯ æ²¡æœ‰å”¯ä¸€çš„ä¸­å¿ƒåŒ–å­˜å‚¨çš„æ•°æ® çš„ã€‚æ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤ç€ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®åº“ï¼Œå…¶ä¸­åŒ…å«äº†æ‰€çŸ¥é“çš„äº‹å®ã€‚æ‰€ä»¥æ¯ä¸ª peer åªèƒ½å¤Ÿçœ‹åˆ°è´¦æœ¬ä¸­çš„äº‹å®ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œæ²¡æœ‰èŠ‚ç‚¹èƒ½å¤ŸçŸ¥é“æ‰€æœ‰çš„å†…å®¹ã€‚ 1.0.3 States State ä»£è¡¨çš„æ˜¯å­˜åœ¨è´¦æœ¬ä¸Šçš„äº‹å® State é€šè¿‡å°†åŸæ¥çš„ State å˜ä¸ºå†å²è®°å½•ç„¶åæ·»åŠ ä¸€æ¡æ–°ç‰ˆæœ¬çš„ state çš„æ–¹å¼æ¥å¯¹ state è¿›è¡Œæ›´æ–° æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ª vault æ¥å­˜å‚¨è¯¥èŠ‚ç‚¹æ‰€æœ‰ç›¸å…³çš„ States 1.0.3.0 State é¡ºåº ä¸ªå…±äº«çš„äº‹å®çš„ç”Ÿå‘½å‘¨æœŸæ˜¯å¯ä»¥é€šè¿‡ state é¡ºåº æ¥ä½“ç°ã€‚å½“ä¸€ä¸ª state éœ€è¦æ›´æ–°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ªä»£è¡¨æ–°çš„ state çš„æ–°ç‰ˆæœ¬çš„ stateï¼Œç„¶åå°†åŸæ¥çš„é‚£ä¸ª state æ ‡æ³¨ä¸ºå†å²ç‰ˆæœ¬ã€‚ 1.0.3.1 Vault Corda ç½‘ç»œä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½ç»´æŠ¤ç€ä¸€ä¸ª vault - å®ƒæ˜¯ä¸€ä¸ªæ•°æ®åº“ï¼Œå…¶ä¸­è·Ÿè¸ªäº†æ‰€æœ‰ states çš„å½“å‰ä»¥åŠå†å²çš„ states æ•°æ®ï¼Œä»¥åŠè·Ÿå®ƒæœ‰å…³çš„æ•°æ®ï¼š 1.0.3.2 å‚è€ƒ states å¹¶ä¸æ˜¯æ‰€æœ‰çš„ states éƒ½éœ€è¦è¢«ä½¿ç”¨ä»–ä»¬çš„èŠ‚ç‚¹æ¥æ›´æ–°çš„ã€‚å¯¹äºå‚æ•°æ•°æ®çš„æƒ…å†µï¼Œæœ‰ä¸€ç§å¸¸è§çš„æ¨¡å¼ï¼Œä¸€æ–¹åˆ›å»ºäº†å‚è€ƒæ•°æ®ï¼Œè¿™äº›æ•°æ®ä¼šè¢«å…¶ä»–æ–¹ä½¿ç”¨ï¼ˆä½†æ˜¯ä¸ä¼šè¢«æ›´æ–°ï¼‰ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œstates ä¸­åŒ…å«çš„å‚è€ƒæ•°æ®è¢«ç§°ä¸º â€œå‚è€ƒ statesâ€ã€‚ 1.0.4 Transactions Transaction æ˜¯å…³äºæ›´æ–°è´¦æœ¬çš„æè®®ï¼›ï¼ˆä¸ªäººç†è§£ï¼šæ›´å‡†ç¡®çš„è¯´åº”è¯¥æ˜¯æ›´æ–°è´¦æœ¬ä¸Šçš„æŸäº›statesçš„æè®®ï¼‰ ä¸€ä¸ª transaction æè®®åªèƒ½åœ¨æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„æ—¶å€™æ‰ä¼šè¢«æäº¤ï¼š å®ƒä¸åŒ…å«â€œåŒèŠ±â€ å®ƒæ˜¯åˆçº¦æœ‰æ•ˆçš„ å®ƒéœ€è¦è¢«æ‰€æœ‰ç›¸å…³æ–¹æä¾›ç­¾å Corda ä½¿ç”¨ UTXO (æœªæ¶ˆè´¹çš„ transaction output) æ¨¡å‹æ¥ä½¿è´¦æœ¬ä¸Šçš„æ¯æ¡ state éƒ½ä¸å¯æ›´æ”¹ã€‚å¯¹äºè´¦æœ¬ä¸Šæ•°æ®çš„å˜æ›´éƒ½æ˜¯é€šè¿‡ä½¿ç”¨ transaction çš„æ–¹å¼æ¥åšçš„ï¼Œå°±æ˜¯å°† 0 æ¡æˆ–å¤šæ¡å·²ç»å­˜åœ¨çš„è´¦æœ¬ states å˜ä¸ºå†å²è®°å½•ï¼ˆinputsï¼‰ï¼Œç„¶åå†æ–°å¢0æ¡æˆ–å¤šæ¡æ–°çš„è´¦æœ¬ states ï¼ˆoutputsï¼‰ã€‚äº¤æ˜“ä»£è¡¨äº† state é¡ºåºä¸­çš„ä¸€ä¸ªå•ç‹¬çš„é“¾æ¥ã€‚ **ä¸ªäººç†è§£ï¼š**è¿™ä¸€ç‚¹å’Œæ¯”ç‰¹å¸å¾ˆåƒï¼Œä¸åŒç‚¹æ˜¯æ¯”ç‰¹å¸çš„äº¤æ˜“åªéœ€è¦æ”¯ä»˜çš„äººçš„ç­¾åï¼Œè€Œè¿™é‡Œçš„transactionéœ€è¦æ‰€æœ‰äººç›¸å…³äººçš„ç­¾å ä¸€ä¸ª transaction ä¸­å¯ä»¥åŒ…å«ä»»ä½•æ•°é‡ä»»ä½•ç±»å‹çš„ inputs å’Œ outputsï¼š å¯ä»¥åŒ…å«å¤šç§ç±»å‹çš„ stateï¼ˆcash, bondsï¼‰ å¯ä»¥æ˜¯ issuances ç±»å‹ï¼ˆæœ‰0ä¸ªinputï¼‰æˆ–è€… exists ç±»å‹ï¼ˆæœ‰0ä¸ª outputï¼‰ å¯ä»¥åˆå¹¶æˆ–æ‹†åˆ†å¯æ›¿æ¢çš„èµ„äº§ï¼ˆæ¯”å¦‚æŠŠä¸€ä¸ª $2 çš„ state å’Œ $5 çš„ state åˆå¹¶ä¸º $7 çš„ cash stateï¼‰ Transaction æ˜¯ åŸå­æ€§æ“ä½œï¼Œä¸€ä¸ª transaction é‡Œè¾¹çš„æ‰€æœ‰ changes å¿…é¡»è¦å…¨éƒ¨æ‰§è¡Œï¼Œæˆ–è€…ä¸€ä¸ªä¹Ÿä¸ä¼šæ‰§è¡Œã€‚ æœ‰ä¸¤ç§åŸºæœ¬ç±»å‹çš„ transactionsï¼š Notary-change transactionsï¼ˆç”¨æ¥å˜æ›´ state çš„ notary - æŸ¥çœ‹ Notariesï¼‰ General transactionsï¼ˆå…¶ä»–ä»»ä½•ç±»å‹çš„ transactionï¼‰ 1.0.4.1 äº¤æ˜“é“¾ ä¸€ä¸ªæ–°çš„ transaction çš„ output state åœ¨è´¦æœ¬ä¸­åº”è¯¥æ˜¯è¿˜ä¸å­˜åœ¨çš„ï¼Œæ‰€ä»¥éœ€è¦æå‡º transaction çš„ä¸€æ–¹æ¥åˆ›å»ºã€‚ä½†æ˜¯ transaction ä¸­åŒ…å«çš„ input åº”è¯¥æ˜¯åœ¨è´¦æœ¬ä¸­å·²ç»å­˜åœ¨çš„ï¼Œåº”è¯¥æ˜¯å‰ä¸€ä¸ª transaction æ·»åŠ è¿›å»çš„ outputã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æ–°çš„ transaction ä¸­å¼•ç”¨è¿™äº›å·²ç»å­˜åœ¨çš„è®°å½•ã€‚ è¿™äº› Input state çš„å¼•ç”¨åŒ…å«ä¸¤éƒ¨åˆ†(ä¸ªäººç†è§£ï¼šä¸æ¯”ç‰¹å¸çš„äº¤æ˜“é“¾ä¸€æ ·)ï¼š åˆ›å»ºè¿™ä¸ª input çš„ transaction çš„ hash è¿™ä¸ª input æ‰€æŒ‡çš„å‰ä¸€ä¸ª transaction å¸¦æ¥çš„ output state åœ¨ output list ä¸­çš„ä½ç½®æˆ–è€…ç´¢å¼•å€¼ 1.0.4.2 æäº¤äº¤æ˜“ åˆå§‹çš„æ—¶å€™ï¼Œä¸€ä¸ª transaction ä»…ä»…æ˜¯ä¸€ä¸ªæ›´æ–°è´¦æœ¬çš„ æè®®ã€‚å®ƒè¡¨ç¤ºäº†ç»è¿‡è¿™æ¬¡æ›´æ–°åè´¦æœ¬çš„æ–°çš„çŠ¶æ€ï¼š ä¸ºäº†æˆä¸ºçœŸæ­£çš„ä¸€ç¬”äº¤æ˜“ï¼Œtransaction å¿…é¡»è¦è·å¾—æ‰€æœ‰ è¦æ±‚çš„ç­¾å*ï¼ˆæŸ¥çœ‹ä¸‹è¾¹çš„ *commandï¼‰ã€‚æ¯ä¸€ä¸ªè¦æ±‚çš„ç­¾åè€…ä¼šå°†ç­¾åé™„åŠ åœ¨ transaction ä¸Šæ¥è¡¨ç¤ºä»–ä»¬å·²ç»åŒæ„äº†è¿™æ¬¡æ›´æ–°ï¼š å¦‚æœå¾—åˆ°äº†æ‰€æœ‰éœ€è¦çš„ç­¾åï¼Œè¿™ä¸ª transaction å°±ä¼šè¢«æäº¤äº†ï¼š ä¸€æ—¦æäº¤å°±æ„å‘³ç€ï¼š Transaction çš„ input è¢«æ ‡æ³¨ä¸ºå†å²è®°å½•ï¼Œå¹¶ä¸”ä¸èƒ½å†è¢«ä¹‹åçš„ transactions ä½¿ç”¨äº† Transaction çš„ output å˜ä¸ºè´¦æœ¬ä¸Šçš„å½“å‰çŠ¶æ€çš„ä¸€éƒ¨åˆ† 1.0.4.3 äº¤æ˜“çš„æœ‰æ•ˆæ€§ æ¯ä¸€ä¸ªè¢«è¦æ±‚çš„ç­¾åæ–¹åº”è¯¥åªæœ‰åœ¨æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶çš„æ—¶å€™æ‰åº”è¯¥æä¾›ç­¾åï¼š Transaction æ˜¯æœ‰æ•ˆçš„ï¼šå¯¹äºå½“å‰çš„ transaction ææ¡ˆä»¥åŠäº§ç”Ÿå½“å‰ææ¡ˆçš„ Input ç›¸å…³çš„æ‰€æœ‰ä»¥å‰çš„æ‰€æœ‰ transactions çš„é“¾æ¡ä¸­ï¼š Transaction åº”è¯¥è·å¾—æ‰€æœ‰ç›¸å…³æ–¹çš„æ•°å­—ç­¾å Transaction æ˜¯ åˆçº¦æœ‰æ•ˆ çš„ Transaction å”¯ä¸€æ€§ï¼šæœ¬æ¬¡ transaction ææ¡ˆè¦æ¶ˆè´¹çš„ inputs æ²¡æœ‰è¢«ä»»ä½•å·²ç»å­˜åœ¨çš„å…¶ä»–çš„å·²æäº¤çš„ transaction æ¶ˆè´¹è¿‡ 1.0.4.4 å‚è€ƒ states æ­£å¦‚ States æ‰€æè¿°çš„ï¼Œä¸€äº› states éœ€è¦è¢«å…¶ä»–çš„ input æˆ–è€… output states çš„åˆçº¦ä»£ç æ‰€å¼•ç”¨ï¼Œä½†æ˜¯ä¸éœ€è¦è¢«ä¿®æ”¹/æ¶ˆè´¹ã€‚è¿™å°±éœ€è¦å‚è€ƒ statesã€‚å½“ä¸€ä¸ª state è¢«æ·»åŠ åˆ°ä¸€ç¬”äº¤æ˜“çš„å‚è€ƒ states åˆ—è¡¨ä¸­ï¼Œè€Œä¸æ˜¯ inputs æˆ–è€… outputs åˆ—è¡¨çš„æ—¶å€™ï¼Œé‚£ä¹ˆå®ƒå°±è¢«ä½œä¸º å‚è€ƒ stateã€‚åœ¨å¸¸è§„çš„ states å’Œå‚è€ƒ states é—´æœ‰ä¸¤ç‚¹åŒºåˆ«ï¼š äº¤æ˜“çš„èŠ‚ç‚¹æŒ‡å®šçš„ notary ä¼šæ£€æŸ¥å‚è€ƒ state æ˜¯ä¸æ˜¯å½“å‰çš„ã€‚ç„¶è€Œï¼Œå½“åŒ…å«ä»–ä»¬çš„äº¤æ˜“è¢«æäº¤åˆ°è´¦æœ¬çš„æ—¶å€™ï¼Œå‚è€ƒ states æ˜¯ä¸ä¼šè¢«æ¶ˆè´¹çš„ã€‚ å¯¹äºå‚è€ƒ states çš„åˆçº¦ä»£ç ä¹Ÿä¸ä¼šè¢«åŒ…å«ä»–ä»¬çš„äº¤æ˜“æ‰€æ‰§è¡Œã€‚ 1.0.4.5 å…¶ä»–çš„äº¤æ˜“ç»„ä»¶ å°±åƒ input states å’Œ output states ä¸€æ ·ï¼Œtransactions è¿˜å¯èƒ½ä¼šåŒ…å«ä¸‹è¾¹çš„ç»„ä»¶ï¼š Commands Attachments Timestamps Notary æ¯”å¦‚ä¸€ä¸ªäº¤æ˜“ä¸­ï¼ŒAlice ä½¿ç”¨ Â£5 çš„ç°é‡‘å‘ Bob æ”¯ä»˜äº†ä¸€ä¸ª IOU çš„ Â£5ã€‚è¯¥ç¬”äº¤æ˜“åŒ…å«äº†ä¸¤ä¸ªé™„ä»¶ï¼Œå¹¶ä¸”åªèƒ½å¤Ÿåœ¨ notary pool åœ¨æŒ‡å®šçš„æ—¶é—´çª—å†…æ”¶åˆ°è¯¥ç¬”äº¤æ˜“çš„æ—¶å€™è¢« NotaryClusterA è¿›è¡Œå…¬è¯ï¼Œçœ‹èµ·æ¥åƒä¸‹è¾¹è¿™æ ·ï¼š 1.0.4.5.1 Commands ç¿»è¯‘è§†é¢‘è®²è§£Corda æ ¸å¿ƒæ¦‚å¿µ - Commands Commandsæ˜¯ä»€ä¹ˆï¼Ÿ Commands æ˜¯ä¸€äº›åŠ¨è¯ï¼ˆverbsï¼‰ Commands å°† transaction è¿›è¡Œå‚æ•°åŒ–ï¼ˆparameteriseï¼‰ï¼Œè¿™æ ·é™¤äº†ä» State ä¸­èƒ½å¤Ÿè·å–çš„ä¿¡æ¯å¤–ï¼Œcommands åˆèƒ½æä¾›äº†æ›´å¤šçš„ä¸€äº›ä¿¡æ¯ Commands ä¹Ÿæç¤ºï¼ˆhintï¼‰äº† transaction çš„æ„å›¾ï¼ˆintentï¼‰ Commands ä¹Ÿå¯èƒ½åŒ…å«é€šè¿‡ Oracle Service æä¾›çš„æ•°æ®ï¼ˆoff-ledger dataï¼‰ ä¸€äº› Commands å…¸å‹çš„ä¾‹å­ï¼š å‘å¸ƒï¼ˆissueï¼‰æ–°çš„ State åˆ°è´¦æœ¬ä¸Š äº¤æ¢ï¼ˆtransferï¼‰èµ„äº§åˆ°è´¦æœ¬ä¸­çš„å¦ä¸€æ–¹ ä»˜é’±ï¼ˆpayï¼‰ç»™è´¦æœ¬ä¸­çš„å¦ä¸€æ–¹ å¿è¿˜ï¼ˆredeemï¼‰ä¸€ç¬”èµ„äº§å¹¶ç»“æŸ/æ¸…é™¤ä»£è¡¨è¯¥èµ„äº§çš„state å°è¯•ï¼ˆexerciseï¼‰ä¸€ä¸ªé€‰é¡¹ option å±¥è¡Œï¼ˆsettleï¼‰ä¸€ä¸ªä¹‰åŠ¡æ¥é€’äº¤ä¸€ä¸ªèµ„äº§ å¦‚ä½•çŸ¥é“ä¸€ä¸ª transaction éƒ½éœ€è¦è°æ¥æä¾›ç­¾åå‘¢ï¼Ÿæˆ‘ä»¬ä¼šæŠŠä¸€ä¸ªå…¬é’¥åˆ—è¡¨å…³è”è‡³ä¸€ä¸ª commandï¼Œæ¥è¯´æ˜éƒ½è°éœ€è¦å¯¹è¿™ä¸ª command æä¾›ç­¾åã€‚ ä¸€ä¸ª commandä¸­ä¼šåŒ…å«ä¸€ä¸ªå…¬é’¥åˆ—è¡¨ï¼ˆpublic key listï¼‰ï¼Œé€šè¿‡è¿™ä¸ªåˆ—è¡¨å°±çŸ¥é“äº†éƒ½ä¼šæ¶‰åŠå“ªäº›äººæ¥ç¡®è®¤/ç­¾åè¯¥ state transaction åœ¨ transactionä¸­ï¼Œinput å’Œ output states ç»å¸¸ä¼šè¢«æŒ‰ç…§ç±»åˆ«åˆ†ç»„ï¼ˆè¿˜å¯èƒ½æ ¹æ®å…¶ä»–çš„æ¡ä»¶è¿›è¡Œåˆ†ç»„ï¼‰ æ¯ä¸€ç»„ state éƒ½éœ€è¦æœ‰ä¸€ä¸ª command 1.0.4.5.2 Attachments æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸€äº›æ•°æ®å¯ä»¥åœ¨ä¸åŒçš„ transactions ä¸­è¢«é‡ç”¨ã€‚æ¯”å¦‚ï¼š ä¸€ä¸ªå…¬å…±å‡æœŸçš„ calendar æ”¯æŒçš„æ³•å¾‹æ–‡æ¡£ ä¸€ä¸ªè´§å¸ä»£ç çš„è¡¨æ ¼ é’ˆå¯¹è¿™äº›æƒ…å†µï¼Œæˆ‘ä»¬ä½¿ç”¨é™„ä»¶ã€‚ä¸€ä¸ª transaction å¯ä»¥é€šè¿‡ hash å¼•ç”¨ 0 ä¸ªæˆ–è€…å¤šä¸ªé™„ä»¶ã€‚è¿™äº›é™„ä»¶æ˜¯ ZIP/JAR æ–‡ä»¶ï¼Œå¯ä»¥åŒ…å«ä»»ä½•å†…å®¹ã€‚è¿™äº›é™„ä»¶ä¸­ä¿¡æ¯å¯ä»¥ç”¨æ¥éªŒè¯ transaction çš„æœ‰æ•ˆæ€§ã€‚ 1.0.4.5.3 Time-window ä¸€äº›æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸€ä¸ªäº¤æ˜“ä»…ä»…åœ¨ä¸€ä¸ªæŒ‡å®šçš„æ—¶é—´ç‚¹è¢«æ‰¹å‡†æ‰§è¡Œã€‚ä¾‹å¦‚ï¼š åœ¨ä¸€ä¸ªæŒ‡å®šçš„æ—¥æœŸä¹‹åæ‰§è¡Œä¸€ä¸ªé€‰é¡¹ ä¸€ä¸ªå€ºåˆ¸åªèƒ½åœ¨å®ƒçš„è¿‡æœŸæ—¥æœŸå‰è¢«èµå› åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç»™ transaction æ·»åŠ ä¸€ä¸ª time-windowã€‚time-windows åˆ¶å®šäº†äº¤æ˜“ä¼šåœ¨å“ªä¸ªæ—¶é—´ç‚¹è¢«æäº¤ã€‚ 1.0.4.5.4 Notary **ä¸ªäººç†è§£ï¼š**ä¸ºäº†åœ¨issuance/genesis äº¤æ˜“ä¸­æä¾›å…¬è¯è¯æ˜çš„ï¼Œè¯æ˜æ­¤äº¤æ˜“çš„åˆæ³•æ€§ã€‚ 1.0.5 Contracts **ä¸ªäººç†è§£ï¼š**ä¸ä»¥å¤ªåŠçš„æ™ºèƒ½åˆçº¦ç±»ä¼¼ ä¸€ä¸ªæœ‰æ•ˆçš„ transaction å¿…é¡»è¦è¢«å®ƒçš„æ‰€æœ‰ input å’Œ output statesä¸­çš„ contract æ¥å— Contracts éœ€è¦ä½¿ç”¨ JVM ç¼–ç¨‹è¯­è¨€ç¼–å†™ï¼ˆjava æˆ–è€… kotlinï¼‰ Contract çš„æ‰§è¡Œæ˜¯ä¸€å®šè¦æœ‰ä¸€ä¸ªç¡®å®šæ€§ç»“æœçš„ï¼Œå¹¶ä¸”å®ƒå¯¹äºä¸€ä¸ª transaction çš„æ¥å—æ˜¯ä»…ä»…åŸºäº transaction çš„å†…å®¹ 1.0.5.1 Transaction éªŒè¯ ä¸€ä¸ª transaction ä»…ä»…å½“è¢«æ‰€æœ‰è¦æ±‚çš„ç­¾åæ–¹æä¾›äº†ç­¾åä¹‹åæ‰ä¼šè¢«è®¤ä¸ºæ˜¯æœ‰æ•ˆçš„ã€‚ä½†æ˜¯ï¼Œé™¤äº†è·å¾—åˆ°æ‰€æœ‰äººçš„ç­¾åä¹‹åï¼Œè¿˜å¿…é¡»è¦æ»¡è¶³ åˆçº¦æœ‰æ•ˆ æ‰ä¼šè¢«æœ€ç»ˆè®¤ä¸ºæœ‰æ•ˆã€‚ åˆçº¦æœ‰æ•ˆ çš„å®šä¹‰åŒ…å«ä»¥ä¸‹å‡ ç‚¹ï¼š æ¯ä¸ª state éƒ½æŒ‡å®šäº†ä¸€ä¸ª åˆçº¦ ç±»åˆ« åˆçº¦å°†äº¤æ˜“(transaction)ä½œä¸ºè¾“å…¥ï¼Œå¹¶æ ¹æ®åˆçº¦è§„åˆ™è¯´æ˜è¯¥äº¤æ˜“æ˜¯å¦æœ‰æ•ˆ ä»…å½“every input stateå’Œ** every output state **çš„åˆçº¦éƒ½è®¤ä¸ºå…¶æœ‰æ•ˆæ—¶ï¼Œäº¤æ˜“(transaction)æ‰æœ‰æ•ˆ æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹å›¾æ¥æè¿°è¿™ä¸ªå…³ç³»ï¼š åˆçº¦ä»£ç å¯ä»¥ç”¨ä»»ä½•JVMè¯­è¨€ç¼–å†™ï¼Œå¹¶å¯ä»¥ä½¿ç”¨è¯¥è¯­è¨€çš„å…¨éƒ¨åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š æ£€æŸ¥ inputsï¼Œoutputsï¼Œcommands çš„æ•°é‡ï¼Œæ—¶é—´ï¼Œé™„ä»¶ æ£€æŸ¥è¿™äº›ç»„ä»¶ä¸­çš„ä»»ä½•ä¸€ä¸ªçš„å†…å®¹ å¾ªç¯æ„é€ ï¼Œå˜é‡åˆ†é…ï¼Œå‡½æ•°è°ƒç”¨ï¼Œè¾…åŠ©æ–¹æ³•ç­‰ å°†ä¸€äº›ç±»ä¼¼çš„ states åˆ†ç»„æ¥éªŒè¯ï¼ˆæ¯”å¦‚å¯¹äºæ‰€æœ‰çš„ç°é‡‘ state çš„ç»„åˆå®šä¹‰ä¸€ä¸ªè§„åˆ™ï¼‰ ä¸€ä¸ª transaction å¦‚æœä¸æ˜¯åˆçº¦æœ‰æ•ˆçš„è¯ï¼Œæ˜¯ä¸ä¼šè¢«è§†ä¸ºä¸€ä¸ªå¯¹è´¦æœ¬çš„æœ‰æ•ˆæ›´æ–°ï¼Œä¹Ÿå°±ä¸å¯èƒ½è¢«æäº¤è‡³è´¦æœ¬ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒåˆåŒå¯¹stateéšæ—¶é—´çš„å˜åŒ–æ–½åŠ äº†è§„åˆ™ï¼Œè¿™äº›è§„åˆ™ä¸æ‰€éœ€ç­¾åè€…ç­¾ç½²ç»™å®šäº¤æ˜“çš„æ„æ„¿æ— å…³ã€‚ 1.0.5.2 The contract sandbox **ä¸ªäººç†è§£ï¼š**ä¸ºäº†ä¿è¯éªŒè¯çš„ç»“æœä¸æ ¹æ®å¤–éƒ¨çš„æ¡ä»¶è€Œæ”¹å˜ï¼ŒCordaæä¾›äº†ä¸€ä¸ªæ²™ç®±ï¼Œä»¥é˜²æ­¢ä»£ç å¼•å…¥å¯èƒ½ä¼šé€ æˆä¸ç¡®å®šæ€§ç»“æœçš„å¤–éƒ¨åº“ Deterministic Corda Modules Transaction éªŒè¯å¿…é¡»æ˜¯ ä¸€ä¸ªç¡®å®šæ€§çš„ç»“æœï¼š åœ¨ä¸€ä¸ªç¡®å®šçš„transactionæè®®ä¸­ï¼Œä¸€ä¸ª contract å¿…é¡»æ€»æ˜¯æ¥å— æˆ–è€… æ€»æ˜¯æ‹’ç»ã€‚æ¯”å¦‚ transaction æ˜¯å¦æœ‰æ•ˆä¸èƒ½å¤Ÿå–å†³äºä½ åœ¨ä»€ä¹ˆæ—¶é—´åšçš„ verify æˆ–è€…æ˜¯åŸºäºæŸä¸€æ–¹å…·æœ‰çš„ä¿¡æ¯é‡çš„å¤šå°‘æ¥å†³å®šæ˜¯æœ‰æ•ˆçš„è¿˜æ˜¯æ— æ•ˆçš„ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ¡ä»¶æ¥ç¡®ä¿ç½‘ç»œä¸Šçš„ç›¸å…³èŠ‚ç‚¹èƒ½å¤Ÿåœ¨è¿™ä¸ªå¯¹è´¦æœ¬çš„æ›´æ–°çš„æ“ä½œè¾¾æˆå…±è¯†ã€‚ 1.0.5.3 Contract çš„å±€é™æ€§ å› ä¸º contract æ²¡æœ‰åŠæ³•è®¿é—®åˆ°å¤–éƒ¨çš„ä¿¡æ¯ï¼Œå®ƒåªèƒ½æ£€æŸ¥ transaction å†…éƒ¨çš„æœ‰æ•ˆæ€§ï¼Œæ¯”å¦‚å®ƒä¸èƒ½å¤Ÿæ£€æŸ¥ç¡®è®¤å½“å‰è¿™ä¸ª transaction æ˜¯ä¸æ˜¯å·²ç»åŒå…¶ä»–ç›¸å…³æ–¹è¾¾æˆäº†å…±è¯†å–å¾—äº†å…¶ä»–æ–¹çš„ç¡®è®¤ã€‚ æ‰€ä»¥åœ¨å„æ–¹æä¾›æœ€ç»ˆçš„ç­¾åç¡®è®¤ä¹‹å‰ï¼Œå„æ–¹åº”è¯¥å¯¹transaction çš„å†…å®¹è¿›è¡Œæ£€æŸ¥æ¥ç¡®å®šä»–ä»¬æ˜¯å¦åŒæ„è¿™ä¸ªå¯¹è´¦æœ¬çš„æ›´æ–°ï¼Œå³ä½¿è¿™ä¸ª transaction æ˜¯åˆçº¦æœ‰æ•ˆçš„ã€‚ä»»ä½•ä¸€æ–¹éƒ½æ²¡æœ‰ä¹‰åŠ¡å› ä¸ºtransactionæ˜¯æ˜¯åˆçº¦æœ‰æ•ˆè€Œæä¾›ç­¾åã€‚æ¯”å¦‚ä»–ä»¬å¯èƒ½ä¸æ„¿æ„å»æä¾›ä¸€ä¸ªå·¨é¢çš„å€Ÿæ¬¾ï¼Œæˆ–è€…å¯èƒ½ä¸ä¼šåŒæ„è´­ä¹°ä¸€ä¸ªèµ„äº§èŠ±è´¹çš„é’±çš„é‡‘é¢ã€‚ 1.0.5.4 Oracles æœ‰æ—¶ï¼Œäº¤æ˜“æœ‰æ•ˆæ€§å°†å–å†³äºæŸäº›å¤–éƒ¨ä¿¡æ¯ï¼Œä¾‹å¦‚æ±‡ç‡ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œéœ€è¦ä¸€ä¸ªoracleã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§Oracleã€‚ 1.0.5.5 Legal prose æ¯ä¸€ä¸ªåˆçº¦ä¹Ÿä¼šå¼•ç”¨ä¸€ä¸ª legal prose æ–‡æ¡£ï¼Œè¿™ä¸ªæ–‡æ¡£ä¸­å®šä¹‰äº†åˆçº¦ä¸­è§„å®šçš„å†…å®¹ï¼Œlegal prose ä¹Ÿä¼šè¢«ä¼ ç»Ÿçš„æ³•å¾‹ç³»ç»Ÿæ‰€æ¥å—ã€‚è¿™ä¸ªæ–‡æ¡£ä¼šåœ¨å‘ç”Ÿæ³•å¾‹çº çº·çš„æ—¶å€™è¢«ç”¨æ¥è¿›è¡Œåˆ¤å®šä¾æ®ã€‚ 1.0.6 Flows Flows ä½¿åŒæ„æ›´æ–°è´¦æœ¬çš„æµç¨‹å˜å¾—è‡ªåŠ¨åŒ– èŠ‚ç‚¹ä¹‹é—´çš„æ²Ÿé€šåªèƒ½å¤Ÿåœ¨è¿™äº› Flows çš„ä¸Šä¸‹æ–‡ä¸­å‘ç”Ÿï¼Œå¹¶ä¸”æ˜¯ç‚¹å¯¹ç‚¹çš„ å†…ç½®çš„ flows æä¾›äº†å¸¸ç”¨çš„ä¸€äº›ä»»åŠ¡ Corda ç½‘ç»œä½¿ç”¨ç‚¹å¯¹ç‚¹çš„æ¶ˆæ¯ä¼ è¾“è€Œä¸æ˜¯å…¨å±€å¹¿æ’­ã€‚ä¹Ÿå°±æ˜¯è¯´åè°ƒä¸€ä¸ªå…³äºè´¦æœ¬çš„æ›´æ–°éœ€è¦ç½‘ç»œä¸Šçš„å‚ä¸è€…æ˜ç¡®çš„æŒ‡å®šéœ€è¦å‘é€ä»€ä¹ˆä¿¡æ¯ï¼Œå‘é€ç»™è°ï¼ŒæŒ‰ç…§ä»€ä¹ˆé¡ºåºå‘é€ã€‚ 1.0.6.1 Flow æ¡†æ¶ ä¸€ä¸ª flow æ˜¯ä¸€ç³»åˆ—æœ‰é¡ºåºçš„æ­¥éª¤æ¥å‘Šè¯‰ä¸€ä¸ªèŠ‚ç‚¹åº”è¯¥å¦‚ä½•å®ç°ä¸€ä¸ªæŒ‡å®šçš„è´¦æœ¬æ›´æ–°ï¼Œæ¯”å¦‚å‘è¡Œä¸€ä¸ªèµ„äº§æˆ–è€…ç»“ç®—ä¸€ç¬”äº¤æ˜“ã€‚ ä¸‹è¾¹æ˜¯ä¸€ä¸ªä¸Šè¾¹å›¾ç‰‡æ‰€æè¿°çš„ç®€å•è´¦æœ¬æ›´æ–°æ‰€æ¶‰åŠåˆ°çš„é¡ºåºçš„æµç¨‹ï¼š 1.0.6.2 è¿è¡Œ flows ä¸€æ—¦ä¸€ä¸ªä¸šåŠ¡æµç¨‹è¢«å°è£…åœ¨äº†ä¸€ä¸ª flow ä¸­å¹¶ä¸”åœ¨èŠ‚ç‚¹ä¸­ä½œä¸º CorDapp çš„ä¸€éƒ¨åˆ†è¢«å®‰è£…å¥½ä¹‹åï¼ŒèŠ‚ç‚¹çš„æ‰€æœ‰è€…å¯ä»¥åœ¨ä»»ä½•æ—¶é—´é€šè¿‡ä½¿ç”¨ä¸€ä¸ª RPC call æ¥å‘Šè¯‰èŠ‚ç‚¹å¼€å§‹è¿™ä¸ªä¸šåŠ¡æµç¨‹ã€‚Flow å°†æ‰€æœ‰çš„ç½‘ç»œï¼ŒI/O å’Œå¹¶å‘é—®é¢˜éƒ½æŠ½è±¡äº†å‡ºæ¥ï¼Œè¿™ä¸ªèŠ‚ç‚¹ owner å°±ä¸éœ€è¦å…³æ³¨è¿™äº›äº†ã€‚ èŠ‚ç‚¹ä¸Šæ‰€æœ‰çš„åŠ¨ä½œéƒ½æ˜¯å‘ç”Ÿåœ¨è¿™äº› flows çš„ä¸Šä¸‹æ–‡ä¸Šçš„ã€‚ä¸ contract ä¸åŒï¼Œflows ä¸æ˜¯åœ¨ sandbox é‡Œæ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´èŠ‚ç‚¹å¯ä»¥åœ¨æ‰§è¡Œä¸€ä¸ª flow çš„è¿‡ç¨‹ä¸­æ¥è¿›è¡Œä¸€äº›åŠ¨ä½œæ¯”å¦‚ networkingï¼ŒI/O æˆ–è€…éšæœºåœ°ä½¿ç”¨ä¸€äº›èµ„æºã€‚ 1.0.6.3 èŠ‚ç‚¹å†…éƒ¨é€šä¿¡ èŠ‚ç‚¹é—´æ˜¯é€šè¿‡åœ¨ä¸åŒçš„ flowsé—´ä¼ é€’æ¶ˆæ¯æ¥è¿›è¡Œæ²Ÿé€šçš„ã€‚æ¯ä¸ªèŠ‚ç‚¹æœ‰0ä¸ªæˆ–è€…å¤šä¸ªæ³¨å†Œçš„ flow classes æ¥å›å¤å¦å¤–ä¸ªä¸€ä¸ªå•ç‹¬çš„ flow çš„æ¶ˆæ¯ã€‚ å‡è®¾ Alice æ˜¯ç½‘ç»œä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”å¥¹å¸Œæœ›åŒ Bobï¼ˆç½‘ç»œä¸­çš„å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼‰ ä¸€èµ·åŒæ„ä¸€æ¬¡è´¦æœ¬çš„æ›´æ–°ã€‚ä¸ºäº†è·Ÿ Bob è¿›è¡Œæ²Ÿé€šï¼Œ Alice å¿…é¡»ï¼š å¼€å§‹ä¸€ä¸ª Bob å·²ç»æ³¨å†Œè¿‡çš„ flow Alice åœ¨è¿™ä¸ª flow çš„ä¸Šä¸‹æ–‡ä¸­ç»™ Bob å‘é€ä¸€ä¸ªæ¶ˆæ¯ Bob ä¼šå¯åŠ¨å®ƒæ³¨å†Œçš„è¿™ä¸ª conterparty flow è¿æ¥å·²ç»å»ºç«‹èµ·æ¥äº†ï¼ŒAlice å’Œ Bob å°±å¯ä»¥åƒ flow æ­¥éª¤ä¸­æè¿°çš„é‚£æ ·æ¥å›åœ°æ²Ÿé€šå…³äºä¸€ä¸ªæ›´æ–°è´¦æœ¬çš„æ”¹åŠ¨å¹¶ä¸”æœ€ç»ˆè¾¾æˆä¸€è‡´ã€‚ 1.0.6.4 Subflows Flows å¯ä»¥é€šè¿‡åœ¨å¦å¤–ä¸€ä¸ª flow çš„ä¸Šä¸‹æ–‡ä¸­å¼€å§‹ä¸€ä¸ªæ–°çš„ flow ä½œä¸ºä¸€ä¸ªå­æµç¨‹çš„æ–¹å¼è¢«ç»„æˆã€‚ä½œä¸ºå­æµç¨‹è¢«å¯åŠ¨çš„ Flow è¢«ç§°ä¸º subflowã€‚çˆ¶ flow éœ€è¦ç­‰å¾…æ‰€æœ‰çš„ subflow å®Œæˆåæ‰ä¼šç»§ç»­è¿è¡Œã€‚ 1.0.6.5 Flow ç±»åº“ Corda å¯¹äºä¸€äº›å¸¸è§„çš„ä»»åŠ¡éƒ½æä¾›äº†ä¸€å¥—ä»£ç åº“ï¼ˆAPI: Flowsï¼‰ï¼Œæ‰€ä»¥å¼€å‘è€…å°±ä¸éœ€è¦è‡ªå·±å»å®šä¹‰è¿™äº›å¸¸è§æµç¨‹èƒŒåçš„é€»è¾‘äº†ï¼Œæ¯”å¦‚ï¼š å…¬æ­£å’Œè®°å½•ä¸€ä¸ª transaction ä»ç›¸å…³èŠ‚ç‚¹æœé›†ç­¾å éªŒè¯äº¤æ˜“é“¾ 1.0.6.6 å¹¶å‘ Flow æ¡†æ¶å…è®¸èŠ‚ç‚¹å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ª flowsã€‚è¿™äº› flows å¯èƒ½ç”±äºèŠ‚ç‚¹çš„é‡å¯ç”šè‡³å‡çº§ä¼šæŒç»­å‡ å¤©ã€‚ è¿™ä¸ªå¯ä»¥é€šè¿‡åœ¨ flow å˜æˆé˜»å¡çš„çŠ¶æ€çš„æ—¶å€™ï¼Œå°† flows åºåˆ—åŒ–åˆ°ç¡¬ç›˜ä¸­çš„æ–¹å¼æ¥å®ç°ï¼ˆæ¯”å¦‚ä»–ä»¬åœ¨ç­‰å¾… I/O æˆ–è€…æ˜¯ç½‘ç»œçš„è°ƒç”¨ï¼‰ã€‚å‡ºç°è¿™ç§æƒ…å†µçš„æ—¶å€™ï¼ŒèŠ‚ç‚¹ä¸ä¼šç­‰å¾…è¿™ä¸ªé˜»å¡çŠ¶æ€çš„ flowå˜æˆéé˜»å¡çš„çŠ¶æ€ï¼Œè€Œä¼šç«‹å³è¿è¡Œå…¶ä»–çš„ flowï¼Œåªä¼šåœ¨ç¨åè¿”å›åˆ°åŸæ¥è¿™ä¸ªé˜»å¡çš„flowã€‚ 1.0.7 consensus(å…±è¯†) ä¸ºäº†äº¤æ˜“èƒ½å¤Ÿè¢«æäº¤ï¼Œtransaction å¿…é¡»è¦åŒæ—¶æ»¡è¶³æœ‰æ•ˆæ€§å’Œ å”¯ä¸€æ€§çš„å…±è¯† æœ‰æ•ˆæ€§å…±è¯†éœ€è¦ transaction å’Œ å®ƒçš„æ‰€æœ‰ä¾èµ–éƒ½æ˜¯åˆçº¦æœ‰æ•ˆçš„ å”¯ä¸€æ€§å…±è¯†å¯ä»¥é¿å…â€œåŒèŠ±â€ 1.0.7.1 ä¸¤ç§ç±»å‹çš„å…±è¯† åˆ¤æ–­ä¸€ä¸ªäº¤æ˜“çš„ææ¡ˆæ˜¯å¦æ˜¯ä¸€æ¬¡æœ‰æ•ˆçš„è´¦æœ¬æ›´æ–°è¦è¾¾åˆ°ä¸¤ç§ç±»å‹çš„å…±è¯†ï¼š æœ‰æ•ˆæ€§å…±è¯†ï¼šè¿™ç»™æ˜¯äº¤æ˜“æ‰€è¦æ±‚çš„ç­¾åè€…åœ¨æä¾›ä»–ä»¬ç­¾åä¹‹å‰å»æ ¡éªŒçš„ å”¯ä¸€æ€§å…±è¯†ï¼šè¿™ä¸ªåªä¼šè¢« notary service å»éªŒè¯ 1.0.7.1.1 æœ‰æ•ˆæ€§å…±è¯† æœ‰æ•ˆæ€§å…±è¯†æ˜¯å…³äºéªŒè¯ä¸‹è¾¹æ‰€æè¿°çš„æ¡ä»¶å¯¹äºæäº¤çš„ transaction å’Œç”Ÿæˆè¯¥è¯¥ transaction çš„ inputs çš„äº¤æ˜“é“¾ä¸­çš„æ¯æ¬¡ transaction éƒ½å¿…é¡»è¦æ»¡è¶³ï¼š Transaction ä¸­çš„æ¯ä¸ª input å’Œ output çš„ contracts æ‰€æ¥å— Transaction å¾—åˆ°äº†æ‰€æœ‰è¦æ±‚çš„ç­¾å ä»…ä»…æ£€æŸ¥äº¤æ˜“ææ¡ˆæœ¬èº«ä¿¡æ¯æ˜¯ä¸å¤Ÿçš„ã€‚æˆ‘ä»¬è¿˜éœ€è¦æ£€æŸ¥è·Ÿäº§ç”Ÿå½“å‰è¿™ä¸ª transaction çš„ inputs æœ‰å…³çš„æ‰€æœ‰ä»¥å‰çš„ transaction é“¾ã€‚ è¿™ä¸ªè¢«ç§°ä½œ walking the chainã€‚å‡è®¾ï¼Œä¾‹å¦‚ç½‘ç»œä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹æäº¤äº†ä¸€ä¸ªäº¤æ¢å€ºåˆ¸çš„ä¸€ç¬”äº¤æ˜“ã€‚æˆ‘ä»¬åªæœ‰äº†è§£ä¸‹è¾¹çš„æƒ…å†µæ‰èƒ½ç¡®ä¿è¿™ä¸ªå€ºåˆ¸çš„äº¤æ¢æ˜¯æœ‰æ•ˆçš„ï¼š è¿™ä¸ªå€ºåˆ¸åº”è¯¥æ˜¯ç”±ä¸­å¿ƒé“¶è¡Œå‘è¡Œçš„ï¼Œè€Œä¸”åº”è¯¥æ˜¯åœ¨ä¸€æ¬¡æœ‰æ•ˆçš„å‘è¡Œäº¤æ˜“ä¸­ å…³äºè¿™ä¸ªå€ºåˆ¸çš„åç»­äº¤æ˜“è®°å½•ä¹Ÿåº”è¯¥éƒ½æ˜¯æœ‰æ•ˆçš„ ç¡®ä¿ä¸¤ç‚¹éƒ½æ»¡è¶³çš„å”¯ä¸€æ–¹å¼å°±æ˜¯æŸ¥çœ‹æ•´ä¸ªäº¤æ˜“é“¾ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š å½“ç¡®è®¤ä¸€ä¸ªäº¤æ˜“ææ¡ˆçš„æ—¶å€™ï¼Œç»™å®šçš„ä¸€æ–¹å¯èƒ½æ²¡æœ‰å®ƒéœ€è¦éªŒè¯çš„äº¤æ˜“é“¾ä¸Šçš„æ‰€æœ‰äº¤æ˜“ä¿¡æ¯ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä»–å¯ä»¥å‘äº¤æ˜“çš„æå‡ºæ–¹ç´¢è¦ç¼ºå°‘çš„é‚£éƒ¨åˆ†äº¤æ˜“ã€‚äº¤æ˜“çš„æå‡ºæ–¹åº”è¯¥æ°¸è¿œä¼šæœ‰æ•´ä¸ªçš„äº¤æ˜“é“¾ä¿¡æ¯ï¼Œå› ä¸ºä»–ä»¬åº”è¯¥åœ¨éªŒè¯ä¹‹å‰çš„äº¤æ˜“ä¸­å·²ç»è·å–äº†ç›¸å…³çš„äº¤æ˜“é“¾ä¿¡æ¯ã€‚ 1.0.7.1.2 å”¯ä¸€æ€§å…±è¯† è®¾æƒ³ä¸€ä¸‹ Bob æŒæœ‰æœ‰æ•ˆçš„ç”±ä¸­å¤®é“¶è¡Œå‘è¡Œçš„ $1,000,000 ç°é‡‘ stateã€‚Bob å¯ä»¥åˆ›å»ºä¸¤ä¸ªäº¤æ˜“ææ¡ˆï¼š ä¸€ç¬”äº¤æ˜“è¦è·Ÿ Charlie ç”¨è¿™ $1,000,000 äº¤æ¢ Â£800,000 ä¸€ç¬”äº¤æ˜“è¦è·Ÿ Dan ç”¨è¿™ $1,000,000 äº¤æ¢ â‚¬900,000 è¿™ä¼šæ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºå°½ç®¡è¿™ä¸¤ç¬”äº¤æ˜“éƒ½å¯ä»¥é€šè¿‡æœ‰æ•ˆæ€§å…±è¯†ï¼Œä½†æ˜¯ Bob ç¡®å®ç°äº†ä¸€æ¬¡â€œåŒèŠ± double spendâ€ ä»–çš„ç¾å…ƒæ¥è·å¾—äº†ä¸¤å€ä»·å€¼çš„ GBP å’Œ EURã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºè¿™ä¸ªæµç¨‹ï¼š ä¸ºäº†é¿å…è¿™æ ·çš„é—®é¢˜å‘ç”Ÿï¼Œä¸€ä¸ªæœ‰æ•ˆçš„äº¤æ˜“ææ¡ˆåŒæ—¶ä¹Ÿè¦æ»¡è¶³å”¯ä¸€æ€§å…±è¯†ã€‚å”¯ä¸€æ€§å…±è¯†è¦æ±‚ä¸€ä¸ª transaction çš„ input ä¸èƒ½è¢«ä»»ä½•å…¶ä»–çš„ transaction æ¶ˆè´¹æ‰è¿‡ã€‚ å½“ä¸€ä¸ªäº¤æ˜“ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ª inputs å·²ç»è¢«å…¶ä»–çš„äº¤æ˜“æ¶ˆè´¹æ‰çš„æƒ…å†µï¼Œé€šå¸¸è¢«ç§°ä¸º åŒèŠ±ï¼Œé‚£ä¹ˆç›¸å…³çš„äº¤æ˜“åº”è¯¥è¢«è§†ä¸ºæ— æ•ˆçš„äº¤æ˜“ã€‚ å”¯ä¸€æ€§å…±è¯†æ˜¯ç”± notaries æä¾›çš„ã€‚æŸ¥çœ‹ Notaries äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚ 1.0.8 Notaries Notary é›†ç¾¤é¿å… â€œåŒèŠ±â€ Notary é›†ç¾¤ä¹Ÿå¯ä»¥æ˜¯æ—¶é—´æˆ³æˆæƒã€‚å¦‚æœä¸€ç¬”äº¤æ˜“åŒ…å«ä¸€ä¸ª time-windowï¼Œé‚£ä¹ˆå®ƒåªèƒ½åœ¨è¿™ä¸ª time-window å†…è¢«å…¬è¯ Notary é›†ç¾¤ä¹Ÿå¯ä»¥å¯é€‰åœ°ç”¨æ¥éªŒè¯äº¤æ˜“ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä»–ä»¬è¢«ç§°ä¸º â€œç”¨äºéªŒè¯â€ çš„ notariesï¼Œç›¸å¯¹äº â€œééªŒè¯â€ çš„ notaries ä¸€ä¸ªç½‘ç»œä¸­å¯ä»¥æœ‰å¤šä¸ª notariesï¼Œæ¯ä¸€ä¸ª notary è¿è¡Œä¸€ä¸ªä¸åŒçš„å…±è¯†ç®—æ³• 1.0.8.1 æ¦‚è§ˆ ä¸€ä¸ª notary é›†ç¾¤ æ˜¯ä¸€ä¸ªç½‘ç»œæœåŠ¡ï¼Œé€šè¿‡è¯æ˜ä¸€ä¸ªç»™å®šçš„äº¤æ˜“çš„ input æ˜¯æ²¡æœ‰è¢«å…¶ä»–çš„äº¤æ˜“æ¶ˆè´¹è¿‡çš„æ–¹å¼æä¾›äº† å”¯ä¸€æ€§å…±è¯†ã€‚ å½“è¢«è¦æ±‚ä¸ºä¸€ç¬”äº¤æ˜“è¿›è¡Œå…¬è¯çš„æ—¶å€™ï¼Œä¸€ä¸ª notary é›†ç¾¤ä¼šè¿›è¡Œä¸‹è¾¹ä¸¤ç§æ“ä½œä¸­çš„ä¸€ç§ï¼š å¦‚æœå¯¹äºç»™å®šçš„äº¤æ˜“ä¸­çš„ inputï¼Œæ²¡æœ‰ä»»ä½•å…¶ä»–çš„äº¤æ˜“å·²ç»æ¶ˆè´¹è¯¥ input çš„æ—¶å€™ï¼Œä¼šæä¾›ç­¾å æ‹’ç»è¿™ç¬”äº¤æ˜“å¹¶ä¸”æ ‡æ˜äº§ç”Ÿäº†åŒèŠ±çš„æƒ…å†µ é€šè¿‡è¿™æ ·åšï¼Œnotary é›†ç¾¤å°±åœ¨ç³»ç»Ÿä¸­æä¾›äº†ä¸€ä¸ªç»ˆç»“ç‚¹ã€‚åœ¨æœ€ç»ˆè·å¾— notary é›†ç¾¤çš„ç­¾åä¹‹å‰ï¼Œäº¤æ˜“å„æ–¹å¹¶ä¸èƒ½ç¡®å®šäº¤æ˜“çš„æœ‰æ•ˆæ€§ã€‚ä½†æ˜¯å½“æ”¶åˆ°äº† notary é›†ç¾¤çš„ç­¾åä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤çš„æ˜¯ï¼Œäº¤æ˜“ä¸­çš„ Input æ˜¯æ²¡æœ‰è¢«å…¶ä»–ä»»ä½•çš„äº¤æ˜“æ‰€æ¶ˆè´¹è¿‡çš„ã€‚å› æ­¤å…¬è¯ï¼ˆnotarisationï¼‰åœ¨ç³»ç»Ÿé‡Œæ˜¯æœ€åçš„ä¸€æ­¥ã€‚ æ¯ä¸ª state éƒ½ä¼šæœ‰ä¸€ä¸ªæŒ‡å®šçš„ notary é›†ç¾¤ï¼Œè€Œä¸”ä¸€ä¸ª notary é›†ç¾¤ä¹Ÿåªä¼šå»å…¬æ­£é‚£äº› input æŒ‡å®šå®ƒä¸º notary é›†ç¾¤çš„ transactionã€‚ 1.0.8.2 å…±è¯†ç®—æ³• Corda æ‹¥æœ‰ä¸€å¥— â€œå¯æ’æ‹”â€ çš„å…±è¯†ï¼Œå…è®¸ notary é›†ç¾¤æ ¹æ®ä¸åŒçš„éœ€æ±‚ï¼ˆç§æœ‰åŒ–ã€æ‰©å±•æ€§ã€æ³•å¾‹ç³»ç»Ÿçš„å…¼å®¹æ€§å’Œç®—æ³•çš„ä¾¿æ·æ€§ï¼‰æ¥é€‰æ‹©ä¸€ç§å…±è¯†ç®—æ³•ã€‚ ç‰¹åˆ«çš„ï¼Œnotary é›†ç¾¤å¯èƒ½å«æœ‰ä¸‹è¾¹çš„ä¸åŒï¼š ç»“æ„ï¼š ä¸€ä¸ª notary é›†ç¾¤å¯èƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç½‘ç»œèŠ‚ç‚¹ï¼Œæˆ–è€…æ˜¯äº’ç›¸ä¿¡ä»»çš„èŠ‚ç‚¹é›†ç¾¤ï¼Œæˆ–è€…æ˜¯äº’ä¸ä¿¡ä»»çš„èŠ‚ç‚¹é›†ç¾¤ å…±è¯†ç®—æ³•ï¼š ä¸€ä¸ª notary é›†ç¾¤å¯èƒ½ä¼šé€‰æ‹©è¿è¡Œä¸€ä¸ªé«˜é€Ÿï¼Œé«˜ä¿¡ä»»çš„ç®—æ³•ï¼ˆæ¯”å¦‚ RAFTï¼‰ï¼Œæˆ–è€…ä¸€ä¸ªä½é€Ÿä½ä¿¡ä»»çš„ç®—æ³•ï¼ˆæ¯”å¦‚ BFTï¼‰ï¼Œåˆæˆ–è€…æ˜¯ä»»ä½•å…¶ä»–çš„é€‰æ‹©çš„å…±è¯†ç®—æ³• 1.0.8.3 éªŒè¯ ä¸€ä¸ª notary é›†ç¾¤è¿˜éœ€è¦é€‰æ‹©æ˜¯å¦åœ¨æäº¤ä¹‹å‰é€šè¿‡éªŒè¯æ¯ä¸ª transaction çš„æœ‰æ•ˆæ€§æ¥æä¾›è¿™ç§ æœ‰æ•ˆæ€§å…±è¯† æœåŠ¡ã€‚ä¸ºäº†åšå‡ºè¿™ä¸ªé€‰æ‹©ï¼Œä»–ä»¬éœ€è¦é¢å¯¹ä¸‹è¾¹çš„å–èˆé—®é¢˜ï¼š å¦‚æœä¸€ä¸ª transaction æ²¡æœ‰ è¢«éªŒè¯äº†æ­£ç¡®ä¸å¦ï¼ˆééªŒè¯ notaryï¼‰ï¼Œé‚£ä¹ˆè¿™å°±å¢åŠ äº† â€œdenial of stateâ€ è¢­å‡»çš„é£é™©ï¼ŒæŒ‡çš„å°±æ˜¯æŸä¸ªèŠ‚ç‚¹çŸ¥é“è¿™æ˜¯ä¸€ä¸ªä¸æ­£ç¡®çš„ transaction ä¼šæ¶ˆè´¹åˆ°ä¸€äº› statesï¼Œç„¶åè¯¥èŠ‚ç‚¹è¿˜æ˜¯æŠŠè¿™ä¸ª transaction å‘é€ç»™ notary é›†ç¾¤ï¼Œä½†æ˜¯ notary å¦‚æœä¸è¿›è¡Œæ­£ç¡®æ€§éªŒè¯çš„è¯ï¼Œä¼šæŠŠè¿™ä¸ª state å˜ä¸ºå†å²è®°å½•è¢«æ¶ˆè´¹æ‰ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸æ­£ç¡®çš„ å¦‚æœ transaction å·²ç» è¢«éªŒè¯äº†æ­£ç¡®ä¸å¦ï¼ˆéªŒè¯ notaryï¼‰ï¼Œnotary éœ€è¦æŸ¥çœ‹è¯¥ transaction çš„å…¨éƒ¨å†…å®¹ä»¥åŠå®ƒçš„æ‰€æœ‰ä¾èµ–ã€‚è¿™å°±å‘ notary æš´éœ²äº†ä¸€äº›æ½œåœ¨çš„éšç§æ•°æ®ã€‚ å½“æˆ‘ä»¬è€ƒé‡è¿™äº›å–èˆçš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªåç»­è§‚ç‚¹éœ€è¦å§‹ç»ˆè¦è€ƒè™‘çš„ã€‚å¯¹äºééªŒè¯æ¨¡å¼ï¼ŒCorda çš„æ§åˆ¶çš„æ•°æ®åˆ†å¸ƒæ¨¡å‹æ„å‘³ç€æœªè¢«æ¶ˆè´¹çš„ states ä¸ä¼šè¢«å¤§é¢ç§¯çš„å…±äº«ã€‚å¦å¤–ï¼Œ Corda çš„ permissioned network ä¹Ÿæ„å‘³ç€ notary èƒ½å¤Ÿå­˜å‚¨é€ æˆ â€œdenial of stateâ€ transaction çš„ä¸€æ–¹çš„èº«ä»½ä¿¡æ¯ï¼Œè¿™å°±å…è®¸èƒ½å¤Ÿåœ¨è´¦æœ¬å¤–å»è§£å†³æ‰è¿™ä¸ªè¢­å‡»ã€‚ å¯¹äºéªŒè¯æ¨¡å¼ï¼Œå¯¹äºåŒ¿åçš„ä½¿ç”¨ï¼Œä½¿ç”¨æ–°ç”Ÿæˆçš„å…¬é’¥è€Œä¸æ˜¯ä½¿ç”¨æ³•å¾‹çš„æ ‡è¯†æ¥æ ‡è®°ä¸€ç¬”äº¤æ˜“çš„å„æ–¹ä¹Ÿé™åˆ¶äº† notary é›†ç¾¤èƒ½å¤Ÿçœ‹åˆ°çš„ä¿¡æ¯ã€‚ 1.0.8.4 æ•°æ®çš„å¯è§†æ€§ ä¸‹è¾¹æ˜¯å…³äºå“ªäº›ç‰¹æ®Šçš„äº¤æ˜“ç»„ä»¶å¿…é¡»è¦æš´éœ²ç»™æ¯ç§ç±»å‹çš„ notary çš„ä¸€ä¸ªæ€»ç»“ï¼š Transaction components Validating Non-validating Input states Fully visible References only [1] Output states Fully visible Hidden Commands (with signer identities) Fully visible Hidden Attachments Fully visible Hidden Time window Fully visible Fully visible Notary identity Fully visible Fully visible Signatures Fully visible Hidden ä¸¤ç§ç±»å‹çš„ notaries éƒ½ä¼šè®°å½•è°ƒç”¨æ–¹çš„èº«ä»½ä¿¡æ¯ï¼šå…¬é’¥ä»¥åŠ X.500 å”¯ä¸€çš„åå­—ã€‚ 1.0.8.5 å¤šä¸ª Notaries æ¯ä¸ª Corda ç½‘ç»œå¯ä»¥å­˜åœ¨å¤šä¸ª notary é›†ç¾¤ï¼Œæ¯ä¸ª notary é›†ç¾¤å¯èƒ½ä¼šè¿è¡Œä¸€å¥—ä¸åŒçš„å…±è¯†ç®—æ³•ã€‚è¿™ä¼šå¸¦æ¥ä»¥ä¸‹çš„å¥½å¤„ï¼š éšç§æ€§ - æˆ‘ä»¬å¯ä»¥åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­åŒæ—¶æ‹¥æœ‰éªŒè¯å’ŒééªŒè¯çš„ notary é›†ç¾¤ï¼Œæ¯ä¸ªé›†ç¾¤è¿è¡Œç€ä¸åŒçš„ç®—æ³•ã€‚è¿™å°±å…è®¸èŠ‚ç‚¹é’ˆå¯¹æ¯ä¸ª transaction æ¥é€‰æ‹©æ›´å–œæ¬¢çš„ä¸åŒçš„ notaryã€‚ è´Ÿè½½å¹³è¡¡ - å°† transaction çš„å·¥ä½œåˆ†å‘ç»™å¤šä¸ª notary é›†ç¾¤å¯ä»¥æé«˜å¹³å°æ•´ä½“çš„äº¤æ˜“ååé‡ ä½å»¶è¿Ÿ - é€šè¿‡é€‰æ‹©ç‰©ç†ä¸Šç¦»äº¤æ˜“æ–¹æœ€è¿‘çš„ notary é›†ç¾¤æ¥è·å¾—æœ€å°åŒ–çš„å»¶è¿Ÿ 1.0.8.6 æ›´æ¢ notaries ä¸€ä¸ª notary é›†ç¾¤åªæœ‰å½“å®ƒæ˜¯è¿™ä¸ª transaction é‡Œçš„æ‰€æœ‰ input states æŒ‡å®šçš„ notary çš„æƒ…å†µä¸‹æ‰å¯ä»¥æä¾›ç­¾åã€‚ç„¶è€Œä¸‹è¾¹çš„æƒ…å†µå¯èƒ½éœ€è¦æ¢ä¸€ä¸ª state çš„æŒ‡å®šçš„ notary é›†ç¾¤ï¼ŒåŒ…æ‹¬ï¼š å½“ä¸€ä¸ª transaction éœ€è¦æ¶ˆè´¹çš„ states ä¸­æŒ‡å®šäº†ä¸åŒçš„ notary é›†ç¾¤ å½“ä¸€ä¸ªèŠ‚ç‚¹å› ä¸ºéšç§å’Œæ•ˆç‡çš„è€ƒè™‘å¸Œæœ›é€‰æ‹©ä¸€ä¸ªä¸åŒçš„ notary é›†ç¾¤ å½“è¿™æ ·çš„ transactions è¢«åˆ›å»ºä¹‹å‰ï¼Œstates å¿…é¡»é¦–å…ˆè¢«æŒ‡å®šåˆ°åŒä¸€ä¸ª notary é›†ç¾¤ã€‚è¿™å¯ä»¥é€šè¿‡ä¸€ä¸ªæ”¹å˜ notary çš„ transaction æ¥å®ç°: ä¸€ä¸ª input state output stateä¸input stateç›¸åŒï¼Œä½†æŒ‡å®šçš„notaryç¾¤é›†å·²æ›´æ”¹ å¦‚æœè¯¥ transaction ä¸ä¼šé€ æˆâ€œåŒèŠ±â€ï¼Œè¿™ä¸ª input state æŒ‡å®šçš„ notary ä¼šä¸ºè¯¥ transaction æä¾›ç­¾åï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ–°çš„ state ä¼šäº§ç”Ÿï¼Œå®ƒçš„æ‰€æœ‰å±æ€§å’Œæ—§çš„ stateç›¸åŒï¼Œä½†æ˜¯ä¼šæŒ‡å‘ä¸€ä¸ªä¸åŒçš„ notary é›†ç¾¤ã€‚ 1.0.9 Vault Vault ä¸­å­˜å‚¨çš„æ˜¯è·ŸèŠ‚ç‚¹çš„æ‰€æœ‰è€…ç›¸å…³çš„ä»è´¦æœ¬ä¸Šå¾—åˆ°çš„æ•°æ®ï¼Œä»¥å…³ç³»æ¨¡å‹å­˜å‚¨ä»¥æ–¹ä¾¿æŸ¥è¯¢å’Œä½¿ç”¨ã€‚ Vault åŒæ—¶ä¼šè¿½è¸ªæœªæ¶ˆè´¹æ‰çš„å’Œå·²æ¶ˆè´¹æ‰çš„ statesï¼š Unconsumedï¼šæœªæ¶ˆè´¹æ‰çš„ ï¼ˆæˆ–è€…æœªä½¿ç”¨çš„ï¼‰ states ä»£è¡¨äº†å¯ä»¥ç”¨æ¥èŠ±è´¹çš„ fungible states ï¼ˆåŒ…æ‹¬ spend-to-self äº¤æ˜“ï¼‰ä»¥åŠå¯ä»¥ç”¨æ¥æ›´æ–°çš„ linear states ï¼ˆæ¯”å¦‚å¯¹äºä¸€ç¬”äº¤æ˜“çš„ç”Ÿå‘½å‘¨æœŸï¼‰æˆ–è€…ä»ä¸€æ–¹è½¬æ¢ç»™å¦ä¸€æ–¹ã€‚ Consumedï¼šå·²æ¶ˆè´¹æ‰çš„ ï¼ˆæˆ–è€…å·²ä½¿ç”¨çš„ï¼‰ states ä»£è¡¨äº†ä¸ºäº†äº¤æ˜“æŠ¥è¡¨ã€å®¡è®¡å’Œå½’æ¡£çš„ç›®çš„è€Œåœ¨è´¦æœ¬ä¸Šå­˜å‚¨çš„ä¸å¯æ›´æ”¹çš„ stateï¼ŒåŒ…æ‹¬è¿›è¡ŒåŒ app-private æ•°æ®è¿›è¡Œå…³è”çš„èƒ½åŠ›ï¼ˆæ¯”å¦‚å®¢æˆ·çš„ notesï¼‰ã€‚ ä¸€ä¸ªç§°ä¸º soft locking çš„åŠŸèƒ½æä¾›äº†è‡ªåŠ¨æˆ–è€…æ˜¾å¼åœ°é¢„å®š states è€Œé¿å…åŒä¸€ä¸ªèŠ‚ç‚¹å°è¯•åŒæ—¶åœ¨å¤šç¬”äº¤æ˜“ä¸­ä½¿ç”¨ç›¸åŒçš„ output çš„èƒ½åŠ›ã€‚è¿™ç§æƒ…å†µæœ€ç»ˆä¼šè¢«ä¸€ä¸ª notary å‘ç°ï¼Œsoft locking æä¾›äº†ä¸€ç§èƒ½å¤Ÿåœ¨æ—©æœŸå°±å‘ç°è¿™ç§æ— æ ¹æ®å’Œä¸æ­£ç¡®çš„æƒ…å†µçš„æœºåˆ¶ã€‚Soft Locking æä¾›äº†æ›´è¯¦ç»†çš„çš„å…³äºè¿™ä¸ªåŠŸèƒ½çš„æè¿°ã€‚ Vault æ”¯æŒç®¡ç†éœ€æˆæƒçš„ï¼ˆâ€œon-ledgerâ€ï¼‰çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥ç®¡ç† shadowï¼ˆâ€œoff-ledgerâ€ï¼‰å½¢å¼çš„æ•°æ®ï¼š â€œOn-ledgerâ€ æ•°æ®æŒ‡çš„æ˜¯æŒ‡å…¬å¸å‚ä¸çš„åˆ†å¸ƒå¼è´¦æœ¬çš„state ï¼ˆç°é‡‘ã€äº¤æ˜“ã€ï¼‰ã€‚ â€œOff-ledgerâ€ æ•°æ®æŒ‡çš„æ˜¯å…¬å¸å†…éƒ¨çš„å‚è€ƒæ•°æ®ã€é™æ€æˆ–è€…ç³»ç»Ÿæ•°æ®ã€‚ ä¸‹è¾¹çš„å›¾è¡¨å±•ç¤ºäº†å°† vault æ‹†åˆ†ä¸ºå­ç³»ç»Ÿç»„ä»¶ï¼š æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š Vault â€œOn Ledgerâ€ å­˜å‚¨å¹¶è¿½è¸ªæœªæ¶ˆè´¹æ‰çš„ stateï¼Œå¹¶ä¸”åœ¨å°†ä¸€ç¬”äº¤æ˜“è®°å½•åˆ°è´¦æœ¬çš„æ—¶å€™ç”±èŠ‚ç‚¹å†…éƒ¨è¿›è¡Œæ›´æ–°ï¼ˆä¼šæŒ‰ç…§æˆåŠŸæ‰§è¡Œäº†æ™ºèƒ½åˆçº¦éªŒè¯ä»¥åŠå—åˆ°æ‰€æœ‰å‚ä¸æ–¹çš„ç­¾åï¼‰ Vault â€œOff Ledgerâ€ å­˜å‚¨äº†äº¤æ˜“è®°å½•ä»¥å¤–èŠ‚ç‚¹çš„æ‰€æœ‰è€…æ·»åŠ çš„é¢å¤–çš„æ•°æ® Vault å¯¹ fungible state è¿›è¡Œäº†èŠ±è´¹ï¼ˆå¹¶ä¸”åœ¨å°†æ¥ï¼Œfungible state çš„ä¼˜åŒ–ç®¡ç†åŒ…æ‹¬åˆå¹¶ã€æ‹†åˆ†ä»¥åŠå†å‘è¡Œï¼‰ã€‚ Vault æ‰©å±•ä»£è¡¨äº†å¼€å‘è€…å¯ä»¥ç¼–å†™çš„é¢å¤–çš„è‡ªå®šä¹‰ plugin ä»£ç ï¼Œç”¨æ¥æŸ¥è¯¢æŒ‡å®šçš„è‡ªå®šä¹‰ contract state å±æ€§ã€‚ å®¢æˆ·çš„ â€œOff Ledgerâ€ï¼ˆç§æœ‰çš„å­˜å‚¨ï¼‰ä»£è¡¨äº†å†…éƒ¨çš„ç»„ç»‡å‹æ•°æ®ï¼Œå¯èƒ½è¢«ç”¨æ¥è·Ÿ vault æ•°æ®è¿›è¡Œå…³è”æ¥è¿›è¡Œé¢å¤–çš„æŠ¥è¡¨æˆ–è€…å¤„ç†ã€‚ Vault Query API å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ Corda RPC å’Œ CorDapp plugin æœºåˆ¶æš´éœ²ç»™å¼€å‘è€…ã€‚ Vault æ›´æ–° API å¯ä»¥è¢«äº¤æ˜“è®°å½•çš„ flows å†…éƒ¨ä½¿ç”¨ã€‚ Vault æ•°æ®åº“ schemas å¯ä»¥é€šè¿‡ JDBC å’Œè‡ªå®šä¹‰çš„ joins å’ŒæŸ¥è¯¢è¿›è¡Œç›´æ¥åœ°è®¿é—®ã€‚ 1.0.10 Time-windows å¦‚æœä¸€ä¸ª transaction åŒ…å«äº†ä¸€ä¸ª time-windowï¼Œé‚£ä¹ˆè¿™ä¸ª transaction åªèƒ½åœ¨è¿™ä¸ª time-window é‡Œè¢«æäº¤ Notary å…·æœ‰æ§åˆ¶å‘ç”Ÿçš„æ—¶é—´çš„æƒåˆ©ï¼Œå½“åœ¨ time-window ä¹‹å¤–çš„æ—¶å€™ï¼Œnotary å¯ä»¥æ‹’ç»æäº¤ transaction Time-window å¯ä»¥æœ‰å¼€å§‹å’Œç»“æŸæ—¶é—´ï¼Œæˆ–è€…åªæœ‰ä¸¤è€…ä¹‹ä¸­çš„ä¸€ä¸ª 1.0.10.1 åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ—¶é—´ Notary ä¹Ÿå¯ä»¥ä½œä¸º æ—¶é—´æˆ³çš„éªŒè¯è€…ï¼Œåœ¨å®ƒç¡®è®¤ä¸€ç¬”äº¤æ˜“å‰ï¼Œéœ€è¦ç¡®ä¿è¿™ç¬”äº¤æ˜“æ˜¯å‘ç”Ÿåœ¨æŒ‡å®šçš„æ—¶é—´çª—é‡Œã€‚ ä¸ºäº†è®©ä¸€ä¸ªæ—¶é—´çª—æœ‰æ„ä¹‰ï¼Œå®ƒå¿…é¡»è¦åœ¨ä¸€æ–¹è¯·æ±‚å®ƒçš„æ—¶å€™è¢«ç»‘å®šã€‚ä¸€æ–¹å¯ä»¥è·å¾—ä¸€ä¸ª time-window çš„ç­¾åï¼Œä»¥æ­¤æ¥è¯æ˜æœ‰äº›äº‹ä»¶æ˜¯åœ¨ç‰¹å®šæ—¶é—´ç‚¹ ä¹‹å‰ã€å½“æ—¶ æˆ–è€… ä¹‹å å‘ç”Ÿçš„ã€‚ç„¶è€Œï¼Œå¦‚æœäº¤æ˜“å‚ä¸è€…ä¸èƒ½å¤Ÿåœ¨æŒ‡å®šçš„ time-window å†…æäº¤åˆ°ç›¸å…³çš„äº¤æ˜“ï¼Œå®ƒå¯ä»¥é€‰æ‹©æ˜¯å¦åœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´ç‚¹å°†è¿™ä¸ªäº‹å®æš´éœ²å‡ºå»ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿ notary æˆ–è€…èƒ½å¤Ÿåœ¨ä¸€äº›å¯å®¹é”™çš„æ—¶é—´èŒƒå›´å†…å¯¹äº¤æ˜“è¿›è¡Œç­¾åï¼Œæˆ–è€…åŒæ—¶è¿›è¡Œæ‰“æ—¶é—´æˆ³ å’Œ å¯¹äº¤æ˜“è¿›è¡Œå…¬è¯ã€‚åè¾¹çš„è¿™ç§æ–¹å¼æ˜¯è¿™ä¸ªæ¨¡å‹ä¸­ä½¿ç”¨çš„æ–¹å¼ã€‚ åœ¨åˆ›å»ºäº¤æ˜“çš„ä¸€æ–¹å’Œ notary ä¹‹é—´æ˜¯æ— æ³•å®ç°æ—¶é—´çš„åŒæ­¥çš„ã€‚è¿™å¹¶ä¸ä»…ä»…æ˜¯å› ä¸ºç‰©ç†æˆ–è€…ç½‘ç»œçš„å»¶è¿Ÿï¼Œè¿˜ä¼šå› ä¸ºåœ¨æ’å…¥å‘½ä»¤å’Œè·å¾— notary ç­¾åä¹‹é—´å¯èƒ½ä¼šå‘ç”Ÿå¾ˆå¤šå…¶ä»–çš„æ­¥éª¤ï¼ˆæ¯”å¦‚å‘é€äº¤æ˜“åˆ°æ¶‰åŠåˆ°çš„å…¶ä»–èŠ‚ç‚¹ï¼Œè¯·æ±‚äººå·¥çš„å®¡æ‰¹ç­‰ï¼‰ã€‚æ‰€ä»¥äº¤æ˜“è¢«å‘é€åˆ° notary çš„æ—¶é—´å’Œäº¤æ˜“åˆ›å»ºçš„æ—¶é—´å¯èƒ½ä¼šä¸åŒã€‚ 1.0.10.2 Time-windows å› ä¸ºä¸Šé¢çš„åŸå› ï¼Œäº¤æ˜“ä¸­æ¶‰åŠåˆ°çš„æ—¶é—´ä¼šè¢«åˆ¶å®šä¸ºä¸€ä¸ªæ—¶é—´çª—ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç»å¯¹çš„æ—¶é—´ã€‚åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ˜¯æ°¸è¿œä¸ä¼šæœ‰ â€œçœŸå®çš„æ—¶é—´â€ çš„ï¼Œåªæœ‰ä¸€ä¸ªå¤§æ¦‚çš„æ—¶é—´ã€‚æ—¶é—´çª—å¯ä»¥æ˜¯å¼€æ”¾çš„ï¼ˆæ¯”å¦‚åœ¨æŸä¸ªæ—¶é—´ç‚¹åï¼Œæˆ–è€…æŸä¸ªæ—¶é—´ç‚¹ä¹‹å‰ï¼‰æˆ–è€…æ˜¯ä¸€ä¸ªé—­åˆçš„èŒƒå›´ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬è¡¨è¾¾äº†æˆ‘ä»¬çš„æƒ³æ³•ï¼Œå°±æ˜¯ â€œå½“å‰çš„æ—¶é—´â€ æ°¸è¿œéƒ½æ˜¯æœªçŸ¥çš„ã€‚ç”šè‡³å½“åœ¨æŸä¸ªæ—¶é—´ä¹‹å‰å’Œä¹‹åéƒ½è¢«åŒ…å«çš„æ—¶å€™ï¼Œäº¤æ˜“ä¹Ÿå¯èƒ½ä¼šåœ¨é‚£ä¸ªæ—¶é—´çª—ä¸­çš„ä»»ä½•æ—¶é—´å‘ç”Ÿã€‚ é€šè¿‡åœ¨ä¸€ç«¯åˆ›å»ºä¸€ä¸ªå…³é—­æˆ–è€…å¼€æ”¾çš„èŒƒå›´ï¼Œæˆ‘ä»¬å…è®¸ç”¨ä»¥ä¸‹çš„æ–¹å¼ç”Ÿæˆæ—¶é—´çª—æ¨¡å‹ï¼š ä¸€ç¬”äº¤æ˜“åœ¨æŒ‡å®šæ—¶é—´ä¹‹åçš„æŸä¸ªæ—¶é—´å‘ç”Ÿï¼ˆæ¯”å¦‚åœ¨ä¸€ä¸ªç»ˆæ­¢äº‹ä»¶ä¹‹åï¼‰ ä¸€ç¬”äº¤æ˜“åœ¨æŒ‡å®šæ—¶é—´ä¹‹å‰çš„ä»»ä½•æ—¶é—´å‘ç”Ÿï¼ˆæ¯”å¦‚ç ´äº§äº‹ä»¶ä¹‹å‰ï¼‰ ä¸€ç¬”äº¤æ˜“åœ¨æŒ‡å®šæ—¶é—´åŒºé—´çš„æŸä¸ªæ—¶é—´å‘ç”Ÿï¼ˆæ¯”å¦‚åœ¨æŒ‡å®šçš„æŸä¸€å¤©ï¼‰ 1.0.11 Oracles ä¸€ä¸ªäº‹å®ï¼ˆfactï¼‰å¯ä»¥ä½œä¸º command çš„ä¸€éƒ¨åˆ†è¢«æ·»åŠ åˆ°ä¸€ä¸ª transaction ä¸­ ä¸€ä¸ª oracle æ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œå®ƒåªä¼šä¸ºé‚£äº›åŒ…å«æ­£ç¡®äº‹å®çš„ transaction æä¾›ç­¾å å¾ˆå¤šæ—¶å€™ transaction çš„åˆçº¦æœ‰æ•ˆæ€§éœ€è¦ä¾èµ–ä¸€äº›å¤–éƒ¨çš„æ•°æ®ï¼Œæ¯”å¦‚å½“å‰çš„æ±‡ç‡æ˜¯å¤šå°‘ã€‚å¦‚æœè®©æ¯ä¸ªå‚ä¸æ–¹ç»™äºˆä»–ä»¬å¯¹äºæ±‡ç‡çš„è§‚ç‚¹æ¥éªŒè¯ transaction çš„æœ‰æ•ˆæ€§çš„è¯ï¼Œåˆçº¦çš„æ‰§è¡Œå°±ä¼šå˜å¾—æ²¡æœ‰ç¡®å®šæ€§äº†ï¼šä¸€äº›å‚ä¸è€…å¯èƒ½ä¼šè®¤ä¸º transaction æ˜¯æœ‰æ•ˆçš„ï¼Œè€Œå…¶ä»–çš„å‚ä¸è€…å¯èƒ½è®¤ä¸ºæ— æ•ˆã€‚å› æ­¤ï¼Œåœ¨çœŸæ­£è´¦æœ¬ä¸­çš„ state ä¹‹ä¸Šå°±ä¼šæå‡ºä¸€äº›ä¸åŒçš„æ„è§ã€‚ Corda é€šè¿‡ä½¿ç”¨ Oracle æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚Oracle æ˜¯ä¸€ä¸ªç½‘ç»œæœåŠ¡ï¼Œå¯ä»¥æ ¹æ®è¦æ±‚æä¾›åŒ…å«æŸä¸€äº‹å®çš„å‘½ä»¤ï¼ˆæ¯”å¦‚åœ¨æŸä¸ªæ—¶é—´çš„æ±‡ç‡ï¼‰å¹¶ä¸”å°† Oracle åˆ—ä¸ºè¦æ±‚ç­¾åçš„ä¸€æ–¹ã€‚ å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å¸Œæœ›åœ¨ä¸€ä¸ª transaction ä¸­ä½¿ç”¨æŸä¸€ä¸ªäº‹å®ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥æå‡ºä» Oracle æ¥è·å–è¯¥äº‹å®çš„ä¸€ä¸ªå‘½ä»¤ã€‚å¦‚æœ Orale è®¤ä¸ºè¿™ä¸ªäº‹å®æ˜¯æ­£ç¡®çš„ï¼Œå®ƒä¼šè¿”å›è¿™ä¸ªè¦æ±‚çš„å‘½ä»¤ã€‚ç„¶åè¿™ä¸ªèŠ‚ç‚¹å°±å¯ä»¥æŠŠè¿™ä¸ªå‘½ä»¤æ·»åŠ åˆ° transaction ä¸­äº†ï¼Œç„¶å oracle ä¼šä¸ºè¿™ä¸ªäº‹å®æ˜¯çœŸçš„æä¾›ç­¾åã€‚ ä¸ºäº†éšç§æ€§çš„ç›®çš„ï¼ŒOracle ä¸éœ€è¦èƒ½å¤Ÿè®¿é—®äº¤æ˜“çš„æ¯ä¸ªéƒ¨åˆ†ï¼Œä»–ä»¬å”¯ä¸€éœ€è¦çš„ä¿¡æ¯å°±æ˜¯çœ‹åˆ°ä»–ä»¬å†…ç½®çš„ã€è·Ÿè¿™ä¸ª Oracle ç›¸å…³çš„ command(s)ã€‚æˆ‘ä»¬ä¹Ÿåº”è¯¥æä¾›è®©è¿™äº›éœ€è¦æä¾›ç­¾åçš„ Oracle å®ä½“èƒ½å¤Ÿçœ‹åˆ°è¿™äº› commands çš„ä¿è¯ï¼Œä½†æ˜¯ä¸åŒ…æ‹¬å…¶ä»–çš„éƒ¨åˆ†ã€‚ä¸ºäº†å®ç°è¿™ä¸ªï¼Œæˆ‘ä»¬ä½¿ç”¨è¿‡æ»¤è¿‡çš„äº¤æ˜“ï¼Œæ˜¯æŒ‡äº¤æ˜“çš„ææ¡ˆæ–¹ä½¿ç”¨ä¸€ä¸ªå†…åµŒçš„é»˜å…‹å°”æ ‘çš„æ–¹å¼æ¥å°†ä¸€äº›éç›¸å…³çš„äº¤æ˜“çš„éƒ¨åˆ†éšè—æ‰ã€‚æŸ¥çœ‹ Transaction tear-offs äº†è§£å…³äºäº¤æ˜“å¦‚ä½•æ‹¿æ‰å·¥ä½œçš„è¯¦ç»†ä¿¡æ¯ã€‚ å¦‚æœä»–ä»¬æƒ³ä¸ºä»–ä»¬çš„æœåŠ¡å®šä»·ï¼ŒOracles å¯ä»¥é€‰æ‹©åªä¸ºé‚£äº›åŒ…å«æœåŠ¡è´¹çš„äº¤æ˜“æä¾›ç­¾åå¹¶è¯æ˜å®ƒåŒ…å«çš„äº‹å®çš„æœ‰æ•ˆæ€§ã€‚ 1.0.12 nodeï¼ˆèŠ‚ç‚¹ï¼‰ Corda ä¸­çš„èŠ‚ç‚¹æŒ‡çš„æ˜¯åœ¨ç½‘ç»œä¸­å…·æœ‰å”¯ä¸€æ ‡è¯†çš„è¿è¡Œç€ Corda æœåŠ¡å’Œ CorDapps çš„ JVM è¿è¡Œæ—¶ç¯å¢ƒã€‚ èŠ‚ç‚¹å¯¹äºå¤–éƒ¨ä¸–ç•ŒåŒ…å«ä¸¤ä¸ªæ¥å£ï¼š ç½‘ç»œå±‚ï¼Œç”¨æ¥åŒå…¶ä»–çš„èŠ‚ç‚¹é€šä¿¡ RPCï¼Œä¸ºäº†è·ŸèŠ‚ç‚¹çš„æ‰€æœ‰è€…é€šä¿¡ èŠ‚ç‚¹çš„åŠŸèƒ½æ˜¯é€šè¿‡åœ¨ plugin registry é‡Œå®‰è£… CorDapps æ–¹å¼æ¥æ‰©å±•çš„ 1.0.12.1 èŠ‚ç‚¹æ¶æ„ ä¸‹è¾¹æ˜¯èŠ‚ç‚¹çš„å†…éƒ¨æ¶æ„å›¾ï¼š æ¶æ„ä¸­çš„æ ¸å¿ƒå…ƒç´ åŒ…æ‹¬ï¼š å­˜å‚¨æ•°æ®çš„æŒä¹…åŒ–å±‚ åŒå…¶ä»–èŠ‚ç‚¹æ²Ÿé€šçš„ç½‘ç»œæ¥å£ åŒèŠ‚ç‚¹çš„æ‰€æœ‰è€…è¿›è¡Œæ²Ÿé€šçš„ RPC æ¥å£ å…è®¸èŠ‚ç‚¹çš„ flows æ¥è°ƒç”¨èŠ‚ç‚¹å…¶ä»–æœåŠ¡çš„ service hub plugin registry ç”¨æ¥é€šè¿‡å®‰è£… CorDapps æ¥æ‰©å±•èŠ‚ç‚¹ 1.0.12.2 æŒä¹…å±‚ æŒä¹…å±‚åŒ…å«ä¸¤éƒ¨åˆ†ï¼š Vaultï¼ŒèŠ‚ç‚¹ç”¨æ¥å­˜å‚¨ç›¸å…³çš„å½“å‰å’Œå†å²çš„ states æ•°æ® å­˜å‚¨æœåŠ¡ï¼Œç”¨æ¥å­˜å‚¨ transaction, attachment å’Œ flow checkpoints èŠ‚ç‚¹çš„æ‰€æœ‰è€…å¯ä»¥é€šè¿‡ä½¿ç”¨ RPC æ¥å£æ¥æŸ¥è¯¢èŠ‚ç‚¹çš„ storageã€‚ 1.0.12.3 ç½‘ç»œæ¥å£ åŒç½‘ç»œä¸­çš„å…¶ä»–èŠ‚ç‚¹è¿›è¡Œæ²Ÿé€šæ˜¯èŠ‚ç‚¹è‡ªå·±æ¥å¤„ç†çš„ï¼Œä½œä¸ºè¿è¡Œä¸€ä¸ª flow çš„ä¸€éƒ¨åˆ†ã€‚èŠ‚ç‚¹çš„æ‰€æœ‰è€…ä¸ä¼šç›´æ¥åœ°åŒç½‘ç»œä¸­å…¶ä»–çš„èŠ‚ç‚¹è¿›è¡Œäº¤äº’ã€‚ 1.0.12.4 RPC æ¥å£ èŠ‚ç‚¹çš„æ‰€æœ‰è€…æ˜¯é€šè¿‡ä½¿ç”¨ Remote Procedure Calls(RPC) æ¥è·ŸèŠ‚ç‚¹è¿›è¡Œäº¤äº’çš„ã€‚å…³é”®çš„èŠ‚ç‚¹æš´éœ²çš„ RPC æ“ä½œå¯ä»¥æŸ¥çœ‹ API: RPC æ“ä½œã€‚ 1.0.12.4 The service hub åœ¨èŠ‚ç‚¹å†…éƒ¨ï¼ŒèŠ‚ç‚¹å¯ä»¥åœ¨ flow çš„æ‰§è¡Œè¿‡ç¨‹ä¸­è®¿é—®ä¸°å¯Œçš„æœåŠ¡æ¥ååŠ©æ›´æ–°è´¦æœ¬ã€‚ä¸»è¦çš„æœåŠ¡åŒ…æ‹¬ï¼š æœ‰å…³ç½‘ç»œä¸Šå…¶ä»–èŠ‚ç‚¹åŠå…¶æä¾›çš„æœåŠ¡çš„ä¿¡æ¯ è®¿é—® vault å’Œå­˜å‚¨æœåŠ¡çš„å†…å®¹ è®¿é—®å’Œç”ŸæˆèŠ‚ç‚¹çš„å…¬é’¥ç§é’¥å¯¹ èŠ‚ç‚¹æœ¬èº«çš„ä¿¡æ¯ èŠ‚ç‚¹è·Ÿè¸ªçš„å½“å‰æ—¶é—´ 1.0.12.5 CorDapp æä¾›è€… CorDapp æä¾›è€…æ˜¯æ–°çš„ CorDapps è¢«å®‰è£…çš„åœ°æ–¹ï¼Œæ¥æ‰©å±•èŠ‚ç‚¹çš„è¡Œä¸ºã€‚ èŠ‚ç‚¹é»˜è®¤ä¼šå®‰è£…ä¸€äº› CorDapps æ¥å¤„ç†ä¸€äº›å¸¸è§çš„ä»»åŠ¡ï¼Œæ¯”å¦‚ï¼š ä»åˆä½œæ–¹é‚£è¾¹è·å¾—äº¤æ˜“å’Œé™„ä»¶ä¿¡æ¯ æ›´æ–°åˆçº¦ å‘äº¤æ˜“å…¶ä»–æ–¹å¹¿æ’­åŒæ„çš„è´¦æœ¬æ›´æ–°ä¿¡æ¯ 1.0.12.6 æ’ç©ºèŠ‚ç‚¹æ¨¡å¼ ä¸ºäº†æ‰§è¡Œä¸€æ¬¡å¹²å‡€çš„å…³é—­èŠ‚ç‚¹æ“ä½œï¼Œæ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„ flows éå¸¸é‡è¦ï¼Œä¹Ÿå°±æ˜¯è¯´åº”è¯¥æ²¡æœ‰ä»»ä½•çš„ checkpoints è¢«æŒä¹…åŒ–ã€‚èŠ‚ç‚¹èƒ½å¤Ÿè¢«è®¾ç½®ä¸ºæ’ç©ºçŠ¶æ€ï¼Œåœ¨è¿™ä¸ªçŠ¶æ€ä¸­ï¼š é€šè¿‡ RPC è¦æ±‚çš„å¯åŠ¨æ–°çš„ flows çš„å‘½ä»¤ä¼šè¢«æ‹’ç» é¢„çº¦çš„ flows ä¼šè¢«å¿½ç•¥ åˆå§‹åŒ– P2P çš„ä¼šè¯æ¶ˆæ¯å°†ä¸ä¼šè¢«å¤„ç†ï¼Œæ„å‘³ç€ peers å°†ä¸èƒ½å¤Ÿåˆå§‹åŒ–æ–°çš„ flows å…¶ä»–æ‰€æœ‰çš„æ´»åŠ¨è¿˜ä¼šç…§å¸¸è¿›è¡Œï¼Œæ¥ç¡®ä¿æ­£åœ¨æ‰§è¡Œçš„ flows çš„æ•°é‡åœ¨ä¸æ–­å‡å°‘ã€‚ å¯¹äºä»–ä»¬çš„æ•°é‡ - å¯ä»¥é€šè¿‡ RPC æ¥è¿›è¡Œç›‘æ§ - è¾¾åˆ°0ï¼Œé‚£ä¹ˆå°±æ˜¯å®‰å…¨çš„äº†ï¼Œå¯ä»¥è¿›è¡Œå…³é—­èŠ‚ç‚¹çš„æ“ä½œäº†ã€‚è¿™ä¸ªå±æ€§æ˜¯æŒä¹…çš„ï¼Œä¹Ÿå°±æ˜¯è¯´é‡æ–°å¯åŠ¨è¿™ä¸ªèŠ‚ç‚¹ä¹Ÿä¸ä¼šé‡ç½®è¿™ä¸ªå€¼åˆ°é»˜è®¤å’Œå€¼ï¼Œå¹¶ä¸”éœ€è¦ä¸€ä¸ª RPC å‘½ä»¤ã€‚ èŠ‚ç‚¹å¯ä»¥ä½¿ç”¨ shell æ¥è¢«æ’ç©ºç„¶åå®‰å…¨åœ°å…³é—­ã€‚ 1.0.13 Transaction tear-offsï¼ˆäº¤æ˜“å‰¥ç¦»ï¼‰ éšè—äº¤æ˜“ç»„ä»¶å‡ºäºéšç§ç›®çš„ Oracleå’ŒééªŒè¯å…¬è¯äººåªèƒ½çœ‹åˆ°å…¶â€œç›¸å…³â€äº¤æ˜“ç»„ä»¶ï¼Œè€Œä¸èƒ½çœ‹åˆ°å®Œæ•´çš„äº¤æ˜“è¯¦ç»†ä¿¡æ¯ 1.0.13.1 æ€»è§ˆ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œäº¤æ˜“ä¸­æ¶‰åŠçš„æŸäº›å®ä½“å¯èƒ½åªå¯¹äº¤æ˜“éƒ¨åˆ†å…·æœ‰éƒ¨åˆ†å¯è§æ€§ã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªç”²éª¨æ–‡åº”è¯¥ç­¾ç½²ä¸€ä¸ªäº¤æ˜“æ—¶ï¼Œå®ƒå”¯ä¸€éœ€è¦æŸ¥çœ‹çš„ä¿¡æ¯å°±æ˜¯ä¸è¯¥ç”²éª¨æ–‡å‘½ä»¤ç›¸å…³çš„åµŒå…¥å¼ä¿¡æ¯ã€‚åŒæ ·ï¼ŒééªŒè¯å…¬è¯äººåªéœ€è¦æŸ¥çœ‹äº¤æ˜“çš„è¾“å…¥çŠ¶æ€å³å¯ã€‚å‘Oracleæä¾›ä»»ä½•å…¶ä»–äº¤æ˜“æ•°æ®å°†æ„æˆéšç§æ³„æ¼ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿‡æ»¤äº¤æ˜“çš„æ¦‚å¿µï¼Œå…¶ä¸­äº¤æ˜“æè®®è€…ä½¿ç”¨åµŒå¥—çš„é»˜å…‹å°”æ ‘æ–¹æ³•â€œå‰¥ç¦»â€Oracles/Notrariesä¸éœ€è¦çš„äº¤æ˜“ä»»ä½•éƒ¨åˆ†ï¼Œç„¶åå†æäº¤ç»™ä»–ä»¬è¿›è¡Œç­¾åã€‚é»˜å…‹å°”æ ‘æ˜¯ä¸€ç§ä¼—æ‰€å‘¨çŸ¥çš„åŠ å¯†æ–¹æ¡ˆï¼Œé€šå¸¸ç”¨äºæä¾›åŒ…å«å’Œæ•°æ®å®Œæ•´æ€§çš„è¯æ˜ã€‚ Merkleæ ‘è¢«å¹¿æ³›ç”¨äºå¯¹ç­‰ç½‘ç»œï¼ŒåŒºå—é“¾ç³»ç»Ÿå’Œgitã€‚ é»˜å…‹å°”æ ‘çš„ä¼˜ç‚¹æ˜¯ï¼Œåœ¨å‘Oracleæäº¤äº¤æ˜“æ—¶è¢«å‰¥ç¦»çš„äº¤æ˜“éƒ¨åˆ†ä»¥åå°±æ— æ³•æ›´æ”¹ï¼Œè€Œåˆä¸ä¼šä½¿Oracleçš„æ•°å­—ç­¾åæ— æ•ˆã€‚ 1.0.13.2 Transaction Merkle trees é€šè¿‡å°†transactionæ‹†åˆ†ä¸ºå¶å­ï¼Œä»transactionä¸­æ„é€ Merkleæ ‘ï¼Œå…¶ä¸­æ¯ä¸ªå¶å­åŒ…å«è¾“å…¥ï¼Œè¾“å‡ºï¼Œå‘½ä»¤æˆ–é™„ä»¶ã€‚æœ€ç»ˆçš„åµŒå¥—æ ‘ç»“æ„è¿˜åŒ…å«äº‹åŠ¡çš„å…¶ä»–å­—æ®µï¼Œä¾‹å¦‚æ—¶é—´çª—å£ï¼Œå…¬è¯äººå’Œå¿…éœ€çš„ç­¾åè€…ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå”¯ä¸€éœ€è¦ä¸¤æ£µæ ‘è€Œä¸æ˜¯ä¸€æ£µæ ‘çš„ç»„ä»¶ç±»å‹æ˜¯commandï¼Œä¸ºäº†å¯è§†æ€§ç›®çš„ï¼Œè¯¥å‘½ä»¤åˆ†ä¸ºå‘½ä»¤æ•°æ®å’Œå¿…éœ€çš„ç­¾åè€…ã€‚ Cordaä½¿ç”¨æ¯ç§ç»„ä»¶ç±»å‹çš„åµŒå¥—Merkleæ ‘ã€‚ç®€è€Œè¨€ä¹‹ï¼Œé’ˆå¯¹æ¯ç§ç»„ä»¶ç±»å‹ï¼ˆå³è¾“å…¥ï¼Œè¾“å‡ºï¼Œé™„ä»¶ï¼‰ç”Ÿæˆä¸€ä¸ªç»„ä»¶å­æ ‘ã€‚ç„¶åï¼Œè¿™äº›å­æ ‘çš„æ ¹å½¢æˆé¡¶éƒ¨çš„Merkleæ ‘çš„å¶å­ï¼Œæœ€åï¼Œè¯¥æ ‘çš„æ ¹ä»£è¡¨äº¤æ˜“IDã€‚ å¦ä¸€ä¸ªé‡è¦ç‰¹å¾æ˜¯ï¼Œä»¥æ¯ä¸ªéšæœºæ•°ç‹¬ç«‹çš„æ–¹å¼ä¸ºæ¯ä¸ªç»„ä»¶ç¡®å®šæ€§åœ°ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨éšæœºæ•°åŠå…¶å¯¹åº”çš„ç»„ä»¶æ¥è®¡ç®—ç»„ä»¶å“ˆå¸Œï¼Œå³å®é™…çš„Merkleæ ‘å¶ã€‚éœ€è¦ä½¿ç”¨éšæœºæ•°æ¥é˜²æ­¢æš´åŠ›æ”»å‡»ï¼Œå¦åˆ™å¯èƒ½ä¼šæ³„éœ²ä½ç†µæ•£åˆ—å€¼ï¼ˆå³å•ä¸ªå•è¯çš„æ–‡æœ¬é™„ä»¶ï¼‰çš„å†…å®¹ã€‚ è®¡ç®—å®Œå¶å­åï¼Œé€šè¿‡æ•£åˆ—å½“å‰èŠ‚ç‚¹ä¸‹é¢çš„å“ˆå¸Œå€¼çš„è¿æ¥ï¼Œä»¥æ­£å¸¸æ–¹å¼æ„å»ºæ¯æ£µMerkleæ ‘ã€‚ ä¸Šå›¾ä¸­çš„äº¤æ˜“æœ‰ä¸‰ä¸ªinputï¼Œä¸¤ä¸ªoutputï¼Œä¸¤ä¸ªcommandï¼Œä¸€ä¸ªattachmentï¼Œä¸€ä¸ªnotaryå’Œä¸€ä¸ª time-windowã€‚è¯·æ³¨æ„ï¼Œå¦‚æœæ ‘ä¸æ˜¯å®Œæ•´çš„äºŒå‰æ ‘ï¼Œåˆ™å°†å¶å­å¡«å……ä¸ºå…·æœ‰é›¶å“ˆå¸Œå€¼çš„æœ€æ¥è¿‘çš„2çš„å¹‚ï¼ˆå› ä¸ºæ‰¾åˆ°sha256ï¼ˆxï¼‰== 0çš„åŸåƒæ˜¯å›°éš¾çš„è®¡ç®—ä»»åŠ¡ï¼‰-ä¸Šé¢æ ‡è®°ä¸ºæµ…ç»¿è‰²ã€‚æœ€åï¼Œæ ¹çš„å“ˆå¸Œæ˜¯äº¤æ˜“çš„æ ‡è¯†ç¬¦ï¼Œå®ƒä¹Ÿç”¨äºç­¾åå’ŒéªŒè¯æ•°æ®å®Œæ•´æ€§ã€‚å¶å­çº§åˆ«ä¸Šçš„æ¯æ¬¡äº¤æ˜“æ›´æ”¹éƒ½ä¼šæ›´æ”¹å…¶æ ‡è¯†ç¬¦ã€‚ 1.0.13.3 Hiding data éšè—æ•°æ®å¹¶æä¾›è¯æ˜å®ƒæ„æˆäº‹åŠ¡ä¸€éƒ¨åˆ†çš„è¯æ®æ˜¯é€šè¿‡æ„é€ éƒ¨åˆ†Merkleæ ‘ï¼ˆæˆ–Merkleåˆ†æ”¯ï¼‰æ¥å®Œæˆçš„ã€‚ Merkleåˆ†æ”¯æ˜¯ä¸€ç»„æ•£åˆ—ï¼Œæ ¹æ®å¶çš„æ•°æ®ï¼Œè¿™äº›æ•£åˆ—ç”¨äºè®¡ç®—æ ¹çš„æ•£åˆ—ã€‚ç„¶åï¼Œå°†è¯¥å“ˆå¸Œä¸æ•´ä¸ªäº¤æ˜“çš„å“ˆå¸Œè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå®ƒä»¬åŒ¹é…ï¼Œåˆ™æ„å‘³ç€æˆ‘ä»¬è·å¾—çš„æ•°æ®å±äºè¯¥ç‰¹å®šäº¤æ˜“ã€‚ å‡è®¾åªæœ‰ç¬¬ä¸€ä¸ªå‘½ä»¤å¯¹Oracleæ˜¯å¯è§çš„ã€‚æˆ‘ä»¬è¿˜åº”è¯¥ä¿è¯æ‰€æœ‰éœ€è¦è¯¥Oracleç­¾åçš„å‘½ä»¤å¯¹äºOracleå®ä½“éƒ½åº”è¯¥æ˜¯å¯è§çš„ï¼Œè€Œå…¶ä½™éƒ¨åˆ†åˆ™ä¸å¯è§ã€‚è¿™æ˜¯æ­¤è¿‡æ»¤åçš„äº¤æ˜“å°†å¦‚ä½•åœ¨Merkleæ ‘ç»“æ„ä¸­è¡¨ç¤ºçš„æ–¹å¼ã€‚ å‘OracleæœåŠ¡æä¾›äº†è“è‰²èŠ‚ç‚¹å’ŒH(c2)ï¼Œè€Œçœç•¥äº†é»‘è‰²èŠ‚ç‚¹ã€‚ HH(c2)æ˜¯å¿…éœ€çš„ï¼Œè¿™æ ·Oracleå¯ä»¥è®¡ç®—H(commandData)è€Œä¸å¿…çœ‹åˆ°ç¬¬äºŒæ¡å‘½ä»¤ï¼Œä½†åŒæ—¶ç¡®ä¿CommandData1æ˜¯äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ã€‚çªå‡ºæ˜¾ç¤ºæ‰€æœ‰ç­¾åè€…éƒ½æ˜¯å¯è§çš„ï¼Œä»¥è¯æ˜æ²¡æœ‰æ¶æ„åˆ é™¤ä»»ä½•ç›¸å…³å‘½ä»¤ï¼ˆOracleåº”è¯¥çœ‹åˆ°ï¼‰ã€‚æ­¤å¤–ï¼Œå½“å‰çš„Cordaåè®®ä¸­è¿˜æä¾›äº†å­æ ‘çš„å“ˆå¸Œï¼ˆç´«è‰²èŠ‚ç‚¹ï¼‰ã€‚åœ¨ç‰¹æ®Šæƒ…å†µä¸‹éœ€è¦çŸ¥é“ä»–ä»¬ä¸‹é¢çš„æ•°æ®ï¼Œä¾‹å¦‚éœ€è¦çŸ¥é“ç»„ä»¶ç»„æ˜¯å¦ä¸ºç©ºæ—¶ã€‚ åŒæ ·ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å°†åŒä¸€äº¤æ˜“å‘é€ç»™ééªŒè¯notaryï¼Œåˆ™åº”éšè—é™¤è¾“å…¥çŠ¶æ€ï¼Œæ—¶é—´çª—å£å’Œå…¬è¯äººä¿¡æ¯ä¹‹å¤–çš„æ‰€æœ‰ç»„ä»¶ã€‚è¯¥æ•°æ®è¶³ä»¥ä½¿å…¬è¯äººçŸ¥é“åº”æ£€æŸ¥å“ªäº›input statuesè¿›è¡ŒåŒèŠ±ï¼Œæ—¶é—´çª—å£æ˜¯å¦æœ‰æ•ˆä»¥åŠæ­¤äº‹åŠ¡æ˜¯å¦åº”ç”±è¯¥notaryå…¬è¯ã€‚ 1.0.14 æƒè¡¡ è®¸å¯çš„ç½‘ç»œä¼šæ›´å¥½çš„é€‚åˆé‡‘èçš„ user-cases ç‚¹å¯¹ç‚¹çš„é€šä¿¡å…è®¸ä¿¡æ¯æ˜¯åŸºäºéœ€è¦çŸ¥é“çš„åŸåˆ™è¢«å…±äº« UTXO model å…è®¸æ¯ç§’é’Ÿèƒ½å¤Ÿå¤„ç†æ›´å¤šçš„ transactions 1.0.14.1 éœ€è¦è®¸å¯ vs å’Œä¸éœ€è¦è®¸å¯çš„ ä¼ ç»Ÿçš„ blockchain æ˜¯ ä¸éœ€è¦è®¸å¯ çš„ã€‚ç½‘ç»œä¸­çš„å„æ–¹éƒ½æ˜¯åŒ¿åçš„ï¼Œè€Œä¸”å¯ä»¥éšæ—¶åŠ å…¥æˆ–ç¦»å¼€ã€‚ ä¸åŒçš„æ˜¯ï¼Œ Corda ç½‘ç»œæ˜¯ éœ€è¦è®¸å¯ çš„ã€‚ç½‘ç»œä¸­çš„æ¯ä¸€æ–¹éƒ½æœ‰ä¸€ä¸ªå¤§å®¶éƒ½çŸ¥é“çš„æ ‡è¯†ï¼Œè¿™ä¸ªä¼šåœ¨åŒå…¶ä»–èŠ‚ç‚¹è¿›è¡Œæ²Ÿé€šçš„æ—¶å€™ä½¿ç”¨ï¼Œå¹¶ä¸”è®¿é—®ç½‘ç»œæ˜¯ç”±ä¸€ä¸ª doorman æ¥æ§åˆ¶çš„ã€‚è¿™æœ‰ä¸€ä¸‹çš„å¥½å¤„ï¼š åŒ¿åçš„ç”¨æˆ·å¯¹äºå¤§å¤šæ•°è·Ÿé‡‘èæœ‰å…³çš„æƒ…å†µéƒ½æ˜¯ä¸é€‚ç”¨çš„ çŸ¥é“ä½ çš„åˆä½œæ–¹çš„èº«ä»½å¯ä»¥å…è®¸å½“å‡ºç°å†²çªçš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨å·²ç»å­˜åœ¨çš„æ³•å¾‹ç³»ç»Ÿåœ¨è´¦æœ¬å¤–è¿›è¡Œè§£å†³ å¯ä»¥ä¸é€šè¿‡ä½¿ç”¨æ˜‚è´µçš„æœºåˆ¶ï¼ˆæ¯”å¦‚å·¥ä½œé‡è¯æ˜ proof-of-workï¼‰æ¥é¿å…å¥³å·«æ”»å‡»ï¼ˆSybil attacksï¼‰ 1.0.14.2 ç‚¹å¯¹ç‚¹ vs å…¨å±€å¹¿æ’­ ä¼ ç»Ÿçš„ blockchain networks å°†æ¯ä¸€æ¡ä¿¡æ¯å¹¿æ’­ç»™ç½‘ç»œä¸Šçš„æ‰€æœ‰å‚ä¸è€…ã€‚åŸå› æ˜¯ï¼š åˆä½œæ–¹çš„èº«ä»½æ˜¯ä¸çŸ¥é“çš„ï¼Œæ‰€ä»¥ä¸€æ¡æ¶ˆæ¯éœ€è¦å‘ç»™ç½‘ç»œä¸Šçš„æ‰€æœ‰äººæ¥ç¡®ä¿åŸæœ¬éœ€è¦æ”¶åˆ°è¿™æ¡æ¶ˆæ¯çš„æ¥å—è€…èƒ½å¤Ÿæ¥æ”¶åˆ° è®©æ‰€æœ‰å‚ä¸è€…çŸ¥é“æ¯ä¸€ä¸ª transaction èƒ½å¤Ÿå…è®¸ç½‘ç»œé˜²æ­¢â€œåŒèŠ±â€ ä¸å¥½çš„åœ°æ–¹æ˜¯æ‰€æœ‰çš„å‚ä¸è€…éƒ½èƒ½çœ‹åˆ°æ‰€æœ‰å…¶ä»–äººçš„æ•°æ®ã€‚è¿™åœ¨å¾ˆå¤šçš„ use-cases æ˜¯æ— æ³•æ¥å—çš„ã€‚ åœ¨ Corda ä¸­ï¼Œæ¯æ¡æ¶ˆæ¯éƒ½ä¼šæŒ‡å®šä¸€ä¸ªå…·ä½“çš„åˆä½œæ–¹ï¼Œè€Œä¸”æ˜¯ä¸ä¼šè¢«ä»»ä½•å…¶ä»–æ— å…³æ–¹çœ‹åˆ°çš„ã€‚å¼€å‘è€…èƒ½å¤Ÿå®Œå…¨æŒæ§ä»€ä¹ˆæ¶ˆæ¯è¢«å‘é€äº†ï¼Œå‘é€ç»™äº†è°ï¼Œåº”è¯¥æŒ‰ç…§ä»€ä¹ˆé¡ºåºå‘é€ã€‚æ‰€ä»¥ æ•°æ®æ˜¯æ ¹æ®éœ€è¦çŸ¥é“çš„åŸåˆ™æ¥å…±äº«çš„ã€‚ä¸ºäº†é¿å…â€œåŒèŠ±â€ï¼Œæˆ‘ä»¬å¼•å…¥äº† notaries æ¥æ›¿æ¢æ‰å·¥ä½œé‡è¯æ˜ï¼ˆproof-of-workï¼‰ã€‚ Corda ä¹Ÿæ˜¯ç”¨äº†å…¶ä»–çš„ä¸€äº›æŠ€æœ¯æ¥æœ€å¤§åŒ–çš„åŒ…æ‹¬ç½‘ç»œä¸Šçš„éšç§ï¼š Transaction éšè—ï¼šTransactions è¢«ç»“æ„åŒ–æˆä¸æš´éœ² transaction çš„å†…å®¹å°±å¯ä»¥è¢«æ•°å­—åŒ–åœ°ç­¾åã€‚è¿™ä¸ªæ˜¯é€šè¿‡ä½¿ç”¨ä¸€ç§å«é»˜å…‹å°”æ ‘çš„æ•°æ®ç»“æ„æ¥å®ç°çš„ã€‚ éšæœºåŒ–ç§˜é’¥ï¼šä¸€ä¸ª transaction çš„æ‰€æœ‰å‚ä¸æ–¹æ˜¯é€šè¿‡ä»–ä»¬çš„å…¬é’¥è¿›è¡Œè¯†åˆ«çš„ï¼Œå¹¶ä¸”é’ˆå¯¹æ¯ä¸€ä¸ª transaction éƒ½ä¼šç”Ÿæˆ ä¸€ä¸ªæ–°çš„ keypairsã€‚æ‰€ä»¥ä¸€ä¸ªç›‘è§†è€…æ— æ³•è¯†åˆ«å‡ºæ¥å¯¹äºä¸€ä¸ªç»™å®š transaction éƒ½å“ªäº›æ–¹å‚ä¸äº†ã€‚ 1.0.14.3 UTXO vs. è´¦æˆ·æ¨¡å‹ Corda ä½¿ç”¨ UTXOï¼ˆUnspent Transaction Outputï¼‰modelã€‚æ¯ä¸ª transaction éƒ½ä¼šæ¶ˆè´¹ä¸€ç³»åˆ—çš„å·²ç»å­˜åœ¨çš„ states ç„¶åå†ç”Ÿæˆä¸€äº›æ–°çš„ statesã€‚ ç›¸åçš„ä¸€ç§æ–¹å¼æ˜¯ è´¦æˆ· æ¨¡å‹ã€‚åœ¨è´¦æˆ·æ¨¡å‹ä¸­ï¼Œstateful å¯¹è±¡è¢«å­˜åœ¨è´¦æœ¬ä¸Šï¼Œtransaction ä¼šé€šè¿‡è¯·æ±‚çš„æ–¹å¼æ¥å¯¹è¿™äº›å¯¹è±¡çš„å½“å‰çš„ state è¿›è¡Œæ›´æ–°ã€‚ UTXO æ¨¡å‹çš„ä¸»è¦ä¼˜ç‚¹åœ¨äºå«æœ‰ä¸åŒçš„ inputs çš„ transactions èƒ½å¤Ÿå¹¶è¡Œåœ°è¢«æ‰§è¡Œï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šåœ°å¢åŠ äº†ç½‘ç»œä¸­æ¯ç§’èƒ½å¤Ÿå¤„ç†çš„ transactionsã€‚åœ¨è´¦æˆ·æ¨¡å‹ä¸­ï¼Œæ¯ç§’é’Ÿèƒ½å¤Ÿå¤„ç†çš„ transactions æ•°é‡æœ‰é™ï¼Œå› ä¸ºå¯¹äºä¸€ä¸ªç»™å®šçš„ object çš„æ›´æ–°éœ€è¦æŒ‰ç…§ç»™å®šçš„é¡ºåºæ¥æ‰§è¡Œã€‚ 1.0.14.4 ä»£ç å³æ³•å¾‹ vs. æ—¢æœ‰çš„æ³•å¾‹ç³»ç»Ÿ é‡‘èä½“ç³»éœ€è¦åœ¨éœ€è¦çš„æ—¶å€™ä½¿ç”¨ä¼ ç»Ÿçš„æ³•å¾‹ä½“ç³»æ¥è§£å†³å†²çªçš„èƒ½åŠ›ã€‚Corda è¢«è®¾è®¡ç”¨æ¥ä½¿è¿™ä¸ªæˆä¸ºå¯èƒ½ï¼š æ‹¥æœ‰éœ€è¦å‡†å…¥çš„ç½‘ç»œï¼Œæ„å‘³ç€æ‰€æœ‰å‚ä¸æ–¹éƒ½èƒ½å¤ŸçŸ¥é“åœ¨æ¯ä¸€ä¸ª transaction ä¸­ä»–ä»¬éƒ½åœ¨è·Ÿè°æ‰“äº¤é“ æ‰€æœ‰ä»£ç åˆçº¦èƒŒåéƒ½å­˜åœ¨æœ‰æè¿°ç€åˆçº¦æ„å›¾è¡Œä¸ºçš„æ³•å¾‹æ–‡æ¡£ï¼Œè¿™ä¸ªæ–‡æ¡£å¯ä»¥åœ¨è§£å†³å†²çªçš„æ—¶å€™ä½¿ç”¨ 1.0.14.5 æ„å»º vs. é‡ç”¨ ä»»ä½•å¯èƒ½çš„æƒ…å†µï¼ŒCorda ä¼šä½¿ç”¨ å·²ç»å­˜åœ¨çš„æŠ€æœ¯æ¥è®©è¿™ä¸ªå¹³å°æ›´åŠ çš„å¥å£®ã€‚æ¯”å¦‚ Corda é‡ç”¨äº†ï¼š ç”¨äºå¼€å‘CorDappsçš„æ ‡å‡†JVMç¼–ç¨‹è¯­è¨€ å·²ç»å­˜åœ¨çš„ SQL database å·²ç»å­˜åœ¨çš„ æ¶ˆæ¯é˜Ÿåˆ—å®ç° 1.0.15 Deterministic JVM ä¸ªäººç†è§£ï¼šä¸ºäº†è¾¾æˆå…±è¯†ï¼ŒCordaè¦æ±‚æ‰€æœ‰çš„èŠ‚ç‚¹è¿è¡Œç›¸åŒçš„JVMæ²™ç®±ï¼Œå«åšDJVMï¼›DJVMä¸ºäº†è®©æ™ºèƒ½åˆçº¦çš„ä»£ç æ¯æ¬¡æ‰§è¡Œçš„ç»“æœéƒ½ç›¸åŒè€Œåšäº†ä¸€äº›é™åˆ¶ã€‚ 1.1 å¼€å‘è¯­è¨€è¯­è¨€æ˜¯ä»€ä¹ˆï¼Ÿ å¼€å‘è¯­è¨€ä¸æ™ºèƒ½åˆçº¦çš„è¯­è¨€éƒ½æ˜¯ä½¿ç”¨ JVM ç¼–ç¨‹è¯­è¨€ç¼–å†™ï¼ˆjava æˆ–è€… kotlinï¼‰ æºç ä½¿ç”¨kotlinè¯­è¨€ç¼–å†™ 1.2 ç½‘ç»œæ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ å¯ä»¥é€‰æ‹©åŠ å…¥corda.networkï¼ŒCorda Networkç”±æ€»éƒ¨ä½äºè·å…°çš„éè¥åˆ©åŸºé‡‘ä¼šç®¡ç†ã€‚ Corda Networkå‚ä¸è€…æœ‰èµ„æ ¼æŠ•ç¥¨å¹¶ä»£è¡¨åŸºé‡‘ä¼šè‘£äº‹ä¼šåšå‡ºé‡è¦å†³å®šï¼ŒåŒ…æ‹¬ç½‘ç»œæ ‡å‡†ï¼Œå‚æ•°å’Œæ”¿ç­–ã€‚ æˆ–è€…æ­å»ºè‡ªå·±çš„ç§æœ‰ç½‘ç»œï¼Œä¸‹è½½cordaç½‘ç»œç®¡ç†è½¯ä»¶ï¼Œéœ€è¦å¡«å†™ä¿¡æ¯ 1.3 Cordaæ˜¯å¦‚ä½•è¾¾æˆå…±è¯†çš„ï¼Ÿ å‡å¦‚Aå‘èµ·ä¸€ä¸ªäº¤æ˜“ç»™Bè½¬è´¦500å…ƒï¼Œé‚£ä¹ˆAéœ€è¦æäº¤ä¸€ä¸ªäº¤æ˜“ï¼ˆtransactionï¼‰å¹¶ç­¾åï¼›ç„¶åæŠŠäº¤æ˜“å‘é€ç»™Bï¼ˆå¦‚æœéœ€è¦Notaryå’ŒOracleå‚ä¸ä¹Ÿä¼šæŠŠneed-to-knowçš„éƒ¨åˆ†å‘é€ç»™ä»–ä»¬ï¼‰ï¼›BéªŒè¯äº¤æ˜“æ²¡æœ‰é—®é¢˜ï¼ˆåŒ…æ‹¬æ•´ä¸ªäº¤æ˜“é“¾ã€æ™ºèƒ½åˆçº¦æ˜¯å¦éªŒè¯é€šè¿‡ã€æ˜¯å¦åŒæ„å½“å‰çš„äº¤æ˜“ã€Notaryå’ŒOracleæ˜¯å¦ç­¾åç­‰ï¼‰å°±ä¼šæä¾›ç­¾åç„¶åæäº¤è¿™æ¬¡äº¤æ˜“ã€‚å¹¶æŠŠç­¾ååçš„äº¤æ˜“å‘é€ç»™Aï¼ŒAä¹Ÿæ‰§è¡Œç›¸åŒçš„æäº¤äº¤æ˜“åŠ¨ä½œã€‚ 1.4 CorDappsæ˜¯ä»€ä¹ˆï¼Ÿ CorDappsæ˜¯ä»¥pluginçš„å½¢å¼è¿è¡Œåœ¨nodeä¸Šçš„â€œåº”ç”¨â€ï¼›ä¸€ä¸ªnodeå¯ä»¥æœ‰å¤šä¸ªCorDappsï¼Œæ¯”å¦‚ä¸€ä¸ªé“¶è¡Œçš„nodeå¯ä»¥æ—¢æœ‰è´·æ¬¾çš„CorDappï¼Œä¹Ÿæœ‰å­˜æ¬¾çš„CorDappã€‚ CorDappåŒ…å«state, transaction, contractå’Œflowç±»ã€‚ 1.5 Cordaçš„éšç§ä¿æŠ¤æ˜¯æ€ä¹ˆåšçš„ï¼Ÿ 1.5.1 åœ¨ç½‘ç»œä¸­çš„å„èŠ‚ç‚¹ä¹‹é—´çš„éšç§ä¿æŠ¤ Cordaçš„ç½‘ç»œéœ€è¦ç”³è¯·åŠ å…¥å¹¶ä¸”å¯¹åº”äº†ç°å®ä¸–ç•Œä¸­çš„ä¸€ä¸ªåˆæ³•èº«ä»½ï¼Œæ‰€ä»¥ä¸å¯ä»¥æŠŠäº¤æ˜“ä¿¡æ¯å…¬å¼€ã€‚ Cordaçš„äº¤æ˜“æ˜¯é€šè¿‡ä¸€ä¸ªèŠ‚ç‚¹å‘èµ·çš„ï¼Œé™¤äº†äº¤æ˜“æ¶‰åŠçš„å…¶ä»–èŠ‚ç‚¹çŸ¥é“å…¨éƒ¨çš„äº¤æ˜“å†…å®¹ï¼›å’ŒOracleä»¥åŠNotaryçŸ¥é“äº¤æ˜“çš„éƒ¨åˆ†éœ€è¦éªŒè¯çš„å†…å®¹ä¹‹å¤–ï¼Œå¯¹å…¶ä»–èŠ‚ç‚¹æ¥è¯´æ˜¯ä¸çŸ¥é“è¿™ä¸ªäº¤æ˜“çš„ã€‚æ‰€ä»¥åœ¨éšç§æ€§æ–¹é¢æ˜¯æ¯”è¾ƒå¥½çš„ã€‚ æ¯”ç‰¹å¸å’Œä»¥å¤ªåŠä¸­çš„èº«ä»½ä¿¡æ¯ä¸ç°å®ä¸–ç•Œçš„èº«ä»½æ˜¯æ²¡æœ‰å¯¹åº”å…³ç³»çš„ï¼Œæ‰€ä»¥æŠŠæ‰€æœ‰çš„è´¦æˆ·å’Œäº¤æ˜“ä¿¡æ¯æ”¾åœ¨äº’è”ç½‘ä¸Šä¹Ÿæ˜¯å®‰å…¨çš„ã€‚ 1.5.2 åœ¨éªŒè¯åŒèŠ±å’Œä¾èµ–Oracleç­¾åæ—¶çš„éšç§ä¿æŠ¤ Cordaé€šè¿‡Transaction tear-offsçš„æ–¹å¼åœ¨éœ€è¦Notaryåšå”¯ä¸€æ€§æ ¡éªŒæˆ–éœ€è¦Oracleæä¾›ç­¾åæ—¶ï¼Œæä¾›çš„åªæœ‰need-to-knowçš„éƒ¨åˆ†ï¼Œå¹¶ä¸åŒ…å«äº¤æ˜“çš„æ‰€æœ‰å†…å®¹ï¼Œæ‰€ä»¥éšç§å¾—åˆ°äº†ä¿æŠ¤ã€‚ 1.6 Cordaäº¤æ˜“çš„å®æ—¶æ€§æ€ä¹ˆæ ·ï¼Ÿ Cordaäº¤æ˜“ç›¸è¾ƒäºæ¯”ç‰¹å¸å’Œä»¥å¤ªåŠæ¥è¯´æ¯”è¾ƒå®æ—¶ï¼Œå› ä¸ºCordaä¸å¿…ç­‰å¾…æŒ–çŸ¿åªè¦äº¤æ˜“è¢«æ ¡éªŒé€šè¿‡ï¼Œæ‰€æœ‰äººéƒ½ç­¾äº†åå°±å†™åœ¨äº†åŒºå—é“¾ä¸Šäº†ã€‚ï¼ˆä»¥å¤ªåŠå’Œæ¯”ç‰¹å¸éœ€è¦åœ¨æŒ–åˆ°çŸ¿ä¹‹åæ‰“åŒ…å¾ˆå¤šä¸ªäº¤æ˜“ï¼Œæ‰€ä»¥å®æ—¶æ€§ä¼šå·®ä¸€äº›ï¼‰ 1.7 Cordaä¸­æ˜¯å¦æœ‰ä»¥å¤ªåŠä¸­çš„è´¦æœ¬çš„æ¦‚å¿µï¼Ÿ ä¸ªäººç†è§£ï¼šCordaä¹Ÿæœ‰è´¦æœ¬çš„æ¦‚å¿µï¼Œä½†æ˜¯Cordaè´¦æœ¬æ‰€åŒ…å«çš„å†…å®¹è¿œæ¯”ä»¥å¤ªåŠçš„è´¦æœ¬ï¼ˆåªæœ‰ä½™é¢ï¼‰è¦å¤šï¼›Cordaçš„è´¦æœ¬æœ‰å¾ˆå¤šä¸åŒç±»å‹çš„stateï¼ŒCordaåªä¿ç®¡äº†å½“å‰çš„stateå’Œå†å²stateï¼Œä½†æ˜¯Cordaæ²¡æœ‰ä¸€ä¸ªæ±‡æ€»çš„æ˜¾ç¤ºä½™é¢çš„â€œè´¦æœ¬â€ï¼›åº”è¯¥å¯ä»¥åœ¨è´¦æœ¬å¤–è®°å½•ã€‚ 1.8 Cordaä¸­è´¦æˆ·ï¼ˆAccountsï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ Cordaä¸­çš„Accountsæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„æ¦‚å¿µï¼Œå€¼å¾—æ˜¯ä¸€ä¸ªèŠ‚ç‚¹çš„Vaultçš„statesæ‰“ä¸Šæ ‡ç­¾æ¥è¡¨ç¤ºå½’å±çš„è´¦æˆ·ï¼›è¿™ä¸ªè´¦æˆ·å’ŒèŠ‚ç‚¹çš„è´¦æˆ·ä¸ä¸€æ ·ï¼ŒAccountå°±åƒä¸ªäººåœ¨é“¶è¡Œï¼ˆèŠ‚ç‚¹ï¼‰å¼€çš„è´¦æˆ·ï¼ˆAccountï¼‰ã€‚ 1.9 Cordaå¯ä»¥å‘å¸ƒå¸å—ï¼Ÿå¯ä»¥æŒ–çŸ¿å—ï¼Ÿ æ²¡æœ‰æ•°å­—è´§å¸ï¼Œå› æ­¤ä¹Ÿä¸èƒ½æŒ–çŸ¿ã€‚å› ä¸ºå…±è¯†åè®®ä¹Ÿå¹¶ä¸æ˜¯é€šè¿‡å·¥ä½œé‡è¯æ˜å®Œæˆï¼Œè€Œæ˜¯é€šè¿‡äº¤æ˜“çš„æ¶‰åŠæ–¹å’Œä¸€äº›å…¬è¯äººå’ŒOracleæ¥è¾¾æˆå…±è¯†çš„ï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦æŒ–çŸ¿ã€‚ 1.10 Cordaçš„Contractå’Œä»¥å¤ªåŠä¸­çš„æ™ºèƒ½åˆçº¦æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ä¸åŒç‚¹ï¼š Cordaçš„Contractä¸»è¦æ˜¯ä¸ºäº†æ¥åšéªŒè¯äº¤æ˜“æ˜¯å¦æ­£ç¡®çš„ï¼Œä¸å¯ä»¥åšä»¥å¤ªåŠæ™ºèƒ½åˆçº¦çš„è½¬è´¦çš„æ“ä½œã€‚ ä»¥å¤ªåŠä¸­çš„æ™ºèƒ½åˆçº¦æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è´¦æˆ·ï¼Œé‡Œé¢æœ‰ä½™é¢ã€äº¤æ˜“æ¬¡æ•°ã€ä»£ç ã€å­˜å‚¨ç­‰ï¼›ä½†æ˜¯Cordaçš„Contractåªæœ‰ä»£ç ï¼Œåªç”¨æ¥éªŒè¯äº¤æ˜“æ˜¯å¦æ­£ç¡®ã€‚ ç›¸åŒç‚¹ï¼š åªè¦æ‰§è¡Œä¸­é‡åˆ°å¼‚å¸¸å°±è¡¨ç¤ºéªŒè¯ä¸é€šè¿‡ï¼›èƒ½å¤Ÿè¯æ˜äº¤æ˜“éæ³•ï¼ˆä¸ç¬¦åˆåˆçº¦å†…å®¹ï¼‰ã€‚ 3ã€å¦‚ä½•åŸºäºCordaæ„å»ºåº”ç”¨ è¯¦æƒ…æŸ¥çœ‹ï¼š å¦‚ä½•å¼€å‘ä¸€ä¸ªCorDapp å¦‚ä½•æ­å»ºä¸€ä¸ªCordaç½‘ç»œ 4ã€Cordaæ±‡æ€» Cordaä¼˜ç‚¹ éšç§ä¿æŠ¤åšçš„å¾ˆå¥½ï¼Œäº¤æ˜“åªæœ‰æ¶‰åŠåˆ°çš„èŠ‚ç‚¹æ‰çŸ¥é“ æä¾›äº†ä¸€äº›é€šç”¨çš„Stateç±»ï¼Œå¦‚ç°é‡‘ã€å•†å“ã€å•†ä¸šç¥¨æ®ã€åˆ©ç‡äº¤æ¢ã€å€ºåŠ¡ç­‰ å¼€å‘CorDappç®€å•ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Javaå¼€å‘å¹¶ä¸”æœ‰æ¨¡æ¿å’Œå¥—è·¯å¯å¾ª","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Corda","slug":"åŒºå—é“¾/Corda","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Corda/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"Corda","slug":"Corda","permalink":"https://guozhe001.github.io/tags/Corda/"}]},{"title":"åŒºå—é“¾çš„å­¦ä¹ è®¡åˆ’","slug":"blockchain/0åŒºå—é“¾çš„å­¦ä¹ è®¡åˆ’","date":"2021-04-01T10:18:21.453Z","updated":"2021-04-01T10:18:21.453Z","comments":true,"path":"2021/04/01/blockchain/0åŒºå—é“¾çš„å­¦ä¹ è®¡åˆ’/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/0%E5%8C%BA%E5%9D%97%E9%93%BE%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%AE%A1%E5%88%92/","excerpt":"","text":"é™¤äº†è¿™äº›ä½ è¿˜éœ€è¦å­¦ä¹ ä»€ä¹ˆï¼Ÿ X.509 TLS/SSL åˆ†ç‰‡ï¼ˆä»¥å¤ªåŠä¸­æœ‰æ­¤æ¦‚å¿µã€å¸ƒæ¯”åŒºå—é“¾ä¹Ÿæœ‰ï¼‰ è·¨é“¾æ˜¯å¦‚ä½•å®ç°çš„ å›½å¯†ä»å“ªé‡Œèƒ½æ‰¾åˆ°ï¼Œæœ‰æ²¡æœ‰å¼€æºä¸æ ‡å‡† DeFiæ˜¯ä»€ä¹ˆï¼Ÿ ä¸€ä¸ªåŒºå—é“¾å…¬å¸éœ€è¦å“ªäº›ï¼š ä¸šåŠ¡æŒç»­å­¦ä¹ ï¼š ä¿ç†æ¨¡å¼ æ‰¿å…‘æ±‡ç¥¨ æ¸…åˆ† åº”æ”¶è´¦æ¬¾ è´´ç° æ‹†è½¬è ABS","categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"}]},{"title":"","slug":"blockchain/1åŒ—äº¬å¤§å­¦è‚–è‡»è€å¸ˆã€ŠåŒºå—é“¾æŠ€æœ¯ä¸åº”ç”¨ã€‹å­¦ä¹ æ€»ç»“","date":"2021-04-01T10:18:21.453Z","updated":"2021-04-01T10:18:21.455Z","comments":true,"path":"2021/04/01/blockchain/1åŒ—äº¬å¤§å­¦è‚–è‡»è€å¸ˆã€ŠåŒºå—é“¾æŠ€æœ¯ä¸åº”ç”¨ã€‹å­¦ä¹ æ€»ç»“/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/blockchain/1%E5%8C%97%E4%BA%AC%E5%A4%A7%E5%AD%A6%E8%82%96%E8%87%BB%E8%80%81%E5%B8%88%E3%80%8A%E5%8C%BA%E5%9D%97%E9%93%BE%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8%E3%80%8B%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/","excerpt":"","text":"title: åŒ—äº¬å¤§å­¦è‚–è‡»è€å¸ˆã€ŠåŒºå—é“¾æŠ€æœ¯ä¸åº”ç”¨ã€‹å­¦ä¹ æ€»ç»“ tags: blockchain åŒ—äº¬å¤§å­¦ æ¯”ç‰¹å¸ ä»¥å¤ªåŠ categories: blockchain 3 æ•°æ®ç»“æ„ hash printers ï¼ˆhashæŒ‡é’ˆï¼‰ hashæŒ‡é’ˆæ—¢å¯ä»¥æ‰¾åˆ°å—çš„ä½ç½®ï¼Œä¹Ÿå¯ä»¥éªŒè¯hashçš„æ­£ç¡®æ€§ Block chain is a linked list using hash pointers æ¯ä¸€ä¸ªåŒºå—éƒ½åŒ…å«å‰ä¸€ä¸ªåŒºå—çš„hashæŒ‡é’ˆ åé¢ä¸€ä¸ªåŒºå—çš„hashæŒ‡é’ˆæ˜¯é€šè¿‡å‰ä¸€ä¸ªåŒºå—çš„å€¼ç®—å‡ºæ¥çš„ã€‚ é€šè¿‡ä¸Šé¢çš„æ•°æ®ç»“æ„å¯ä»¥å®ç°ï¼štamper-evident-log åªè¦è®°ä½æœ€åä¸€ä¸ªå—çš„hashå€¼ï¼Œå°±å¯ä»¥ä¿è¯æ•´ä¸ªé“¾çš„å€¼æ— æ³•ç¯¡æ”¹ã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥åªä¿å­˜å…¶ä¸­çš„éƒ¨åˆ†åŒºå—ï¼ŒåŒºå—çš„å‰é¢çš„éƒ¨åˆ†æˆ‘ä»¬ä¸å¿…ä¿å­˜ï¼Œå¦‚æœéœ€è¦çš„æ—¶å€™æ‰¾åˆ«äººè¦ï¼›ç„¶åéªŒè¯è¦çš„åŒºå—çš„hashå€¼æ˜¯å¦æ˜¯å½“å‰åŒºå—çš„hashå€¼å³å¯ Merkle tree ä¸Šå›¾ï¼š æœ€ä¸‹é¢çš„ä¸€å±‚æ˜¯æ•°æ®å—ï¼Œdata blocksï¼›æ¯ä¸ªæ•°æ®å—éƒ½æ˜¯äº¤æ˜“ï¼ˆtxï¼‰ ä¸Šé¢çš„é‚£äº›éƒ½æ˜¯hash pointers æœ€ä¸Šé¢çš„èŠ‚ç‚¹æ˜¯æ ¹hashå€¼ï¼ˆroot hashï¼‰ Merkle treeæ•°æ®ç»“æ„çš„å¥½å¤„ï¼š åªè¦è®°ä½root hashå°±å¯ä»¥æ£€æµ‹å‡ºèŠ‚ç‚¹çš„ä¿®æ”¹ æ¯ä¸ªåŒºå—åˆ†æˆå—å¤´ï¼ˆblock headerï¼‰å’Œå—èº«ï¼ˆblock bodyï¼‰ é»˜å…‹å°”è¯æ˜ï¼ˆMerkle proofï¼‰ï¼šæŒ‡ä¸€ç¬”äº¤æ˜“åˆ°è·ŸèŠ‚ç‚¹çš„è·¯å¾„ è¿™ç§è¯æ˜ä¹Ÿå«åšï¼šproof of membershipæˆ–proof of inclusionï¼ˆè¯æ˜èŠ‚ç‚¹å­˜åœ¨äºMerkle treeä¹‹ä¸­ï¼‰ proof of non-membershipï¼ˆè¯æ˜èŠ‚ç‚¹å­˜ä¸åœ¨äºMerkle treeä¹‹ä¸­ï¼‰ æ’åºæ‰€æœ‰äº¤æ˜“èŠ‚ç‚¹çš„hashå€¼ï¼ˆSorted Merkle treeï¼‰ï¼Œç„¶åè®¡ç®—éœ€è¦è¯æ˜çš„äº¤æ˜“çš„hashå€¼ï¼Œæ‰¾åˆ°æ­¤hashå€¼åº”è¯¥å‡ºç°çš„ä½ç½®ï¼Œå¦‚æœåº”è¯¥å‡ºç°çš„ä½ç½®çš„ä¸¤è¾¹çš„èŠ‚ç‚¹çš„hashæ»¡è¶³Merkle proofï¼Œåˆ™è¯´æ˜éœ€è¦è¯æ˜çš„èŠ‚ç‚¹ä¸åœ¨æ­¤Merkle treeä¹‹ä¸­ã€‚ åªè¦ä¸æ˜¯æœ‰ç¯çš„æ•°æ®ç»“æ„ï¼Œéƒ½å¯ä»¥ä½¿ç”¨hashæŒ‡é’ˆ 4 BTC åè®® å¦‚ä½•å‘è¡Œæ•°å­—è´§å¸ å¤®è¡Œå‘è¡Œæ•°å­—è´§å¸ï¼Œå¦‚æœåªä½¿ç”¨ç§é’¥ç­¾åï¼Œå¯ä»¥å—ï¼Ÿ æ— æ³•é˜²æ­¢double spending attackï¼šèŠ±ä¸¤æ¬¡æ”»å‡» ä¸­å¿ƒåŒ–æ–¹æ¡ˆï¼š å¦‚æœå¤®è¡Œç»™å‘è¡Œçš„è´§å¸æ‰“ä¸Šç¼–å·å¹¶ä¸”è®°å½•è´§å¸å½“å‰å±äºè°ï¼Œé‚£ä¹ˆå¯ä»¥è§£å†³double spending attackï¼› ä½†æ˜¯æ¯æ¬¡èŠ±é’±éƒ½è¦å»å¤®è¡ŒéªŒè¯è´§å¸æ˜¯å¦æ˜¯çœŸçš„ï¼Œå¹¶ä¸”å±äºå½“å‰èŠ±é’±çš„äººï¼ŒèŠ±é’±ä¹‹åå†å˜æ›´é’±çš„å½’å±ã€‚ å»ä¸­å¿ƒåŒ–æ–¹æ¡ˆ æ¯ä¸ªäº¤æ˜“ï¼ˆå¦‚Aç»™Bè½¬è´¦ï¼‰ä¸­éƒ½åŒ…å«è¾“å…¥å’Œè¾“å‡ºä¸¤ä¸ªéƒ¨åˆ† è¾“å…¥éƒ¨åˆ†éœ€è¦è¯´æ˜å¸çš„æ¥æº è¾“å…¥éƒ¨åˆ†éœ€è¦åŒ…å«ä»˜æ¬¾äººçš„å…¬é’¥ï¼ˆå› ä¸ºä»˜æ¬¾æ—¶æœ‰ä»˜æ¬¾äººçš„ç­¾åï¼Œå¸¦ä¸Šå…¬é’¥ä¸ºäº†ä¾›åˆ«äººæ ¡éªŒï¼‰ è¾“å‡ºéƒ¨åˆ†è¦ç»™å‡ºæ”¶æ¬¾äººå…¬é’¥çš„hash é“¸å¸äº¤æ˜“ï¼ˆcoinbase txï¼‰é‡Œé¢æœ‰Açš„å…¬é’¥çš„hashï¼Œè¿™æ ·å°±çŸ¥é“é“¸å¸äº¤æ˜“çš„é’±æ˜¯ç»™è°çš„ã€‚ ä¸Šå›¾ä¸­çš„æ•°æ®ç»“æ„æœ‰ä¸¤ç§hashæŒ‡é’ˆ ç¬¬ä¸€ç§æ˜¯é“¾æ¥å—çš„hashæŒ‡é’ˆï¼ˆå³å‰ä¸€ä¸ªåŒºå—çš„hashæŒ‡é’ˆï¼‰ ç¬¬äºŒç§hashæŒ‡é’ˆæ˜¯è¯´æ˜å¸çš„æ¥æº é—®é¢˜ï¼šæ˜¯å¦å¯ä»¥æ£€æµ‹dobule spendingï¼Ÿ å¦‚æœå¸çš„æ¥æºæ˜¯ä¸åˆæ³•çš„ï¼ˆéªŒè¯ä¸åˆæ³•çš„æ–¹å¼æ˜¯å¸çš„æ¥æºæ˜¯å¦å­˜åœ¨ä¸UTXOï¼‰ï¼Œæ˜¯ä¸ä¼šæ·»åŠ åˆ°åŒºå—é“¾ä¸­ï¼Œå¯ä»¥æ£€æµ‹dobule spending é—®é¢˜ï¼šåœ¨Aç»™Bè½¬è´¦æ—¶ï¼Œæ‰€æœ‰äººéƒ½éœ€è¦çŸ¥é“Açš„å…¬é’¥ï¼Œä¸ºäº†éªŒè¯Açš„ç­¾åï¼›é‚£ä¹ˆæ€ä¹ˆæ‰èƒ½çŸ¥é“Açš„å…¬é’¥å‘¢ï¼Ÿ åœ¨äº¤æ˜“çš„è¾“å…¥éƒ¨åˆ†ï¼Œä»˜æ¬¾äººéœ€è¦ç»™å‡ºè‡ªå·±çš„å…¬é’¥ åœ¨æ¯”ç‰¹å¸çš„ç³»ç»Ÿé‡Œï¼Œåœ°å€æ˜¯é€šè¿‡å…¬é’¥æ¨ç®—å‡ºæ¥çš„ï¼Œåœ°å€ç›¸å½“äºé“¶è¡Œè´¦å·ï¼ŒAéœ€è¦ç»™Bè½¬é’±éœ€è¦Bçš„åœ°å€ï¼›æ¯”ç‰¹å¸ç³»ç»Ÿé‡Œé¢æ˜¯æ²¡æœ‰åŠŸèƒ½æŸ¥è¯¢æŸä¸ªäººçš„åœ°å€ BitCoin Scriptï¼šäº¤æ˜“è„šæœ¬ï¼ŒæŠŠAçš„è¾“å…¥éƒ¨åˆ†å’Œä¸Šä¸€æ­¥çš„è¾“å‡ºè„šæœ¬æ‹¼åœ¨ä¸€èµ·æ‰§è¡Œï¼Œå¦‚æœä¸æŠ¥é”™è¯´æ˜äº¤æ˜“æ˜¯åˆæ³•çš„ã€‚ æ¯ä¸€ä¸ªå—åŒ…å«ä¸æ­¢ä¸€ä¸ªäº¤æ˜“ï¼Œæ¯ä¸ªå—åŒ…å«Block headerå’ŒBlock body å“ˆå¸ŒæŒ‡é’ˆåŒ…å«çš„hashï¼Œæ˜¯é€šè¿‡Block headeråšhashçš„å€¼ Block headeråŒ…å«ï¼š versionï¼šç”¨çš„å“ªä¸ªæ¯”ç‰¹å¸åè®®çš„ç‰ˆæœ¬ hash of previous block headerï¼šä¸Šä¸€ä¸ªåŒºå—å¤´çš„hash Merkle root hashï¼šæ•´ä¸ªTreeçš„root hashå€¼ targetï¼šæŒ–çŸ¿çš„ç›®æ ‡targetï¼ˆæ»¡è¶³H(block header + nonce) &lt;= targetï¼‰ éšæœºæ•°nonce Block bodyåŒ…å«ï¼š transaction list ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹åˆ†ä¸ºå…¨èŠ‚ç‚¹å’Œè½»èŠ‚ç‚¹ full node å…¨èŠ‚ç‚¹æ˜¯ä¿å­˜åŒºå—é“¾çš„æ‰€æœ‰ä¿¡æ¯çš„ï¼ŒéªŒè¯æ¯ä¸€ä¸ªäº¤æ˜“ï¼Œæ‰€ä»¥å…¨èŠ‚ç‚¹ä¹Ÿå«åšfully validating node light node è½»èŠ‚ç‚¹æ— æ³•ç‹¬ç«‹éªŒè¯äº¤æ˜“çš„åˆæ³•æ€§ é—®é¢˜ï¼šæ¯ä¸ªè´¦æˆ·éƒ½å¯ä»¥å‘å¸ƒäº¤æ˜“ï¼Œè°æ¥å†³å®šå“ªä¸ªäº¤æ˜“å†™åˆ°åŒºå—ä¸­ï¼Ÿé¡ºåºæ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ æŒ–çŸ¿å†³å®šè°æœ‰è®°è´¦æƒï¼Œæœ‰è®°è´¦æƒçš„èŠ‚ç‚¹å¯ä»¥ç”³è¯·å†™å…¥åŒºå—ï¼Œé¡ºåºç”±æ‹¥æœ‰è®°è´¦æƒçš„èŠ‚ç‚¹å®š è´¦æœ¬çš„å†…å®¹è¦å–å¾—åˆ†å¸ƒå¼çš„å…±è¯† distributed consensusï¼ˆåˆ†å¸ƒå¼å…±è¯†ï¼‰ distributed hash table éœ€è¦å–å¾—å…±è¯†çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ FLP impossibility resultï¼š åœ¨ä¸€ä¸ªå¼‚æ­¥çš„ç³»ç»Ÿé‡Œï¼Œå³ä½¿åªæœ‰ä¸€ä¸ªæˆå‘˜æ˜¯æœ‰é—®é¢˜çš„ï¼Œä¹Ÿä¸å¯èƒ½å–å¾—å…±è¯† CAP Theoremï¼ˆå®šç†ï¼‰ CAPï¼š ä¸€è‡´æ€§ ï¼ˆConsistencyï¼‰ å¯ç”¨æ€§ ï¼ˆAvailabilityï¼‰ åˆ†åŒºå®¹é”™æ€§ ï¼ˆPartition toleranceï¼‰ è¿™ä¸‰ä¸ªç‰¹æ€§åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ€å¤šåŒæ—¶æ»¡è¶³ä¸¤ä¸ª åˆ†å¸ƒå¼çš„ä¸€ä¸ªåè®®ï¼šPaxosï¼Œèƒ½å¤Ÿä¿è¯Consistency æ¯”ç‰¹å¸ä¸­çš„å…±è¯†åè®®Consensus in BitCoin å‡è®¾ç³»ç»Ÿä¸­å¤§éƒ¨åˆ†çš„èŠ‚ç‚¹æ˜¯å¥½çš„ï¼Œå°éƒ¨åˆ†æœ‰æ¶æ„ã€‚ ç›´æ¥æŠ•ç¥¨é€‰æ‹©å“ªäº›äº¤æ˜“æ˜¯åˆæ³•çš„ï¼Œå¦‚æœè¶…è¿‡åŠæ•°å°±æ¥å—å¯ä»¥å—ï¼Ÿ membershipï¼Œè°æœ‰æŠ•ç¥¨æƒ hyperledger fabricï¼ˆè”ç›Ÿé“¾ï¼‰ï¼šå¯ä»¥æŠ•ç¥¨å†³å®š sybil attackï¼ˆå¥³å·«æ”»å‡»ï¼‰ï¼šè¶…çº§è®¡ç®—æœºä¸€ç›´åˆ¶é€ è´¦æˆ·ï¼Œå‚ä¸æŠ•ç¥¨ï¼Œç›´åˆ°åˆ¶é€ çš„æ¶æ„è´¦æˆ·è¶…è¿‡åŠæ•°ã€‚ æ¯”ç‰¹å¸çš„æŠ•ç¥¨ï¼ŒæŒ‰ç…§ç®—åŠ›å€¼ è°å…ˆè·å¾—ä¸‹é¢å…¬å¼ä¸­çš„nonceï¼Œè°å°±èƒ½è·å¾—è®°è´¦æƒï¼Œå¹¶ä¸”ç»™äºˆåˆå—å¥–åŠ± Puzzle friendly: H(block header) &lt;= target longest valid chain æœ€é•¿åˆæ³•é“¾ å¦‚æœä¸åœ¨æœ€é•¿åˆæ³•é“¾ä¸Šï¼Œæ–°çš„åŒºå—ä¹Ÿä¸ä¼šè¢«æ¥å—ï¼› ä¸Šé¢çš„å›¾ç‰‡æ˜¯åˆ†å‰æ”»å‡»ï¼ˆforking attackï¼‰ block reward åˆå—å¥–åŠ± ä¸€æ¬¡æ€§èƒ½é€ å¤šå°‘å¸ï¼Ÿ åˆšå‘å¸ƒçš„æ—¶å€™50 BTCï¼Œ21ä¸‡ä¸ªåŒºå—ä¹‹åå¯ä»¥é“¸é€ 25ä¸ªæ¯”ç‰¹å¸ 50 BTC -&gt; 25 BTC -&gt; 12.5 BTC coinbase transaction miningï¼ˆæŒ–çŸ¿ï¼‰ï¼šäº‰å¤ºè®°è´¦æƒ digital goldï¼šæ•°å­—é»„é‡‘ minerï¼šçŸ¿å·¥ BTC å®ç° transaction-based ledgerï¼šåŸºäºäº¤æ˜“çš„è´¦æœ¬æ¨¡å¼ æ¯ä¸ªåŒºå—è®°å½•çš„æ˜¯äº¤æ˜“ä¿¡æ¯ï¼ŒåŒ…æ‹¬è½¬è´¦äº¤æ˜“å’Œé“¸å¸äº¤æ˜“ UTXOï¼šUnspent Transaction Outputï¼ˆè¿˜æ²¡æœ‰è¢«èŠ±å‡ºå»çš„è¾“å‡ºï¼‰ UTXOæ•°æ®ç»“æ„ï¼Œä»¥ä¾¿å¿«é€Ÿæ£€æµ‹double spendingï¼›å¦‚æœæƒ³èŠ±æ‰çš„å¸ä¸å­˜åœ¨UTXOä¸­ï¼Œè¯´æ˜ä¸å­˜åœ¨æˆ–å·²ç»èŠ±å‡º total inputs = total outputs æ¯”ç‰¹å¸çš„ç¬¬äºŒä¸ªæ¿€åŠ±æœºåˆ¶ï¼štransaction fee å…¶ä»–çš„æ¨¡å¼ï¼šaccount-based ledgerï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œç³»ç»Ÿè¦æ˜¾ç¤ºçš„è®°å½•è´¦æˆ·çš„ä½™é¢ï¼Œä»¥å¤ªåŠæ˜¯åŸºäºæ­¤ç§æ¨¡å¼è®°è´¦ã€‚ æ¯æ¬¡å°è¯•nonceå¯ä»¥çœ‹ä½œæ˜¯Bernoulli trialï¼ša random experiment with binary outcome æ‰€æœ‰çš„å°è¯•çš„é›†åˆæ„æˆäº†Bernoulli Processï¼ša sequence of independent Bernoulli trials å°è¯•è®¡ç®—nonceæ˜¯memorylessçš„ï¼šå³æ— è®ºä»¥å‰å°è¯•è¿‡å¤šå°‘æ¬¡ä¸‹ä¸€æ¬¡çš„æ¦‚ç‡è¿˜æ˜¯ä¸€æ · å¯ä»¥ä½¿ç”¨Poisson Processè¿‘ä¼¼ å‡ºå—æ—¶é—´æœä»æŒ‡æ•°åˆ†å¸ƒï¼šexponential distribution BitCoin is secured by mining æ¯”ç‰¹å¸çš„å®‰å…¨æ€§ é—®é¢˜ï¼šèƒ½ä¸èƒ½æŠŠåˆ«äººçš„é’±è½¬ç»™è‡ªå·±ï¼Ÿ ä¸å¯ä»¥ï¼Œå› ä¸ºä½ æ²¡æœ‰åˆ«äººçš„ç§é’¥ï¼Œæ— æ³•ç­¾åã€‚ï¼ˆæ¯”ç‰¹å¸åœ¨èŠ±æ¯ä¸€ç¬”é’±çš„æ—¶å€™éƒ½è¦åˆ¶å®šå¸çš„æ¥æºï¼Œå³æŸæ¬¡äº¤æ˜“çš„outputï¼Œè¿™ä¸ªoutputä¸­æœ‰å¸çš„æ‰€æœ‰äººçš„å…¬é’¥ï¼Œåœ¨èŠ±é’±çš„æ—¶å€™å¸çš„æ‰€æœ‰äººéœ€è¦ç”¨è‡ªå·±çš„ç§é’¥åšç­¾åï¼Œç„¶ååˆ«äººé€šè¿‡å½“å‰äº¤æ˜“çš„inputå’Œå¸æ¥æºçš„outputæ¥éªŒè¯è¿™ä¸ªäº¤æ˜“çš„åˆæ³•æ€§ã€‚ï¼‰ é—®é¢˜ï¼šèƒ½ä¸èƒ½double spendingï¼Ÿ ä¸å¯ä»¥ï¼Œå› ä¸ºç¬¬äºŒæ¬¡èŠ±çš„æ—¶å€™åœ¨UTXOé‡Œé¢ä¸å­˜åœ¨ï¼Œä¼šéªŒè¯ä¸é€šè¿‡ã€‚ 6-BTC-ç½‘ç»œ application layerï¼šBitCoin Block chain network layerï¼šP2P Overlay Network è®¾è®¡åŸåˆ™ï¼šsimple, robust, but not efficient 7-BTC-æŒ–çŸ¿éš¾åº¦ å¦‚ä½•è°ƒæ•´æŒ–çŸ¿éš¾åº¦ï¼šè°ƒæ•´æŒ–çŸ¿éš¾åº¦å°±æ˜¯è°ƒæ•´ç›®æ ‡ç©ºé—´åœ¨æ•´ä¸ªè¾“å‡ºç©ºé—´ä¸­æ‰€å çš„æ¯”ä¾‹ã€‚ æŒ–çŸ¿å³æ˜¯ç®—å‡ºæ»¡è¶³ï¼šH(block header) &lt;= targetçš„nonceå€¼ sha-256: å¯èƒ½çš„å€¼æ˜¯2çš„256æ¬¡æ–¹ difficulty = difficulty_1_target/target é—®é¢˜ï¼šä¸ºä»€ä¹ˆè¦è°ƒæ•´æŒ–çŸ¿éš¾åº¦ï¼Ÿ ä¸ºäº†ä¿è¯å‡ºå—æ—¶é—´å¹³å‡10åˆ†é’Ÿ é—®é¢˜ï¼šå‡ºå—æ—¶é—´å¤ªçŸ­ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ ä¸¤ä¸ªèŠ‚ç‚¹åŒæ—¶å‘å¸ƒåŒºå—ï¼Œå¯èƒ½ä¼šå‡ºç°åˆ†å‰ å¹³å‡å‡ºå—æ—¶é—´è¿‡çŸ­å¯èƒ½å¯¼è‡´ä¸Šå›¾çš„å¾ˆå¤šåˆ†å‰ï¼Œè¿™ä¼šåˆ†æ•£è¯šå®èŠ‚ç‚¹çš„ç®—åŠ› å¹³å‡å‡ºå—æ—¶é—´ä¸è®ºè®¾ç½®çš„å¤šé•¿ï¼Œéƒ½ä¸å¯ä»¥æ— é™çš„å‡å°ä¸‹å» å¦‚æœåˆ†å‰è¿‡å¤šå°±æ— æ³•é˜²æ­¢51% attack ä»¥å¤ªåŠçš„å…±è¯†åè®®ï¼šghost ä»€ä¹ˆæ—¶å€™è°ƒæ•´éš¾åº¦ï¼Ÿ æ¯2016ä¸ªåŒºå—ä¹‹åè°ƒæ•´ä¸€æ¬¡ å¦‚ä½•è°ƒæ•´æŒ–çŸ¿éš¾åº¦ï¼š è°ƒæ•´çš„targetå€¼ **å…¬å¼ï¼š**target = target_current * (actual time)/(expected time) å½“actual timeå¤§äºexpected timeï¼Œè¯´æ˜éš¾åº¦å¤ªå¤§ï¼Œ (actual time)/(expected time)å¾—å‡ºçš„å€¼å°±å¤§äº1ï¼Œæœ€ç»ˆç®—å‡ºæ¥çš„targetä¼šæ¯”å½“å‰çš„targetå¤§ï¼Œä¹Ÿå°±æ˜¯å˜å¾—å®¹æ˜“ è°ƒæ•´éš¾åº¦ next_difficulty = previous_diffculty * (2 weeks)/ (time to mine last 2016 blocks) è°ƒæ•´éš¾åº¦ä¸ç›®æ ‡åŸŸå€¼ï¼ˆtargetï¼‰æˆåæ¯” expected time = 2016 * 10min actual time = time spent mining the last 2016 blocks ç›®æ ‡åŸŸå€¼è°ƒæ•´æœ€å¤§ä¸ä¼šè¶…è¿‡4å€ï¼Œæœ€å°ä¸ä¼šå°äº1/4 æ€ä¹ˆè®©æ‰€æœ‰çš„çŸ¿å·¥éƒ½è°ƒæ•´åŸŸå€¼å‘¢ï¼Ÿ ä»£ç é‡Œè‡ªåŠ¨è°ƒï¼Œå¦‚æœæ¶æ„èŠ‚ç‚¹ä¿®æ”¹äº†æºç ä¸è°ƒæ•´ï¼Œä»–å‘å¸ƒçš„åŒºå—çš„æ£€æŸ¥åŒºå—åˆæ³•æ€§å°±é€šä¸è¿‡ã€‚ 8-BTC-æŒ–çŸ¿ å…¨èŠ‚ç‚¹ ä¸€ç›´åœ¨çº¿ åœ¨æœ¬åœ°ç¡¬ç›˜ä¸Šç»´æŠ¤å®Œæ•´çš„åŒºå—é“¾ä¿¡æ¯ åœ¨å†…å­˜é‡Œç»´æŠ¤UTXOï¼Œä»¥ä¾¿å¿«é€ŸéªŒè¯äº¤æ˜“çš„æ­£ç¡®æ€§ ç›‘å¬æ¯”ç‰¹å¸ç½‘ç»œä¸Šçš„äº¤æ˜“ä¿¡æ¯ï¼ŒéªŒè¯æ¯ä¸ªäº¤æ˜“çš„åˆæ³•æ€§ å†³å®šå“ªäº›äº¤æ˜“ä¼šè¢«æ‰“åŒ…åˆ°åŒºå—é‡Œ ç›‘å¬åˆ«çš„çŸ¿å·¥æŒ–å‡ºæ¥çš„åŒºå—ï¼ŒéªŒè¯å…¶åˆæ³•æ€§ æŒ–çŸ¿ å†³å®šæ²¿ç€å“ªæ¡é“¾æŒ–ä¸‹å»ï¼Ÿ å½“å‡ºç°ç­‰é•¿çš„åˆ†å‰çš„æ—¶å€™ï¼Œé€‰æ‹©å“ªä¸ªåˆ†å‰ï¼Ÿ ç¼ºçœæƒ…å†µä¸‹æ˜¯æ²¿ç€æœ€å…ˆå¬åˆ°çš„åŒºå— è½»èŠ‚ç‚¹ ä¸æ˜¯ä¸€ç›´åœ¨çº¿ ä¸ç”¨ä¿å­˜æ•´ä¸ªåŒºå—é“¾ï¼Œåªè¦ä¿å­˜æ¯ä¸ªåŒºå—çš„å—å¤´ ä¸ç”¨ä¿å­˜å…¨éƒ¨äº¤æ˜“ï¼Œåªä¿å­˜ä¸è‡ªå·±ç›¸å…³çš„äº¤æ˜“ æ— æ³•æ£€éªŒå¤§å¤šæ•°äº¤æ˜“çš„åˆæ³•æ€§ï¼Œåªèƒ½æ£€æµ‹ä¸è‡ªå·±ç›¸å…³çš„é‚£äº›äº¤æ˜“çš„åˆæ³•æ€§ æ— æ³•æ£€æµ‹ç½‘ä¸Šå‘å¸ƒçš„åŒºå—çš„æ­£ç¡®æ€§ å¯ä»¥éªŒè¯æŒ–çŸ¿çš„éš¾åº¦ åªèƒ½æ£€æµ‹å“ªä¸ªæ˜¯æœ€é•¿é“¾ï¼Œä¸çŸ¥é“å“ªä¸ªæ˜¯æœ€é•¿åˆæ³•é“¾ æŒ–çŸ¿å…·æœ‰ç‰¹æ€§ï¼š memorylessæˆ–å«åšprogress free æŒ–çŸ¿çš„è®¾å¤‡ ç¬¬ä¸€ä»£ï¼ŒCPU é—²ç½®çš„cpuã€å†…å­˜ã€ç¡¬ç›˜ ç¬¬äºŒä»£ï¼ŒGPU ä¸ºäº†é€šç”¨å¹¶è¡Œè®¡ç®—è€Œè®¾è®¡çš„ ä¹Ÿå­˜åœ¨æµªè´¹ ç¬¬ä¸‰ä»£ï¼ŒASICï¼šApplication Specific Integrated Circuit æŒ–çŸ¿çš„è®¾å¤‡çš„è¶‹åŠ¿æ˜¯ä»é€šç”¨åˆ°ä¸“ä¸š puzzle mining puzzle:æŒ–çŸ¿æ—¶æ±‚è§£çš„puzzle merge miningï¼šä½¿ç”¨åˆ«çš„å¸çš„mining puzzle Alternative mining puzzle: æŠ—ASICèŠ¯ç‰‡ çŸ¿æ±  ï¼ˆshare almost valid blockï¼‰ å‡å¦‚ä¸€ä¸ªçŸ¿æ± å äº†51%çš„æ¯”ä¾‹ï¼Œä»–èƒ½å‘åŠ¨å“ªäº›æ”»å‡»å‘¢ï¼Ÿ forking attack Boycottï¼ˆå°é”ï¼‰ 9-BTC-æ¯”ç‰¹å¸è„šæœ¬ æ¯”ç‰¹å¸è„šæœ¬æ˜¯stack-basedçš„è„šæœ¬ï¼ŒåŒ…æ‹¬ä¸‹é¢ä¸‰ç§ç±»å‹ P2PKï¼ˆPay to Public Keyï¼‰ P2PHï¼ˆPay to Public Key Hashï¼‰ P2SHï¼ˆPay to Script Hashï¼‰å¯¹å¤šé‡ç­¾åçš„æ”¯æŒ redeemScriptï¼š å½“ä¸€ä¸ªéœ€è¦è”åˆç­¾åçš„è´¦å·Bï¼ˆå¦‚éœ€è¦5ä¸ªä¸­çš„ä¸‰ä¸ªç­¾åï¼‰éœ€è¦æ”¯ä»˜æ—¶ï¼Œéœ€è¦è‡³å°‘æœ‰ä¸‰ä¸ªç­¾åæ‰å¯ä»¥ï¼Œé‚£ä¹ˆåœ¨Bæ”¯ä»˜ç»™Cæ—¶éœ€è¦éªŒè¯Bçš„å¸æ¥æ¥æºçš„outputå’Œå½“å‰çš„äº¤æ˜“çš„inputåšéªŒè¯ã€‚å¦‚æœéœ€è¦éªŒè¯æˆåŠŸåˆ™éœ€è¦åœ¨ä¸Šä¸€æ­¥äº¤æ˜“çš„outputä¸­åŒ…å«è¿™äº›å…¬é’¥ä¿¡æ¯ã€‚ å½“ä¸€ä¸ªè´¦å·Aæ”¯ä»˜ç»™å¦ä¸€ä¸ªéœ€è¦è”åˆç­¾åçš„è´¦å·Bæ—¶ï¼Œå¦‚æœéœ€è¦Aæ”¯ä»˜æ—¶æä¾›Bçš„æ‰€æœ‰çš„è´¦æˆ·çš„å…¬é’¥ä¿¡æ¯ï¼Œä¼šå¯¼è‡´Aæ”¯ä»˜æ—¶ç‰¹åˆ«éº»çƒ¦ã€‚ redeemScriptå°±æ˜¯è§£å†³ä¸Šé¢çš„é—®é¢˜è€Œå­˜åœ¨çš„ï¼Œè¯¦æƒ…å‚è€ƒæ·±å…¥ç†è§£æ¯”ç‰¹å¸è„šæœ¬ Proof of Burn ç‡ƒçƒ§è¯æ˜ï¼Œåœ¨è¾“å‡ºè„šæœ¬ä¸­æ·»åŠ returnï¼Œä½¿è¿™ä¸ªoutputåœ¨éªŒè¯æ—¶æ°¸è¿œæŠ¥é”™ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªè¾“å‡ºçš„å¸æ°¸è¿œä¹ŸèŠ±ä¸å‡ºå»ã€‚ è‡ªé—®ï¼šå¦‚æœAåœ¨ç»™Bä»˜æ¬¾æ—¶ï¼Œoutputä¸­é¢åŒ…å«returnè¯­å¥ï¼Œé‚£ä¹ˆBè™½ç„¶çœŸå®æ”¶åˆ°äº†æ¬¾ï¼Œä½†æ˜¯æ°¸è¿œèŠ±ä¸å‡ºå»ã€‚Bèƒ½å¤Ÿåœ¨æ¥æ”¶æ—¶éªŒè¯å—ï¼Ÿè¿˜æ˜¯åªèƒ½ç­‰åˆ°èŠ±é’±æ—¶æ‰èƒ½å‘ç°è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ **è‡ªç­”ï¼š**å› ä¸ºBéœ€è¦éªŒè¯è¿™æ¯”äº¤æ˜“æœ‰æ²¡æœ‰å†™å…¥åŒºå—é“¾ä¸­ï¼Œæ‰€ä»¥Aä¼šæŠŠäº¤æ˜“å‘ç»™Bï¼Œæ­¤æ—¶Béœ€è¦æ£€æŸ¥outputæ˜¯å¦åŒ…å«returnï¼Œå¦‚æœåŒ…å«åˆ™è®¤ä¸ºè¿™æ¯”äº¤æ˜“æ— æ•ˆï¼›å‡å¦‚Bæ˜¯å•†å®¶å¹¶åœ¨äº¤æ˜“åˆšå‘ç”Ÿæ—¶ä¸éªŒè¯ï¼ŒæŠŠè´§å‘é€ç»™Aï¼Œé‚£ä¹ˆBå°±æ”¶åˆ°ä¸€ç¬”èŠ±ä¸å‡ºå»çš„é’±ã€‚ digital commitment å‘å¸ƒäº¤æ˜“ä¸éœ€è¦è®°è´¦æƒï¼Œå‘å¸ƒåŒºå—æ‰éœ€è¦è®°è´¦æƒ 10-BTC-åˆ†å‰ fork state fork forking attackï¼ˆdeliberate forkï¼‰ protocol forkï¼ˆåè®®åˆ†å‰ï¼‰ hard fork soft fork hard fork ç³»ç»Ÿä¸­åªæœ‰æœ‰ä¸€éƒ¨åˆ†èŠ‚ç‚¹ä¸æ›´æ–°è½¯ä»¶ï¼Œå°±ä¼šå‡ºç°æ°¸ä¹…æ€§çš„åˆ†å‰ egï¼šblock size limit block sizeä¸è¶…è¿‡1Mï¼Œè®¡ç®—å‡º7tx/secï¼ˆæ¯ç§’7ç¬”äº¤æ˜“ï¼‰ï¼›å¦‚æœnew nodesæŠŠè½¯ä»¶å‡çº§ä¸ºåŒºå—å¤§å°æœ€å¤šå¯ä»¥4Mï¼Œé‚£ä¹ˆæ—§çš„èŠ‚ç‚¹å¦‚æœä¸ä¸€èµ·å‡çº§ç»§ç»­æ²¿ç€æ—§é“¾æŒ–å°±ä¼šå¯¼è‡´ç¡¬åˆ†å‰ï¼›æ—§èŠ‚ç‚¹è®¤ä¸ºè¶…è¿‡1Må¤§å°çš„åŒºå—ä¸ºéæ³•çš„ã€‚ åªè¦old nodesä¸æ›´æ–°è½¯ä»¶ï¼Œåˆ†å‰å°±ä¸ä¼šå˜æ›´ soft fork åªè¦ç³»ç»Ÿä¸­æœ‰åŠæ•°ä¸­çš„èŠ‚ç‚¹æ›´æ–°è½¯ä»¶ï¼Œå°±ä¸ä¼šå‡ºç°æ°¸ä¹…æ€§çš„åˆ†å‰ï¼›åªä¼šå‡ºç°ä¸´æ—¶æ€§çš„åˆ†å‰ æ¥ç€ä½¿ç”¨è°ƒæ•´åŒºå—å¤§å°çš„ä¾‹å­ï¼Œå¦‚æœè°ƒæ•´ä¸ºé™åˆ¶ä¸è¶…è¿‡0.5Mï¼Œé‚£ä¹ˆæ–°èŠ‚ç‚¹äº§ç”Ÿçš„åŒºå—æ—§èŠ‚ç‚¹ä¹Ÿè®¤å¯ï¼›ä½†æ˜¯æ—§èŠ‚ç‚¹äº§ç”Ÿçš„åŒºå—æ–°èŠ‚ç‚¹ä¸è®¤å¯ï¼Œå¦‚æœæ–°èŠ‚ç‚¹å å¤šæ•°æ—¶å°±ä¼šè¿«ä½¿æ—§èŠ‚ç‚¹å‡çº§ã€‚ è½¯åˆ†å‰çš„ä¾‹å­ï¼ˆP2SHï¼šPay to Script Hashï¼‰ 11-BTC-é—®ç­” å¦‚æœè½¬è´¦çš„æ—¶å€™åœ°å€å†™é”™äº†æ€ä¹ˆåŠï¼Ÿ ç­”ï¼šæ²¡æœ‰åŠæ³•å–æ¶ˆä¸€ç»å‘å¸ƒçš„äº¤æ˜“ Proof of Burnï¼Œå¦‚æœOP_RETURNæ— æ¡ä»¶çš„è¿”å›é”™è¯¯ï¼Œè¿™ç¬”äº¤æ˜“æ˜¯å¦‚ä½•å†™å…¥åˆ°åŒºå—é“¾é‡Œçš„å‘¢ï¼Ÿ ç­”ï¼šå› ä¸ºOP_RETURNæ˜¯å†™åœ¨å½“å‰äº¤æ˜“çš„è¾“å‡ºè„šæœ¬é‡Œï¼Œæ‰€ä»¥å½“å‰äº¤æ˜“çš„éªŒè¯ä¸ä¼šéªŒè¯è¿™ä¸ªè„šæœ¬ ä½ æ€ä¹ˆçŸ¥é“å“ªä¸ªçŸ¿å·¥æœ€å…ˆæ‰¾åˆ°çš„åŒä¸€ä¸ªnonceï¼Ÿ ç­”ï¼šä¸å¯ä»¥å·ç­”æ¡ˆï¼Œå› ä¸ºåŒºå—é‡Œé¢çš„coinbase txæŒ‡å‘çš„æ”¶æ¬¾è´¦æˆ·æ˜¯çœŸæ­£è®¡ç®—å‡ºnonceçš„è´¦æˆ·ï¼Œè¿™ä¸ªä¿¡æ¯å¦‚æœè¢«ä¿®æ”¹äº†ï¼Œäº¤æ˜“å°±ä¸ä¼šéªŒè¯é€šè¿‡ã€‚ transaction feeï¼Œå¦‚ä½•ç¡®å®šäº¤æ˜“è´¹ç»™å“ªä¸ªçŸ¿å·¥ï¼Œç»™å¤šå°‘ï¼Ÿ åªè¦total inputs &gt; total outputsï¼Œä¹‹é—´çš„å·®é¢å°±æ˜¯äº¤æ˜“è´¹ 12-BTC-æ¯”ç‰¹å¸ä¸­çš„åŒ¿åæ€§ BitCoin and anonymity pseudonymity ä»€ä¹ˆæƒ…å†µä¸‹ä¼šç ´ååŒ¿åæ€§ï¼Ÿ åœ¨å¤šä¸ªinputsçš„æ—¶å€™ï¼Œå¤šä¸ªè¾“å…¥å¯èƒ½æ˜¯åŒä¸€ä¸ªäºº ä»€ä¹ˆæƒ…å†µä¸‹åˆ«äººèƒ½ç›´åˆ°æ¯”ç‰¹å¸è´¦æˆ·å¯¹åº”ç°å®ä¸­çš„æŸä¸ªäººå‘¢ï¼Ÿ èµ„é‡‘çš„è½¬å…¥è½¬å‡ºï¼Œè´­ä¹°æ¯”ç‰¹å¸æˆ–è€…æ¯”ç‰¹å¸å¥—ç°ï¼›æ¯”ç‰¹å¸æ”¯ä»˜çš„æ—¶å€™ä¹Ÿå¯ä»¥ silk roadï¼šeBay for illegal drugs é‡‡å–ä»€ä¹ˆæ–¹æ³•æé«˜åŒ¿åæ€§ï¼Ÿ é›¶çŸ¥è¯†è¯æ˜ é›¶çŸ¥è¯†è¯æ˜æ˜¯æŒ‡ä¸€æ–¹ï¼ˆè¯æ˜è€…ï¼‰å‘å¦ä¸€æ–¹ï¼ˆéªŒè¯ç€ï¼‰è¯æ˜ä¸€ä¸ªé™ˆè¿°æ˜¯æ­£ç¡®çš„ï¼Œè€Œæ— éœ€é€éœ²é™¤è¯¥é™ˆè¿°æ˜¯æ­£ç¡®çš„å¤–çš„ä»»ä½•ä¿¡æ¯ã€‚ **æˆ‘çš„ç†è§£ï¼š**å¦‚æ¯”ç‰¹å¸çš„è½¬è´¦ï¼ˆAè½¬ç»™Bï¼‰ç­¾åå°±æ˜¯é›¶çŸ¥è¯†è¯æ˜ï¼Œå› ä¸ºè¿™ä¸ªç­¾åè¯æ˜äº†è¿™ä¸ªäº¤æ˜“æ˜¯Aè½¬å‡ºå»çš„ï¼Œå´ä¸éœ€è¦è®©Aæä¾›å…¶ä»–ä¿¡æ¯ã€‚ 13-BTC-æ€è€ƒ ä¸ºä»€ä¹ˆæ¯”ç‰¹å¸ç³»ç»Ÿèƒ½å¤Ÿç»•è¿‡è¢«è¯æ˜çš„åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸å¯èƒ½çš„ç»“è®ºï¼Ÿ æ¯”ç‰¹å¸å¹¶æ²¡æœ‰ç»•è¿‡ 14-ETH-ä»¥å¤ªåŠæ¦‚è¿° memory hard mining puzzle ASIC resistanceï¼šæŒ–çŸ¿æ—¶éœ€è¦è®¿é—®å†…å­˜ proof of work -&gt; proof of stakeï¼šç›®æ ‡æ˜¯ä»å·¥ä½œé‡è¯æ˜è¿‡åº¦åˆ°æƒç›Šè¯æ˜ smart contract: æ™ºèƒ½åˆçº¦ BitCoin: decentralized currencyï¼ˆå»ä¸­å¿ƒåŒ–çš„è´§å¸ï¼‰ Ethereum: decentralized contractï¼ˆå»ä¸­å¿ƒåŒ–çš„åˆåŒï¼‰ 15-ETH-è´¦æˆ· ä»¥å¤ªåŠæ˜¯ä¸€ä¸ªaccounting-based ledgerï¼ˆåŸºäºè´¦æˆ·çš„å»ä¸­å¿ƒåŒ–çš„è´¦æœ¬ï¼‰ å¤©ç„¶é˜²å¾¡double spending attack è®°å½•äº¤æ˜“æ¬¡æ•°ï¼ˆnonceï¼‰ï¼Œä»¥é˜²å¾¡replay attackï¼ˆé‡æ”¾æ”»å‡»ï¼‰ è´¦æˆ·ç±»å‹ externally owned accountï¼ˆå¤–éƒ¨è´¦æˆ·ï¼‰ è®°å½•ï¼š balance nonce Smart contract accountï¼ˆæ™ºèƒ½åˆçº¦è´¦æˆ·ï¼‰ è®°å½•ï¼š balance nonce code storage æ™ºèƒ½åˆçº¦è´¦æˆ·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š åˆçº¦è´¦æˆ·æ— æ³•ä¸»åŠ¨å‘èµ·ä¸€ä¸ªäº¤æ˜“ åˆ›å»ºåˆçº¦è´¦æˆ·çš„æ—¶å€™ä¼šè¿”å›ä¸€ä¸ªåœ°å€ï¼Œå¯ä»¥è°ƒç”¨è¿™ä¸ªåœ°å€ 16-ETH-ä»¥å¤ªåŠä¸­çš„çŠ¶æ€æ ‘ ç»´æŠ¤çš„åŠŸèƒ½æ˜¯è´¦æˆ·åœ°å€åˆ°è´¦æˆ·çŠ¶æ€çš„æ˜ å°„ï¼šaddr -&gt; state é—®é¢˜ï¼šå¦‚æœæŠŠæ‰€æœ‰è´¦æˆ·ç›´æ¥ç»„æˆä¸€ä¸ªmerkle tree å¯ä»¥å—ï¼Ÿ ä¸å¯ä»¥ï¼Œå› ä¸ºä¿®æ”¹è´¦æˆ·æ—¶æˆäº†ä¸²è¡Œ é—®é¢˜ï¼šä¸ºä»€ä¹ˆæ¯”ç‰¹å¸å¯ä»¥æŠŠæ‰€æœ‰äº¤æ˜“ç»„æˆä¸€ä¸ªmerkle treeå‘¢ï¼Ÿ å› ä¸ºæ¯”ç‰¹å¸åªæœ‰ä¸€ä¸ªäººæ‹¥æœ‰è®°è´¦æƒï¼Œæ‰€ä»¥è¿™ä¸ªæœ‰è®°è´¦æƒçš„äººéšæ„è®°å½•å³å¯ å³ä½¿ä»¥å¤ªåŠä½¿ç”¨sorted merkle treeï¼Œåœ¨æœ‰æ–°çš„è´¦æˆ·å‡ºç°æ—¶ä¹Ÿä¼šå¤§é‡çš„æ›´æ–°merkle treeä¸­çš„hashå€¼ã€‚ æ•°æ®ç»“æ„ï¼štrieï¼ˆretrieval-æ£€ç´¢ï¼‰ æ•°æ®ç»“æ„ï¼šPatricia treeï¼ˆtrieï¼‰ æ ‘çš„é«˜åº¦å˜çŸ­ å¦‚æœæ’å…¥æ–°çš„å•è¯ï¼ŒåŸæ¥å‹ç¼©çš„èŠ‚ç‚¹å¯èƒ½éœ€è¦æ‰©å±•å¼€ æ•°æ®ç»“æ„ï¼šMPTï¼ˆMerkle Patricia treeï¼‰ æŠŠPatricia treeçš„æŒ‡é’ˆæ”¹ä¸ºHash Pointerå°±æˆäº†MPT æ•°æ®ç»“æ„ï¼šModified MPT ä¸‹é¢çŠ¶æ€æ ‘çš„ä¾‹å­ä¸­çš„èŠ‚ç‚¹æœ‰ä¸‰ç§ï¼š Extention Nodeï¼šå¦‚æœè·¯å¾„å‡ºç°å‹ç¼©ï¼Œå°±ä¼šå‡ºç°æ­¤èŠ‚ç‚¹ Branch Nodeï¼šåˆ†æ”¯èŠ‚ç‚¹ Leaf Nodeï¼šæœ€ç»ˆçš„èŠ‚ç‚¹ 16-ETH-äº¤æ˜“æ ‘å’Œæ”¶æ®æ ‘ ç”¨å¤„ï¼š æä¾›Merkle proof æ•°æ®ç»“æ„ï¼šbloom filter **ç”¨é€”ï¼š**æ”¯æŒæŸ¥æ‰¾æŸä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªæ¯”è¾ƒå¤§çš„é›†åˆä¸­ **å®ç°ï¼š**æŠŠé›†åˆä¸­çš„æ‰€æœ‰çš„hashå€¼æ˜ å°„åˆ°ä¸€ä¸ªå°çš„æ•°ç»„ä¸­ï¼Œç„¶åæŠŠæ•°ç»„ä¸­çš„å¯¹åº”ä½ç½®çš„å€¼ç”±0æ”¹ä¸º1ã€‚ æœ‰å¯èƒ½å‡ºç°è¯¯æŠ¥ï¼ˆä¸€ä¸ªå€¼çš„hashæ˜ å°„çš„æ•°ç»„ä¸­çš„ä½ç½®ï¼Œå¦‚æœæ˜¯1åªèƒ½è¯´æ˜å¯èƒ½å­˜åœ¨ï¼Œå› ä¸ºå­˜åœ¨hashç¢°æ’ï¼‰ ä¸ä¼šå‡ºç°æ¼æŠ¥ï¼ˆå› ä¸ºåªè¦æŸä¸ªå€¼çš„hashæ˜ å°„çš„æ•°ç»„çš„ä½ç½®çš„å€¼æ˜¯0ï¼Œè¯´æ˜æ­¤å€¼ä¸å­˜åœ¨ï¼‰ ä»¥å¤ªåŠä¸­å¦‚ä½•ä½¿ç”¨bloom filter åŒ…å«åœ¨å—å¤´é‡Œé¢ï¼Œå¯ä»¥å¿«é€Ÿè¿‡æ»¤æŸäº›èŠ‚ç‚¹ä¸åŒ…å«æŒ‡å®šäº¤æ˜“ï¼›ç„¶åå†åœ¨å¯èƒ½åŒ…å«çš„èŠ‚ç‚¹ä¸­æ£€ç´¢ã€‚ transaction-driven state machineï¼ˆäº¤æ˜“é©±åŠ¨çš„çŠ¶æ€æœºï¼‰ 18-ETH-GHOSTåè®® å¦‚æœåªæœ‰å’Œçˆ¶èŠ‚ç‚¹å¹³çº§çš„æ‰æ˜¯uncle block å­˜åœ¨é—®é¢˜ï¼š 1ã€uncle blockçš„ä¸ªæ•°åªèƒ½æ˜¯ä¸¤ä¸ªï¼Œå¦‚æœåˆ†å‰è¶…è¿‡3ä¸ªå°±æ— æ³•å…¨éƒ¨åŒ…å«è¿›æ¥ã€‚ 2ã€æ•…æ„ä¸åŒ…å«æŸä¸ªå”çˆ¶åŒºå— åªè¦ä¸å½“å‰èŠ‚ç‚¹æœ‰å…±åŒçš„ä¸»é“¾å°±è®¤ä¸ºæ˜¯uncle block å­˜åœ¨é—®é¢˜ï¼š æŸä¸ªçŸ¿å·¥åœ¨æŒ–çŸ¿éš¾åº¦ä½çš„æ—¶å€™äº§ç”Ÿå¤šä¸ªåˆ†å‰ï¼ˆå³ä»¥åèŠ‚ç‚¹çš„å”çˆ¶ï¼‰åŒºå—ï¼ŒæœŸå¾…ä»¥åè¢«åŒ…å«è¿›å»ä»¥è·å–åˆå—å¥–åŠ± GHOSTåè®®ï¼šä¸å½“å‰åŒºå—åœ¨7ä»£ä»¥å†…ï¼Œæ‰è¢«è®¤ä¸ºæ˜¯uncle block è·ç¦»å½“å‰åŒºå—è¶Šè¿œçš„uncle blockï¼Œå¾—åˆ°çš„å¥–åŠ±è¶Šå°‘ï¼›ä¸ºäº†é˜²æ­¢åˆ†å‰è¿‡å¤šï¼Œæœ‰åˆ©äºé¼“åŠ±å‡ºç°åˆ†å‰å°½å¿«åˆå¹¶ã€‚å”çˆ¶åŒºå—å¾—ä¸åˆ°gas feeï¼ˆæ±½æ²¹è´¹ï¼‰ 19-ETH-æŒ–çŸ¿ç®—æ³•ï¼ˆethashï¼‰ Block chain is secured by miningã€‚ bug bountyï¼šbugèµé‡‘ one cpuï¼Œ one voteï¼ˆä¸€ä¸ªcpuï¼Œä¸€å¼ æŠ•ç¥¨ï¼‰ è®¾è®¡puzzleçš„åŸåˆ™ï¼šdifficult to solveï¼Œ but easy to verify ä»¥å¤ªåŠçš„æŒ–çŸ¿ç®—æ³•çš„ç›®æ ‡æ˜¯åšåˆ°ï¼šAISC resistance memory hard mining puzzle 20-ETH-éš¾åº¦è°ƒæ•´ è‡ªé€‚åº”éš¾åº¦è°ƒæ•´ å­å…¬å¼è§£é‡Š éš¾åº¦ç‚¸å¼¹ï¼ˆdifficulty bombï¼‰ ä»¥å¤ªåŠå‘å±•çš„å››ä¸ªé˜¶æ®µ 21-æƒç›Šè¯æ˜ï¼ˆProof of stakeï¼‰ TWHï¼šTerawatt hours é—®é¢˜ï¼šä¸ºä»€ä¹ˆéœ€è¦æƒç›Šè¯æ˜ï¼Ÿ å·¥ä½œé‡è¯æ˜å¤ªè´¹ç”µäº† åˆå—å¥–åŠ±æ˜¯ä¸ºäº†æ¿€åŠ±çŸ¿å·¥å‚ä¸æ¯”ç‰¹å¸ç³»ç»Ÿçš„ç»´æŠ¤ã€‚ virtual mining æƒç›Šè¯æ˜ï¼š æ¯ä¸ªäººæŒ‰ç…§æŒæœ‰å¸çš„æ•°é‡æ¥æŠ•ç¥¨ï¼Œçœå»äº†æŒ–çŸ¿çš„è¿‡ç¨‹ï¼›æŒæœ‰çš„å¸è¶Šå¤šï¼Œæƒç›Šè¶Šå¤§ã€‚ æŒæœ‰çš„å¸åªèƒ½ä»åŠ å¯†è´§å¸çš„ç³»ç»Ÿä¸­è·å–ï¼Œå¦‚æœæœ‰äººå¤§é‡è´­ä¹°è¿™ä¸ªå¸ä»¥è·å–æƒç›Šç„¶åæå®ä»–ï¼Œä¼šå¯¼è‡´å¸ä»·å¤§æ¶¨ï¼›æ¶¨ä»·ä¼šè®©æå®è¿™ä¸ªå¸æ‰€ä»˜å‡ºçš„ä»£ä»·å¾ˆå¤§ã€‚ AltCoin Infanticideï¼šæŠŠæ–°å¸æ‰¼æ€åœ¨æ‘‡ç¯®é‡Œ Proof of Deposit å¦‚æœå‡ºç°åˆ†å‰çš„æ—¶å€™ï¼Œä¸€ä¸ªäººä¸¤è¾¹éƒ½æŒ–ï¼Œå¹¶ä¸ä¼šå½±å“ä»–çš„å¸çš„æ•°é‡ã€‚ Casper the Friendly Finality Gadgetï¼ˆFFGï¼‰ éªŒè¯è€…æœ‰ä»»æœŸï¼ŒéªŒè¯è€…åœ¨ä»»æœŸå¤–æœ‰ç­‰å¾…æœŸï¼Œå¦‚æœæ²¡æœ‰äººæ£€ä¸¾åˆ™ç»™éªŒè¯è€…ä¿è¯é‡‘å’Œå¥–åŠ±ã€‚ EOSå¸çš„æƒç›Šè¯æ˜ï¼š DPOSï¼šDelegated Proof of Stake 22-ETH-æ™ºèƒ½åˆçº¦ å¤–éƒ¨è´¦æˆ·å¦‚ä½•è°ƒç”¨æ™ºèƒ½åˆçº¦ï¼Ÿ SENDER ADDRESSï¼šè°ƒç”¨è€…çš„åœ°å€ TO CONTRACT ADDRESSï¼šæ™ºèƒ½åˆçº¦çš„åœ°å€ VALUEï¼šè°ƒç”¨æ—¶è½¬å¤šå°‘ETH GAS USEDï¼šæ±½æ²¹è´¹ GAS PRICEï¼šæ±½æ²¹è´¹çš„ä»·æ ¼ CAS LIMITï¼šæ­¤è°ƒç”¨æ„¿æ„æ”¯ä»˜çš„æ±½æ²¹è´¹ä¸Šé™ TX DATAï¼šè°ƒç”¨çš„å‡½æ•°åŠå…¶å‚æ•°çš„ç¼–ç å€¼ ä¸€ä¸ªåˆçº¦å¦‚ä½•è°ƒç”¨å¦ä¸€ä¸ªåˆçº¦ä¸­çš„å‡½æ•° 1ã€ç›´æ¥è°ƒç”¨ 2ã€ä½¿ç”¨adressç±»å‹çš„call()å‡½æ•° 3ã€ä»£ç†è°ƒç”¨delegatecall() é”™è¯¯å¤„ç† assertï¼šä¸€èˆ¬ç”¨æ¥åˆ¤æ–­å†…éƒ¨æ¡ä»¶ requiredï¼šä¸€èˆ¬ç”¨äºåˆ¤æ–­å¤–éƒ¨æ¡ä»¶ revertï¼šæ— æ¡ä»¶çš„æŠ›å‡ºå¼‚å¸¸ åµŒå¥—è°ƒç”¨ å…ˆæ‰§è¡Œäº¤æ˜“å†æŒ–çŸ¿,å› ä¸ºæŒ–çŸ¿ä¹‹åå‘å¸ƒçš„è´¦æˆ·çŠ¶æ€éœ€è¦å…ˆæ‰§è¡Œäº¤æ˜“ã€‚ å°±ç®—è´¦æˆ·çš„ä»£ç æ‰§è¡Œé”™è¯¯ï¼Œä¹Ÿä¼šè¢«å‘å¸ƒï¼›ç„¶åæ”¶å–æ±½æ²¹è´¹ï¼Œä¸ºäº†é˜²æ­¢æœ‰æ¶æ„èŠ‚ç‚¹å‘é€å¤§é‡çš„ä¸èƒ½éªŒè¯é€šè¿‡çš„äº¤æ˜“ã€‚ é—®é¢˜ï¼šæ™ºèƒ½åˆçº¦çš„ä»£ç æ”¯æŒå¤šçº¿ç¨‹æ‰§è¡Œå—ï¼Ÿ ä¸æ”¯æŒå¤šçº¿ç¨‹,å¤šçº¿ç¨‹å¯èƒ½é€ æˆæ‰§è¡Œç»“æœçš„ä¸ä¸€è‡´ã€‚ æ™ºèƒ½åˆçº¦å¯ä»¥è·å¾—çš„åŒºå—ä¿¡æ¯ æ™ºèƒ½åˆçº¦å¯ä»¥è·å¾—çš„è°ƒç”¨ä¿¡æ¯ åœ°å€ç±»å‹ åœ°å€ç±»å‹ä¸­çš„ä¸åŒæ–¹æ³•è½¬è´¦æ—¶çš„ç‰¹ç‚¹ï¼š transferï¼šä¼šå¯¼è‡´è¿é”æ€§å›æ»š sendï¼šä¸ä¼šå¯¼è‡´è¿é”æ€§å›æ»š callï¼šä¸ä¼šå¯¼è‡´è¿é”å¼å›æ»šï¼Œcallçš„æ–¹å¼è½¬è´¦ä¼šæŠŠå‰©ä½™çš„æ±½æ²¹å…¨éƒ¨å‘é€è¿‡å» ä¸€ä¸ªä¾‹å­ï¼šç®€å•æ‹å– æ„é€ æ–¹æ³• å‡ºä»·å’Œç»“æŸæ‹å–çš„æ–¹æ³• å¦‚æœé»‘å®¢çš„æ™ºèƒ½åˆçº¦ä¸­æ²¡æœ‰callbackæ–¹æ³•æ€ä¹ˆåŠï¼Ÿ æ²¡æœ‰åŠæ³•ã€‚ã€‚ã€‚ Code is lowï¼š ä¼˜ç‚¹ï¼šæ²¡æœ‰äººèƒ½å¤Ÿä¿®æ”¹è§„åˆ™ ç¼ºç‚¹ï¼šå¦‚æœè§„åˆ™æœ‰é—®é¢˜ï¼Œä¹Ÿæ— æ³•ä¿®æ­£ï¼Œå¯¼è‡´ä¸Šé¢çš„é—®é¢˜æˆä¸ºæ‰€æœ‰äººçš„é’±éƒ½å–ä¸å‡ºæ¥ ä¼˜åŒ–åçš„æ‹å–ä»£ç  æ— æ³•é˜²æ­¢é‡å…¥æ”»å‡»ï¼ˆRe-entrancy Attackï¼‰ è§£å†³çš„æ–¹æ³•æ˜¯ï¼Œå…ˆæŠŠé‡‘é¢ä¿®æ”¹ä¸º0ï¼Œå†å‘èµ·è½¬è´¦ã€‚ è½¬è´¦äº¤æ˜“æ—¶éœ€è¦ä½¿ç”¨è¿™ä¸ªæ­¥éª¤ï¼šå…ˆåˆ¤æ–­æ¡ä»¶ï¼Œå†æ”¹å˜æ¡ä»¶ï¼Œå†å‘ç”Ÿäº¤äº’ better safe by sorry ä¸è¦ä½¿ç”¨callæ–¹æ³•è½¬è´¦ï¼Œå› ä¸ºcallæ”¯ä»˜çš„æ±½æ²¹è´¹å¤ªå¤š 23-ETH-TheDAO DAOï¼šDecentralized Autonomous Organizationï¼ˆå»ä¸­å¿ƒåŒ–çš„è‡ªæ²»çš„ç»„ç»‡ï¼‰ DACï¼šDecentralized Autonomous Corporationï¼ˆå»ä¸­å¿ƒåŒ–çš„è‡ªæ²»çš„å…¬å¸ï¼‰ å› ä¸ºå…ˆè½¬è´¦å†æ›´æ”¹ä½™é¢å¯¼è‡´è¢«å‘èµ·äº†é‡å…¥æ”»å‡»ï¼š too big to fail å‡çº§åäº§ç”Ÿä¸¤ä¸ªåˆ†å‰ï¼šé€šè¿‡åœ¨é“¾ä¸Šå¢åŠ ChainIDï¼ˆä¸ºäº†é˜²æ­¢å›æ”¾ï¼‰ï¼Œä»¥åŒºåˆ†ETC(Ethereum Classic)å’ŒETH ä¸ºä»€ä¹ˆä¸èƒ½åªé’ˆå¯¹é»‘å®¢çš„è´¦æˆ·ï¼Ÿ å› ä¸ºæ™ºèƒ½åˆçº¦æœ‰bugï¼Œæ‰€ä»¥å°±ç®—åªé’ˆå¯¹é»‘å®¢çš„è´¦æˆ·å…¶ä»–äººä¹Ÿå¯ä»¥é’ˆå¯¹è¿™ä¸ªbugè¿›è¡Œæ”»å‡»ã€‚ 24-ETH-æ€è€ƒ Is smart contract really smartï¼Ÿï¼ˆæ™ºèƒ½åˆçº¦çœŸçš„æ™ºèƒ½å—ï¼‰ smart contract is anything but smart Nothing is irrevocableï¼ˆæ²¡æœ‰ä»€ä¹ˆæ˜¯ä¸å¯ç¯¡æ”¹çš„ï¼‰ å¦‚TheDAOçš„ä¾‹å­ï¼›æ‰€ä»¥ä¸èƒ½è¿·ä¿¡â€œä¸å¯ç¯¡æ”¹â€ Is solidity the right programming languageï¼Ÿ solidityå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œä½†æ˜¯æ²¡æœ‰ä»€ä¹ˆä¸œè¥¿æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚æ‰€ä»¥éšç€æ—¶é—´çš„æ£€éªŒå¯èƒ½ä¼šå‡ºç° æ™ºèƒ½åˆçº¦æ¨¡æ¿ ç¼–å†™æ™ºèƒ½åˆçº¦çš„å…¬å¸ è™½ç„¶æ™ºèƒ½åˆçº¦çš„å†…å®¹æ˜¯å¼€æºçš„ï¼Œä½†æ˜¯Many eyeball fallacyï¼›åœ¨æ¶‰åŠåˆ°è‡ªå·±çš„åˆ©ç›Šæ—¶è¿˜æ˜¯éœ€è¦è‡ªå·±æ£€æŸ¥ä»£ç ã€‚ What does decentralizationï¼ˆæƒåˆ©ä¸‹æ”¾ï¼‰ meanï¼Ÿ åˆ†å‰æ˜¯å»ä¸­å¿ƒåŒ–å’Œæ°‘ä¸»çš„ä½“ç° decentralized != distributed(å»ä¸­å¿ƒåŒ–ä¸ç­‰äºåˆ†å¸ƒå¼) state machineçš„åº”ç”¨åœºæ™¯ï¼š mission critical applicationï¼ˆå…³é”®ä»»åŠ¡åº”ç”¨ç¨‹åºï¼‰ air traffic controlï¼ˆç©ºä¸­äº¤é€šç®¡åˆ¶ï¼‰ stock exchangeï¼ˆè¯åˆ¸äº¤æ˜“ï¼‰ space shuttleï¼ˆèˆªå¤©é£æœºï¼‰ æ™ºèƒ½åˆçº¦æ˜¯ç”¨æ¥ç¼–å†™æ§åˆ¶ç¨‹åºçš„ï¼Œåªæœ‰åœ¨äº’ä¸ä¿¡ä»»çš„å®ä½“ä¹‹é—´å»ºç«‹å…±è¯†çš„æ“ä½œæ‰éœ€è¦å†™åœ¨æ™ºèƒ½åˆçº¦é‡Œ 25-ETH-Beauty Chainï¼ˆç¾é“¾ï¼‰ IPOï¼šInitial Public Offering ICOï¼šInitial Coin Offering ç¾é“¾èƒŒæ™¯ä»‹ç» ä¸‹å›¾ä¸­å‡ºç°çš„ERCä¸ºEthereum Request for Commentsï¼ˆä»¥å¤ªåŠå¾æ±‚æ„è§ï¼‰ å› ä¸ºä¸‹é¢çš„ä»£ç åœ¨è®¡ç®—æ—¶å‡ºç°äº†æº¢å‡ºï¼Œä»è€Œå¯¼è‡´è¢«æ”»å‡»ï¼Œå‡­ç©ºå‡ºç°äº†å¾ˆå¤šçš„ä»£å¸BEC å¦‚ä½•é¢„é˜²æ­¤ç±»ï¼ˆè®¡ç®—æº¢å‡ºï¼‰é—®é¢˜ï¼Ÿ 26-æ€»ç»“ åŠ å¯†è´§å¸åº”è¯¥ç”¨åœ¨æ³•å¸æ”¯æŒçš„ä¸å¤ªå¥½çš„åœ°æ–¹ï¼Œè€Œä¸æ˜¯ç”¨åœ¨æ³•å¸å·²ç»æ”¯æŒçš„å¾ˆå¥½çš„åœ°æ–¹ã€‚ ä¸‹ä¸€ä»£çš„çš„äº’è”ç½‘æ˜¯ä»·å€¼äº¤æ¢ç½‘ç»œ Democracy is the worst from of Government except for all those other forms that have bean tried from time to time Is decentralized aways right thing?","categories":[],"tags":[]},{"title":"è¯»ä¹¦ç¬”è®°-ã€Šæˆ‘çš„ç¬¬ä¸€æœ¬ç®—æ³•ä¹¦ã€‹","slug":"algorithms/è¯»ä¹¦ç¬”è®°-ã€Šæˆ‘çš„ç¬¬ä¸€æœ¬ç®—æ³•ä¹¦ã€‹","date":"2021-04-01T10:18:21.452Z","updated":"2021-04-01T10:18:21.453Z","comments":true,"path":"2021/04/01/algorithms/è¯»ä¹¦ç¬”è®°-ã€Šæˆ‘çš„ç¬¬ä¸€æœ¬ç®—æ³•ä¹¦ã€‹/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/algorithms/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-%E3%80%8A%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E6%9C%AC%E7%AE%97%E6%B3%95%E4%B9%A6%E3%80%8B/","excerpt":"","text":"ç¬¬ä¸€ç« ï¼šæ•°æ®ç»“æ„ é“¾è¡¨ ç‰¹æ€§ å‘ˆçº¿æ€§æ’åˆ—çš„æ•°æ®ç»“æ„ï¼Œå…ƒç´ ä¸­æœ‰å­—æ®µæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´  å†…å­˜ å†…å­˜ç©ºé—´ä¸è¿ç»­ æ—¶é—´å¤æ‚åº¦ åˆ é™¤ï¼š ç›´æ¥åœ¨æœ€åæŠŠæŒ‡å‘è¢«åˆ é™¤çš„å…ƒç´ æ”¹ä¸ºæŒ‡å‘è¢«åˆ é™¤çš„ä¸‹ä¸€ä¸ªå…ƒç´ ä¿®æ”¹å³å¯ æ—¶é—´å¤æ‚åº¦ï¼šO(1) æ·»åŠ ï¼š ç›´æ¥åœ¨å½“å‰åˆ—è¡¨çš„æœ€åçš„å…ƒç´ çš„æŒ‡å‘å¦ä¸€ä¸ªå…ƒç´ å³å¯ æ—¶é—´å¤æ‚åº¦ï¼šO(1) æŸ¥è¯¢ï¼š éœ€è¦ä»æœ€å¼€å§‹çš„å…ƒç´ æŸ¥è¯¢ æ—¶é—´å¤æ‚åº¦ï¼šO(n) æ‰©å±• å¾ªç¯é“¾è¡¨ï¼Œæœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ æŒ‡å‘å¼€å¤´çš„å…ƒç´  æ¯ä¸ªå…ƒç´ æœ‰ä¸¤ä¸ªæŒ‡å‘ï¼Œåˆ†åˆ«æŒ‡å‘å‰ä¸€ä¸ªå…ƒç´ å’Œåä¸€ä¸ªå…ƒç´  æ•°ç»„ ç‰¹æ€§ å‘ˆçº¿æ€§æ’åˆ—çš„æ•°æ®ç»“æ„ï¼Œå…ƒç´ æœ‰ä¸‹æ ‡ å†…å­˜ å…ƒç´ åœ¨å†…å­˜ä¸­æ˜¯è¿ç»­çš„ æ—¶é—´å¤æ‚åº¦ æ·»åŠ ï¼š é¦–å…ˆéœ€è¦åœ¨æœ«å°¾å¢åŠ éœ€è¦çš„å­˜å‚¨ç©ºé—´ï¼ŒæŠŠéœ€è¦æ·»åŠ çš„ä½ç½®ä»¥åŠä»¥åçš„å…ƒç´ çš„ä¸‹æ ‡å…¨éƒ¨+1ï¼ŒæŠŠéœ€è¦æ·»åŠ çš„ä½ç½®æ”¾è¿›æ–°çš„å…ƒç´  æ—¶é—´å¤æ‚åº¦ï¼šO(n) åˆ é™¤ï¼š ä¾æ­¤æŠŠéœ€è¦åˆ é™¤çš„ä½ç½®çš„ä»¥åçš„å…ƒç´ çš„ä¸‹æ ‡-1 æ—¶é—´å¤æ‚åº¦ï¼šO(n) æŸ¥è¯¢ï¼š æ ¹æ®ä¸‹æ ‡ç›´æ¥éšæœºè®¿é—® æ—¶é—´å¤æ‚åº¦ï¼šO(1) æ ˆ ç‰¹æ€§ å‘ˆçº¿æ€§æ’åˆ—çš„æ•°æ®ç»“æ„ï¼›åè¿›å…ˆå‡ºLast In First Outï¼Œç®€ç§° LIFO pushï¼ˆå…¥æ ˆï¼‰ï¼Œpopï¼ˆå‡ºæ ˆï¼‰ æ—¶é—´å¤æ‚åº¦ å…¥æ ˆå’Œå‡ºæ ˆï¼Œæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ï¼šO(1) é˜Ÿåˆ— ç‰¹æ€§ å‘ˆçº¿æ€§æ’åˆ—çš„æ•°æ®ç»“æ„ï¼›å…ˆè¿›å…ˆå‡ºFirst In First Outï¼Œç®€ç§°FIFO å…¥é˜Ÿï¼Œå‡ºé˜Ÿ æ—¶é—´å¤æ‚åº¦ å…¥é˜Ÿå’Œå‡ºé˜Ÿçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ï¼šO(1) å“ˆå¸Œè¡¨ ç‰¹æ€§ å“ˆå¸Œè¡¨å­˜å‚¨çš„æ˜¯ç”±é”®ï¼ˆkeyï¼‰å’Œå€¼ï¼ˆvalueï¼‰ç»„ æˆçš„æ•°æ® å¦‚æœåœ¨hashå€¼ä¸å†²çªæ—¶ï¼Œå“ˆå¸Œè¡¨çš„æ¯ä¸ªæ¡¶éƒ½åªä¿å­˜ä¸€ä¸ªkeyï¼›å¦‚æœhashå€¼å†²çªäº†ï¼Œåˆ™ä¼šå˜æˆé“¾è¡¨å­˜å‚¨ å…ˆç”¨keyè®¡ç®—hashå€¼ï¼Œå°†å¾—åˆ°çš„å“ˆå¸Œå€¼é™¤ä»¥æ•°ç»„çš„é•¿åº¦ï¼Œæ±‚å¾—å…¶ä½™æ•°ã€å°±æ‰¾åˆ°äº†å­˜å‚¨ä½ç½®ã€‚è¿™æ ·çš„æ±‚ä½™è¿ç®—å«ä½œâ€œmod è¿ç®—â€ å¦‚æœä¸¤ä¸ªkeyçš„hashå€¼æ±‚ä½™åæ‰¾åˆ°çš„å­˜å‚¨ä½ç½®å·²ç»æœ‰å€¼ï¼Œè¿™ç§å­˜å‚¨ä½ç½®é‡å¤äº†çš„æƒ…å†µä¾¿å«ä½œâ€œå†²çªâ€ã€‚é‡åˆ°è¿™ç§æƒ…å†µï¼Œå¯ä½¿ç”¨é“¾è¡¨åœ¨å·²æœ‰æ•°æ®çš„åé¢ ç»§ç»­å­˜å‚¨æ–°çš„æ•°æ® æ—¶é—´å¤æ‚åº¦ å“ˆå¸Œè¡¨çš„æ—¶é—´å¤æ‚åº¦ä¸hashç®—æ³•æœ‰å…³ å¦‚æœhashå€¼ä¸ä¼šå†²çªï¼ˆç†æƒ³æƒ…å†µï¼‰ï¼Œåˆ™æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤ã€æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ï¼šO(1) å¦‚æœhashå€¼å…¨éƒ¨ä¸€è‡´ï¼Œåˆ™hashè¡¨å…¶å®å°±æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿä¸é“¾è¡¨ä¸€è‡´ è¡¥å……è¯´æ˜ åœ¨å­˜å‚¨æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘ç”Ÿå†²çªï¼Œå¯ä»¥åˆ©ç”¨é“¾è¡¨åœ¨å·²æœ‰æ•°æ®çš„åé¢æ’å…¥æ–°æ•°æ® æ¥è§£å†³å†²çªï¼›è¿™ç§æ–¹æ³•è¢«ç§°ä¸ºâ€œé“¾åœ°å€æ³•â€ã€‚ é™¤äº†é“¾åœ°å€æ³•ä»¥å¤–ï¼Œè¿˜æœ‰å‡ ç§è§£å†³å†²çªçš„æ–¹æ³•ã€‚ å…¶ä¸­ï¼Œåº”ç”¨è¾ƒä¸ºå¹¿æ³›çš„æ˜¯â€œå¼€æ”¾åœ°å€æ³•â€ã€‚è¿™ç§æ–¹æ³•æ˜¯æŒ‡å½“å†²çªå‘ç”Ÿæ—¶ï¼Œç«‹åˆ»è®¡ç®—å‡ºä¸€ä¸ªå€™è¡¥åœ°å€ï¼ˆæ•°ç»„ä¸Šçš„ä½ç½®ï¼‰å¹¶å°†æ•° æ®å­˜è¿›å»ã€‚å¦‚æœä»ç„¶æœ‰å†²çªï¼Œä¾¿ç»§ç»­è®¡ç®—ä¸‹ä¸€ä¸ªå€™è¡¥åœ°å€ï¼Œç›´åˆ°æœ‰ç©ºåœ°å€ä¸ºæ­¢ã€‚å¯ä»¥é€šè¿‡å¤šæ¬¡ä½¿ç”¨å“ˆå¸Œå‡½æ•°æˆ–â€œçº¿æ€§æ¢æµ‹æ³•â€ç­‰æ–¹æ³•è®¡ç®—å€™è¡¥åœ°å€ã€‚ å † ç‰¹æ€§ å †æ˜¯ä¸€ç§å›¾çš„æ ‘å½¢ç»“æ„ï¼Œè¢«ç”¨äºå®ç°â€œä¼˜å…ˆé˜Ÿåˆ—â€ï¼ˆpriority queuesï¼‰ã€‚ ä¼˜å…ˆé˜Ÿåˆ—æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå¯ä»¥è‡ªç”±æ·»åŠ æ•°æ®ï¼Œä½†å–å‡ºæ•°æ®æ—¶è¦ä»æœ€å°å€¼å¼€å§‹æŒ‰é¡º åºå–å‡ºã€‚ åœ¨å †çš„æ ‘å½¢ç»“æ„ä¸­ï¼Œå„ä¸ªé¡¶ç‚¹è¢«ç§°ä¸ºâ€œç»“ç‚¹â€ï¼ˆnodeï¼‰ï¼Œæ•°æ®å°±å­˜å‚¨åœ¨è¿™äº›ç»“ç‚¹ä¸­ã€‚ å †ä¸­çš„èŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹çš„æ’åºä¸ºä»ä¸Šåˆ°ä¸‹ï¼ŒåŒä¸€è¡Œåˆ™ä»å·¦åˆ°å³ã€‚ å †ä¸­å­˜å‚¨æ•°æ®çš„è§„åˆ™ï¼šå­èŠ‚ç‚¹å¿…é¡»å¤§äºçˆ¶èŠ‚ç‚¹ æ—¶é—´å¤æ‚åº¦ æ·»åŠ æ•°æ® å¢åŠ èŠ‚ç‚¹æ—¶åœ¨æœ€ä¸‹é¢ä¸€è¡Œçš„æœ€å·¦è¾¹å¢åŠ ï¼Œå¦‚æœæœ€ä¸‹é¢çš„ä¸€è¡Œæ²¡æœ‰ä½ç½®åˆ™å¢åŠ æ–°çš„ä¸€è¡Œ å¦‚æœå¢åŠ çš„æ•°æ®æ¯”çˆ¶èŠ‚ç‚¹çš„æ•°å­—å°ï¼Œåˆ™ä¸çˆ¶èŠ‚ç‚¹äº¤æ¢ä½ç½®ï¼Œé‡å¤æ­¤æ­¥éª¤ç›´åˆ°æ¯”çˆ¶èŠ‚ç‚¹å¤§æˆ–è€…æ²¡æœ‰çˆ¶èŠ‚ç‚¹ä¸ºæ­¢ æ—¶é—´å¤æ‚åº¦ï¼šO(logn) å–å‡ºæ•°æ® å–å‡ºæ•°æ®æ°¸è¿œæ˜¯å–æœ€ä¸Šé¢èŠ‚ç‚¹çš„æ•°æ® æœ€ä¸Šé¢èŠ‚ç‚¹çš„æ•°æ®è¢«å–èµ°ä¹‹åï¼Œéœ€è¦é‡æ–°è°ƒæ•´ é‡æ–°è°ƒæ•´æ—¶ï¼Œéœ€è¦æŠŠæœ€åçš„æ•°æ®ï¼ˆå³æœ€ä¸‹é¢ä¸€è¡Œæœ€å³è¾¹çš„èŠ‚ç‚¹ï¼‰ç§»åŠ¨åˆ°æœ€ä¸Šé¢ ç„¶åä¸æœ€ä¸Šé¢çš„ä¸¤ä¸ªå­èŠ‚ç‚¹åšæ¯”è¾ƒï¼Œå¦‚æœæ•°å­—å°äºä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ™è°ƒæ•´å®Œæˆ å¦‚æœæœ€ä¸Šé¢çš„æ•°æ®å¤§äºå­èŠ‚ç‚¹çš„æ•°æ®ï¼Œåˆ™ä¸è¾ƒå°çš„å­èŠ‚ç‚¹çš„ä½ç½®è¿›è¡Œäº¤æ¢ï¼Œé‡å¤æ­¤æ“ä½œç›´åˆ°æ‰€æœ‰çˆ¶èŠ‚ç‚¹å°äºå­èŠ‚ç‚¹ä¸ºæ­¢ æ—¶é—´å¤æ‚åº¦:O(logn) äºŒå‰æŸ¥æ‰¾æ ‘ ç‰¹æ€§ äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆåˆå«ä½œäºŒå‰æœç´¢æ ‘æˆ–äºŒå‰æ’åºæ ‘ï¼‰æ˜¯ä¸€ç§é‡‡ç”¨äº†å›¾çš„æ ‘å½¢ç»“æ„çš„æ•°æ®ç»“æ„ æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ æ¯ä¸ªèŠ‚ç‚¹çš„å€¼å¤§äºå…¶å·¦å­æ ‘çš„ä»»æ„èŠ‚ç‚¹çš„å€¼ æ¯ä¸ªèŠ‚ç‚¹çš„å€¼å°äºå…¶å³å­æ ‘çš„ä»»æ„èŠ‚ç‚¹çš„å€¼ æ ¹æ®ä¸Šé¢çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“å¦‚æœæƒ³è¦æŸ¥æ‰¾æœ€å°å€¼ï¼Œåˆ™åœ¨å·¦è¾¹çš„æœ€æœ«ç«¯ æ—¶é—´å¤æ‚åº¦ æ·»åŠ æ•°æ® ä»é¡¶ç«¯å¼€å§‹æŸ¥æ‰¾æ·»åŠ ä½ç½® å¦‚æœæ·»åŠ çš„å€¼å¤§äºé¡¶ç«¯çš„å€¼ï¼Œåˆ™å¾€å³ç§»ï¼›å°äºå®ƒåˆ™å¾€å·¦ç§» æ—¶é—´å¤æ‚åº¦ï¼šO(logn) åˆ é™¤æ•°æ® å¦‚æœåˆ é™¤çš„èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥åˆ é™¤æ­¤èŠ‚ç‚¹ å¦‚æœåˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ™åˆ é™¤æ­¤èŠ‚ç‚¹åæŠŠå­èŠ‚ç‚¹ç§»åˆ°å½“å‰çš„èŠ‚ç‚¹ å¦‚æœåˆ é™¤çš„èŠ‚ç‚¹æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ™åˆ é™¤æ­¤èŠ‚ç‚¹åæŠŠå·¦è¾¹å­èŠ‚ç‚¹çš„æœ€å³ç«¯ç§»åˆ°å½“å‰èŠ‚ç‚¹ï¼ˆä¹Ÿå¯ä»¥æŠŠå³è¾¹å­èŠ‚ç‚¹çš„æœ€å·¦ç«¯ç§»åˆ°å½“å‰èŠ‚ç‚¹ï¼‰ ä¸Šé¢çš„ä¸€å¥å¯ä»¥ç†è§£ä¸ºï¼šæŠŠå°äºè¢«åˆ é™¤çš„èŠ‚ç‚¹çš„æœ€å¤§å€¼ç§»åˆ°åˆ é™¤çš„èŠ‚ç‚¹ï¼›æˆ–è€…æŠŠå¤§äºè¢«åˆ é™¤èŠ‚ç‚¹çš„æœ€å°å€¼ç§»åˆ°åˆ é™¤èŠ‚ç‚¹ å¦‚æœç§»åŠ¨çš„èŠ‚ç‚¹è¿˜æœ‰å­èŠ‚ç‚¹ï¼Œä¹ŸæŒ‰ç…§åŒæ ·çš„æ–¹å¼ç§»åŠ¨ æ—¶é—´å¤æ‚åº¦ï¼šO(logn) æŸ¥æ‰¾æ•°æ® ä»é¡¶ç«¯å¼€å§‹æŸ¥æ‰¾ å¦‚æœå¤§äºæŸ¥æ‰¾èŠ‚ç‚¹çš„å€¼ï¼Œåˆ™å‘å³ç§»ï¼›å¦‚æœå°äºæŸ¥æ‰¾èŠ‚ç‚¹çš„å€¼ï¼Œåˆ™å‘å·¦ç§»ï¼›å¾ªç¯æ­¤æ“ä½œ æ—¶é—´å¤æ‚åº¦ï¼šO(logn) æ‰©å±• å…³äºæ—¶é—´å¤æ‚åº¦ å¦‚æœæ•°çš„å½¢çŠ¶æ¯”è¾ƒå‡è¡¡ï¼ŒæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(logn) å¦‚æœä¸å‡è¡¡æç«¯æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼ŒæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(n) ä»¥äºŒå‰æŸ¥æ‰¾æ ‘ä¸ºåŸºç¡€æ‰©å±•çš„æ•°æ®ç»“æ„ â€œå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘â€ï¼šè¿™ç§æ•°æ®ç»“æ„å¯ä»¥ä¿®æ­£å½¢çŠ¶ä¸å‡è¡¡çš„æ ‘ï¼Œè®©å…¶å§‹ç»ˆä¿æŒå‡è¡¡å½¢æ€ï¼Œä»¥æé«˜æŸ¥æ‰¾æ•ˆç‡ â€œB æ ‘â€ï¼šäºŒå‰æŸ¥æ‰¾æ ‘ä¸­ä¸€ä¸ªç»“ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå­ç»“ç‚¹ï¼Œå¦‚æœæˆ‘ä»¬æŠŠå­ç»“ç‚¹æ•°æ‰©å±•ä¸º mï¼ˆm ä¸ºé¢„å…ˆè®¾å®šå¥½çš„å¸¸æ•°ï¼‰ã€‚åƒè¿™ç§å­ç»“ç‚¹æ•°å¯ä»¥è‡ªç”±è®¾å®šï¼Œå¹¶ä¸”å½¢çŠ¶å‡è¡¡çš„æ ‘ä¾¿æ˜¯ B æ ‘ ç¬¬äºŒç« ï¼šæ’åº å†’æ³¡æ’åº ç®—æ³•é‡Šä¹‰ å†’æ³¡æ’åºå°±æ˜¯é‡å¤â€œä»åºåˆ—å³è¾¹å¼€å§‹æ¯”è¾ƒç›¸é‚»ä¸¤ä¸ªæ•°å­—çš„å¤§å°ï¼Œå†æ ¹æ®ç»“æœäº¤æ¢ä¸¤ä¸ªæ•°å­— çš„ä½ç½®â€è¿™ä¸€æ“ä½œçš„ç®—æ³•ã€‚ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ•°å­—ä¼šåƒæ³¡æ³¡ä¸€æ ·ï¼Œæ…¢æ…¢ä»å³å¾€å·¦â€œæµ®â€åˆ°åºåˆ—çš„ é¡¶ç«¯ï¼Œæ‰€ä»¥è¿™ä¸ªç®—æ³•æ‰è¢«ç§°ä¸ºâ€œå†’æ³¡æ’åºâ€ã€‚ æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²) åœ¨å†’æ³¡æ’åºä¸­ï¼š ç¬¬ 1 è½®éœ€è¦æ¯”è¾ƒ n -1 æ¬¡ ç¬¬ 2 è½®éœ€è¦æ¯”è¾ƒ n -2 æ¬¡ ç¬¬ n -1 è½®éœ€ è¦æ¯”è¾ƒ 1 æ¬¡ å› æ­¤ï¼Œæ€»çš„æ¯”è¾ƒæ¬¡æ•°ä¸º (n -1) +(n -2) +â€¦+1 â‰ˆ nÂ² /2ã€‚è¿™ä¸ªæ¯”è¾ƒæ¬¡æ•°æ’å®šä¸º è¯¥æ•°å€¼ï¼Œå’Œè¾“å…¥æ•°æ®çš„æ’åˆ—é¡ºåºæ— å…³ã€‚ Javaä»£ç å®ç° å†’æ³¡æ’åº é€‰æ‹©æ’åº ç®—æ³•é‡Šä¹‰ é€‰æ‹©æ’åºå°±æ˜¯é‡å¤â€œä»å¾…æ’åºçš„æ•°æ®ä¸­å¯»æ‰¾æœ€å°å€¼ï¼Œå°†å…¶ä¸åºåˆ—æœ€å·¦è¾¹çš„æ•°å­—è¿›è¡Œäº¤æ¢â€ è¿™ä¸€æ“ä½œçš„ç®—æ³•ã€‚ åœ¨åºåˆ—ä¸­å¯»æ‰¾æœ€å°å€¼æ—¶ä½¿ç”¨çš„æ˜¯çº¿æ€§æŸ¥æ‰¾ã€‚ æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²) é€‰æ‹©æ’åºä½¿ç”¨äº†çº¿æ€§æŸ¥æ‰¾æ¥å¯»æ‰¾æœ€å°å€¼ï¼Œå› æ­¤åœ¨ ç¬¬ 1 è½®ä¸­éœ€è¦æ¯”è¾ƒ n - 1 ä¸ªæ•°å­— ç¬¬ 2 è½®éœ€è¦æ¯”è¾ƒ n - 2 ä¸ªæ•°å­— åˆ°ç¬¬ n - 1 è½®çš„æ—¶å€™å°±åªéœ€æ¯”è¾ƒ 1 ä¸ªæ•°å­— å› æ­¤ï¼Œæ€»çš„æ¯”è¾ƒæ¬¡æ•°ä¸å†’æ³¡æ’åºçš„ç›¸åŒï¼Œéƒ½æ˜¯(n-1)+(n-2)+â€¦+1 â‰ˆ n2/2 æ¬¡ã€‚ Javaä»£ç å®ç° é€‰æ‹©æ’åº æ’å…¥æ’åº ç®—æ³•é‡Šä¹‰ æ’å…¥æ’åºæ˜¯ä¸€ç§ä»åºåˆ—å·¦ç«¯å¼€å§‹ä¾æ¬¡å¯¹æ•°æ®è¿›è¡Œæ’åºçš„ç®—æ³•ã€‚ åœ¨æ’åºè¿‡ç¨‹ä¸­ï¼Œå·¦ä¾§çš„æ•°æ®é™†ç»­å½’ä½ï¼Œè€Œå³ä¾§ç•™ä¸‹çš„å°±æ˜¯è¿˜æœªè¢«æ’åºçš„æ•°æ®ã€‚ æ’å…¥æ’åºçš„æ€è·¯å°±æ˜¯ä»å³ä¾§çš„æœªæ’åºåŒºåŸŸå†…å–å‡ºä¸€ä¸ªæ•°æ®ï¼Œç„¶åå°†å®ƒæ’å…¥åˆ°å·²æ’åºåŒºåŸŸå†…åˆé€‚çš„ä½ç½®ä¸Šã€‚ æ—¶é—´å¤æ‚åº¦ï¼šO(nÂ²) Javaä»£ç å®ç° æ’å…¥æ’åº å †æ’åº ç®—æ³•é‡Šä¹‰ å †æ’åºçš„ç‰¹ç‚¹æ˜¯åˆ©ç”¨äº†æ•°æ®ç»“æ„ä¸­çš„å † é¦–å…ˆï¼Œåœ¨å †ä¸­å­˜å‚¨æ‰€æœ‰çš„æ•°æ®ï¼Œå¹¶æŒ‰é™åºæ¥æ„å»ºå † ç„¶åä»å †ä¸­å–å‡ºæ•°æ®ï¼Œå¹¶æŠŠå–å‡ºçš„æ•°æ®æ”¾åœ¨æœ€å³è¾¹çš„ç©ºä½ç½® æ—¶é—´å¤æ‚åº¦ï¼šO(nlogn) å †æ’åºä¸€å¼€å§‹éœ€è¦å°† n ä¸ªæ•°æ®å­˜è¿›å †é‡Œï¼Œæ‰€éœ€æ—¶é—´ä¸º O(nlogn) æ¯è½®å–å‡ºæœ€å¤§çš„æ•°æ®å¹¶é‡æ„å †æ‰€éœ€è¦çš„æ—¶é—´ä¸º O(logn) ç”±äºæ€»å…±æœ‰ n è½®ï¼Œæ‰€ä»¥é‡æ„åæ’åºçš„æ—¶é—´ä¹Ÿæ˜¯ O(nlogn) å› æ­¤ï¼Œæ•´ä½“æ¥çœ‹å †æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸º O(nlogn) Javaä»£ç å®ç° æš‚æ—  å½’å¹¶æ’åº ç®—æ³•é‡Šä¹‰ å½’å¹¶æ’åºç®—æ³•ä¼šæŠŠåºåˆ—åˆ†æˆé•¿åº¦ç›¸åŒçš„ä¸¤ä¸ªå­åºåˆ—ï¼Œå½“æ— æ³•ç»§ç»­å¾€ä¸‹åˆ†æ—¶(ä¹Ÿå°±æ˜¯æ¯ä¸ªå­åºåˆ—ä¸­åªæœ‰ä¸€ä¸ªæ•°æ®æ—¶)ï¼Œå°±å¯¹å­åºåˆ—è¿›è¡Œå½’å¹¶ã€‚ å½’å¹¶æŒ‡çš„æ˜¯æŠŠä¸¤ä¸ªæ’å¥½åºçš„å­åºåˆ—åˆå¹¶æˆä¸€ä¸ªæœ‰åºåºåˆ—ã€‚ è¯¥æ“ä½œä¼šä¸€ç›´é‡å¤æ‰§è¡Œï¼Œç›´åˆ°æ‰€æœ‰å­åºåˆ—éƒ½å½’å¹¶ä¸ºä¸€ä¸ªæ•´ä½“ä¸ºæ­¢ã€‚ æ—¶é—´å¤æ‚åº¦:O(nlogn) æŠŠæ•°ç»„æ‹†åˆ†æˆä¸å¯åˆ†å‰²çš„æœ€å°å•å…ƒçš„æ•°ç»„ï¼Œæ—¶é—´å¤æ‚åº¦O(n) ä¾æ¬¡æŠŠæ‰€æœ‰æ•°ç»„è¿›è¡Œåˆå¹¶æ’åºï¼Œæ¯ä¸€è½®çš„æ¯”è¾ƒæ¬¡æ•°ä¸ºO(n)ï¼›éœ€è¦è¿›è¡Œlognè½® æœ€ç»ˆçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(nlogn) Javaä»£ç å®ç° å½’å¹¶æ’åº å¿«é€Ÿæ’åº ç®—æ³•é‡Šä¹‰ å¿«é€Ÿæ’åºç®—æ³•é¦–å…ˆä¼šåœ¨åºåˆ—ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªåŸºå‡†å€¼ï¼ˆpivotï¼‰ ç„¶åå°†é™¤äº†åŸºå‡†å€¼ä»¥å¤–çš„æ•°åˆ†ä¸ºâ€œæ¯”åŸºå‡†å€¼å°çš„æ•°â€å’Œâ€œæ¯”åŸºå‡†å€¼å¤§çš„æ•°â€è¿™ä¸¤ä¸ªç±»åˆ«ï¼Œå†å°†å…¶æ’åˆ—æˆä»¥ä¸‹å½¢å¼ã€‚ [ æ¯”åŸºå‡†å€¼å°çš„æ•° ] åŸºå‡†å€¼ [ æ¯”åŸºå‡†å€¼å¤§çš„æ•° ] æ¥ç€ï¼Œå¯¹ä¸¤ä¸ªâ€œ[ ]â€ä¸­çš„æ•°æ®è¿›è¡Œæ’åºä¹‹åï¼Œæ•´ä½“çš„æ’åºä¾¿å®Œæˆäº†ã€‚å¯¹â€œ[ ]â€é‡Œé¢çš„æ•°æ®è¿›è¡Œæ’åºæ—¶åŒæ ·ä¹Ÿä¼šä½¿ç”¨å¿«é€Ÿæ’åºã€‚ æ—¶é—´å¤æ‚åº¦ï¼šO(nlogn) æ¯ä¸€è½®æ¯”è¾ƒçš„æ¬¡æ•°ä¸ºnæ¬¡ï¼Œæ—¶é—´å¤æ‚åº¦O(n) éœ€è¦è¿›è¡Œlognè½®çš„æ¯”è¾ƒ æœ€ç»ˆçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(nlogn) Javaä»£ç å®ç° å¿«é€Ÿæ’åº æ‰©å±• åŸºå‡†å€¼çº¦æ¥è¿‘æ•°ç»„çš„å¹³å‡å€¼ï¼Œæ’åºçš„é€Ÿåº¦è¶Šå¿«ï¼›åŸºå‡†å€¼ä¸€èˆ¬éƒ½ä½¿ç”¨ç¬¬ä¸€ä¸ªæ•°å­— ç¬¬ä¸‰ç« ï¼šæ•°ç»„çš„æŸ¥æ‰¾ çº¿æ€§æŸ¥æ‰¾ ç‰¹æ€§ éå†æ•´ä¸ªæ•°ç»„ï¼Œé€ä¸ªè¿›è¡Œæ¯”è¾ƒï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ æ—¶é—´å¤æ‚åº¦ï¼šO(n) Javaä»£ç å®ç° çº¿æ€§æŸ¥æ‰¾ äºŒåˆ†æŸ¥æ‰¾ ç‰¹æ€§ åªèƒ½æŸ¥æ‰¾å·²ç»æ’å¥½åºçš„æ•°ç»„ æ¯æ¬¡æŸ¥æ‰¾å–ä¸­é—´ä½ç½®çš„å€¼ä¸éœ€è¦æŸ¥æ‰¾çš„æ•°å­—æ¯”è¾ƒï¼Œå¦‚æœä¸­é—´å€¼å¤§äºå¾…æŸ¥æ‰¾æ•°æ®ï¼Œåˆ™ç»§ç»­åœ¨ä¸­é—´å€¼å·¦è¾¹çš„æ•°ç»„è¿›è¡ŒæŸ¥æ‰¾ï¼›åä¹‹äº¦ç„¶ æ—¶é—´å¤æ‚åº¦ O(logn) æ¯ä¸€æ¬¡æŸ¥æ‰¾éƒ½ä¼šæŠŠå¾…æŸ¥æ‰¾çš„èŒƒå›´ç¼©å°ä¸€åŠï¼Œç›´åˆ°ç»“æŸä¸ºæ­¢ æŸ¥æ‰¾éœ€è¦lognè½®ï¼Œæ¯ä¸€è½®æ¯”è¾ƒ1æ¬¡ï¼›æ‰€ä»¥æ—¶é—´å¤æ‚åº¦ä¸ºO(logn) Javaä»£ç å®ç° äºŒåˆ†æŸ¥æ‰¾ ç¬¬å››ç« ï¼šå›¾çš„æœç´¢ å›¾çš„å®šä¹‰ è®¡ç®—æœºç§‘å­¦æˆ–ç¦»æ•£æ•°å­¦ä¸­è¯´çš„â€œå›¾â€æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š ä¸Šå›¾ä¸­çš„åœ†åœˆå«ä½œâ€œé¡¶ç‚¹â€(ä¹Ÿå«â€œç»“ç‚¹â€)ï¼Œè¿æ¥é¡¶ç‚¹çš„çº¿å«ä½œâ€œè¾¹â€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”±é¡¶ç‚¹å’Œè¿æ¥æ¯å¯¹é¡¶ç‚¹çš„è¾¹æ‰€æ„æˆçš„å›¾å½¢å°±æ˜¯å›¾ã€‚å›¾å¯ä»¥è¡¨ç¤ºå„ç§å…³ç³» åŠ æƒå›¾ æˆ‘ä»¬å¯ä»¥ç»™è¾¹åŠ ä¸Šä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼å«ä½œè¾¹çš„â€œæƒé‡â€æˆ–è€…â€œæƒâ€ï¼ŒåŠ äº†æƒçš„å›¾è¢«ç§°ä¸ºâ€œåŠ æƒå›¾â€ã€‚ æ²¡æœ‰æƒçš„è¾¹åªèƒ½è¡¨ç¤ºä¸¤ä¸ª é¡¶ç‚¹çš„è¿æ¥çŠ¶æ€ï¼Œè€Œæœ‰æƒçš„è¾¹å°±å¯ä»¥è¡¨ç¤ºé¡¶ç‚¹ä¹‹é—´çš„â€œè¿æ¥ç¨‹åº¦â€ã€‚ æ‰€è°“â€œç¨‹åº¦â€åœ¨ä¸åŒçš„åœºæ™¯æ„æ€ä¹Ÿä¸ä¸€æ ·ï¼š åœ°é“çº¿è·¯å›¾ä¸¤ç«™ä¹‹é—´çš„æƒæ˜¯ä¸¤ç«™ä¹‹é—´çš„è·ç¦» åŒæ ·æ˜¯åœ°é“çº¿è·¯å›¾ï¼Œä¸¤ç«™ä¹‹å‰çš„æƒä¹Ÿå¯ä»¥æ˜¯ä¸¤ç«™ä¹‹é—´çš„æ—¶é—´ å¦‚æœæ˜¯é«˜é“ç«™çº¿è·¯å›¾ï¼Œä¸¤ç«™ä¹‹é—´çš„æƒä¹Ÿå¯ä»¥è¡¨ç¤ºä¸¤ç«™ä¹‹é—´çš„ä¹˜è½¦è´¹ æœ‰å‘å›¾ å½“æˆ‘ä»¬æƒ³åœ¨è·¯çº¿å›¾ä¸­è¡¨ç¤ºè¯¥è·¯çº¿åªèƒ½å•å‘è¡Œé©¶æ—¶ï¼Œå°±å¯ä»¥ç»™è¾¹åŠ ä¸Šç®­å¤´ï¼Œè€Œè¿™æ ·çš„å›¾å°±å« ä½œâ€œæœ‰å‘å›¾â€ã€‚ å’Œæ— å‘å›¾ä¸€æ ·ï¼Œæœ‰å‘å›¾ä¹Ÿå¯ä»¥åœ¨è¾¹ä¸Šæ·»åŠ æƒé‡ï¼Œè€Œä¸”æ ¹æ®æ–¹å‘çš„ä¸åŒï¼Œæƒé‡ä¹Ÿä¸ä¸€æ ·ã€‚ å¦‚ä¸‹å›¾ä¸­ï¼Œå¦‚æœæƒé‡è¡¨ç¤ºèŠ±è´¹æ—¶é—´ï¼Œåˆ™Bç‚¹åˆ°Cç‚¹æ˜¯ä¸‹å¡è·¯ï¼Œåè¿‡æ¥Cåˆ°Bå°±æ˜¯ä¸Šå¡è·¯ã€‚ å›¾èƒ½ç»™æˆ‘ä»¬å¸¦æ¥å“ªäº›ä¾¿åˆ© å‡è®¾å›¾ä¸­æœ‰ä¸¤ä¸ªé¡¶ç‚¹ s å’Œ tï¼Œè€Œæˆ‘ä»¬è®¾è®¡å‡ºäº†ä¸€ç§ç®—æ³•ï¼Œ å¯ä»¥æ‰¾åˆ°â€œä» s åˆ° t çš„æƒé‡ä¹‹å’Œæœ€å°â€çš„é‚£æ¡è·¯å¾„ï¼Œå¦‚ï¼š å¯»æ‰¾è®¡ç®—æœºç½‘ç»œä¸­é€šä¿¡æ—¶é—´æœ€çŸ­çš„è·¯å¾„ å¯»æ‰¾è·¯çº¿å›¾ä¸­è€—æ—¶æœ€çŸ­çš„è·¯å¾„ å¯»æ‰¾è·¯çº¿å›¾ä¸­æœ€çœä¹˜è½¦è´¹çš„è·¯å¾„ å›¾åœ¨ä»£ç ä¸­å¦‚ä½•å®ç° å›¾æ˜¯ç”¨æ¥è¡¨ç¤ºèŠ‚ç‚¹ä¸èŠ‚ç‚¹çš„å…³ç³»çš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨Mapæ¥å®ç°å›¾ æœ‰å‘å›¾ï¼Œå¦‚ä¸Šé¢å›¾ä¸¤ä¸ªèŠ‚ç‚¹Aå’ŒBã€mapä¸­keyä¸ºAçš„å€¼æœ‰Bï¼Œè€Œkeyä¸ºBçš„å€¼æ²¡æœ‰Aï¼Œå°±å¯ä»¥è¡¨ç¤ºæ–¹å‘ åŠ æƒå›¾ï¼ŒåŒæ ·é€‚ç”¨Mapå®ç°ï¼ŒåŒºåˆ«æ˜¯åœ¨valueä¸­æ—¢åŒ…å«ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒåˆåŒ…å«æƒé‡ä¿¡æ¯åŠ æƒå›¾Javaå®ç° å›¾çš„æœç´¢ å¹¿åº¦ä¼˜å…ˆæœç´¢ å‡è®¾æˆ‘ä»¬ä¸€å¼€å§‹ä½äºæŸä¸ªé¡¶ç‚¹(å³èµ·ç‚¹)ï¼Œæ­¤æ—¶å¹¶ä¸çŸ¥é“å›¾çš„æ•´ä½“ç»“æ„ï¼Œè€Œæˆ‘ä»¬çš„ç›®çš„æ˜¯ä»èµ·ç‚¹å¼€å§‹é¡ºç€è¾¹æœç´¢ï¼Œç›´åˆ°åˆ°è¾¾æŒ‡å®šé¡¶ç‚¹(å³ç»ˆç‚¹)ã€‚ åœ¨æ­¤è¿‡ç¨‹ä¸­æ¯èµ°åˆ°ä¸€ä¸ªé¡¶ç‚¹ï¼Œå°±ä¼šåˆ¤æ–­ä¸€æ¬¡å®ƒæ˜¯å¦ä¸ºç»ˆç‚¹ã€‚å¹¿åº¦ä¼˜å…ˆæœç´¢ä¼šä¼˜å…ˆä»ç¦»èµ·ç‚¹è¿‘çš„é¡¶ç‚¹å¼€å§‹æœç´¢ã€‚ Javaä»£ç å®ç° å¹¿åº¦ä¼˜å…ˆæœç´¢ æ·±åº¦ä¼˜å…ˆæœç´¢ æ·±åº¦ä¼˜å…ˆæœç´¢ä¼šæ²¿ç€ä¸€æ¡è·¯å¾„ä¸æ–­å¾€ä¸‹æœç´¢ç›´åˆ°ä¸èƒ½å†ç»§ç»­ä¸ºæ­¢ï¼Œç„¶åå†æŠ˜è¿”ï¼Œå¼€å§‹æœç´¢ä¸‹ä¸€æ¡å€™è¡¥è·¯å¾„ã€‚ Javaä»£ç å®ç° æ·±åº¦ä¼˜å…ˆæœç´¢ å¹¿åº¦ä¼˜å…ˆæœç´¢å’Œæ·±åº¦ä¼˜å…ˆæœç´¢å¯¹æ¯” å¹¿åº¦ä¼˜å…ˆæœç´¢é€‰æ‹©çš„æ˜¯æœ€æ—©æˆä¸ºå€™è¡¥çš„é¡¶ç‚¹ï¼Œå› ä¸ºé¡¶ç‚¹ç¦»èµ·ç‚¹è¶Šè¿‘å°±è¶Šæ—©æˆä¸ºå€™è¡¥ï¼Œæ‰€ä»¥ä¼šä»ç¦»èµ·ç‚¹è¿‘çš„åœ°æ–¹å¼€å§‹æŒ‰é¡ºåºæœç´¢; è€Œæ·±åº¦ä¼˜å…ˆæœç´¢é€‰æ‹©çš„åˆ™æ˜¯æœ€æ–°æˆä¸ºå€™è¡¥çš„é¡¶ç‚¹ï¼Œæ‰€ä»¥ä¼šä¸€è·¯å¾€ä¸‹ï¼Œæ²¿ç€æ–°å‘ç°çš„è·¯å¾„ä¸æ–­æ·±å…¥æœç´¢ã€‚ è´å°”æ›¼ - ç¦ç‰¹ç®—æ³• è§£å†³çš„é—®é¢˜ è´å°”æ›¼ - ç¦ç‰¹(Bellman-Ford)ç®—æ³•æ˜¯ä¸€ç§åœ¨å›¾ä¸­æ±‚è§£æœ€çŸ­è·¯å¾„é—®é¢˜çš„ç®—æ³•ã€‚ æœ€çŸ­è·¯å¾„é—®é¢˜å°±æ˜¯åœ¨åŠ æƒå›¾æŒ‡å®šäº†èµ·ç‚¹å’Œç»ˆç‚¹çš„å‰æä¸‹ï¼Œå¯»æ‰¾ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„è·¯å¾„ä¸­æƒé‡æ€»å’Œæœ€å°çš„é‚£æ¡è·¯å¾„ã€‚ æ±‚è§£çš„æ­¥éª¤ é¦–å…ˆè®¾ç½®å„ä¸ªé¡¶ç‚¹çš„åˆå§‹æƒé‡ :èµ·ç‚¹ä¸º 0ï¼Œå…¶ä»–é¡¶ç‚¹ä¸ºæ— ç©·å¤§(âˆ)ï¼›è¿™ä¸ªæƒé‡çš„æ„æ€æ˜¯ä»èµ·ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„æš‚å®šå€¼ã€‚ ä»èµ·ç‚¹ï¼ˆAï¼‰å¼€å§‹éå†ï¼Œæ‰¾åˆ°å­èŠ‚ç‚¹ï¼ˆBï¼‰ï¼Œæ›´æ–°å­èŠ‚ç‚¹çš„æƒé‡ï¼šmin(Açš„æƒé‡+Aåˆ°Bè¾¹çš„æƒé‡,BèŠ‚ç‚¹æƒé‡) å¾ªç¯ä¸Šé¢çš„æ­¥éª¤ä¸€ç›´æ›´æ–°æ‰€æœ‰èŠ‚ç‚¹ æ—¶é—´å¤æ‚åº¦O(nm) å°†å›¾çš„é¡¶ç‚¹æ•°è®¾ä¸º nã€è¾¹æ•°è®¾ä¸º mã€‚ è¯¥ç®—æ³•ç»è¿‡ n è½®æ›´æ–°æ“ä½œåå°±ä¼šåœæ­¢ï¼Œè€Œåœ¨æ¯è½®æ›´æ–°æ“ä½œä¸­éƒ½éœ€è¦å¯¹å„ä¸ªè¾¹è¿›è¡Œ 1 æ¬¡ç¡®è®¤ å› æ­¤ 1 è½®æ›´æ–°æ‰€èŠ±è´¹çš„æ—¶é—´å°±æ˜¯ O(m)ï¼Œæ•´ä½“çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(nm) Javaä»£ç å®ç° è´å°”æ›¼-ç¦ç‰¹ç®—æ³• ç‹„å…‹æ–¯ç‰¹æ‹‰ç®—æ³• è§£å†³çš„é—®é¢˜ ç‹„å…‹æ–¯ç‰¹æ‹‰(Dijkstra)ç®—æ³•ä¹Ÿæ˜¯æ±‚è§£æœ€çŸ­è·¯å¾„é—®é¢˜ çš„ç®—æ³•ï¼Œä½¿ç”¨å®ƒå¯ä»¥æ±‚å¾—ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„è·¯å¾„ä¸­æƒé‡æ€»å’Œæœ€å°çš„é‚£æ¡è·¯å¾„ã€‚ æ±‚è§£çš„æ­¥éª¤ é¦–å…ˆè®¾ç½®å„ä¸ªé¡¶ç‚¹çš„åˆå§‹æƒé‡ :èµ·ç‚¹ä¸º 0ï¼Œå…¶ä»–é¡¶ç‚¹ä¸ºæ— ç©·å¤§(âˆ)ï¼›è¿™ä¸ªæƒé‡çš„æ„æ€æ˜¯ä»èµ·ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„æš‚å®šå€¼ã€‚ ä»èµ·ç‚¹å‡ºå‘ï¼Œå¯»æ‰¾å¯ä»¥ä»ç›®å‰æ‰€åœ¨çš„é¡¶ç‚¹ç›´è¾¾ä¸”å°šæœªè¢«æœç´¢è¿‡çš„é¡¶ç‚¹ã€‚ è®¡ç®—å„ä¸ªå€™è¡¥é¡¶ç‚¹çš„æƒé‡ã€‚è®¡ç®—æ–¹æ³•æ˜¯â€œç›®å‰æ‰€åœ¨é¡¶ç‚¹çš„æƒé‡+ç›®å‰æ‰€åœ¨é¡¶ç‚¹åˆ°å€™è¡¥é¡¶ç‚¹çš„æƒé‡â€ã€‚ å¦‚æœè®¡ç®—ç»“æœå°äºå€™è¡¥é¡¶ç‚¹çš„å€¼ï¼Œå°±æ›´æ–°è¿™ä¸ªå€¼ã€‚ ä»å€™è¡¥é¡¶ç‚¹ä¸­é€‰å‡ºæƒé‡æœ€å°çš„é¡¶ç‚¹ï¼Œä½œä¸ºä¸‹ä¸€ä¸ªè¢«æœç´¢çš„ç‚¹ï¼Œè¿™ä¸€ç‚¹ä¸è´å°”æ›¼-ç¦ç‰¹ç®—æ³•ä¸ä¸€æ · æ—¶é—´å¤æ‚åº¦ å°†å›¾çš„é¡¶ç‚¹æ•°è®¾ä¸º nã€è¾¹æ•°è®¾ä¸º mï¼Œé‚£ä¹ˆå¦‚æœäº‹å…ˆä¸è¿›è¡Œä»»ä½•å¤„ç†ï¼Œè¯¥ç®—æ³•çš„æ—¶ é—´å¤æ‚åº¦å°±æ˜¯ O(n2)ã€‚ ä¸è¿‡ï¼Œå¦‚æœå¯¹æ•°æ®ç»“æ„è¿›è¡Œä¼˜åŒ–ï¼Œé‚£ä¹ˆæ—¶é—´å¤æ‚åº¦å°±ä¼šå˜ä¸º O(m + nlogn)ã€‚ Javaä»£ç å®ç° ç‹„å…‹æ–¯ç‰¹æ‹‰(Dijkstra)ç®—æ³• è´å°”æ›¼ç¦ç‰¹ç®—æ³•å’Œè¿ªå…‹æ–¯ç‰¹æ‹‰ç®—æ³•å¯¹æ¯” è¯´æ˜ å¦‚æœåœ¨ä¸€ä¸ªé—­ç¯ä¸­è¾¹çš„æƒé‡æ€»å’Œæ˜¯è´Ÿæ•°ï¼Œé‚£ä¹ˆåªè¦ä¸æ–­éå†è¿™ä¸ªé—­ç¯ï¼Œè·¯å¾„çš„æƒé‡å°±èƒ½ä¸æ–­å‡å°ï¼Œä¹Ÿå°±æ˜¯è¯´æ ¹æœ¬ä¸å­˜åœ¨æœ€çŸ­è·¯å¾„ã€‚ è´å°”æ›¼ - ç¦ç‰¹ç®—æ³•å¯ä»¥ç›´æ¥è®¤å®šä¸å­˜åœ¨æœ€çŸ­è·¯å¾„ï¼Œä½†åœ¨ç‹„å…‹æ–¯ç‰¹æ‹‰ç®—æ³•ä¸­ï¼Œå³ä¾¿ä¸å­˜åœ¨æœ€çŸ­è·¯å¾„ï¼Œå®ƒä¹Ÿä¼š ç®—å‡ºä¸€ä¸ªé”™è¯¯çš„æœ€çŸ­è·¯å¾„å‡ºæ¥ã€‚å› æ­¤ï¼Œæœ‰è´Ÿæ•°æƒé‡æ—¶ä¸èƒ½ä½¿ç”¨ç‹„å…‹æ–¯ç‰¹æ‹‰ç®—æ³•ã€‚ æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯ä¸å­˜åœ¨è´Ÿæ•°æƒé‡æ—¶ï¼Œæ›´é€‚åˆä½¿ç”¨æ•ˆç‡è¾ƒé«˜çš„ç‹„å…‹æ–¯ç‰¹æ‹‰ç®—æ³•ï¼Œè€Œå­˜ åœ¨è´Ÿæ•°æƒé‡æ—¶ï¼Œå³ä¾¿è¾ƒä¸ºè€—æ—¶ï¼Œä¹Ÿåº”è¯¥ä½¿ç”¨å¯ä»¥å¾—åˆ°æ­£ç¡®ç­”æ¡ˆçš„è´å°”æ›¼ - ç¦ç‰¹ç®—æ³•ã€‚ A*ï¼ˆA-Starï¼‰ç®—æ³• è§£å†³çš„é—®é¢˜ A-Startç®—æ³•ä¹Ÿæ˜¯è§£å†³åœ¨å›¾ä¸­æ±‚è§£æœ€çŸ­è·¯å¾„é—®é¢˜çš„ç®—æ³•ï¼Œç”±ç‹„å…‹æ–¯ç‰¹æ‹‰ç®—æ³•å‘å±•è€Œæ¥ã€‚ ç‹„å…‹æ–¯ç‰¹æ‹‰ç®—æ³•ä¼šä»ç¦»èµ·ç‚¹è¿‘çš„é¡¶ç‚¹å¼€å§‹ï¼ŒæŒ‰é¡ºåºæ±‚å‡ºèµ·ç‚¹åˆ°å„ä¸ªé¡¶ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€äº›ç¦»ç»ˆç‚¹è¾ƒè¿œçš„é¡¶ç‚¹çš„æœ€çŸ­è·¯å¾„ä¹Ÿä¼šè¢«è®¡ç®—å‡ºæ¥ï¼Œä½†è¿™éƒ¨åˆ†å…¶å®æ˜¯æ— ç”¨çš„ã€‚ ä¸ä¹‹ä¸åŒï¼ŒA* å°± ä¼šé¢„å…ˆä¼°ç®—ä¸€ä¸ªå€¼ï¼Œå¹¶åˆ©ç”¨è¿™ä¸ªå€¼æ¥çœå»ä¸€äº›æ— ç”¨çš„è®¡ç®— ç¬¬äº”ç«  å®‰å…¨ç®—æ³• å®‰å…¨å’Œç®—æ³• ä¼ è¾“æ•°æ®æ—¶çš„å››ä¸ªé—®é¢˜ çªƒå¬ A å‘ B å‘é€çš„æ¶ˆæ¯å¯èƒ½ä¼šåœ¨ä¼ è¾“é€”ä¸­è¢« X å·çœ‹(å¦‚ä¸‹å›¾)ã€‚è¿™å°±æ˜¯â€œçªƒå¬â€ã€‚ å‡å†’ A ä»¥ä¸ºå‘ B å‘é€äº†æ¶ˆæ¯ï¼Œç„¶è€Œ B æœ‰å¯èƒ½æ˜¯ X å†’å……çš„(å¦‚ä¸‹å›¾);åè¿‡æ¥ï¼ŒB ä»¥ä¸ºä» A é‚£é‡Œæ”¶åˆ°äº†æ¶ˆæ¯ï¼Œç„¶è€Œ A ä¹Ÿæœ‰å¯èƒ½æ˜¯ X å†’å……çš„ã€‚ ç¯¡æ”¹ å³ä¾¿ B ç¡®å®æ”¶åˆ°äº† A å‘é€çš„æ¶ˆæ¯ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½åƒå³å›¾ è¿™æ ·ï¼Œè¯¥æ¶ˆæ¯çš„å†…å®¹åœ¨é€”ä¸­å°±è¢« X æ›´æ”¹äº†ã€‚ é™¤äº†è¢«ç¬¬ä¸‰è€…ç¯¡æ”¹å¤–ï¼Œé€š ä¿¡æ•…éšœå¯¼è‡´çš„æ•°æ®æŸåä¹Ÿå¯èƒ½ä¼šä½¿æ¶ˆæ¯å†…å®¹å‘ç”Ÿå˜åŒ–ã€‚ äº‹åå¦è®¤ B ä» A é‚£é‡Œæ”¶åˆ°äº†æ¶ˆæ¯ï¼Œä½†ä½œä¸ºæ¶ˆæ¯å‘é€è€…çš„ A å¯ èƒ½å¯¹ B æŠ±æœ‰æ¶æ„ï¼Œå¹¶åœ¨äº‹åå£°ç§°â€œè¿™ä¸æ˜¯æˆ‘å‘é€çš„æ¶ˆæ¯â€ã€‚ è§£å†³è¿™äº›é—®é¢˜çš„å®‰å…¨æŠ€æœ¯ ä¸ºäº†åº”å¯¹â€œçªƒå¬â€ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨â€œåŠ å¯†â€ æŠ€æœ¯ã€‚ ä¸ºäº†åº”å¯¹â€œå‡å†’â€ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨â€œæ¶ˆæ¯è®¤è¯ç â€(ä¸‹å›¾å·¦)æˆ–â€œæ•°å­—ç­¾åâ€(ä¸‹å›¾å³)æŠ€æœ¯ã€‚ ä¸ºäº†åº”å¯¹â€œç¯¡æ”¹â€ï¼Œæˆ‘ä»¬åŒæ ·ä¼šä½¿ç”¨ â€œæ¶ˆæ¯è®¤è¯ç â€æˆ–â€œæ•°å­—ç­¾åâ€æŠ€æœ¯ã€‚ å…¶ä¸­â€œæ•°å­—ç­¾åâ€æŠ€æœ¯è¿˜å¯ä»¥ç”¨äºé¢„é˜²â€œäº‹åå¦è®¤â€ã€‚ å“ˆå¸Œå‡½æ•° å“ˆå¸Œå‡½æ•°å¯ä»¥æŠŠç»™å®šçš„æ•°æ®è½¬æ¢æˆå›ºå®šé•¿åº¦çš„æ— è§„å¾‹æ•°å€¼ã€‚ è½¬æ¢åçš„æ— è§„å¾‹æ•°å€¼å¯ä»¥ä½œä¸ºæ•°æ®æ‘˜è¦åº”ç”¨äºå„ç§å„æ ·çš„åœºæ™¯ã€‚ å¸Œå‡½æ•°çš„ç‰¹å¾ï¼š ç¬¬ä¸€ä¸ªç‰¹å¾æ˜¯è¾“å‡ºçš„å“ˆå¸Œå€¼æ•°æ®é•¿åº¦ä¸å˜ã€‚ï¼ˆä¸è®ºè¾“å…¥çš„å‚æ•°é•¿çŸ­ï¼Œå¾—åˆ°çš„å“ˆå¸Œå€¼æ˜¯å®šé•¿çš„ï¼‰ ç¬¬äºŒä¸ªç‰¹å¾æ˜¯å¦‚æœè¾“å…¥çš„æ•°æ®ç›¸åŒï¼Œé‚£ä¹ˆè¾“å‡º çš„å“ˆå¸Œå€¼ä¹Ÿå¿…å®šç›¸åŒã€‚ ç¬¬ä¸‰ä¸ªç‰¹å¾æ˜¯å³ä½¿è¾“å…¥çš„æ•°æ®ç›¸ä¼¼ï¼Œä½†å“ªæ€•å®ƒä»¬åªæœ‰ä¸€æ¯”ç‰¹çš„å·®åˆ«ï¼Œé‚£ä¹ˆè¾“å‡ºçš„å“ˆå¸Œå€¼ä¹Ÿä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ã€‚ ç¬¬å››ä¸ªç‰¹å¾æ˜¯å³ä½¿è¾“å…¥çš„ä¸¤ä¸ªæ•°æ®å®Œå…¨ä¸åŒï¼Œè¾“ å‡ºçš„å“ˆå¸Œå€¼ä¹Ÿæœ‰å¯èƒ½æ˜¯ç›¸åŒçš„ï¼›è¿™ç§æƒ…å†µå«ä½œâ€œå“ˆå¸Œå†²çªâ€ã€‚ ç¬¬äº”ä¸ªç‰¹å¾æ˜¯ä¸å¯èƒ½ä»å“ˆå¸Œå€¼åå‘æ¨ç®—å‡ºåŸæœ¬çš„æ•°æ®ã€‚ï¼ˆè¾“å…¥å’Œè¾“å‡ºä¸å¯é€†ï¼‰ å“ˆå¸Œå‡½æ•°çš„ç®—æ³•ä¸­å…·æœ‰ä»£è¡¨æ€§çš„æ˜¯ MD5 1ã€SHA-1 2å’Œ SHA-2 ç­‰ã€‚å…¶ä¸­ SHA-2 æ˜¯ç° åœ¨åº”ç”¨è¾ƒä¸ºå¹¿æ³›çš„ä¸€ä¸ªï¼Œè€Œ MD5 å’Œ SHA-1 å­˜åœ¨å®‰å…¨éšæ‚£ï¼Œä¸æ¨èä½¿ç”¨ã€‚ åº”ç”¨ç¤ºä¾‹ å°†ç”¨æˆ·è¾“å…¥çš„å¯†ç ä¿å­˜åˆ°æœåŠ¡å™¨æ—¶ä¹Ÿéœ€è¦ç”¨åˆ°å“ˆå¸Œå‡½æ•°ã€‚ å¦‚æœæŠŠå¯†ç ç›´æ¥ä¿å­˜åˆ°æœåŠ¡å™¨ï¼Œå¯èƒ½ä¼šè¢«ç¬¬ä¸‰è€…çªƒå¬ï¼Œå› æ­¤éœ€è¦ç®—å‡ºå¯†ç çš„å“ˆå¸Œå€¼ï¼Œå¹¶åªå­˜å‚¨å“ˆå¸Œå€¼ã€‚ å½“ç”¨æˆ·è¾“å…¥å¯†ç æ—¶ï¼Œå…ˆç®—å‡ºè¯¥è¾“å…¥å¯†ç çš„å“ˆå¸Œå€¼ï¼Œå†æŠŠå®ƒå’ŒæœåŠ¡ å™¨ä¸­çš„å“ˆå¸Œå€¼è¿›è¡Œæ¯”å¯¹ã€‚ å…±äº«å¯†é’¥åŠ å¯†ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰ å…±äº«å¯†é’¥åŠ å¯†æ˜¯åŠ å¯†å’Œè§£å¯†éƒ½ä½¿ç”¨ç›¸åŒå¯†é’¥çš„ä¸€ç§åŠ å¯†æ–¹å¼ã€‚ å®ç°å…±äº«å¯†é’¥åŠ å¯†çš„ç®—æ³•æœ‰å‡¯æ’’å¯†ç ã€AES 1ã€DES 2ã€åŠ¨æ€å£ä»¤ç­‰ï¼Œå…¶ä¸­ AES çš„åº”ç”¨æœ€ ä¸ºå¹¿æ³›ã€‚ å­˜åœ¨å¯†é’¥åˆ†é…é—®é¢˜ å¦‚ä¸Šå›¾ï¼Œå¦‚æœåœ¨Aç»™Bå‘é€å¯†é’¥æ—¶ï¼Œè¢«Xç›‘å¬äº†ï¼Œåˆ™Xå°±èƒ½ç”¨ç›¸åŒçš„å¯†é’¥è§£å¯†æˆªè·çš„å¯†æ–‡ã€‚ å…¬å¼€å¯†é’¥åŠ å¯†ï¼ˆéå¯¹ç§°åŠ å¯†ï¼‰ å…¬å¼€å¯†é’¥åŠ å¯†æ˜¯åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ä¸åŒå¯†é’¥çš„ä¸€ç§åŠ å¯†æ–¹æ³•ã€‚ ç”±äºä½¿ç”¨çš„å¯†é’¥ä¸åŒï¼Œæ‰€ä»¥è¿™ç§ç®—æ³•ä¹Ÿè¢«ç§°ä¸ºâ€œéå¯¹ç§°åŠ å¯†â€ã€‚ åŠ å¯†ç”¨çš„å¯†é’¥å«ä½œâ€œå…¬å¼€å¯†é’¥â€ï¼Œè§£å¯†ç”¨çš„å«ä½œâ€œç§æœ‰å¯†é’¥â€ã€‚ å®ç°å…¬å¼€å¯†é’¥åŠ å¯†çš„ç®—æ³•æœ‰ RAS ç®—æ³•ã€æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•ç­‰ï¼Œå…¶ä¸­ä½¿ç”¨æœ€ä¸ºå¹¿æ³›çš„æ˜¯ RSA ç®—æ³•ã€‚ ä¸å­˜åœ¨å¯†é’¥åˆ†é…é—®é¢˜ å…¬å¼€å¯†é’¥å’Œå¯†æ–‡éƒ½æ˜¯é€šè¿‡äº’è”ç½‘ä¼ è¾“çš„ï¼Œå› æ­¤å¯èƒ½ä¼šè¢« X çªƒå¬ã€‚ ä½†æ˜¯ï¼Œä½¿ç”¨å…¬å¼€å¯†é’¥æ— æ³•è§£å¯†å¯†æ–‡ï¼Œå› æ­¤ X ä¹Ÿæ— æ³•å¾—åˆ°åŸæœ¬çš„æ•°æ®ã€‚ å¯†é’¥æ•°é‡ä¸ä¼šè¿‡å¤š åªéœ€è¦ç”Ÿæˆä¸€å¯¹å…¬ç§é’¥ï¼Œå°±å¯ä»¥æŠŠå…¬é’¥å…±äº«ç»™nä¸ªäººä½¿ç”¨ã€‚ å¯¹ç§°åŠ å¯†å°±çš„å¯†é’¥æ•°é‡ä¼šéšç€äººçš„å¢å¤šè€Œå¢å¤šã€‚ å…¬å¼€å¯†é’¥åŠ å¯†å­˜åœ¨å…¬å¼€å¯†é’¥å¯é æ€§çš„é—®é¢˜ å¦‚ä¸‹å›¾ï¼ŒåŠ å…¥Båœ¨æŠŠå…¬é’¥Pbå…±äº«ç»™Açš„æ—¶å€™ï¼Œè¢«Xæˆªè·äº†ï¼›XæŠŠè‡ªå·±çš„å…¬é’¥Pxå‘é€ç»™äº†Aã€‚ è¿™æ—¶Aåœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä½¿ç”¨Pxå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†å‘é€ç»™Bæ—¶ï¼ŒXæˆªè·å¯†æ–‡å°±å¯ä»¥é€šè¿‡ç§é’¥Sxè¿›è¡Œè§£å¯†ã€‚ ç„¶åXå¯ä»¥æˆªè·çš„é€šè¿‡å…¬é’¥PbåŠ å¯†æ¶æ„æ•°æ®å‘é€ç»™Bï¼ŒBèƒ½å¤Ÿä½¿ç”¨è‡ªå·±çš„å¯†é’¥Sbè¿›è¡Œè§£å¯†ï¼Œä»¥ä¸ºæ•°æ®æ˜¯Aå‘é€çš„ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š éå¯¹ç§°åŠ å¯†ç®—æ³•çš„æ¡ä»¶ å¯ä»¥ä½¿ç”¨æŸä¸ªæ•°å€¼å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†(è®¡ç®—)ã€‚ ä½¿ç”¨å¦ä¸€ä¸ªæ•°å€¼å¯¹åŠ å¯†æ•°æ®è¿›è¡Œè®¡ç®—å°±å¯ä»¥è®©æ•°æ®æ¢å¤åŸæ ·ã€‚ æ— æ³•ä»ä¸€ç§å¯†é’¥æ¨ç®—å‡ºå¦ä¸€ç§å¯†é’¥ã€‚ æ··åˆåŠ å¯† å…±äº«å¯†é’¥åŠ å¯†å­˜åœ¨æ— æ³•å®‰å…¨ä¼ è¾“å¯†é’¥çš„å¯†é’¥åˆ†é…é—®é¢˜ï¼Œå…¬å¼€å¯†é’¥åŠ å¯†åˆå­˜åœ¨åŠ å¯†è§£å¯†é€Ÿåº¦è¾ƒæ…¢çš„é—®é¢˜ã€‚ åœ¨æ··åˆåŠ å¯†ä¸­ï¼Œè¦ç”¨å¤„ç†é€Ÿåº¦è¾ƒå¿«çš„å…±äº«å¯†é’¥åŠ å¯†å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚ä¸è¿‡ï¼ŒåŠ å¯†æ—¶ä½¿ç”¨çš„å¯†é’¥ï¼Œåˆ™éœ€è¦ç”¨æ²¡æœ‰å¯†é’¥åˆ†é…é—®é¢˜çš„å…¬å¼€å¯†é’¥åŠ å¯†è¿›è¡Œå¤„ç†ã€‚æ··åˆåŠ å¯†å¯ä»¥æ‹†åˆ†æˆä¸‹é¢ä¸¤æ­¥æ“ä½œï¼š 1ã€Aåœ¨ç»™Bå‘é€æ•°æ®ä¹‹å‰ï¼Œå…ˆä½¿ç”¨éå¯¹ç§°çš„å…¬é’¥å¯¹â€å¯¹ç§°åŠ å¯†çš„å¯†é’¥â€œè¿›è¡ŒåŠ å¯†ï¼Œç„¶åæŠŠåŠ å¯†åçš„å¯†æ–‡å‘é€ç»™Aï¼ŒAè§£å¯†åå°±å¾—åˆ°äº†â€å¯¹ç§°åŠ å¯†çš„å¯†é’¥â€œã€‚å¦‚ä¸‹å›¾ï¼š 2ã€å‘é€æ•°æ®æ—¶ï¼ŒAä½¿ç”¨â€å¯¹ç§°åŠ å¯†çš„å¯†é’¥â€œå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œç„¶åå‘é€ç»™Bï¼Œè¿™æ ·Bå°±èƒ½ä½¿ç”¨ä¹‹å‰æ”¶åˆ°çš„â€å¯¹ç§°åŠ å¯†çš„å¯†é’¥â€œå¯¹æ•°æ®è¿›è¡Œè§£å¯†ã€‚å¦‚ä¸‹å›¾ï¼š è¿ªè² - èµ«å°”æ›¼å¯†é’¥äº¤æ¢ è¿ªè² - èµ«å°”æ›¼(Diffie-Hellman)å¯†é’¥äº¤æ¢æ˜¯ä¸€ç§å¯ä»¥åœ¨é€šä¿¡åŒæ–¹ä¹‹é—´å®‰å…¨äº¤æ¢å¯†é’¥çš„æ–¹æ³•ã€‚ è¿™ç§æ–¹æ³•é€šè¿‡å°†åŒæ–¹å…±æœ‰çš„ç§˜å¯†æ•°å€¼éšè—åœ¨å…¬å¼€æ•°å€¼ç›¸å…³çš„è¿ç®—ä¸­ï¼Œæ¥å®ç°åŒæ–¹ä¹‹é—´å¯†é’¥çš„å®‰å…¨äº¤æ¢ã€‚ ç®—æ³•çš„æ¦‚å¿µ å‡è®¾æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥åˆæˆä¸¤ä¸ªå¯†é’¥ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•æ¥åˆæˆå¯†é’¥På’Œå¯†é’¥Sï¼Œå°±ä¼šå¾—åˆ°ç”±è¿™ä¸¤ä¸ªå¯†é’¥çš„æˆåˆ†æ‰€æ„æˆçš„å¯†é’¥ P-Sã€‚ è¿™ç§åˆæˆæ–¹æ³•æœ‰ä¸‰ä¸ªç‰¹å¾ã€‚ ç¬¬ä¸€ï¼Œå³ä½¿æŒæœ‰å¯†é’¥ P å’Œåˆæˆçš„å¯†é’¥ P-Sï¼Œä¹Ÿæ— æ³•æŠŠå¯†é’¥ S å•ç‹¬å–å‡ºæ¥ã€‚ ç¬¬äºŒï¼Œä¸ç®¡æ˜¯æ€æ ·åˆæˆè€Œæ¥çš„å¯†é’¥ï¼Œéƒ½å¯ä»¥æŠŠå®ƒä½œä¸ºæ–°çš„å…ƒç´ ï¼Œç»§ç»­ä¸åˆ«çš„å¯†é’¥è¿›è¡Œåˆæˆã€‚å¦‚ä¸‹å›¾ï¼Œä½¿ç”¨å¯†é’¥ P å’Œå¯†é’¥ P-Sï¼Œè¿˜èƒ½åˆæˆå‡ºæ–°çš„å¯†é’¥ P-P-Sã€‚ ç¬¬ä¸‰ï¼Œå¯†é’¥çš„åˆæˆç»“æœä¸åˆæˆé¡ºåºæ— å…³ï¼Œåªä¸ç”¨äº†å“ªäº›å¯†é’¥æœ‰å…³ã€‚æ¯”å¦‚åˆæˆå¯†é’¥ B å’Œå¯†é’¥ C åï¼Œå¾—åˆ°çš„æ˜¯å¯† é’¥ B-Cï¼Œå†å°†å…¶ä¸å¯†é’¥ A åˆæˆï¼Œå¾—åˆ°çš„å°±æ˜¯å¯†é’¥ A-B-Cã€‚è€Œåˆæˆå¯†é’¥ A å’Œå¯†é’¥ C åï¼Œå¾—åˆ°çš„æ˜¯å¯†é’¥ A-Cï¼Œ å†å°†å…¶ä¸å¯†é’¥ B åˆæˆï¼Œå¾—åˆ°çš„å°±æ˜¯å¯†é’¥ B-A-Cã€‚æ­¤å¤„çš„å¯†é’¥ A-B-C å’Œå¯†é’¥ B-A-C æ˜¯ä¸€æ ·çš„ã€‚ å¯†é’¥çš„äº¤æ¢ æ¶ˆæ¯è®¤è¯ç ï¼ŒMACï¼ˆMessage Authentication Codeï¼‰ æ¶ˆæ¯è®¤è¯ç å¯ä»¥å®ç°â€œè®¤è¯â€å’Œâ€œæ£€æµ‹ç¯¡æ”¹â€è¿™ä¸¤ä¸ªåŠŸèƒ½ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚ä¸‹å›¾ï¼Œå‡è®¾ A å‘é€ç»™ B çš„å¯†æ–‡ï¼ˆabcï¼‰åœ¨é€šä¿¡è¿‡ç¨‹ä¸­è¢« X æ¶æ„ç¯¡æ”¹äº†ï¼Œè€Œ B æ”¶åˆ°å¯†æ–‡åæ²¡æœ‰æ„è¯†åˆ°è¿™ä¸ªé—®é¢˜ã€‚ Bå¯¹å¯†æ–‡è¿›è¡Œè§£å¯†å¯èƒ½æ— æ³•è§£å¯†æˆ–è€…è§£å¯†åçš„æ•°æ®æ˜¯xyzã€‚å¦‚æœAåœ¨å‘Bè¿›è¡Œå•†å“è®¢è´­ï¼Œå¦‚æœBè§£å¯†å‡ºçš„å¯†æ–‡æ˜¯xyzï¼Œå°±ä¼šç»™Aå‘é€xyzå•†å“ä»è€Œå¯¼è‡´é—®é¢˜ã€‚ å¦‚ä½•ä½¿ç”¨æ¶ˆæ¯è®¤è¯ç è§£å†³ç¯¡æ”¹é—®é¢˜å‘¢ï¼Ÿ Aåœ¨å‘é€æ•°æ®ä¹‹å‰ï¼Œå…ˆç”Ÿæˆä¸€ä¸ªç”¨äºåˆ¶ä½œæ¶ˆæ¯éªŒè¯ç çš„å¯†é’¥ï¼ˆkeyï¼‰ï¼Œç„¶åç”¨å®‰å…¨çš„æ–¹æ³•ï¼ˆå¦‚æ··åˆåŠ å¯†ï¼‰å‘é€ç»™B Aå¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œå¹¶ä¸”ä½¿ç”¨ç¬¬ä¸€æ­¥ç”Ÿæˆçš„keyå’Œå¯†æ–‡ç”Ÿæˆä¸€ä¸ªæ•°å€¼ï¼Œæ­¤å€¼å°±æ˜¯MAC AæŠŠMACå’Œå¯†æ–‡ä¸€èµ·å‘é€ç»™B Bæ¥æ”¶åˆ°å¯†æ–‡å’ŒMACåï¼Œå…ˆä½¿ç”¨ç¬¬ä¸€æ­¥Aå‘é€è¿‡æ¥çš„keyå’Œå¯†æ–‡ä½¿ç”¨åŒæ ·çš„æ–¹æ³•ç”Ÿæˆä¸€ä¸ªæ•°å€¼ï¼›å¹¶ä¸”ä½¿ç”¨æ­¤æ•°å€¼å’Œæ”¶åˆ°çš„MACè¿›è¡Œæ¯”å¯¹ å¦‚æœæ¯”å¯¹ä¸€è‡´ï¼Œåˆ™è¯´æ˜æ•°æ®æœªè¢«ç¯¡æ”¹ å¦‚æœæ¯”å¯¹ä¸ä¸€è‡´ï¼Œåˆ™è¯´æ˜æ•°æ®è¢«ç¯¡æ”¹äº†ï¼Œç›´æ¥ä¸¢å¼ƒæ•°æ®ï¼›ç„¶åé€šçŸ¥Aé‡å‘ å¦‚æœMACå’Œå¯†æ–‡éƒ½è¢«Xæˆªè·äº†æ€ä¹ˆåŠï¼Ÿ Xå¯ä»¥ä¿®æ”¹å¯†æ–‡ï¼Œæ­¤æ—¶Bä½¿ç”¨è¢«ç¯¡æ”¹åçš„å¯†æ–‡å’Œkeyç”Ÿæˆçš„æ•°å€¼ä¸ç­‰äºMACï¼Œå°±èƒ½ç¡®è®¤é€šä¿¡è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ç¯¡æ”¹ Xå¦‚æœç¯¡æ”¹äº†MACï¼Œä¹Ÿä¸ä¸Šä¸€æ­¥ä¸€æ ·ï¼ŒBä¹Ÿèƒ½ç¡®è®¤é€šä¿¡è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ç¯¡æ”¹ Xæ—¢ç¯¡æ”¹äº†å¯†æ–‡ä¹Ÿç¯¡æ”¹äº†MACï¼Œå› ä¸ºXæ²¡æœ‰ç”ŸæˆMACçš„keyï¼Œæ‰€ä»¥Bæ”¶åˆ°è¢«ç¯¡æ”¹åçš„æ•°æ®æ—¶åŒæ ·èƒ½ç¡®è®¤å‘ç”Ÿäº†ç¯¡æ”¹ æˆ‘ä»¬å¯ä»¥æŠŠ MAC æƒ³è±¡æˆæ˜¯ç”±å¯†é’¥å’Œå¯†æ–‡ç»„æˆçš„å­—ç¬¦ä¸²çš„â€œå“ˆå¸Œå€¼â€ã€‚ è®¡ç®— MAC çš„ç®—æ³•æœ‰ HMAC 1ã€OMAC 2ã€CMAC 3ç­‰ã€‚ç›®å‰ï¼ŒHMAC çš„åº”ç”¨æœ€ä¸ºå¹¿æ³›ã€‚ æ¶ˆæ¯éªŒè¯ç æ— æ³•é˜²æ­¢â€œäº‹åå¦è®¤â€ ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•ä¹Ÿæœ‰ç¼ºç‚¹ã€‚åœ¨ä½¿ç”¨æ¶ˆæ¯è®¤è¯ç çš„è¿‡ç¨‹ä¸­ï¼ŒAB åŒæ–¹éƒ½å¯ä»¥å¯¹æ¶ˆæ¯è¿›è¡ŒåŠ å¯†å¹¶ä¸”ç®—å‡º MACã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ— æ³•è¯æ˜åŸæœ¬çš„æ¶ˆæ¯æ˜¯ A ç”Ÿæˆçš„è¿˜æ˜¯ B ç”Ÿæˆçš„ã€‚ å› æ­¤ï¼Œå‡å¦‚ A æ˜¯åäººï¼Œä»–å°±å¯ä»¥åœ¨è‡ªå·±å‘å‡ºæ¶ˆæ¯åå£°ç§°â€œè¿™æ¡æ¶ˆæ¯æ˜¯ B æé€ çš„â€ï¼Œè€Œå¦è®¤è‡ªå·±çš„è¡Œä¸ºã€‚å¦‚æœ B æ˜¯åäººï¼Œä»–ä¹Ÿå¯ä»¥è‡ªå·±å‡†å¤‡ä¸€æ¡æ¶ˆæ¯ï¼Œç„¶åå£°ç§°â€œè¿™æ˜¯ A å‘ ç»™æˆ‘çš„æ¶ˆæ¯â€ã€‚ æ•°å­—ç­¾å æ•°å­—ç­¾åä¸ä»…å¯ä»¥å®ç°æ¶ˆæ¯è®¤è¯ç çš„è®¤è¯å’Œæ£€æµ‹ç¯¡æ”¹åŠŸèƒ½ï¼Œè¿˜å¯ä»¥é¢„é˜²äº‹åå¦è®¤é—®é¢˜çš„å‘ç”Ÿã€‚ ç”±äºåœ¨æ¶ˆæ¯è®¤è¯ç ä¸­ä½¿ç”¨çš„æ˜¯å…±äº«å¯†é’¥åŠ å¯†ï¼Œæ‰€ä»¥æŒæœ‰å¯†é’¥çš„æ”¶ä¿¡äººä¹Ÿæœ‰å¯èƒ½æ˜¯æ¶ˆæ¯çš„å‘ é€è€…ï¼Œè¿™æ ·æ˜¯æ— æ³•é¢„é˜²äº‹åå¦è®¤è¡Œä¸ºçš„ã€‚ è€Œæ•°å­—ç­¾åæ˜¯åªæœ‰å‘ä¿¡äººæ‰èƒ½ç”Ÿæˆçš„ï¼Œå› æ­¤ä½¿ç”¨å®ƒå°±å¯ä»¥ç¡®å®šè°æ˜¯æ¶ˆæ¯çš„å‘é€è€…äº†ã€‚ æ•°å­—ç­¾åçš„ç‰¹å¾ æ¯”å¦‚Aç»™Bå‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ•°å­—ç­¾åå¿…é¡»æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼š åªè¦å‘é€çš„æ¶ˆæ¯ä¸Šæœ‰ A çš„æ•°å­—ç­¾åï¼Œå°±èƒ½ç¡®å®šæ¶ˆæ¯çš„å‘é€è€…å°±æ˜¯ Aã€‚ B å¯ä»¥éªŒè¯æ•°å­—ç­¾åçš„æ­£ç¡®æ€§ï¼Œä½†æ— æ³•ç”Ÿæˆæ•°å­—ç­¾åã€‚ å¦‚ä½•å®ç°æ•°å­—ç­¾å å…ˆå›æƒ³ä¸€ä¸‹éå¯¹ç§°åŠ å¯†çš„æµç¨‹ï¼ŒAç»™Bå‘é€æ¶ˆæ¯æ—¶ä½¿ç”¨Bæä¾›çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼ŒBä½¿ç”¨è‡ªå·±çš„ç§é’¥è¿›è¡Œè§£å¯†ã€‚å¦‚ä¸‹å›¾ï¼š é‚£ä¹ˆæˆ‘ä»¬æŠŠè¿™ä¸ªè¿‡ç¨‹åè¿‡æ¥ï¼Œå°±å¯ä»¥åšåˆ°æ•°å­—ç­¾åï¼Œå¦‚ä¸‹å›¾ï¼š A ä½¿ç”¨è‡ªå·±çš„ç§æœ‰å¯†é’¥åŠ å¯†æ¶ˆæ¯ã€‚åŠ å¯†åçš„æ¶ˆæ¯å°±æ˜¯æ•°å­—ç­¾åã€‚ AæŠŠæ•°å­—ç­¾åå’ŒåŸå§‹çš„æ•°æ®éƒ½å‘é€ç»™B Bæ¥æ”¶åˆ°æ•°å­—ç­¾åå’Œæ•°æ®åï¼Œä½¿ç”¨Aæä¾›çš„å…¬é’¥è¿›è¡Œè§£å¯†ï¼Œå¹¶æŠŠè§£å¯†åçš„æ•°æ®å’Œå‘é€æ¥çš„æ•°æ®åšæ¯”å¯¹ å¦‚æœä¸€è‡´ï¼Œåˆ™è¯´æ˜æ­¤æ¶ˆæ¯æ˜¯ç”±Aå‘é€çš„ï¼Œå› ä¸ºAçš„å…¬é’¥åªèƒ½è§£å¯†ç»æœ‰Açš„ç§é’¥åŠ å¯†çš„æ•°æ® èƒ½å¤Ÿç”¨ A çš„å…¬å¼€å¯†é’¥è§£å¯†çš„å¯†æ–‡ï¼Œå¿…å®šæ˜¯ç”± A ç”Ÿæˆçš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç»“è®ºæ¥ç¡®è®¤æ¶ˆæ¯çš„å‘é€è€…æ˜¯å¦ä¸º Aï¼Œæ¶ˆæ¯æ˜¯å¦è¢«äººç¯¡æ”¹ã€‚ ç”±äº B åªæœ‰å…¬å¼€å¯†é’¥ï¼Œæ— æ³•ç”Ÿæˆ A çš„ç­¾åï¼Œæ‰€ä»¥ä¹Ÿé¢„é˜²äº†â€œäº‹åå¦è®¤â€è¿™ä¸€é—®é¢˜çš„ å‘ç”Ÿã€‚ åœ¨ä½¿ç”¨æ­¤æ–¹å¼è¿›è¡ŒåŠ å¯†æ—¶ï¼ŒAä½¿ç”¨è‡ªå·±çš„ç§é’¥åŠ å¯†çš„æ•°æ®æœ€å¥½æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œåªæ˜¯ç”¨æ¥éªŒè¯å‘é€ç€æ˜¯å¦æ˜¯Aï¼Œå¹¶ä¸”æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚ æ•°å­—è¯ä¹¦ â€œå…¬å¼€å¯†é’¥åŠ å¯†â€å’Œâ€œæ•°å­—ç­¾åâ€æ— æ³•ä¿è¯å…¬å¼€å¯†é’¥ç¡®å®æ¥è‡ªä¿¡æ¯çš„å‘é€è€…ã€‚å› æ­¤ï¼Œå°±ç®—å…¬ å¼€å¯†é’¥è¢«ç¬¬ä¸‰è€…æ¶æ„æ›¿æ¢ï¼Œæ¥æ”¶æ–¹ä¹Ÿä¸ä¼šæ³¨æ„åˆ°ã€‚ è€Œæ•°å­—è¯ä¹¦ï¼Œå°±èƒ½ä¿è¯å…¬å¼€å¯†é’¥çš„æ­£ç¡®æ€§ã€‚ å¦‚ä½•ä½¿ç”¨æ•°æ®è¯ä¹¦å‘é€å…¬é’¥ AæŒæœ‰å…¬å¼€å¯†é’¥Pa å’Œ Aç§æœ‰å¯†é’¥ Sa ï¼Œç°åœ¨æƒ³è¦å°†å…¬å¼€å¯†é’¥PAå‘é€ç»™Bï¼Œå¦‚ä½•åšå‘¢ï¼Ÿ Aé¦–å…ˆéœ€è¦å‘è®¤è¯ä¸­å¿ƒ (Certification Authorityï¼Œ CA)ç”³è¯·å‘è¡Œè¯ä¹¦ï¼Œè¯æ˜å…¬å¼€å¯†é’¥PA ç¡®å®ç”±è‡ªå·±ç”Ÿæˆ è®¤è¯ä¸­å¿ƒé‡Œä¿ç®¡ç€ä»–ä»¬è‡ªå·±å‡†å¤‡çš„å…¬å¼€å¯†é’¥Pcå’Œç§æœ‰å¯†é’¥ Sc Aå°†å…¬å¼€å¯†é’¥Pa å’ŒåŒ…å«é‚®ç®±ä¿¡æ¯çš„ä¸ªäººèµ„æ–™å‘é€ç»™è®¤è¯ä¸­å¿ƒ è®¤è¯ä¸­å¿ƒå¯¹æ”¶åˆ°çš„èµ„æ–™è¿›è¡Œç¡®è®¤ï¼Œåˆ¤æ–­å…¶æ˜¯å¦ä¸ºAæœ¬äººçš„èµ„æ–™ã€‚ç¡®è®¤å®Œæ¯•åï¼Œè®¤è¯ä¸­å¿ƒä½¿ç”¨è‡ªå·±çš„ç§æœ‰å¯†é’¥ Scï¼Œæ ¹æ® A çš„èµ„æ–™ç”Ÿæˆæ•°å­—ç­¾åã€‚ è®¤è¯ä¸­å¿ƒå°†ç”Ÿæˆçš„æ•°å­—ç­¾åå’Œèµ„æ–™æ”¾è¿›åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶æŠŠè¿™ä¸ªæ–‡ä»¶å‘é€ç»™ Aã€‚ï¼ˆè¿™ä¸ªæ–‡ä»¶å°±æ˜¯ A çš„æ•°å­—è¯ä¹¦ï¼‰ A å°†ä½œä¸ºå…¬å¼€å¯†é’¥çš„æ•°å­—è¯ä¹¦å‘é€ç»™äº† Bã€‚ B æ”¶åˆ°æ•°å­—è¯ä¹¦åï¼Œç¡®è®¤è¯ä¹¦é‡Œçš„é‚®ä»¶åœ°å€ç¡®å®æ˜¯ A çš„åœ°å€ã€‚æ¥ç€ï¼ŒB è·å–äº†è®¤è¯ä¸­å¿ƒçš„å…¬å¼€å¯†é’¥ã€‚ B å¯¹è¯ä¹¦å†…çš„ç­¾åè¿›è¡ŒéªŒè¯ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦ä¸ºè®¤è¯ä¸­å¿ƒç»™å‡ºçš„ç­¾åã€‚è¯ä¹¦ä¸­çš„ç­¾ååªèƒ½ç”¨è®¤è¯ä¸­å¿ƒçš„å…¬å¼€å¯†é’¥ Pc è¿›è¡ŒéªŒè¯ã€‚å¦‚æœéªŒè¯ç»“æœæ²¡æœ‰å¼‚å¸¸ï¼Œå°±èƒ½è¯´æ˜è¿™ä»½è¯ä¹¦çš„ç¡®ç”±è®¤è¯ä¸­å¿ƒå‘è¡Œã€‚ ç¡®è®¤äº†è¯ä¹¦æ˜¯ç”±è®¤è¯ä¸­å¿ƒå‘è¡Œçš„ï¼Œä¸”é‚®ä»¶åœ°å€å°±æ˜¯ Açš„ä¹‹åï¼ŒBä»è¯ä¹¦ä¸­å–å‡ºAçš„å…¬å¼€å¯†é’¥PAã€‚è¿™æ ·ï¼Œå…¬å¼€å¯†é’¥ä¾¿ä» A ä¼ åˆ° äº†Bã€‚ ç»è¿‡ä»¥ä¸Šæ­¥éª¤ä¿¡æ¯çš„æ¥æ”¶è€…Bå¯ä»¥ç¡®è®¤å…¬å¼€å¯†é’¥çš„åˆ¶ä½œè€…æ˜¯Aã€‚ å¾ªç¯è´¨ç–‘ï¼Œæˆ‘ä»¬ä»è®¤è¯ä¸­å¿ƒè·å–çš„å…¬é’¥PcçœŸçš„æ¥è‡ªè®¤è¯ä¸­å¿ƒå— ç”±äºå…¬å¼€å¯†é’¥è‡ªèº«ä¸èƒ½è¡¨ç¤ºå…¶åˆ¶ä½œè€…ï¼Œæ‰€ä»¥æœ‰å¯èƒ½æ˜¯å†’å……è®¤è¯ä¸­å¿ƒçš„ X æ‰€ç”Ÿæˆçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é‡ŒåŒæ ·å­˜åœ¨å…¬å¼€å¯†é’¥é—®é¢˜(è¯·å‚è€ƒä¸‹å›¾)ã€‚ å®é™…ä¸Šï¼Œè®¤è¯ä¸­å¿ƒçš„å…¬å¼€å¯†é’¥ PC æ˜¯ä»¥æ•°å­—è¯ä¹¦çš„å½¢å¼äº¤ä»˜çš„ï¼Œä¼šæœ‰æ›´é«˜çº§åˆ«çš„è®¤è¯ ä¸­å¿ƒå¯¹è¿™ä¸ªè®¤è¯ä¸­å¿ƒç½²å(è¯·å‚è€ƒä¸‹å›¾)ã€‚ æ‰€ä»¥æˆ‘ä»¬æœ‰æ‰€æ€€ç–‘å¯ä»¥ä¸€ç›´éªŒè¯ä¸‹å»ã€‚ æœ€é¡¶ç«¯çš„è®¤è¯ä¸­å¿ƒè¢«ç§°ä¸ºâ€œæ ¹è®¤è¯ä¸­å¿ƒâ€(root CA)ï¼Œå…¶è‡ªèº«çš„æ­£å½“æ€§ç”±è‡ªå·±è¯æ˜ã€‚ ç¬¬å…­ç«  èšç±» ä»€ä¹ˆæ˜¯èšç±» å°†ç›¸ä¼¼çš„å¯¹è±¡åˆ†ä¸ºä¸€ç»„ èšç±»å°±æ˜¯åœ¨è¾“å…¥ä¸ºå¤šä¸ªæ•°æ®æ—¶ï¼Œå°†â€œç›¸ä¼¼â€çš„æ•°æ®åˆ†ä¸ºä¸€ç»„çš„æ“ä½œã€‚1ä¸ªç»„å°±å«ä½œ1ä¸ª â€œç°‡â€ã€‚ ä¸‹é¢çš„ç¤ºä¾‹ä¸­æ¯ä¸ªç‚¹éƒ½ä»£è¡¨ 1 ä¸ªæ•°æ®ï¼Œåœ¨å¹³é¢ä¸Šä½ç½®è¾ƒä¸ºç›¸è¿‘ã€è¢«åœˆèµ·æ¥çš„ç‚¹å°±ä»£è¡¨ä¸€ç±»ç›¸ä¼¼çš„æ•°æ®ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›æ•°æ®è¢«åˆ†ä¸ºäº† 3 ä¸ªç°‡ã€‚ å¦‚ä½•å®šä¹‰â€œç›¸ä¼¼â€ å®šä¹‰æ•°æ®é—´çš„å·®è· æ ¹æ®æ•°æ®ç±»å‹ä¸åŒï¼Œå®šä¹‰è¯¥æ•°æ®æ˜¯å¦â€œç›¸ä¼¼â€çš„æ ‡å‡†ä¹Ÿä¸åŒã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯è¦å¯¹ä¸¤ä¸ªæ•° æ®ä¹‹é—´çš„â€œå·®è·â€è¿›è¡Œå®šä¹‰ã€‚ å¦‚ï¼šå‡è®¾æŸæ‰€é«˜ä¸­çš„æŸä¸ªå¹´çº§ä¸­å…±æœ‰ 400 åå­¦ç”Ÿï¼Œç°åœ¨æˆ‘ä»¬æƒ³è¦å°†è¿™äº›å­¦ç”Ÿåœ¨è€ƒè¯•ä¸­å–å¾—çš„è¯­ æ–‡ã€æ•°å­¦ã€è‹±è¯­æˆç»©æ•°æ®åŒ–ï¼Œå¹¶å°†ä»–ä»¬æŒ‰ç…§â€œæ“…é•¿æˆ–ä¸æ“…é•¿çš„ç§‘ç›®ç›¸ä¼¼â€è¿›è¡Œèšç±»ã€‚ æŠŠæ¯ä¸ªå­¦ç”Ÿéƒ½è½¬æ¢æˆâ€œ(è¯­æ–‡æˆç»© , æ•°å­¦æˆç»© , è‹±è¯­æˆç»©)â€å½¢å¼çš„æ•°æ®åï¼Œå°±å¯ä»¥å°†ä¸¤ä¸ªæ•°æ®(c1, m1, e1)å’Œ(c2, m2, e2)ä¹‹é—´çš„å·®è·å®šä¹‰ä¸º (c1-c2) + (m1-m2) + (e1-e2) ï¼Œå…¶ä¸­å·®è·å°çš„æ•°æ® å°±äº’ä¸ºâ€œç›¸ä¼¼çš„æ•°æ®â€ã€‚ ç¬¦åˆæ¡ä»¶çš„ç®—æ³• å³ä½¿å®šä¹‰å¥½äº†æ•°æ®é—´çš„å·®è·ï¼Œèšç±»çš„æ–¹æ³•ä¹Ÿä¼šæœ‰å¾ˆå¤šç§ã€‚æˆ‘ä»¬å¯ä»¥è®¾å®šå„ç§å„æ ·çš„æ¡ä»¶ï¼Œ æ¯”å¦‚æƒ³æŠŠæ•°æ®åˆ†ä¸º 10 ä¸ªç°‡ï¼Œæˆ–è€…æƒ³æŠŠ 1 ä¸ªç°‡å†…çš„æ•°æ®å®šåœ¨ 30~50 äººä¹‹é—´ï¼Œå†æˆ–è€…æƒ³æŠŠç°‡å†…æ•°æ® é—´çš„æœ€å¤§è·ç¦»è®¾ä¸º 10ï¼Œç­‰ç­‰ã€‚è€Œè®¾å®šä»€ä¹ˆæ ·çš„æ¡ä»¶å–å†³äºè¿›è¡Œèšç±»çš„ç›®çš„ã€‚ k-means ç®—æ³• k-means ç®—æ³•æ˜¯èšç±»ç®—æ³•ä¸­çš„ä¸€ç§ï¼Œå®ƒå¯ä»¥æ ¹æ®äº‹å…ˆç»™å®šçš„ç°‡çš„æ•°é‡è¿›è¡Œèšç±»ã€‚ k-meansç®—æ³•æ­¥éª¤ é¦–å…ˆå‡†å¤‡å¥½éœ€è¦èšç±»çš„æ•°æ®ï¼Œç„¶åå†³å®šç°‡çš„æ•°é‡ï¼ˆæ¯”å¦‚ä¸‹é¢å›¾ç¤ºç°‡çš„æ•°é‡ä¸º3ï¼‰ã€‚ éšæœºé€‰æ‹© 3 ä¸ªç‚¹ä½œä¸ºç°‡çš„ä¸­å¿ƒç‚¹ã€‚ è®¡ç®—å„ä¸ªæ•°æ®åˆ†åˆ«å’Œ 3 ä¸ªä¸­å¿ƒç‚¹ä¸­çš„å“ªä¸€ä¸ªç‚¹è·ç¦»æœ€è¿‘ã€‚ å°†æ•°æ®åˆ†åˆ°ç›¸åº”çš„ç°‡ä¸­ã€‚è¿™æ ·ï¼Œ3 ä¸ªç°‡çš„èšç±»å°±å®Œæˆäº†ã€‚ è®¡ç®—å„ä¸ªç°‡ä¸­æ•°æ®çš„é‡å¿ƒï¼Œç„¶åå°†ç°‡çš„ä¸­å¿ƒç‚¹ç§»åŠ¨åˆ°è¿™ä¸ªä½ç½®ã€‚ é‡æ–°è®¡ç®—è·ç¦»æœ€è¿‘çš„ç°‡çš„ä¸­å¿ƒç‚¹ï¼Œå¹¶å°†æ•°æ®åˆ†åˆ°ç›¸åº”çš„ç°‡ä¸­ã€‚ é‡å¤æ‰§è¡Œâ€œå°†æ•°æ®åˆ†åˆ°ç›¸åº”çš„ç°‡ä¸­â€å’Œâ€œå°†ä¸­å¿ƒç‚¹ç§»åˆ°é‡å¿ƒçš„ä½ç½®â€è¿™ä¸¤ä¸ªæ“ä½œï¼Œç›´åˆ°ä¸­å¿ƒç‚¹ä¸ å†å‘ç”Ÿå˜åŒ–ä¸ºæ­¢ã€‚ è§£è¯´ï¼š k-means ç®—æ³•ä¸­ï¼Œéšç€æ“ä½œçš„ä¸æ–­é‡å¤ï¼Œä¸­å¿ƒç‚¹çš„ä½ç½®å¿…å®šä¼šåœ¨æŸå¤„æ”¶æ•›ï¼Œè¿™ä¸€ç‚¹ å·²ç»åœ¨æ•°å­¦å±‚é¢ä¸Šå¾—åˆ°è¯æ˜ã€‚ å‰é¢çš„ä¾‹å­ä¸­æˆ‘ä»¬å°†ç°‡çš„æ•°é‡å®šä¸º 3ï¼Œè‹¥ç°åœ¨ä½¿ç”¨åŒæ ·çš„æ•°æ®ï¼Œå°†ç°‡çš„æ•°é‡å®šä¸º 2ï¼Œ é‚£ä¹ˆèšç±»å°†å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ä½äºå·¦è¾¹å’Œä¸‹è¾¹çš„ä¸¤ä¸ªæ•°æ®å—è¢«åˆ†åˆ°äº†ä¸€ä¸ªç°‡ä¸­ã€‚å°±åƒè¿™æ ·ï¼Œç”±äº k-means ç®—æ³•éœ€ è¦äº‹å…ˆç¡®å®šå¥½ç°‡çš„æ•°é‡ï¼Œæ‰€ä»¥è®¾å®šçš„æ•°é‡å¦‚æœä¸åˆç†ï¼Œè¿è¡Œçš„ç»“æœå°±å¯èƒ½ä¼šä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ã€‚ å¦‚æœå¯¹ç°‡çš„æ•°é‡æ²¡æœ‰æ˜ç¡®è¦æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥äº‹å…ˆå¯¹æ•°æ®è¿›è¡Œåˆ†æï¼Œæ¨ç®—å‡ºä¸€ä¸ªåˆé€‚çš„æ•°é‡ï¼Œæˆ–è€…ä¸æ–­æ”¹å˜ç°‡çš„æ•°é‡æ¥è¯•éªŒ k-means ç®—æ³•ã€‚ å¦å¤–ï¼Œå¦‚æœç°‡çš„æ•°é‡åŒæ ·ä¸º 2ï¼Œä½†ä¸­å¿ƒç‚¹æœ€åˆçš„ä½ç½®ä¸åŒï¼Œé‚£ä¹ˆä¹Ÿå¯èƒ½ä¼šå‡ºç°ä¸‹å›¾ è¿™æ ·çš„èšç±»ç»“æœã€‚ ä¸ä¹‹å‰çš„æƒ…å†µä¸åŒï¼Œè¿™æ¬¡å³ä¸Šå’Œå³ä¸‹çš„ä¸¤ä¸ªæ•°æ®å—è¢«åˆ†åˆ°äº†ä¸€ä¸ªç°‡ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ å³ä½¿ç°‡çš„æ•°é‡ç›¸åŒï¼Œåªè¦éšæœºè®¾ç½®çš„ä¸­å¿ƒç‚¹æœ€åˆçš„ä½ç½®ä¸åŒï¼Œèšç±»çš„ç»“æœä¹Ÿä¼šäº§ç”Ÿå˜åŒ–ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹å˜éšæœºè®¾å®šçš„ä¸­å¿ƒç‚¹ä½ç½®æ¥ä¸æ–­å°è¯• k-means ç®—æ³•ï¼Œå†ä»ä¸­é€‰æ‹© æœ€åˆé€‚çš„èšç±»ç»“æœã€‚ è¡¥å……è¯´æ˜ é™¤äº† k-means ç®—æ³•ä»¥å¤–ï¼Œèšç±»ç®—æ³•è¿˜æœ‰å¾ˆå¤šï¼Œå…¶ä¸­â€œå±‚æ¬¡èšç±»ç®—æ³•â€è¾ƒä¸ºæœ‰åã€‚ä¸ k-means ç®—æ³•ä¸åŒï¼Œå±‚æ¬¡èšç±»ç®—æ³•ä¸éœ€è¦äº‹å…ˆè®¾å®šç°‡çš„æ•°é‡ã€‚ åœ¨å±‚æ¬¡èšç±»ç®—æ³•ä¸­ï¼Œä¸€å¼€å§‹æ¯ä¸ªæ•°æ®éƒ½è‡ªæˆä¸€ç±»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰ n ä¸ªæ•°æ®å°±ä¼šå½¢æˆ n ä¸ªç°‡ã€‚ç„¶åé‡å¤æ‰§è¡Œâ€œå°†è·ç¦»æœ€è¿‘çš„ä¸¤ä¸ªç°‡åˆå¹¶ä¸ºä¸€ä¸ªâ€çš„æ“ä½œ n-1 æ¬¡ã€‚æ¯æ‰§è¡Œ 1 æ¬¡ï¼Œ ç°‡å°±ä¼šå‡å°‘ 1 ä¸ªã€‚æ‰§è¡Œ n - 1 æ¬¡åï¼Œæ‰€æœ‰æ•°æ®å°±éƒ½è¢«åˆ†åˆ°äº†ä¸€ä¸ªç°‡ä¸­ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªé˜¶æ®µçš„ç°‡çš„æ•°é‡éƒ½ä¸åŒï¼Œå¯¹åº”çš„èšç±»ç»“æœä¹Ÿä¸åŒã€‚åªè¦é€‰æ‹©å…¶ä¸­æœ€ä¸ºåˆç†çš„ 1 ä¸ªç»“æœ å°±å¥½ã€‚ åˆå¹¶ç°‡çš„æ—¶å€™ï¼Œä¸ºäº†æ‰¾å‡ºâ€œè·ç¦»æœ€è¿‘çš„ä¸¤ä¸ªç°‡â€ï¼Œéœ€è¦å…ˆå¯¹ç°‡ä¹‹é—´çš„è·ç¦»è¿›è¡Œå®šä¹‰ã€‚ æ ¹æ®å®šä¹‰æ–¹æ³•ä¸åŒï¼Œä¼šæœ‰â€œæœ€çŸ­è·ç¦»æ³•â€â€œæœ€é•¿è·ç¦»æ³•â€â€œä¸­é—´è·ç¦»æ³•â€ç­‰å¤šç§ç®—æ³•ã€‚ ç¬¬ä¸ƒç«  å…¶ä»–ç®—æ³• æ¬§å‡ é‡Œå¾—ç®—æ³• æ¬§å‡ é‡Œå¾—ç®—æ³•(åˆç§°è¾—è½¬ç›¸é™¤æ³•)ç”¨äºè®¡ç®—ä¸¤ä¸ªæ•°çš„æœ€å¤§å…¬çº¦æ•°**(GCD:greatest common divisor)**ï¼Œè¢«ç§°ä¸ºä¸–ç•Œä¸Šæœ€å¤è€çš„ç®—æ³•ã€‚ ä½¿ç”¨æ¬§å‡ é‡Œå¾—ç®—æ³•æ±‚1112å’Œ695çš„æœ€å¤§å…¬çº¦æ•° é¦–å…ˆç”¨è¾ƒå°çš„æ•°å­—å»é™¤è¾ƒå¤§çš„æ•°å­—ï¼Œæ±‚å‡ºä½™æ•°ã€‚ä¹Ÿå°±æ˜¯å¯¹ä¸¤ä¸ªæ•°å­—è¿›è¡Œ mod è¿ç®—ï¼Œé™¤å®Œåçš„ä½™æ•°ä¸º417ã€‚ modè¿ç®—å³å–ä½™è¿ç®—ï¼ŒA mod B å°±æ˜¯ç®—å‡ºAé™¤ä»¥Båçš„ä½™æ•°Cã€‚ æ¥ä¸‹æ¥å†ç”¨é™¤æ•°695å’Œä½™æ•°417è¿›è¡Œmodè¿ ç®—ã€‚ç»“æœä¸º 278ã€‚ ç»§ç»­é‡å¤åŒæ ·çš„æ“ä½œï¼Œå¯¹ 417 å’Œ 278 è¿›è¡Œ mod è¿ç®—ï¼Œç»“æœä¸º139ã€‚ å¯¹ 278 å’Œ 139 è¿›è¡Œ mod è¿ç®—ï¼Œç»“æœä¸º 0ã€‚ä¹Ÿå°± æ˜¯è¯´ï¼Œ278 å¯ä»¥è¢« 139 æ•´é™¤ã€‚ ä½™æ•°ä¸º 0 æ—¶ï¼Œæœ€åä¸€æ¬¡è¿ç®—ä¸­çš„é™¤æ•° 139 å°±æ˜¯ 1112 å’Œ 695 çš„æœ€å¤§å…¬çº¦æ•°ã€‚ Javaå®ç° æ¬§å‡ é‡Œå¾—æœ€å¤§å…¬çº¦æ•°ç®—æ³• ç´ æ€§æµ‹è¯• ç´ æ€§æµ‹è¯•æ˜¯åˆ¤æ–­ä¸€ä¸ªè‡ªç„¶æ•°æ˜¯å¦ä¸ºç´ æ•°çš„æµ‹è¯•ã€‚ç´ æ•°(prime number)å°±æ˜¯åªèƒ½è¢« 1 å’Œå…¶è‡ªèº«æ•´é™¤ï¼Œä¸”å¤§äº 1 çš„è‡ªç„¶æ•°ã€‚ ç´ æ•°ä»å°åˆ°å¤§æœ‰ 2ã€3ã€5ã€7ã€11ã€13â€¦ç›®å‰åœ¨åŠ å¯†æŠ€æœ¯ä¸­è¢«å¹¿æ³›åº”ç”¨çš„ RSA ç®—æ³•å°±ä¼šç”¨åˆ°å¤§ç´ æ•°ï¼Œå› æ­¤â€œç´ æ€§æµ‹è¯•â€åœ¨è¯¥ç®—æ³•ä¸­èµ·åˆ°äº†é‡è¦çš„ä½œç”¨ã€‚","categories":[{"name":"æ•°æ®ç»“æ„ä¸ç®—æ³•","slug":"æ•°æ®ç»“æ„ä¸ç®—æ³•","permalink":"https://guozhe001.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"},{"name":"è¯»ä¹¦ç¬”è®°","slug":"è¯»ä¹¦ç¬”è®°","permalink":"https://guozhe001.github.io/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"}],"tags":[{"name":"è¯»ä¹¦ç¬”è®°","slug":"è¯»ä¹¦ç¬”è®°","permalink":"https://guozhe001.github.io/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"}]},{"title":"åŠ¨æ€è§„åˆ’å­¦ä¹ ","slug":"algorithms/åŠ¨æ€è§„åˆ’","date":"2021-04-01T10:18:21.451Z","updated":"2021-04-01T10:18:21.451Z","comments":true,"path":"2021/04/01/algorithms/åŠ¨æ€è§„åˆ’/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/algorithms/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/","excerpt":"","text":"åŠ¨æ€è§„åˆ’ æœ¬æ¥æƒ³ç”¨5W2Håˆ†ææ³•æ¥è§£é‡Šæ­¤é—®é¢˜ï¼Œä½†æ˜¯å‘ç°æ¯”è¾ƒå›°éš¾ï¼Œè¿˜æ˜¯å…ˆçœ‹ä¾‹å­å§ã€‚åŠ¨æ€è§„åˆ’çš„åŸç†ï¼šåŠ¨æ€è§„åˆ’å…ˆè§£å†³å­é—®é¢˜ï¼Œå†é€æ­¥è§£å†³å¤§é—®é¢˜ã€‚å…ˆæœ‰è¿™ä¸ªç®€å•çš„æ¦‚å¿µå³å¯ï¼Œæˆ‘ä¼šé€šè¿‡ä¾‹å­æ¥è¯´æ˜ã€‚ ä¸¾ä¾‹ï¼šåšä¸ªå°å·é¡¾é—® ä¾‹1ï¼Œæ‰“å®¶åŠ«èˆï¼ˆæ— é™èƒŒåŒ…é—®é¢˜ï¼‰ é—®é¢˜æè¿° åœ¨ä¸‡æ¶çš„èµ„æœ¬ä¸»ä¹‰ç¤¾ä¼šç¾å›½ï¼Œæœ‰ä¸€ä¸ªå°å·ï¼ˆç½—ä¼¯ç‰¹ï¼‰ï¼Œæœ‰ä¸€å¤©æ™šä¸Šç½—ä¼¯ç‰¹ä¸ä»–çš„åŒä¼™å¼€äº†ä¸€è¾†å¡è½¦ï¼ˆå‡å¦‚å¯ä»¥è£…æ— é™çš„ç°é‡‘ï¼‰æ¥åˆ°äº†ä¸€æ’ä¸»äººéƒ½å‡ºé—¨æ—…æ¸¸å»äº†çš„æˆ¿å±‹é¢å‰ï¼Œæ¯é—´æˆ¿å†…éƒ½è—æœ‰ä¸€å®šçš„ç°é‡‘ï¼Œå½±å“ç½—ä¼¯ç‰¹å·çªƒçš„å”¯ä¸€åˆ¶çº¦å› ç´ å°±æ˜¯ç›¸é‚»çš„æˆ¿å±‹è£…æœ‰ç›¸äº’è¿é€šçš„é˜²ç›—ç³»ç»Ÿï¼Œå¦‚æœä¸¤é—´ç›¸é‚»çš„æˆ¿å±‹åœ¨åŒä¸€æ™šä¸Šè¢«å°å·é—¯å…¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æŠ¥è­¦ã€‚ è¯·å¸®ä»–è®¾è®¡ç¨‹åºä»¥å·å–æœ€å¤šçš„ç°é‡‘ã€‚ é—®é¢˜åˆ†æ 1ã€ç®€åŒ–é—®é¢˜ å¦‚æœåªæœ‰ä¸€ä¸ªæˆ¿å­ç½—ä¼¯ç‰¹æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ å¦‚æœæœ‰ä¸¤ä¸ªæˆ¿å­ç½—ä¼¯ç‰¹æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ å¦‚æœæœ‰ä¸‰ä¸ªæˆ¿å­ç½—ä¼¯ç‰¹æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ ä¸ºäº†æ–¹ä¾¿åˆ†æï¼Œæˆ‘ä»¬æŠŠæˆ¿å­çš„æ•°é‡å’Œèƒ½å¤Ÿå·çš„é’±æ•°è®°å½•ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”»ä¸€ä¸ªè¡¨æ ¼å¦‚ä¸‹ï¼š ç¬¬ä¸€åˆ—è¡¨ç¤ºå¦‚æœåªå·å‰é¢çš„nä¸ªæˆ¿å­ ç¬¬äºŒåˆ—è¡¨ç¤ºå¦‚æœåªå·å‰é¢çš„nä¸ªæˆ¿å­æœ€å¤šèƒ½å·å¤šå°‘é’± æ‹¬å·é‡Œé¢çš„æ˜¯å·å“ªäº›æˆ¿å­ 2ã€å„ä¸ªå‡»ç ´ç®€åŒ–åçš„é—®é¢˜ å¦‚æœåªæœ‰å‰é¢ä¸€ä¸ªæˆ¿å­ç½—ä¼¯ç‰¹æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ æˆ¿å­æ•°é‡ æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ 1 $100(1) å¦‚æœåªæœ‰å‰é¢ä¸¤ä¸ªæˆ¿å­ç½—ä¼¯ç‰¹æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿå½“åªæœ‰å‰é¢ä¸¤ä¸ªæˆ¿å­æ—¶ï¼Œå› ä¸ºé™åˆ¶æ¡ä»¶æ˜¯ä¸èƒ½å·ç›¸é‚»çš„æˆ¿å­ä¸ç„¶ä¼šè§¦å‘æŠ¥è­¦ï¼Œæ‰€ä»¥å·å…¶ä¸­é‡‘é¢å¤§çš„é‚£ä¸ªå³å¯ã€‚ æˆ¿å­æ•°é‡ æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ 1 $100(1) 2 $200(2) å¦‚æœåªæœ‰å‰é¢ä¸‰ä¸ªæˆ¿å­ç½—ä¼¯ç‰¹æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿå½“åªæœ‰å‰é¢ä¸‰ä¸ªæˆ¿å­æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹©ï¼Œç¬¬1ç§ï¼šå·ç¬¬ä¸‰ä¸ªå’Œç¬¬ä¸€ä¸ªï¼›ç¬¬2ç§ï¼šå·ç¬¬äºŒä¸ªã€‚ä»ä¸¤ç§é€‰æ‹©ä¸­æŒ‘ä¸€ä¸ªèƒ½å·çš„é‡‘é¢è¾ƒå¤§çš„æ–¹æ³•ã€‚ æˆ¿å­æ•°é‡ æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ 1 $100(1) 2 $200(2) 3 $200(2) å¦‚æœåªæœ‰å‰é¢å››ä¸ªæˆ¿å­ç½—ä¼¯ç‰¹æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ å½“åªæœ‰å‰é¢å››ä¸ªæˆ¿å­æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹©ï¼š ç¬¬1ç§ï¼šå·ç¬¬å››ä¸ªï¼Œå†åŠ ä¸Šå·å‰ä¸¤ä¸ªæˆ¿å­çš„æœ€å¤§å€¼ ç¬¬2ç§ï¼šä¸å·ç¬¬å››ä¸ªï¼Œåªå·å‰é¢ä¸‰ä¸ªæˆ¿å­çš„æœ€å¤§å€¼ ä»ä¸¤ç§é€‰æ‹©ä¸­æŒ‘ä¸€ä¸ªèƒ½å·çš„é‡‘é¢è¾ƒå¤§çš„æ–¹æ³•ã€‚ æˆ¿å­æ•°é‡ æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ 1 $100(1) 2 $200(2) 3 $200(2) 4 $500 = $300(4) + $200(2) å¦‚æœåªæœ‰å‰é¢äº”ä¸ªæˆ¿å­ç½—ä¼¯ç‰¹æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿå½“åªæœ‰å‰é¢äº”ä¸ªæˆ¿å­æ—¶ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹©ï¼š ç¬¬1ç§ï¼šå·ç¬¬äº”ä¸ªï¼Œå†åŠ ä¸Šå·å‰ä¸‰ä¸ªæˆ¿å­çš„æœ€å¤§å€¼ ç¬¬2ç§ï¼šä¸å·ç¬¬äº”ä¸ªï¼Œåªå·å‰é¢å››ä¸ªæˆ¿å­çš„æœ€å¤§å€¼ ä»ä¸¤ç§é€‰æ‹©ä¸­æŒ‘ä¸€ä¸ªèƒ½å·çš„é‡‘é¢è¾ƒå¤§çš„æ–¹æ³•ã€‚ æˆ¿å­æ•°é‡ æœ€å¤šèƒ½å·å¤šå°‘é’±ï¼Ÿ 1 $100(1) 2 $200(2) 3 $200(2) 4 $500 = $300(4) + $200(2) 5 $500 = $300(4) + $200(2) 3ã€æ€»ç»“å½’çº³ æˆ‘ä»¬é€šè¿‡ä¸Šé¢çš„è¡¨æ ¼å¯ä»¥æ€»ç»“å‡ºæ¥ä»€ä¹ˆå—ï¼Ÿæˆ‘ä»¬åœ¨æ­¤çº¦å®šä¸€ä¸ªæ•°å­¦å…¬å¼ï¼štotal(n)è¡¨ç¤ºæœ€å¤§èƒ½å·çš„é‡‘é¢ï¼›ä½¿ç”¨amount(n)è¡¨ç¤ºç¬¬nä¸ªæˆ¿å­æœ‰å¤šå°‘é‡‘é¢æ ¹æ®ä»¥ä¸Šçš„è¡¨æ ¼æˆ‘ä»¬å¯ä»¥çŸ¥é“total(1) = 100 = amount(1) = max(amount(1), 0)total(2) = 200 = max(amount(2), amount(1))total(3) = 200 = max(amount(3) + amount(1), amount(2)) = max(amount(3) + total(3-2), total(2))total(4) = 500 = max(amount(4) + total(4-2), amount(3)) = max(amount(4) + total(4-2), total(3)) total(n) = max(amount(n) + total(n-2), total(n-1)) 4ã€ä»£ç å®ç° ç»è¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬ç«Ÿç„¶æ€»ç»“å‡ºäº†ä¸€ä¸ªå…¬å¼ï¼štotal(n) = max(amount(n) + total(n-2), total(n-1))å¤§å®¶åº”è¯¥å¯¹æ–æ³¢é‚£å¥‘æ•°åˆ—æ¯”è¾ƒç†Ÿæ‚‰ï¼Œä»–çš„å…¬å¼æ˜¯ï¼šf(n) = f(n-1) + f(n-2)ï¼Œç„¶åå¯èƒ½ç¬¬ä¸€ååº”å°±æƒ³åˆ°äº†é€’å½’çš„å®ç°ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨é€’å½’çš„æ–¹å¼è§£å†³ç½—ä¼¯ç‰¹çš„é—®é¢˜æŠŠï¼Ÿshow you the codeï¼š 123456789101112131415161718// é€’å½’æ–¹å¼public int robRecursion(int[] nums) &#123; // å½“æ²¡æœ‰æˆ¿å­æ—¶ if (Objects.isNull(nums) || nums.length == 0) &#123; return 0; &#125; else if (nums.length == 1) &#123; // å½“åªæœ‰ä¸€ä¸ªæˆ¿å­æ—¶ return nums[0]; &#125; else if (nums.length == 2) &#123; // å½“åªæœ‰ä¸¤ä¸ªæˆ¿å­æ—¶ return Math.max(nums[0], nums[1]); &#125; else &#123; // å…¶ä»–æƒ…å†µ // total(n) = max(amount(n) + total(n-2), total(n-1)) return Math.max(nums[nums.length - 1] + robRecursion(Arrays.copyOf(nums, nums.length - 2)), robRecursion(Arrays.copyOf(nums, nums.length - 1))); &#125;&#125; OKï¼Œå¤§åŠŸå‘Šæˆï¼Œä¸Šé¢çš„ä»£ç ç»è¿‡æµ‹è¯•æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œè§£å†³äº†ç½—ä¼¯ç‰¹çš„é—®é¢˜ï¼Œå›å®¶ç¡è§‰ã€‚ç­‰ç­‰ï¼ï¼ï¼æˆ‘ä»¬æ˜¯ä¸æ˜¯å¿˜äº†ä»€ä¹ˆï¼Œè¿™ç¯‡æ–‡ç« çš„æ ‡é¢˜ä¸æ˜¯åŠ¨æ€è§„åˆ’å—ï¼ŒåŠ¨æ€è§„åˆ’å‘¢ï¼Ÿ**è®©æˆ‘ä»¬å†å›å¤´çœ‹ä¸€ä¸‹é€’å½’çš„æ–¹å¼å®ç°ï¼Œæ¯å½“è¦è®¡ç®—total(n)æ—¶ï¼Œå°±å…ˆè®¡ç®—total(n-1)å’Œtotal(n-2)ï¼Œå¦‚æœè¯´æˆ‘ä»¬å…ˆè®¡ç®—å‡ºæ¥total(n-1)å’Œtotal(n-2)æ˜¯ä¸æ˜¯è®¡ç®—total(n)çš„æ—¶å€™å°±ä¸ç”¨é‡æ–°è®¡ç®—total(n-1)å’Œtotal(n-2)äº†ï¼ŸæŒ‰ç…§è¿™ä¸ªæ€è·¯æˆ‘ä»¬å°±éœ€è¦æŠŠæ¯æ¬¡è®¡ç®—å‡ºçš„total(n-1)å’Œtotal(n-2)çš„ç»“æœè®°å½•ä¸‹æ¥ï¼Œç­‰è®¡ç®—total(n)çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥ç”¨äº†ã€‚show you the codeï¼š 12345678910111213141516171819202122232425// åŠ¨æ€è§„åˆ’æ–¹å¼public int rob(int[] nums) &#123; /* * åˆå§‹åŒ–åŠ¨æ€è§„åˆ’çš„æ•°ç»„ï¼Œæ­¤æ—¶çš„æ•°ç»„ä¸­çš„å€¼éƒ½æ˜¯0 * æ­¤æ•°ç»„çš„ä¸‹æ ‡ä¸ºå·å–çš„å‰nä¸ªæˆ¿å±‹çš„æ•°é‡ * æ­¤æ•°ç»„çš„å€¼ä¸ºå·å–çš„å‰nä¸ªæˆ¿å±‹å¯ä»¥å·å–çš„é‡‘é’±æœ€å¤§å€¼ * å¦‚æœdp[5] = 100ï¼›è¡¨ç¤ºå·å–å‰é¢çš„5å®¶æˆ¿å±‹ï¼Œæœ€å¤šå¯ä»¥å·å–100åˆ€ */ int[] dp = new int[nums.length + 1]; for (int i = 1; i &lt;= nums.length; i++) &#123; int amountOfNumberI = nums[i - 1]; // å¦‚æœåªå·ç¬¬ä¸€ä¸ªæˆ¿å­ if (i == 1) &#123; dp[i] = amountOfNumberI; &#125; else &#123; /* * æ­¤æ—¶æœ‰ä¸¤ç§é€‰æ‹©:1ã€å·å½“å‰çš„æˆ¿å±‹ï¼›2ã€ä¸å·å½“å‰çš„æˆ¿å±‹ï¼Œä¸¤ç§é€‰æ‹©å–æœ€å¤§å€¼ * å¦‚æœé€‰æ‹©1ï¼Œåˆ™è¦è®¡ç®—å½“å‰æˆ¿å±‹çš„é‡‘é’±ä¸å½“å‰æˆ¿å±‹å‰ä¸€ä¸ªä¸ç›¸é‚»çš„æ‰€æœ‰æˆ¿å±‹çš„é‡‘é’±ä»·å€¼ * å¦‚æœé€‰æ‹©2ï¼Œåˆ™ç›´æ¥å–å½“å‰æˆ¿å±‹ä¹‹å‰çš„æ‰€æœ‰æˆ¿å±‹èƒ½å¤Ÿå·çš„é‡‘é’±æœ€å¤§å€¼ */ dp[i] = Math.max(amountOfNumberI + dp[i - 2], dp[i - 1]); &#125; &#125; return dp[nums.length];&#125; æ­å–œä½ ï¼Œä¸Šé¢çš„ä»£ç å°±æ˜¯åŠ¨æ€è§„åˆ’çš„æ–¹å¼ï¼›ä¸é€’å½’çš„æ–¹å¼ä¸åŒï¼Œæ¯æ¬¡çš„è®¡ç®—ç»“æœéƒ½ä¿å­˜åœ¨äº†dpæ•°ç»„ä¸­ï¼Œè®¡ç®—ä¸‹ä¸€ä¸ªå€¼æ—¶ç›´æ¥ä»æ•°ç»„ä¸­è·å–ä»¥å‰è®¡ç®—è¿‡çš„å€¼å³å¯ã€‚ç½—ä¼¯ç‰¹å·ä¸€æ’æˆ¿å­çš„æºç  ä¾‹2ï¼ŒèƒŒåŒ…é—®é¢˜ é—®é¢˜æè¿° æœ‰ä¸€å¤©ç½—ä¼¯ç‰¹å¸¦ç€ä¸€ä¸ªå¯ä»¥è£…4kgçš„èƒŒåŒ…ï¼Œå»äº†ä¸€å®¶å°å•†åº—ï¼Œå°å•†åº—é‡Œé¢æœ‰ä¸‹é¢è‡³å°‘ä¸‰ä¸ªå•†å“ï¼›è¯·å¸®åŠ©ä»–å†³å®šåº”è¯¥å·å“ªäº›å•†å“ã€‚ å•†å“åç§° å•†å“ä»·æ ¼ï¼ˆå•ä½$ï¼‰ å•†å“é‡é‡ï¼ˆå•ä½kgï¼‰ å‰ä»– 1500 1 éŸ³ç®± 3000 4 ç”µè„‘ 2000 3 â€¦ â€¦ â€¦ é—®é¢˜åˆ†æ é¦–å…ˆæ‹¿åˆ°è¿™ä¸ªé—®é¢˜å¯èƒ½ä¸€çœ¼å°±çœ‹å‡ºæ¥äº†ç­”æ¡ˆï¼Œå°±æ˜¯å·å‰ä»–å’Œç”µè„‘ï¼›é‚£ä¹ˆå¦‚æœè¯´å•†å“æ•°é‡æ˜¯100ä¸ªçš„è¯æ˜¯æ— æ³•ä¸€çœ¼çœ‹å‡ºç­”æ¡ˆçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ€ä¹ˆå»å¸®ç½—ä¼¯ç‰¹å†³ç­–å‘¢ï¼Ÿ æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹é—®é¢˜çš„å…³é”®ï¼š å®¹é‡4kgçš„èƒŒåŒ… è‡³å°‘ä¸‰ä¸ªä¸åŒä»·æ ¼å’Œä¸åŒé‡é‡çš„å•†å“ ä¸€ä¸ªå•†å“è¦å˜›å…¨å·è¦å˜›ä¸å·ï¼Œä¸èƒ½åªå·ä¸€éƒ¨åˆ† å·çš„å•†å“åˆ—è¡¨èƒŒåŒ…å¿…é¡»èƒ½è£…çš„ä¸‹ï¼Œå¹¶ä¸”ä»·æ ¼æœ€å¤§ 1ã€ç®€åŒ–é—®é¢˜ ç®€åŒ–é—®é¢˜çš„è¿‡ç¨‹ï¼š æœ€ç®€å•çš„æ˜¯ä»€ä¹ˆï¼Ÿåªæœ‰ä¸€ä¸ªå•†å“ï¼Œåªèƒ½è£…1kgçš„èƒŒåŒ… å¢åŠ ç‚¹éš¾åº¦ï¼Œåªæœ‰ä¸€ä¸ªå•†å“ï¼ŒèƒŒåŒ…çš„é‡é‡é€æ¸å¢åŠ åˆ°ç½—ä¼¯ç‰¹çš„èƒŒåŒ…é‡é‡ ç»§ç»­å¢åŠ éš¾åº¦ï¼Œåªæœ‰ä¸¤ä¸ªå•†å“ï¼Œ1kgçš„èƒŒåŒ…èƒ½å·ä»€ä¹ˆï¼Ÿ2kgçš„èƒŒåŒ…èƒ½å·ä»€ä¹ˆï¼Ÿ3kgã€4kgå‘¢ï¼Ÿ æœ‰ä¸‰ä¸ªå•†å“ï¼Œ1kgçš„èƒŒåŒ…èƒ½å·ä»€ä¹ˆï¼Ÿ2kgçš„èƒŒåŒ…èƒ½å·ä»€ä¹ˆï¼Ÿ3kgã€4kgå‘¢ï¼Ÿ æœ‰nä¸ªå•†å“å’Œèƒ½è£…mkgçš„èƒŒåŒ… 2ã€ç®€åŒ–åçš„é—®é¢˜å„ä¸ªå‡»ç ´ æŠŠé—®é¢˜æœ€å°åŒ–ï¼šåªæœ‰ä¸€ä¸ªå•†å“ï¼Œåªèƒ½è£…1kgçš„èƒŒåŒ… åˆ°è¿™é‡Œå…¶å®æˆ‘ä»¬è¿˜æ˜¯æ— æ³•çŸ¥é“åˆ°åº•åº”è¯¥æ€ä¹ˆå¸®ç½—ä¼¯ç‰¹å†³ç­–ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä¸å¯ä»¥æŠŠé—®é¢˜ç®€åŒ–ä¸€ä¸‹ï¼Œå‡å¦‚èƒŒåŒ…å®¹é‡æ˜¯1ï¼Œå•†å“ä¸ªæ•°ä¹Ÿæ˜¯1åªæœ‰ä¸€æŠŠå‰ä»–ï¼›å¦‚ä¸‹ï¼š å®¹é‡1kgçš„èƒŒåŒ… 1æŠŠé‡é‡æ˜¯1kgä»·æ ¼æ˜¯$1500çš„å‰ä»– å¦‚æœæ˜¯ä¸Šé¢ç®€åŒ–åçš„é—®é¢˜ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥è®¡ç®—çš„ï¼Œè®¡ç®—æ–¹æ³•æ˜¯ï¼šåˆ¤æ–­å‰ä»–èƒ½å¦è£…å…¥èƒŒåŒ…ï¼Œå¦‚æœå¯ä»¥åˆ™1kgå®¹é‡çš„èƒŒåŒ…å¯ä»¥å·å‰ä»–ï¼Œæœ€å¤§ä»·æ ¼æ˜¯$1500ï¼Œæˆ‘ä»¬ç»§ç»­ä½¿ç”¨ä¸€ä¸ªè¡¨æ ¼æŠŠå®ƒè®°å½•ä¸‹æ¥ï¼šæˆ‘ä»¬å…ˆçº¦å®šå¥½è¡¨æ ¼çš„å†…å®¹ï¼š è¡Œè¡¨ç¤ºèƒŒåŒ…çš„å®¹é‡ åˆ—è¡¨ç¤ºæœ‰å“ªäº›å•†å“ å•å…ƒæ ¼çš„æ•°å­—è¡¨ç¤ºå¯ä»¥å·çš„æœ€å¤§å€¼ æ‹¬å·é‡Œé¢æ˜¯å·å“ªäº›å•†å“ | å•†å“\\å®¹é‡ | 1 | | â€” | â€” | | å‰ä»– | 1500ï¼ˆå‰ä»–ï¼‰ | æˆ‘ä»¬æ˜¯å¦‚ä½•å¾—åˆ°ä¸Šé¢çš„è¡¨æ ¼çš„å‘¢ï¼Ÿåˆ¤æ–­å‰ä»–æ˜¯å¦èƒ½è£…è¿›å®¹é‡ä¸º1kgçš„èƒŒåŒ…ä¸­ï¼Œå¦‚æœå¯ä»¥åˆ™å·å‰ä»–ï¼Œå‰ä»–çš„ä»·æ ¼ä¹Ÿå°±æ˜¯å·å–çš„æœ€å¤§çš„ä»·æ ¼ã€‚ å¢åŠ éš¾åº¦ï¼Œå¢åŠ èƒŒåŒ…çš„å®¹é‡ï¼šåªæœ‰ä¸€ä¸ªå•†å“ï¼ŒèƒŒåŒ…çš„é‡é‡é€æ¸å¢åŠ åˆ°ç½—ä¼¯ç‰¹çš„èƒŒåŒ…é‡é‡ æˆ‘ä»¬åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šå†æŠŠèƒŒåŒ…çš„å®¹é‡å¢åŠ ï¼Œç›´åˆ°å¢åŠ åˆ°ä¸ç½—ä¼¯ç‰¹çš„èƒŒåŒ…ç›¸åŒçš„å®¹é‡ä¸ºæ­¢ï¼Œä½†æ˜¯ä¾ç„¶åªå¯ä»¥å·å–ä¸€æŠŠå‰ä»–ï¼›æˆ‘ä»¬æŠŠè¿™äº›ä¿¡æ¯è®°å½•ä¸‹æ¥å¦‚ä¸‹ï¼Œå…¶ä¸­ç¬¬ä¸€åˆ—ä¸ºå•†å“ï¼Œç¬¬ä¸€è¡Œä¸ºèƒŒåŒ…å®¹é‡ï¼Œè¡¨æ ¼è®°å½•çš„æ˜¯å·å–å•†å“çš„æœ€å¤§ä»·æ ¼ï¼Œæ‹¬å·é‡Œé¢çš„æ˜¯å·å–çš„å•†å“ã€‚å¦‚ä¸‹è¡¨çš„çº¢è‰²éƒ¨åˆ†å°±ä»£è¡¨ï¼ŒèƒŒåŒ…å®¹é‡ä¸º4åªæœ‰ä¸€æŠŠå‰ä»–å¯å·æ—¶ï¼Œå¯ä»¥å·å–çš„å•†å“æœ€å¤§ä»·æ ¼æ˜¯1500ï¼Œå·å–çš„å•†å“æ˜¯å‰ä»–ã€‚ å•†å“\\å®¹é‡ 1 2 3 4 å‰ä»– 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ ç»§ç»­å¢åŠ éš¾åº¦ï¼Œå¢åŠ ä¸€ä¸ªå•†å“ æˆ‘ä»¬å†åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šï¼Œå¢åŠ å¯ä»¥å·å–çš„å•†å“ï¼Œå†åŠ ä¸€ä¸ªéŸ³ç®±ï¼Œç„¶åä½¿ç”¨ç›¸åŒçš„æ–¹æ³•ç»˜åˆ¶ä¸Šé¢çš„è¡¨æ ¼ï¼› å•†å“\\å®¹é‡ 1 2 3 4 å‰ä»– 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ éŸ³ç®± 1500ï¼ˆå‰ä»–ï¼‰ ä¸Šé¢å¯ä»¥çœ‹åˆ°**table[éŸ³ç®±][å®¹é‡1]**çš„å•å…ƒæ ¼çš„å€¼å¦‚ä¸Šè¡¨æ˜¯1500,å› ä¸ºå®¹é‡æ˜¯1çš„èƒŒåŒ…æ— æ³•è£…ä¸‹éŸ³ç®±ï¼Œæ‰€ä»¥ä¾ç„¶åªèƒ½å·å‰ä»–ï¼Œæ‰€ä»¥å¯ä»¥å·å–çš„å•†å“çš„æœ€å¤§çš„ä»·æ ¼ä¸º1500ã€‚è®©æˆ‘ä»¬å®Œæˆè¿™ä¸ªè¡¨æ ¼çš„å¡«å†™ï¼š å•†å“\\å®¹é‡ 1 2 3 4 å‰ä»– 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ éŸ³ç®± 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ 3000ï¼ˆéŸ³ç®±ï¼‰ å¦‚ä¸Šè¡¨æ‰€ç¤ºï¼Œå½“èƒŒåŒ…å®¹é‡ä¸º4æ—¶ï¼Œå¯ä»¥è£…ä¸‹éŸ³ç®±ï¼Œå¹¶ä¸”éŸ³ç®±çš„ä»·æ ¼3000å¤§äº**table[å‰ä»–][å®¹é‡4]çš„1500ï¼Œæ‰€ä»¥æ­¤æ—¶æˆ‘ä»¬è®¾ç½®table[éŸ³ç®±][å®¹é‡4]çš„å•å…ƒæ ¼çš„æœ€å¤§ä»·æ ¼ä¸º3000ã€‚table[éŸ³ç®±][å®¹é‡4] = Max(å½“å‰è¡Œè®¡ç®—çš„å€¼, table[å‰ä»–][å®¹é‡4]) ç»§ç»­å¢åŠ éš¾åº¦ï¼Œå†å¢åŠ ä¸€ä¸ªå•†å“å†å¢åŠ ä¸€ä¸ªå•†å“ æˆ‘ä»¬ç»§ç»­æŠŠç”µè„‘å¢åŠ åˆ°å¯ä»¥å·å–çš„å•†å“åˆ—è¡¨ä¸­ï¼Œç„¶åç»§ç»­ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•ç”»å‡ºç”µè„‘è¡Œçš„å‰ä¸‰ä¸ªå®¹é‡çš„å•å…ƒæ ¼å¦‚ä¸‹ï¼šæ­¤æ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°**table[ç”µè„‘][å®¹é‡3]**çš„å€¼åº”è¯¥æ˜¯2000ï¼Œå› ä¸ºå®¹é‡æ˜¯3æ—¶å¯ä»¥è£…ä¸‹ç”µè„‘ï¼Œè€Œä¸”ç”µè„‘çš„ä»·æ ¼æ¯”å‰ä»–çš„ä»·æ ¼é«˜ï¼Œæ‰€ä»¥æ­¤æ—¶ç½—ä¼¯ç‰¹åº”è¯¥å·ç”µè„‘è€Œä¸æ˜¯å‰ä»–ã€‚ å•†å“\\å®¹é‡ 1 2 3 4 å‰ä»– 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ éŸ³ç®± 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ 3000ï¼ˆéŸ³ç®±ï¼‰ ç”µè„‘ 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ 2000ï¼ˆç”µè„‘ï¼‰ table[ç”µè„‘][å®¹é‡3] = Max(å½“å‰è¡Œè®¡ç®—çš„å€¼, table[éŸ³ç®±][å®¹é‡3])æˆ‘ä»¬ç»§ç»­çœ‹æœ€åä¸€ä¸ªå•å…ƒæ ¼ï¼ˆ**table[ç”µè„‘][å®¹é‡4]ï¼‰**åº”è¯¥å¡«ä»€ä¹ˆï¼Œå¦‚æœç½—ä¼¯ç‰¹å·ç”µè„‘ï¼Œåˆ™èƒŒåŒ…å®¹é‡è¿˜å‰©ä¸‹1ï¼Œè€Œå®¹é‡ä¸º1çš„èƒŒåŒ…å¯ä»¥å·å–çš„å•†å“ä»·æ ¼æœ€å¤§å€¼æ˜¯1500ï¼Œå·å–çš„å•†å“æ˜¯å‰ä»–ï¼Œæ‰€ä»¥æ­¤æ—¶å¯ä»¥é€‰æ‹©å·å–ç”µè„‘+å‰ä»–ï¼Œä»·æ ¼æ˜¯2000+1500=3500ï¼›è¿™æ¯”ä¹‹å‰è®°å½•çš„èƒŒåŒ…å®¹é‡æ˜¯4æ—¶çš„å•†å“æœ€å¤§å€¼ï¼ˆ3000ï¼‰å¤§ï¼Œæ‰€ä»¥è¿™ä¸ªå•å…ƒæ ¼çš„ä»·æ ¼åº”è¯¥æ˜¯3500ï¼Œå·å–çš„å•†å“æ˜¯ç”µè„‘+å‰ä»– å•†å“\\å®¹é‡ 1 2 3 4 å‰ä»– 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ éŸ³ç®± 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ 3000ï¼ˆéŸ³ç®±ï¼‰ ç”µè„‘ 1500ï¼ˆå‰ä»–ï¼‰ 1500ï¼ˆå‰ä»–ï¼‰ 2000ï¼ˆç”µè„‘ï¼‰ 3500ï¼ˆç”µè„‘+å‰ä»–ï¼‰ table[ç”µè„‘][å®¹é‡4] = Max(å½“å‰è¡Œè®¡ç®—çš„å€¼ + å‰©ä½™å®¹é‡å¯ä»¥å·å–çš„æœ€å¤§å€¼, table[éŸ³ç®±][å®¹é‡3])OKï¼Œå®Œæˆä¸Šé¢çš„è¡¨æ ¼ä¹‹åæˆ‘ä»¬å°±å¯ä»¥ç¡®å®šï¼Œç½—ä¼¯ç‰¹åº”è¯¥å·ç”µè„‘+å‰ä»–ï¼Œå•†å“çš„ä»·æ ¼ä¸º3500ã€‚éšç€æˆ‘ä»¬ä¸æ–­çš„å¡«å†™è¡¨æ ¼ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ç»“æœæœ€ç»ˆä¿å­˜åœ¨è¡¨æ ¼çš„å³ä¸‹è§’ï¼Œå³**table[ç”µè„‘][å®¹é‡4]**çš„å•å…ƒæ ¼å†…ã€‚ 2ã€æ€»ç»“å½’çº³ è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹æ¯ä¸ªå•å…ƒæ ¼å¡«å†™çš„è§„å¾‹ï¼šå‡è®¾èƒŒåŒ…æ€»å®¹é‡ä¸ºVï¼Œå•†å“çš„æ•°é‡æ˜¯Mï¼Œç¬¬iä¸ªå•†å“çš„é‡é‡æ˜¯Wiï¼Œä»·æ ¼æ˜¯Piï¼Œå®¹é‡æ˜¯vï¼ˆ1&lt;v&lt;=Vï¼‰æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å…¬å¼ï¼šf(i,v) = Wi &lt;= v ? max(Pi + f(i-1, v-Wi), f(i-1, v)) : f(i-1, v)åˆ†è§£ä¸Šé¢çš„å…¬å¼ï¼š æƒ…å½¢ å€¼ Wi &lt;= v max(Pi + f(i-1, v-Wi), f(i-1, v)) Wi &gt; v f(i-1, v) 3ã€ä»£ç å®ç°æˆ‘ä»¬ç»§ç»­ç”¨ä¸Šé¢ç½—ä¼¯ç‰¹æ‰“å®¶åŠ«èˆçš„æ€è·¯ï¼ŒæŠŠå·²ç»è®¡ç®—è¿‡çš„å€¼ä¿å­˜ä¸‹æ¥ï¼Œç„¶ååœ¨ç”¨åˆ°çš„æ—¶å€™ç›´æ¥å–ç”¨ã€‚å› ä¸ºå½“å‰é—®é¢˜æœ‰å¤šä¸ªå•†å“å’Œå¤šç§èƒŒåŒ…å®¹é‡ä¸¤ä¸ªé™åˆ¶çº¬åº¦ï¼Œæ‰€ä»¥åœ¨è®°å½•æ—¶éœ€è¦ç”¨åˆ°äºŒç»´æ•°ç»„ã€‚show you the codeï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950 /** * ç»™å‡ºå•†å“åˆ—è¡¨å’ŒèƒŒåŒ…çš„å®¹é‡ï¼Œè¯·è®¡ç®—å·å–å“ªäº›å•†å“å¯ä»¥è¾¾åˆ°ä»·æ ¼æœ€å¤§åŒ–ï¼Œæœ€å¤§çš„ä»·æ ¼æ˜¯å¤šå°‘ï¼Ÿ * * @param products å•†å“åˆ—è¡¨ * @param bagCapacity èƒŒåŒ…å®¹é‡ * @return èƒ½å¤Ÿå·å–çš„å•†å“æœ€å¤§çš„ä»·æ ¼ä¹‹å’Œ */ public int stealMaxPrice(Product[] products, int bagCapacity) &#123; /* * äºŒç»´æ•°ç»„ï¼Œè®°å½•å·²ç»è®¡ç®—è¿‡çš„æœ€å¤§ä»·æ ¼ * äºŒç»´æ•°ç»„æ¯”å•†å“çš„ä¸ªæ•°å¤š1ï¼Œæ¯”èƒŒåŒ…çš„å¤§å°å¤š1ï¼ŒåŸå› æ˜¯ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ç›¸åŒçš„å…¬å¼ï¼Œç¬¬0è¡Œå’Œç¬¬0åˆ—çš„å€¼éƒ½æ˜¯0 */ int[][] table = new int[products.length + 1][bagCapacity + 1]; for (int j = 1; j &lt;= products.length; j++) &#123; Product product = products[j - 1]; for (int currentBagCapacity = 1; currentBagCapacity &lt;= bagCapacity; currentBagCapacity++) &#123; table[j][currentBagCapacity] = product.weight &lt;= currentBagCapacity ? Math.max(product.price + table[j - 1][currentBagCapacity - product.weight], table[j - 1][currentBagCapacity]) : table[j - 1][currentBagCapacity]; &#125; &#125; return table[products.length][bagCapacity]; &#125; /** * å•†å“ä¿¡æ¯ */ static class Product &#123; public Product(String name, int price, int weight) &#123; this.name = name; this.price = price; this.weight = weight; &#125; /** * å•†å“åç§° */ String name; /** * å•†å“ä»·æ ¼(å•ä½$) */ int price; /** * å•†å“é‡é‡(å•ä½ç£…) */ int weight; &#125;&#125; ä»£ç ä¸­çš„tableæœ€ç»ˆæ˜¯è¿™æ ·çš„ï¼š 0 0 0 0 0 0 0 1500 1500 1500 1500 1500 0 1500 1500 1500 1500 3000 0 1500 1500 1500 2000 3500 å…¶å®ä¸Šé¢çš„ä»£ç æˆ‘ç®€åŒ–äº†ä¸€ä¸‹ï¼Œè¿”å›çš„æ˜¯æœ€å¤§èƒ½å·çš„ä»·æ ¼ï¼Œè€Œç½—ä¼¯ç‰¹å½“ç„¶æ˜¯è¦ä»·æ ¼æœ€å¤§çš„å•†å“åˆ—è¡¨äº†ï¼Œè¿™ä¸ªå®ç°æ¯”è¾ƒéº»çƒ¦ä¸è´´åœ¨è¿™é‡Œäº†å¯ä»¥çœ‹æºç  ä»€ä¹ˆæ˜¯åŠ¨æ€è§„åˆ’ï¼ˆè‹±è¯­ï¼šDynamic programmingï¼Œç®€ç§°DPï¼‰ æ¦‚å¿µï¼š åŠ¨æ€è§„åˆ’æ˜¯ä¸€ç§åœ¨æ•°å­¦ã€ç®¡ç†ç§‘å­¦ã€è®¡ç®—æœºç§‘å­¦ã€ç»æµå­¦å’Œç”Ÿç‰©ä¿¡æ¯å­¦ä¸­ä½¿ç”¨çš„ï¼Œé€šè¿‡æŠŠåŸé—®é¢˜åˆ†è§£ä¸ºç›¸å¯¹ç®€å•çš„å­é—®é¢˜çš„æ–¹å¼æ±‚è§£å¤æ‚é—®é¢˜çš„æ–¹æ³•ã€‚ ç”¨é€”ï¼š åŠ¨æ€è§„åˆ’å¸¸å¸¸é€‚ç”¨äºæœ‰é‡å å­é—®é¢˜å’Œæœ€ä¼˜å­ç»“æ„æ€§è´¨çš„é—®é¢˜ï¼ŒåŠ¨æ€è§„åˆ’æ–¹æ³•æ‰€è€—æ—¶é—´å¾€å¾€è¿œå°‘äºæœ´ç´ è§£æ³•ã€‚åŠ¨æ€è§„åˆ’èƒŒåçš„åŸºæœ¬æ€æƒ³éå¸¸ç®€å•ã€‚å¤§è‡´ä¸Šï¼Œè‹¥è¦è§£ä¸€ä¸ªç»™å®šé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è§£å…¶ä¸åŒéƒ¨åˆ†ï¼ˆå³å­é—®é¢˜ï¼‰ï¼Œå†æ ¹æ®å­é—®é¢˜çš„è§£ä»¥å¾—å‡ºåŸé—®é¢˜çš„è§£ã€‚ é€‚ç”¨æƒ…å†µ æœ€ä¼˜å­ç»“æ„æ€§è´¨ã€‚ å¦‚æœé—®é¢˜çš„æœ€ä¼˜è§£æ‰€åŒ…å«çš„å­é—®é¢˜çš„è§£ä¹Ÿæ˜¯æœ€ä¼˜çš„ï¼Œæˆ‘ä»¬å°±ç§°è¯¥é—®é¢˜å…·æœ‰æœ€ä¼˜å­ç»“æ„æ€§è´¨ï¼ˆå³æ»¡è¶³æœ€ä¼˜åŒ–åŸç†ï¼‰ã€‚ æœ€ä¼˜å­ç»“æ„æ€§è´¨ä¸ºåŠ¨æ€è§„åˆ’ç®—æ³•è§£å†³é—®é¢˜æä¾›äº†é‡è¦çº¿ç´¢ã€‚ æ— åæ•ˆæ€§ã€‚ å³å­é—®é¢˜çš„è§£ä¸€æ—¦ç¡®å®šï¼Œå°±ä¸å†æ”¹å˜ï¼Œä¸å—åœ¨è¿™ä¹‹åã€åŒ…å«å®ƒçš„æ›´å¤§çš„é—®é¢˜çš„æ±‚è§£å†³ç­–å½±å“ã€‚ å­é—®é¢˜é‡å æ€§è´¨ã€‚ å­é—®é¢˜é‡å æ€§è´¨æ˜¯æŒ‡åœ¨ç”¨é€’å½’ç®—æ³•è‡ªé¡¶å‘ä¸‹å¯¹é—®é¢˜è¿›è¡Œæ±‚è§£æ—¶ï¼Œæ¯æ¬¡äº§ç”Ÿçš„å­é—®é¢˜å¹¶ä¸æ€»æ˜¯æ–°é—®é¢˜ï¼Œæœ‰äº›å­é—®é¢˜ä¼šè¢«é‡å¤è®¡ç®—å¤šæ¬¡ã€‚ åŠ¨æ€è§„åˆ’ç®—æ³•æ­£æ˜¯åˆ©ç”¨äº†è¿™ç§å­é—®é¢˜çš„é‡å æ€§è´¨ï¼Œå¯¹æ¯ä¸€ä¸ªå­é—®é¢˜åªè®¡ç®—ä¸€æ¬¡ï¼Œç„¶åå°†å…¶è®¡ç®—ç»“æœä¿å­˜åœ¨ä¸€ä¸ªè¡¨æ ¼ä¸­ï¼Œå½“å†æ¬¡éœ€è¦è®¡ç®—å·²ç»è®¡ç®—è¿‡çš„å­é—®é¢˜æ—¶ï¼Œåªæ˜¯åœ¨è¡¨æ ¼ä¸­ç®€å•åœ°æŸ¥çœ‹ä¸€ä¸‹ç»“æœï¼Œä»è€Œè·å¾—è¾ƒé«˜çš„æ•ˆç‡ï¼Œé™ä½äº†æ—¶é—´å¤æ‚åº¦ã€‚ ### é‡å å­é—®é¢˜ï¼šå¦‚ä½•ç†è§£è¿™ä¸ªæ¦‚å¿µå‘¢ï¼ŸFibnacciæ•°åˆ— 1234567public int fib(int n)&#123; assert n &gt;=0; if(n&lt;2)&#123; return n; &#125; return fib(n-2) + fib(n-1);&#125; åœ¨ä¸Šé¢çš„æ–æ³¢é‚£å¥‘æ•°åˆ—çš„é€’å½’çš„å®ç°æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¼ å…¥çš„å‚æ•°nç­‰äº8æˆ–è€…ç­‰äº10çš„æ—¶å€™ï¼Œç¬¬mï¼ˆm&lt;nï¼‰ä¸ªæ•°å­—æ˜¯å˜åŒ–çš„å—ï¼Ÿ 123456789101112public int fib(int n) &#123; assert n &gt;= 0; int[] c = new int[n + 1]; for (int i = 0; i &lt;= n; i++) &#123; if (i &lt; 2) &#123; c[i] = i; &#125; else &#123; c[i] = c[i - 2] + c[i - 1]; &#125; &#125; return c[n];&#125; åŠ¨æ€è§„åˆ’æ˜¯é€’å½’ç®—æ³•çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œä¸€èˆ¬æ¥è¯´èƒ½ç”¨é€’å½’çš„éƒ½å¯ä»¥æ€è€ƒä¸€ä¸‹èƒ½ä¸èƒ½ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„æ–¹å¼ä¼˜åŒ–ã€‚ æœ€ä¼˜å­ç»“æ„æ€§è´¨ ä¸Šé¢ä¸¤ä¸ªç½—ä¼¯ç‰¹çš„ä¾‹å­å°±æ˜¯æœ€â€œä¼˜è‡ªç»“æ„æ€§è´¨â€çš„é—®é¢˜ï¼Œä¸å¥½è§£é‡Šå¤§å®¶å¯ä»¥è‡ªå·±ä½“ä¼šã€‚ æ€»ç»“ï¼šåˆ¤æ–­æ˜¯å¦å¯ä»¥ç”¨åŠ¨æ€è§„åˆ’è§£å†³é—®é¢˜çš„æ ¸å¿ƒæ˜¯ï¼šå¤§è§„æ¨¡çš„é—®é¢˜æ˜¯å¦èƒ½å¤Ÿé€šè¿‡è¾ƒå°è§„æ¨¡çš„é—®é¢˜æ¥è§£å†³ã€‚ æ•ˆç‡ï¼š é€šå¸¸è®¸å¤šå­é—®é¢˜éå¸¸ç›¸ä¼¼ï¼Œä¸ºæ­¤åŠ¨æ€è§„åˆ’æ³•è¯•å›¾ä»…ä»…è§£å†³æ¯ä¸ªå­é—®é¢˜ä¸€æ¬¡ï¼Œä»è€Œå‡å°‘è®¡ç®—é‡ï¼šä¸€æ—¦æŸä¸ªç»™å®šå­é—®é¢˜çš„è§£å·²ç»ç®—å‡ºï¼Œåˆ™å°†å…¶è®°å¿†åŒ–å­˜å‚¨ï¼Œä»¥ä¾¿ä¸‹æ¬¡éœ€è¦åŒä¸€ä¸ªå­é—®é¢˜è§£ä¹‹æ—¶ç›´æ¥æŸ¥è¡¨ã€‚è¿™ç§åšæ³•åœ¨é‡å¤å­é—®é¢˜çš„æ•°ç›®å…³äºè¾“å…¥çš„è§„æ¨¡å‘ˆæŒ‡æ•°å¢é•¿æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚ ä¸€äº›å¯ä»¥ä½¿ç”¨åŠ¨æ€è§„åˆ’è§£å†³çš„å¸¸è§é¢˜ç›® çˆ¬æ¥¼æ¢¯é—®é¢˜ æœ€é•¿å­ä¸²ï¼ˆå­ä¸²éœ€è¦è¿ç»­ï¼‰ æœ€é•¿å­åºåˆ—ï¼ˆå­åºåˆ—ä¸éœ€è¦è¿ç»­ï¼‰ æœ€é•¿å­ä¸²çš„å˜ç§ï¼šæœ€é•¿å›æ–‡å­ä¸²ï¼ˆå›æ–‡ï¼šâ€œä¸Šæµ·è‡ªæ¥æ°´æ¥è‡ªæµ·ä¸Šâ€ï¼‰ DNAåºåˆ—æ¯”å¯¹ åŠ¨æ€è§„åˆ’ä¸å¯ä»¥è§£å†³ä»€ä¹ˆé—®é¢˜ å¯ä»¥æ‹†åˆ†çš„å•†å“ï¼ˆå¦‚ç½—ä¼¯ç‰¹æ‹¿ç€4kgçš„èƒŒåŒ…å·å››è¢‹ä¸åŒä»·æ ¼çš„è±†å­ï¼ˆè¿™äº›å•†å“å¯ä»¥æ‹†åˆ†ï¼‰ï¼‰","categories":[{"name":"æ•°æ®ç»“æ„ä¸ç®—æ³•","slug":"æ•°æ®ç»“æ„ä¸ç®—æ³•","permalink":"https://guozhe001.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"æ•°æ®ç»“æ„ä¸ç®—æ³•","slug":"æ•°æ®ç»“æ„ä¸ç®—æ³•","permalink":"https://guozhe001.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"},{"name":"åŠ¨æ€è§„åˆ’","slug":"åŠ¨æ€è§„åˆ’","permalink":"https://guozhe001.github.io/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"}]},{"title":"IDEAå®‰è£…leetcodeæ’ä»¶","slug":"algorithms/IDEAå®‰è£…leetcodeæ’ä»¶","date":"2021-04-01T10:18:21.449Z","updated":"2021-04-01T10:18:21.451Z","comments":true,"path":"2021/04/01/algorithms/IDEAå®‰è£…leetcodeæ’ä»¶/","link":"","permalink":"https://guozhe001.github.io/2021/04/01/algorithms/IDEA%E5%AE%89%E8%A3%85leetcode%E6%8F%92%E4%BB%B6/","excerpt":"","text":"ä¸ºä»€ä¹ˆå®‰è£…leetcodeæ’ä»¶ å½“ç„¶æ˜¯åˆ·é¢˜äº†ï¼Œç¨‹åºå‘˜éƒ½æ‡‚çš„ã€‚å®˜æ–¹åœ°å€ï¼š åŠ›æ‰£ (leetcode) å®˜ç½‘ - å…¨çƒæå®¢æŒšçˆ±çš„æŠ€æœ¯æˆé•¿å¹³å° å¦‚ä½•å®‰è£…leetcodeæ’ä»¶ å®‰è£…IDEAæ’ä»¶ æ’ä»¶åœ°å€ï¼šleetcode editorï¼›æ’ä»¶å¦‚ä½•å®‰è£…ç•¥ã€‚ é…ç½®æ’ä»¶ æ‰“å¼€IDEAçš„Preferencesï¼Œæ‰¾åˆ°Tools-leetcode pluginï¼›é¡µé¢å¦‚ä¸‹ï¼š ä¸Šå›¾çš„åºå·é…ç½®ä¾æ¬¡å¦‚ä¸‹ï¼š é…ç½®leecodeç½‘ç«™çš„ç”¨æˆ·åå¯†ç  é…ç½®ç”Ÿæˆä»£ç çš„åœ°å€ï¼Œæ­¤å¤„æˆ‘é€‰æ‹©çš„æ˜¯ä¸€ä¸ªä¸“é—¨çš„é¡¹ç›®çš„$&#123;base_dir&#125;/src/main/java/comç›®å½•ï¼Œæ­¤æ’ä»¶ä¼šè‡ªåŠ¨åœ¨æ­¤è·¯å¾„ä¸‹åˆ›å»ºleetcode/editor/cn,æ‰€ä»¥æœ€ç»ˆä»£ç ä¼šåœ¨$&#123;base_dir&#125;/src/main/java/com/leetcode/editor/cnè·¯å¾„ä¸‹ é…ç½®ç±»åå’Œæ–‡ä»¶åï¼Œå¿…é¡»é…ç½®é»˜è®¤æ˜¯ä¸­æ–‡ç±»å(éœ€è¦å‹¾é€‰Costom Template) è´´å‡ºæœ¬äººé…ç½®ä¾›å‚è€ƒï¼š CodeFileName: 1P$&#123;question.frontendQuestionId&#125;$!velocityTool.camelCaseName($&#123;question.titleSlug&#125;) CodeTemplate: 12345package com.leetcode.editor.cn;$&#123;question.content&#125;public class P$&#123;question.frontendQuestionId&#125;$!velocityTool.camelCaseName($&#123;question.titleSlug&#125;)&#123; $&#123;question.code&#125;&#125; å¦‚ä½•ä½¿ç”¨leetcodeæ’ä»¶ ç”Ÿæˆæ¨¡æ¿ä»£ç  1ã€æŒ‰ç…§ä¸‹å›¾æ ‡çš„é¡ºåºä¾æ¬¡ç‚¹å‡»æ’ä»¶ä¼šåŠ è½½å„ç§ç®—æ³• 2ã€éšä¾¿åŒå‡»åˆ—è¡¨ä¸­çš„ä¸€ä¸ªç®—æ³•ï¼Œä¼šåœ¨é…ç½®çš„$&#123;base_dir&#125;/src/main/java/com/leetcode/editor/cnè·¯å¾„ä¸‹ç”Ÿæˆæ¨¡æ¿ä»£ç ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š ç»“æœéªŒè¯ ç å®Œä»£ç ä¹‹åé€‰ä¸­ç›¸åº”çš„ç®—æ³•ç‚¹Submitæ¥è¿›è¡ŒéªŒè¯æ­£ç¡®æ€§ æ³¨æ„äº‹é¡¹ 1ã€ä¸‹é¢çš„ä¸¤ä¸ªæ³¨é‡Šä¸èƒ½åˆ é™¤æˆ–ä¿®æ”¹ 123// leetcode submit region begin(Prohibit modification and deletion)// leetcode submit region end(Prohibit modification and deletion) 2ã€æäº¤çš„æ‰€æœ‰ä»£ç å¿…é¡»åœ¨è‡ªåŠ¨ç”Ÿæˆçš„Solutionç±»ä¹‹å†… éå¸¸æ„Ÿè°¢ï¼ï¼ï¼","categories":[{"name":"æ•°æ®ç»“æ„ä¸ç®—æ³•","slug":"æ•°æ®ç»“æ„ä¸ç®—æ³•","permalink":"https://guozhe001.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://guozhe001.github.io/tags/%E5%B7%A5%E5%85%B7/"},{"name":"leetcode","slug":"leetcode","permalink":"https://guozhe001.github.io/tags/leetcode/"},{"name":"IntelliJ","slug":"IntelliJ","permalink":"https://guozhe001.github.io/tags/IntelliJ/"},{"name":"æ•°æ®ç»“æ„ä¸ç®—æ³•","slug":"æ•°æ®ç»“æ„ä¸ç®—æ³•","permalink":"https://guozhe001.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"}]}],"categories":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"ethereum","slug":"åŒºå—é“¾/ethereum","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/ethereum/"},{"name":"è¯»ä¹¦ç¬”è®°","slug":"è¯»ä¹¦ç¬”è®°","permalink":"https://guozhe001.github.io/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"},{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://guozhe001.github.io/categories/%E5%B7%A5%E5%85%B7/"},{"name":"Gradle","slug":"å·¥å…·/Gradle","permalink":"https://guozhe001.github.io/categories/%E5%B7%A5%E5%85%B7/Gradle/"},{"name":"Homebrew","slug":"å·¥å…·/Homebrew","permalink":"https://guozhe001.github.io/categories/%E5%B7%A5%E5%85%B7/Homebrew/"},{"name":"Linux","slug":"Linux","permalink":"https://guozhe001.github.io/categories/Linux/"},{"name":"Docker","slug":"å·¥å…·/Docker","permalink":"https://guozhe001.github.io/categories/%E5%B7%A5%E5%85%B7/Docker/"},{"name":"Java","slug":"Java","permalink":"https://guozhe001.github.io/categories/Java/"},{"name":"Redis","slug":"Java/Redis","permalink":"https://guozhe001.github.io/categories/Java/Redis/"},{"name":"Spring","slug":"Java/Spring","permalink":"https://guozhe001.github.io/categories/Java/Spring/"},{"name":"Hyperledger-Fabric","slug":"åŒºå—é“¾/Hyperledger-Fabric","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/"},{"name":"channel","slug":"åŒºå—é“¾/Hyperledger-Fabric/channel","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/channel/"},{"name":"ä¾›åº”é“¾é‡‘è","slug":"åŒºå—é“¾/Hyperledger-Fabric/ä¾›åº”é“¾é‡‘è","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D/"},{"name":"chaincode","slug":"åŒºå—é“¾/Hyperledger-Fabric/chaincode","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/chaincode/"},{"name":"peer","slug":"åŒºå—é“¾/Hyperledger-Fabric/peer","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/peer/"},{"name":"API","slug":"åŒºå—é“¾/Hyperledger-Fabric/API","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/API/"},{"name":"Key Concepts","slug":"åŒºå—é“¾/Hyperledger-Fabric/Key-Concepts","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger-Fabric/Key-Concepts/"},{"name":"Corda","slug":"åŒºå—é“¾/Corda","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Corda/"},{"name":"CorDapp","slug":"åŒºå—é“¾/Corda/CorDapp","permalink":"https://guozhe001.github.io/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/Corda/CorDapp/"},{"name":"æ•°æ®ç»“æ„ä¸ç®—æ³•","slug":"æ•°æ®ç»“æ„ä¸ç®—æ³•","permalink":"https://guozhe001.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"blockchain","slug":"åŒºå—é“¾","permalink":"https://guozhe001.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"},{"name":"ethereum","slug":"ethereum","permalink":"https://guozhe001.github.io/tags/ethereum/"},{"name":"swarm","slug":"swarm","permalink":"https://guozhe001.github.io/tags/swarm/"},{"name":"è¯»ä¹¦ç¬”è®°","slug":"è¯»ä¹¦ç¬”è®°","permalink":"https://guozhe001.github.io/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"},{"name":"ä¿é™©","slug":"ä¿é™©","permalink":"https://guozhe001.github.io/tags/%E4%BF%9D%E9%99%A9/"},{"name":"Gradle","slug":"Gradle","permalink":"https://guozhe001.github.io/tags/Gradle/"},{"name":"Java","slug":"Java","permalink":"https://guozhe001.github.io/tags/Java/"},{"name":"Homebrew","slug":"Homebrew","permalink":"https://guozhe001.github.io/tags/Homebrew/"},{"name":"Mac","slug":"Mac","permalink":"https://guozhe001.github.io/tags/Mac/"},{"name":"Linux","slug":"Linux","permalink":"https://guozhe001.github.io/tags/Linux/"},{"name":"shell","slug":"shell","permalink":"https://guozhe001.github.io/tags/shell/"},{"name":"Docker","slug":"Docker","permalink":"https://guozhe001.github.io/tags/Docker/"},{"name":"docker-compose","slug":"docker-compose","permalink":"https://guozhe001.github.io/tags/docker-compose/"},{"name":"Redis","slug":"Redis","permalink":"https://guozhe001.github.io/tags/Redis/"},{"name":"çº¿ç¨‹æ± ","slug":"çº¿ç¨‹æ± ","permalink":"https://guozhe001.github.io/tags/%E7%BA%BF%E7%A8%8B%E6%B1%A0/"},{"name":"Spring","slug":"Spring","permalink":"https://guozhe001.github.io/tags/Spring/"},{"name":"Hyperledger-Fabric","slug":"Hyperledger-Fabric","permalink":"https://guozhe001.github.io/tags/Hyperledger-Fabric/"},{"name":"channel","slug":"channel","permalink":"https://guozhe001.github.io/tags/channel/"},{"name":"peer","slug":"peer","permalink":"https://guozhe001.github.io/tags/peer/"},{"name":"ä¾›åº”é“¾é‡‘è","slug":"ä¾›åº”é“¾é‡‘è","permalink":"https://guozhe001.github.io/tags/%E4%BE%9B%E5%BA%94%E9%93%BE%E9%87%91%E8%9E%8D/"},{"name":"chaincode","slug":"chaincode","permalink":"https://guozhe001.github.io/tags/chaincode/"},{"name":"API","slug":"API","permalink":"https://guozhe001.github.io/tags/API/"},{"name":"contractapi","slug":"contractapi","permalink":"https://guozhe001.github.io/tags/contractapi/"},{"name":"ClientIdentity","slug":"ClientIdentity","permalink":"https://guozhe001.github.io/tags/ClientIdentity/"},{"name":"Secured","slug":"Secured","permalink":"https://guozhe001.github.io/tags/Secured/"},{"name":"Private Data","slug":"Private-Data","permalink":"https://guozhe001.github.io/tags/Private-Data/"},{"name":"Identity","slug":"Identity","permalink":"https://guozhe001.github.io/tags/Identity/"},{"name":"Ordering Service","slug":"Ordering-Service","permalink":"https://guozhe001.github.io/tags/Ordering-Service/"},{"name":"Private data","slug":"Private-data","permalink":"https://guozhe001.github.io/tags/Private-data/"},{"name":"Smart Contracts and Chaincode","slug":"Smart-Contracts-and-Chaincode","permalink":"https://guozhe001.github.io/tags/Smart-Contracts-and-Chaincode/"},{"name":"Policies","slug":"Policies","permalink":"https://guozhe001.github.io/tags/Policies/"},{"name":"Peers","slug":"Peers","permalink":"https://guozhe001.github.io/tags/Peers/"},{"name":"Ledger","slug":"Ledger","permalink":"https://guozhe001.github.io/tags/Ledger/"},{"name":"MSP","slug":"MSP","permalink":"https://guozhe001.github.io/tags/MSP/"},{"name":"Membership Service Provider","slug":"Membership-Service-Provider","permalink":"https://guozhe001.github.io/tags/Membership-Service-Provider/"},{"name":"Model","slug":"Model","permalink":"https://guozhe001.github.io/tags/Model/"},{"name":"network","slug":"network","permalink":"https://guozhe001.github.io/tags/network/"},{"name":"Fabric chaincode lifecycle","slug":"Fabric-chaincode-lifecycle","permalink":"https://guozhe001.github.io/tags/Fabric-chaincode-lifecycle/"},{"name":"Endorsement policies","slug":"Endorsement-policies","permalink":"https://guozhe001.github.io/tags/Endorsement-policies/"},{"name":"Application","slug":"Application","permalink":"https://guozhe001.github.io/tags/Application/"},{"name":"æ™ºèƒ½åˆçº¦","slug":"æ™ºèƒ½åˆçº¦","permalink":"https://guozhe001.github.io/tags/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/"},{"name":"solidity","slug":"solidity","permalink":"https://guozhe001.github.io/tags/solidity/"},{"name":"MetaMask","slug":"MetaMask","permalink":"https://guozhe001.github.io/tags/MetaMask/"},{"name":"token","slug":"token","permalink":"https://guozhe001.github.io/tags/token/"},{"name":"Corda","slug":"Corda","permalink":"https://guozhe001.github.io/tags/Corda/"},{"name":"CorDapp","slug":"CorDapp","permalink":"https://guozhe001.github.io/tags/CorDapp/"},{"name":"æ•°æ®ç»“æ„ä¸ç®—æ³•","slug":"æ•°æ®ç»“æ„ä¸ç®—æ³•","permalink":"https://guozhe001.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"},{"name":"åŠ¨æ€è§„åˆ’","slug":"åŠ¨æ€è§„åˆ’","permalink":"https://guozhe001.github.io/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/"},{"name":"å·¥å…·","slug":"å·¥å…·","permalink":"https://guozhe001.github.io/tags/%E5%B7%A5%E5%85%B7/"},{"name":"leetcode","slug":"leetcode","permalink":"https://guozhe001.github.io/tags/leetcode/"},{"name":"IntelliJ","slug":"IntelliJ","permalink":"https://guozhe001.github.io/tags/IntelliJ/"}]}